(self.webpackChunk_descript_share=self.webpackChunk_descript_share||[]).push([[179],{6739:(e,t,n)=>{"use strict";var r={};n.r(r),n.d(r,{Analytics:()=>Sr,Application:()=>ir,AudioExport:()=>er,AudiogramTemplate:()=>pr,Canvas:()=>Tr,ClassicRecording:()=>lr,Debug:()=>vr,DebugProxy:()=>yr,DefaultEffects:()=>Ir,EditorRecording:()=>wr,FirstRunExperience:()=>hr,GifExport:()=>tr,LearningRail:()=>br,Migration:()=>Yn,Old:()=>Cr,PatientPlayback:()=>Zn,Project:()=>dr,PublishUI:()=>mr,QuickEdit:()=>gr,Recording:()=>ur,Script:()=>sr,Search:()=>ar,SubtitleExport:()=>Qn,TextExport:()=>Jn,Timeline:()=>cr,TimelineExport:()=>Xn,Video:()=>Er,VideoExport:()=>nr,Voice:()=>fr});var o={};n.r(o),n.d(o,{background:()=>Do,chevron:()=>Oo,decoration:()=>xo,defaultSize:()=>ko,dense:()=>No,hasChevron:()=>Po,iconButton:()=>Lo,loaderRotate:()=>Fo,numberBadge:()=>Uo,primary:()=>Bo,rounded:()=>jo,spinner:()=>Vo});var i={};n.r(i),n.d(i,{BLANK_CARD_SYMBOL:()=>Ka,CARD_BOUNDARY_SYMBOL:()=>qa,PIN_COMPONENT_SYMBOL:()=>$a});var a={};n.r(a),n.d(a,{countCharacter:()=>oc,expandLocationToBoundaries:()=>ac,expandLocationToWordRange:()=>cc,expandRangeToBoundaries:()=>sc,expandRangeToWordRange:()=>dc,getIndexesOf:()=>gc,getSplitIndices:()=>Ec,hasCharacterXBeforeY:()=>uc,hasWordCharacterBeforeSpaceCharacter:()=>fc,isAtWordBoundary:()=>mc,lengthOfCommonPrefix:()=>nc,lengthOfCommonSuffix:()=>rc,paragraphBoundsForIndex:()=>pc,simpleDiff:()=>hc,simpleDiffWithBoundaries:()=>vc,trimRange:()=>lc,utf8ByteLength:()=>ic});var s={};n.r(s),n.d(s,{equalFrameCounts:()=>hd,equivalentWithinTolerance:()=>pd,fromTimeIntervalMap:()=>Fd,greaterThanFrameCount:()=>yd,greaterThanOrEqualFrameCounts:()=>Sd,hasMinutes:()=>md,hmsTimeRegex:()=>Dd,isZero:()=>Rd,lessThanFrameCount:()=>vd,lessThanOrEqualFrameCounts:()=>Ed,makeTimeIntervalMap:()=>kd,pad:()=>Id,parseTimeInterval:()=>Ld,splitTimeInterval:()=>Md,timeIntervalToHHMMSSString:()=>wd,timeIntervalToHHMMSSmmmString:()=>Cd,timeIntervalToHMSString:()=>bd,timeIntervalToHMString:()=>Td,timeIntervalToHoursMinutesString:()=>Ad,timeIntervalToHumanReadableString:()=>_d});var c={};n.r(c),n.d(c,{SCRIPT_CLIP_PLACEHOLDER:()=>IE,SCRIPT_CLIP_PLACEHOLDERS:()=>bE,SPACE:()=>SE});var d={};n.r(d),n.d(d,{UnknownUserJson:()=>KQ,createStripeCustomerPortalSession:()=>LQ,deleteAuthIdentity:()=>UQ,deleteAuthorizedClient:()=>jQ,deleteUser:()=>DQ,fetchAuthIdentitiesSummary:()=>FQ,fetchAuthorizedClients:()=>BQ,fetchCard:()=>AQ,fetchDataConsentInfo:()=>xQ,fetchEmailSubscriptionGroups:()=>WQ,fetchEmailSubscriptionGroupsList:()=>GQ,fetchEmailSubscriptionGroupsWithToken:()=>qQ,fetchOwnerships:()=>_Q,fetchUser:()=>CQ,fetchZendeskChatJWT:()=>zQ,getDiagnosticWriteCredentials:()=>NQ,getSignedFileUploadUrl:()=>VQ,lookupUser:()=>RQ,requestChangePasswordEmail:()=>PQ,setCreditCard:()=>OQ,setDataConsent:()=>kQ,updateUser:()=>MQ,upsertEmailSubscriptionGroups:()=>HQ,upsertEmailSubscriptionGroupsWithToken:()=>$Q});var l={};n.r(l),n.d(l,{disabled:()=>i0,primary:()=>a0,root:()=>s0,secondary:()=>c0});var u={};n.r(u),n.d(u,{background:()=>f0,black:()=>m0,chevron:()=>p0,dark:()=>g0,decoration:()=>h0,destructive:()=>v0,error:()=>E0,grey:()=>y0,hasIcon:()=>S0,hideIconOnMobile:()=>I0,icon:()=>b0,inspector:()=>T0,inspectorDark:()=>w0,label:()=>C0,large:()=>_0,largeResponsive:()=>A0,light:()=>R0,lightSecondary:()=>M0,naked:()=>D0,nakedDestructive:()=>O0,narrow:()=>x0,primary:()=>k0,primaryLight:()=>N0,processing:()=>P0,root:()=>L0,round:()=>F0,secondary:()=>U0,selected:()=>B0,sharp:()=>j0,spinner:()=>V0,upgrade:()=>z0,upgradeSubtle:()=>G0});var f={};n.r(f),n.d(f,{buttonBorder:()=>Ine,defaultSize:()=>bne,dense:()=>Tne,dimBorder:()=>wne,hasError:()=>Cne,hiddenLabel:()=>_ne,hideBorder:()=>Ane,icon:()=>Rne,input:()=>Mne,leftIcon:()=>Dne,readOnly:()=>One,right:()=>xne,root:()=>kne,saved:()=>Nne,showBorder:()=>Pne,showBorderOnInteraction:()=>Lne,suffix:()=>Fne,triggerIcon:()=>Une,underline:()=>Bne,visibleLabel:()=>jne});var m={};n.r(m),n.d(m,{draggableBorder:()=>Hne,dragging:()=>qne,draggingDisabled:()=>$ne,editing:()=>Kne,input:()=>Yne,inputSizer:()=>Zne,lockedCursor:()=>Jne,numericField:()=>Qne});var p={};n.r(p),n.d(p,{betaTag:()=>Ire,content:()=>bre,contentInner:()=>Tre,context:()=>wre,destructive:()=>Cre,dropdown:()=>_re,explanation:()=>Are,fadeIn:()=>Rre,fadeOut:()=>Mre,folderCaret:()=>Dre,hasHeader:()=>Ore,header:()=>xre,icon:()=>kre,iconSelection:()=>Nre,indicatorWrapper:()=>Pre,item:()=>Lre,itemHasIcon:()=>Fre,itemSelection:()=>Ure,label:()=>Bre,right:()=>jre,sectionLabel:()=>Vre,select:()=>zre,selectable:()=>Gre,selected:()=>Wre,separator:()=>Hre,shortcut:()=>qre,slideDown:()=>$re,slideLeft:()=>Kre,slideRight:()=>Yre,slideUp:()=>Zre,triggerItem:()=>Jre});var g={};n.r(g),n.d(g,{checkbox:()=>ioe,checkboxWrapper:()=>aoe,disabled:()=>soe,grey:()=>coe,indeterminate:()=>doe,indicator:()=>loe,label:()=>uoe,medium:()=>foe,menu:()=>moe,reversed:()=>poe,small:()=>goe,wrapper:()=>hoe});var h={};n.r(h),n.d(h,{medium:()=>fie,root:()=>mie,small:()=>pie,thumb:()=>gie});var v={};n.r(v),n.d(v,{caret:()=>ese,caretRedesign:()=>tse,caretWrapper:()=>nse,centered:()=>rse,content:()=>ose,error:()=>ise,icon:()=>ase,inspector:()=>sse,inspectorLight:()=>cse,label:()=>dse,large:()=>lse,light:()=>use,lightSecondary:()=>fse,matchWidth:()=>mse,redesign:()=>pse,reversed:()=>gse,secondary:()=>hse,small:()=>vse,trigger:()=>Ese});var E={};n.r(E),n.d(E,{bold:()=>Cse,close:()=>_se,content:()=>Ase,entry:()=>Rse,fadeIn:()=>Mse,fadeOut:()=>Dse,highlight:()=>Ose,ignore:()=>xse,italic:()=>kse,key:()=>Nse,name:()=>Pse,newSheet:()=>Lse,section:()=>Fse,sheet:()=>Use,shortcut:()=>Bse});var y={};n.r(y),n.d(y,{active:()=>Wde,background:()=>Hde,button:()=>qde,checkboxType:()=>$de,controlRow:()=>Kde,defaultType:()=>Yde,ellipsis:()=>Zde,normal:()=>Jde,regularLabel:()=>Qde,root:()=>Xde,rowSpacer:()=>ele,sliderType:()=>tle,spaceBetween:()=>nle,title:()=>rle,titleRow:()=>ole,waveformInlineType:()=>ile});var S={};n.r(S),n.d(S,{arrow:()=>yme,arrowBorder:()=>Sme,arrowBorderContainer:()=>Ime,content:()=>bme,elevation1:()=>Tme,elevation10:()=>wme,elevation5:()=>Cme,fadeIn:()=>_me,fadeOut:()=>Ame,popoverContent:()=>Rme,title:()=>Mme,withArrow:()=>Dme});var I={};n.r(I),n.d(I,{background:()=>wve,bar:()=>Cve,closeButton:()=>_ve,defaultDensity:()=>Ave,denseDensity:()=>Rve,high:()=>Mve,label:()=>Dve,large:()=>Ove,low:()=>xve,medium:()=>kve,message:()=>Nve});var b={};n.r(b),n.d(b,{body:()=>rye,cell:()=>oye,compact:()=>iye,foot:()=>aye,hasScrolled:()=>sye,head:()=>cye,header:()=>dye,root:()=>lye,row:()=>uye,virtual:()=>fye});var T=n(60668);(0,T.MD)();function w(e){let t="";const n=e.length;for(let r=0;r<n;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function C(e){const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}const _=1===new Uint8Array(new Uint16Array([1]).buffer)[0];var A=n(49578);A.logging.groupLogger("descriptcore/typedarraypool");A.logging.groupLogger("descriptcore/lazy");function R(e,t){const n=e.width,r=e.height,o=Math.sign(t.width),i=Math.sign(t.height),a="contain"===t.fit?M(n,r,Math.abs(t.width),Math.abs(t.height)):function(e,t,n,r){const o=n/e,i=r/t;return Math.max(o,i)}(n,r,Math.abs(t.width),Math.abs(t.height));return{width:n*a*o,height:r*a*i}}function M(e,t,n,r){const o=n/e,i=r/t;return Math.min(o,i)}var D=n(87910);A.logging.groupLogger("descriptcore/debugsettings");class O extends Error{constructor(e="operation was aborted"){super(e)}}Error;Error;Error;function x(e=NaN,t){let n=String(e);return void 0!==t&&Number.isFinite(e)&&!Number.isInteger(e)&&(n=e.toFixed(t)),n}function k(e){const t="byte"===e?0:1;return new Intl.NumberFormat("en-US",{style:"unit",unit:e,maximumFractionDigits:t,minimumFractionDigits:t})}k("terabyte"),k("gigabyte"),k("megabyte"),k("kilobyte"),k("byte");var N=n(48055),P=n.n(N),L=n(26823),F=n.n(L),U=(n(38994),(e=>(e.release="release",e.beta="beta",e.staging="staging",e.testbuild="testbuild",e.local="local",e.testRunner="testrunner",e))(U||{}));const B=()=>"undefined"!==typeof navigator&&(navigator.platform.indexOf("Mac")>-1||!1),j=()=>"undefined"!==typeof navigator&&(navigator.platform.indexOf("Win")>-1||!1),V=()=>"undefined"!==typeof navigator&&navigator.userAgent.indexOf("iPhone")>-1,z=()=>"undefined"!==typeof navigator&&navigator.userAgent.indexOf("Android")>-1,G=()=>B()?"mac":j()?"windows":"undefined"!==typeof navigator&&navigator.platform.indexOf("Linux")>-1?"linux":"undefined"!==typeof navigator?navigator.platform:"";function W(){const e="web-share";return P()(e,"No PRODUCT env var set"),!1}function H(){const e="web-share";return P()(e,"No PRODUCT env var set"),!1}const q="release";const $=["descript","studio sound","white glove","finder","explorer","beamcoder","overdub","green screen","eye contact"];function K(e,t,n){return e<t?t:n<e?n:e}const Y=e=>{let t=e,n="";const r=e.split("."),o=2===r.length&&""===r[0];return r.length>1&&!o&&(n="."+r.pop(),t=r.join(".")),[t,n]};function Z(e){return Y(e)[0]}function J(e){return e.substring(0,1).toLocaleUpperCase()+e.substring(1)}function Q(e,t={capitalize:!1,titlecase:!1}){const n=e.trim().replace(/_/g," ");return t.titlecase?n.split(" ").map(J).join(" "):t.capitalize?J(n):n}new RegExp("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$");function X(e){return(" "+e).slice(1)}function ee(e){return $.reduce(((e,t)=>e.replaceAll(t,J(t))),J(e.toLocaleLowerCase()))}const te=/[\W_]/gu;function ne(e){return e.replace(te,"").toLowerCase()}function re(e,t,n){const r=function(e,t,n){void 0!==n&&(n=K(n,0,e.length),e=e.slice(n));const r=ne(e),o=ne(t),i=r.indexOf(o);if(-1===i)return-1;let a=0,s=0;for(let c=0;c<e.length;c++)if(!e[c].match(te)){if(a===i){s=c;break}a++}return s+(n??0)}(e,t,n);if(-1===r)return;const o=ne(t).length,i=t.match(/\W+$/)?.[0]??"";let a=0,s=r,c=0;for(let d=r;d<e.length;d++){const t=e[d];if(!t.match(te)&&c<=o)c++,c===o&&(s=d+1);else if(c>=o){const e=i[a];if(!e||t!==e)break;s=d+1,a++}}return{startIndex:r,endIndex:s}}const oe=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2});new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:1}),new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2});const ie=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,63}/i,ae=e=>new RegExp(`^${ie.source}$`,"i").test(e),se=B()?"\u2318":"Ctrl",ce=B()?"\u2303":"Ctrl",de=B()?"\u2325":j()?"Alt":"Opt",le=B()?"\u21e7":"Shift",ue=B()?"\u21a9":"Enter",fe=B()?"\u232b":"Backspace",me=B()?"\u2326":"Del";function pe(e){let t,n,r,o=!1;const i=[],a=[];return e.replace(" ","+").split("+").map((e=>e.trim())).filter((e=>e.length>0)).forEach((e=>{const i=e.toLocaleLowerCase();switch(i){case"cmd":case"mod":case"cmdorctrl":t=!0;break;case"option":case"opt":case"alt":n=!0;break;case"shift":r=!0;break;case"ctrl":o=!0;break;case"enter":case"return":a.push(ue);break;case"backspace":a.push(fe);break;case"delete":case"del":a.push(me);break;case"left":a.push("\u2190");break;case"right":a.push("\u2192");break;case"up":a.push("\u2191");break;case"down":a.push("\u2193");break;case"plus":a.push("+");break;default:a.push(Q(i,{capitalize:!0,titlecase:!0}))}})),B()?(o&&i.push(ce),n&&i.push(de),r&&i.push(le),t&&i.push(se)):(t&&i.push(se),o&&i.push(ce),n&&i.push(de),r&&i.push(le)),[...i,...a]}function ge(e){function t(e){const t=pe(e);return B()?t.join(""):t.join("+")}return"string"===typeof e?t(e):e.map(t).join("/")}function he(e){return(e%=360)<0&&(e+=360),0===e?0:e}function ve(e,t=!0){return Object.keys(e).filter((t=>null!==e[t]&&void 0!==e[t])).reduce(((n,r)=>{const o=e[r];return!t||"object"!==typeof o||o instanceof Date?Object.assign(n,{[r]:o}):Object.assign(n,{[r]:ve(o)})}),{})}function Ee(e,...t){return Object.entries(e).reduce(((e,[n,r])=>(t.includes(n)||(e[n]=r),e)),{})}const ye=Object.keys,Se=e=>Object.entries(e);var Ie=(e=>(e[e.OrderedAscending=-1]="OrderedAscending",e[e.OrderedSame=0]="OrderedSame",e[e.OrderedDescending=1]="OrderedDescending",e))(Ie||{});const be=(e,t)=>{const n=e.toLowerCase(),r=t.toLowerCase();return n===r?0:n<r?-1:1},Te=(e,t)=>e-t;function we(e,t){if(1===e.length)return e[0];const n=[],r=new Array(e.length).fill(0);let o,i;for(;;){o=void 0,i=-1;for(let n=0;n<e.length;n++)r[n]>=e[n].length||o&&!t(e[n][r[n]],o)||(o=e[n][r[n]],i=n);if(!o)break;n.push(o),r[i]++}return n}n(12141);function Ce(e){return Boolean(e)}const _e=()=>{},Ae={trackFn:void 0,sentry:void 0};let Re={installId:"",genericProperties:{},genericContext:{},getAdditionalProperties:()=>({}),getPageProperties:void 0};var Me=n(24518),De=n(84853);let Oe;function xe(){return Oe}const ke=new Promise(((e,t)=>{const n="undefined"!==typeof window?window:"undefined"!==typeof self?self:void 0;if("undefined"===typeof n)return xe()?.info("window unavailable; skipping analytics init"),void e();if(xe()?.info(`starting loaded check ${n}`),n.analytics&&"initialize"in n.analytics)return xe()?.info("loaded immediately"),void e();let r=2e4;const o=setInterval((()=>{(n.analytics&&"initialize"in n.analytics||r<=0)&&(clearInterval(o),xe()?.info(`loaded ${n}`),e()),r-=250}),250)}));function Ne(){if("object"===typeof analytics&&"function"===typeof analytics.user)return analytics}let Pe;const Le=new Set;function Fe(){if(xe()){const e=Ne()?.user?.();if(!e)return void xe()?.warn("no analytics user");const t=e.anonymousId?.();if(!t)return void xe()?.warn("no anonymous id");t!==Re.installId&&xe()?.error("anonymous id does not match install id",{anonymousId:t,installId:Re.installId})}}let Ue=Date.now(),Be=Date.now();function je(){const e=Date.now();return e-Be>18e5&&(Ue=e),Be=e,Ue}function Ve(){return{Amplitude:{session_id:je()}}}let ze=!1,Ge=!1;const We=[];async function He(e){xe()?.info("waiting for load"),We.push(e),await async function(e,t){return Pe||(Pe=(async()=>{await ke;const n=Ne();n?(xe()?.info(`loaded, setting anonymous id to ${e}`),n.user().anonymousId(e),n.page(t?.page,t?.params)):xe()?.warn("not properly loaded")})()),await Pe}(Re.installId,Re.getPageProperties?.()),ze=!0,function(){let e;for(xe()?.info("done waiting for load, flushing queued analytics calls");e=We.shift();)e()}()}const qe=[];let $e;let Ke={userId:void 0,anonId:void 0,traits:{},integrations:{},context:{}},Ye=!1;function Ze(e,t){const n=Ne();let r=!Ye;r||=Object.entries(t).some((([e,t])=>!(0,Me.fastDeepEqual)(Ke.traits[e],t)));const o=Ve();r||=!(0,Me.fastDeepEqual)(o,Ke.integrations);const i=Re.genericContext;r||=!(0,Me.fastDeepEqual)(i,Ke.context),r||=e!==Ke.userId;const a=Re.installId;r||=Ke.anonId!==a,r?(Ye=!0,n?.identify(e,t,{context:Re.genericContext,integrations:o}),Ge||(Ge=!0),n?.user?.().anonymousId?.(Re.installId),xe()?.info("identify",{userId:e,anonId:a,traits:`${t}`}),Ke={userId:e,anonId:a,traits:{...Ke.traits,...t},integrations:o,context:i},function(){let e;for(xe()?.info("done waiting for user, flushing queued analytics calls");e=qe.shift();)e()}()):xe()?.debug("skipping identify; nothing has changed")}function Je(){Ye||(xe()?.info("inserting identify call before track/page"),function(e,t={}){const n={...t,...Re.genericProperties};ze?Ze(e,n):async function(e,t){!$e||$e.userId!==e&&void 0!==$e.userId&&void 0!==e?($e={userId:e,traits:t},await He((()=>{$e?(Ze($e.userId,$e.traits),$e=void 0):xe()?.warn("No traits stored for identify",{userId:e})}))):(xe()?.info(`merging scheduled identify call for ${e??$e.userId}`),$e={userId:e??$e.userId,traits:{...$e.traits,...t}})}(e,n)}(void 0))}function Qe(e,t,n){Fe();Ne()?.page(e,t,n),xe()?.info(`page ${e}`,{properties:`${t}`})}function Xe(e,t={}){Je();const n={integrations:Ve()};ze?Qe(e,t,n):He((()=>{Qe(e,t,n)}))}function et(e,t,n){Fe();Ne()?.track(e,t,n),xe()?.info(`${e}`,t)}let tt=0;const nt=[];function rt(...e){tt>0?nt.push(e):ot(...e)}function ot(e,t={},n=!0){Je();const r={integrations:Ve()};n&&Re.getAdditionalProperties&&(t={...t,...Re.getAdditionalProperties?.(t)});const o=function(e){const t={};for(const n of Object.keys(e))void 0!==e[n]&&(t[n]=e[n]);return t}(t);ze?et(e,o,r):He((()=>{et(e,o,r)}));for(const i of Le)i(e,o)}var it=n(92186),at=n(29498),st=n.n(at);function ct(e){if(e?.frames)for(const t of e.frames){if(void 0!==t.filename&&!t.filename.startsWith("app:")){const e=st().basename(t.filename);t.filename=`app:///${e}`}if(void 0!==t.abs_path&&!t.abs_path.startsWith("app:")){const e=st().basename(t.abs_path);t.abs_path=`app:///${e}`}}}const dt={name:"descript.appPath",setupOnce:e=>{e((e=>{if(e.exception?.values)for(const t of e.exception.values)ct(t.stacktrace);return e}))}};function lt(e){return W()?[...e,dt]:e}var ut=n(9981),ft=n(22061);class mt{static create({span:e=new gt,traceMetadata:t}={}){return new mt({traceMetadata:t}).setSpan(e)}constructor({traceMetadata:e,contextData:t={}}={}){this.traceMetadata=e,this.contextData=t}get span(){const e=ut.g.getSpan(this);if(!e)throw new Error("no span found on context");return e}deleteValue(e){if(!(e in this.contextData))return this;const t={...this.contextData};return delete t[e],new mt({traceMetadata:this.traceMetadata,contextData:t})}getValue(e){return this.contextData[e]}setValue(e,t){return e in this.contextData&&this.contextData[e]===t?this:new mt({traceMetadata:this.traceMetadata,contextData:{...this.contextData,[e]:t}})}setSpan(e){return e===ut.g.getSpan(this)?this:ut.g.setSpan(this,e)}}const pt=Object.freeze({traceId:"",spanId:"",traceFlags:ft.r.NONE,traceState:void 0,isRemote:!1});class gt{addEvent(e,t,n){return this}end(e){}isRecording(){return!1}recordException(e,t){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}spanContext(){return pt}updateName(e){return this}}const ht=mt.create();function vt(){return ht}n(21673);var Et=n(4691);function yt(e,t,n){const r=ut.g.getTracer("beachcube","0.0.1");n.traceMetadata&&(t={...t,attributes:{...t?.attributes,...n.traceMetadata}});const o=r.startSpan(e,t,n);return n.setSpan(o)}var St=n(90131),It=(e=>(e.traceId="trace.trace_id",e.parentId="trace.parent_id",e.spanId="trace.span_id",e.serviceName="service.name",e.name="name",e.durationMs="duration_ms",e.isErrored="error",e.spanStatus="status",e.spanKind="kind",e.sampleRate="sampler.sampleRate",e.canceled="canceled",e.metricName="metric_name",e.annotationType="meta.annotation_type",e.message="message",e.stacktrace="stacktrace",e.errorType="error.type",e.errorEscaping="error.escaping",e.errorCode="error.code",e.sentryId="error.sentry_id",e.buildName="build.name",e.buildType="build.type",e.buildVersion="build.version",e.buildPrettyVersion="build.pretty_version",e.osName="system.os.name",e.osVersion="system.os.version",e.osTotalMemory="system.os.total_memory_bytes",e.osFreeMemory="system.os.free_memory_bytes",e.osNumCpus="system.os.number_of_cpus",e.nodeVersion="system.node_version",e.browserName="browser.name",e.messagingE2ELatencyMs="messaging.e2e_latency_ms",e.httpScheme="http.scheme",e.httpPath="http.path",e.httpMethod="http.method",e.httpRequestContentLength="http.request_content_length",e.httpResponseContentLength="http.response_content_length",e.httpStatusCode="http.status_code",e.netPeerName="net.peer.name",e.netPeerPort="net.peer.port",e.netBytesSent="net.bytes_sent",e.reduxActionType="Redux.action.type",e.appSpanType="app.span.type",e.appObjectId="app.object.id",e.appUserId="app.user.id",e.appProjectId="app.project.id",e.appRevisionId="app.revision.id",e.appBaseRevisionId="app.base_revision.id",e.appBaseRevisionNumber="app.base_revision.number",e.appCompositionId="app.composition.id",e.appMediaRefId="app.media_ref.id",e.appAssetId="app.asset.id",e.appArtifactId="app.artifact.id",e.appArtifactContentType="app.artifact.contentType",e.appArtifactQuality="app.artifact.quality",e.appAssetUrl="app.asset.url",e.appAssetQuality="app.asset.quality",e.appFileExtension="app.file.extension",e.appImplementation="app.implementation",e.appFileSize="app.file.size",e.appMimeType="app.file.mimetype",e.appMD5="app.md5",e.appBundleVersion="app.bundle_version",e.appFeatureFlagValue="app.feature_flag.value",e.appObjectStoreBucket="app.object_store_bucket",e.appTimeoutLimitMs="app.timeout_limit_ms",e.appCount="app.count",e.appDepth="app.depth",e.appResult="app.result",e.appScope="app.scope",e.appBatch="app.batch",e.appInteractive="app.interactive",e.appFormat="app.format",e.appCopy="app.copy",e.appCacheResult="app.cache.result",e.appDataOrigin="app.data.origin",e.appQueueLength="app.queue.length",e.appIdempotencyKey="app.idempotency_key",e.appDownloadMs="app.download_ms",e.appRate="app.rate",e.appRegion="app.region",e.appDriveViewPaginated="app.drive_view.paginated",e.appDriveCount="app.count.drive",e.appProjectCount="app.count.project",e.appProjectDownloadedCount="app.count.project_downloaded",e.appDriveId="app.drive.id",e.appProductGroup="app.product_group",e.appMediaSource="app.media_reference.source",e.appMediaSourceProvider="app.media_reference.source_provider",e.appEncodeMs="app.encode_ms",e.appMediaType="app.media_type",e.appDataRefType="app.data_ref.type",e.appMediaDuration="app.media_duration",e.appMediaInterface="app.media_interface",e.appMediaEngineType="app.media_engine.type",e.appAudioPrefetchMs="app.audio.prefetch_ms",e.appAudioEncodeMs="app.audio.encode_ms",e.appVideoPrefetchMs="app.video.prefetch_ms",e.appVideoEncodeMs="app.video.encode_ms",e.appNormalizeMs="app.normalize_ms",e.appTimelineDuration="app.timeline_duration",e.appPlayerKey="app.player_key",e.appAudioExportMs="app.audio.export_ms",e.appChannels="app.channels",e.appAudioBitrate="app.audio.bitrate",e.appVideoBitrate="app.video.bitrate",e.appVideoPixelFormat="app.video.pixel_format",e.appVideoCodec="app.video.codec",e.appWebCodecsVideoDecoderCodec="app.web_codecs_video_decoder.codec",e.appFps="app.fps",e.appPublish="app.publish",e.appEditor="app.editor",e.appClipCount="app.count.clip",e.appTrackCount="app.count.track",e.appSpeakerCount="app.count.speaker",e.appPinCount="app.count.pin",e.appAssetCount="app.count.asset",e.appSceneCount="app.count.scene",e.appTemplate="app.template",e.appOverdub="app.overdub",e.appStudioSound="app.studio_sound",e.appEyeContact="app.eye_contact",e.appBackgroundRemoval="app.background_removal",e.appFontCustom="app.font.custom",e.appFontBuiltin="app.font.builtin",e.appWatermark="app.watermark",e.appHeight="app.height",e.appWidth="app.width",e.appStoryboard="app.storyboard",e.appLiveCollab="app.live_collab",e.appWordlessMediaEllipses="app.wordless_media_ellipses",e.appTimelineRedesign="app.timeline_redesign",e.appAbsolutePlayhead="app.absolute_playhead",e.appOverdubRequestType="app.overdub.request_type",e.appOverdubVoiceId="app.overdub.voice_id",e.appOverdubVoiceTrainingComplete="app.overdub.voice_training_complete",e.appOverdubError="app.overdub.error",e.appTemplateProjectId="app.template.project_id",e.appTemplateCompositionId="app.template.composition_id",e.appTemplateDriveId="app.template.drive_id",e.appTemplateVersionId="app.template.version_id",e.appTemplateCardId="app.template.card_id",e.appTemplatePreviewLandingPage="app.template.preview.landing_page",e.appTemplatePreviewState="app.template.preview.state",e.appTemplatePreviewTotalTimeToFetchUrlMs="app.template.preview.total_time_to_fetch_url_ms",e.appTemplatePreviewTotalTimeToLoadImageMs="app.template.preview.total_time_to_load_image_ms",e.appTemplatePreviewTotalTimeToLoadVideoMs="app.template.preview.total_time_to_load_video_ms",e.appTemplatePreviewImageAvailable="app.template.preview.image_available",e.appTemplatePreviewVideoAvailable="app.template.preview.video_available",e.appTemplatePreviewImageLoadFailed="app.template.preview.image_load_failed",e.appTemplatePreviewVideoLoadFailed="app.template.preview.video_load_failed",e.appTemplateCopySourceContentsMs="app.template.copy_source_contents_ms",e.appTemplateMakeSelectionMs="app.template.make_selection_ms",e.appTemplatePasteContentsMs="app.template.paste_contents_ms",e.appTemplateTrackSceneAddedMs="app.template.track_scene_added_ms",e.appTemplateSaveCardNewTemplate="app.template.save_scene.new_template",e.appTemplateSaveCardGetTemplateProjectMs="app.template.save_scene.get_template_project_ms",e.appTemplateSaveCardCopyPasteMs="app.template.save_scene.copy_paste_ms",e.appTemplateSaveCardSaveNewRevisionMs="app.template.save_scene.save_new_revision_ms",e.appPublishPublishedProjectId="app.publish.published_project_id",e.appPublishType="app.publish.type",e.appPublishPermission="app.publish.permission",e.appPublishQuickEdit="app.publish.quick_edit",e.appPublishDestination="app.publish.destination",e.appPublishCheckAlignmentJobsMs="app.publish.check_alignment_jobs_ms",e.appPublishUploadBounceFilesMs="app.publish.upload_bounce_files_ms",e.appPublishCreateAndUploadPublishedProjectMs="app.publish.create_and_upload_published_project_ms",e.appPublishTotalTimeMs="app.publish.total_time_ms",e.appPublishResolution="app.publish.resolution",e.appPublishWidth="app.publish.width",e.appPublishHeight="app.publish.height",e.appPublishYoutubeRequestSuccess="app.publish.youtube.request_success",e.appPublishYoutubeErrorType="app.publish.youtube.error_type",e.appPublishYoutubeErrorMessage="app.publish.youtube.error_message",e.appEditorRecordingStartedTimestampDelta="app.editor.recording_started_timestamp",e.appEditorRecordingUserStartedRecording="app.editor.recording.user_started_recording",e.appEditorRecorderVersion="app.Editor.recorder_version",e.appEditorRecordingStoppedTimestampDelta="app.editor.recording_stopped_timestamp",e.appEditorRecordingCancelledTimestampDelta="app.editor.recording_cancelled_timestamp",e.appEditorRecordingForceKillTimestampDelta="app.editor.recording_force_kill_timestamp",e.appEditorRecordingCurrentConfiguration="app.editor.recording.current_configuration",e.appEditorRecordingCurrentState="app.editor.recording.current_state",e.appEditorRecordingClassicRecorder="app.editor.recording.classic_recorder",e.appEditorRecordingDuration="app.editor.recording_duration",e.appEditorRecordingFileSize="app.editor.recording_filesize",e.appEditorRecordingCameraLoadStatus="app.editor.recording.camera_load_status",e.appEditorRecordingCurrentMessage="app.editor.recording.current_message",e.appEditorRecordingId="app.editor.recording_id",e.appEditorRecordingSuccess="app.editor.recording_success",e.appEditorRecordingNativeSuccess="app.editor.recording_native_success",e.appEditorRecordingCompositionSuccess="app.editor.recording_composition_success",e.appEditorRecordingExternalError="app.editor.recording_external_error",e.appEditorRecordingErrorTypeMessage="app.editor.recording_error_type_message",e.appEditorRecordingErrorType="app.editor.recording_error_type",e.appEditorRecordingErrorMessage="app.editor.recording_error_message",e.appEditorRecordingMode="app.editor.recording_mode",e.appEditorBackupType="app.editor.backup_type",e.appEditorRecordingAllowsScreenCaptureKit="app.editor.recording_allows_screen_capture_kit",e.appEditorRecordingComputerAudioSet="app.editor.recording.computer_audio_set",e.appEditorRecordingMicrophoneAudioSet="app.editor.recording.microphone_audio_set",e.appEditorRecordingScreenRecordingSet="app.editor.recording.screen_recording_set",e.appEditorRecordingCameraRecordingSet="app.editor.recording.camera_recording_set",e.appEditorAudioRecordingStartedMessage="app.editor.audio_recording_starting_message",e.appEditorAudioRecordingStoppedMessage="app.editor.audio_recording_stopped_message",e.appEditorRecordingProcessingFilesMessage="app.editor.recording.processing_files_message",e.appEditorRecorderDocumentAddSuccess="app.editor.recording.document_add_success",e.appEditorRecorderDocumentAddMessage="app.editor.recording.document_add_message",e.appEditorRecorderMonitorRecorderMessage="app.editor.recording.monitor_message",e.appEditorRecorderMonitorRecorderError="app.editor.recording.monitor_error_type",e.appRecorderContext="app.recorder.context",e.appRecorderRecordingId="app.recorder.recording_id",e.appRecorderOperatingSystem="app.recorder.os",e.appRecorderConfiguration="app.recorder.configuration",e.appRecorderConfigCamera="app.recorder.configuration.camera",e.appRecorderConfigMic="app.recorder.configuration.mic",e.appRecorderConfigCompAudio="app.recorder.configuration.computer_audio",e.appRecorderConfigScreen="app.recorder.configuration.screen",e.appRecorderErrorCategory="app.recorder.error_category",e.appRecorderErrorMessage="app.recorder.error_message",e.appRecorderErrorExtra="app.recorder.error_extra",e.appRecorderSetupErrorPhase="app.recorder.setup.error_phase",e.appRecorderSetupTimeToLaunch="app.recorder.setup.time_to_launch",e.appRecorderRecordingDuration="app.recorder.recording.duration",e.appRecorderRecordingFailureType="app.recorder.recording.failure_type",e.appRecorderRecordingProgUploadEnabled="app.recorder.recording.prog_upload_enabled",e.appRecorderImportFailureType="app.recorder.import.failure_type",e.appRecorderImportDidAttemptRecovery="app.recorder.import.did_attempt_recovery",e.appRecorderImportDidAddMediaAsSequence="app.recorder.import.did_add_media_as_sequence",e.appRecorderImportTarget="app.recorder.import.target",e.appRecorderImportNumberOfFiles="app.recorder.import.number_of_files",e.appRecorderRecordingLocationDidGetDeleted="app.recorder.recording_did_get_deleted",e.appRecorderUploadQueueSize="app.recorder.upload.queue_size",e.appRecorderRecoverySuccess="app.recorder.recovery_success",e.appRecorderRecoverySourceDirectory="app.recorder.recovery.recording_directory",e.appRecorderRecoveryDestDirectory="app.recorder.recovery.recording_destination",e.appRecorderRecoveryMessage="app.recorder.recovery.recording_message",e.appRecorderRecoveryType="app.recorder.recovery.type",e.appLanguage="app.language",e.appTranscriptionRequestedService="app.transcription.requested_service",e.appTranscriptionActualService="app.transcription.actual_service",e.appLiveTranscriptionResult="app.live_transcription.result",e.appLiveTranscriptionReceiptId="app.live_transcription.receipt_id",e.appLiveTranscriptionMessage="app.live_transcription.message",e.appEditorRecorderCameraOffset="app.editor.recording.offset_camera",e.appEditorRecorderMicrophoneOffset="app.editor.recording.offset_microphone",e.appEditorRecorderScreenOffset="app.editor.recording.offset_screen",e.appEditorRecorderSystemAudioOffset="app.editor.recording.offset_systemAudio",e.appEditorRecorderSystemError="app.editor.recording.error",e.appEditorRecorderSErrorOffset="app.editor.recording.offset_error",e.appVideoPlayerAvgRenderTime="app.media.videoplayer.avg_render_time",e.appVideoPlayerFramesRendered="app.media.videoplayer.frames_rendered",e.appVideoPlayerFramesDropped="app.media.videoplayer.frames_dropped",e.appVideoPlayerFps="app.media.videoplayer.fps",e.appVideoPlayerMaxFps="app.media.videoplayer.max_fps",e.appVideoPlayerUtilization="app.media.videoplayer.utilization",e.appVideoPlayerAvgTimeBetweenDroppedFrames="app.media.videoplayer.avg_time_between_drops",e.appVideoPlayerMaxTimeBetweenDroppedFrames="app.media.videoplayer.max_time_between_drops",e.appVideoPlayerFileTypes="app.media.videoplayer.file_types",e.appVideoPlayerDecoderCount="app.media.videoplayer.decoder_count",e.appVideoPlayerDecoderTypesRoot="app.media.videoplayer.decoder_type",e.appSystemGPUPreference="app.system.gpu_preference",e.appSystemGPUId0="app.system.gpu_id_0",e.appSystemGPUVendorId0="app.system.gpu_vendorid_0",e.appSystemGPURevision0="app.system.gpu_revision_0",e.appSystemGPUStatus0="app.system.gpu_status_0",e.appSystemGPUAvailability0="app.system.gpu_availability_0",e.appSystemGPULastErrorCode0="app.system.gpu_lastErrorCode_0",e.appSystemGPUDriverVersion0="app.system.gpu_driverVersion_0",e.appSystemGPUDriverDate0="app.system.gpu_driverDate_0",e.appSystemGPUConfigManagerErrorCode0="app.system.gpu_configManagerErrorCode_0",e.appSystemGPUName0="app.system.gpu_name_0",e.appSystemGPURecommendedMaxWorkingSetSize0="app.system.gpu_recommended_max_working_set_0",e.appSystemGPUHeadless0="app.system.gpu_headless_0",e.appSystemGPUType0="app.system.gpu_type_0",e.appSystemGPUMaxTransferRate0="app.system.gpu_max_transfer_rate_0",e.appSystemGPUHasUnifiedMemory0="app.system.gpu_has_unified_memory_0",e.appSystemGPULocation0="app.system.gpu_location_0",e.appSystemGPUId1="app.system.gpu_id_1",e.appSystemGPUVendorId1="app.system.gpu_vendorid_1",e.appSystemGPURevision1="app.system.gpu_revision_1",e.appSystemGPUStatus1="app.system.gpu_status_1",e.appSystemGPUAvailability1="app.system.gpu_availability_1",e.appSystemGPULastErrorCode1="app.system.gpu_lastErrorCode_1",e.appSystemGPUDriverVersion1="app.system.gpu_driverVersion_1",e.appSystemGPUDriverDate1="app.system.gpu_driverDate_1",e.appSystemGPUConfigManagerErrorCode1="app.system.gpu_configManagerErrorCode_1",e.appSystemGPUName1="app.system.gpu_name_1",e.appSystemGPURecommendedMaxWorkingSetSize1="app.system.gpu_recommended_max_working_set_1",e.appSystemGPUHeadless1="app.system.gpu_headless_1",e.appSystemGPUType1="app.system.gpu_type_1",e.appSystemGPUMaxTransferRate1="app.system.gpu_max_transfer_rate_1",e.appSystemGPUHasUnifiedMemory1="app.system.gpu_has_unified_memory_1",e.appSystemGPULocation1="app.system.gpu_location_1",e.appSystemCPUName="app.system.cpu_name",e.appSystemCPUFamily="app.system.cpu_family",e.appSystemCPUArchitecture="app.system.cpu_arch",e.appSystemCPUManufacturer="app.system.cpu_manufacturer",e.appSystemCPUStatus="app.system.cpu_status",e.appSystemCPUAvailability="app.system.cpu_availability",e.appSystemCPULastErrorCode="app.system.cpu_lastErrorCode",e.appSystemCPUType="app.system.cpu_type",e.appSystemCPUSubtype="app.system.cpu_subtype",e.appSystemCPUSubfamily="app.system.cpu_subfamily",e.appSystemCPUMachine="app.system.cpu_machine",e.appSystemCPUModel="app.system.cpu_model",e.appSystemCPUKernelVersion="app.system.cpu_kernel_version",e.appSystemCPUTotalMemory="app.system.cpu_total_memory",e.appSystemCPUUsedMemory="app.system.cpu_used_memory",e.appSystemCPUAvailableMemory="app.system.cpu_available_memory",e))(It||{}),bt=(e=>(e.aborted="aborted",e.alreadyExists="already_exists",e.cancelled="cancelled",e.dataLoss="data_loss",e.deadlineExceeded="deadline_exceeded",e.failedPrecondition="failed_precondition",e.internal="internal",e.invalidArgument="invalid_argument",e.notFound="not_found",e.ok="ok",e.outOfRange="out_of_range",e.permissionDenied="permission_denied",e.resourceExhausted="resource_exhausted",e.unauthenticated="unauthenticated",e.unavailable="unavailable",e.unimplemented="unimplemented",e.unknownError="unknown_error",e))(bt||{});function Tt(e,t,n=bt.unknownError,r){const o={};void 0!==r&&(o[St.og.EXCEPTION_ESCAPED]=r),t instanceof Error?(o[St.og.EXCEPTION_TYPE]=t.name,o[St.og.EXCEPTION_STACKTRACE]=t.stack):o[St.og.EXCEPTION_TYPE]=t&&"object"===typeof t?t.constructor.name:typeof t;const i=void 0===t?void 0:function(e){const t=e;return void 0!==t.message&&"string"===typeof t.message?t.message:String(e)}(t);o[St.og.EXCEPTION_MESSAGE]=i,e.setAttributes(o),e.setStatus({code:Et.Q.ERROR,message:n})}function wt(e){e.setAttribute(It.canceled,!0)}const Ct=Object.freeze({userCancellationAbortController:void 0,spanOptions:void 0});function _t(e){if(e){const{ctx:t,userCancellationAbortController:n,errorStatus:r,...o}=e;return{ctx:t,userCancellationAbortController:n,errorStatus:r,spanOptions:o}}return{...Ct,ctx:vt()}}function At(e,t){return{..._t(e),callback:t}}async function Rt(e,t,n){const{callback:r,spanOptions:o,ctx:i,userCancellationAbortController:a}=At(t,n),s=yt(e,o,i);try{return await r(s)}catch(c){throw a?.signal.aborted?wt(s.span):Tt(s.span,c),c}finally{s.span.end()}}const Mt="82.1.2",Dt="20240206.150",Ot={app:{name:"Descript",version:Mt,build:Dt}};var xt,kt;(0,it.S1)({enabled:Boolean("https://dfe9fbb94497468ba705e75d3c89bbc0@o96449.ingest.sentry.io/5194046"),dsn:"https://dfe9fbb94497468ba705e75d3c89bbc0@o96449.ingest.sentry.io/5194046",release:"web-share-release-82.1.2-20240206.150",environment:"release",ignoreErrors:["ResizeObserver loop limit exceeded"],integrations:lt}),xt=rt,kt={configureScope:De.e,withScope:De.$e,captureException:De.Tb},P()(xt,"trackFn is required"),P()(kt,"sentry is required"),Ae.trackFn=xt,Ae.sentry=kt;var Nt=n(1681),Pt=n(76121),Lt=n(67705),Ft=n(68020),Ut=n(35400),Bt=n(3106),jt=n(7100),Vt=n(84237);const zt=A.logging.groupLogger("descriptmodel/trackers");function Gt(e,t,{level:n,extra:r}={}){zt.error(`[MODEL:${t}]`,{error:`${e}`,level:`${n}`,extra:`${r}`})}function Wt(e,t,n){zt.warn(`[MODEL:${t}]`,{warning:`${e}`,extra:`${n}`})}let Ht=Gt,qt=Wt;var $t=n(59975),Kt=n(12232),Yt=n.n(Kt),Zt=n(7928);class Jt{static install(e,t){Jt.instance=e,Jt.authInstance=t}static async onIdle(){await(this.instance.onIdle?.()),await(this.authInstance.onIdle?.())}}const Qt={height:720,width:1280},Xt={wav:{name:"Waveform Audio File Format",extensions:["wav"],mimeTypes:["audio/wav","audio/x-wav","audio/wave","audio/x-pn-wav"],web:!0},mp3:{name:"MPEG-1 Audio Layer 3",extensions:["mp3"],mimeTypes:["audio/mpeg","audio/mp3"],web:!0},aac:{name:"Advanced Audio Coding",extensions:["aac"],mimeTypes:["audio/aac","audio/x-aac"],web:!1},aiff:{name:"Audio Interchange File Format",extensions:["aiff","aif","aifc"],mimeTypes:["audio/aiff","audio/x-aiff","audio/x-aif","audio/x-aifc"],web:!1},flac:{name:"Free Lossless Audio Codec",extensions:["flac"],mimeTypes:["audio/flac","audio/x-flac"],web:!1},mpeg:{name:"MPEG-1",extensions:["mpeg","mpg"],mimeTypes:["video/mpeg","video/mpg","video/mp1s"],web:!1},mp4:{name:"MPEG-4",extensions:["mp4","m4v","m4a"],mimeTypes:["video/mp4","video/m4v","audio/mp4","audio/x-m4a","video/x-m4v"],web:!0},"3gpp":{name:"3rd Generation Partnership Project",extensions:["3gpp","mp4","m4v","m4a","3gp"],mimeTypes:["video/3gpp"],web:!0},mov:{name:"QuickTime File Format",extensions:["mov"],mimeTypes:["video/quicktime"],web:!0},bmp:{name:"Bitmap Image File",extensions:["bmp"],mimeTypes:["image/bmp"],web:!0},jpeg:{name:"Joint Photographic Experts Group",extensions:["jpg","jpeg"],mimeTypes:["image/jpeg"],web:!0},png:{name:"Portable Network Graphics",extensions:["png"],mimeTypes:["image/png"],web:!0},gif:{name:"Graphics Interchange Format",extensions:["gif"],mimeTypes:["image/gif"],web:!0},tiff:{name:"Tagged Image File Format",extensions:["tiff","tif"],mimeTypes:["image/tiff"],web:!1},webp:{name:"WebP",extensions:["webp"],mimeTypes:["image/webp"],web:!0},webm:{name:"WebM",extensions:["webm"],mimeTypes:["video/webm"],web:!0},mkv:{name:"Matroska",extensions:["mkv"],mimeTypes:["video/x-matroska"],web:!0},opus:{name:"Opus",extensions:["opus"],mimeTypes:["audio/opus"],web:!0}},en={...Xt,ttf:{name:"TrueType Font",extensions:["ttf"],mimeTypes:["font/ttf"],web:!0},otf:{name:"OpenType Font",extensions:["otf"],mimeTypes:["font/otf"],web:!0}},tn=new Set(Object.values(Xt).flatMap((e=>e.mimeTypes)).map((e=>e.toLowerCase())));const nn=Object.fromEntries(Object.values(en).flatMap((({mimeTypes:e,extensions:t})=>e.map((e=>[e,t]))))),rn="descriptbc://",on=1048576,an=(["audio/*","video/*","image/*",...tn].join(", "),"1.0.154"),sn="7.0.0.1112",cn=Boolean("undefined"!==typeof HTMLCanvasElement&&HTMLCanvasElement.prototype.transferControlToOffscreen&&new OffscreenCanvas(10,10).getContext("webgl"));"undefined"!==typeof VideoDecoder&&cn&&(new(F())).getEngine()?.name;var dn=(e=>(e.Word="word",e.RTF="rtf",e.TXT="txt",e.HTML="html",e.Markdown="md",e.SRT="srt",e.VTT="vtt",e.AAC="aac",e.WAV="wav",e.MP3="mp3",e.MP4="mp4",e.GIF="gif",e.AAF="aaf",e.OMF="omf",e.SESX="sesx",e.EDL="edl",e.FCP="fcp",e.Premiere="premiere",e.DaVinciResolve="davinci_resolve",e.JSON="json",e.DEBACKUP="debackup",e.ZIP="zip",e))(dn||{});const ln={"file-preview":{width:240,height:336},"insert-drawer":{width:240,height:336},"template-drawer":{width:240,height:296},"composition-drawer":{width:240,height:274},"media-library":{width:240,height:296},"sequence-media-library":{width:240,height:296}},un={"file-preview":{width:760,height:480},"insert-drawer":ln["insert-drawer"],"composition-drawer":ln["composition-drawer"],"template-drawer":{width:760,height:480},"media-library":{width:760,height:480},"sequence-media-library":{width:620,height:480}},fn=128e3;const mn="Medium";var pn=n(3830);const gn=(0,pn.ZP)(),hn=(gn("LOAD_USER_PREFERENCES"),gn("RESET_PROJECT_VIEW"),gn("SHOW_VU_METER_IN_TIMELINE"),gn("REQUEST_TOGGLE_TIMELINE"),gn("TOGGLE_TIMELINE_LEGACY"),gn("REQUEST_TOGGLE_SCRIPT"),gn("TOGGLE_SCRIPT"),gn("UPDATE_TIMELINE_SIZE"),gn("UPDATE_TIMELINE_SCRIPT_SIZE"),gn("UPDATE_POPOVER_DIMENSIONS"),gn("UPDATE_COMPOSITION_DOCKING_PREFERENCE"),gn("UPDATE_DOCKING_DATA"),gn("REMOVE_DOCKED_PANEL"),gn("ADD_DOCKED_PANEL"),gn("UPDATE_PROJECT_PAGE_SIDEBAR_SIZE"),gn("SET_PROJECT_SIDEBAR_COLLAPSED")),vn=(gn("UPDATE_CARD_RAIL_SIZE"),gn("UPDATE_VIDEO_PANE_SIZE"),gn("UPDATE_VIDEO_PANE_POSITION"));gn("UPDATE_MEDIA_LIBRARY_INSPECTOR_SIZE"),gn("UPDATE_MEDIA_TREE_SORT"),gn("UPDATE_PROJECT_TREE_SORT"),gn("UPDATE_TEMPLATE_BROWSER_SORT");var En=(e=>(e.Exact="exact",e.Sentence="sentence",e))(En||{});gn("SET_SEARCH_COPY_RANGE_TYPE"),gn("TOGGLE_SPOT_AUDITION");const yn=gn("UPDATE_PROJECT_FILTER"),Sn=(gn("SET_WORD_GAP_SHORTEN_DURATION"),gn("SET_PRESERVE_GAPS_ON_DELETE"),gn("SET_DRIVE_ID_FOR_ADMIN_PAGE_AND_PROJECT_FILTER")),In=(gn("SAVE_CLASSIC_RECORDING_INPUT_PREFERENCES"),gn("SET_AUTOMATICALLY_TRANSCRIBE_CLASSIC_RECORDINGS"),gn("SET_SHOW_CLASSIC_RECORDING_COMPUTER_AUDIO_MODAL_PREFERENCE"),gn("SET_SHOW_ALL_VERSIONS_SETTING"),gn("SET_SHOW_ALL_TRACKS_SETTING"),gn("SET_DEFAULT_ASSET_QUALITY")),bn=gn("SET_DEFAULT_USE_ROOMTONE_ON_GAP_CLIPS"),Tn=gn("SET_DEFAULT_AUTOMATICALLY_LEVEL_CLIPS"),wn=gn("SET_AUTO_GENERATE_PROXY"),Cn=gn("SET_OPEN_LINKS_IN_DESKTOP_APP");gn("UPDATE_AUDIOGRAM_TEMPLATE_SETTINGS"),gn("SET_PUBLISH_TYPE"),gn("SET_SELECTED_AUDIOGRAM_TEMPLATE"),gn("SET_CREATE_COMPOSITION_ON_TRANSCRIPTION"),gn("SET_SHOW_BETA_ALERT"),gn("SET_SHOW_ROOMTONE_MODAL"),gn("SET_SHOW_VERSION_4_ONBOARDING"),gn("DISMISS_SHOW_STORYBOARD_NEW_CARD_ONBOARDING"),gn("SET_SHOW_ROOMTONE_PROPERTIES"),gn("UPDATE_LAST_VERSION_CHANGELOG_VIEWED"),gn("UPDATE_LAST_VOICE_MODEL_ID_PROMOTED"),gn("UPDATE_DRIVE_VIEW_DISPLAY_PROMOTED"),gn("SAVE_COMPOSITION_PLAYHEAD"),gn("REMOVE_STALE_SAVED_PROJECT_COMPOSITIONS");gn("SET_LAST_UPDATED_TYPE"),gn("REDEEM_WATERMARK_REMOVAL_ACTION"),gn("TOGGLE_PUBLISHED_BROWSER_CARD_VIEW"),gn("TOGGLE_SCREEN_RECORDING_TRANSCRIPTION_ENABLED"),gn("SET_HIGHLIGHT_MOUSE_CLICKS"),gn("SET_RECORDING_COMPLETE_ACTION"),gn("SET_HIDE_RECORDING_CONTROLS"),gn("SET_SHOW_REGION_RECORDING_CONFIRMATION"),gn("SET_SCREEN_RECORDING_FLIP_CAMERA"),gn("SET_KEEP_OPEN_ON_QUIT"),gn("SET_LAUNCH_AT_LOGIN"),gn("HIDE_WINDOWS_ON_SCREEN_RECORD"),gn("SET_SCREEN_RECORDING_QUALITY_FOR_DRIVE"),gn("SET_CAMERA_RECORDING_QUALITY"),gn("REQUEST_SET_SCREEN_RECORDING_SHORTCUT"),gn("SET_SCREEN_RECORDING_SHORTCUT"),gn("TOGGLE_SCREEN_RECORDING_AUDIO_DEVICE_ENABLED"),gn("SET_SCREEN_RECORDING_AUDIO_DEVICE"),gn("TOGGLE_SCREEN_RECORDING_STUDIO_SOUND_ENABLED"),gn("TOGGLE_SCREEN_RECORDING_COUNTDOWN_ENABLED"),gn("TOGGLE_SCREEN_RECORDING_ALLOW_SCREEN_CAPTURE_KIT"),gn.async("TOGGLE_SCREEN_RECORDING_SYSTEM_AUDIO"),gn("TOGGLE_SCREEN_RECORDING_VIDEO_DEVICE_ENABLED"),gn("SET_SCREEN_RECORDING_VIDEO_DEVICE"),gn("SET_SCREEN_RECORDING_DRIVE"),gn("SET_SCREEN_RECORDING_MODE"),gn("SET_OPEN_WEBPAGE_AFTER_PUBLISH_ENABLED"),gn("SET_SHOW_AUTHOR_ON_PUBLISH_ENABLED"),gn("SET_ENABLE_COMMENTS_ON_PUBLISH_ACTION"),gn("SET_QUICK_EDIT_DEFAULT_SPEAKER"),gn("SET_APPLY_SPEAKER_LABEL_TO_SINGLE_PARAGRAPH"),gn("SET_LEARNING_RAIL_VIDEO_WIDTH");const _n=gn("REQUEST_SET_OFFLINE_STORAGE_LOCATION"),An=gn.async("GET_OFFLINE_STORAGE_LOCATION_OVERRIDE"),Rn=gn("SET_TRANSCRIPTION_LANGUAGE"),Mn=gn("SET_DEFAULT_PROJECT_TYPE"),Dn=gn("SET_COLOR_SCHEME"),On=gn("SET_ALWAYS_PROMPT_FOR_TRANSCRIPTION");gn("SET_SHOW_LIVE_TRANSCRIPTION_UNAVAILABLE_MESSAGE"),gn("TOGGLE_SNAP_TO_GUIDES"),gn("ADD_RECENTLY_USED_COLOR"),gn("TOGGLE_TIMELINE"),gn("SET_TIMELINE_VISIBLE"),gn("RESET_TIMELINE_ACTION"),gn("SET_INSERT_SIDEBAR_VISIBLE"),gn("SET_PROJECT_CHECKED_FOR_LATE_REVISIONS");var xn=(e=>(e.MyProjects="Created by me",e.SharedWithMe="Shared with me",e.Downloaded="Downloaded",e.All="Home",e.Folder="Folder",e.Tutorials="Tutorials",e.AISpeakers="AISpeakers",e.Workspace="Workspace",e.LegacyPublished="Published",e.RecentProjects="Projects",e.QuickRecordings="Quick recordings",e))(xn||{});var kn=(e=>(e.Name="NAME",e.Duration="DURATION",e.Size="SIZE",e.CreatedAt="CREATED",e.LastUpdatedAt="LAST UPDATED",e.ThreeDot="THREE DOT",e.Owner="OWNER",e.Drive="DRIVE",e))(kn||{});var Nn=(e=>(e.All="All",e.Projects="Projects",e.Recordings="Recordings",e))(Nn||{});var Pn=(e=>(e.All="Recent",e.Downloaded="Downloaded",e.OwnedByMe="Owned by me",e))(Pn||{});const Ln={videoWidth:892,videoHeight:892,background:"#fff",descriptLogo:{x:792,y:65,width:80,height:80,color:"#0062FF"},title:{x:60,y:88,color:"rgba(0,0,0,0.4)",font:{family:"Roboto",size:28}},speaker:{x:60,y:132,color:"#000",font:{family:"Roboto",weight:500,size:42}},text:{x:60,y:230,width:772,height:500,font:{weight:500,size:90,family:"Roboto"},lineHeight:1.2,unplayedColor:"#aaa",playingColor:"#000",playingBorderSize:40,playedColor:"#000"}},Fn={...Ln,name:"blue_word",waveform:void 0,text:{...Ln.text,playingBackgroundColor:"#0062ff",playingColor:"#ffffff",unplayedColor:"#000"}},Un={...Ln,name:"blue_waveform",background:"#fff",waveform:{x:0,y:446,width:892,height:446,waveformType:0,waveformBinCount:64,waveformColor:"#0062FF"}},Bn={...Ln,name:"bladerunner",background:"#000",descriptLogo:{...Ln.descriptLogo,color:"#fff"},waveform:{x:60,y:200,width:772,height:290,waveformType:4,waveformColor:"#ff00d6",waveformBinCount:256},text:{...Ln.text,x:60,y:560,width:772,height:230,unplayedColor:"#fff",playingColor:"#ff00d6",playedColor:"#ff00d6"},title:{...Ln.title,color:"rgba(255, 255, 255, 0.5)"},speaker:{...Ln.speaker,color:"#fff"}},jn=[Fn,{...Ln,name:"single_word",text:{...Ln.text,x:0,y:60,width:892,height:832,font:{weight:500,size:135,family:"Roboto"},playingColor:"#fff"},singleWord:!0,background:"rgb(0,98,255)",descriptLogo:{...Ln.descriptLogo,color:"#fff"},waveform:{x:0,y:60,width:892,height:832,waveformType:2,waveformColor:"rgba(255, 255, 255, 0.3)",waveformBinCount:256},title:{...Ln.title,color:"rgba(255, 255, 255, 0.5)"},speaker:{...Ln.speaker,color:"#fff"}},Un,Bn];var Vn=(e=>(e.Composition="composition",e.Selection="selection",e.Card="card",e.Markers="markers",e.LineBreaks="line_breaks",e.AllCompositions="all_compositions",e))(Vn||{});Object.values(Vn);const zn="composition";const Gn=null;function Wn(e){return`r-${e}`}function Hn(e,t,n){return{key:e,get:(r=n?.()||Jt.instance)=>{const o=r?.get(e);return void 0===o?t:o},isSet:(t=n?.()||Jt.instance)=>void 0!==t?.get(e),set:(t,r=n?.()||Jt.instance)=>{r?.set(e,t)},clear:(t=n?.()||Jt.instance)=>{t?.delete(e)},getDefault:()=>t}}function qn(e,t,n=-1/0,r=1/0){const o=(e=t)=>isNaN(e)?t:K(e,n,r);return{key:e,get:(t=Jt.instance)=>o(t.get(e)),isSet:(t=Jt.instance)=>void 0!==t?.get(e),set:(t,n=Jt.instance)=>{n.set(e,o(t))},clear:(t=Jt.instance)=>{t.delete(e)},applyBounds:o,getDefault:()=>t}}function $n(e,t){const n=Hn(e,t);return{...n,get:(n=Jt.instance)=>{const r=n.get(e);return"false"!==r&&(void 0===r?t:Boolean(r))},toggle:(e=Jt.instance)=>{const t=!n.get(e);return n.set(t,e),t}}}function Kn(e,t){function n(){return ir.currentUserId.get()||"no-user"}function r(t=Jt.instance){const r=t?.get(e);return r?.[n()]}function o(t,n,r=Jt.instance){let o=r.get(e);void 0!==o?o[t]=n:o={[t]:n},r.set(e,o)}return{key:e,get:(e=Jt.instance)=>r(e)??t,getForAccount:function(t,n=Jt.instance){const r=n?.get(e);return r?.[t]},isSet:(e=Jt.instance)=>void 0!==r(e),set:(e,t=Jt.instance)=>{o(n(),e,t)},setForAccount:o,clear:(t=Jt.instance)=>{const r=n(),o=t.get(e);void 0!==o&&(delete o[r],t.set(e,o))},getDefault:()=>t}}const Yn={latest:qn("Migration.latest",0,0)},Zn={enabled:$n("patientPlaybackEnabled",!1),pauseDelay:qn("patientPlaybackPauseDelay",2,0,60),pauseDuration:qn("patientPlaybackPauseDuration",1.5,.5,60)},Jn={intervalTimecodeFrequency:qn("TextExport.intervalTimecodeFrequency",60,1,Number.MAX_SAFE_INTEGER),intervalTimecodeEnabled:$n("TextExport.intervalTimecodeEnabled",!0),paragraphTimecodeEnabled:$n("TextExport.paragraphTimecodeEnabled",!1),speakerTimecodeEnabled:$n("TextExport.speakerTimecodeEnabled",!1),markerTimecodeEnabled:$n("TextExport.markerTimecodeEnabled",!1),timecodeOffsetEnabled:$n("TextExport.timecodeOffsetEnabled",!1),timecodeOffset:qn("TextExport.timecodeOffset",0,0,Number.MAX_SAFE_INTEGER),includeCompositionName:$n("TextExport.includeCompositionName",!0),includeMarkers:$n("TextExport.includeMarkers",!0),includeSpeakerLabels:$n("TextExport.includeSpeakerLabels",!0),allSpeakerLabels:$n("TextExport.allSpeakerLabels",!1),includeIgnoredText:$n("TextExport.includeIgnoredText",!0),fileFormat:Hn("TextExport.category",dn.Word)},Qn={maxLineLength:qn("SubtitleExport.maxLineLength",42,1,Number.MAX_SAFE_INTEGER),maxLinesPerCard:qn("SubtitleExport.maxLinesPerCard",2,1,Number.MAX_SAFE_INTEGER),includeSpeakerNames:$n("SubtitleExport.includeSpeakerNames",!1),fileFormat:Hn("SubtitleExport.category",dn.SRT)},Xn={fileFormat:Hn("SessionExport.category",dn.AAF),copyMedia:$n("SessionExport.copyMedia",!0),stripSpaces:$n("SessionExport.stripSpaces",!1),createTrackPerFile:$n("SessionExport.createTrackPerFile",!1)},er={bitrate:Hn("AudioExport.bitrate",fn),samplerate:Hn("AudioExport.samplerate",44100),channelCount:qn("AudioExport.channelCount",1,1,Number.MAX_SAFE_INTEGER),fileFormat:Hn("AudioExport.category",dn.WAV),normalization:Hn("AudioExport.normalization",-24),scope:Hn("AudioExport.scope",zn)},tr={bitrate:Hn("VideoExport.bitrate",fn),samplerate:Hn("VideoExport.samplerate",48e3),channelCount:qn("VideoExport.channelCount",2,1,Number.MAX_SAFE_INTEGER),dimensions:Hn("GifExport.dimensions",Qt),quality:Hn("GifExport.quality",mn),fileFormat:Hn("GifExport.category",dn.GIF),normalization:Hn("AudioExport.normalization",-24),scope:Hn("GifExport.scope",zn),freeExportDimensions:Hn("GifExport.freeExportDimensions",Qt)},nr={bitrate:Hn("VideoExport.bitrate",fn),samplerate:Hn("VideoExport.samplerate",48e3),channelCount:qn("VideoExport.channelCount",2,1,Number.MAX_SAFE_INTEGER),dimensions:Hn("VideoExport.dimensions",Qt),quality:Hn("VideoExport.quality",mn),fileFormat:Hn("VideoExport.category",dn.MP4),normalization:Hn("AudioExport.normalization",-24),scope:Hn("VideoExport.scope",zn),freeExportDimensions:Hn("VideoExport.freeExportDimensions",Qt)},rr=Kn("Application.featureFlags",{}),or=Kn("Application.featureFlagsOverrides",{}),ir={installId:Hn("Application.installId",(0,Zt.Z)(),(()=>Jt.authInstance)),windows:Hn("Application.windows",[]),dismissedRemoteRecordingWarning:Hn("Application.dismissedRemoteRecordingWarning",void 0),dismissedBetaWarning:Hn("Application.dismissedBetaWarning",void 0),showTrackInspector:$n("Application.showTrackInspector",!1),showScript:$n("Application.showScript",!0),timelineLayerDensity:Hn("Application.timelineLayerDensity","default"),showTimeline:$n("Application.showTimeline",!0),showVUMeterInTimeline:$n("Application.showVUMeterInTimeline",!1),isShowingInsertSidebar:$n("Application.isShowingInsertSidebar",!1),isTimelineHidden:$n("Application.isTimelineHidden",Boolean(rr.get()["collapsible-timeline-redesign"])&&Boolean(rr.get()["collapsible-timeline-default-hidden"])),isTimelineExpanded:$n("Application.isTimelineExpanded",!1),timelineSize:qn("Application.timelineSize",160,100,1/0),uiDimensions:Hn("Application.uiDimensions",un),preferDockedCompositions:$n("Application.preferDockedCompositions",!1),dockingData:Hn("Application.dockingData",{areaContents:{},areaRects:{},panelRects:{},panelOpenState:{}}),timelineScriptSize:qn("Application.timelineScriptSize",160,100,1/0),timelineScriptSizeStoryboard:qn("Application.timelineScriptSizeStoryboard",48,24,1/0),projectPageSidebarSize:qn("Application.projectPageSidebarSize",312,170),projectSidebarCollapsed:$n("Application.projectSidebarCollapsed",!0),cardRailSize:qn("Application.cardRailSize",96,96,180),videoPaneSize:qn("Application.videoPaneSize",450,50),videoPanePosition:Hn("Application.videoPanePosition","right"),mediaLibraryInspectorSize:Hn("Application.mediaLibraryInspectorSize",132),mediaTreeSortState:Hn("Application.mediaTreeSortState",{sortOrder:"manual",sortAscending:!0}),sidebarSortState:Hn("Application.sidebarSortState",{sortOrder:"manual",sortAscending:!0}),templateBrowserSortState:Hn("Application.templateBrowserSortState",{column:void 0,ascending:void 0}),projectFilter:Hn("Application.projectFilter",{lastPath:void 0,lastSortColumn:kn.LastUpdatedAt,lastSortAscending:function(e){switch(e){case"OWNER":case"NAME":case"DRIVE":return!0;default:return!1}}(kn.LastUpdatedAt),filter:xn.All,editorVariantFilter:Nn.Projects,projectSubFilter:Pn.All,driveId:void 0,folderId:Gn,workspaceId:void 0}),apiTarget:Hn("Application.apiTarget","production"),liveTranscriptionApiTarget:Hn("Application.liveTranscriptionApiTarget","production"),publishWebTarget:Hn("Application.publishWebTarget","production"),createCompositionOnTranscription:$n("Application.createCompositionOnTranscription",!0),lastVersionChangelogViewed:Hn("Application.lastVersionChangelogViewed",void 0),lastVoiceModelIdPromoted:Hn("Application.lastVoiceModelIdPromoted",void 0),driveViewDisplay:Hn("Application.driveViewDisplay","list"),lastUpdatedType:Hn("Application.lastUpdatedType","Last opened by me"),lastWatermarkRemoval:Hn("Application.lastWatermarkRemoval",{}),showingPublishedBrowserCardView:$n("Application.showingPublishedBrowserCardView",!0),currentUserId:Hn("Application.currentUserId",void 0),keepOpenOnQuit:$n("Application.keepOpenOnQuit",!0),launchAtLogin:$n("Application.launchAtLogin",!0),featureFlags:rr,featureFlagOverrides:or,showBetaAlerts:Hn("Application.showBetaAlerts",{}),showRoomtoneModal:$n("Application.showRoomtoneModal",!0),showVersion4Onboarding:$n("Application.showVersion4Onboarding",!0),showStoryboardNewCardOnboarding:$n("Application.showStoryboardNewCardOnboarding",!0),showRoomtoneProperties:$n("Application.showRoomtoneProperties",!1),recentFonts:Hn("Project.recentFonts",[]),transcriptionLanguage:Hn("Application.transcriptionLanguage",void 0),colorScheme:Hn("Application.colorScheme","system"),defaultProjectType:Hn("Application.defaultProjectType",void 0),alwaysPromptForTranscription:Hn("Application.alwaysPromptForTranscriptionLanguage",void 0,void 0),showLiveTranscriptionUnavailableMessage:Hn("Application.showLiveTranscriptionUnavailableMessage",!0),accessInAppStarted:Kn("Application.accessInAppStarted",{}),bootCachePayload:Hn("Application.bootCachePayload",void 0),newUserWebIntent:Hn("Application.newUserWebIntent",void 0),directToDemoHasSeenPlans:Hn("Application.directToDemoHasSeenPlans",!1),recentlyUsedColors:Hn("Application.recentlyUsedColors",[]),skipAISpeechVideoSequenceWarning:$n("Application.skipAISpeechVideoSequenceWarning",!1),webCodecsCapabilitySurveyCompletedTime:qn("Application.webCodecsCapabilitySurveyCompletedTime",0)},ar={copyRangeType:Hn("Search.copyRangeType",En.Exact),wordGapFilter:qn("Search.wordGapFilter",3,.01),wordGapShortenDuration:qn("Search.wordGapShortenDuration",1,0),preserveGapsOnDelete:$n("Search.preserveGapsOnDelete",!1),spotAudition:$n("Search.spotAudition",!0)},sr={showEditBoundaries:$n("Script.showEditBoundaries",!0),decorateFillerWords:$n("Script.decorateFillerWords",!0),decorateWordErrors:$n("Script.decorateWordErrors",!0),applySpeakerLabelToSingleParagraph:$n("Script.applySpeakerLabelToSingleParagraph",!1)},cr={timelineTool:Hn("Timeline.timelineTool","select")},dr={openLinksInDesktopApp:$n("Project.openLinksInDesktopApp",!1),originalAssetDefault:$n("Project.originalAssetDefault",!1),automaticallyLevelClipsDefault:$n("Project.automaticallyLevelClipsDefault",!0),savedForOffline:Hn("Project.savedForOffline",[]),showAllVersions:$n("Project.showAllRevisions",!1),showAllTracks:$n("Project.showAllTracks",!1),useRoomtoneOnGapClips:$n("Project.useRoomtoneOnGapClips",!0),autoGenerateProxy:$n("Project.autoGenerateProxy",!0),storyboardUpgradePromptDismissed:Hn("Project.storyboardUpgradePromptDismissed",[]),savedProjectCompositions:Hn("Project.savedProjectCompositions",{}),checkedForLateRevisions:Hn("Project.checkedForLateRevisions",[])},lr={automaticallyTranscribe:$n("Recording.autoTranscribe",!0),showComputerAudioModal:$n("Recording.showComputerAudioModal",!0),lastConfiguration:Hn("Recording.lastConfiguration_v2",void 0)},ur={audioDevice:Hn("ScreenRecording.audioDevice_v2","default"),audioDeviceEnabled:$n("ScreenRecording.audioDeviceEnabled",!0),systemAudioEnabled:$n("ScreenRecording.includeSystemAudio",!1),systemAudioAvailable:$n("ScreenRecording.systemAudioAvailable",!0),videoDevice:Hn("ScreenRecording.videoDevice",void 0),videoDeviceEnabled:$n("ScreenRecording.videoDeviceEnabled",!0),driveId:Hn("ScreenRecording.driveId",void 0),transcriptionEnabled:$n("ScreenRecording.transcribeMicrophone",!0),flipCamera:$n("ScreenRecording.flipCamera_v2",!0),cameraRecordingQuality:Hn("ScreenRecording.cameraRecordingQuality","Auto"),keyboardShortcut:Hn("ScreenRecording.keyboardShortcut","CmdOrCtrl+Shift+2"),recordingMode:Hn("ScreenRecording.recordingMode","screen"),recordingCompleteAction:Hn("ScreenRecording.recordingCompleteAction","share"),highlightMouseClicks:$n("ScreenRecording.highlightMouseClicks",!0),hideRecordingControls:$n("ScreenRecording.hideRecordingControls",!1),showRegionRecordingConfirmation:$n("ScreenRecording.showRegionRecordingConfirmation",!0),gpuAccelerationEnabled:$n("ScreenRecording.gpuAccelerationEnabled",!0),studioSoundEnabled:$n("ScreenRecording.studioSoundEnabled",!1),countdownEnabled:$n("ScreenRecording.countdownEnabled",!0),allowScreenCaptureKit:$n("ScreenRecording.allowScreenCaptureKit",!0),driveRecordingQualityMap:Hn("ScreenRecording.driveRecordingQualityMap",{})},fr={defaultBackendVoiceId:Hn("Voice.defaultBackendVoiceId",void 0)},mr={publishType:Hn("PublishUI.publishType","Audio"),selectedAudiogramTemplateIndex:qn("PublishUI.selectedAudiogramTemplateIndex",0,0,jn.length-1)},pr={showTitle:$n("AudiogramTemplate.showTitle",!0),showSpeakerLabels:$n("AudiogramTemplate.showSpeakerLabels",!0),color:Hn("AudiogramTemplate.color","#0062ff"),backgroundImageUrl:Hn("AudiogramTemplate.backgroundImageUrl",void 0),tintBackground:$n("AudiogramTemplate.tintBackground",!1),useDarkMode:$n("AudiogramTemplate.useDarkMode",!1),badgeState:Hn("AudiogramTemplate.badgeState","descript"),badgeImageUrl:Hn("AudiogramTemplate.badgeImageUrl",void 0)},gr={openWebpageAfterPublish:$n("QuickEdit.openWebpageAfterPublish",!0),showAuthorOnPublish:$n("QuickEdit.showAuthorOnPublish",!0),enableCommentsOnPublish:$n("QuickEdit.enableCommentsOnPublish",!0),defaultVoice:Hn("QuickEdit.defaultVoice",void 0)},hr={showAltClickPlayback:$n("FirstRunExperience.showAltClickPlayback",!0),showCapitalization:$n("FirstRunExperience.showCapitalization",!0),showCorrectText:$n("FirstRunExperience.showCorrectText",!0),showPunctuation:$n("FirstRunExperience.showPunctuation",!0),showSceneSlashTip:$n("FirstRunExperience.showSceneSlashTip",!0),showStudioSoundOnboardingExperience:$n("FirstRunExperience.showStudioSoundOnboardingExperience",!0),showTimelineScrollStoryboardOnboardingTip:$n("FirstRunExperience.showTimelineScrollStoryboardOnboardingTip",!0),showHiddenTimelineTip:$n("FirstRunExperience.showHiddenTimelineTip",!0),showWriteScratchTextTip:$n("FirstRunExperience.showWriteScratchTextTip",!0)},vr={beamcoder:$n("Debug.useBeamcoder3",!1),currentSpeakerPreferenceTime:qn("Debug.currentSpeakerPreferenceTime",1,0,1e3),showHiddenFiles:$n("Debug.showHiddenFiles",!1),showBetaLearningVideos:$n("Debug.showBetaLearningVideos",!1)},Er={webGlPreserveDrawingBuffer:$n("Video.webGlPreserveDrawingBuffer",!1)},yr={keyframeInterval:qn("DebugProxy.keyframeInterval",30,1,1e3),hardwareEncoding:$n("DebugProxy.hardwareEncoding",!0),maxFrameRate:qn("DebugProxy.maxFrameRate",30,1,200),maxDimension:qn("DebugProxy.maxDimension",1280,1,1e4),crf:qn("DebugProxy.crf",20,0,51),videoCodec:Hn("DebugProxy.videoCodec","h265"),videoEncodingSpeed:Hn("DebugProxy.videoEncodingSpeed","ultrafast"),maxCpus:qn("DebugProxy.maxCpus",2,1)},Sr={firedAppInstalled:$n("fired_app_installed",!1),transcription:Hn("transcription-events",{})},Ir={title:Hn("DefaultEffects.title",void 0),titleText:Hn("DefaultEffects.titleText",void 0),captions:Hn("DefaultEffects.captions",void 0),captionsText:Hn("DefaultEffects.captionsText",void 0),dynamicText:Hn("DefaultEffects.title",void 0),dynamicTextText:Hn("DefaultEffects.titleText",void 0),rectangle:Hn("DefaultEffects.rectangle",void 0),progress:Hn("DefaultEffects.progress",void 0),progressVector:Hn("DefaultEffects.progressVisual",void 0),ellipse:Hn("DefaultEffects.ellipse",void 0),line:Hn("DefaultEffects.line",void 0),arrow:Hn("DefaultEffects.arrow",void 0),waveform:Hn("DefaultEffects.waveform",void 0),waveformVector:Hn("DefaultEffects.waveformVisual",void 0)},br={videoWidth:qn("LearningRail.videoWidth",430)},Tr={snapToGuides:$n("Canvas.snapToGuides",!0)},wr={hideWindowsOnScreenRecord:$n("ScreenRecording.hideWindowsOnScreenRecord",!0),lastConfiguration:Hn("EditorRecording.lastConfiguration_v4",void 0)},Cr={audioDevice:Hn("ScreenRecording.audioDevice","default"),currentDirectory:Hn("Application.currentDirectory",void 0),lastConfiguration:Hn("Recording.lastConfiguration",!1),transcribeSystemAudio:$n("ScreenRecording.transcribeSystemAudio",!0),wordGapFilter:qn("Application.wordGapFilter",3),wordGapShortenDuration:qn("Application.wordGapShortenDuration",1),editMode:$n("Debug.editMode",!0),showTranscriptScenes:$n("Debug.showTranscriptScenes",!1),protoLiveCollabProjects:Hn("Debug.protoLiveCollabProjects",[]),showLoomImportClipboardModal:Hn("Application.showLoomImportClipboardModal",!0),watchClipboardForImportableMedia:Hn("Application.watchClipboardForImportableMedia",void 0)},_r=null,Ar=["light","dark","system"],Rr=Nt.createContext("light");function Mr(){return Nt.useContext(Rr)}const Dr=Object.freeze({tiny:"11px",finePrint:"12px",regular:"13px",label:"15px",header:"19px",largeHeader:"26px",extraLargeHeader:"32px"}),Or=Object.freeze({regular:400,semibold:500,bold:600}),xr=Object.freeze({standard:"var(--color-standard-text)",subtext:"var(--color-subtext)",black:"var(--color-black-foreground)",lightGray:"var(--color-black-30pct)",white:"var(--color-white-foreground)",pink:"var(--color-descript-pink-filler)",button:"white",primary:"var(--color-descript-blue)",destructive:"var(--color-descript-red)",tooltipSubtitle:"var(--tooltip-shortcut-color)",upgrade:{degrees:157,color1:"rgb(222, 40, 152)",color2:"rgb(145, 102, 255)"}});Object.freeze({normal:250}),Object.freeze({primary:"rgb(0, 98, 255)",primaryLight:"rgba(0, 98, 255, 0.1)",secondary:"rgb(255, 255, 255)",grey:"rgb(237, 237, 237)",light:"transparent",lightSecondary:"transparent",dark:"rgb(151, 151, 151)",black:"rgb(0, 0, 0)",destructive:"rgb(255, 54, 91)",error:"rgba(255, 54, 91, 0.1)",upgrade:{degrees:157,color1:"rgb(222, 40, 152)",color2:"rgb(145, 102, 255)"},upgradeSubtle:{degrees:157,color1:"rgb(251, 228, 242)",color2:"rgb(243, 234, 250)"},upgradeLight:"transparent",inspector:"rgb(255, 255, 255)",inspectorLight:"transparent",inspectorDark:"rgb(100, 100, 100)"});function kr(e){const t=(0,Nt.useRef)();return(0,Nt.useEffect)((()=>{t.current=e}),[e]),t.current}function Nr(e=!1){const[t,n]=(0,Nt.useState)(e);return[t,(0,Nt.useCallback)((()=>n(!0)),[]),(0,Nt.useCallback)((()=>n(!1)),[]),n]}function Pr(e){const[t]=(0,Nt.useState)(void 0),n=(0,Nt.useRef)((()=>{const e=t||new Error;throw e.message="Cannot call an event handler while rendering.",e}));return(0,Nt.useLayoutEffect)((()=>{n.current=e})),(0,Nt.useCallback)(((...e)=>n.current(...e)),[])}function Lr(e){e.preventDefault()}function Fr(e){e?.stopPropagation()}function Ur(e){e?.stopPropagation(),e?.preventDefault()}function Br(e){return e instanceof HTMLElement||e instanceof SVGElement}n(24396);function jr({target:e},t){if(!Br(e))return!1;if("Project Transcript"===e.getAttribute("aria-label"))return!1;if(t&&e instanceof HTMLElement&&e.isContentEditable)return!0;if("comment-box"===e.getAttribute("data-role")||"text-field"===e.getAttribute("data-role"))return!0;const n=e.tagName;return"INPUT"===n||"SELECT"===n||"TEXTAREA"===n}var Vr=(e=>(e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.ENTER=13]="ENTER",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.LEFT_ARROW=37]="LEFT_ARROW",e[e.UP_ARROW=38]="UP_ARROW",e[e.RIGHT_ARROW=39]="RIGHT_ARROW",e[e.DOWN_ARROW=40]="DOWN_ARROW",e[e.NUMBER_0=48]="NUMBER_0",e[e.NUMBER_1=49]="NUMBER_1",e[e.NUMBER_2=50]="NUMBER_2",e[e.NUMBER_3=51]="NUMBER_3",e[e.NUMBER_4=52]="NUMBER_4",e[e.NUMBER_5=53]="NUMBER_5",e[e.NUMBER_6=54]="NUMBER_6",e[e.NUMBER_7=55]="NUMBER_7",e[e.NUMBER_8=56]="NUMBER_8",e[e.NUMBER_9=57]="NUMBER_9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.SEMICOLON=186]="SEMICOLON",e[e.EQUAL_SIGN=187]="EQUAL_SIGN",e[e.COMMA=188]="COMMA",e[e.DASH=189]="DASH",e[e.PERIOD=190]="PERIOD",e[e.FORWARD_SLASH=191]="FORWARD_SLASH",e[e.OPEN_BRACKET=219]="OPEN_BRACKET",e[e.BACK_SLASH=220]="BACK_SLASH",e[e.CLOSE_BRACKET=221]="CLOSE_BRACKET",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE",e))(Vr||{});function zr({keyCode:e,onPress:t,stopPropagationAndPreventDefault:n=!0,capture:r=!0,disabledInInput:o=!1,disabledInContentEditable:i=o,disabledInSelectableElement:a,enabled:s=!0}){const c=(0,Nt.useRef)(t);(0,Nt.useEffect)((()=>{c.current=t}),[t]),(0,Nt.useEffect)((()=>{if(!s)return;const t=t=>{!c.current||o&&jr(t,i)||a&&function({target:e}){return!!Br(e)&&(e.tabIndex>=0||"menu"===e.getAttribute("role"))}(t)||Br(t.target)&&t.target.closest("[data-radix-menu-content]")||t.keyCode!==e||t.altKey||t.ctrlKey||t.shiftKey||t.metaKey||(c.current(t),n&&(t.stopPropagation(),t.preventDefault()))};return window.addEventListener("keydown",t,r),()=>{window.removeEventListener("keydown",t,r)}}),[s,e,n,r,o,i,a])}function Gr(e,t){return!!(e.current&&t.target instanceof Node)&&e.current.contains(t.target)}var Wr=n(17074);function Hr(e){const t=Pr(e);(0,Nt.useEffect)((()=>t),[t])}function qr(e){const t=Nt.useRef(),n=Nt.useRef();if(e.some((e=>!1===Boolean(e))))throw t.current||(t.current=new Promise((e=>{n.current=e}))),t.current;t.current&&(n.current?.(),t.current=void 0,n.current=void 0)}function $r(e){const t=Nt.useRef(e);return e!==t.current&&(t.current=e,!0)}"undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement?Nt.useLayoutEffect:Nt.useEffect;var Kr=n(10332);function Yr({update:e,onEvery:t,minimumMsPerTick:n,preventDefault:r}){const o=(0,Nt.useRef)(performance.now()),i=(0,Nt.useRef)(e),a=(0,Nt.useRef)(_r),s=(0,Nt.useRef)(!1),c=(0,Nt.useCallback)((()=>{const e=performance.now();if(void 0!==n&&e-o.current<n)return!0;if(s.current=!1,o.current=e,a.current===_r)throw new Error("Arg ref should never be null when executing update");return i.current(...a.current),!1}),[o,n]),d=(0,Nt.useCallback)(((...e)=>{t&&t(s.current,...e),a.current=e,e.map((e=>{if(e&&"object"===typeof e&&"persist"in e&&"function"===typeof e.persist){e.persist();const t=e.dataTransfer;if(r&&e.preventDefault(),t instanceof DataTransfer){const n=Array.from(t.types),r=Array.from(t.files),o=new DataTransfer;o.dropEffect=t.dropEffect,o.effectAllowed=t.effectAllowed,n.forEach((e=>{const n=t.getData(e);o.setData(e,n)})),r.forEach((e=>{o.items.add(e)})),e.dataTransfer=o}}})),s.current||(s.current=!0,(0,Kr.W)(c))}),[t,r,c]),l=(0,Nt.useCallback)((()=>{Kr.W.cancel(c),s.current=!1}),[c]);return(0,Nt.useEffect)(l,[l]),(0,Nt.useEffect)((()=>{i.current=e}),[e]),[d,l]}function Zr(e){return B()?Boolean(e.metaKey):Boolean(e.ctrlKey)}function Jr(e,t,n=window,r){const o=(0,Nt.useRef)(void 0);(0,Nt.useEffect)((()=>{o.current=t}),[t]);const i=void 0!==t;(0,Nt.useEffect)((()=>{if(!o.current||!n||!n.addEventListener)return;const t=e=>o.current?.(e);return n.addEventListener(e,t,r),()=>{n.removeEventListener(e,t,r)}}),[i,n,e,r])}var Qr=n(52918);const[Xr,eo]=(0,Qr.k)("ResizeObserver");function to({children:e}){const t=(0,Nt.useRef)(),n=(0,Nt.useRef)(new Map),r=Pr((e=>{const r=n.current.get(e.el);r?n.current.set(e.el,[...r,e.onResize]):n.current.set(e.el,[e.onResize]),t.current?.observe(e.el,e.options)})),o=Pr(((e,r)=>{const o=(n.current.get(e)||[]).filter((e=>e!==r));0===o.length?(t.current?.unobserve(e),n.current.delete(e)):n.current.set(e,o)}));return(0,Nt.useLayoutEffect)((()=>(t.current=new ResizeObserver((e=>{for(const t of e){const e=n.current.get(t.target);e&&e.forEach((e=>{e(t)}))}})),()=>{t.current?.disconnect()})),[]),Nt.createElement(Xr,{observe:r,disconnect:o},e)}function no({ref:e,box:t,onResize:n,minimumMsPerTick:r,throttle:o=!0}){const i=eo("useResizeObserver"),[a,s]=Yr({update:n,minimumMsPerTick:r}),c=Pr(n),d=o?a:c;(0,Nt.useEffect)((()=>{const{current:n}=e;if(n)return i.observe({el:n,onResize:d,options:{box:t}}),()=>{s(),i.disconnect(n,d)}}),[i,e,t,s,d])}function ro(e,t={}){const[n,r]=Nt.useState({width:0,height:0,x:0,y:0,top:0,left:0,bottom:0,right:0});return no({...t,ref:e,onResize:e=>{r((t=>{const n={width:e.contentRect.width,height:e.contentRect.height,x:e.contentRect.x,y:e.contentRect.y,top:e.contentRect.top,left:e.contentRect.left,bottom:e.contentRect.bottom,right:e.contentRect.right};return(0,Me.fastDeepEqual)(n,t)?t:n}))}}),n}function oo(e){(0,Nt.useEffect)(e,[])}n(53935);var io=n(65033);async function ao(){const e=document.body;throw e.requestPointerLock?await e.requestPointerLock():e.mozRequestPointerLock?await e.mozRequestPointerLock():e.webkitRequestPointerLock&&await e.webkitRequestPointerLock(),new Error("Pointer lock not supported")}function so(){return Boolean(window.safari)}function co(){let e=!1,t=!1;function n(){return!t||(e=!1,ao().catch((()=>{e=!0})),!1)}return{request:function(){so()&&(0,Kr.W)(n)},cancelRequest:function(){Kr.W.cancel(n)},attach:function({event:n,onMoveEnd:r,onMove:o}){const i=window.innerWidth,a=window.innerHeight;let s=n.pageX,c=n.pageY,d=s,l=c;function u(e){if(0===e.movementX)return;let{movementX:t,movementY:n}=e;void 0===t&&void 0===n&&(t=e.pageX-d,n=e.pageY-l),s+=t,c+=n,d=s,l=c,s%=i,s<0&&(s+=i),c%=a,c<0&&(c+=a),o({cursor:{x:s,y:c},delta:{x:t,y:n},shiftKey:e.shiftKey,metaKey:e.metaKey})}function f(){const e=document;(e.pointerLockElement||e.mozPointerLockElement||e.webkitPointerLockElement)===document.body?document.addEventListener("pointermove",u,!1):(document.removeEventListener("pointermove",u,!1),document.removeEventListener("pointerlockchange",f,!1),document.removeEventListener("mozpointerlockchange",f,!1))}function m(){document.addEventListener("pointermove",u,!1),document.addEventListener("pointerup",(()=>document.removeEventListener("pointermove",u,!1)),{once:!0})}if(document.addEventListener("pointerlockchange",f,!1),document.addEventListener("mozpointerlockchange",f,!1),document.addEventListener("pointerup",(function(e){r?.(e),function(){const e=document;e.exitPointerLock?e.exitPointerLock():e.mozExitPointerLock?e.mozExitPointerLock():e.webkitExitPointerLock&&e.webkitExitPointerLock()}(),t=!1}),{once:!0}),t=!0,so()){let t=function(){const e=window.innerHeight-n;document.documentElement.style.transform=`translate(0, ${e}px)`};const n=window.innerHeight;window.addEventListener("resize",t),document.addEventListener("pointerup",(()=>document.removeEventListener("resize",t)),{once:!0}),e&&m()}else ao().catch(m)}}}const lo=Nt.forwardRef((function({children:e,cursorPoint:t},n){const{x:r=0,y:o=0}=t||{},[i,a]=Nt.useState(void 0),[s,c]=Nt.useState(!1);return Nt.useImperativeHandle(n,(()=>({updatePosition:a,updateVisibility:c})),[]),s&&i?Nt.createElement(io.h,null,Nt.createElement("div",{className:"absolute portal-layer top-0 left-0",style:{transform:`translate(${i.x-r}px, ${i.y-o}px)`}},e)):_r})),uo="data-keyboard-focus",fo=()=>{if("undefined"!==typeof window)return"true"===document.querySelector("body")?.getAttribute(uo)},mo=({onUpdate:e=(()=>{})})=>{const t=()=>{e(!1),document.querySelector("body")?.removeAttribute(uo),document.addEventListener("keydown",n,!1),document.removeEventListener("mousedown",r,!1),document.removeEventListener("touchstart",o,!1)};function n(t){const i=t.composedPath().filter(Br),a=i.some((e=>"toolbar"===e.getAttribute("role"))),s=i.some((e=>"tree"===e.getAttribute("role"))),c=i.some((e=>"grid"===e.getAttribute("role")));("Tab"===t.key||a&&("ArrowLeft"===t.key||"ArrowRight"===t.key)||c&&("ArrowUp"===t.key||"ArrowDown"===t.key||"ArrowLeft"===t.key||"ArrowRight"===t.key)||s&&("ArrowUp"===t.key||"ArrowDown"===t.key))&&(e(!0),document.querySelector("body")?.setAttribute(uo,"true"),document.removeEventListener("keydown",n,!1),document.addEventListener("mousedown",r,!1),document.addEventListener("touchstart",o,!1))}function r(e){0===e.screenX&&0===e.screenY&&0===e.clientX&&0===e.clientY||t()}function o(e){0===e.touches[0].screenX&&0===e.touches[0].screenY&&0===e.touches[0].clientX&&0===e.touches[0].clientY||t()}return{addListeners:function(){const t=fo();t?(e(t),document.addEventListener("mousedown",r,!1),document.addEventListener("touchstart",o,!1)):document.addEventListener("keydown",n,!1)},removeListeners:function(){document.removeEventListener("keydown",n,!1),document.removeEventListener("mousedown",r,!1),document.removeEventListener("touchstart",o,!1)}}},[po,go]=(0,Qr.k)("KeyboardFocus",{isKeyboardNav:!1,manager:{current:void 0}});function ho({children:e}){const[t,n]=Nt.useState(fo()??!1),r=Nt.useRef();return Nt.useEffect((()=>(r.current=mo({onUpdate:n}),r.current?.addListeners(),()=>{r.current?.removeListeners()})),[]),Nt.createElement(po,{isKeyboardNav:t,manager:r},e)}function vo(){return go("useKeyboardFocus").isKeyboardNav}var Eo=n(47998),yo=n.n(Eo);const So=Nt.forwardRef((({style:e,size:t=16,color:n="currentColor",type:r="icon",opacity:o,className:i,name:a,...s},c)=>Nt.createElement("div",{"aria-hidden":"true",ref:c,className:yo()(i,"icon"===r?"icon-token":"cursor-token"),style:{"--icon-opacity":o,"--icon-size":`${t}px`,"--icon-color":n,"--icon-mask":`var(--${a}-${r})`,...e},...s}))),Io=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"info"}))),bo=(0,Nt.createContext)(!1);function To({children:e}){return Nt.createElement(bo.Provider,{value:!0},Nt.Children.toArray(e).map((e=>Nt.isValidElement(e)?Nt.cloneElement(e,{"data-redesign":!0}):e)))}var wo=n(12527),Co=n(48853),_o=n(7232);const Ao=Nt.createContext(void 0),Ro=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement("div",{ref:n,className:yo()(e,"FullscreenPortal-module--GEWNBC"),...t})}));var Mo=n(70450),Do="IconButton-module--RuUKvt",Oo="IconButton-module--e6AHmJ",xo="IconButton-module--i3Zzmo",ko="IconButton-module--fRxGpb",No="IconButton-module--UxMaKs",Po="IconButton-module--VddmUs",Lo="IconButton-module--EAUgbc",Fo="IconButton-module--C3WfRx",Uo="IconButton-module--Xg6Nf4",Bo="IconButton-module--dCXHo3",jo="IconButton-module--Hc1DCJ",Vo="IconButton-module--gAOHjJ";const zo=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"chevron-down-s"}))),Go=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"arrow-up-right"}))),Wo=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"transcribed-s"}))),Ho=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"spinner-s"})));const qo=Nt.forwardRef((function({variant:e,asChild:t,...n},r){const o=t?Co.g7:"div";return Nt.createElement(o,{ref:r,...n,className:yo()(n.className,"badge rounded-full",n.children?"count"===e?"Badge-module--sLc9Hd":"overlay"===e?"Badge-module--T3CqqB":"Badge-module--NVpRkP":"Badge-module--sjERLl")})})),$o=yo()(xo,"flex-center absolute m-1","text-grey-800 bg-grey-0");function Ko({decoration:e}){return Nt.createElement(Nt.Fragment,null,"chevron"===e&&Nt.createElement(Zo,{size:"dense",className:yo()(Oo,"absolute top-1/2 -translate-y-1/2 right-0 text-grey-400")},Nt.createElement(zo,null)),"external-arrow"===e&&Nt.createElement("span",{className:yo()($o,"bottom-0 right-0 rounded-sm")},Nt.createElement(Go,{size:10})),"quotes"===e&&Nt.createElement("span",{className:yo()($o,"top-0 left-0 rounded-sm")},Nt.createElement(Wo,{size:12})),"spinner"===e&&Nt.createElement("span",{className:yo()($o,Vo,"bottom-0 right-0 rounded-full")},Nt.createElement(Ho,{size:8})))}const Yo=(0,Nt.forwardRef)((function({className:e,isPressed:t,onPressedChange:n,onClick:r,size:i="default",rounded:a,children:s,variant:c="default",hasBadge:d,decoration:l,...u},f){const m=Nt.useContext(bo),p=Pr((()=>{n?.(!t)}));return vo(),Nt.createElement(Mo.WV.button,{ref:f,"aria-pressed":t,"data-state":"boolean"===typeof t?t?"on":"off":void 0,onClick:(0,wo.M)(r,p),type:"button",className:yo()(Lo,e,"default"===c?void 0:o[c],"default"===i?ko:o[i],{[jo]:a,[Po]:"chevron"===l}),...u},m&&Nt.createElement("div",{className:Do}),s,Nt.createElement(Ko,{decoration:l}),Boolean(d)&&"number"===typeof d&&Nt.createElement("span",{className:yo()("flex-center absolute top-0 right-0",Uo)},Nt.createElement(qo,{variant:"count"},d)),Boolean(d)&&!0===d&&Nt.createElement(qo,{className:"flex-center absolute top-0 right-0"}))})),Zo=Nt.forwardRef((function({className:e,children:t,decoration:n,size:r="default",rounded:i,hasBackground:a,...s},c){const d=Nt.useContext(bo);return Nt.createElement("div",{ref:c,...s,className:yo()(Lo,e,"default"===r?ko:o[r],{[jo]:i})},d&&a&&Nt.createElement("div",{className:Do}),t,Nt.createElement(Ko,{decoration:n}))}));const Jo=_o.zt,Qo=Nt.forwardRef((function({title:e,subtitle:t,className:n,textSelectable:r,...o},i){const a=(0,Nt.useContext)(bo);return Nt.createElement("div",{ref:i,"data-redesign":a||void 0,className:yo()("Tooltip-module--upUiFu","portal-layer",r?"Tooltip-module--QB29a_":void 0,n),...o},Nt.createElement("div",{className:"Tooltip-module--FcjGZO"},e),Boolean(t)&&Nt.createElement("div",{className:"Tooltip-module--KBxreV"},t))})),Xo=Nt.forwardRef((function({placement:e,portal:t=!0,distance:n,delayOut:r,title:o,subtitle:i,tooltipClassName:a,tooltipTextSelectable:s,...c},d){const l=(0,Nt.useContext)(Ao),u=(0,Nt.useContext)(bo),f=Nt.createElement(_o.VY,{ref:d,"data-redesign":u||void 0,side:e,collisionPadding:16,...c,sideOffset:n,asChild:!0,style:{"--tooltip-animation-delay-out":`${r||0}ms`}},Nt.createElement(Qo,{title:o,subtitle:i,className:a,textSelectable:s}));return t?Nt.createElement(_o.h_,{container:l?.current},f):f})),ei=Nt.forwardRef((function({title:e,subtitle:t="",distance:n=10,enabled:r=!0,visible:o,tooltipClassName:i,tooltipTextSelectable:a,portal:s=!0,placement:c="top",align:d,displayOnMount:l=!1,onShow:u,onHide:f,trigger:m,delayIn:p,delayOut:g=0,hasNonInteractiveTrigger:h=!1,className:v,asChild:E,disableHoverableContent:y,disableClickToClose:S,...I},b){const[T,w]=(0,Nt.useState)(!1),C="click"===m?0:void 0!==p?p:750,_=Pr(((e,t=!1)=>{!t&&e&&"click"===m||!r||(w(e),e?u?.():f?.())})),A=Pr((e=>{S&&e.preventDefault(),"click"===m&&w((e=>{const t=!e;return _(t,!0),t}))})),R=Pr((()=>{"click"===m&&w(!1)})),M=vo(),D=E?Co.g7:h?"button":"div",O=!1!==r&&!1!==o&&(!0===o||T),x=Pr((e=>{M||e.preventDefault()}));return!r&&T&&w(!1),Nt.createElement(_o.fC,{delayDuration:C,defaultOpen:l,onOpenChange:_,open:O,disableHoverableContent:y},Nt.createElement(_o.xz,{asChild:!0,onFocus:x},Nt.createElement(D,{...I,"aria-label":"",ref:b,onClick:(0,wo.M)(I.onClick,A),onMouseLeave:(0,wo.M)(I.onMouseLeave,R),tabIndex:I.tabIndex||(h?0:void 0),type:h?"button":void 0,className:yo()(v,"Tooltip-module--H3nIeL",{"Tooltip-module--QGB5LK":h})})),Nt.createElement(Xo,{placement:c,align:d,portal:s,distance:n,delayOut:g,title:e,subtitle:t,tooltipClassName:i,tooltipTextSelectable:a,"aria-label":I["aria-label"],onPointerDownOutside:S?Lr:void 0}))}));const ti=Nt.forwardRef((function(e,t){return Nt.createElement(ei,{ref:t,delayIn:0,...e,asChild:!0},Nt.createElement(Yo,{className:"Tooltip-module--JeDI6H"},Nt.createElement(Io,null)))}));var ni=n(83996);const ri=(0,pn.ZP)(),oi=ri("ROUTE_CHANGED");ri("PROJECT_SHARE_SHEET_OPENED"),ri("FILLER_WORDS_REMOVED"),ri("CAPITALIZATION_CORRECTED"),ri("TEXT_CORRECTION_COMPLETED"),ri("SPEAKER_LABEL_DROPDOWN_SHOWN_ACTION");function ii(){return{app_id:ir.installId.get(),app_build_type:q,app_version:"82.1.2",app_build_number:"20240206.150",app_name:"web-share"}}function ai(){const e=ii(),t={"x-descript-app-id":e.app_id,"x-descript-app-build-type":e.app_build_type,"x-descript-app-version":e.app_version,"x-descript-app-build-number":e.app_build_number};return e.app_name&&(t["x-descript-app-name"]=e.app_name),t}var si=(e=>(e.GET="get",e.PUT="put",e.PATCH="patch",e.POST="post",e.DELETE="delete",e.HEAD="head",e))(si||{});const ci={Accept:"application/json, text/plain, */*","Content-Type":"application/json"};class di extends Error{constructor(e,t,n={},r,o,i,a){if(super(e),this.statusCode=t,this.json=n,this.method=r,this.path=o,this.query=i,this.requestId=a,this.json=n,this.method=r,this.path=o,this.query=i,void 0!==r&&r.length>0&&void 0!==o&&o.length>0){const e=/[a-f0-9-]{32,36}/gi,n=void 0!==t?`${t} `:"",i=o.replace(e,"{id}");this.name=`RequestError - ${n}${r}:${i}`}else this.name="RequestError"}getSentryContext(){return{id:this.requestId,path:this.path}}isClientError(){return this.statusCode>=400&&this.statusCode<500}}class li extends Error{constructor(e,t="OfflineError"){super(e),this.name=t}}class ui extends di{constructor(e){super("retryCount max reached: "+e.message,429),this.error=e,this.name="RetryMaxReachedError"}}function fi(e,t){t&&(e+=` (${t.slice(-1)})`),De.n_({category:"auth",level:"info",message:e})}function mi({id:e,summary:t,request:n,response:r,start:o,error:i}){0}n(38994);let pi={};function gi(){return void 0===pi.prefix?"":`${hi(pi.prefix)}-`}function hi(e){switch(e){case"localhost":case"localhost-with-staging-data":return"localhost";case"staging":return"staging";default:return"production"}}function vi(){return pi.prefix||"production"}function Ei(e=Jt.authInstance){return e?.get(Ti())}function yi(e=Jt.authInstance){return e?.get(wi())}async function Si(e,t){!function(e,t){Jt.authInstance.set(Ti(),e),Jt.authInstance.set(wi(),t)}(e,t),Ci(),Jt.authInstance.onIdle&&await Jt.authInstance.onIdle()}async function Ii(){Ci(),Jt.authInstance.delete(Ti()),Jt.authInstance.delete(wi()),Jt.authInstance.onIdle&&await Jt.authInstance.onIdle()}function bi(){return void 0===pi.prefix||"production"===pi.prefix}function Ti(){return`${gi()}Auth0.accessToken`}function wi(){return`${gi()}Auth0.refreshToken`}function Ci(){Jt.authInstance.delete(`${gi()}Auth.token`),Jt.authInstance.delete(`${gi()}Auth.refreshToken`)}class _i extends Error{constructor({code:e,message:t,fatal:n,reconnect:r}){super(t),this.name="ErrorEventError",this.code=e,this.fatal=n,this.reconnect=r}}function Ai(e,t){const n=new Error(e.message);return n.name=t,n.underlyingError=e,n.stack=e.stack,n}const Ri="TemplateNotPublished",Mi="ProjectNotTemplate",Di="TemplateUnavailableOnMobile",Oi="RevisionProjectHasLiveCollabMetadata",xi="ForcedLogoutError",ki="NetworkError",Ni="NetworkingError",Pi="net::",Li="Could not create user, email already in use";function Fi(e){return Ai(e,ki)}function Ui(e){const{name:t,code:n,message:r}=e;return t===ki||t===Ni||n===ki||n===Ni||"OfflineError"===t||"FetchError"===t||"TypeError"===t&&"Failed to fetch"===r||"string"===typeof t&&t.startsWith(Pi)||"string"===typeof n&&n.startsWith(Pi)||"string"===typeof r&&r.startsWith(Pi)||e instanceof li}function Bi(e){return!!function(e){return e instanceof Error}(e)&&(e.name===xi||!!function(e){const t=e;if(t instanceof Error&&t.name&&t.message&&t.underlyingError)return!0;return!1}(e)&&Bi(e.underlyingError))}function ji(e){return e instanceof di}function Vi(e){return"Unauthorized"===e.message||ji(e)&&401===e.statusCode||e instanceof _i&&"unauthorized"===e.code}function zi(e){return Vi(e)&&ji(e)&&(e.json.message===Li||e.json.attributes?.error===Li)}function Gi(e){return"Forbidden"===e.message||ji(e)&&403===e.statusCode}function Wi(e){return"Not Found"===e.message||ji(e)&&404===e.statusCode}function Hi(e){return ji(e)&&413===e.statusCode}class qi extends Error{constructor(e){super(`Drive ${e} is suspended`),this.driveId=e,this.name="DriveSuspendedError"}}Error;const $i=Object.freeze({Conflict:"CreateRevision.Conflict",DocumentSaveCorrupted:"CreateRevision.DocumentSaveCorrupted",TrimergeFail:"CreateRevision.TrimergeFail",ProcessSaveJob:"CreateRevision.ProcessSaveJob"});class Ki extends Error{constructor(e,t){super(`Revision conflicts with newer remote revision for project ${e}`),this.projectId=e,this.conflictingRevision=t,this.name=$i.Conflict}}Error;Error;Error;Error;Error;Error;const Yi=e=>async t=>{try{return await t}catch(n){if(e(n))return;throw n}};const Zi=e=>e&&"ENOENT"===e.code,Ji=e=>!!(Zi(e)||e instanceof SyntaxError);Yi(Zi),Yi(Ji),Qi=Ji;var Qi;Error;class Xi extends Error{}Error;Error;function ea(e){return e?new Error(`MediaError Code: ${e.code} | Message: ${e.message}`):new Error("MediaElement error")}var ta=n(13278);const na="https://web.descript.com",ra="https://beta-web.descript.com",oa="https://staging-web.descript.com",ia="https://staging2-web.descript.com",aa="http://localhost:3000",sa="https://share.descript.com",ca="https://staging-share.descript.com",da="https://beta-share.descript.com",la="https://staging-api-share.descript.com",ua="http://localhost:3002",fa="/",ma="/drives/:driveId",pa=`${ma}/projects`,ga="/view/settings/account",ha={prod:{apiAudience:"https://api.descript.com",tenantBaseUrl:"https://auth0.descript.com",applications:{electron:{clientId:"9nzV0ZyJrWMSk1KWTnSFc6jiXBjbVEjN",callbackBaseUrls:[rn]},web:{clientId:"VDfu7rg4pdCELWsrQjcw2tG63a8Qlymi",callbackBaseUrls:[na,ra,oa,ia],callbackBaseUrlRegex:/^https:\/\/.*\.preview-web\.descript\.com/}},connections:{hubSpot:{baseUrl:"https://hubspot.okta.com"}}},staging:{apiAudience:"https://staging-api.descript.com",tenantBaseUrl:"https://staging-auth0.descript.com",applications:{electron:{clientId:"iQir5FOTtsBRcK477h0IOLZybOXKnjLZ",callbackBaseUrls:[rn]},web:{clientId:"gvKNJgtVjdLAOnRA7iiJQ5PJuQFXdy26",callbackBaseUrls:[oa,ia,aa],callbackBaseUrlRegex:/^https:\/\/.*\.preview-web\.descript\.com/}},connections:{hubSpot:{baseUrl:"https://hubspot.oktapreview.com"}}},dev:{apiAudience:"https://api.descript.com",tenantBaseUrl:"https://dev-auth0.descript.com",applications:{electron:{clientId:"O2mkI0ERTMYfOKTlNpDvcvy452t4m4XG",callbackBaseUrls:[rn]},web:{clientId:"t6TQ7BsnAgLFGqB4L268OjLWEqQr9kSb",callbackBaseUrls:[aa]}},connections:{}}};function va(){return window.location.origin.replace(sa,na).replace(da,ra).replace(ca,oa).replace("https://staging2-share.descript.com",ia).replace(la,oa).replace(ua,aa)}const Ea=function(){const e=function(){switch(vi()){case"production":return ha.prod;case"staging":case"localhost-with-staging-data":return ha.staging;case"localhost":return ha.dev;default:throw new Error(`No tenant for api target: ${vi()}`)}}(),t=function(e){return e.applications.web}(e),n=va();if(!t.callbackBaseUrls.includes(n)&&(!t.callbackBaseUrlRegex||!t.callbackBaseUrlRegex.test(n)))throw new Error(`Auth0 config for ${gi()}web-share does not support redirecting to ${n}.`);const r=n+"/auth0/authorize-callback",o=n+"/auth0/logout-callback";return{apiAudience:e.apiAudience,baseUrl:e.tenantBaseUrl,clientId:t.clientId,authorizeCallback:r,logoutCallback:o,allowedUrls:[e.tenantBaseUrl,r,...e.connections.hubSpot?[e.connections.hubSpot.baseUrl]:[]]}};class ya extends Error{constructor(e,t,n={}){super(`${e}: ${t}`),this.status=e,this.message=t,this.tags=n}static isAssetSyncError(e){return e instanceof ya}}class Sa extends Error{constructor(){super(...arguments),this.name="DocumentInvalidError"}}class Ia extends Error{constructor(){super(...arguments),this.name="DocumentMismatchError"}}class ba extends Error{constructor(){super(...arguments),this.name="DocumentFormatError"}}class Ta extends Error{constructor(){super(...arguments),this.name="DiscrepancyInTimeTextOrderingError"}}var wa=n(38994);let Ca;const _a={};function Aa(){return"win32"===wa.platform}function Ra(e,t,{extra:n={},allowNetworkError:r,category:o,level:i,fingerprint:a}={}){let s=i;if(Ui(e)){if(!r)return;if(c=.99,Math.random()<c)return void console.error(`[${t}] not reporting network error`,e,n);void 0===s&&(s="warning")}var c,d;if(Bi(e))return void console.info(`[${t}] not reporting forced logout error`);if(function(e){return e instanceof Xi&&void 0!==e.trackError&&!e?.trackError}(e))return;if(function(e){return Boolean(e.message&&-1!==e.message.indexOf("ResizeObserver loop limit exceeded"))}(e))return;if(e instanceof Ia)return;if((d=e)instanceof Error&&"errno"in d&&"code"in d){const{code:t,errno:r,message:o,path:i,syscall:a}=e;Object.assign(n,{code:t,errno:r,message:o,path:i,syscall:a})}const l=e.extra;l&&"object"===typeof l&&Object.assign(n,l);const u=(_a[t]||0)+1;_a[t]=u,ya.isAssetSyncError(e)&&(n.projectId=n.projectId||e.tags[It.appProjectId],n.assetId=n.assetId||e.tags[It.appAssetId],n.artifactId=n.artifactId||e.tags[It.appArtifactId]);const f=n.project_id??n.projectId,m=n.drive_id??n.driveId,p=n.published_project_id??n.publishedProjectId,g=n.published_project_url_slug??n.publishedProjectUrlSlug,h=n.asset_id??n.assetId,v=n.artifact_id??n.artifactId,E=n.recording_id??n.recordingId;let y;if(void 0!==Ae.sentry?(Ae.sentry.withScope((r=>{r.setTag("error-type",t),ji(e)&&r.setContext("context",e.getSentryContext()),o&&r.setTag("error-category",o),m&&r.setTag("drive-id",m),f&&r.setTag("project-id",f),p&&r.setTag("published-project-id",p),g&&r.setTag("published-project-url-slug",g),h&&r.setTag("asset-id",h),v&&r.setTag("artifact-id",v),E&&r.setTag("recording-id",E),r.setLevel(s||"error"),n&&Object.keys(n).forEach((e=>r.setExtra(e,n[e]))),ya.isAssetSyncError(e)&&r.setContext("Asset Sync Error",e.tags),r.setContext("Screen Recorder Version",{screen_recorder_version:Aa()?sn:an}),a&&r.setFingerprint(a),y=Ae.sentry?.captureException(e)})),console.warn(`[${t}] (sentry=${y})`,e,n)):console.error(`[${t}]`,e,n),Ae.trackFn&&u<=15){const r={};void 0!==f&&(r.project_id=f);const i=n.composition_id||n.compositionId||n.track_id||n.trackId||n.scene_id||n.sceneId;void 0!==i&&(r.track_id=i),ji(e)&&(r.response_message=e.json.message),Ae.trackFn("console_error",{...r,type:t,name:e.name,message:e.message,sentry_id:y,project_id:f,drive_id:m,error_category:o,screen_recorder_version:Aa()?sn:an})}return Ca&&Ca(e,t,n,y),y}function Ma(e,t={}){t?console.warn(e,t):console.warn(e),Da("console_warn",{message:String(e),...t})}function Da(e,t){Ae.trackFn&&Ae.trackFn(e,t)}var Oa=(e=>(e.Account="account",e.AddMediaAsset="add-media-asset",e.AiActions="ai-actions",e.Alignment="alignment",e.AppBoot="app-boot",e.AppSettings="app-settings",e.AudioEdit="audio-edit",e.Auth="auth",e.Beamcoder="beamcoder",e.Comments="comments",e.CopyPaste="copy-paste",e.CorrectionWizard="correction-wizard",e.CreateRevision="create-revision",e.DebugTools="debug-tools",e.DescriptModel="descript-model",e.DriveView="drive-view",e.DurableJobQueue="durable-job-queue",e.Export="export",e.FFmpeg="ffmpeg",e.DynFeatureFlags="dynamic-feature-flags",e.FillerWords="filler-words",e.GlobalAssetSync="global-asset-sync",e.KeyboardShortcuts="keyboard-shortcuts",e.LiveTranscription="live-transcription",e.LiveCollab="live-collab",e.DocSync="doc-sync",e.MultiwindowEditing="multiwindow",e.AISpeech="ai-speech",e.Playback="playback",e.PlaybackVideo="playback-video",e.ProjectEdit="project-edit",e.ProjectInvite="project-invite",e.ProjectLoad="project-load",e.Publish="publish",e.Pubnub="pubnub",e.QuickRecording="quick-recording",e.Recording="recording",e.VoiceVerification="voice-verification",e.Roomtone="roomtone",e.ScreenRecording="screen-recording",e.Script="script",e.StudioSound="studio-sound",e.BackgroundMask="background-mask",e.EyeContact="eye-contact",e.SystemAudio="system-audio",e.Transcription="transcription",e.TranscriptionLanguage="transcription-language",e.Model3="model-3",e.WebAudioRecorder="web-audio-recorder",e))(Oa||{}),xa=n(10560);const ka="code",Na=["offline_access","openid","profile"],Pa="Auth0.PKCEVerifier",La="Auth0.NonceState",Fa="descript_initial_screen";var Ua=(e=>(e.login="login",e.signUp="signUp",e))(Ua||{});async function Ba(e,t,n,r,o,i){const a=new URL("/authorize",Ea().baseUrl);a.searchParams.append("audience",Ea().apiAudience),a.searchParams.append("client_id",Ea().clientId),a.searchParams.append("redirect_uri",Ea().authorizeCallback),a.searchParams.append("response_type",ka),a.searchParams.append("scope",Na.join(" "));const s=Va((0,ta.randomBytes)(32)),c=await async function(e){return Va(await async function(e){return(0,ta.createHash)("sha256").update(e).digest()}(e))}(s);e.set(Pa,s),await(e.onIdle?.()),a.searchParams.append("code_challenge_method","S256"),a.searchParams.append("code_challenge",c),t&&(t=za(e,t),a.searchParams.append("state",t)),n&&a.searchParams.append(Fa,n);const{loginHint:d,submitLabel:l,welcomeMessage:u}=r??{};if(d&&a.searchParams.append("login_hint",d),l&&a.searchParams.append("descript_submit_label",l),u&&a.searchParams.append("descript_welcome_message",u),o&&i)throw new Error("Cannot use both email and link invitation params");if(o){const{inviteId:e,inviteNonce:t}=o;e&&a.searchParams.append("descript_invite_id",e),t&&a.searchParams.append("descript_invite_nonce",t)}else if(i){const{inviteLinkNonce:e,inviteLinkDriveId:t}=i;e&&a.searchParams.append("descript_invite_link_nonce",e),t&&a.searchParams.append("descript_invite_link_drive_id",t)}return a.toString()}function ja(e,t,n){const r=new URL("/v2/logout",Ea().baseUrl);r.searchParams.append("client_id",Ea().clientId);const o=new URL(n||Ea().logoutCallback);if(t){const n=za(e,t);o.searchParams.append("state",n)}return r.searchParams.append("returnTo",o.toString()),r.toString()}function Va(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function za(e,t){const n=Va((0,ta.randomBytes)(16)),r={nonce:n,state:t};return e.set(La,r),n}const Ga="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE2MDE5MzUyMjQsImV4cCI6OTU2NDE1OTc4MjQsImF1ZCI6Ind3dy5leGFtcGxlLmNvbSIsInN1YiI6Impyb2NrZXRAZXhhbXBsZS5jb20iLCJHaXZlbk5hbWUiOiJKb2hubnkiLCJTdXJuYW1lIjoiUm9ja2V0IiwiRW1haWwiOiJqcm9ja2V0QGV4YW1wbGUuY29tIiwiUm9sZSI6WyJNYW5hZ2VyIiwiUHJvamVjdCBBZG1pbmlzdHJhdG9yIl19.s96w6xzv-6sGwkmxOcau_wL7JPmrXmzSMahL2yFXgUo",Wa="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE2MDE5MzUyMjQsImV4cCI6MTYwMTkzNzAyNCwiYXVkIjoid3d3LmV4YW1wbGUuY29tIiwic3ViIjoianJvY2tldEBleGFtcGxlLmNvbSIsIkdpdmVuTmFtZSI6IkpvaG5ueSIsIlN1cm5hbWUiOiJSb2NrZXQiLCJFbWFpbCI6Impyb2NrZXRAZXhhbXBsZS5jb20iLCJSb2xlIjpbIk1hbmFnZXIiLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.e9YJ8pjg5r_HTGoDkiWDLf8L06sR5UpG6i6m07XThWo";n(82931);let Ha;const qa="\u200a",$a="\u{1f4cd}",Ka="\u200b";function Ya(e){for(const t of e)return t}function Za(e){let t;for(const n of e)t=n;return t}function*Ja(e,t){let n=0;for(const r of e)t(r,n)&&(yield r),n+=1}function*Qa(e,t){let n=0;for(const r of e)yield t(r,n),n+=1}function Xa(e,t){let n=0;for(const r of e)t(r,n),n+=1}function*es(e,t){let n=0;for(const r of e){const e=t(r,n);void 0!==e&&(yield e),n+=1}}function ts(e,t){for(const n of e)if(t===n)return!0;return!1}function ns(e,t){return Ya(Ja(e,t))}function*rs(e,t,n=1/0){let r=0;for(const o of e){if(r>=n)return;r>=t&&(yield o),r+=1}}function os(e,t){return void 0!==ns(e,t)}function is(e,t){return!os(e,((e,n)=>!t(e,n)))}function as(e){return void 0===Ya(e)}function*ss(e){for(const t of e)yield*t}function*cs(e){let t;for(const n of e)void 0!==t&&(yield[t,n]),t=n;void 0!==t&&(yield[t,void 0])}function*ds(e){yield*e}function ls(e,t){return e===t||e.length===t.length&&e.every(((e,n)=>e===t[n]))}function us(e,t){let n,r;return function(...o){if(n&&r&&ls(r,o))return n;const i=e(...o);return r=o,n=n?function(e,t,n){if(e===t)return t;let r,o=0;const i=t.length;for(const a of e){if(r){let e=a;if(o<i){const r=t[o];(a===r||n?.(a,r))&&(e=r)}r.push(e)}else if(o===i||!(n?n(t[o],a):t[o]===a)){if(Array.isArray(e)&&!n)return e;r=t.slice(0,o),r.push(a)}o+=1}return r||(o<t.length?Array.isArray(e)&&!n?e:t.slice(0,o):t)}(i,n,t):Array.isArray(i)?i:Array.from(i),n}}function*fs(e,t){let n=0;for(const r of e){if(t(r,n))return;yield r,n+=1}}function*ms(e,t){let n=0,r=!1;for(const o of e)r||(r=t(o,n)),r&&(yield o),n+=1}class ps{contains(e){if(1!==e.length&&(e.length>2||1!==function(e){let t=0;for(const n of e)t+=1;return t}(e)))throw new Error("Input to contains must be a single character string");return this.testChar(e)}index(e,t,n=!1){const r=t?.location??0,o=t?.length??e.length,{testChar:i}=this,a=Math.min(r+o,e.length);if(n)for(let s=a-1;s>=r;s--){if(i(e.charAt(s)))return s}else for(let s=r;s<a;s++){if(i(e.charAt(s)))return s}}}class gs extends ps{constructor(e){super(),this.regex=e,this.testChar=e=>this.regex.test(e)}}class hs extends ps{constructor(e){super(),this.characterSets=e,this.testChar=e=>this.characterSets.some((t=>t.testChar(e)))}}class vs extends ps{constructor(e){super(),this.characterSet=e,this.testChar=e=>!this.characterSet.testChar(e)}}const Es=new class extends ps{constructor(){super(...arguments),this.testChar=e=>{switch(e){case"\n":case"\v":case"\f":case"\r":case"\x85":case"\u2028":case"\u2029":return!0;default:return!1}}}},ys=new class extends ps{constructor(){super(...arguments),this.testChar=e=>{switch(e){case"\u2500":case"\u2501":case"\u2502":case"\u2503":case"\u2504":case"\u2505":return!0;default:return!1}}}},Ss=new class extends ps{constructor(){super(...arguments),this.regexSet=new gs(new RegExp(`\\p{Z}|[\t${Ka}]`,"u")),this.testChar=e=>{const t=e.charCodeAt(0);return!(t>=33&&t<=126)&&(32===t||this.regexSet.testChar(e))}}},Is=new hs([Ss,ys]),bs=new hs([Es,Is]),Ts=(new hs([Es,Ss]),new vs(ys)),ws=new gs(/\p{P}/u),Cs=(new vs(ws),new vs(Es)),_s=new vs(Is),As=new vs(bs),Rs=new gs(/(?!\p{Z}|\p{P}|[\u000A-\u000D\u0085\u0009])./u),Ms=new class extends ps{constructor(){super(...arguments),this.testChar=e=>!ys.testChar(e)&&(e!==Ka&&Rs.testChar(e))}},Ds=new class extends ps{constructor(){super(...arguments),this.testChar=e=>{switch(e){case".":case"!":case"?":case"\xa1":case"\xbf":case"\u203d":return!0;default:return!1}}}},Os=(new hs([Es,Ds]),new hs([Es,ws])),xs=/\p{P}/gu;var ks=n(39195),Ns=n(17976);function Ps(){return(0,ks.Z)().toLowerCase()}const Ls=Ns.Z.URL,Fs=(0,Ns.Z)("descript.com",Ls);function Us(...e){const t=ta.createHash("sha256");return t.update(e.join(":")),(0,ks.Z)({random:new Uint8Array(t.digest().slice(0,16))})}function Bs({seeds:e,doesIdExist:t,counter:n,namespace:r}){n=n??0,r=r??Fs;const o=function(e,t=Fs){return(0,Ns.Z)(e.join(":"),t)}([...e,n.toString()],r);return t(o)?Bs({seeds:e,doesIdExist:t,counter:n+1,namespace:r}):o}const js=`undefined-${Ps()}`;function Vs(...e){const t=e.length,[n,r,o,i]=e;if(0===t)throw new Error("cannot create zero-argument pool");if(t>4)throw new Error("cannot create > 4 argument pool");let a={};return[function(e,s,c,d){let l=a;for(let a=0;a<t;a++){let u=e;switch(a){case 0:u=e;break;case 1:u=s;break;case 2:u=c;break;default:u=d}const f=u??js;let m=l[f];void 0===m&&(m=a===t-1?1===t?{[n]:e}:2===t?{[n]:e,[r]:s}:3===t?{[n]:e,[r]:s,[o]:c}:{[n]:e,[r]:s,[o]:c,[i]:d}:{},l[f]=m),l=m}return l},function(){a={}}]}const[zs]=Vs("location","length");class Gs{static get(e,t){return zs(0|e,0|t)}static getStartEnd(e,t){return this.get(e,t-e)}}Gs.get;function Ws(e,t){return void 0===e?void 0===t:void 0!==t&&(e===t||e.location===t.location&&e.length===t.length)}function Hs({location:e,length:t},n){return e<=n&&n<e+t}function qs({location:e}){return e}function $s({location:e,length:t}){return e+t}function Ks(e,t){return Ys(qs(e),$s(e),qs(t),$s(t))}function Ys(e,t,n,r){return e<r&&n<t}function Zs(e,t,n=Gs.get){if(!Ks(e,t))return;const r=Math.max(qs(e),qs(t));return n(r,Math.min($s(e),$s(t))-r)}function Js(e,t,n=Gs.get){const r=Math.min(qs(e),qs(t));return n(r,Math.max($s(e),$s(t))-r)}function Qs(e,t){const n=e.location,r=$s(e),o=t.location,i=$s(t);return o>=n&&i<=r}function Xs({length:e}){return e<=0}function ec(e,t){const n=qs(e),r=$s(e),o=qs(t);return n<=$s(t)&&o<=r}function tc(e){if(2!==e.length)throw new Error("Invalid range");return Gs.get(Number(e[0]),Number(e[1]))}function nc(e,t){let n=0,r=Math.min(e.length,t.length),o=r;for(;n<o;)e.substring(n,o)===t.substring(n,o)?n=o:r=o,o=Math.floor((r-n)/2+n);return o}function rc(e,t){let n=0,r=Math.min(e.length,t.length),o=r;for(;n<o;)e.substring(e.length-o)===t.substring(t.length-o)?n=o:r=o,o=Math.floor((r-n)/2+n);return o}function oc(e,t,n=0,r){let o=n,i=0;for(;0!==(o=e.indexOf(t,o)+1)&&!(void 0!==r&&o>r);)i++;return i}function ic(e){let t=e.length;for(let n=e.length-1;n>=0;n--){const r=e.charCodeAt(n);r>127&&r<=2047?t+=1:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}function ac(e,t,n){const r=t.length;if(n>r)return Gs.get(r,0);if(n<0)return Gs.get(0,0);if(0===n||e.contains(t.charAt(n-1)))return Gs.get(n,0);if(n===r||e.contains(t.charAt(n)))return Gs.get(n,0);let o=n,i=n;for(;i<r&&!e.contains(t.charAt(i));)i+=1;for(;o>0&&!e.contains(t.charAt(o-1));)o-=1;return i!==o?Gs.get(o,i-o):void 0}function sc(e,t,n){const r=ac(e,t,n.location),o=ac(e,t,$s(n));if(r&&o){const e=$s(o)-r.location;if(e>0)return Gs.get(r.location,e)}}function cc(e,t){return ac(bs,e,t)}function dc(e,t){return sc(bs,e,t)}function lc(e,t,n=bs){for(;!Xs(t)&&n.contains(e.charAt($s(t)-1));)t=Gs.get(t.location,t.length-1);for(;!Xs(t)&&n.contains(e.charAt(qs(t)));)t=Gs.get(qs(t)+1,t.length-1);return t}function uc(e,t,n,r,o){r=void 0!==r?r:o?0:n.length;const i=o?Gs.get(r,n.length-r):Gs.get(0,r),a=e.index(n,i,!o);if(void 0===a)return!1;const s=t.index(n,i,!o);return void 0===s||!(o&&a>s)&&!(!o&&a<s)}function fc(e,t,n){return uc(Ms,bs,e,t,n)}function mc(e,t,n){return!fc(e,t,n)||!fc(e,t,!n)}function pc(e,t){let n=0;if(t>0){const r=e.lastIndexOf("\n",t-1);r>=0&&(n=r+1)}let r=e.indexOf("\n",t);return-1===r&&(r=e.length),Gs.get(n,r-n)}function*gc(e,t,n=0){const r=e.length,o=t.length;for(;n<r&&-1!==(n=e.indexOf(t,n));)yield n,n+=o}function hc(e,t){if(e===t)return{loc:e.length,removed:0,added:0};const n=nc(e,t),r=rc(e.substring(n),t.substring(n));return{loc:n,removed:e.length-n-r,added:t.length-n-r}}function vc(e,t,n){const{loc:r,removed:o}=hc(e,t);if(r===e.length&&r===t.length)return{loc:r,removed:0,added:0};let i=Math.max(0,r-1);for(;i>0&&i<e.length&&!n.contains(e.charAt(i));)i-=1;let a=r+o;for(;a>=0&&a<e.length&&!n.contains(e.charAt(a));)a+=1;a=Math.min(e.length,a+1);const s=e.length-a;return{loc:i,removed:e.length-i-s,added:t.length-i-s}}function*Ec(e,t,n){let r=0;const o=e.length;for(;r<o;){const i=t.index(e,Gs.getStartEnd(r,o));if(void 0===i)return;r>0&&(yield r);let a=n.index(e,Gs.getStartEnd(i+1,o));if(void 0===a)return;for(a+=1;a<o&&n.contains(e.charAt(a));)a+=1;if(a>=o)return;r=a}}const yc="Editor.documentValidity",Sc=async function(e){const t=await e.text();return t.length>0?JSON.parse(t):{}},Ic={},bc=new Set;let Tc,wc;function Cc(){return void 0!==yi()}async function _c(e,t=!1,n=!1){if(fi("ApiClient.logout "+(t?"(reloadApiTarget)":"")),ir.currentUserId.clear(),ir.projectFilter.clear(),ir.showVersion4Onboarding.clear(),ir.showStoryboardNewCardOnboarding.clear(),ir.transcriptionLanguage.clear(),ir.alwaysPromptForTranscription.clear(),ir.showLiveTranscriptionUnavailableMessage.clear(),ir.bootCachePayload.clear(),ir.directToDemoHasSeenPlans.clear(),ur.driveId.clear(),t?(await Jt.onIdle(),function(){if(void 0===Ha)throw new Error("No API target updater defined");Ha()}()):await Ii(),!Tc)throw new Error("Logout callback not installed");await Tc(e,t,n)}let Ac=async function(e){return await Rt("ApiClient.reauthorize",{ctx:e},(async t=>{let n;fi("ApiClient.reauthorize");try{const e=yi();if(!e){const e=new di("No refresh token",401);throw Tt(t.span,e,bt.notFound),e}n=String(e),n in Ic?fi("Reauthorize used existing promise",n):(fi("Reauthorize created new promise",n),Ic[n]=async function(e,t){if(!e)throw new di("No refresh token",401);fi("Auth0Client.handleReauthorize",e);const n=void 0,r=void 0,o=new Request(`${Ea().baseUrl}/oauth/token`,{method:si.POST,headers:{"content-type":"application/json"},body:JSON.stringify({grant_type:"refresh_token",client_id:Ea().clientId,refresh_token:e})});let i;try{mi({id:r,summary:"\u23f1",request:o}),i=await fetch(o)}catch(E0){throw mi({id:r,summary:"\u274c",request:o,start:n,error:E0.message}),Fi(E0)}if(200!==i.status)throw mi({id:r,summary:"\u{1f6b8}",request:o,start:n,response:i}),new di(i.statusText,i.status);mi({id:r,summary:"\u2705",request:o,start:n,response:i});const a=await i.json(),s=a.access_token;if(!s)throw new di("Missing new access token",500);const c=a.refresh_token;c||Ra(new di("Missing new refresh token",500),"reauthorize",{category:Oa.Auth}),await t(s,c||"")}(n,((e,t)=>Si(e,t)))),await Ic[n],bc.add(n),fi("Reauthorize succeeded",n),t.span.setStatus({code:Et.Q.OK})}catch(E0){throw Tt(t.span,E0),t.span.setAttribute(It.httpStatusCode,E0.statusCode),fi(`Reauthorize failed: ${E0.message}`,n),n&&delete Ic[n],!ji(E0)||401!==E0.statusCode&&403!==E0.statusCode?E0:(Cc()&&(fi("Logout - reauthorize failed"),rt("logout",{source:"api-client-reauthorize-failed"}),await _c(e)),Ai(E0,xi))}}))};async function Rc(e,t,n,r,o,i,a=ci,s,c=!1){return await Rt("ApiClient.request",{ctx:e},(async e=>await Dc(e,Sc,t,n,r,o,a,void 0,i,s,c)))}async function Mc(){await async function(){await Promise.all(Object.values(Ic))}();const e=Ei(),t=void 0!==e?String(e):void 0;if(Cc()&&(!t||!function(e){try{(0,xa.Z)(e)}catch(E0){return!1}return!0}(t)))throw new di("Unauthorized",401);if(t)return function(e){return{"x-descript-auth":"auth0",Authorization:`Bearer ${e}`}}(t)}async function Dc(e,t,n,r,o,i,a={},s=3,c,d,l=!1){try{const s=void 0,u=void 0;let f;f=l?new URL("production"===vi()?"https://aligner.descript.com":"https://staging-aligner.descript.com"):d?new URL(`https://${gi()}api.descript.com/public/v1`):new URL(`https://${gi()}api.descript.com/v2`),f.pathname+=r,o&&Object.entries(ve(o)).forEach((([e,t])=>{f.searchParams.set(e,String(t))}));const m={...await Mc(),...a,...ai(),"Accept-version":"v1"},p="undefined"!==typeof window&&i instanceof FormData?i:i?JSON.stringify(i):void 0,g=new Request(f.toString(),{method:n,headers:m,body:p}),h={};let v;c&&(h.signal=c);try{mi({id:u,summary:"\u23f1",request:g}),v=await Rt("fetch",{ctx:e,attributes:{[It.spanKind]:"client",[It.httpMethod]:n,[It.httpPath]:f.pathname,[It.netPeerName]:f.hostname,[It.netPeerPort]:f.port,[It.httpScheme]:f.protocol,[It.httpRequestContentLength]:p?"string"===typeof p?ic(p):void 0:0}},(async e=>{const t=await fetch(new Request(f.toString(),{method:n,headers:m,body:p}),h);return e.span.setAttribute(It.httpStatusCode,t.status),t}))}catch(E0){throw mi({id:u,summary:"\u274c",request:g,start:s,error:E0.message}),Fi(E0)}if(v.status>=200&&v.status<400)return mi({id:u,summary:"\u2705",request:g,start:s,response:v}),await t(v);if(502===v.status||503===v.status)throw mi({id:u,summary:"\u274c",request:g,start:s,error:v.statusText}),Fi(new di(v.statusText,v.status,{},n,r,o,v.headers.get("x-request-id")??void 0));{mi({id:u,summary:"\u{1f6b8}",request:g,start:s,response:v});let e={};try{e=await v.json()}catch{}throw new di(v.statusText,v.status,e,n,r,o,v.headers.get("x-request-id")??void 0)}}catch(E0){if(Vi(E0)&&s>0&&Cc())return zi(E0)||await Ac(e),await Dc(e,t,n,r,o,i,a,s-1);throw Vi(E0)&&0===s?(zi(E0)&&Cc()&&(fi("Logout - email taken"),rt("logout",{source:"api-client-email-taken"}),Ra(E0,"email-taken"),await _c(e,!1,!0)),new ui(E0)):function(e){return Gi(e)&&ji(e)&&"Client version not allowed"===e.json?.message}(E0)?(await wc(),E0):E0}}class Oc extends di{}const xc=["asset-upload-networking","automatic-project-backups","braze","braze-content-cards","braze-in-app-messaging","child-process-canary-interval-ms","child-process-canary-timeout-ms","classic-speakers-submenu","client-event-logging","client-new-revert-logic","cloud-provider-giphy","correction-wizard","custom-fonts","draftjs-global-dom-selection","duplicate-qem-projects-to-lc","edu-nfp-plan-available","global-asset-sync","gpt-preset-blocklist","gpt-prompt-presets","json-upload-cache","l10n-beta-tags-transcription","l10n-languages-transcription","learning-rail","live-collab-commit-poll-period-seconds","live-collab-copy-local-commits-on-duplicate","live-collab-cursor-in-doc","live-collab-doc-hashing-algorithm","live-collab-in-new-storyboard-project","live-collab-only-main-commits","live-collab-restore-history","live-collab-throttle-period-ms","live-collab-sparse-mode","live-collab-worker","manage-auth-identities","manual-proxy-generation-video","media-lib-load-doc-autosave","monthly-proration-on-immediate-upgrades","multitrack-script","multiwindow","new-shared-with-me-pagination","offline-storage-location","otel-redux-trace","onboarding-checklist","overdub-promote-voice-model","overdub-training-project-uses-live-collab","overdub-unscripted-training","properties-panel-slip","publish-captivate-fm-integration","publish-castos-integration","publish-ewebinar-integration","publish-hello-audio-integration","publish-podbean-integration","publish-blubrry-integration","publish-podcast-co-integration","publish-restream-integration","publish-transistor-integration","publish-video-ask-integration","publish-wistia-integration","quick-recorder-record-and-edit","quick-recorder-version","absolute-position-playhead","redesign-drive-view-storyboard","redux-connect-impl","replace-script-track","remove-pages","reverse-trials","automatic-reverse-trials-for-new-free-drives","allow-reverse-trials-for-existing-free-drives","storyboard-new-project-checkbox","storyboard-demo-project-id","stripe-customer-portal","stripe-setup-payment-element","subscription-modal-default-to-annual","upgrade-banner-experiment","voice-from-composition","voice-id-browser-recorder","zendesk-chat","zendesk-live-chat-access-level","edit-in-descript","legacy-browser-new-template-button","cloud-library-safe-search","scene-background-color","transcription-window-minutes","transcription-window-minutes-short","demo-to-pip-url-slug","pip-embed-params","settings-redesign","fast-export-honor-client-watermark-request","storyboard-upgrade-banner","storyboard-banner-message","custom-fonts-override","create-classic-project","drive-conductor","proxy-keyframe-interval-threshold-ms","media-engine-new-fps-calculation","word-gap-over-text-cursor","duplicate-normal-project-as-new-template","sequence-track-include-transcript-toggle","timeline-pin-redesign","timeline-tools-redesign","email-subscription-groups","close-qem-on-publish","dall-e","dall-e-variations","collapsible-timeline-redesign","collapsible-timeline-default-hidden","use-canvas-state-machine","drive-invite-link","eye-contact","record-over-selection","editor-recorder-audio-input-selection-ui","export-banner","uvm-voices","uvm-language-support-check","use-cloud-aligner","smarter-drive-default","remove-recording-placeholder","use-msft-win-camera-api","remove-live-transcription-visualization","squadcast-entry-points","scene-stepping","timeline-zoomable-scrollbar","web-promote-on-download","wordless-media-ellipses-in-new-project","wordless-media-ellipses","wordless-media-ellipses-kill-switch","wordless-media-allow-correct","video-overdub-layer","direct-to-web","direct-to-demo-v-2","web-high-intent","learn-descript-projects","Learn-Descript-V2","learn-descript-version-experiment","you-tube-publish-on-web","plus-insert-button","ia-refactor","show-drive-privacy-option","server-edits-overdub-phase","ai-speech-autogen-debounce-ms","blocked-text-toolbar","screen-capture-kit-audio","eye-contact-in-prod","include-at-sign-in-speaker-label","uvm-stock-speakers","ai-speech-controls","ai-speech-controls-kill-switch","bulk-actions","disable-white-glove","query-param-allowlist","new-canvas-toolbars","layer-start-time-offset","new-pub-project-indicator","insert-from-the-script-default","insert-from-the-script-global-override","independent-rounded-corners","multi-drive-admin","labs-settings","live-collab-write-commits-buffer","playhead-and-text-cursor-together","timeline-redesign-default","timeline-redesign-global-override","timeline-redesign-labs-eligible","timeline-layer-click-in-clip-area-behavior","new-project-privacy","export-use-ffmpeg-compositor","web-media-local-export","ed-workflow-canvas-selection-scope","animation-curve-presets","hide-card-rail-eligible","hide-card-rail-default","hide-card-rail-global-override","new-media-range-picker-eligible","new-media-range-picker-default","new-media-range-picker-global-override","insert-sidebar-eligible","insert-sidebar-default","insert-sidebar-global-override"];async function kc(e){return await new Promise((t=>setTimeout((()=>t()),e)))}const Nc=Object.freeze({"hide-card-rail-eligible":!1,"hide-card-rail-default":!1,"hide-card-rail-global-override":!1,"new-media-range-picker-eligible":!1,"new-media-range-picker-default":!1,"new-media-range-picker-global-override":!1,"labs-settings":!1,"new-pub-project-indicator":!1,"new-canvas-toolbars":!1,"asset-upload-networking":"fetch","settings-redesign":!1,"automatic-project-backups":!0,braze:!1,"braze-content-cards":!1,"braze-in-app-messaging":!1,"child-process-canary-interval-ms":0,"child-process-canary-timeout-ms":0,"classic-speakers-submenu":!1,"client-event-logging":!1,"client-new-revert-logic":!0,"correction-wizard":!0,"custom-fonts":!0,"draftjs-global-dom-selection":!1,"duplicate-qem-projects-to-lc":!0,"edu-nfp-plan-available":!1,"json-upload-cache":"write","global-asset-sync":"all-assets-read-write","gpt-preset-blocklist":[],"gpt-prompt-presets":void 0,"storyboard-new-project-checkbox":!1,"learning-rail":!1,"live-collab-commit-poll-period-seconds":0,"live-collab-copy-local-commits-on-duplicate":!1,"live-collab-in-new-storyboard-project":!1,"live-collab-only-main-commits":!1,"live-collab-restore-history":!0,"live-collab-throttle-period-ms":0,"live-collab-worker":!1,"live-collab-doc-hashing-algorithm":!1,"live-collab-sparse-mode":!1,"live-collab-cursor-in-doc":!1,"manage-auth-identities":!0,"manual-proxy-generation-video":!1,"media-lib-load-doc-autosave":!0,"monthly-proration-on-immediate-upgrades":!1,"multitrack-script":!1,multiwindow:!0,"new-shared-with-me-pagination":!1,"offline-storage-location":!0,"onboarding-checklist":!1,"otel-redux-trace":!1,"overdub-promote-voice-model":"","overdub-training-project-uses-live-collab":!1,"overdub-unscripted-training":!1,"properties-panel-slip":!1,"publish-ewebinar-integration":!1,"publish-podbean-integration":!1,"publish-blubrry-integration":!1,"publish-podcast-co-integration":!1,"publish-video-ask-integration":!1,"publish-captivate-fm-integration":!1,"publish-hello-audio-integration":!1,"publish-castos-integration":!1,"publish-restream-integration":!1,"publish-wistia-integration":!1,"publish-transistor-integration":!1,"quick-recorder-record-and-edit":!1,"quick-recorder-version":1,"absolute-position-playhead":!1,"storyboard-demo-project-id":"","subscription-modal-default-to-annual":!0,"upgrade-banner-experiment":!1,"redesign-drive-view-storyboard":!1,"redux-connect-impl":"deep-equality","replace-script-track":!1,"remove-pages":!1,"voice-from-composition":!1,"voice-id-browser-recorder":"none","zendesk-chat":!1,"zendesk-live-chat-access-level":"none","l10n-languages-transcription":void 0,"l10n-beta-tags-transcription":void 0,"legacy-browser-new-template-button":!1,"cloud-provider-giphy":!1,"edit-in-descript":!0,"cloud-library-safe-search":!1,"reverse-trials":!1,"automatic-reverse-trials-for-new-free-drives":!1,"allow-reverse-trials-for-existing-free-drives":!1,"scene-background-color":!1,"transcription-window-minutes":!1,"transcription-window-minutes-short":!1,"demo-to-pip-url-slug":void 0,"pip-embed-params":void 0,"fast-export-honor-client-watermark-request":!1,"storyboard-upgrade-banner":!1,"storyboard-banner-message":"Want to try Descript Storyboard? *Copy this project to Storyboard* and explore the new features.","stripe-customer-portal":!0,"stripe-setup-payment-element":!0,"custom-fonts-override":!1,"create-classic-project":!1,"drive-conductor":!0,"proxy-keyframe-interval-threshold-ms":0,"media-engine-new-fps-calculation":!1,"word-gap-over-text-cursor":!1,"duplicate-normal-project-as-new-template":!1,"sequence-track-include-transcript-toggle":!1,"timeline-pin-redesign":!1,"timeline-tools-redesign":!1,"email-subscription-groups":!1,"close-qem-on-publish":!1,"dall-e":!1,"dall-e-variations":!1,"collapsible-timeline-redesign":!1,"collapsible-timeline-default-hidden":!0,"use-canvas-state-machine":!0,"eye-contact":!1,"drive-invite-link":!1,"record-over-selection":!1,"editor-recorder-audio-input-selection-ui":!1,"export-banner":!1,"uvm-voices":!1,"uvm-language-support-check":!0,"disable-white-glove":!1,"use-cloud-aligner":!1,"smarter-drive-default":!0,"remove-recording-placeholder":!1,"use-msft-win-camera-api":!1,"remove-live-transcription-visualization":!1,"squadcast-entry-points":!1,"scene-stepping":!1,"timeline-zoomable-scrollbar":!1,"web-promote-on-download":!1,"wordless-media-ellipses-kill-switch":!0,"wordless-media-ellipses":!1,"wordless-media-ellipses-in-new-project":!1,"wordless-media-allow-correct":!1,"video-overdub-layer":!1,"direct-to-web":!1,"direct-to-demo-v-2":void 0,"web-high-intent":"off","learn-descript-projects":void 0,"Learn-Descript-V2":void 0,"learn-descript-version-experiment":"1","you-tube-publish-on-web":!1,"plus-insert-button":!1,"ia-refactor":"control","show-drive-privacy-option":!1,"server-edits-overdub-phase":"off","ai-speech-autogen-debounce-ms":5e3,"blocked-text-toolbar":!1,"screen-capture-kit-audio":!1,"eye-contact-in-prod":!1,"include-at-sign-in-speaker-label":!1,"uvm-stock-speakers":!1,"ai-speech-controls":!1,"ai-speech-controls-kill-switch":!1,"bulk-actions":!1,"query-param-allowlist":"","layer-start-time-offset":!1,"insert-from-the-script-default":!1,"insert-from-the-script-global-override":"","independent-rounded-corners":!1,"multi-drive-admin":!1,"live-collab-write-commits-buffer":!1,"playhead-and-text-cursor-together":!1,"export-use-ffmpeg-compositor":!0,"web-media-local-export":!1,"timeline-redesign-default":!1,"timeline-redesign-global-override":!1,"timeline-redesign-labs-eligible":!1,"timeline-layer-click-in-clip-area-behavior":!1,"new-project-privacy":!0,"ed-workflow-canvas-selection-scope":!1,"animation-curve-presets":!1,"insert-sidebar-eligible":!1,"insert-sidebar-default":!1,"insert-sidebar-global-override":""});let Pc=Object.assign({},Nc);const Lc={getValue:e=>Pc[e],setOverrides(e){Object.assign(Pc,e)},clearOverrides(){Pc=Object.assign({},Nc)},getAllValues:()=>Pc};let Fc={};const Uc=class{constructor(e){this.userId=e,this.nextSyncPromise=Promise.resolve(),this.isEnabled=!1}static get(e){return this.instance||(this.instance=new Uc(e)),this.instance.userId!==e&&(this.instance.pause(),this.instance=new Uc(e)),this.instance}get nextSync(){return this.nextSyncPromise}start(){return this.isEnabled||(this.isEnabled=!0,this.nextSyncPromise=this.waitAndTrySyncAll(0)),this.nextSyncPromise}pause(){this.isEnabled=!1}async waitAndTrySyncAll(e=Uc.syncIntervalMs){if(this.isEnabled)try{e&&await kc(e),await this.syncNow(vt())}finally{this.nextSyncPromise=this.waitAndTrySyncAll().catch((e=>Ma(e)))}}async syncNow(e){const t=this.userId;try{for(const n of function*(e,t){let n=[];for(const r of e)n.push(r),n.length>=t&&(yield n,n=[]);n.length>0&&(yield n)}(xc,10))await jc(e,t,n);(function(){const e=zc(),t={},n={};for(const o of Gc){const r=e[o];r&&"object"!==typeof r&&(t[o]=String(r),void 0===n.contexts&&(n.contexts={"Feature Flags":t}))}var r;n.contexts&&(r=n,Ae.sentry&&(r.tags||r.contexts)&&Ae.sentry.configureScope((e=>{if(r.tags&&e.setTags(r.tags),r.contexts)for(const[t,n]of Object.entries(r.contexts))e.setContext(t,n??null)})))})(),function(){const e=zc(),t={};for(const n of Wc){const r=e[n];r&&"object"!==typeof r&&(t[`app.feature_flag.${n}`]=r)}Fc=t}()}catch(n){Ui(n)||Ma(n)}}};let Bc=Uc;async function jc(e,t,n=xc){if(n.length>10)throw new Error("Must have 10 or fewer feature flags");if(!Cc())return;if(void 0===t)return;const r=await async function(e,{userId:t="me",features:n}){return(await Rc(e,si.GET,`/users/${t}/feature_flags`,{flags:n.join(","),...ii()})).flags}(e,{features:n}),o=ir.featureFlags.getForAccount(t)||{},i=(0,T.Uy)(o,(e=>{for(const[t,n]of Se(r))e[t]=n})),a=i!==o;a&&ir.featureFlags.setForAccount(t,i),console.info("Feature flags synced "+(a?"(changed)":"(no change)"))}function Vc(e,t){return q===U.testRunner?Lc.getValue(e):ir.featureFlags.get()[e]??t}function zc(){return q===U.testRunner?Lc.getAllValues():ir&&ir.featureFlags&&ir.featureFlags.isSet()?{...ir.featureFlags.get(),...ir.featureFlagOverrides.get()}:{}}Bc.syncIntervalMs=3e5;const Gc=new Set(["live-collab-throttle-period-ms","multiwindow","offline-storage-location"]);const Wc=new Set(["live-collab-throttle-period-ms","multiwindow","edit-in-descript"]);function Hc(e){if(!e)return;const t=e.length;return function(){let n;const r=function(e){const t=new WeakMap;return function(n,r){if("object"!==typeof n||null===n||"object"!==typeof r||null===r)return e(n,r);const o=t.get(n)?.get(r);if(void 0!==o)return o;const i=e(n,r),a=t.get(n);return a?a.set(r,i):t.set(n,new WeakMap([[r,i]])),i}}(Me.fastDeepEqual);function o(t,o){if(!e)return;const i=e(t,o);if("function"===typeof i)throw new Error("mapStateToProps factory pattern not supported with mstpEqPreserving");if(i&&n)for(const[e,a]of Object.entries(i))"doc"!==e&&a!==n[e]&&r(a,n[e])&&(i[e]=n[e]);return n=i,i}return 1===t?function(e){return o(e)}:function(e,t){return o(e,t)}}}let qc,$c;function Kc(e){return"deep-equality"===e?Hc:void 0}const Yc=function(e,...t){return(0,Ft.$j)(function(e){if(!e)return;return 1===e.length?function(t){return void 0===$c&&($c=Vc("redux-connect-impl","deep-equality"),qc=Kc($c)),(qc?.(e)??e)(t)}:function(t,n){return void 0===$c&&($c=Vc("redux-connect-impl","deep-equality"),qc=Kc($c)),(qc?.(e)??e)(t,n)}}(e),...t)},Zc={routeChanged:oi};class Jc extends Nt.Component{constructor(e){super(e),this.routeChanged=(e,t)=>{this.props.routeChanged({path:e.pathname}),e.pathname.indexOf("//")>=0&&Ra(new Error(`Navigated to a malformed route: ${e.pathname}`),"malformed-route")},e.history.listen(this.routeChanged)}render(){return this.props.children}}const Qc=(0,jt.EN)(Yc(void 0,Zc)(Jc));var Xc=n(83932),ed=n(98075);const td=new Xc.S,nd=new Set;function rd(e,t){const n=e?`${e}/`:"";return function(e,r,o){const i=n+e;if(nd.has(i))throw new Error(`Failed create query hook: cache with name ${i} already exists`);nd.add(i);const a={...t,...o};return Object.assign((function(e,t){return 0===arguments.length?(0,ed.a)([i],(()=>r(void 0)),{...a,...t}):(0,ed.a)(e?[i,e]:[i],(e=>r(e.queryKey[1])),{...a,...t})}),{cacheName:i,prefetch:function(e){return 0===arguments.length?td.prefetchQuery([i],(()=>r(void 0)),a):td.prefetchQuery(e?[i,e]:[i],(e=>r(e.queryKey[1])),a)}})}}function od({name:e,percent_off:t,amount_off:n,valid:r,promotion_code:o}){return{name:e,percentOff:t||0,amountOff:n?n/100:0,valid:r,promotionCode:o}}function id(e,t){if(!e)return;const{valid:n,percentOff:r,amountOff:o}=e;return n?r?t*(1-r/100):o?Math.max(0,t-o):void 0:void 0}var ad=n(6619),sd=n(6219);function cd(e){return Math.trunc(e/60%60)}function dd(e){return Math.trunc(e%60)}function ld(e){return Math.trunc(1e3*e%1e3)}function ud(e){return Math.trunc(e/3600)}function fd(e){return e>=3600}function md(e){return e>=60}function pd(e,t,n=.001){return e&&t?Math.abs(e/t-1)<=n:e===t||0===e&&void 0===t||void 0===e&&0===t}const gd=1/44100;function hd(e,t,n){let r=gd,o=-22675736961451248e-21;void 0!==n&&44100!==n&&(r=1/n,o=-r);const i=e-t;return i<r&&i>o}function vd(e,t,n){return e<t&&!hd(e,t,n)}function Ed(e,t,n){return e<=t||hd(e,t,n)}function yd(e,t,n){return e>t&&!hd(e,t,n)}function Sd(e,t,n){return e>=t||hd(e,t,n)}function Id(e,t){return`${e}`.padStart(t,"0")}function bd(e,t=!1){const n=dd(e),r=cd(e),o=0===r?`${n}s`:"";if(t||fd(e)){return`${ud(e)}h ${r}m ${o}`.trim()}return r>0?`${r}m ${o}`.trim():o}function Td(e,t=!1){const n=cd(e);if(t||fd(e)){return`${ud(e)}h ${n}m`}return`${n}m`}function wd(e,t=!1,n=!0,r=!0,o=!0,i=!1){const a=e<0,s=Math.abs(e);let c,d="";d=a?"-":i?"+":"";const l=ud(s);(l>0||t)&&(c=n?Id(l,2):l);const u=cd(s),f=dd(s),m=r||c,p=o||m,g=m||c?Id(u,2):u,h=p||u>0?Id(f,2):f;return void 0===c?`${d}${g}:${h}`:`${d}${c}:${g}:${h}`}function Cd({signedTime:e,forceHours:t=!1,forceMinutes:n=!0,padMinutes:r=!0,padSeconds:o=!0,forceSign:i=!1,msSeparator:a=".",msDigits:s=3}){const c=e<0,d=Math.abs(e);let l="";l=c?"-":i?"+":"";const u=t||fd(d),f=r||u,m=cd(d),p=f?Id(m,2):m,g=n||m>0,h=o||g,v=dd(d),E=h?Id(v,2):v,y=Id(ld(d),3).substr(0,s);let S;if(u){S=`${l}${Id(ud(d),2)}:${p}:${E}`}else S=g?`${l}${p}:${E}`:`${l}${E}`;return{string:`${S}${a}${y}`,HHMMSS:S,mmmWithSeparator:`${a}${y}`}}function _d(e,t=!1,n=3,r=!1){if(0===e)return"0s";const o=e<0,i=Math.abs(e);let a="";o?a="-":r&&(a="+");const s=ud(i),c=cd(i),d=dd(i),l=ld(i);let u=a;return 0!==s&&(u+=`${s}h`),0!==c&&(u+=`${c}m`),0===d||0!==l&&t?0!==l&&t&&(u+=`${(d+l/1e3).toFixed(n)}s`):u+=`${d}s`,u}function Ad(e,t=!1){if("number"===typeof e&&(e=Md(e)),Rd(e))return"0 minutes";const{hours:n,minutes:r,seconds:o}=e,i=n>0?`${n} hour${1===n?"":"s"}`:"",a=r>0?`${r} minute${1===r?"":"s"}`:"";let s="";return t&&o>0&&(s=`${o} second${1===o?"":"s"}`),`${i}${i&&a?" ":""}${a}${(i||a)&&s?" ":""}${s}`}function Rd({hours:e,minutes:t,seconds:n,milliseconds:r}){return 0===e&&0===t&&0===n&&0===r}function Md(e){return{hours:ud(e),minutes:cd(e),seconds:dd(e),milliseconds:ld(e)}}const Dd=/^\s*(\d+)[\s:]*([^\s\d:]+)?[\s:]*(\d+)?[\s:]*([^\s\d:]+)?[\s:]*(\d+)?[\s:]*([^\s\d:]+)?[\s:]*(\d+)?[\s:]*$/;function Od(e,t){const n=parseInt(e,10);if(!isNaN(n))return"hours".startsWith(t)?{hours:n}:"minutes".startsWith(t)?{minutes:n}:"seconds".startsWith(t)?{seconds:n}:"ms".startsWith(t)?{milliseconds:n}:void 0}const xd={hours:0,minutes:0,seconds:0,milliseconds:0};function kd(e){return{...xd,...e}}function Nd(e){return void 0===e?"":"minutes".startsWith(e)?"h":"seconds".startsWith(e)?"m":"ms".startsWith(e)?"s":""}function Pd(e){return"hours".startsWith(e)?"m":"minutes".startsWith(e)?"s":void 0}function Ld(e){const t=Dd.exec(e);if(!t)return;const n=t.indexOf(".");if(n>=0){const e=n+2,r=t[e-1];if(void 0!==r){t[e-1]=r.padEnd(3,"0"),t[e]="ms",t[n]="s";for(let e=n-2;e>=2;e--){const n=t[e];t[e]=n||Nd(t[e+2])}}else t[n]=void 0}let[,r,o,i,a,s,c,d,l]=t;return r?(o||a||c||(i||s?s?(o="h",a="m",c="s"):(o="m",a="s"):o="m"),o&&!a&&(a=Pd(o)),a&&!c&&(c=Pd(a)),[[r,o],[i,a],[s,c],[d,l]].reduce(((e,[t,n])=>({...e,...void 0!==t&&void 0!==n&&Od(t,n)})),xd)):void 0}function Fd({hours:e,minutes:t,seconds:n,milliseconds:r}){return 3600*e+60*t+n+r/1e3}const Ud=["descript_free","descript_education_orgs","descript_creator","descript_pro","descript_enterprise"];function Bd({start_date:e,end_date:t,product_group:n,seats:r,base_hours:o,extra_hours:i,interval:a}){return{startDate:new Date(e),endDate:new Date(t),productGroup:n,seats:r,baseHours:o,extraHours:i,interval:a}}function jd({unit_amount:e,up_to:t}){return{unitAmount:e,upTo:t}}function Vd({max_seats:e,max_voice_permissions_per_user:t}){return{maxSeats:e,maxVoicePermissionsPerUser:t}}function zd({product_group:e,product_group_name:t,interval:n,seats:r=0,hours_included:o=0,extra_hours:i=0,subscription_start_date:a,subscription_ends_on_date:s,subscription_paused_until_date:c,subscription_status:d,trial_end_date:l,current_period_start_date:u,current_period_end_date:f,minute_refresh_date:m,scheduled_phases:p,supports_overdub:g,limits:h,price_tiers:v,coupon:E,pending_action_redirect_url:y}){return{productGroup:e,productGroupName:t,interval:n,seats:r,hoursIncluded:o,extraHours:i,nextPhase:2===p?.length?Bd(p[1]):void 0,subscriptionStartDate:a?new Date(a):void 0,subscriptionEndDate:s?new Date(s):void 0,subscriptionPausedUntilDate:c?new Date(c):void 0,subscriptionStatus:d,trialEndDate:l?new Date(l):void 0,currentPeriodStartDate:u?new Date(u):void 0,currentPeriodEndDate:f?new Date(f):void 0,minuteRefreshDate:m?new Date(m):void 0,supportsOverdub:g,limits:h&&Vd(h),priceTiers:v?.map(jd),coupon:E&&od(E),pendingActionRedirectUrl:y}}function Gd({productGroup:e}){return function(e){return"descript_education_orgs"===e?"org":e.replace(/\s*descript_\s*/gi,"").trim()}(e)}function Wd(e){return"descript_education_orgs"===e?"EDU/NFP":J(e.replace("descript_",""))}function Hd(e){return e.replace(/\s*Descript\s*|\s*for\s*/gi,"").trim()}function qd(e){return"year"===e?"Annual":"day"===e?"Daily":"Monthly"}function $d(e){return"descript_pro"===e||"descript_enterprise"===e}function Kd(e){return"descript_free"!==e}function Yd(e){return!!e&&Kd(e.productGroup)&&void 0!==e.subscriptionStatus&&["active","trialing","past_due"].includes(e.subscriptionStatus)}function Zd({hoursIncluded:e,extraHours:t}){return e+t}async function Jd(e,t){try{return zd(await Rc(e,si.GET,`/drives/${t}/product`))}catch(n){if(404===n.statusCode)return await Promise.resolve(void 0);throw n}}async function Qd(e,t,n){return zd(await Rc(e,si.POST,`/drives/${t}/product`,void 0,n))}function Xd(e){if(!e?.trialEndDate)return;const t=(0,ad.Z)(e.trialEndDate,new Date);if(!(t<0)){if(0===t){return Ad(60*(0,sd.Z)(e.trialEndDate,new Date))}return`${t} day${1===t?"":"s"}`}}var el=n(66113);const tl=(e,t)=>be(e.name,t.name),nl=(e,t)=>{const n=e.id,r=t.id;return n<r?Ie.OrderedAscending:n>r?Ie.OrderedDescending:Ie.OrderedSame};var rl=(e=>(e.DriveWorkspace="Drive Workspace",e.PrivateWorkspace="Private Workspace",e.LegacyMyWorkspace="My Workspace",e))(rl||{}),ol=(e=>(e.PERSONAL="personal",e.DRIVE="drive",e.RESTRICTED="restricted",e))(ol||{});function il(e,t){return`${t.charAt(0)}-${e}`}var al=(e=>(e.None="none",e.View="view",e.Comment="comment",e.Edit="edit",e))(al||{});const sl={none:0,view:1,comment:2,edit:3};function cl(e,t){return sl[e]>=sl[t]}function dl(e){return{assetId:e.asset_id,artifactId:e.artifact_id,readUrl:e.read_url,status:e.status}}function ll(e){return{asset_id:e.assetId,artifact_id:e.artifactId,read_url:e.readUrl,status:e.status}}function ul(e){return{compositionId:e.composition_id,cardId:e.card_id,name:e.name,description:e.description,previewImage:e.preview_image?dl(e.preview_image):void 0,previewVideo:e.preview_video?dl(e.preview_video):void 0}}function fl(e){return{composition_id:e.compositionId,card_id:e.cardId,name:e.name,description:e.description,preview_image_timestamp_ms:e.previewImageTimestampMs,preview_image:e.previewImage?ll(e.previewImage):void 0,preview_video:e.previewVideo?ll(e.previewVideo):void 0}}function ml(e){const t=e.contents?function(e){if(void 0!==e.cards)return{description:e.description,author:e.author,cards:e.cards.map(ul),templatePreviewVideo:e.template_preview_video?dl(e.template_preview_video):void 0,documentVersion:e.document_version}}(e.contents):void 0;return void 0===t||void 0===e.version_id||void 0===e.is_public?{}:{contents:t,versionId:e.version_id,isPublic:e.is_public,galleryOrder:e.gallery_order}}function pl(e){const t=e.contents?function(e){if(void 0!==e.cards)return{description:e.description,author:e.author,cards:e.cards.map(fl),template_preview_video:e.templatePreviewVideo?ll(e.templatePreviewVideo):void 0,document_version:e.documentVersion}}(e.contents):void 0;return void 0===t||void 0===e.versionId?{}:{contents:t,version_id:e.versionId,is_public:e.isPublic??!1,gallery_order:e.galleryOrder}}function gl(e,t){return e.compositionId===t.compositionId&&e.cardId===t.cardId&&e.name===t.name&&e.description===t.description&&e.previewImage?.artifactId===t.previewImage?.artifactId&&e.previewImage?.assetId===t.previewImage?.assetId&&e.previewVideo?.artifactId===t.previewVideo?.artifactId&&e.previewVideo?.assetId===t.previewVideo?.assetId}al.None,al.None,al.None,al.Comment,al.View,al.Comment;function hl(e){if(void 0!==e&&void 0!==e.composition_summaries&&void 0!==e.composition_count&&void 0!==e.total_project_size_bytes)return{compositionSummaries:e.composition_summaries,compositionCount:e.composition_count,totalProjectSizeBytes:e.total_project_size_bytes}}function vl(e){if(void 0!==e&&void 0!==e.compositionSummaries&&void 0!==e.compositionCount&&void 0!==e.totalProjectSizeBytes)return{composition_summaries:e.compositionSummaries,composition_count:e.compositionCount,total_project_size_bytes:e.totalProjectSizeBytes}}var El=(e=>(e.Public="public",e.Admin="admin",e.Descript="descript",e.Decentral="decentral",e))(El||{}),yl=(e=>(e.Owner="owner",e.Collaborator="collaborator",e.Tester="tester",e))(yl||{});class Sl{constructor(e="",t="",n="",r="tester"){this.id=e,this.projectId=t,this.userId=n,this.role=r}equals(e){return this.id===e.id&&this.projectId===e.projectId&&this.userId===e.userId&&this.role===e.role}static fromJson(e){return new Sl(e.id,e.sku,e.user_id,e.role)}static toJSON(e){return{id:e.id,sku:e.projectId,user_id:e.userId,role:e.role}}static sortOwnerships(e,t){return e.role===t.role?0:"owner"===e.role?-1:"owner"===t.role?1:"collaborator"===e.role?-1:1}static ownershipsEqual(e,t){const n=e.length;if(n!==t.length)return!1;const r=e.sort(nl),o=t.sort(nl);for(let i=0;i<n;i++)if(!r[i].equals(o[i]))return!1;return!0}}const Il=class{constructor(e="no-id",t="anonymous@descript.com",n="",r="",o=["public"],i,a,s=0,c=0,d="",l="",u=new Date,f,m,p,g,h={},v){this.id=e,this.email=t,this.firstName=n,this.lastName=r,this.roles=o,this.profileImageUrl=i,this.profileImageCdnUrl=a,this.freeTranscriptionMinutes=s,this.availablePrepaidMinutes=c,this.referralCode=d,this.referralTargetId=l,this.createdAt=u,this.userGroup=f,this.appUseCases=m,this.gclid=p,this.reverseTrialStartedAt=g,this.syncState=h,this.ownerships=v}static ColorForUserId(e,t,n){const r=Il.ColorMapping[e];if(r&&!n)return r;let o=0;for(let i=0;i<e.length;i++)o+=Math.pow(31*e.charCodeAt(i),e.length-i),o&=o;if(t){const t=n?Il.BaseSolidColors:Il.BaseColors,r=t[Math.abs(o)%t.length]||n&&Il.DefaultSolidColor||Il.DefaultColor;return n||(Il.ColorMapping[e]=r),r}{const t=Math.abs(o)%Il.BaseColorsOld.length;let n=Il.BaseColorsOld[t];return n||(n=Il.DefaultColorOld),Il.ColorMapping[e]=Il.BaseColorsOld[t],n}}static shallowCopy(e){return new Il(e.id,e.email,e.firstName,e.lastName,e.roles,e.profileImageUrl,e.profileImageCdnUrl,e.freeTranscriptionMinutes,e.availablePrepaidMinutes,e.referralCode,e.referralTargetId,e.createdAt,e.userGroup,e.appUseCases,e.gclid,e.reverseTrialStartedAt,e.syncState,e.ownerships)}static fromJson(e){const t=e.created_at?new Date(e.created_at):new Date,n=e.reverse_trial_started_at?new Date(e.reverse_trial_started_at):void 0;return new Il(e.id,e.email,e.first_name,e.last_name,e.roles,e.profile_image_url,e.profile_image_cdn_url,e.free_transcription_minutes,e.available_prepaid_minutes,e.referral_code,e.referral_target_id,t,e.user_group,e.app_use_cases,e.gclid,n)}static toJSON(e){return{id:e.id,created_at:e.createdAt.toISOString(),email:e.email,first_name:e.firstName,last_name:e.lastName,roles:e.roles,profile_image_url:e.profileImageUrl,profile_image_cdn_url:e.profileImageCdnUrl,free_transcription_minutes:e.freeTranscriptionMinutes,available_prepaid_minutes:e.availablePrepaidMinutes,referral_code:e.referralCode,referral_target_id:e.referralTargetId,user_group:e.userGroup,app_use_cases:e.appUseCases,gclid:e.gclid,reverse_trial_started_at:e.reverseTrialStartedAt?.toISOString()}}equalsUser(e){return this.id===e.id}equals(e){return this.equalsUser(e)}hasRole(e){return this.roles.indexOf(e)>=0}ownsProject(e){return Boolean(this.ownerships?.some((t=>t.projectId===e)))}permissionsForProject(e){if(e.owner?.id===this.id)return{hasEditorPermissions:!0,hasOwnerPermissions:!0};const t=this.ownerships?.find((t=>t.projectId===e.id)),n="owner"===t?.role;return{hasEditorPermissions:n||"collaborator"===t?.role,hasOwnerPermissions:n}}get name(){return`${this.firstName||""} ${this.lastName||""}`.trim()}get initials(){return(this.firstName||"").charAt(0)+(this.lastName||"").charAt(0)}get referralLink(){return`https://descript.com/r/${this.referralCode}`}color(e,t,n){return e?Il.DefaultColor:Il.ColorForUserId(this.id,t,n)}userSummary(){return new Il(this.id,this.email,this.firstName,this.lastName)}jsonUserSummary(){return{id:this.id,email:this.email,first_name:this.firstName,last_name:this.lastName,roles:this.roles,created_at:this.createdAt.toISOString()}}pubnubUserSummary(){return{id:this.id,email:this.email,first_name:this.firstName,last_name:this.lastName,...void 0!==this.profileImageCdnUrl?{profile_image_cdn_url:this.profileImageCdnUrl}:{}}}analyticsSummary(){const e={use_case_audiograms:!1,use_case_transcription:!1,use_case_video_editing:!1,use_case_screen_recording:!1,use_case_podcasting:!1,use_case_overdub:!1,use_case_storyboard_onboarding:!1};if(this.appUseCases){JSON.parse(this.appUseCases).forEach((t=>{e["use_case_"+t]=!0}))}return{id:this.id,email:this.email,first_name:this.firstName,last_name:this.lastName,name:this.name,admin:this.hasRole("admin"),created_at:this.createdAt.toISOString(),free_transcription_minutes:this.freeTranscriptionMinutes,referral_code:this.referralCode,user_group:this.userGroup,gclid:this.gclid,...e}}};let bl=Il;bl.ColorMapping={},bl.BaseColors=["var(--orange-500-a)","var(--amber-500-a)","var(--green-500-a)","var(--cyan-500-a)","var(--blue-500-a)","var(--purple-500-a)","var(--pink-500-a)","var(--red-500-a)"],bl.BaseSolidColors=["var(--orange-200)","var(--amber-200)","var(--green-200)","var(--cyan-200)","var(--blue-200)","var(--purple-200)","var(--pink-200)","var(--red-200)"],bl.BaseColorsOld=["#5ECC5C","#00D1B2","#3AB2FF","#5978FF","#9166FF","#D82292","#FF365B","#FF8519","#FFB400"],bl.DefaultSolidColor="var(--blue-200)",bl.DefaultColor="var(--blue-500-a-base)",bl.DefaultColorOld="#222430";const Tl="Untitled Project";class wl{constructor({id:e="",driveId:t="",workspaceId:n="",name:r="Untitled Project",createdAt:o=new Date,owner:i,isNew:a=!0,permissions:s={publicAccess:al.None,driveAccess:al.None},parentFolderId:c=null,lastViewedAt:d,lastUpdatedAt:l,sourceProjectId:u,editorVariant:f,isLiveCollabEnabled:m,isStoryboardEnabled:p,template:g,recentMetadata:h,thumbnailUrl:v}){this.id=e,this.driveId=t,this.workspaceId=n,this.name=r,this.createdAt=o,this.owner=i,this.isNew=a,this.permissions=s,this.parentFolderId=c,this.lastViewedAt=d,this.lastUpdatedAt=l,this.sourceProjectId=u,this.editorVariant=f,this.isLiveCollabEnabled=m,this.isStoryboardEnabled=p,this.template=g,this.recentMetadata=h,this.thumbnailUrl=v}get isTemplate(){return void 0!==this.template}get isPublishedTemplate(){return void 0!==this.template&&Object.keys(this.template).length>0}equals(e){return this.owner?.id===e.owner?.id&&this.id===e.id&&this.driveId===e.driveId&&this.workspaceId===e.workspaceId&&this.name===e.name&&this.createdAt.getTime()===e.createdAt.getTime()&&this.isNew===e.isNew&&this.permissions.publicAccess===e.permissions.publicAccess&&this.permissions.driveAccess===e.permissions.driveAccess&&this.parentFolderId===e.parentFolderId&&this.lastViewedAt?.getTime()===e.lastViewedAt?.getTime()&&this.lastUpdatedAt?.getTime()===e.lastUpdatedAt?.getTime()&&this.sourceProjectId===e.sourceProjectId&&this.editorVariant===e.editorVariant&&this.isLiveCollabEnabled===e.isLiveCollabEnabled&&this.isStoryboardEnabled===e.isStoryboardEnabled&&this.template?.versionId===e.template?.versionId&&this.template?.isPublic===e.template?.isPublic&&this.template?.galleryOrder===e.template?.galleryOrder&&function(e,t){if(void 0===e||void 0===t)return void 0===e&&void 0===t;if(e.cards?.length!==t.cards?.length)return!1;if(e.cards&&t.cards)for(let n=0;n<e.cards.length;n++)if(void 0===t.cards[n]||!gl(e.cards[n],t.cards[n]))return!1;return e.description===t.description&&e.author===t.author&&e.templatePreviewVideo?.artifactId===t.templatePreviewVideo?.artifactId&&e.templatePreviewVideo?.assetId===t.templatePreviewVideo?.assetId&&e?.documentVersion===t?.documentVersion}(this.template?.contents,e.template?.contents)&&(t=this.recentMetadata,n=e.recentMetadata,void 0===t||void 0===n?void 0===t&&void 0===n:t.compositionCount===n.compositionCount&&t.totalProjectSizeBytes===n.totalProjectSizeBytes&&t.compositionSummaries.length===n.compositionSummaries.length&&t.compositionSummaries.every(((e,t)=>function(e,t){return e.id===t.id&&e.name===t.name&&e.duration===t.duration&&e.media_type===t.media_type}(e,n.compositionSummaries[t]))))&&this.thumbnailUrl===e.thumbnailUrl;var t,n}shallowCopy(){return new wl({id:this.id,driveId:this.driveId,workspaceId:this.workspaceId,name:this.name,createdAt:this.createdAt,owner:this.owner,isNew:this.isNew,permissions:{publicAccess:this.permissions.publicAccess,driveAccess:this.permissions.driveAccess},parentFolderId:this.parentFolderId,lastViewedAt:this.lastViewedAt,lastUpdatedAt:this.lastUpdatedAt,sourceProjectId:this.sourceProjectId,editorVariant:this.editorVariant,isLiveCollabEnabled:this.isLiveCollabEnabled,isStoryboardEnabled:this.isStoryboardEnabled,template:this.template,recentMetadata:this.recentMetadata,thumbnailUrl:this.thumbnailUrl})}static fromJson(e){const t=e.created_at?new Date(e.created_at):new Date,n=e.last_viewed_at?new Date(e.last_viewed_at):void 0,r=e.last_updated_at?new Date(e.last_updated_at):void 0;let o;e.owner&&(o=bl.fromJson(e.owner));const i=e.permissions&&{publicAccess:e.permissions.public_access||al.None,driveAccess:e.permissions.member_access||al.None},a=e.in_recordings_folder&&e.drive_id?Wn(e.drive_id):e.parent_id;return new wl({id:e.id,driveId:e.drive_id,workspaceId:e.drive_id&&i?il(e.drive_id,i.driveAccess===al.None?ol.PERSONAL:ol.DRIVE):void 0,name:e.name,createdAt:t,owner:o,isNew:!1,permissions:i,parentFolderId:a,lastViewedAt:n,lastUpdatedAt:r,sourceProjectId:e.source_project_id,editorVariant:e.editor_variant,isLiveCollabEnabled:e.is_live_collab_enabled,isStoryboardEnabled:e.is_storyboard_enabled,template:e.template?ml(e.template):void 0,recentMetadata:hl(e.recent_metadata),thumbnailUrl:e.thumbnail_url})}static toJSON(e){let t;e.owner&&(t=bl.toJSON(e.owner));const n={public_access:e.permissions.publicAccess,member_access:e.permissions.driveAccess};return{id:e.id,drive_id:e.driveId,name:e.name,owner:t,created_at:e.createdAt.toISOString(),permissions:n,parent_id:e.parentFolderId,last_viewed_at:e.lastViewedAt?.toISOString(),last_updated_at:e.lastUpdatedAt?.toISOString(),source_project_id:e.sourceProjectId,editor_variant:e.editorVariant,is_live_collab_enabled:e.isLiveCollabEnabled,is_storyboard_enabled:e.isStoryboardEnabled,template:e.template?pl(e.template):void 0,recent_metadata:vl(e.recentMetadata),thumbnail_url:e.thumbnailUrl}}static sortByOwner(e,t){return e.owner&&t.owner?function(...e){return function(t,n){for(const r of e){const e=r(t,n);if(e!==Ie.OrderedSame)return e}return Ie.OrderedSame}}(tl,nl)(e.owner,t.owner):e.owner?Ie.OrderedAscending:t.owner?Ie.OrderedDescending:Ie.OrderedSame}static latestRevision(e){let t;for(const n of e)t&&1!==wl.sortByIsNewRevisionNumber(n,t)||(t=n);return t}static getCloudBaseRevisionId(e,t){const n=new Map;for(const o of e)n.set(o.revisionId,o);let r=t;for(;r.isNew;){if(void 0===r.baseRevisionId)return void(1!==r.revisionNumber&&Ra(new Error(`Local revision ${r.revisionId} has no base revision`),"get-cloud-base-revision",{extra:{projectId:r.projectId}}));const e=n.get(r.baseRevisionId);if(void 0===e)return r.baseRevisionId;r=e}return r.revisionId}static latestCloudRevision(e){let t;for(const n of e)!n.isNew&&(!t||n.revisionNumber>t.revisionNumber||n.revisionNumber===t.revisionNumber&&n.createdAt>t.createdAt)&&(t=n);return t}static sortByIsNewRevisionNumber(e,t){return e.isNew!==t.isNew?t.isNew?-1:1:t.revisionNumber>e.revisionNumber?-1:e.revisionNumber>t.revisionNumber?1:t.createdAt>e.createdAt?-1:e.createdAt>t.createdAt?1:0}static isDefaultName(e){return e===Tl||"Untitled Template"===e}}function Cl(e){return e.auth.user}function _l(e){return Boolean(Cl(e))}function Al(e){return Cl(e)?.id}function Rl(e){return e.auth.deleteUserError}function Ml(e){return!!Cl(e)?.hasRole(El.Admin)}function Dl(e){return e.auth.card}function Ol(e){return e.auth.errorCreditCard}function xl(e){return e.auth.errorEmail}function kl(e){return e.auth.dataConsentInfo}function Nl({id:e,name:t}){return{id:e,name:t}}function Pl({id:e,voiceId:t,userId:n,access:r,driveId:o,user:i,voice:a}){return{id:e,voice_id:t,user_id:n,access:r,billing_drive_id:o,user:i&&bl.toJSON(i),voice:a&&Nl(a)}}function Ll(e,t){return function(e,t){return e.ownerId===t}(e,t)||"manage"===e.access}const Fl=["free","editor"];var Ul=(e=>(e.all="all",e.admins="admins",e.editors="editors",e.basic="basic",e))(Ul||{});function Bl(e,t){if(t)return"Owner";switch(e){case"editor":return"Editor";case"free":return"Basic";default:return"Unknown"}}function jl({id:e,drive_id:t,user:n,type:r}){return{id:e,driveId:t,user:bl.fromJson(n),type:r}}function Vl({id:e,driveId:t,user:n,type:r}){return{id:e,drive_id:t,user:bl.toJSON(n),type:r}}var zl=(e=>(e.notPublic="not_public",e.none="none",e))(zl||{});function Gl({id:e,owner_id:t="",name:n,seats:r,drive_logo_url:o="",drive_logo_cdn_url:i,memberships:a,member_roles:s,free_transcription_minutes:c=0,available_prepaid_minutes:d=0,editor_invites_require_approval:l,window_minutes:u=0,subscription_info:f,voice_seats:m=0,voice_permissions:p,share_custom_branding:g,qem_privacy_default:h,new_project_privacy_default:v,current_product:E}){return{id:e,ownerId:t,name:n,seats:r,logoUrl:o,logoCdnUrl:i,memberships:a?.map(jl),memberRoles:s,freeTranscriptionMinutes:c,availablePrepaidMinutes:d,editorInvitesRequireApproval:l,windowMinutes:u,subscriptionStatus:f?.state,shareCustomBranding:g,voiceSeats:m,voicePermissions:void 0,qemPrivacyDefault:h??"public",newProjectPrivacyDefault:v??"none",currentProduct:E}}function Wl({id:e,ownerId:t,name:n,seats:r,logoUrl:o,logoCdnUrl:i,shareCustomBranding:a,memberships:s,memberRoles:c,freeTranscriptionMinutes:d,availablePrepaidMinutes:l,editorInvitesRequireApproval:u,windowMinutes:f,subscriptionStatus:m,voiceSeats:p,voicePermissions:g,qemPrivacyDefault:h,newProjectPrivacyDefault:v,currentProduct:E}){return{id:e,owner_id:t,name:n,seats:r,drive_logo_url:o,share_custom_branding:a,drive_logo_cdn_url:i,memberships:s?.map(Vl),member_roles:c,free_transcription_minutes:d,available_prepaid_minutes:l,editor_invites_require_approval:u,window_minutes:f,subscription_info:m?{state:m}:void 0,voice_seats:p,voice_permissions:g?.map(Pl),qem_privacy_default:h,new_project_privacy_default:v,current_product:E}}function Hl(e){return Boolean(Vc("multi-drive-admin"))&&"descript_enterprise"===e.currentProduct}function ql({drive:e,userId:t}){return e.ownerId===t}function $l({drive:e,userId:t,isEnabled:n}){return!!ql({drive:e,userId:t})||!(!n&&!Hl(e))&&(e.memberRoles[t]?.includes("admin")??!1)}function Kl(e,t,n,r){if(void 0===e.memberships)return[];const o=function(e){if(!e)return()=>!0;const t=e.toLowerCase();return e=>e.user.name.toLowerCase().includes(t)||e.user.email.toLowerCase().includes(t)}(r),i=Hl(e);return e.memberships.map((n=>({...n,isCurrentUser:n.user.id===t,isDriveOwner:ql({drive:e,userId:n.user.id}),isDriveAdmin:$l({drive:e,userId:n.user.id,isEnabled:i})}))).filter((e=>(e=>!n||("admins"===n?e.isDriveAdmin:"editors"===n?"editor"===e.type:"basic"!==n||"free"===e.type))(e)&&o(e))).sort(((e,t)=>e.isCurrentUser?Ie.OrderedAscending:t.isCurrentUser?Ie.OrderedDescending:e.isDriveOwner?Ie.OrderedAscending:t.isDriveOwner?Ie.OrderedDescending:e.isDriveAdmin?Ie.OrderedAscending:t.isDriveAdmin?Ie.OrderedDescending:e.type!==t.type?"editor"===e.type?Ie.OrderedAscending:Ie.OrderedDescending:be(e.user.name,t.user.name)))}var Yl=n(63184),Zl=n.n(Yl);const Jl=(0,el.createSelector)(Al,(e=>e.drive.drives),((e,t)=>void 0===e?[]:Object.values(t).filter((t=>t.memberships?.some((({user:{id:t}})=>t===e)))).sort(tl))),Ql=(0,el.createSelector)(Jl,(e=>new Set(e.map((e=>e.id)))));function Xl(e){const t=Ql(e);return t.size?Array.from(t.values())[0]:void 0}function eu(e,t){return Ql(e).has(t)}const tu=(0,el.createSelector)([Cl,Jl],((e,t)=>{if(!e)return;const n=t.filter((t=>ql({drive:t,userId:e.id})));return n.length?n:void 0})),nu=(0,el.createSelector)([Cl,Jl],((e,t)=>{if(!e)return;const n=t.filter((t=>$l({drive:t,userId:e.id})));return n.length?n:void 0}));function ru(e,t){return e.drive.drives[t]}const ou=(0,Yl.createCachedSelector)(ru,(e=>e?.memberships?.map((({user:e})=>e))))(((e,t)=>t)),iu=(0,Yl.createCachedSelector)(ru,(e=>e?.newProjectPrivacyDefault))(((e,t)=>t));function au(e,t){const n=Cl(e);if(!n)return!1;const r=ru(e,t);return!!r&&ql({drive:r,userId:n.id})}function su(e,t){const n=Cl(e);if(!n)return!1;const r=ru(e,t);return!!r&&$l({drive:r,userId:n.id})}function cu(e,t,n){const r=Al(e);if(!r)return!1;const o=ru(e,t)?.memberships;if(!o)return!1;return o.some((e=>e.id===n&&e.user.id===r))}function du(e,t){return e.drive.invites[t]}function lu(e,t){return e.drive.pendingDriveMembershipUpgradeRequests[t]?.upgradeRequests}function uu(e,t){return e.drive.driveFonts[t]}function fu(e,t){const n=[],r=e.length;for(let o=0;o<r;o++){const r=t(e[o],o,e);void 0!==r&&n.push(r)}return n}function mu(e,t,n){const r=e.length;for(let o=t;o<r;o++)if(n(e[o]))return o}function pu(e,t){return t<e.length?e.slice(0,t):e}function gu(e,t,n,r){let o;return e&&e.length>0&&(o=e),t&&t.length>0&&(o=o?o.concat(t):t),n&&n.length>0&&(o=o?o.concat(n):n),r&&r.length>0&&(o=o?o.concat(r):r),o||e||t||n||r}function hu(e,t){let n;const r=e.length;for(let o=0;o<r;o++){const r=e[o],i=t(r,o);i!==r&&(n||(n=Array.from(e)),n[o]=i)}return n||e}function vu(e,t){return Eu(e,((e,n)=>t(e,n)?e:void 0))}function Eu(e,t){let n;const r=e.length;for(let o=0;o<r;o++){const r=e[o],i=t(r,o);i===r&&void 0!==i||n||(n=e.slice(0,o)),n&&void 0!==i&&n.push(i)}return n||e}function yu(e){return Array.isArray(e)?e:[e]}function Su(e,t){const n=new Set;return vu(e,(e=>{const r=t(e);return!n.has(r)&&(n.add(r),!0)}))}const Iu=[];function bu(){return Iu}function Tu(e){return e?.length?e:Iu}var wu=n(78366),Cu=n.n(wu),_u=n(4757),Au=n.n(_u),Ru=n(55669),Mu=n.n(Ru);function Du({isBlocked:e}){return e?{blocked:!0}:{}}function Ou({blocked:e}){return{isBlocked:e||!1}}var xu=(e=>(e.document="document",e.folder="folder",e.model="model",e.track="scene",e.highlighter="highlighter",e.speaker="voice",e.timeline="timeline",e.voiceoverTrack="voiceoverTrack",e.voiceoverMetadataTrackComponentList="voiceoverMetadataTrack",e.noAudioTrackComponentList="noAudioTrack",e.superTau="superTau",e.tau="tau",e.pause="pause",e.voiceComponent="voiceComponent",e.markerComponent="markerComponent",e.inlineNoteComponent="inlineNoteComponent",e.mediaSegment="mediaSegment",e.audioSegment="audioSegment",e.voiceoverAudioSegment="voiceoverAudioSegment",e.mediaAudioReference="mediaAudioReference",e.mediaVideoReference="mediaVideoReference",e.mediaImageReference="mediaImageReference",e.mediaLibrary="mediaLibrary",e.mediaVoiceoverReference="mediaVoiceoverReference",e.mediaFontReference="mediaFontReference",e.pinTrackComponentList="pinsTrack",e.pinComponent="sceneComponent",e.cueTrackComponentList="cueTrack",e.cueComponent="cueComponent",e.cardTrackComponentList="cardTrack",e.cardBoundaryComponent="cardBoundaryComponent",e.cardLayer="cardLayer",e.effect="effect",e.storyboardCue="storyboardCue",e.baseTrackComponent="trackComponent",e.baseTrack="track",e.ref="ref",e.notEncoded="",e.segment="segment",e.annotationComponent="annotationComponent",e.annotationTrack="annotationTrack",e))(xu||{});const ku=["mediaVoiceoverReference","mediaAudioReference","mediaVideoReference","mediaImageReference","mediaFontReference"];function Nu({type:e,id:t=Ps(),offsetFromBaseTime:n=0,offsetFromAnchor:r=0,tauAnchor:o,sortTiebreaker:i=Date.now()/1e3,isBlocked:a=!1}){return{type:e,id:t,offsetFromBaseTime:n,offsetFromAnchor:r,tauAnchor:o,sortTiebreaker:i,isBlocked:a,baseType:xu.baseTrackComponent,shortName:"component"}}function Pu(e,t){const{type:n,tauAnchor:r,offsetFromBaseTime:o,offsetFromAnchor:i,sortTiebreaker:a,id:s}=e;return{type:n,id:s,offsetFromBaseTime:0!==o?o:void 0,offsetFromAnchor:0!==i?i:void 0,tau:t.encodeReference(r.tauId,xu.tau),tauTextOffset:[r.location,0],sortTiebreaker:a,...Du(e)}}function Lu(e,t){const{type:n,offsetFromBaseTime:r,offsetFromAnchor:o,tau:i,tauTextOffset:a,sortTiebreaker:s=Date.now()/1e3}=e;if(void 0===i||void 0===a)throw new Error("Component has no encoded tau anchor");const c={tauId:t.decodeReferenceId(i),location:a[0]},{isBlocked:d}=Ou(e);return Nu({id:e.id,type:n,offsetFromBaseTime:r,offsetFromAnchor:o,tauAnchor:c,sortTiebreaker:s,isBlocked:d})}function Fu(e,t,n){for(const{isType:r,encode:o}of e)if(r(t))return o&&o(t,n);throw new Error(`Could not determine type for ${t.type}`)}function Uu(e,t,n){for(const{isType:r,decode:o}of e)if(r(t)){if(o)return o(t,n);throw new Error(`No decoder for component of type ${t.type}`)}throw new Error(`Could not determine type for ${t.type}`)}function Bu(e){return Boolean(void 0!==e&&e.baseType===xu.baseTrackComponent)}function ju(e,t,n){return Boolean(n&&n.type===e)}var Vu=(e=>(e.Solid="solid",e.Double="double",e.Dotted="dotted",e.Dashed="dashed",e.Wavy="wavy",e))(Vu||{}),zu=(e=>(e.Underline="underline",e.Overline="overline",e.LineThrough="line-through",e))(zu||{}),Gu=(e=>(e.Highlight="highlight",e.Italic="italic",e.Bold="bold",e.Annotation="annotation",e.FillerWordBasic="fillerWordBasic",e.FillerWordAll="fillerWordAll",e.WordError="wordError",e.StepPreview="stepPreview",e.RecordedOver="recordedOver",e.ReplaceSelection="replaceSelection",e.FindResult="findResult",e.FindResultCurrent="findResultCurrent",e.FocusedOverdubRange="focusedOverdubRange",e.FocusedBlockedTauId="focusedBlockedTauId",e.ForegroundColor="foregroundColor",e.BackgroundColor="backgroundColor",e.HoveringWord="hoveringWord",e.InlineNote="inlineNote",e.Marker="marker",e.AISpeechDecoration="overdubDecoration",e.Pin="pin",e.PinBoundary="pinBoundary",e.PinHighlight="pinHighlight",e.EditBoundaryFocusedWord="editBoundaryFocusedWord",e.LiveCollabSelection="liveCollabSelection",e.Cue="cue",e.CardBoundary="cardBoundary",e.Playhead="playhead",e.UnfocusedSelection="selection",e.SelectionDropTarget="selectionDropTarget",e.SelectedCardRange="selectedCardRange",e.Tag="tag",e.TextCursor="textCursor",e.TextDecoration="textDecoration",e.Unknown="unknown",e.RegionBoundary="regionBoundary",e.ScratchText="scratchText",e.SecondaryTextCursor="secondaryTextCursor",e.TauText="tauText",e.ScriptClip="scriptClip",e.RecordingClip="recordingClip",e.RecordingTau="recordingTau",e.ParagraphSpeaker="paragraphSpeaker",e.ActiveParagraph="activeParagraph",e.PendingOverdub="pendingImputation",e.TextCorrection="textCorrection",e.RecordingTarget="recordingTarget",e.MergeOriginal="o",e.MergeLeft="l",e.MergeRight="r",e.WordGap="wordGap",e.WordlessMedia="wordlessMedia",e.TextExportParagraphStart="textExportParagraphStart",e.TextExportParagraphEnd="textExportParagraphEnd",e.TextExportTag="textExportTag",e.TextExportTimecode="textExportTimecode",e.TextExportSpeaker="textExportSpeaker",e.TextExportCompositionName="textExportCompositionName",e.CardRangeDropTarget="cardRangeDropTarget",e.WordGapSelection="wordGapSelection",e))(Gu||{});const Wu={name:Gu.UnfocusedSelection,value:!0},Hu={name:Gu.SelectionDropTarget,value:!0},qu={name:Gu.CardRangeDropTarget,value:!0},$u={name:Gu.WordGapSelection,value:!0},Ku={name:Gu.ActiveParagraph,value:!0},Yu={name:Gu.Bold,value:!0},Zu={name:Gu.Italic,value:!0},Ju={name:Gu.InlineNote,value:!0},Qu=(Gu.TextExportTimecode,{name:Gu.Playhead,value:!0}),Xu={name:Gu.Playhead,value:!1},ef={name:Gu.TextCursor,value:!0};const tf={name:Gu.ReplaceSelection,value:!0},nf={name:Gu.StepPreview,value:!0},rf={name:Gu.RecordedOver,value:!0},of={name:Gu.FindResult,value:!0},af={name:Gu.FindResultCurrent,value:!0},sf={name:Gu.RegionBoundary,value:!0},cf={name:Gu.FillerWordBasic,value:!0},df={name:Gu.FillerWordAll,value:!0},lf={name:Gu.ScratchText,value:!0},uf={name:Gu.TauText,value:!0},ff={name:Gu.TextCorrection,value:!0},mf={name:Gu.RecordingTarget,value:"after"},pf={name:Gu.PendingOverdub,value:!0},gf={name:Gu.RecordingTau,value:!0},hf={name:Gu.EditBoundaryFocusedWord,value:!0},vf={name:Gu.FocusedOverdubRange,value:!0};function Ef(e){return{name:Gu.HoveringWord,value:e}}function yf(e,t,n){return{range:0===e.length?Gs.get(e.location,1):e,attribute:{name:Gu.LiveCollabSelection,value:{userId:t,clientId:n,empty:0===e.length}}}}function Sf(e){return{name:Gu.PinBoundary,value:e}}function If(e){return{name:Gu.PinHighlight,value:e}}function bf(e){return{name:Gu.SelectedCardRange,value:e}}function Tf(e){return{name:Gu.Annotation,value:e}}function wf(e){return{name:Gu.ForegroundColor,value:e}}function Cf(e){return{name:Gu.TextDecoration,value:e}}function _f(e){return{name:Gu.AISpeechDecoration,value:e}}function Af(e){return{name:Gu.Highlight,value:e}}function Rf(e){return{name:Gu.RecordingClip,value:e}}function Mf(e){return{name:Gu.WordGap,value:e}}function Df(e,t,n){return{name:Gu.WordlessMedia,value:{isBlankCardGap:t,firstWordlessMediaOfTauId:e,isStillComputingEnergies:n}}}function Of(e){return{name:Gu.WordError,value:{alternative:e}}}Gu.TextExportCompositionName,Gu.TextExportSpeaker;Gu.TextExportParagraphStart,Gu.TextExportParagraphEnd;function xf(e,t){return e.name===t.name&&(0,Me.fastDeepEqualJson)(e.value,t.value)}const kf=Me.fastDeepEqualJson;function Nf(e){const t=[];let n=-1,r=-1,o=[],i=0,a=1;const s=new Set;for(;i<e.length;){const c=e[i];if(P()(c.range.length>=0,"Attributed ranges must have non-negative length"),$s(c.range)<=r){i+=1,a=i+1,s.clear();continue}c.range.location>r&&(r=c.range.location,o=[]),n=$s(c.range),o.push(c.attribute);for(const e of s)($s(e.range)<=r||e===c)&&s.delete(e);for(const e of s){const{range:t,attribute:r}=e;o.push(r),n=Math.min(n,$s(t))}let d;for(let t=a;t<e.length;t++){const i=e[t],{range:a,attribute:c}=i;if(0===a.length)throw new Error(`unexpected ${c.name} attribute range with no length`);if(a.location<=r&&$s(a)>r)o.push(c),n=Math.min(n,$s(a)),s.add(i);else{if(a.location>=n){d=d??t;break}a.location>=r&&(n=Math.min(n,a.location),d=d??t)}}a=d??e.length,o.length>0&&(t.push({range:Gs.get(r,n-r),attributes:o}),r=n,o=[]),n===$s(c.range)&&(i+=1,a=i+1,s.clear())}return o.length>0&&t.push({range:Gs.get(r,n-r),attributes:o}),t}function Pf(e){return Lf(e).length}function Lf(e){return"string"===typeof e?e:e.string}function Ff(e){return"string"===typeof e?bm(e):e}function Uf(e,t,n){return"string"===typeof e?e.substr(0,n)+t+e.substr(n):function(e,t,n){const[r,o]=Lm(e,n);return Cm([r,t,o])}(e,t,n)}function Bf(e,t){return Uf(e,t,Lf(e).length)}function jf(e,t){return Uf(e,t,0)}function Vf(e,t){return is(Lf(e),t)}var zf=n(45061);function Gf(e=[]){return{path:e,prop:t=>Gf([...e,t]),item:t=>Gf([...e,t]),any:()=>Gf([...e,zf.E4])}}const Wf=new Set(["composition","pinTrack","sequenceTrack"]),Hf=new Set(["composition","pinTrack"]);function qf(e,t,n,r,o,i,a,s,c,d,l,u,f,m,p,g,h,v,E){const y=n.get(t);if(y&&y[0]===r&&y[1]===o&&y[2]===i&&y[3]===a&&y[4]===s&&y[5]===c&&y[6]===d&&y[7]===l&&y[8]===u&&y[9]===f&&y[10]===m&&y[11]===p&&y[12]===g&&y[13]===h&&y[14]===v&&y[15]===E)return y.result;const S=e(r,o,i,a,s,c,d,l,u,f,m,p,g,h,v,E);return y?(y.result=S,y[0]=r,y[1]=o,y[2]=i,y[3]=a,y[4]=s,y[5]=c,y[6]=d,y[7]=l,y[8]=u,y[9]=f,y[10]=m,y[11]=p,y[12]=g,y[13]=h,y[14]=v,y[15]=E):n.set(t,{result:S,0:r,1:o,2:i,3:a,4:s,5:c,6:d,7:l,8:u,9:f,10:m,11:p,12:g,13:h,14:v,15:E}),S}function $f(e,t,n){return e?e(t,n):t===n}function Kf(e,t,n,r,o,i,a,s,c,d,l,u,f,m,p,g,h,v,E,y){const S=n.get(t);if(S&&$f(r[0],S[0],o)&&$f(r[1],S[1],i)&&$f(r[2],S[2],a)&&$f(r[3],S[3],s)&&$f(r[4],S[4],c)&&$f(r[5],S[5],d)&&$f(r[6],S[6],l)&&$f(r[7],S[7],u)&&$f(r[8],S[8],f)&&$f(r[9],S[9],m)&&$f(r[10],S[10],p)&&$f(r[11],S[11],g)&&$f(r[12],S[12],h)&&$f(r[13],S[13],v)&&$f(r[14],S[14],E)&&$f(r[15],S[15],y))return S.result;const I=e(o,i,a,s,c,d,l,u,f,m,p,g);return S?(S.result=I,S[0]=o,S[1]=i,S[2]=a,S[3]=s,S[4]=c,S[5]=d,S[6]=l,S[7]=u,S[8]=f,S[9]=m,S[10]=p,S[11]=g,S[12]=h,S[13]=v,S[14]=E,S[15]=y):n.set(t,{result:I,0:o,1:i,2:a,3:s,4:c,5:d,6:l,7:u,8:f,9:m,10:p,11:g,12:h,13:v,14:E,15:y}),I}var Yf=n(21606),Zf=n.n(Yf);A.logging.groupLogger("descriptmodel/batchinvalidationcache");class Jf{constructor(){this.cache={}}set(e,t){this.cache[e]=t}get(e){return this.cache[e]}remove(e){delete this.cache[e]}clear(){this.cache={}}isValidCacheKey(e){return"string"===typeof e}getKeys(){return Object.keys(this.cache)}}class Qf{constructor(e){this.lru=new(Zf())(e)}get(e){return this.lru.get(e)}set(e,t){this.lru.set(e,t)}remove(e){this.lru.del(e)}clear(){this.lru.reset()}isValidCacheKey(e){return"string"===typeof e}getKeys(){return this.lru.keys()}}const Xf=new Map;function em(e,t){if(Xf.has(e))throw new Error(`Cache already exists with name: ${e}`);let n;return n=t?new Qf(t):new Jf,Xf.set(e,n),n}function tm(e,t){let n=0,r=0;for(const o of e.getKeys())r+=1,t(o)&&(e.remove(o),n+=1);return[n,r-n]}const nm=em("keyCache2");function rm(e,t){let n=nm.get(e);n||(n={},nm.set(e,n));let r=n[t];return void 0===r&&(r=`${e}:${t}`,n[t]=r),r}const om=em("keyCache3");function im(e,t,n){let r=om.get(e);r||(r={},om.set(e,r));let o=r[t];o||(o={},r[t]=o);let i=o[n];return void 0===i&&(i=`${e}:${t}:${n}`,o[n]=i),i}em("keyCache4");function am(e){return e.projectId}function sm(e,t){return rm(e.projectId,t)}function cm(e,t){return rm(e,t.join("/"))}function dm(e,t){return rm(e.projectId,t)}function lm(e,t){return rm(e,t.id)}function um(e){if(e.length<=1)return e[0]||{};const t={};for(let n=0;n<e.length;n++){const r=e[n];for(const[e,n]of Object.entries(r))if(void 0===t[e])t[e]=n;else{const{entities:r,references:o}=t[e],i=gu(r,n.entities),a=gu(o,n.references);t[e]={id:e,entities:i,references:a}}}return t}function fm(e,t,n,r){void 0===e[t]&&(e[t]={id:t,references:[],entities:[]}),e[t].entities.push({type:n,location:r})}function mm(e,t,n,r){void 0===e[t]&&(e[t]={id:t,references:[],entities:[]}),e[t].references.push({type:n,location:r})}const pm=em("entitiesSummaryCache");function gm(e,t,n,r){return Em(hm,cm(t,e),pm,e,n,r)}function hm(e,t,n){const r=Gf(e),o={};for(let i=0;i<t.length;i++)fm(o,t[i].id,n,r.item(i).prop("id").path);return o}const vm={0:(e,t)=>ls(e,t)};function Em(e,t,n,r,...o){return Kf(e,t,n,vm,r,...o)}function ym(e,t){if(e.originData)throw new Error("Cannot encode AttributedString with originData");const n=e.string.length;for(const r of e.attributes){const{attribute:e,range:o}=r;e.name===Gu.Highlight&&"string"===typeof e.value&&t.encodeReference(e.value,xu.highlighter);o.location>=n?Ht(new Error("Attributed range starts after string length"),"encode"):$s(o)>n&&Ht(new Error("Attributed range ends after string length"),"encode")}return e}function Sm(e,t){const n=hu(e.attributes,(e=>{const{attribute:n}=e;return n.name===Gu.Highlight&&"string"===typeof n.value?{...e,attribute:{...n,value:t.decodeReferenceId(n.value)}}:e}));return n!==e.attributes?{...e,attributes:n}:e}const Im=bm("");function bm(e,t=bu(),n){return Tm(e,Bm(t,!1),n)}function Tm(e,t=bu(),n){return n?{string:e,attributes:t,originData:n}:{string:e,attributes:t}}function wm(e){return e.name===Gu.Annotation?e.value:e.name}function Cm(e){if(Array.isArray(e)){if(0===e.length)return Im;if(1===e.length)return Ff(e[0])}let t="";const n=[];let r,o,i,a,s={};for(const c of e)if("string"===typeof c)c.length>0&&(s={},t+=c);else{const e=c.string.length;if(0===e)continue;const d=t.length;if(t+=c.string,0===d)for(const t of c.attributes){const{range:r}=t;if($s(r)===e){const{attribute:e}=t,o={attribute:e,range:r};s[wm(e)]=o,n.push(o)}else n.push(t)}else{const t=s;s={};for(const r of c.attributes){const{attribute:c,range:l}=r,u=wm(c);let f=t[u];if(o&&o!==f&&void 0!==i&&void 0!==a&&(o.range=Gs.get(i,a),a=0,i=0),f&&o!==f&&(i=f?.range.location,a=f?.range.length),o=f,void 0!==f&&0===l.location&&xf(c,f.attribute)){if(void 0===a)throw new Error("lastMutableLen is not defined");a+=l.length}else o&&void 0!==i&&void 0!==a&&(o.range=Gs.get(i,a)),f={attribute:c,range:Gs.get(d+l.location,l.length)},o=f,i=f.range.location,a=f.range.length,n.push(f);$s(l)===e&&(s[u]=f)}}r=_m(r,d,c)}return o&&void 0!==i&&void 0!==a&&(o.range=Gs.get(i,a)),Tm(t,n,r)}function _m(e,t,n){const r=n.originData;if(r){e||(e={[Gu.MergeOriginal]:[],[Gu.MergeLeft]:[],[Gu.MergeRight]:[]});const{[Gu.MergeOriginal]:n,[Gu.MergeLeft]:o,[Gu.MergeRight]:i}=e;for(const{range:e,offset:a}of r[Gu.MergeOriginal])n.push({offset:a+t,range:e});for(const{range:e,offset:a}of r[Gu.MergeLeft])o.push({offset:a+t,range:e});for(const{range:e,offset:a}of r[Gu.MergeRight])i.push({offset:a+t,range:e})}return e}function Am(e){if(Array.isArray(e)){if(0===e.length)return Im;if(1===e.length)return Ff(e[0])}let t,n="",r=[];for(const o of e){if("string"!==typeof o){if(0===o.string.length)continue;const e=n.length;if(0===e)r=[...o.attributes];else for(const{attribute:t,range:n}of o.attributes)r.push({attribute:t,range:Gs.get(e+n.location,n.length)});t=_m(t,e,o)}n+=Lf(o)}return Tm(n,r,t)}function Rm(e,t){return bm(e.string,[...e.attributes,t],e.originData)}function Mm(e,t){return bm(e.string,gu(e.attributes,t),e.originData)}function Dm(e,t){return Tm(e.string,gu(e.attributes,t),e.originData)}function Om(e,t){const n=vu(e.attributes,t);return n===e.attributes?e:Tm(e.string,n,e.originData)}function xm(e,t){return km(e,qs(t),$s(t))}function km(e,t,n=e.string.length){t<0&&(t=0),n<0&&(n=0);const r=e.string.length;if(n>r&&(n=r),t>r&&(t=r),t===n)return Im;if(P()(t<=n,"expected start <= end"),0===t&&n===r)return e;const o=e.string.substring(t,n),i=fu(e.attributes,(({attribute:e,range:r})=>{const o=r.location,i=$s(r);if(!Ys(o,i,t,n))return;const a=Math.max(t,o)-t,s=Math.min(n,i)-t;return{attribute:e,range:Gs.get(a,s-a)}})),a=Nm(e.originData,(e=>Pm(e,t,n)));return Tm(o,i,a)}function Nm(e,t){if(!e)return;const n=fu(e[Gu.MergeOriginal],t),r=fu(e[Gu.MergeLeft],t),o=fu(e[Gu.MergeRight],t);return 0!==n.length||0!==r.length||0!==o.length?{[Gu.MergeOriginal]:n,[Gu.MergeLeft]:r,[Gu.MergeRight]:o}:void 0}function Pm({offset:e,range:t},n,r){const o=e+t.length;if(n>=o||e>=r)return;const i=Math.max(n,e)-n,a=Math.min(r,o)-n-i;return a<=0?void 0:{offset:i,range:Gs.get(t.location+i-e+n,a)}}function Lm(e,t){if(t<0)throw new RangeError("index < 0");if(0===t)return[Im,e];if(t>e.string.length)throw new RangeError("index > length");if(t===e.string.length)return[e,Im];const n=e.string.substring(0,t),r=e.string.substring(t),o=[],i=[];for(const c of e.attributes){const{attribute:e,range:n}=c,r=$s(n);if(r<=t){o.push(c);continue}const a=n.location;a>=t?i.push({attribute:e,range:Gs.get(a-t,n.length)}):(o.push({attribute:e,range:Gs.get(a,t-a)}),i.push({attribute:e,range:Gs.get(0,r-t)}))}const a=Nm(e.originData,(e=>Pm(e,0,t))),s=Nm(e.originData,(e=>Pm(e,t,1/0)));return[Tm(n,o,a),Tm(r,i,s)]}function Fm(e){return Nf(e.attributes)}function Um(e,t){return e.range.location===t.range.location?e.attribute.name<t.attribute.name?Ie.OrderedAscending:e.attribute.name>t.attribute.name?Ie.OrderedDescending:Ie.OrderedSame:e.range.location<t.range.location?Ie.OrderedAscending:Ie.OrderedDescending}function Bm(e,t){if(0===e.length)return bu();const n=[];t||function(e){let t;for(const n of e){if(t&&Um(t,n)===Ie.OrderedDescending)return!1;t=n}return!0}(e)||(e=function(e){const t=Array.from(e);return t.sort(Um),t}(e));const r=new Array(e.length).fill(!1);for(let o=0;o<e.length;o++){if(r[o])continue;const t=e[o],{range:i,attribute:a}=t;if(i.length<=0){r[o]=!0;continue}if(a.name===Gu.MergeOriginal||a.name===Gu.MergeLeft||a.name===Gu.MergeRight){r[o]=!0,n.push(t);continue}const s=$s(i);let c=s;for(let n=o+1;n<e.length;n++){if(r[n])continue;const t=e[n];if(t.range.location>c)break;if(xf(t.attribute,a)){const e=$s(t.range);e>c&&(c=e),r[n]=!0}}const d=i.location;s===c?n.push(t):n.push({attribute:a,range:Gs.get(d,c-d)})}return n}function*jm(e,t,n){for(const r of e.attributes){if(t!==r.attribute.name)continue;const e=Zs(r.range,n);if(!e)continue;const o=r.attribute.value;yield{value:o,range:e}}}function*Vm(e,t){for(const n of e.attributes)if(Hs(n.range,t))yield n;else if(n.range.location>t)break}function zm(e,t,n,r){let o=0;const i=t.length;for(const a of e){if(a.attribute.name!==r)continue;let e;for(;o<i;){if(t[o].attribute.name===r){e=t[o],o+=1;break}o+=1}if(!e)return Math.min(n,a.range.location);if(a.range.location!==e.range.location)return Math.min(n,a.range.location,e.range.location);if(!(0,Me.fastDeepEqualJson)(a.attribute,e.attribute))return Math.min(n,a.range.location,e.range.location);if(n<$s(a.range)||n<$s(e.range))return Math.min(n,$s(a.range),$s(e.range));if(!(0,Me.fastDeepEqualJson)(a.range,e.range))return Math.min(n,$s(a.range),$s(e.range))}for(;o<i;){if(t[o].attribute.name===r)return Math.min(n,t[o].range.location);o+=1}return n}function Gm(e,t,n){if(e===t)return n;const r=e.length<t.length?e:t,o=r===e?t:e,i=new Set;for(const s of r)i.add(s.attribute.name);for(const s of o)i.add(s.attribute.name);let a=n;for(const s of i.values()){const e=zm(r,o,n,s);if(a=Math.min(a,e),0===a)break}return a}function Wm(e,t,n,r,o,i){let a=t.length-1;for(let s=e.length-1;s>=0;s--){const c=e[s];if(c.attribute.name!==i)continue;let d;for(;a>=0;){if(t[a].attribute.name===i){d=t[a],a--;break}a--}const l=0===r?c.range:Gs.get(c.range.location+r,c.range.length);if(!d)return Math.max(o,$s(l));const u=0===n?d.range:Gs.get(d.range.location+n,d.range.length);if($s(l)!==$s(u))return Math.max($s(l),$s(u));if(!xf(c.attribute,d.attribute))return Math.max(o,$s(l),$s(u));if(o>l.location||o>u.location)return Math.max(o,l.location,u.location);if(!(0,Me.fastDeepEqualJson)(l,u))return Math.max(l.location,u.location)}for(;a>=0;){if(t[a].attribute.name===i)return Math.max(o,$s(t[a].range)+n);a--}return o}function Hm(e,t,n,r,o){if(n===r&&e===t)return o;const i=e.length<t.length?e:t,a=i===e?t:e,s=r-n,c=i===e?0:s,d=i===e?s:0,l=new Set;for(const f of i)l.add(f.attribute.name);for(const f of a)l.add(f.attribute.name);let u=o;for(const f of l.values()){const e=Wm(i,a,c,d,o,f);if(u=Math.max(u,e),u===r)break}return r-u>n?r-n:u}function qm(e,t,n){const r={},o=Gf(t),i=new Set;for(const[a,s]of e.attributes.entries()){const{attribute:e}=s;e.name!==Gu.Highlight||"string"!==typeof e.value||!n&&i.has(e.value)||(mm(r,e.value,"highlighter",o.prop("attributes").item(a).prop("attribute").prop("value").path),i.add(e.value))}return r}function $m(e={}){const{attrText:t=Im}=e;return{...Nu({...e,type:xu.inlineNoteComponent}),attrText:t}}function Km(e,t){const{attrText:n}=e;return{...Pu(e,t),attrText:n}}function Ym(e,t){const{attrText:n}=e;return $m({...Lu(e,t),attrText:Sm(n,t)})}function Zm(e){return ju(xu.inlineNoteComponent,0,e)}function Jm(){return{isType:Zm,encode:Km,decode:Ym}}function Qm(e,t){return[e,...t.map((t=>e.map((e=>t[e]))))]}function Xm(e){const t=[];return ep(e,(e=>t.push(e))),t}function ep(e,t){if(!(e instanceof Array))throw new Error("Not an array");if(e.length<1)throw new Error("No parameter names");const n=e[0],r=n;if(!Array.isArray(r))throw new Error("Parameter names not array");const o=n.length,i=e.length;for(let a=1;a<i;a++){const r=e[a];if(!(r instanceof Array))throw new Error(`Row ${a-1} is not an array`);if(r.length!==o)throw new Error(`Row ${a-1} is the wrong size`);const i={};for(let e=0;e<o;e++)i[n[e]]=r[e];t(i,a)}}function tp(e){const t=e;return"number"===typeof t.offset&&"number"===typeof t.duration}function np({offset:e}){return e}function rp({offset:e,duration:t}){return e+t}function op(e,t){return np(e)<=t&&t<rp(e)}function ip(e,t){return op(e,t)||rp(e)===t}function ap(e,t){return e===t||e.offset===t.offset&&e.duration===t.duration}function sp(e,t){return ap(e,t)||vd(np(e),rp(t))&&vd(np(t),rp(e))}function cp(e,t){if(!sp(e,t))return;const n=rp(e),r=rp(t);if(e.offset<=t.offset&&r<=n)return{offset:t.offset,duration:t.duration};if(t.offset<=e.offset&&n<=r)return{offset:e.offset,duration:e.duration};const o=Math.max(e.offset,t.offset);return{offset:o,duration:Math.min(n,r)-o}}function dp(e,t,n){if(void 0!==t&&void 0!==n&&n<t)throw new Error("Cannot call clamp with max < min");const r=rp(e),o=np(e);if((void 0===n||r<=n)&&(void 0===t||o>=t))return e;const i=void 0===t?o:Math.max(t,o);return{offset:i,duration:Math.max(void 0===n?r:Math.min(r,n),i)-i}}function lp(e,t,n){if((void 0===t||0===t)&&(void 0===n||0===n))return e;let r=e.offset,o=rp(e),i=!1;return void 0!==t&&t<0&&(r+=t,i=!0),void 0!==n&&n<0&&(o-=n,i=!0),i?{offset:r,duration:o-r}:e}function up(e,t){const n=Math.min(np(e),np(t));return{offset:n,duration:Math.max(rp(e),rp(t))-n}}var fp=n(78292),mp=n(64765),pp=n.n(mp);A.logging.groupLogger("descriptmodel/createselector");function gp(e,t){return(e,n)=>{const r=(0,fp.PW)(e,n);let o;return(...e)=>{const n=r.apply(void 0,e);return n===o||t(n,o)?o:(o=n,n)}}}function hp(e,t=[],n=fp.PW,r=[]){return(0,el.createSelectorCreator)((function(o,i){return i?e(o,...t):n(o,...r)}),!0)}function vp(e){return hp(gp(0,Me.fastDeepEqual))}function Ep(e){return hp(us,e?[e]:void 0)}function yp(e){return{cacheObject:em(e),selectorCreator:el.createSelector}}function Sp(e,t){return{cacheObject:em(e),selectorCreator:Ep(t)}}const Ip=[];class bp extends Error{constructor(e,t){super(e),this.itemId=t,Error.captureStackTrace&&Error.captureStackTrace(this,bp),this.name="CollectionIdError",this.extra={itemId:t}}static itemNotFound(e,t){return new bp("Item not found in collection"+(t?` ${t}`:""),e)}}function Tp(e){const t={};for(let n=0;n<e.length;n++){const r=e[n].id;if(void 0!==t[r])throw new bp("2 objects with same id in collection",r);t[r]=n}return t}function wp(e,t=Tp(e)){return n=>{const r=t[n];if(void 0!==r)return e[r]}}function Cp(e,t){for(const n of e)if(t(n,n.id))return n}function _p(e,t,n){const r=t[n.id];return void 0===r?[...e,n]:e[r]===n?e:[...e.slice(0,r),n,...e.slice(r+1)]}function Ap(e,t,n=!1){if(0===t.length)return e;const r=new Set(t);if(e=e.filter((e=>!r.delete(e.id))),!n&&r.size>0)throw bp.itemNotFound([...r][0]);return e}function*Rp(e,t,n=wp(t)){if(e!==t)for(const r of e)r!==n(r.id)&&(yield r.id)}function Mp(e,t){return(0,Yl.createCachedSelector)(t,Tp)({...yp(e),keySelector:am})}function Dp(e,t,n){const r=t[n];if(void 0!==r)return e[r]}function Op(e,t,n=Mp(e,t)){return{getIndices:n,makeFrozenGetter:e=>wp(t(e),n(e)),getItemIndex:(t,r)=>{const o=n(t)[r];if(void 0===o)throw bp.itemNotFound(r,e);return o},getItemMaybe:(e,r)=>Dp(t(e),n(e),r),getItem:(r,o)=>{const i=Dp(t(r),n(r),o);if(!i)throw bp.itemNotFound(o,e);return i},removeItem:(e,r)=>function(e,t,n){const r=t[n];if(void 0===r)throw bp.itemNotFound(n);return[...e.slice(0,r),...e.slice(r+1)]}(t(e),n(e),r),removeItems:(e,n)=>Ap(t(e),n),addItem:(e,r)=>function(e,t,n){if(void 0!==t[n.id])throw new bp("Item already in collection",n.id);return _p(e,t,n)}(t(e),n(e),r),updateItem:(e,r)=>_p(t(e),n(e),r)}}function xp(e,t){const n=Mp(`${e}-indices`,t),r=(0,Yl.createCachedSelector)(sm,((e,t)=>t),((r,o)=>Op(`${e}-helpers`,(function(e){return t(e,o)}),(function(e){return n(e,o)}))))({...yp(e),keySelector:sm});return r}const{getIndices:kp,makeFrozenGetter:Np,getItem:Pp,getItemMaybe:Lp,removeItem:Fp,addItem:Up,updateItem:Bp}=Op("mediaReferenceCollection",(e=>e.mediaLibrary.mediaRefs)),{removeItem:jp,getItemMaybe:Vp,getItem:zp,updateItem:Gp,addItem:Wp}=Op("transcriptCollection",(e=>e.transcripts)),{removeItem:Hp,getItem:qp,getItemMaybe:$p,updateItem:Kp,addItem:Yp}=Op("compositionCollection",(e=>e.compositions)),{removeItem:Zp,getItem:Jp,getItemMaybe:Qp,updateItem:Xp,addItem:eg}=Op("sequenceTrackCollection",(e=>e.sequenceScenes)),{removeItem:tg,getItemMaybe:ng,updateItem:rg,addItem:og}=Op("pinTrackCollection",(e=>e.pinScenes)),{removeItem:ig,getItem:ag,getItemMaybe:sg,updateItem:cg,addItem:dg}=Op("restorableTrackCollection",(e=>e.restorableScenes)),{getIndices:lg,getItemMaybe:ug,getItem:fg,addItem:mg,updateItem:pg,removeItem:gg,removeItems:hg}=Op("speakerCollection",(e=>e.voices)),{addItem:vg,getItem:Eg,getItemMaybe:yg}=Op("highlighterCollection",(e=>e.highlighters));function Sg({voiceover:e}){return!!e&&Boolean(e.metadata.alignment)}function Ig(e){return Boolean(e.voiceover&&void 0!==e.voiceover.transcriptReceiptId&&!Sg(e))}function bg(e){return Boolean(e.video)}function Tg(e){return Boolean(!e.audio&&e.image)}function wg(e){return bg(e)||Tg(e)}function Cg(e){return Boolean(e.audio)}function _g(e){return Boolean(e.audio&&e.voiceover)}function Ag(e){return Boolean(e.audio&&e.audio.trackSceneIds)}function Rg(e){return Ag(e)&&bg(e)}function Mg(e){return Boolean(e.audio?.isScratchText)&&Ag(e)}function Dg(e){return Boolean(e.isGlobalAsset)}function Og(e){return Boolean(e.audio?.speechEnhanceEnabled)}function xg(e,t){if(kg(e))return!1;switch(t){case"speech_enhanced":return Boolean(e.audio?.speechEnhanceEnabled);case"eye_contact":return Boolean(e.video?.eyeContactRequested);case"background_mask":return Boolean(e.video?.backgroundMaskRequested)||Boolean(e.image?.backgroundMaskRequested)}}function kg(e){return"overdub"===e.source}function Ng(e){return"overdubPrint"===e.source||"regenerationPrint"===e.source}function Pg(e){return"descriptScreenRecording"===e.source||"descriptRecording"===e.source}function Lg(e){return"roomtone"===e.source}function Fg(e){return"font"===e.source}function Ug(e){return!!e.generativeMedia}function Bg(e){return Ug(e)?!!e.generativeMedia.visible:!e.isBounced&&!kg(e)&&!Lg(e)&&!Mg(e)&&!Fg(e)}const jg=new Set([void 0,"en"]);function Vg(e){return jg.has(e?.voiceover?.transcriptionLanguage)}function zg(e,t=0,n=e.length-t){if(t<0)throw new Error("Cannot make slice with negative offset");if(n<0)throw new Error("Cannot make slice with negative length");if(t+n>e.length)throw new Error("Cannot make slice with offset + length > buffer length");return{buffer:e,offset:t,length:n}}function Gg(e,t=0,n=e.length-t){if(t<0)throw new Error("Cannot make subslice with negative offset");if(n<0)throw new Error("Cannot make subslice with negative length");if(t+n>e.length)throw new Error("Cannot make subslice with offset + length > slice length");return zg(e.buffer,e.offset+t,n)}function Wg({offset:e,buffer:t,length:n},r){if(r<0||r>=n)throw new Error("Cannot access element outside of slice range");return t[e+r]}function Hg(e){if(0===e.length)throw new Error("slice is empty");return Wg(e,0)}function qg(e){if(0===e.length)throw new Error("slice is empty");return Wg(e,e.length-1)}function $g({offset:e,length:t}){return e+t}function*Kg({buffer:e,offset:t,length:n}){const r=t+n;for(let o=t;o<r;o++)yield e[o]}function Yg(e,t){return Qa(Kg(e),t)}function Zg({buffer:e,offset:t,length:n}){return e.slice(t,t+n)}const{equalFrameCounts:Jg,lessThanFrameCount:Qg,greaterThanOrEqualFrameCounts:Xg}=s;function eh(e,t,n,r){const o=t,i=n;let a=o,s=i;if(e.length<=0||n<=t)return{};const c=r(e[o],o);if(c!==Ie.OrderedAscending){const t={value:e[o],index:o};return c===Ie.OrderedSame?{match:t}:{next:t}}const d=r(e[i-1],i-1);if(d!==Ie.OrderedDescending){const t={value:e[i-1],index:i-1};return d===Ie.OrderedSame?{match:t}:{previous:t}}for(;a<s;){const t=s+a>>1,n=e[t];switch(r(n,t)){case Ie.OrderedSame:return{match:{value:n,index:t}};case Ie.OrderedAscending:a=t+1;break;case Ie.OrderedDescending:s=t}}const l=a-1,u=a,f=l>=o&&l<i?e[l]:void 0,m=u>=o&&u<i?e[u]:void 0;return{previous:void 0!==f?{value:f,index:l}:void 0,next:void 0!==m?{value:m,index:u}:void 0}}function th({buffer:e,offset:t,length:n},r){const o=eh(e,t,t+n,r);if(0===t)return o;function i(e){if(e)return{index:e.index-t,value:e.value}}return{match:i(o.match),previous:i(o.previous),next:i(o.next)}}function nh(e,t){const n=th(e,(e=>{const n=t(e);return n===Ie.OrderedSame?Ie.OrderedDescending:n})),r=n.next?.index??0,o=Gg(e,r),i=th(o,(e=>{const n=t(e);return n===Ie.OrderedSame?Ie.OrderedAscending:n}));if(void 0===n.next&&void 0===i.next)return Gg(e,e.length,0);return Gg(e,r,i.next?.index??o.length)}function rh(e,t){return eh(e,0,e.length,t)}function oh(e){return e<0?Ie.OrderedAscending:e>0?Ie.OrderedDescending:Ie.OrderedSame}function ih(e,t){return Jg(e,0,t)?Ie.OrderedSame:e<0?Ie.OrderedAscending:Ie.OrderedDescending}function ah(e,t,n,r){return Qg(e,t,r)?Ie.OrderedDescending:Xg(e,n,r)?Ie.OrderedAscending:Ie.OrderedSame}function sh(e){return e}function ch(e,t){return e>t}function dh(e,t){return e>=t}function lh(e,t,n,r,o){const i=t(e),a=n(e),s=o?ch:dh;return e=>{const o=r(e);return s(t(o),a)?Ie.OrderedDescending:s(i,n(o))?Ie.OrderedAscending:Ie.OrderedSame}}function uh(e,t,n){return lh(e,t,n,sh,!1)}function fh({fadeInDuration:e,fadeOutDuration:t,fadeInShape:n,fadeOutShape:r,headTransitionEffect:o,tailTransitionEffect:i}){if(void 0!==e||void 0!==t||void 0!==r||void 0!==n||void 0!==o||void 0!==i)return{fadeInDuration:e,fadeOutDuration:t,fadeInShape:n,fadeOutShape:r,headTransitionEffect:o,tailTransitionEffect:i}}function mh(e){return fh(e)}const ph={fadeInDuration:void 0,fadeOutDuration:void 0,fadeInShape:void 0,fadeOutShape:void 0};function gh({fadeInDuration:e,fadeOutDuration:t,fadeInShape:n,fadeOutShape:r,headTransitionEffect:o,tailTransitionEffect:i}){return{fadeInDuration:e,fadeOutDuration:t,fadeInShape:n,fadeOutShape:r,headTransitionEffect:o,tailTransitionEffect:i}}function hh({gain:e}){return 1!==e?{gain:e}:{}}function vh({gain:e}){return{gain:void 0===e?1:e}}function Eh(e,t){return e.gain===t?e:{...e,gain:t}}function yh(e,t){return[e*Math.sin(t*Math.PI/2),e*Math.cos(t*Math.PI/2)]}var Sh=(e=>(e.SpokenNoise="<SPOKEN_NOISE>",e.Silence="!SIL",e.Tag="<TAG>",e.Placeholder="<PLACEHOLDER>",e))(Sh||{});const Ih={None:0,FailedAlignment:1,Placeholder:2,Filler:4,Error:8,UserCorrection:16};function bh(e,t){return(e&t)===t}const Th={};function wh(e){return void 0===e?Ih.None:function(e){const t=Th[e];if(t)return t;let n=Ih.None;for(const r of e)switch(r){case"f":n|=Ih.FailedAlignment;break;case"d":n|=Ih.Placeholder;break;case"l":n|=Ih.Filler;break;case"e":n|=Ih.Error}return Th[e]=n,n}(e)}var Ch=(e=>(e.Sound="sound",e.Silence="silence",e.Bleed="bleed",e))(Ch||{});const[_h]=Vs("speakerId","styleId"),Ah=(e,t)=>_h(e,t=null===t?void 0:t);function Rh(e){return Boolean(e.tag)}function Mh(e){switch(e){case Ch.Sound:return"Sound";case Ch.Silence:return"Silence";case Ch.Bleed:return"Bleed";default:return e}}function Dh({label:e,startTime:t,endTime:n,speakerId:r,category:o,wordlessRepresentation:i}){return Fh(Sh.Tag,t,n,void 0!==r?Ah(r):void 0,Ih.None,{category:o,label:void 0!==e?e:Mh(o),wordlessRepresentation:i},void 0)}const Oh=/(?!'|\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F)[\p{P}\p{S}\p{Cf}]/gu,xh=new Map;function kh(e){const t=xh.get(e);if(t)return t;xh.size>=5e4&&xh.clear();const n=X(e);let r=n.toUpperCase();if(r===Sh.SpokenNoise||r===Sh.Silence||r===Sh.Tag||r===Sh.Placeholder)xh.set(n,r);else{if(r=function(e){let t=e.replace(/\u2019/g,"'").replace(Oh,"");for(;t.startsWith("'")||t.startsWith('"');)t=t.slice(1);for(;t.endsWith("'")||t.endsWith('"');)t=t.slice(0,t.length-1);return t}(r),void 0===As.index(r))return;xh.set(n,r)}return r}function Nh(e){const t=kh(e.word);if(void 0===t)throw new Error("No aligned word for word string");return t}function Ph(e,t,n){return e.word===t||Nh(e)===n}function Lh(e,t){return e===t||e.word===t.word||Nh(e)===Nh(t)}function Fh(e,t,n,r,o,i,a){if(n<=t)throw new Error("Cannot create word with endTime <= startTime");return{word:e,startTime:t,endTime:n,speaker:r,attrs:o??Ih.None,tag:i,extra:a}}function Uh(e,t,n,r,o=Ih.None,i,a){if(void 0!==kh(e))return Fh(e,t,n,r,o,i,a)}function Bh(e,t){const n=new Set;e.forEach((({speaker:e})=>{void 0===e||n.has(e.speakerId)||(t.encodeReference(e.speakerId,xu.speaker),n.add(e.speakerId))}));const r=e.some((e=>void 0!==e.speaker?.styleId)),o=e.some((e=>Rh(e))),i=e.some((e=>e.extra)),a=e.some((e=>0!==e.attrs)),s=["word","start","end"];return a&&s.push("attrs"),n.size>0&&s.push("speakerId"),o&&s.push("category","label"),r&&s.push("styleId"),i&&s.push("extra"),Qm(s,e.map((({word:e,startTime:t,endTime:n,attrs:r,speaker:o,tag:i,extra:a})=>({word:e,start:t,end:n,attrs:r,speakerId:o?.speakerId,category:i?.category,label:i?.label,styleId:o?.styleId,extra:a}))))}function jh(e,t){if("string"===typeof e)return Ah(e,t)}function Vh(e,t){if("string"!==typeof e||""===e)return;const n=ye(Ch).find((t=>Ch[t]===e));if(!n)throw new Error(`Cannot decode invalid category: ${e}`);return t="string"===typeof t?t:e,{category:Ch[n],label:t}}function zh(e,t,n){if(0!==t.length)throw new Error("decodeWordArray must be passed an empty intoArray");let r=!1,o=0,i=0;return ep(e,(({word:e,start:a,end:s,attrs:c,attributes:d,speakerId:l,styleId:u,category:f,label:m,extra:p})=>{let g=a,h=s;if(l="string"===typeof l?n.decodeReferenceId(l):void 0,g<i){if(hd(g,i))g=i;else{const e=o,n=Math.max(i,h),r=(e+n)/2;if(t.length>0){const n=t.length-1,o=t[n],i=Uh(o.word,e,r,jh(l,u),o.attrs);i&&(t[n]=i)}g=r,h=n}r=!0}else g>=h&&(h=g+.1,r=!0);void 0===c&&void 0!==d&&(c=wh(d));const v=Uh(e,g,h,jh(l,u),c,Vh(f,m),p);v?(t.push(v),o=v.startTime,i=v.endTime):r=!0})),r}function Gh(e,t){return e===t||1!==e&&1!==t&&(e?.speakerId===t?.speakerId&&e?.styleId===t?.styleId)}function Wh(e,t){return e===t||void 0!==e&&void 0!==t&&(e.word===t.word&&e.attrs===t.attrs&&hd(e.startTime,t.startTime)&&hd(e.endTime,t.endTime)&&Gh(e.speaker,t.speaker)&&function(e,t){return e===t||e?.category===t?.category&&e?.label===t?.label}(e.tag,t.tag)&&function(e,t){return e===t||e?.isScratch===t?.isScratch&&e?.wordErrorAlternative===t?.wordErrorAlternative}(e.extra,t.extra))}function Hh(e,t){return void 0===e||void 0===t?e===t:e.word===t.word&&hd(e.startTime,t.startTime)&&hd(e.endTime,t.endTime)&&(0,Me.fastDeepEqualJson)(e.attrs,t.attrs)&&(0,Me.fastDeepEqualJson)(e.tag,t.tag)}function qh(e,t){return(0,Me.fastDeepEqualJson)(t,e.speaker)?e:{...e,speaker:t}}function $h(e,t,n){const r={},o=Gf(t),i=new Set;for(let a=0;a<e.length;a++){const t=e[a].speaker?.speakerId;void 0===t||!n&&i.has(t)||(mm(r,t,"voice",o.item(a).prop("speaker").prop("speakerId").path),i.add(t))}return r}const Kh=/^(\p{P}*)((\P{P}.*\P{P})|\P{P})\p{P}*$/u,Yh=class{constructor(e,t=!1){this.str=e,this.scanNotes=t,this.scanLocation=0,this.stringResultLength=0}static enumerateWords(e,t){const n=new Yh(e);for(;;){for(;n.scanNote(););if(n.scanUpToSpaceSet()){const e=n.stringResult,r=Kh.exec(e);if(r){const o=e.length,i=n.scanLocation-o,a=i+r[1].length,s=r[2],c=kh(s);if(c){if(t(s,c,a,s.length,i,o))break}}}for(;n.scanNote(););if(!n.scanUpToWordSet())break}}static stripNonWords(e,t=!0){let n="",r=0;return this.enumerateWords(e,((e,o,i,a)=>(i>r&&(n+=t?" ".repeat(i-r):" "),n+=e,r=i+a,!1))),t&&e.length>r&&(n+=" ".repeat(e.length-r)),n}static isWhitespace(e){switch(e){case 8232:case 8233:case 32:case 160:case 5760:case 8192:case 8193:case 8194:case 8195:case 8196:case 8197:case 8198:case 8199:case 8200:case 8201:case 8202:case 8239:case 8287:case 12288:case 10:case 11:case 12:case 13:case 133:case 9:return!0;default:return!1}}get stringResult(){const e=this.scanLocation;return this.str.substr(e-this.stringResultLength,this.stringResultLength)}scanUpToSpaceSet(){let e=!1,t=0;for(;this.scanLocation<this.str.length;){const n=this.str.charCodeAt(this.scanLocation);if(Yh.isWhitespace(n))break;e=!0,t+=1,this.scanLocation+=1}return this.stringResultLength=t,e}scanUpToWordSet(){let e=!1;for(;this.scanLocation<this.str.length;){const t=this.str.charCodeAt(this.scanLocation);if(!Yh.isWhitespace(t))break;e=!0,this.scanLocation+=1}return e}scanNote(){if(!this.scanNotes)return!1;let e=0,t=!1;for(;this.scanLocation<this.str.length;){const n=this.str.charAt(this.scanLocation);if(n===Yh.noteStartString)t=!0,e+=1,this.scanLocation+=1;else{if(!(e>0))break;n===Yh.noteEndString&&(e-=1),this.scanLocation+=1}}return t}noteRanges(){let e=this.scanLocation;const t=[];for(;;){for(e=this.scanLocation;this.scanNote();)t.push(Gs.get(e,this.scanLocation-e)),e=this.scanLocation;for(this.scanUpToSpaceSet();this.scanNote();)t.push(Gs.get(e,this.scanLocation-e)),e=this.scanLocation;if(e=this.scanLocation,!this.scanUpToWordSet())break}return t}static noteRangesInString(e){return new Yh(e,!0).noteRanges()}};let Zh=Yh;Zh.noteStartString="(",Zh.noteEndString=")";var Jh=(e=>(e.Composition="composition",e.Transcript="transcript",e.Pin="pin",e.Sequence="sequence",e.Restorable="restorable",e))(Jh||{});const Qh="Transcribing";function Xh(e){const t=e.voiceover?.metadata.alignment;return 1===t?.length&&function(e){return bh(e.attrs,Ih.Placeholder)&&e.word===Qh}(t[0])}function ev(e,...t){if(e.quality&&t.length)for(const n of t){const t=e.quality[n];if(t)return t}return e}function tv(e){return""===e?"Untitled":e}function nv({id:e}){return e}function rv(e,t){return e.id===t?e:{...e,id:t}}function ov(e){throw new Error(`Type inference error: unreachable code received ${function(e){try{return JSON.stringify(e)}catch(t){return String(e)}}(e)}`)}function iv(e,t){return!!Object.prototype.hasOwnProperty.call(e,t)}function av(e,t){return iv(e,t)?e[t]:void 0}const sv={projectFiles:"project-files",sequences:"sequences",overdubs:"overdubs",recordings:"recordings",stockMedia:"stock-media",aiAssets:"ai-assets"},cv={projectFiles:"Project Files",sequences:"Sequences",overdubs:"Overdubs",recordings:"Recordings",stockMedia:"Stock Media",aiAssets:"AI Assets"};function dv({id:e=Ps(),name:t="Folder",items:n=[]}={}){return{id:e,name:t,items:n,type:"folder"}}function lv({id:e=Ps(),name:t="Folder",items:n=[]}={}){return{id:e,name:t,items:n}}const uv="Root folder";function fv(e){return dv({id:sv[e],name:cv[e]})}function mv(e){return{id:e,type:"composition"}}function pv(e){return{id:e,type:"media_reference"}}function gv(e,t,n){if(0===e.length)throw new Error("Expected at least one folder");const r=n.decodeReferencables(e),o=wp(r);return hv(r[r.length-1],o,t,n)}function hv({id:e,name:t,items:n},r,o,i){return{id:e,name:t,items:n.map((e=>{const t=i.decodeReferenceObjectId(e),n=r(t);return n?hv(n,r,o,i):o.has(t)?mv(t):pv(t)})),type:"folder"}}function vv(e,t){if(0===e.length)throw new Error("Expected at least one folder");const n=t.decodeReferencables(e),r=wp(n);return Ev(n[n.length-1],r,t)}function Ev({id:e,name:t,items:n},r,o){return{id:e,name:t,items:n.map((e=>{const t=o.decodeReferenceObjectId(e),n=r(t);return n?Ev(n,r,o):t}))}}function yv(e,t){const n=[];return Sv(e,n,t),n}function Sv({id:e,name:t,items:n},r,o){const i=n.map((e=>wv(e)?(Sv(e,r,o),o.encodeReferenceObject(e.id,xu.folder)):Cv(e)?o.encodeReferenceObject(e.id,xu.track):o.encodeReferenceObject(e.id,function(e,t){for(const n of ku)try{return t.encodeReferenceObject(e,n),n}catch{}throw new Error("Cannot determine ref type of object")}(e.id,o))));r.push(o.encodeReferencable({type:xu.folder,id:e,name:t,items:i}))}function Iv(e,t){const n=[];return bv(e,n,t),n}function bv({id:e,name:t,items:n},r,o){const i=n.map((e=>Mv(e)?(bv(e,r,o),o.encodeReferenceObject(e.id,xu.folder)):o.encodeReferenceObject(e,xu.track)));r.push(o.encodeReferencable({type:xu.folder,id:e,name:t,items:i}))}function Tv(e){return Av(e)?Mv(e):wv(e)}function wv(e){return"folder"===e.type}function Cv(e){return"composition"===e.type}function _v(e){return!iv(e,"type")}function Av(e){return!iv(e,"type")}function Rv(e){return Av(e)?Mv(e)?e.id:e:e.id}function Mv(e){return"string"!==typeof e}function Dv(e){return"string"===typeof e}const Ov=Me.fastDeepEqual;function xv(e,t){for(const n of e.items){if(Rv(n)===t)return e;if(Av(n)?Mv(n):wv(n)){const e=xv(n,t);if(void 0!==e)return e}}}function kv(e,t){if(e.id===t)return e;for(const n of e.items)if(Av(n)?Mv(n):wv(n)){const e=kv(n,t);if(void 0!==e)return e}}function Nv(e,t,n=e.items.length){if(Lv(e,t.id))throw new Error("Folder already contains item");if(n<0||n>e.items.length)throw new Error("Folder index out of bounds");n===e.items.length?e.items.push(t):e.items.splice(n,0,t)}function Pv(e,t,n=e.items.length){if(Lv(e,Rv(t)))throw new Error("Folder already contains item");if(n<0||n>e.items.length)throw new Error("Folder index out of bounds");n===e.items.length?e.items.push(t):e.items.splice(n,0,t)}function Lv(e,t,n=!1){if(_v(e))for(const r of e.items){if(Rv(r)===t)return!0;if(n&&Mv(r)&&Lv(r,t,!0))return!0}else for(const r of e.items){if(r.id===t)return!0;if(n&&wv(r)&&Lv(r,t,!0))return!0}return!1}function*Fv({items:e}){for(const t of e)yield t,wv(t)&&(yield*Fv(t))}function*Uv({items:e}){for(const t of e)yield t,Mv(t)&&(yield*Uv(t))}function Bv({items:e},t){const n=e.findIndex((e=>Rv(e)===t));if(!(n<0))return n}function jv(e,t,n=!1,r=!1){if(e.id===t)throw new Error("Cannot remove root");const o=Bv(e,t);if(void 0!==o){const t=e.items[o];if(wv(t)&&t.items.length>0&&!r)throw new Error("Cannot remove non-empty folder");return e.items.splice(o,1),{parentId:e.id,item:(0,T.Js)(t),index:o}}if(n)for(const i of e.items)if(wv(i)){const e=jv(i,t,!0,r);if(e)return e}}function Vv(e,t,n=!1,r=!1){if(e.id===t)throw new Error("Cannot remove root");const o=Bv(e,t);if(void 0!==o){const t=e.items[o];if(Mv(t)&&t.items.length>0&&!r)throw new Error("Cannot remove non-empty folder");return e.items.splice(o,1),{parentId:e.id,item:Dv(t)?t:(0,T.Js)(t),index:o}}if(n)for(const i of e.items)if(Mv(i)){const e=Vv(i,t,!0,r);if(e)return e}}function zv(e,t,n,r){if(e.id===t)throw new Error("Cannot move root");if(t===n)throw new Error("Cannot move item to its own subtree");const o=kv(e,t);if(o&&Lv(o,n,!0))throw new Error("Cannot move item to its own subtree");const i=kv(e,n);if(!i)throw new Error("Parent is not in tree");const a=i.id,s=Bv(i,t);if(void 0!==s){if(s===r)return;return _v(i)?function({items:e},t,n){const r=n>t?n-1:n;if(t<0||t>=e.length)throw new Error("Folder move index out of bounds");if(r<0||r>=e.length)throw new Error("Folder move toIndex out of bounds");e.splice(r,0,...e.splice(t,1))}(i,s,r):function({items:e},t,n){const r=n>t?n-1:n;if(t<0||t>=e.length)throw new Error("Folder move index out of bounds");if(r<0||r>=e.length)throw new Error("Folder move toIndex out of bounds");e.splice(r,0,...e.splice(t,1))}(i,s,r),{oldParentId:a,oldIndex:s,newParentId:a}}if(_v(e)!==_v(i))throw new Error("Cannot move item between legacy and non-legacy folders");if(_v(e)){const n=Vv(e,t,!0,!0);if(n&&_v(i))return Pv(i,n.item,r),{oldParentId:n.parentId,oldIndex:n.index,newParentId:a}}else{const n=jv(e,t,!0,!0);if(n&&!_v(i))return Nv(i,n.item,r),{oldParentId:n.parentId,oldIndex:n.index,newParentId:a}}}function Gv(e,t){return e.settings.defaultFolders?.[t]}function Wv(e,t){let n=Gv(e,t);if(void 0===n){const r=fv(t);n=r.id,e=function(e,t,n){return(0,T.ZP)(e,(e=>{e.settings.defaultFolders||(e.settings.defaultFolders={}),e.settings.defaultFolders[t]=n}))}(e=(0,T.ZP)(e,(e=>{const n="sequences"===t&&e.rootMediaFileFolder;Nv(n||"overdubs"===t&&e.rootMediaFileFolder||"recordings"===t&&e.rootMediaFileFolder||"stockMedia"===t&&e.rootMediaFileFolder||"aiAssets"===t&&e.rootMediaFileFolder||e.rootFolder,r,n?0:void 0)})),t,n)}return{doc:e,folderId:n}}function Hv(e,t){let n;if(Bg(t))if(Ag(t)){const t=Wv(e,"sequences");e=t.doc,n=t.folderId}else if(Ng(t)){const t=Wv(e,"overdubs");e=t.doc,n=t.folderId}else if(Pg(t)){const t=Wv(e,"recordings");e=t.doc,n=t.folderId}else if(function(e){return"cloudLibrary"===e.source?.split("_")[0]}(r=t)&&!Ug(r)){const t=Wv(e,"stockMedia");e=t.doc,n=t.folderId}else if(Ug(t)){const t=Wv(e,"aiAssets");e=t.doc,n=t.folderId}else{const t=Wv(e,"projectFiles");e=t.doc,n=t.folderId}else n=e.rootMediaFileFolder?.id||e.rootFolder.id;var r;return{doc:e,folderId:n}}const qv=em("folderSummaryCache");function $v(e,t,n){return Em(Kv,t,qv,e,n)}function Kv(e,t){const n={};fm(n,t.id,"folder",Gf(e).prop("id").path);const r=[{folder:t,location:e}];for(;r.length>0;){const e=r.shift();if(e){const{folder:t,location:o}=e,i=Gf(o);for(const[e,a]of t.items.entries()){switch(a.type){case"folder":fm(n,a.id,"folder",i.prop("items").item(e).prop("id").path);break;case"media_reference":mm(n,a.id,"mediaReference",i.prop("items").item(e).prop("id").path);break;case"composition":mm(n,a.id,"composition",i.prop("items").item(e).prop("id").path);break;default:throw new Error("Should never happen.")}"folder"===a.type&&r.push({folder:a,location:i.prop("items").item(e).path})}}}return n}function Yv(e,t,n,r){const o=void 0===t?e:kv(e,t);if(!o)throw new Error(`Folder ${t} not found`);Nv(o,n,r)}function Zv(e,t,n,r){return(0,T.ZP)(e,(e=>{const o=e.rootCompositionFolder||e.rootFolder;kv(o,n)?Yv(o,n,t,r):e.rootMediaFileFolder&&kv(e.rootMediaFileFolder,n)&&Yv(e.rootMediaFileFolder,n,t,r)}))}const Jv=(0,T.ZP)((function(e,t){const n=e.rootCompositionFolder||e.rootFolder;e.rootMediaFileFolder&&Lv(e.rootMediaFileFolder,t,!0)?jv(e.rootMediaFileFolder,t,!0):jv(n,t,!0),Vv(e.rootSceneFolder,t,!0)||Vv(e.rootMediaFolder,t,!0)}));function Qv(e,t,n,r){return(0,T.ZP)(e,(e=>{let o;const i=e.rootCompositionFolder||e.rootFolder;if(i&&kv(i,n)?o=i:e.rootMediaFileFolder&&kv(e.rootMediaFileFolder,n)?o=e.rootMediaFileFolder:kv(e.rootSceneFolder,n)?o=e.rootSceneFolder:kv(e.rootMediaFolder,n)&&(o=e.rootMediaFolder),o){const e=function(e,t){const n=[],r=[e],o=[...t];for(;o.length>0&&r.length>0;){const t=r.shift();if(t){const i=Rv(t),a=o.indexOf(i);t&&a>=0&&(n.push(i),o.splice(a,1)),Tv(t)&&kv(e,t.id)&&r.unshift(...t.items)}}return o.length>0&&n.push(...o),n}(o,t);!function(e,t,n,r){for(const o of t){const i=xv(e,o);let a=!0;if(i){if(t.find((e=>e===i.id)))continue;if(i.id===n){const e=Bv(i,o);if(void 0===e)throw new Error("Item not found");e<r&&(a=!1)}}zv(e,o,n,r),a&&r++}}(o,e,n,r)}}))}function Xv({pan:e}){return 0!==e?{pan:e}:{}}function eE({pan:e}){return{pan:void 0===e?0:e}}const tE=new Set;function nE(e,t,n=(0,ks.Z)().split("-").join("")){return`${e}-${n}${t}`}function rE(e){return`new-asset:///${e}`}function oE(e){try{return new URL(e)}catch(t){throw new Error(`Error parsing ${e}: ${t.message}`)}}const iE=new class{constructor({maxAge:e,pruneInterval:t,debugName:n,max:r,length:o}){this.prune=()=>{this.lru.prune()},this.lru=new(Zf())({maxAge:e,updateAgeOnGet:!0,max:r,length:o}),this.debugName=n,this.pruneInterval=t}set(e,t){this.lru.set(e,t)}get(e){return this.lru.get(e)}remove(e){this.lru.del(e)}clear(){this.lru.reset()}isValidCacheKey(e){return"string"===typeof e}start(){this.running||(tE.add(this),this.handle=setInterval(this.prune,this.pruneInterval))}stop(){void 0!==this.handle&&(tE.delete(this),clearInterval(this.handle),this.handle=void 0)}get running(){return void 0!==this.handle}}({pruneInterval:6e4,maxAge:6e4,debugName:"parseUrl"});function aE(e){return(0,at.basename)(function(e){return iE.running||iE.start(),qf(oE,e,iE,e)}(e).pathname)}function sE(e){return`${e}.json`}function cE(){return{url:rE(nE("alignment",".json"))}}function dE(e){const t=".m4a";return{url:rE(nE("scene_bounce",t,e&&e.endsWith(t)?(0,at.basename)(e,t):e)),is_bounced:!0,skip_encoding:!0}}function lE(e){return nE("media_original",(0,at.extname)(e))}function uE(e){if(void 0===e.artifact_local_id)return e;const{artifact_local_id:t,...n}=e;return n}function fE(e,t,n){return e.quality?.[t]===n?e:{...e,quality:{...e.quality||{},[t]:n}}}function mE(e){return e=function(e){if(void 0===e.local_id)return e;const{local_id:t,...n}=e;return n}(e),(e=uE(e)).quality?.original&&(e=fE(e,"original",uE(e.quality.original))),e.quality?.preview&&(e=fE(e,"preview",uE(e.quality.preview))),e}class pE{constructor(e={},t={}){this.allowExternals=!1,this.createNewIds=!1,this._encodeReferencables=new Map,this._decodeReferencables=new Set,this._decodeNewIds=new Map,this._decodeReboundReferenceId=new Map,this._externalReferences=new Map,this._deferredReferences=new Map,this._deferredDecodedIds=new Set,this.encodingOptions=e,this.decodingOptions=t}setDecodingOption(e,t){this.decodingOptions={...this.decodingOptions,[e]:t}}get hasExternalReferences(){return this._externalReferences.size>0}get externalReferences(){return this._externalReferences}rebindDecodeReferenceId(e,t){if(e!==t){if(!this._decodeReferencables.has(e))throw new Error(`Could not find reference ${e} to rebind`);if(this._decodeReboundReferenceId.has(e))throw new Error(`Attempting to rebind ${e} twice`);this._decodeReboundReferenceId.set(e,t)}}encodeReferencable(e){const{id:t,type:n}=e;if(this._encodeReferencables.has(t))throw new Error(`Already encoded ${t}`);if(this._externalReferences.has(t))throw new Error("Cannot encode reference without encoding object first");return this._encodeReferencables.set(t,n),e}encodeReferencables(e){return e.forEach(this.encodeReferencable.bind(this)),e}encodeReference(e,t,n=!1,r=!0){const o=this._encodeReferencables.get(e);if(void 0!==o&&n&&r)throw new Error(`Defer is set to true, but reference ${e} was already encoded`);if(void 0===o)if(n)this._deferredReferences.set(e,t);else{if(!this.allowExternals)throw new Error(`Cannot encode reference ${e} without encoding object first`);this._externalReferences.set(e,t)}else if(o!==t)throw new Error(`Attempting to encode reference ${e} to a different object type`);return e}encodeReferenceObject(e,t){return{type:xu.ref,ref:this.encodeReference(e,t)}}decodeReferencable(e){const{id:t}=e;if(this._decodeReferencables.has(t))throw new Error(`Already decoded reference ${t}`);if(this._decodeReferencables.add(t),this.createNewIds){const n=this._decodeNewIds.get(t)||Ps(),r={...e,id:n};return this._decodeNewIds.set(t,n),this._decodeReferencables.add(n),r}return e}decodeReferencables(e){return this.createNewIds?e.map((e=>this.decodeReferencable(e))):(e.forEach(this.decodeReferencable.bind(this)),e)}decodeReferenceId(e,t=!1){let n=!1,r=this._decodeNewIds.get(e);t&&this.createNewIds&&void 0===r&&(n=!0,r=Ps(),this._decodeNewIds.set(e,r));const o=this._decodeReboundReferenceId.get(void 0!==r?r:e);if(void 0!==o)return o;if((void 0===r||n)&&!this._decodeReferencables.has(e)){if(!t)throw new Error(`Attempting to decode unknown reference ${e}`);this._deferredDecodedIds.add(e)}return void 0!==r?r:e}decodeReferenceObjectId({ref:e}){return this.decodeReferenceId(e)}*getInvalidDeferredReferences(){for(const[e,t]of this._deferredReferences.entries())try{if(this.encodeReference(e,t)!==e)throw new Error(`Did not encode deferred reference: ${e}`)}catch(E0){yield{type:t,key:e,error:E0}}}get invalidDeferredReferences(){const e=new Map;for(const{key:t,type:n}of this.getInvalidDeferredReferences())e.set(t,n);return e}validateDeferredReferences(){for(const{error:e}of this.getInvalidDeferredReferences())throw e}get hasInvalidDeferredReferences(){return!as(this.getInvalidDeferredReferences())}validateDeferredDecodedIds(){this._deferredDecodedIds.forEach((e=>{this.decodeReferenceId(e)}))}}A.logging.groupLogger("descriptmodel/datacoderformodel");class gE extends pE{constructor(e,t,n,r=!1){super(),this.projectId=e,this.assetsMetadata=t,this.assetsJsons=n,this.regenerateAssetJsons=r,this._missingAssetMetadata=new Set,this._missingAssetJsons=new Set}get missingAssetMetadata(){return this._missingAssetMetadata}get missingAssetJsons(){return this._missingAssetJsons}encodedMetadataForAssetKey(e,t){const n=this.assetsMetadata[e]?.encoded;return void 0===n&&t&&this._missingAssetMetadata.add(e),n}decodedMetadataForAssetKey(e){const t=this.assetsMetadata[e]?.decoded;return t}hasAssetJson(e){return Boolean(this.assetsJsons[e])}assetJsonForAssetKey(e,t){const n=this.assetsJsons[e];return void 0===n&&t&&this._missingAssetJsons.add(e),n}}function hE(e,t,n){return n===e[t]?e:{...e,[t]:n}}function vE(e,t){let n;for(const[r,o]of Object.entries(e)){const i=t(r,o);i!==o&&(n||(n={...e}),n[r]=i)}return n||e}function EE(e){return Boolean(e.isStoryboard&&!0===e.settings.wordlessMediaEllipses)}function yE(e){return rB(e)?0:QU}const SE=bm(" "),IE=SE,bE=Object.freeze({[`\n${IE.string}`]:Cm(["\n",IE]),[`${IE.string}\n`]:Cm([IE,"\n"]),[`\n${IE.string}\n`]:Cm(["\n",IE,"\n"])});const TE=Object.freeze({hasPosition:!1,hasScale:!1,hasRotation:!1,hasBox:!1,hasOpacity:!1,hasTargetPosition:!1});var wE=(e=>(e.EaseInAndOut="ease-in-and-out",e.EaseIn="ease-in",e.EaseOut="ease-out",e.Linear="linear",e))(wE||{});function CE(e,t,n){return(1-n)*e+n*t}function _E(e,t,n,r){return e.map(((e,o)=>r(e,t[o],n)))}function AE(e,t,n){return _E(e,t,n,CE)}function RE(e){return{numeric:(t,n,r)=>e(t,n,r),numericArray:(t,n,r)=>_E(t,n,r,e),point2D:(t,n,r)=>({x:e(t.x,n.x,r),y:e(t.y,n.y,r)}),dimensions:(t,n,r)=>({width:e(t.width,n.width,r),height:e(t.height,n.height,r)}),cornerRadii:(t,n,r)=>({topLeft:e(t.topLeft,n.topLeft,r),topRight:e(t.topRight,n.topRight,r),bottomLeft:e(t.bottomLeft,n.bottomLeft,r),bottomRight:e(t.bottomRight,n.bottomRight,r)}),color:(t,n,r)=>function([e,t,n,r=255],[o,i,a,s=255],c,d=CE){0===r&&(e=o,t=i,n=a),0===s&&(o=e,i=t,a=n);const l=K(d(e,o,c),0,255),u=K(d(t,i,c),0,255),f=K(d(n,a,c),0,255),m=K(d(r,s,c),0,255);return 255===m?[l,u,f]:[l,u,f,m]}(t,n,r,e),legacyCompression:(t,n,r)=>({threshold:e(t.threshold,n.threshold,r),ratio:e(t.ratio,n.ratio,r),attack:e(t.attack,n.attack,r),release:e(t.release,n.release,r),knee:e(t.knee,n.knee,r)}),legacyEqualizer:(t,n,r)=>({gains:_E(t.gains,n.gains,r,e)})}}const ME=RE(CE),DE=RE((function(e,t,n){return e+(t-e)*n*n*n})),OE=RE((function(e,t,n){const r=n-1;return e+(t-e)*(r*r*r+1)})),xE=RE((function(e,t,n){return e+(t-e)*(n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1)})),kE=RE((function(e,t,n){return n<1?e:t})),NE={Numeric:{[wE.Linear]:ME.numeric,[wE.EaseIn]:DE.numeric,[wE.EaseOut]:OE.numeric,[wE.EaseInAndOut]:xE.numeric},NumericArray:{[wE.Linear]:ME.numericArray,[wE.EaseIn]:DE.numericArray,[wE.EaseOut]:OE.numericArray,[wE.EaseInAndOut]:xE.numericArray},Point2D:{[wE.Linear]:ME.point2D,[wE.EaseIn]:DE.point2D,[wE.EaseOut]:OE.point2D,[wE.EaseInAndOut]:xE.point2D},Dimensions:{[wE.Linear]:ME.dimensions,[wE.EaseIn]:DE.dimensions,[wE.EaseOut]:OE.dimensions,[wE.EaseInAndOut]:xE.dimensions},CornerRadii:{[wE.Linear]:ME.cornerRadii,[wE.EaseIn]:DE.cornerRadii,[wE.EaseOut]:OE.cornerRadii,[wE.EaseInAndOut]:xE.cornerRadii},Color:{[wE.Linear]:ME.color,[wE.EaseIn]:DE.color,[wE.EaseOut]:OE.color,[wE.EaseInAndOut]:xE.color},LegacyCompression:{[wE.Linear]:kE.legacyCompression,[wE.EaseIn]:kE.legacyCompression,[wE.EaseOut]:kE.legacyCompression,[wE.EaseInAndOut]:kE.legacyCompression},LegacyEqualizer:{[wE.Linear]:kE.legacyEqualizer,[wE.EaseIn]:kE.legacyEqualizer,[wE.EaseOut]:kE.legacyEqualizer,[wE.EaseInAndOut]:kE.legacyEqualizer}};function PE(e,t,n,r){function o(t,n=Ps(),r=!1){return{id:n,type:e,keyframes:t,isDisabled:r}}return Object.assign(o,{type:e,defaultValue:t,easingFunctions:n,isCompatible:r}),o}function LE(e,t,n,r){const o={offset:0,value:t};return void 0!==t&&null!==t||Ht(new Error(`Setting effect to invalid value: ${t}`),"makeStaticEffect",{extra:{effectType:e.type}}),e([o],n,r)}function FE(e,t){return(n,r)=>{const o=function(e,t){const n=ZP(e,t);return function(e,t){if(e.visual)return[SP(e.visual)];if(!t)return[];if(Tg(t))return["image"];const n=[];ON(e,t)&&n.push("video");RN(e,t)&&n.push("audio");return n}(t,n)}(n,r).some((t=>e.includes(t))),i=!t||!r.visual||t.includes(r.visual.type);return o&&i}}const UE=PE("anchor",{x:.5,y:.5},NE.Point2D,FE(["image","video"])),BE=UE.type,jE=PE("box",{width:.5,height:.5},NE.Dimensions,FE(["progress","shape","title","waveform"],["captions","title","dynamicText","rectangle","ellipse","progress","waveform"])),VE=jE.type,zE=PE("position",{x:.5,y:.5},NE.Point2D,FE(["image","title","video","shape","progress","waveform"])),GE=zE.type,WE=PE("scale",{x:1,y:1},NE.Point2D,FE(["image","video"])),HE=WE.type,qE=PE("targetPosition",{x:.5,y:.5},NE.Point2D,FE(["shape"])),$E=qE.type,KE=PE("rotation",0,NE.Numeric,FE(["shape","image","video","title"])),YE=KE.type,ZE=PE("contentAnchor",{x:.5,y:.5},NE.Point2D,FE(["image","video"])),JE=ZE.type,QE=PE("contentPosition",{x:.5,y:.5},NE.Point2D,FE(["image","video"])),XE=QE.type,ey=PE("contentScale",{x:1,y:1},NE.Point2D,FE(["image","video"])),ty=ey.type,ny=PE("contentRotation",0,NE.Numeric,FE(["image","video"])),ry=ny.type,oy=Object.freeze({position:zE.defaultValue,scale:WE.defaultValue,anchor:UE.defaultValue,rotation:KE.defaultValue}),iy=Object.freeze({contentAnchor:ZE.defaultValue,contentPosition:QE.defaultValue,contentScale:ey.defaultValue,contentRotation:ny.defaultValue}),ay=Object.freeze({...oy,...iy});function sy(e,t){return dy(ly(e,t),t)}function cy(e,t){const n=sy(e.offset,t);return{offset:n,duration:sy(e.offset+e.duration,t)-n}}function dy(e,{framerateNumerator:t,framerateDenominator:n}){return e*n/t}function ly(e,{framerateNumerator:t,framerateDenominator:n}){return Math.floor(Math.round(e*t*1e3)/n/1e3)}function uy(e,t,n){return ly(e,n)===ly(t,n)}function fy(e,t,n){return ly(e,n)<=ly(t,n)}const my={framerateNumerator:30,framerateDenominator:1};function py({framerateNumerator:e,framerateDenominator:t}){return e/t}new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2});function gy(e,t){return Ey(e,t,my,!1).transform}const hy=[zE,WE,UE,jE,KE,qE,ZE,QE,ey,ny],vy=(0,fp.PW)((()=>new Map(hy.map((e=>[e.type,e])))));function Ey(e,t,n,r){const o=vy(),i={...ay};let a=r;for(const s of e.effects){const e=o.get(s.type);if(!e)continue;const r=yy(s,e,t,n,a);i[s.type]=r.value,a=a&&r.valueIsStatic}return i.rotation=he(i.rotation),{isStatic:a,transform:i}}function yy(e,t,n,r,o){const{defaultValue:i}=t;if(e.isDisabled)return{valueIsStatic:o,value:i};const{keyframes:a}=e,s=rU(a,n,t)??i;if(a.length<2||!o)return{valueIsStatic:o,value:s};const c=dy(1,r);return{valueIsStatic:s===(rU(a,n+c,t)??i)||s===(rU(a,n-c,t)??i),value:s}}function Sy(e,t){const{type:n,layerId:r,timeOffset:o}=e;return{anchorType:n,layerId:t.encodeReference(r,xu.cardLayer),timeOffset:o}}function Iy(e,t){const{anchorType:n,layerId:r,timeOffset:o}=e;return{type:n,layerId:t.decodeReferenceId(r),timeOffset:o}}function by(e,t){const{id:n,anchor:r,keyframes:o}=e;return{id:n,anchor:Sy(r,t),keyframes:o}}function Ty(e,t){const{id:n,anchor:r,keyframes:o}=e;return{id:n,anchor:Iy(r,t),keyframes:o}}function wy({name:e="Untitled",videoMetadata:t,gain:n=1,pan:r=0,isMuted:o=!1,isSoloed:i=!1,timeline:a=Bx({}),effects:s=[],storyboardCues:c,suppressRoomtone:d=!1,duckingParameters:l}={}){return{name:e,videoMetadata:t,gain:n,pan:r,isMuted:o,isSoloed:i,timeline:a,effects:s,storyboardCues:c,suppressRoomtone:d,duckingParameters:l}}function Cy({id:e=Ps(),...t}={}){return{...wy(t),id:e,type:Jh.Composition,changedSinceLastPublish:t.changedSinceLastPublish,fileMetadata:t.fileMetadata,isVideo:t.isVideo??!1}}function _y({id:e=Ps(),...t}={}){return{...wy(t),id:e,type:Jh.Pin,headTransition:t.headTransition,tailTransition:t.tailTransition}}function Ay({id:e=Ps(),...t}={}){return{...wy(t),id:e,type:Jh.Sequence,includeTranscript:t.includeTranscript??!0}}function Ry({id:e=Ps(),...t}){return{...wy(t),id:e,type:Jh.Transcript,transcriptVoiceoverRefId:t.transcriptVoiceoverRefId,effects:[]}}function My({id:e=Ps(),originalTextRange:t,...n}){return{...wy(n),id:e,type:Jh.Restorable,originalTextRange:t}}function Dy(e,t){const{id:n,name:r,timeline:o,videoMetadata:i,isMuted:a,isSoloed:s,effects:c,storyboardCues:d,suppressRoomtone:l,duckingParameters:u}=e,f=e.type===Jh.Composition?e.isVideo:void 0,m=e.type===Jh.Composition&&e.fileMetadata?function(e,t){const n=void 0!==e.artworkRefId?rF(e.artworkRefId,t):void 0;if(n!==e.artworkRefId)return{...e,artworkRefId:n};return e}(e.fileMetadata,t):void 0,p=e.type===Jh.Composition?e.changedSinceLastPublish:void 0,g=e.type===Jh.Transcript?e.transcriptVoiceoverRefId:void 0,h=e.type!==Jh.Transcript&&c.length>0?aU(c,t):void 0,v=e.type===Jh.Composition&&d?d.map((e=>by(e,t))):void 0,E=e.type===Jh.Sequence?e.includeTranscript:void 0,y=e.type===Jh.Restorable?e.originalTextRange:void 0;return{type:xu.track,id:n,name:r,timeline:jx(o,t),...i&&{videoWidth:Math.trunc(i.width),videoHeight:Math.trunc(i.height),videoFramerateNumerator:Math.trunc(i.framerateNumerator),videoFramerateDenominator:Math.trunc(i.framerateDenominator)},isVideo:f,changedSinceLastPublish:p,fileMetadata:m,transcriptVoiceoverRef:g&&rF(g,t),...hh(e),...Xv(e),isMuted:!!a||void 0,isSoloed:!!s||void 0,effects:h,suppressRoomtone:!!l||void 0,duckingParameters:u,storyboardCues:v,includeTranscript:E,originalTextRange:y}}function Oy({id:e,name:t,timeline:n,videoWidth:r,videoHeight:o,videoFramerateNumerator:i,videoFramerateDenominator:a,gain:s=1,pan:c=0,isMuted:d=!1,isSoloed:l=!1,effects:u=[],suppressRoomtone:f=!1,duckingParameters:m},p){return{id:e,...wy({name:t,timeline:Vx(n,p),gain:s,pan:c,isMuted:d,isSoloed:l,effects:cU(u,p),storyboardCues:void 0,videoMetadata:void 0!==r&&void 0!==o&&void 0!==i&&void 0!==a?{width:r,height:o,framerateNumerator:i,framerateDenominator:a}:void 0,suppressRoomtone:f,duckingParameters:m})}}function xy(e,t){const n=void 0!==e.transcriptVoiceoverRef?t.decodeReferenceId(e.transcriptVoiceoverRef):void 0;if(void 0===n)throw new Error(`Cannot decode transcript without transcript voiceover ref: ${e.id}`);return Ry({...Oy(e=(0,T.Uy)(e,(e=>{e.timeline.noAudioTrack&&e.timeline.noAudioTrack.components.length>0&&(e.timeline.noAudioTrack.components=[])})),t),transcriptVoiceoverRefId:n})}function ky(e,t){return _y(Oy(e,t))}function Ny(e,t){return Ay({...Oy(e,t),includeTranscript:e.includeTranscript})}function Py(e,t){if(!e.originalTextRange)throw new Error("Cannot decode restorableTrack without an originalTextRange");return My({...Oy(e,t),originalTextRange:e.originalTextRange})}function Ly({width:e,height:t,rotation:n}){return function(e=0){switch(he(e)){case 0:case 180:return!1;case 90:case 270:return!0;default:throw new Error(`Unexpected non-90 degree rotation: ${e}`)}}(n)?{width:t,height:e}:{width:e,height:t}}function Fy(e){const{width:t,height:n}=Ly(e);return function({width:e,height:t,framerateNumerator:n,framerateDenominator:r,rotation:o}){return void 0===o?{width:e,height:t,framerateNumerator:n,framerateDenominator:r}:{width:e,height:t,framerateNumerator:n,framerateDenominator:r,rotation:o}}({...e,rotation:void 0,width:t,height:n})}var Uy=(e=>(e[e.Linear=0]="Linear",e[e.Exponential=1]="Exponential",e))(Uy||{});const By=PE("pan",0,NE.Numeric,FE(["audio"])),jy=By.type,Vy=PE("volume",1,NE.Numeric,FE(["audio"])),zy=Vy.type,Gy=PE("opacity",1,NE.Numeric,FE(["image","video","shape","title","progress","waveform"])),Wy=Gy.type;var Hy=(e=>(e.BACKGROUND_REMOVAL="com.descript.backgroundRemoval",e.EYE_CONTACT="com.descript.eyeContact",e))(Hy||{});function qy(e,t,n){function r(t,n=Ps(),r=!1){return{type:e,id:n,keyframes:t,isDisabled:r}}return Object.assign(r,{type:e,defaultValue:t,interpolate:n,isCompatible:FE(["shape","image","video","title"])}),r}function $y(e){let t=!1;return e.keyframes.every((e=>{const t=e.value;return!!Array.isArray(t)&&t.every((e=>"number"===typeof e))}))&&(t=!0),t}function Ky(e,t){return bk(e,t)?"script":xk(e,t)}const Yy="script";function*Zy(e){for(let t=e.length-1;t>=0;t--)yield e[t].id;yield Yy}function Jy(e){return Array.from(Zy(e))}const Qy=em("defaultLayerOrder");function Xy(e,t){const n=Wx(e,t);if(n.layerOrder)return n.layerOrder;return function(e,t){return qf(Jy,e,Qy,t.pins.components)}(sm(e,t),n)}function eS(e,t){if(!t)return!0;if(t.length!==e.length+1)return!1;const n=new Set(Zy(e));for(const r of t)if(!n.delete(r))return!1;return 0===n.size}function tS(e,t){if(!eS(e.pins.components,t))throw new Error("Layer order is not valid for timeline");return e.layerOrder===t?e:{...e,layerOrder:t}}function nS(e,t){if(eS(e,t)||!t)return t;const n=new Set(Zy(e)),r=Array.from(Ja(t,(e=>n.delete(e))));return Array.from(ss([n,r]))}const rS=em("ensuredValidLayerOrder");function oS(e,t){if(e){for(const n of e)n!==Yy&&t.encodeReference(n,xu.pinComponent);return e}}function iS(e,t){if(e)return hu(e,(e=>e===Yy?e:t.decodeReferenceId(e)))}function aS(e,t){const n={};return e?(e.forEach(((e,r)=>{e!==Yy&&mm(n,e,"component",Gf(t).item(r).path)})),n):n}function sS(e,t,n){const r=Wx(e,t).layerOrder;if(!r)return;const o=new Set([Yy]);for(const i of n)PB(i)&&o.add(i.id);return r.filter((e=>o.has(e)))}function cS(e,t){if(0===t.length)return e;const n=new Set(t),r=e.filter((e=>e===Yy||!n.has(e)));let o=r.indexOf(Yy);-1===o&&(r.push(Yy),o=r.length-1);let i=t.indexOf(Yy);-1===i&&(i=t.length);const a=t.slice(0,i),s=t.slice(i+1);return r.splice(o+1,0,...s),r.splice(o,0,...a),e||1!==r.length||r[0]!==Yy?r:void 0}var dS=(e=>(e.Gap="Gap",e.Clip="Clip",e))(dS||{});function lS(e){return"track"===e.type}function uS(e){return"group"===e.type}function fS(e,t){return{...e,tracks:fu(e.tracks,(e=>uS(e)?fS(e,t):t(e)))}}function mS(e){const t=[];return e.tracks.forEach((e=>{uS(e)?t.push(...mS(e)):t.push(e)})),t}function pS(e){let t=0;return()=>`${e}-${t++}`}function gS(e){let t=e;if("#"===e.charAt(0)&&(t=e.substring(1)),3===t.length||4===t.length){let e="";for(const n of t)e+=n+n;t=e}const n=parseInt(t,16),r=8===t.length;return{r:n>>(r?24:16)&255,g:n>>(r?16:8)&255,b:n>>(r?8:0)&255,a:r?255&n:void 0}}A.logging.groupLogger("descriptmodel/colors");function hS(e){const{r:t,g:n,b:r,a:o}=gS(e);return void 0===o?[t,n,r]:[t,n,r,o]}function vS(e){const[t,n,r,o]=e,i=(void 0===o?1:o/255).toFixed(3);return"0.000"===i?"transparent":"1.000"!==i?`rgba(${t}, ${n}, ${r}, ${i})`:`rgb(${t}, ${n}, ${r})`}const ES=/rgb(a?)\((.*?),(.*?),(.*?)(?:,(.*?))?\)/;function yS(e){const t=e.match(ES)||[],n="a"===t[1],r=parseInt(t[2],10),o=parseInt(t[3],10),i=parseInt(t[4],10),a=n&&void 0!==t[5]?Math.round(255*parseFloat(t[5])):void 0;return void 0!==a&&a<255?[r,o,i,a]:[r,o,i]}function SS(e){const t=Math.round(e).toString(16);return 1===t.length?`0${t}`:t}function IS(e){return`#${e.map(SS).join("")}`}const bS=[0,0,0,0],TS=[255,255,255],wS=Me.fastDeepEqualJson;const CS=PE("fillColor",bS,NE.Color,FE(["shape","title","progress","waveform"],["captions","title","dynamicText","rectangle","ellipse","progress","waveform"])),_S=CS.type,AS=PE("bgColor",bS,NE.Color,FE(["progress","title"])),RS=AS.type,MS=PE("shadowColor",bS,NE.Color,FE(["progress","title","shape","waveform"])),DS=MS.type,OS=PE("activeWordFillColor",bS,NE.Color,FE(["title"],["captions"])),xS=OS.type,kS=PE("futureWordFillColor",bS,NE.Color,FE(["title"],["captions"])),NS=kS.type,PS=PE("playheadBackgroundColor",bS,NE.Color,FE(["title"],["captions"])),LS=PS.type,FS=PE("strokeColor",bS,NE.Color,((e,t)=>("progress"!==t.visual?.type||"ring"!==t.visual.style)&&FE(["progress","shape","title","waveform"])(e,t))),US=FS.type,BS=PE("activeWordStrokeColor",bS,NE.Color,((e,t)=>FE(["title"],["captions"])(e,t))),jS=BS.type,VS=PE("futureWordStrokeColor",bS,NE.Color,((e,t)=>FE(["title"],["captions"])(e,t))),zS=VS.type,GS=PE("strokeWidth",0,NE.Numeric,FE(["progress","shape","title","waveform"])),WS=GS.type,HS=PE("activeWordStrokeWidth",10,NE.Numeric,FE(["title"],["captions"])),qS=HS.type,$S=PE("futureWordStrokeWidth",10,NE.Numeric,FE(["title"],["captions"])),KS=$S.type,YS=PE("shadowOffset",{x:0,y:0},NE.Point2D,FE(["progress","title","shape"])),ZS=YS.type,JS=PE("shadowBlur",0,NE.Numeric,FE(["progress","title","shape"])),QS=JS.type,XS=PE("compressor",{threshold:-16,ratio:3,attack:.01,release:.19,knee:4},NE.LegacyCompression,FE(["audio"])),eI=XS.type,tI=PE("eq10band",{gains:[0,0,0,0,0,0,0,0,0,0]},NE.LegacyEqualizer,FE(["audio"])),nI=tI.type,rI=PE("roundedCorners",{topLeft:0,topRight:0,bottomLeft:0,bottomRight:0},NE.CornerRadii,FE(["image","video"])),oI=rI.type,iI=[CS,FS,BS,VS,AS,MS,OS,kS,PS],aI=[UE,zE,WE,KE,Gy,jE,qE,rI,ZE,QE,ey,ny,GS,JS,YS,HS,$S,...iI],sI=new Set(aI.map((({type:e})=>e)));const cI=[...[Vy,By],...aI];function dI(e){return cI.some((t=>t.type===e))}const lI=new Set(iI.map((({type:e})=>e))),uI={[BE]:UE,[GE]:zE,[HE]:WE,[YE]:KE,[oI]:rI,[JE]:ZE,[XE]:QE,[ty]:ey,[ry]:ny,[Wy]:Gy,[zy]:Vy,[jy]:By,[eI]:XS,[nI]:tI,[VE]:jE,[$E]:qE,[_S]:CS,[US]:FS,[WS]:GS,[qS]:HS,[KS]:$S,[jS]:BS,[zS]:VS,[RS]:AS,[QS]:JS,[DS]:MS,[ZS]:YS,[xS]:OS,[NS]:kS,[LS]:PS};function fI(e){return e in uI}function mI(e){return function(e,t){const n=eU(e,t);if(!n)return e;const r=function({audioFades:e,videoFades:t,offset:n,duration:r}){const o=Math.min(e?.fadeInDuration||0,t?.fadeInDuration||0),i=Math.min(e?.fadeOutDuration||0,t?.fadeOutDuration||0);return lp({offset:n,duration:r},o,i)}(e),o=GF(n,r);if(o===n)return e;return o?ZF(e,o):QF(e,t.type)}(e,Vy)}function pI(e,t){return 0===e.effects.length?t.effects:0===t.effects.length?e.effects:fu(cI,(n=>{const r=function(e,t,n){const r=eU(e,n),o=eU(t,n);if(!o||0===o.keyframes.length)return r;if(!r||0===r.keyframes.length)return o;let i=r.keyframes,a=o.keyframes;const s=i[i.length-1],c=s.offset,d=a.findIndex((({offset:e})=>VF(e,c)));if(-1===d)return r;a=a.slice(d);const l=a[0],u=l.offset;BF(c,u)&&(a=a.slice(1),i.length>1&&(0,Me.fastDeepEqualJson)(s.value,l.value)&&(i=i.slice(0,i.length-1)));return{...r,keyframes:[...i,...a]}}(e,t,n);if(r&&0!==r.keyframes.length)return r}))}function gI(e,t){return(0,T.ZP)(e,(e=>{e.isBlocked=t}))}function hI(e,t){return(0,T.ZP)(e,(e=>{e.defaultSpeaker=t}))}function vI(e,t,n,r,o=!0,i=!1){const a=GV(e,t).tausAndDataBasic().getTauData(n);if(a.isScratchText)return;const s=a.tau,c=s.audioSegment;if(!c)return;r={...r,offset:Math.max(0,r.offset)};let d=Im,l=0;const u=function(e,t,n,r,o,i,a=!1){if(!nN(e,t,n))return;const s=XP(e,t,n);if(!s)return;const c=s.voiceover.metadata.alignment;if(!c)return;const d=wP(e,t,n),l=gL(zg(c),o,i);let u;vk(e,t).type!==Jh.Transcript&&(u=bG(e,s.id));const f=d.audioSegment&&hd(d.audioSegment.offset+d.audioSegment.duration,o+i),m=hd(i,0),p=DL(l,r,{subAlignmentTimeRange:{offset:o,duration:i},transcriptTrackAndDoc:u&&{transcriptTrack:u,doc:e},allowEmptyString:m,previousAlignment:void 0,preferSuffix:f,ignoreNewline:a});if(""===p.attributedString.string||" "===p.attributedString.string)return p;const g=function(e,t,n,r,o,i){const a=e&&hd(e.offset+e.duration,r+o),s=e&&hd(e.offset,r),c=e&&e.duration>o;if(s&&c){let e=nc(n.string,t.attributedString.string);i||0!==e||(e=1);return{attributedString:xm(t.attributedString,Gs.get(0,e)),headDelta:0,insertionRange:Gs.get(e,n.string.length-e),newCharacters:t.newCharacters,droppedAttributes:t.droppedAttributes}}if(a&&c){let e=rc(n.string,t.attributedString.string);const r=n.string.length;for(;e>0&&!Ms.contains(n.string.charAt(r-e))&&"\n"!==n.string.charAt(r-e);)e-=1;i||0!==e||(e=1);return{attributedString:xm(t.attributedString,Gs.get(t.attributedString.string.length-e,e)),headDelta:-(r-e),insertionRange:Gs.get(0,r-e),newCharacters:t.newCharacters,droppedAttributes:t.droppedAttributes}}return t}(d.audioSegment,p,r,o,i,m);if(a||0===g.attributedString.string.length||void 0!==Cs.index(g.attributedString.string))return g;const h=new Set,v=g.attributedString.attributes.map((e=>({...e,range:Gs.get(0,1)}))).filter((e=>!h.has(e.attribute.name)&&(h.add(e.attribute.name),!0)));return{...g,attributedString:bm(" ",v)}}(e,t,n,s.text,r.offset,r.duration,i);if(u)d=u.attributedString,l=u.headDelta;else if(!s.isScriptClip)return;let f=hF({...c,...r});o&&(f=mI(f),f=_w(e,t,n,f));return{tau:JM({text:d,audioSegment:f,isScriptClip:s.isScriptClip,ignoreAlignment:s.ignoreAlignment,isBlocked:s.isBlocked,recordingSession:s.recordingSession,visual:s.visual}),textOffsetDelta:l,timeOffsetDelta:c.offset-f.offset}}function EI(e,t,n=(e=>{throw e})){if(e instanceof Promise)return e.then(t).catch(n);try{return t(e,!0)}catch(r){return n(r)}}const yI=Object.freeze({duration:0,trackGroups:[],videoMetadata:void 0,effects:[],gain:1,pan:0});function SI({trackGroups:e}){const t=new Set;for(const n of e)II(n,t);return t}function II(e,t){for(const n of e.tracks)if(uS(n))II(n,t);else for(const e of n.segments)e.type===dS.Clip&&void 0!==e.audioSegment.mediaRefId&&t.add(e.audioSegment.mediaRefId)}function bI(e){return Array.isArray(e)?hu(e,bI):null===e||"object"!==typeof e?e:vE(e,((e,t)=>"id"===e?"[id]":bI(t)))}function TI(e){const t=Np(e);return e=>{const n=t(e);if(n)return function(e){if(e.assetJson)return e.assetJson.md5||e.assetJson.url}(n)}}function wI(e,t){const n=[],r=new Map;return SI(e).forEach((e=>{const o=t(e);void 0!==o&&(n.push(o),r.set(e,o))})),e=bI(e=hE(e,"trackGroups",hu(e.trackGroups,(e=>CI(e,r))))),JSON.stringify({tl:e,refs:n})}function CI(e,t){return hE(e,"tracks",hu(e.tracks,(e=>uS(e)?CI(e,t):function(e,t){return hE(e,"segments",hu(e.segments,(e=>e.type===dS.Clip&&e.audioSegment.mediaRefId?hE(e,"audioSegment",MF(e.audioSegment,t.get(e.audioSegment.mediaRefId)??e.audioSegment.mediaRefId)):e)))}(e,t))))}function*_I({trackGroups:e}){for(const t of e)yield*AI(t)}function*AI(e){for(const t of e.tracks)uS(t)?yield*AI(t):lS(t)&&(yield t)}function RI(e,t){const n=cp(t,e);if(!n)return;if(function(e,t,n){return e===t||hd(e.offset,t.offset,n)&&hd(e.duration,t.duration,n)}(n,e))return{...e,offset:Math.max(0,e.offset-t.offset)};if(e.type===dS.Gap)return{...e,duration:n.duration,offset:Math.max(0,e.offset-t.offset)};let r=e.audioSegment,o=e.duration;if(!hd(n.duration,o)){o=n.duration;r=RF(r,n.duration*r.speed)}if(!hd(n.offset,e.offset)){const n=t.offset-e.offset;r=AF(r,r.offset+n*r.speed)}return r!==e.audioSegment&&(r=mI(r)),{...e,audioSegment:r,offset:Math.max(0,e.offset-t.offset),duration:o}}function MI(e,t){const n=fu(e.trackGroups,(e=>{const n=fS(e,(e=>function(e,t){if(e.duration<t.offset)return;const n=fu(e.segments,(e=>RI(e,t)));if(0===n.length)return;const r=e.duration,o=Math.min(r-t.offset,t.duration),i=rp(n[n.length-1]);return i<o&&!hd(i,o)&&n.push({type:dS.Gap,offset:i,duration:o-i,id:Ps()}),{...e,segments:n,duration:o}}(e,t)));if(0!==n.tracks.length)return n}));if(0!==n.length)return{...e,trackGroups:n,duration:t.duration}}function DI(e,t=.005){return hE(e,"trackGroups",hu(e.trackGroups,(e=>OI(e,t))))}function OI(e,t){const n=-t,r=hu(e.tracks,(e=>{if(uS(e))return OI(e,t);const r=e;let o;const i=hu(r.segments,((e,i)=>{if(e.type===dS.Clip){let a=e.audioSegment;if(void 0===e.audioSegment.audioFades?.fadeInDuration){const e=o?n:t;a={...a,audioFades:gh({...a.audioFades,fadeInDuration:e})}}if(void 0===e.audioSegment.audioFades?.fadeOutDuration){const e=(i+1<r.segments.length?r.segments[i+1]:void 0)?.type===dS.Clip?n:t;a={...a,audioFades:gh({...a.audioFades,fadeOutDuration:e})}}e=hE(e,"audioSegment",a),o=e}else o=void 0;return e}));return hE(e,"segments",i)}));return hE(e,"tracks",r)}var xI=(e=>(e[e.Responder=0]="Responder",e[e.Controller=1]="Controller",e))(xI||{});const kI=A.logging.groupLogger("descriptmodel/createduckingparameters");function NI(e){return e.duckingParameters?.type===xI.Controller?void 0:Vy([],`${e.id}:duckingEffect`)}function PI(e){const t=[...e],n=[],r=[];if(e.forEach(((e,t)=>{LI(e,t,[],n,r)})),n.length){const e=function(e){const t=[];for(const n of e)for(const e of n.segments){if(e.type===dS.Gap||!0===e.isRoomtone||!e.hasAudioData)continue;const r={timeRange:{offset:e.offset,duration:e.duration},gainReduction:n.duckingParameters?.gainReductionAmount??0};t.push(r)}t.sort(((e,t)=>e.timeRange.offset===t.timeRange.offset?e.timeRange.duration===t.timeRange.duration?e.gainReduction-t.gainReduction:e.timeRange.duration-t.timeRange.duration:e.timeRange.offset-t.timeRange.offset));for(let n=t.length-1;n>0;--n){const e=t[n],r=t[n-1],o=rp(r.timeRange);if((0,Me.fastDeepEqualJson)(r.timeRange,e.timeRange))e.gainReduction<r.gainReduction&&(t[n-1]={...r,gainReduction:e.gainReduction}),t.splice(n,1);else{if(!(o>=e.timeRange.offset))continue;if(hd(r.gainReduction,e.gainReduction))t[n-1]={...r,timeRange:up(r.timeRange,e.timeRange)},t.splice(n,1);else if(r.gainReduction<e.gainReduction){const r=o-e.timeRange.offset;r<e.timeRange.duration?t[n]={...e,timeRange:{offset:e.timeRange.offset+r,duration:e.timeRange.duration-r}}:(t.splice(n,1),n<t.length&&++n)}else{const i=o-e.timeRange.offset;i<r.timeRange.duration?t[n-1]={...r,timeRange:{offset:r.timeRange.offset,duration:r.timeRange.duration-i}}:t.splice(n-1,1)}}}return t}(n);for(const{groupIndex:n,trackIndexPath:o}of r){const r=FI(t[n],o,(t=>UI(t,e)));t[n]=r}}else for(const{groupIndex:o,trackIndexPath:i}of r){const e=FI(t[o],i,(e=>e.duckingEffect?{...e,duckingEffect:{...e.duckingEffect,keyframes:[],isDisabled:!0}}:e));t[o]=e}return t}function LI(e,t,n,r,o){e.tracks.forEach(((e,i)=>{const a=[...n,i];lS(e)?e.duckingParameters?.type===xI.Controller?r.push(e):o.push({groupIndex:t,trackIndexPath:a,track:e}):LI(e,t,a,r,o)}))}function FI(e,t,n){if(0===t.length)throw new Error("Invalid trackIndexPath");const r=e.tracks[t[0]];let o;if(uS(r))o=FI(r,t.slice(1),n);else{if(1!==t.length)throw new Error("Invalid trackIndexPath");o=n(r)}const i=[...e.tracks];return i[t[0]]=o,{...e,tracks:i}}function UI(e,t){let n=e;if(n.duckingEffect&&t.length>0){const r=[],o=function(e){const t=r.length?r[r.length-1]:void 0;t&&hd(t.offset,e.offset)?hd(t.value,e.value)||(r[r.length-1]={...t,value:Math.min(t.value,e.value)}):!t||t.offset<=e.offset?r.push(e):kI.error("Overlapping ducking keyframes")};let i=1;for(const[e,n]of t.entries()){const r=Math.min(n.timeRange.duration,1);let a=n.gainReduction;if(r<1){a=(0,Vy.easingFunctions.linear)(i,n.gainReduction,r/1)}if(0===n.timeRange.offset?o({offset:n.timeRange.offset,value:n.gainReduction}):(o({offset:n.timeRange.offset,value:i}),o({offset:n.timeRange.offset+r,value:a})),o({offset:rp(n.timeRange),value:a}),e<t.length-1){t[e+1].timeRange.offset-rp(n.timeRange)<1?i=a:(o({offset:rp(n.timeRange)+1,value:1}),i=1)}else o({offset:rp(n.timeRange)+1,value:1})}n={...e,duckingEffect:Vy(r,n.duckingEffect.id)}}return n}const{lessThanFrameCount:BI,greaterThanOrEqualFrameCounts:jI,lessThanOrEqualFrameCounts:VI}=s,zI=Object.freeze({video:void 0,forceSequenceTrackRecomputation:!1,roomtoneFades:!0,audioDucking:!0,legacyCrossfades:!1});function GI(e,t){return Math.max(1,t.audio.trackSceneIds.reduce(((t,n)=>{const r=vk(e,n);return r.suppressRoomtone||!function(e,t){const{tausData:n}=GV(e,t).tausAndDataBasic();return n.some((e=>RN(e.tau,e.ref)))}(e,r.id)?t:t+1}),0))}const WI=em("sequenceTrackCountForRoomtoneScalingCache");function HI(e,t){return qf(GI,rm(e.projectId,t.id),WI,e,t)}const qI=(0,Yl.createCachedSelector)((e=>e),((e,t)=>vk(e,t)),((e,t)=>{const n=[{type:"standard"}],r=new Set;for(const o of bP(e,t.id)){if(o.isBlocked)continue;const i=JP(e,t.id,o.id);if(i&&Ag(i)){const t=HI(e,i);for(let e=0;e<i.audio.trackSceneIds.length;e++){const o=i.audio.trackSceneIds[e];r.has(o)||(n.push({type:"sequence-track",sequenceRefId:i.id,sequenceTrackIndex:e,sequenceTrackCountForRoomtoneScaling:t}),r.add(o))}}}return n}))({...yp("getTrackListing"),keySelector:sm});function $I(e,t,n,r){const o=[],i=function({offset:e,duration:t,audioFades:n,speed:r},o){if(!n)return;const{fadeInDuration:i=0,fadeOutDuration:a=0}=n;if(0===i&&0===a)return;const s=t,c=[];if(i>0){const t=e,n=e+i*r;hd(t,n)||c.push({offset:t,value:0},{offset:n,value:1})}if(a>0){const t=e+s,n=t-a*r,o=t;hd(n,o)||c.push({offset:n,value:1},{offset:o,value:0})}return c.length>0?Vy(c,o()):void 0}(e,r);if(i){const e=GF(i,t);if(e){const t=KF(e,n);t&&YF(t,Vy)&&o.push(t)}}for(const a of e.effects){let e=a;if((a.type===zy||a.type===jy||a.type===YE||a.type===Wy||$y(a))&&(e=GF(a,t)),e){const t=KF(e,n);t&&o.push(t)}}return o}function KI(e,t,n,r){const o=n.offset-t.offset,i=$I(e,lp(t,n.audioFades?.fadeInDuration,n.audioFades?.fadeOutDuration),o,r);if(i.length>0){const e=[...n.effects,...i];return{...n,effects:e}}return n}function YI(e){return e.type===dS.Clip?e.audioSegment.speed:1}function ZI(e,t,n,r,o,i){return void 0!==t&&t<0&&hd(i.offset,o.offset)&&(e={...e,audioFades:gh({...e.audioFades,fadeInDuration:t*r})}),void 0!==n&&n<0&&hd(rp(i),rp(o))&&(e={...e,audioFades:gh({...e.audioFades,fadeOutDuration:n*r})}),e}function JI(e,t,n,r){let o=0;const{speed:i,offset:a}=t,s=rp(t),{fadeInDuration:c,fadeOutDuration:d}=t.audioFades||{},l=nh(zg(e),uh(t,np,rp));const u=[];for(let m of Kg(l)){if(t.isFreezeFrame){const e=t.duration/i;if(m.type===dS.Clip){const t=m.audioSegment.isFreezeFrame?m.audioSegment.offset:m.audioSegment.offset+(a-m.offset);m={...m,audioSegment:{...m.audioSegment,isFreezeFrame:!0,offset:t,duration:e}}}u.push({...m,duration:e}),o=e;break}if(jI(m.offset,a)&&VI(rp(m),s)){if(m.type===dS.Clip&&void 0!==m.audioSegment.mediaRefId){let e=KI(t,m,m.audioSegment,r);e=ZI(e,c,d,i,m,t),e=kF(e,e.speed*i),e===m.audioSegment&&1===i||(m={...m,audioSegment:e,parentSpeed:i})}1!==i&&(m={...m,duration:m.duration/i}),u.push(m),o+=m.duration;continue}const e=YI(m),n=dp(m,a,s),l=n.duration/i;if(m.type===dS.Clip){let o=m.audioSegment,a=!1,s=!1;if(n.offset>m.offset){const t=(n.offset-m.offset)*e;o=AF(o,o.offset+t),a=!0}if(n.duration<m.duration){o=RF(o,n.duration*e),BI(rp(n),rp(m))&&(s=!0)}if(o.audioFades&&(s||a)){const e=o.audioFades,t=a&&s?void 0:gh({fadeInDuration:a?void 0:e.fadeInDuration,fadeInShape:a?void 0:e.fadeInShape,fadeOutDuration:s?void 0:e.fadeOutDuration,fadeOutShape:s?void 0:e.fadeOutShape});o={...o,audioFades:t}}o=ZI(o,c,d,i,n,t),o=KI(t,n,o,r),o=kF(o,e*i),u.push({...m,audioSegment:o,offset:void 0,duration:l,parentSpeed:i})}else u.push({...m,offset:void 0,duration:l});o+=l}const f=t.duration/i;return vd(o,f)&&u.push({type:dS.Gap,id:`spacer:${n()}`,duration:f-o}),u}function QI(e,t,n=0,r=!1){const o=[],i=qI(e,t);for(const a of i)"standard"===a.type?o.push({trackId:t,sequenceTrack:void 0,offset:n,mute:r}):"sequence-track"===a.type&&o.push({trackId:t,sequenceTrack:{index:a.sequenceTrackIndex,refId:a.sequenceRefId,trackCountForRoomtoneScaling:a.sequenceTrackCountForRoomtoneScaling},offset:n,mute:r});return o}const XI="script";function eb(e,t,n){switch(t){case XI:return XI;case Jh.Pin:return`pin:${e}`;case Jh.Sequence:return`${gb}:${e}:${n}`;case Jh.Composition:return"master";default:return e}}const tb=em("sequenceSimpleTimelineCache");const nb=em("sequenceTrackSegmentsFromAudioSegmentCache"),rb=em("sequenceAudioSegmentCache");function ob(e,t){if(!e.studioSoundIntensity||e.studioSoundIntensity>=1||e.studioSoundIntensity<=0)throw new Error("Invalid Studio Sound intensity parameter for mix");const[n,r]=yh(e.audioSegment.gain,e.studioSoundIntensity);return[{...e,id:`${e.id}:original`,offset:t,audioSegment:Eh(e.audioSegment,r),studioSoundClipType:"original"},{...e,id:`${e.id}:studio-sound`,offset:t,audioSegment:Eh(e.audioSegment,n),studioSoundClipType:"studio-sound"}]}function ib(e,t,n,r,o,i){const{simpleTimeline:a,sequenceHasSoloedTrack:s}=function(e,t,n,r){const o=rm(e.projectId,n),i=HI(e,t),a=t.audio.trackSceneIds.filter((t=>vk(e,t).isMuted)).length,{forceSequenceTrackRecomputation:s,...c}=r;if(!s){const e=tb.get(o);if(e&&e.localAssetKey===t.audio.localAssetKey&&(0,Me.fastDeepEqualJson)(e.options,c)&&e.sequenceTrackCountForRoomtoneScaling===i&&e.sequenceMutedTrackCount===a)return e.result}const d={simpleTimeline:pb(e,n,r),sequenceHasSoloedTrack:t.audio.trackSceneIds.length>1&&t.audio.trackSceneIds.some((t=>vk(e,t).isSoloed))};return s||tb.set(o,{localAssetKey:t.audio.localAssetKey,result:d,options:c,sequenceTrackCountForRoomtoneScaling:i,sequenceMutedTrackCount:a}),d}(e,o,r,i),c=function(e,t,n){return im(e,t,n)}(e.projectId,r,t);return qf(ab,c,nb,t,vk(e,r),s,a,function(e,t,n){const r=t.get(n);return void 0!==r&&(0,Me.fastDeepEqual)(e,r)?r:(t.set(n,e),e)}(n,rb,c))}function ab(e,t,n,r,o){const i=t.id,a=t.isMuted||n&&!t.isSoloed?0:o.gain;if(1!==r.trackGroups.length)throw new Error("Sequence track timeline should only generate one track group");const s=pS(`${e}:${i}:effect`),c=pS(`${e}:${i}:gap`);return Array.from(Qa(_I(r),(t=>Array.from(Qa(JI(t.segments,o,c,s),(t=>{const n={...t,id:`${e}:${t.id}`};return n.type===dS.Clip&&1!==a&&(n.audioSegment=Eh(n.audioSegment,n.audioSegment.gain*a)),n}))))))}const sb=em("trackSegmentsForRoomtoneOrGapCache");function cb(e,t,n,r,o,i,a){return!t.enableRoomtone||!o||!Cg(o)||o.audio.duration<2?[{type:dS.Gap,id:e,duration:t.duration}]:function(e,t,n,r,o,i,a,s){const c=n.audio.duration-2;let d=r,l=0;const u=Math.min(1,d/2),f=[];for(;d>0;){const r=Math.min(c,d),m=0===l&&u>0,p=d===r&&u>0,g=s&&(m||p)?gh({...m?{fadeInDuration:void 0!==o?Math.max(-o,-u):-u,fadeInShape:Uy.Linear}:void 0,...p?{fadeOutDuration:void 0!==i?Math.max(-i,-u):-u,fadeOutShape:Uy.Linear}:void 0}):void 0;f.push({type:dS.Clip,id:`${e}-rt:${t+l}`,audioSegment:hF({mediaRefId:n.id,offset:u,duration:r,audioFades:g,gain:a}),duration:r,isRoomtone:!0}),d-=c,l+=1}return f}(e,0,o,t.duration,n,r,i,a)}function db(e,t,n,r,o,i,a,s,c,d){if(!r.enableRoomtone||!s||s?.ref?.audio?.speechEnhanceEnabled&&1===s.ref.audio.studioSoundIntensity)return[{type:dS.Gap,id:n,duration:r.duration}];let l,u=1;if(s.ref?.audio?.trackSceneIds){if(c?.type===dS.Clip){const t=c.audioSegment.mediaRefId;if(void 0!==t){const n=Pp(e,t);Lg(n)?(l=n,u=c.audioSegment.gain):void 0!==n.audio?.roomtoneRefId&&(l=Pp(e,n.audio.roomtoneRefId),u=c.audioSegment.gain*(l?.audio?.defaultGain??1)/(s.ref.audio.trackSceneIds.length||1))}}}else if(s.ref?.audio?.roomtoneRefId){l=jk(e,s.ref.audio.roomtoneRefId),u=(s.tau.audioSegment?.gain??1)*(l.audio?.defaultGain??1);const t=s.ref.audio.studioSoundIntensity;if(s.ref.audio.speechEnhanceEnabled&&void 0!==t&&t>0&&t<1){const[e,n]=yh(1,t);u*=n}void 0!==a&&(u/=a)}return qf(cb,function(e,t,n){return im(e.projectId,t,n)}(e,t,n),sb,n,r,o,i,l,u,d)}function lb(e,t,n,r,o,i=zI){if(!r||"descriptRecordingInProgress"===r.source)return[[{type:dS.Gap,id:t,duration:n.duration,mutable:!0}]];if(!Cg(r))return[[{type:dS.Clip,id:t,audioSegment:n,duration:_F(n),mutable:!0,hasAudioData:!1}]];let a=!1;if(r.audio.trackSceneIds&&!o||o&&r.id!==o.refId)a=!0;else if(r.id===o?.refId&&Ag(r))return ib(e,t,n,r.audio.trackSceneIds[o.index],r,i);return a?[[{type:dS.Gap,id:t,duration:_F(n),mutable:!0}]]:r.audio?.speechEnhanceEnabled&&void 0!==r.audio?.studioSoundIntensity&&r.audio?.studioSoundIntensity>0?[[{type:dS.Clip,id:t,audioSegment:n,duration:_F(n),mutable:!0,studioSoundIntensity:r.audio.studioSoundIntensity,studioSoundClipType:1===r.audio.studioSoundIntensity?"studio-sound":"original",hasAudioData:!0}]]:[[{type:dS.Clip,id:t,audioSegment:n,duration:_F(n),mutable:!0,hasAudioData:!0}]]}function ub(e,t,n,r,o,i){if(t.audioSegment.enableRoomtone&&!e.suppressRoomtone){if(o){if(i?.suppressRoomtone)return;return n?.ref?.id===o.refId?n:r?.ref?.id===o.refId?r:void 0}return n?.ref?.audio?.roomtoneRefId?n:r?.ref?.audio?.roomtoneRefId?r:void 0}}function fb(e,t,n,r,o,i,a){const s=pS("gap"),c=vk(e,t);let d;if(c.type===Jh.Sequence){const t=SG(e)[c.id];d=HI(e,Vk(e,t))}const l={forceSequenceTrackRecomputation:r,roomtoneFades:o,audioDucking:i,legacyCrossfades:a=a??!e.isStoryboard},{groups:u}=function(e,t,n=0,r=!1){const o=t.id,i=t.timeline.pins.components.some((t=>vk(e,t.sceneId).isSoloed)),a=i||t.isSoloed,s=new Map;for(const l of t.timeline.pins.components){const t=vk(e,l.sceneId),i=r||t.isMuted||a&&!t.isSoloed,c=QI(e,t.id,n+Kx(e,o,l),i);c.length>0&&s.set(l.id,{id:eb(l.sceneId,Jh.Pin),layouts:c,gain:t.gain,pan:t.pan,effects:t.effects})}const c=r||t.isMuted||a&&!t.isSoloed,d=QI(e,o,n,c);return d.length>0&&s.set(Yy,{id:eb(o,XI),layouts:d,gain:t.timeline.superTau.gain,pan:t.timeline.superTau.pan,effects:t.timeline.superTau.effects}),{groups:fu(Xy(e,t.id),(e=>s.get(e))).reverse()}}(e,c);let f,m=u.map((({id:n,layouts:r,effects:o,pan:i,gain:a})=>({id:n,type:"group",gain:a,pan:i,effects:tU(o),tracks:r.filter((t=>!e.isStoryboard||"placeholder"!==Ky(e,t.trackId))).map((n=>function(e,t,n,r,o,i,a,s){const c=n?Jp(e,Vk(e,n.refId).audio.trackSceneIds[n.index]):void 0,d=t.videoMetadata,l=[[]];let u,f;function m(){if(u){const t=lb(e,u.id,u.audioSegment,u.mediaRef,n,{...a,video:d});for(let e=0;e<t.length;e++){const n=t[e];if(!l[e]){l[e]=[];const t=l[e-1];if(0!==e&&t.length>n.length){const r=t[t.length-n.length-1];l[e]=[{type:dS.Gap,id:`${r.id}spacer:${o()}`,offset:0,duration:r.duration+(r.offset??0)}]}}l[e].push(...n)}}u=void 0}function p(e,t){m();for(const n of l)n.push({type:dS.Gap,id:e,duration:t,mutable:!0})}s((function(o,s,g){const{tau:h,gapClipTau:v}=o;if(h.isBlocked)m();else if(v){m();for(let o=0;o<l.length;o++){const i=l[o],u=i.length>0?i[i.length-1]:void 0,m=s?.tau.audioSegment?.duration??void 0,p=ub(t,v,f,s,n,c);let g;n&&(f&&p===f?g=u:s&&p===s&&s.tau.audioSegment&&(g=Ya(lb(e,s.tau.id,s.tau.audioSegment,s.ref,n,{...a,video:d}))?.[o])),i.push(...db(e,t.id,h.id,v.audioSegment,u?.duration??void 0,m,r,p,g,a.roomtoneFades))}}else if(o.isScratchText&&!o.hasAudio)m(),g>0&&p(h.id,g);else if(h.audioSegment){const{audioSegment:e,ignoreAlignment:t}=h;let n=!1;if(u&&(u.ignoreAlignment||h.ignoreAlignment)&&bF(u.audioSegment,e)){const e={...u.audioSegment,duration:_F(u.audioSegment)+g};e&&(u={id:u.id,audioSegment:e,ignoreAlignment:!0,mediaRef:o.ref},n=!0)}n||(m(),u={id:h.id,audioSegment:{...e,duration:g*e.speed,gain:i?0:e.gain},ignoreAlignment:t,mediaRef:o.ref})}else m();h.isBlocked||(f=o)}),p),m();let g=0;const h=[],v=[],E=[];let y=0;for(let C=0;C<l.length;C++){const e=l[C];let r=0,o=0;for(let i=0;i<e.length;i++){const a=e[i];if(a.mutable?(a.offset=r,delete a.mutable):e[i]={...a,offset:r},r+=a.duration,void 0!==n||t.type!==Jh.Sequence)if(a.type===dS.Clip&&void 0!==a.studioSoundIntensity&&a.studioSoundIntensity>0&&a.studioSoundIntensity<1){v[y]||(v[y]=[],E[y]=0);const t=E[y]+o,[n,r]=ob(a,t);e[i]=n,o>0&&v[y].push({type:dS.Gap,id:`${r.id}:gap`,offset:E[y],duration:o}),v[y].push(r),E[y]=t+r.duration,o=0}else o+=a.duration}h[C]=r,g=Math.max(g,h[C]),v[y]&&((void 0!==n||t.type!==Jh.Sequence)&&o>0&&(v[y].push({type:dS.Gap,id:`${v[y][v[y].length-1].id}:end-gap`,offset:E[y],duration:o}),E[y]+=o),y+=1)}let S,I=1,b=0;if(t.type===Jh.Sequence)S=t.effects,I=t.gain,b=t.pan;else if(n){const t=vk(e,Vk(e,n.refId).audio.trackSceneIds[n.index]);S=t.effects,I=t.gain,b=t.pan}else S=[];let T=t.id;T+=n?`:${n.refId}:${n.index}`:":standard";const w={id:T,duration:g,gain:I,pan:b,effects:tU(S)};return l.length>1||v.length>0?{...w,id:`${T}:group`,type:"group",tracks:[...l.map(((e,n)=>({id:`${T}:track-${n}`,type:"track",segments:e,duration:h[n],duckingEffect:NI(t),duckingParameters:t.duckingParameters,gain:1,pan:0,effects:[]}))),...v.map(((e,n)=>({id:`${T}:studio-sound-${n}`,type:"track",segments:e,duration:E[n],duckingEffect:NI(t),duckingParameters:t.duckingParameters,gain:1,pan:0,effects:[]})))]}:{...w,type:"track",segments:l[0],duckingEffect:NI(t),duckingParameters:t.duckingParameters}}(e,vk(e,n.trackId),n.sequenceTrack,d,s,n.mute,l,((r,o)=>{n.offset>0&&o("spacer",n.offset);const{tausData:i}=GV(e,n.trackId).tausAndDataBasic();let a,s=0;for(const c of i)c.tau.isBlocked||(a&&r(a,c,s),a=c,s=n.trackId!==t?jP(e,n.trackId,c.tau.id):c.duration);a&&r(a,void 0,s)}))))}))),p=0;for(const h of m)for(const e of mS(h))e.duration>p&&(p=e.duration);i&&(m=PI(m)),!0===n?f=c.videoMetadata:!1!==n&&(f=n);const g={trackGroups:m,videoMetadata:f,duration:p,gain:c.gain,pan:c.pan,effects:c.type===Jh.Composition?tU(c.effects):[]};return a&&(g.legacyCrossfades=!0),g}const mb=em("createSimpleTimelineFromTrackCache");function pb(e,t,{video:n,forceSequenceTrackRecomputation:r=!1,roomtoneFades:o=!0,audioDucking:i=!0,legacyCrossfades:a}={}){return qf(fb,sm(e,t),mb,e,t,n,r,o,i,a)}const gb="tmp-mediaref-track";function hb(e){return e.video?Fy(e.video):e.image?Fy({...e.image,framerateNumerator:1,framerateDenominator:1}):void 0}const vb=(0,el.createSelector)([(e,t)=>t,(e,t,n)=>n?.offset??0,(e,t,n)=>n?.duration??Nk(Pp(e,t))??0,(e,t)=>Pp(e,t),(e,t,n,r)=>r],((e,t,n,r,o)=>Cy({id:gb,videoMetadata:o??hb(r),timeline:Bx({superTau:Sx({taus:[JM({id:"media-ref-placeholder-tau",audioSegment:vF(r,{timeRange:{offset:t,duration:n}}),text:bm(" ")})]})})})));function Eb(e,t,n,r=!0,o=!1){const i=vb(e,t,n);return e=rx(e,i,void 0),!0===r&&(r=Pp(e,t).video??!1),pb(e,i.id,{video:r,forceSequenceTrackRecomputation:o})}function yb({start:e,end:t}){return e!==t}function Sb(e){let t=0,n="";const r=vu(e.map((e=>{n+=e.string;const r=t;return t=n.length,{attrStr:e,start:r,end:t}})),yb);return{string:n,parts:r}}function Ib({parts:e}){return 0===e.length?Im:1===e.length?e[0].attrStr:Cm(Qa(e,(({attrStr:e})=>e)))}function bb(e,t,n=e.string.length){t<0&&(t=0),n<0&&(n=0);const r=e.string.length;if(n>r&&(n=r),t>r&&(t=r),t===n)return Rb;if(P()(t<=n,"expected start <= end"),0===t&&n===r)return e;const o=Gs.getStartEnd(t,n),i=nh(zg(e.parts),lh(o,qs,$s,(e=>Gs.getStartEnd(e.start,e.end)),!1)),a=$s(o);return Sb(Zg(i).map((e=>km(e.attrStr,o.location-e.start,e.attrStr.string.length-(e.end-a)))))}function*Tb({parts:e},t){const n=Gs.get(t,1),r=nh(zg(e),lh(n,qs,$s,(e=>Gs.getStartEnd(e.start,e.end)),!1));for(const o of Kg(r))if(o.start<=t&&o.end>t){yield*Qa(Vm(o.attrStr,t-o.start),(e=>[o,e]));break}}function wb(e,t){return Qa(Tb(e,t),(([,e])=>e.attribute))}function Cb(e,t){return Qa(Tb(e,t),(([e,t])=>0===e.start?t:{attribute:t.attribute,range:Gs.get(e.start+t.range.location,t.range.length)}))}function _b(e,t){const n=$s(e);if(!Ys(e.location,n,t.start,t.end))throw new Error("No intersection");let r=0;e.location>t.start&&(r=e.location-t.start);let o=t.end-t.start;return t.end>n&&(o=n-t.start),Gs.getStartEnd(r,o)}function*Ab({parts:e},t,n){const r=nh(zg(e),lh(n,qs,$s,(e=>Gs.getStartEnd(e.start,e.end)),!1));for(const o of Kg(r))yield*Qa(jm(o.attrStr,t,_b(n,o)),(e=>({value:e.value,range:Gs.get(o.start+e.range.location,e.range.length)})))}const Rb={string:"",parts:[]};function Mb(e,t){if(t<0)throw new RangeError("index < 0");if(0===t)return[Rb,e];if(t>e.string.length)throw new RangeError("index > length");if(t===e.string.length)return[e,Rb];const n={string:"",parts:[]},r=[];for(let o=0;o<e.parts.length;o++){const i=e.parts[o];if(i.end<=t)n.parts.push(i);else{if(i.start>=t){r.push(...e.parts.slice(o).map((e=>e.attrStr)));break}{const[e,o]=Lm(i.attrStr,t-i.start),a=n.parts[n.parts.length-1]?.end??0;n.parts.push({attrStr:e,start:a,end:a+e.string.length}),r.push(o)}}}return n.string=e.string.substring(0,n.parts[n.parts.length-1]?.end??0),[n,Sb(r)]}let Db=1;function Ob(e){e.CLOCK=++Db}function xb({CLOCK:e}){return e}function kb(e,t){return t&&xb(e)<=xb(t)?t:e}function Nb(e,t){return xb(e)>xb(t)}class Pb{constructor(e){this.tag={CLOCK:1},this._value=e}get(){return this._value}set(e){Ob(this.tag),this._value=e}didUpdateMutableValue(){Ob(this.tag)}changedSince(e){return Nb(this.tag,e)}DEBUG_getTag(){return this.tag}}const Lb=em("getAttributedString");function Fb(e,t){const n=GV(e,t);return qf(lV,sm(e,t),Lb,xb(n.tag),n)}function Ub(e,t,{location:n,length:r}){return Ib(bb(Fb(e,t),n,n+r))}function Bb(e,t,n,r,{excludeIgnored:o=!1}={}){if(o){const{getTauData:o}=GV(e,t).tausAndDataForBasicAttributedString();let i="";return UU(e,t,{location:n,length:r-n},((e,t,n)=>(e.isBlocked||(i+=o(e.id).basicAttributedString.attrString.string.substring(n.location,n.location+n.length)),!1))),i}return Fb(e,t).string.substring(n,r)}function jb(e,t,n,r=1){const o=Fb(e,t);return Ib(bb(o,n,function(e,t){if(t<0)throw new RangeError("n < 0");for(const n of e){if(0===t)return n;t-=1}if(t>0)throw new RangeError("less than n items")}(gc(o.string,"\n",n),r-1)))}function Vb(e,t){return Fb(e,t).string.length}function zb(e,t,n,r,o,i,a){UU(e,t,n,((s,c,d,l)=>{let u=0;const f=EB(e,t,s);for(const m of f){let s=l+aB(m)+u;const c=Qj(e,t,m).length;let d=c;i&&(s-=tV(e,t,m).length,d=rV(e,t,m).length);const f=Gs.get(s,d);if(Ks(f,n)||o&&f.location===n.location||r&&$s(f)===n.location){const e=Math.max(0,n.location-s),t=Math.min($s(n)-s,d),r=Gs.get(e,t-e);if(a(m,r,f))return!0}u+=c}return!1}))}function Gb(e,t,n,r=!0,o=!0,i,a=!1){let s,c,d;if(UU(e,t,n,((l,u,f,m)=>{let p=0;const g=EB(e,t,l);for(const h of g){let l=aB(h);const u=Qj(e,t,h).length;let f=u;if(i?.has(h)){p+=u;continue}a&&(l-=tV(e,t,h).length,f=rV(e,t,h).length);const g=m+l+p;if(d=Gs.get(g,f),Ks(d,n)||o&&qs(d)===qs(n)||r&&$s(d)===qs(n)){s=h;const e=Math.max(0,n.location-g),t=Math.min($s(n)-g,f);return c=Gs.get(e,t-e),!0}p+=u}return!1})),s&&c&&d)return{component:s,range:c,componentRenderedRange:d}}function Wb(e,t,n){const r=Gb(e,t,Gs.get(n,1),!1,!0);if(r)return r.component}function Hb(e,t,n){const r=nk(e,t,n);if(!r)throw new Error("Component not found in timeline");const[o]=r,i=qb(e,t,o);if(!i)throw new Error("Component rendered range not found");return e=function(e,t,n){const r=new Map,o=pk(e,t);for(let i=0;i<o.length;i++){const e=o[i];n.has(e.id)&&r.set(e.id,i)}return _D(e,t,(e=>{if(!n.has(e.id)){if(PB(e)&&"cardBoundary"===e.endAnchor?.type){const t=r.get(e.endAnchor.cardBoundaryId);if(void 0!==t){for(let n=t+1;n<o.length;n++){const t=o[n];if(!r.get(t.id))return LD(e,{type:"cardBoundary",cardBoundaryId:t.id})}return LD(e,{type:"endOfComposition"})}}return e}}))}(e,t,new Set([n])),{doc:e,modifiedRange:i,selectionRange:Gs.get(i.location,0),trackComponent:o}}function qb(e,t,n){const r=hB(GV(e,t),n.tauAnchor.tauId),{textOffset:o,components:i,componentRenderedRanges:a,renderedText:s}=r,c=EE(e)&&0===s.string.trim().length;for(let d=0;d<i.length;d++){const e=i[d];if(Bu(e)&&e.id===n.id){const e=a[d],t=c&&e.location>s.string.length?s.string.length:e.location;return Gs.get(o+t,e.length)}}throw new Error("Rendered range for component not found")}function $b(e,t,n,r){return{offset:r.offset-Rk(e,t,n),duration:r.duration}}function Kb(e,t){const n=fu(t,(e=>e.audioSegment?.mediaRefId)).flatMap((t=>{const n=Pp(e,t);if(Ag(n)){const t=n.audio.trackSceneIds.flatMap((t=>bP(e,t)));return Kb(e,t)}return Yb(e,t)}));return Array.from(new Set(n))}function Yb(e,t){const n=[],r=Pp(e,t);return Dg(r)&&r.assetGuid&&n.push(r.assetGuid),r.audio?.roomtoneRefId&&n.push(...Yb(e,r.audio.roomtoneRefId)),n}function Zb(e){return e.map(((e,t,n)=>({id:e.id,start:e,end:n[t+1]??"end",layers:e.layers})))}const Jb=em("getCards");function Qb(e,t){return qf(Zb,sm(e,t),Jb,pk(e,t))}function Xb(e,t,n){const r=Qb(e,t).findIndex((e=>e.id===n));return P()(-1!==r,"Could not find card with id"),r}function eT(e,t,n){return Qb(e,t).find((({start:e})=>EU(e)===n))}function tT(e,t,n){const r=eT(e,t,n);return P()(void 0!==r,"Could not find card with start boundary id"),r}function nT(e,t,n){return Qb(e,t).find((({end:e})=>EU(e)===n))}function rT(e,t,n){return nT(e,t,n.start.id)}function oT(e,t,n){return pU(n.end)?eT(e,t,n.end.id):void 0}function iT(e,t,n){return SU(e,t,n.start)}function aT(e,t,n){return SU(e,t,n.end)}function sT(e,t,n,r){const o=e=>r?sy(e,r):e,i=o(iT(e,t,n));return{offset:i,duration:o(aT(e,t,n))-i}}function cT(e,t,n,r){return rh(Qb(e,t),(o=>{const{offset:i,duration:a}=sT(e,t,o,r);return ah(n,i,i+a)}))}function dT(e,t,n,r){const o=cT(e,t,n,r);return o.match?.value??o.previous?.value}function lT(e,t,n,r){const o=Qb(e,t),i=function(e,t){return{offset:0,duration:_k(e,t)}}(e,t),a=dp(n,np(i),rp(i)),s=cT(e,t,a.offset,r);if(!s.match)return zg(o,0,0);const c=s.match.index,d=cT(e,t,rp(a),r);if(!d.match)return zg(o,c);return zg(o,c,(function({duration:e}){return 0===e}(a)||sp(sT(e,t,d.match.value),a)?d.match.index+1:d.match.index)-c)}function uT(e,t,n,r){return Zg(lT(e,t,n,r))}const fT=(0,el.createSelector)((e=>e),((e,t)=>t),((e,t)=>Qb(e,t)),((e,t,n)=>n.map((n=>({card:n,...mT(e,t,n)})))));function mT(e,t,n){const r=qb(e,t,n.start),o=pU(n.end)?qb(e,t,n.end):void 0,i=o?o.location:Vb(e,t);return Gs.getStartEnd(r.location,i)}function pT(e,t,n){const r=qb(e,t,n.start),o=hT(e,t,n);return Gs.getStartEnd(r.location,o)}function gT(e,t,n){const r=mT(e,t,n);let o=r.location;return zb(e,t,r,!1,!0,!0,((e,t,r)=>!(!pU(e)||e.id===n.start.id)||(!!tB(e)||(!(r.location===o||qs(r)<o&&$s(r)>=o)||(o=r.location+r.length,!1))))),o}function hT(e,t,n){const r=mT(e,t,n),o=Fb(e,t);let i=$s(r)-("end"===n.end?0:1);for(const a of Array.from(Ab(o,Gu.Marker,r)).reverse())ec(a.range,Gs.get(i,0))&&(i=a.range.location-1);return Math.max(i,r.location)}function vT(e,t,n){const r=rh(fT(e,t),(e=>{return(t=n)<qs(r=e)?Ie.OrderedDescending:t>=$s(r)?Ie.OrderedAscending:Ie.OrderedSame;var t,r}));return r.match?.value.card??r.previous?.value.card}function ET(e,t,n){return AT(e,t,t,n).every((e=>{return EN(e)||AN(e)||void 0===(t=e).audioSegment&&void 0===As.index(t.text.string);var t}))}function yT(e,t,n){if(ET(e,t,n)){return AT(e,t,t,n).at(0)}}function ST(e,t,n){return hd(sT(e,t,n).duration,0)}function IT(e,t){const n=Wx(e,t).cards.components[0],r=_P(e,t);P()(void 0===r||void 0!==n,"Composition has tau but no card"),r&&P()(n.tauAnchor.tauId===r.id&&0===n.tauAnchor.location&&hd(SU(e,t,n),0),"First card boundary is not at composition start")}function bT(e,t,n){const r=eT(e,t,n);if(!r)return[];const o=mT(e,t,r),i=[];zb(e,t,o,!1,!1,!0,((e,t,n)=>(PB(e)&&i.push(e),!1)));const a=i.flatMap((t=>bP(e,t.sceneId))),s=[];return UU(e,t,o,((e,t,n)=>(s.push(e),!1))),Kb(e,[...s,...a])}const TT=em("assetIdsForCard");function wT(e,t){if(e?.fadeOutDuration&&e.fadeOutDuration<0){const t={duration:e.fadeOutDuration,shape:e.fadeOutShape,effect:e.tailTransitionEffect};return{fadeIn:t,fadeOut:t}}if(t?.fadeInDuration&&t.fadeInDuration<0){const e={duration:t.fadeInDuration,shape:t.fadeInShape,effect:t.headTransitionEffect};return{fadeIn:e,fadeOut:e}}return{fadeIn:void 0!==t?.fadeInDuration?{duration:t.fadeInDuration,shape:t.fadeInShape,effect:t.headTransitionEffect}:void 0,fadeOut:void 0!==e?.fadeOutDuration?{duration:e.fadeOutDuration,shape:e.fadeOutShape,effect:e.tailTransitionEffect}:void 0}}const CT=Zl()(rT,oT,((e,t,n)=>n),((e,t,n)=>{const{fadeIn:r}=wT(e?.start.videoFades,n.start.videoFades),{fadeOut:o}=wT(n.start.videoFades,t?.start.videoFades);return{fadeInDuration:r?.duration,fadeInShape:r?.shape,headTransitionEffect:r?.effect,fadeOutDuration:o?.duration,fadeOutShape:o?.shape,tailTransitionEffect:o?.effect}}))({...yp("getCardVideoFades"),keySelector:(e,t,n)=>im(e.projectId,t,n.id)});function _T(e,t,n){return AT(e,t,t,n).some((t=>{const n=ZP(e,t);return void 0!==n&&wg(n)&&!Ag(n)}))}function AT(e,t,n,r){if(t===n){const n=mT(e,t,r),o=[];return UU(e,t,n,((e,t,r,i)=>!(i+$s(r)<=n.location)&&(i>=$s(n)||(o.push(e),!1)))),o}const o=sT(e,t,r);return vd(o.duration,0)?bu():Zg(kP(e,n,$b(e,t,n,o)))}const{lessThanFrameCount:RT,greaterThanOrEqualFrameCounts:MT}=s;var DT=(e=>(e.Point="point",e.RangeStart="rangeStart",e.RangeEnd="rangeEnd",e))(DT||{});function OT(e,t,n,r=!1,o,i=!1){let a,s,c,d,l=0;for(const u of bP(e,t)){if(u.isBlocked)continue;const f=n-l,m=RT(f,0),p=BP(e,t,u.id),g=MT(f,p),h=!m&&!g;if(m){a={tauId:u.id,range:Gs.get(0,0)};break}if(h){if(u.isScriptClip){const n=PP(e,t,u.id).string.indexOf(IE.string);if(-1===n)throw new Error("Script clip tau does not contain script clip placeholder");a={tauId:u.id,range:Gs.get(n,1),gapTimeOffset:i?f:void 0};break}if(r&&!rN(e,t,u)&&PN(e,u)){a=i?{tauId:u.id,range:Gs.get(0,1),gapTimeOffset:p-f}:void 0;break}let n;const l=dN(e,t,u);if(l){const r=o(e,t,u.id,f,u.audioSegment?u.audioSegment.offset:0,l,i);n=r?.range,s=r?.gapOffset,c=r?.includeGapPrefix,d=r?.includeGapSuffix}if(n)a={tauId:u.id,range:n,gapTimeOffset:s,includeGapPrefix:c,includeGapSuffix:d};else{const{wordOffset:n,gapOffset:r}=HP(e,t,u.id,f,i);let o=n;const s=PP(e,t,u.id);for(;o<s.string.length&&!bs.contains(s.string.charAt(o));)o+=1;a={tauId:u.id,range:Gs.get(n,o-n),gapTimeOffset:i?r:void 0}}break}l+=BP(e,t,u.id)}if(r&&a&&0===a.range.length){if(!i)return;a.range=Gs.get(a.range.location,1)}if(!r&&!a&&(a=function(e,t){const n=AP(e,t);if(n)return{tauId:n.id,range:Gs.get(PP(e,t,n.id).string.length,0)}}(e,t),a&&i)){const r=wP(e,t,a.tauId),o=cN(e,t,r);if(o&&a&&r.audioSegment){const e=o.lastFinishedWordForTextOffset($s(a.range));e&&(a={...a,gapTimeOffset:n+r.audioSegment.offset-e.endTime})}}return a}const xT=(e,t,n,r,o,i,a=!1)=>{const{wordOffset:s,gapOffset:c,includeGapPrefix:d,includeGapSuffix:l}=HP(e,t,n,r,a),{next:u,match:f,previous:m}=i.searchForTextOffsetWithPunc(s);let p=Gs.get(0,0);return f&&(p=f.value.rangeWithPunc),m&&(p=Gs.get($s(m.value.rangeWithPunc),0)),u&&(p=Gs.get(u.value.rangeWithPunc.location,0)),{range:p,gapOffset:c,includeGapPrefix:d,includeGapSuffix:l}};function kT(e,t,n,r){if(dB(Math.abs(t),n,e))return r}const NT=(e,t,n,r,o,i)=>{const a=EE(e),s=i.currentOrNextWordForTimeOffset(r+o,!0),c=r+o;if(s){if(!a)return{range:s.value.rangeWithPunc};const e=s.index>0?Wg(i.wordArrayView,s.index-1):void 0,t=s.value.startTime-(e?.endTime??0);if(c<s.value.startTime){const e=kT(i,t,!1,c-s.value.startTime);return{range:Gs.get(qs(s.value.rangeWithPunc),0),gapOffset:e}}if(c>s.value.endTime){const e=kT(i,t,!1,c-s.value.endTime);return{range:Gs.get($s(s.value.rangeWithPunc),0),gapOffset:e}}return{range:Gs.get(qs(s.value.rangeWithPunc),0),gapOffset:void 0}}if(0===i.wordArrayView.length)return{range:Gs.get(0,0),gapOffset:a?r:void 0};const d=Hg(i.wordArrayView);if(c<d.startTime)return{range:Gs.get(qs(i.rangesWithPunc[0]),0),gapOffset:a?kT(i,d.startTime-o,!0,c-d.startTime):void 0};const l=i.rangesWithPunc[i.length-1],u=i.lastFinishedWordForTextOffset($s(l));return{range:Gs.get($s(l),0),gapOffset:a&&u?kT(i,BP(e,t,n)-(u.endTime-o),!1,c-u.endTime):void 0}},PT=(e,t,n,r,o,i)=>{const a=EE(e),s=r+o,c=i.mostRecentWordForTimeOffset(s,!0);if(c){const r=((c.index<i.wordArrayView.length-1?Wg(i.wordArrayView,c.index+1):void 0)?.startTime??BP(e,t,n)+o)-c.value.endTime;return{range:Gs.get($s(c.value.rangeWithPunc),0),gapOffset:a?kT(i,r,!1,s-c.value.endTime):void 0}}if(0===i.wordArrayView.length)return{range:Gs.get(0,0),gapOffset:a?r:void 0};const d=Hg(i.wordArrayView);if(s<d.startTime)return{range:Gs.get(qs(i.rangesWithPunc[0]),0),gapOffset:a?kT(i,d.startTime-o,!0,s-d.startTime):void 0};if(s>=d.startTime&&s<d.endTime)return{range:Gs.get(qs(i.rangesWithPunc[0]),0),gapOffset:kT(i,d.startTime-o,!0,0)};const l=i.rangesWithPunc[i.length-1],u=i.lastFinishedWordForTextOffset($s(l));return{range:Gs.get($s(l),0),gapOffset:a&&u?kT(i,VP(e,t,n)-(u.endTime-o),!1,s-u.endTime):void 0}};function LT(e,t,n,r,o=!1,i=!1){const a=function(e){switch(e){case"rangeStart":return NT;case"rangeEnd":return PT;default:return xT}}(r);return OT(e,t,n,o,a,i)}function FT(e,t,n,r){return UT(e,t,n,!0,r)}function UT(e,t,n,r=!1,o=!1){return LT(e,t,n,"point",r,o)}function BT(e,t,n,r="start",o=!1){const{getTauData:i}=GV(e,t).tausAndDataForAttributedString(),a=o?function(e,t){const{tausData:n}=GV(e,t).tausAndDataLinkedSub();for(let r=0;r<n.length;r++){const{linkedSubAlignment:e}=n[r];if(e&&e.length>0)return r}}(e,t):void 0,s=EE(e);let c,d;if(UU(e,t,Gs.get(n,0),((l,u,f)=>{const m=i(l.id),{timeOffset:p,duration:g,linkedSubAlignment:h,renderedText:v,gapClipTau:E}=m;if(d=p+g,u.location===v.string.length&&!function(e,t,n){return AP(e,t)?.id===n}(e,t,l.id))return!1;if(o&&e.isStoryboard&&!s){const r=vT(e,t,n);if(r&&ET(e,t,r))return c=SU(e,t,r.start),!0}if(!s&&E&&"start"===r&&f.location>0&&!s)return c=p+g,!0;if(!s&&E&&"end"===r)return c=p,!0;{const r=void 0!==a&&GV(e,t).tausAndDataBasic().getTauData(l.id).index>a;if(o&&!r&&h&&h.length>0){const r=$s(h.elementAt(0).rangeWithPunc);if(u.location<=r){let r=!1;if(OP(e,t,l.id)?.isScriptClip?r=!0:zb(e,t,Gs.get(0,n),!0,!0,!0,(e=>!!(iw(e)||PB(e)||pU(e))&&(r=!0,!0))),!r)return c=0,!0}}return c=function(e,t,{tauId:n,location:r}){const{getTauData:o}=GV(e,t).tausAndDataBasic();return o(n).timeOffset+$P(e,t,n,r)}(e,t,{tauId:l.id,location:u.location}),c=yB({doc:e,compositionId:t,currentTimeOffset:c,textOffset:n,tauData:m,tauRange:u}),!0}})),!c&&s){const r=SB(e,t,Gs.get(n,1));if(r){const o=GV(e,t).tausAndDataForAttributedString().getTauData(r.component.tauId);r.component.range.location!==o.renderedText.string.length&&""!==o.renderedText.string.trim()||(c=yB({doc:e,compositionId:t,currentTimeOffset:o.timeOffset+o.duration,textOffset:n,tauData:o,tauRange:Gs.get(PP(e,t,o.tau.id).string.length-1,0)}))}}return c??d??_k(e,t)}function jT(e,t,n){let r=BT(e,t,n.location,"start");const o=BT(e,t,$s(n),"end");return r=Math.min(r,o),{offset:r,duration:o-r}}function VT(e,t,n,r){const o=UT(e,t,n,!1,r);if(!o)return Gs.get(0,0);const i=kU(e,t,o.tauId,o.range);return wP(e,t,o.tauId).isScriptClip?i:Gs.get(i.location,0)}function zT(e,t,n){const r=EE(e);if(0===n.duration)return VT(e,t,n.offset,r);const o=LT(e,t,n.offset,DT.RangeStart,!1,r),i=LT(e,t,rp(n),DT.RangeEnd,!1,r);if(!o||!i)return Gs.get(0,0);const a=kU(e,t,o.tauId,o.range,{wordlessMedia:r,cardBoundary:!0},o.gapTimeOffset),s=kU(e,t,i.tauId,i.range,{wordlessMedia:r,cardBoundary:!0},i.gapTimeOffset),c=qs(a),d=$s(s);return Gs.get(c,d-c)}function GT(e,t,n){return{type:"track",projectId:e,trackId:t,range:n}}function WT(e,t,n){return{type:"track",projectId:e,trackId:t,range:n}}function HT(e,t){if(!e.projectId.startsWith(t.projectId))throw new Error("MediaRange projectId does not match document")}function qT(e,t,n){return HT(e,t),$T(t)?{doc:e,media:t}:function(e,t,n){const r=vb(e,t.mediaRefId,t.range,n);return{doc:rx(e,r,void 0),media:GT(t.projectId,r.id)}}(e,t,n)}function $T(e){return"track"===e.type}function KT(e){return"mediaRef"===e.type}function YT(e,t){switch(t.type){case"track":return sm(e,t.trackId);case"mediaRef":return dm(e,t.mediaRefId);default:ov(t)}}const ZT=xp("pinCollections",((e,t)=>Wx(e,t).pins.components)),JT=xp("cueCollections",((e,t)=>Wx(e,t).cues.components)),QT=xp("cardBoundaryCollections",((e,t)=>Wx(e,t).cards.components)),XT=xp("noAudioComponentCollections",((e,t)=>Wx(e,t).noAudioTrack.components)),ew=xp("LEGACY_voMetaComponentCollections",((e,t)=>Wx(e,t).LEGACY_voiceoverMetadataTrack.components));function tw({id:e=Ps(),props:t={},offset:n=1,curve:r="linear"}={}){return{id:e,props:t,offset:n,curve:r}}function nw(e={}){const{keyframes:t=[tw()],sceneId:n}=e;return{...Nu({...e,type:xu.cueComponent}),keyframes:t,sceneId:n}}function rw(e,t){const{keyframes:n,sceneId:r}=e;return{...Pu(e,t),keyframes:n,sceneId:void 0!==r?t.encodeReference(r,xu.track):void 0}}function ow(e,t){const{keyframes:n,sceneId:r}=e;return nw({...Lu(e,t),keyframes:n,sceneId:void 0!==r?t.decodeReferenceId(r):void 0})}function iw(e){return ju(xu.cueComponent,0,e)}function aw(){return{isType:iw,encode:rw,decode:ow}}function sw(e,t,n){return JT(e,t).getItemMaybe(e,n)}function cw(e,t,n){return JT(e,t).getItem(e,n)}function dw(e,t,n){const r=e.keyframes.findIndex((({id:e})=>e===t));if(-1===r)throw new Error("No keyframe found for keyframeId");return(0,T.ZP)(e,(t=>{for(const o of ye(n)){const i=n[o];if((0,Me.fastDeepEqualJson)(e.keyframes[r].props[o],i))continue;const a=t.keyframes[r].props;void 0===i?delete a[o]:a[o]=i}}))}function lw(e,t,n,r,o){const{keyframes:i}=e;if(0===i.length)return!1;let a=!1;for(let s=0;s<i.length;s++){const e=i[s],c=e.props;for(const i of ye(c)){const d=c[i];if(void 0===d)continue;const l=uI[i];let u=t[i],f=u?.keyframes;if(u&&f||(u=void 0,f=n[i],f&&1===f.length&&r<f[0].offset?f[0]={offset:r,value:f[0].value}:f||(f=[{offset:r,value:l.defaultValue}],n[i]=f)),P()(f,`Could not find keyframes for effect ${i}`),0===s){const e={offset:r+o,value:rU(f,r+o,l)};if(u)u=zF(l,u,e);else if(1===f.length&&hd(f[0].offset,e.offset))f[0]=e;else if(0===f.length||vd(f[f.length-1].offset,e.offset))f.push(e);else if(!hd(f[f.length-1].offset,e.offset))throw new Error("Keyframes not in offset order")}const m={offset:r+o+e.offset,value:d};u?(u=zF(l,u,m),t[i]=u):f.push(m),a=!0}}return a}function uw(e,t,n){return im(e,t.id,n)}const fw=em("applyAllCueEffects");function mw(e,t){switch(t.type){case"track":return function(e,t){return qf(gw,sm(e,t),fw,e,t,"track")}(e,t.trackId);case"mediaRef":{const n=Pp(e,t.mediaRefId);return Ag(n)?function(e,t){return qf(gw,dm(e,t.id),fw,e,t.id,"seq")}(e,n):e}default:return e}}function pw(e,t){const{tausData:n}=e.getTrackData(t).tausAndDataBasic();return ss(es(n,(({ref:e})=>e?.audio?.trackSceneIds)))}function gw(e,t,n){const{projectId:r}=e,o="track"===n?[t]:Vk(e,t).audio.trackSceneIds,i=[Qa(o,(e=>({trackId:e,baseCompositionHasNoCues:!1})))],a=new Set,s=VV(e);for(const c of o){const t=s.getTrackData(c).track,{pins:n,cues:r}=t.timeline,o=t.type===Jh.Composition&&0===r.components.length;if(i.push(Qa(n.components,(e=>({trackId:e.sceneId,baseCompositionHasNoCues:o})))),0!==e.sequenceScenes.length){for(const e of pw(s,c))a.add(e);for(const e of n.components)for(const t of pw(s,e.sceneId))a.add(t)}}i.push(Qa(a,(e=>({trackId:e,baseCompositionHasNoCues:!0}))));for(const{trackId:c,baseCompositionHasNoCues:d}of ss(i)){const t=vk(e,c);if((t.type===Jh.Composition||t.type===Jh.Sequence||d)&&0===t.timeline.cues.components.length)continue;const n=t.timeline.superTau,o=n.taus,i=Ew(e,c),a=hu(o,(function(e){if(!e.audioSegment)return e;const t=i?.get(e.id);if(!t||0===t.length)return e;const n={},o={},a=e.audioSegment.offset;for(const r of e.audioSegment.effects)r.keyframes.length>1?n[r.type]=r:1===r.keyframes.length&&a>0?(P()(dI(r.type),`Invalid segment effect type: ${r.type}`),o[r.type]=[{...r.keyframes[0],offset:a}]):o[r.type]=[...r.keyframes];let s=!1;for(const{cue:r,timeOffsetInTau:i}of t)s=lw(r,n,o,a,i)||s;if(!s)return e;const c=[];for(const r of e.audioSegment.effects){P()(dI(r.type),`Invalid segment effect type: ${r.type}`);const e=n[r.type];if(e)c.push(e);else{const e=o[r.type];P()(e,"Should have either full effect or keyframes for every existing effect"),e.length>r.keyframes.length?c.push({...r,keyframes:e}):c.push(r),delete o[r.type]}}for(const i of ye(o)){const t=uI[i],n=o[i];P()(n,`No keyframes for effect type ${i}`),c.push(t(n,uw(r,e,i)))}return{...e,audioSegment:{...e.audioSegment,effects:c}}}));a!==o&&(e=Cx(e={...e,projectId:`${e.projectId}-tmp-cues`},c,xx(n,a)))}return e}const hw=em("getOrderedCuesForTrackByTau");function vw(e,t){return qf(yw,sm(e,t),hw,e,t)}function Ew(e,t){return vw(e,t)?.tauIdToCueData}function yw(e,t){const n=VV(e),r=n.getTrackData(t),{track:o}=r,i=o.type===Jh.Pin;if(0===o.timeline.cues.components.length&&!i)return;const{getTauDataMaybe:a,getTauData:s}=GV(e,t).tausAndDataLinkedSub(),c=new Map,d=[],l={tauIdToCueData:c,cuesWithNoTau:d};for(const E of o.timeline.cues.components){if(void 0!==E.sceneId)continue;const e=E.tauAnchor.tauId,n=a(e);if(!n){d.push({cueId:E.id,sceneId:o.id});continue}let r=c.get(e);r||(r=[],c.set(e,r));const i=n.timeOffset,s=n.tau.audioSegment?.speed??1;r.push({sceneId:t,cue:E,timeOffsetInTau:(Yx(n,E)-i)*s})}if(!i)return l;const u=n.getPinAndCompositionForPinTrackId(t);if(!u)return l;const{pin:f,composition:m}=u;if(0===m.timeline.cues.components.length)return l;const p=GV(e,m.id),g=p.cuedTrackMap?.[t];if(!g)return l;const{getTauData:h}=p.tausAndDataLinkedSub(),v=Yx(h(f.tauAnchor.tauId),f);for(const E of g){const n=Yx(h(E.tauAnchor.tauId),E)-v,r=UP(e,t,Math.max(0,n));if(!r){d.push({cueId:E.id,sceneId:m.id});continue}let o=c.get(r.id);o||(o=[],c.set(r.id,o)),o.push({sceneId:m.id,cue:E,timeOffsetInTau:(n-s(r.id).timeOffset)*(r.audioSegment?.speed??1)})}for(const E of c.values())E.sort(((e,t)=>oh(e.timeOffsetInTau-t.timeOffsetInTau)));return 0!==c.size||0!==d.length?l:void 0}function Sw({keyframes:e}){return e.length>0?e[e.length-1].offset:0}function Iw(e,t){return e.keyframes===t?e:{...e,keyframes:t}}const bw="del";function Tw(e,t){const n=e[t];if(n.ignoreAlignment)return!0;if(!n.audioSegment)return!1;if(t>0){const r=e[t-1];if(r.ignoreAlignment&&r.audioSegment&&bF(r.audioSegment,n.audioSegment))return!0}if(t<e.length-1){const r=e[t+1];if(r.ignoreAlignment&&r.audioSegment&&bF(n.audioSegment,r.audioSegment))return!0}return!1}function ww(e,t){const n=GV(e,t),{track:r}=n;if(r.type!==Jh.Composition&&r.type!==Jh.Pin&&r.type!==Jh.Sequence)return e;let o,i;r.type===Jh.Pin?(i=new Set([t]),o=VV(e).getPinAndCompositionForPinTrackId(t)?.composition.id):(i=new Set(es(r.timeline.cues.components,(e=>e.sceneId))),o=t),void 0!==o&&i.add(o);const a=new Map;for(const s of i){const t=vw(e,s);if(!t)continue;const{tauIdToCueData:n,cuesWithNoTau:r}=t,{getTauData:o,taus:i}=GV(e,s).tausAndDataBasic();for(const e of r){const t=e.sceneId;let n=a.get(t);n||(n=new Map,a.set(t,n)),n.set(e.cueId,bw)}for(const[s,c]of n){const t=o(s),n=t.index,r=t.duration,d=t.tau.audioSegment?.speed??1,l=r*d;let u=0;for(let{cue:o,timeOffsetInTau:s,sceneId:f}of c){let t=a.get(f);t||(t=new Map,a.set(f,t));const r=s+Sw(o);if(u>=r)t.set(o.id,bw);else if(Tw(i,n))t.set(o.id,o),u=r;else if(s>=l)t.set(o.id,bw);else{if(yd(u,s)){const t=u-s,n=Kx(e,f,o);o=PD(e,f,Iw(o,Eu(o.keyframes,(e=>{const n=e.offset-t;if(!(n<0))return{...e,offset:n}}))),n+t/d)}if(r>l){let e=!1;o=Iw(o,Eu(o.keyframes,(t=>{if(!e)return s+t.offset>l?(e=!0,{...t,offset:l-s}):t})))}t.set(o.id,o),u=r}}}}if(void 0!==o){let t=a.get(o);t||(t=new Map,a.set(o,t));for(const n of Wx(e,o).cues.components)void 0===n.sceneId||i.has(n.sceneId)?t.has(n.id)||t.set(n.id,bw):t.has(n.id)||t.set(n.id,n)}for(const[s,c]of a)0!==c.size&&(e=_D(e,s,(e=>{if(!iw(e))return e;const t=c.get(e.id);return t!==bw?t||e:void 0}),{checkValidCues:!1}));return e}function Cw(e,t,n){const r=function(e,t,n){return Ew(e,t)?.get(n)||bu()}(e,t,n),o=[];for(const i of r){0!==o.length&&hd(o[o.length-1],i.timeOffsetInTau)||o.push(i.timeOffsetInTau);for(const e of i.cue.keyframes)0===e.offset||hd(e.offset+i.timeOffsetInTau,o[o.length-1])||o.push(i.timeOffsetInTau+e.offset)}return o}function _w(e,t,n,r){const o=wP(e,t,n);if(!o.audioSegment||hd(r.offset,o.audioSegment.offset))return r;const i=Cw(e,t,n);if(0===i.length)return r;const a=wP(mw(e,GT(e.projectId,t)),t,n),s=a?.audioSegment;if(a===o||!s)return r;const c=s.offset;for(const l of s.effects){const e=(d=l.type)in uI?(P()(fI(d),`Invalid effect type: ${d}`),uI[d]):qy(d,[],AE),t=rh(i,(e=>ih(c+e-r.offset))),n=s.offset+(t.match?.value??t.next?.value??t.previous?.value??0),o=rU(l.keyframes,n,e);let a=eU(r,e);a&&(a={...a,keyframes:a.keyframes.filter((e=>e.offset>r.offset))}),a=zF(e,a,{offset:0,value:o}),r=YF(a,e)&&a?ZF(r,a,!0):QF(r,e.type)}var d;return r}const Aw=`${Zh.noteStartString}silence${Zh.noteEndString}`;function*Rw({text:e}){if(!e)return;const t=Gs.get(0,e.string.length);for(const{value:n,range:r}of jm(e,Gu.Highlight,t))yield{highlighterId:n,range:r}}function Mw({id:e,audioSegment:t,defaultSpeaker:n,text:r},o,i){const a=Gf(o),s=[];t&&s.push(function({mediaRefId:e,effects:t,multicamSceneId:n},r){const o=Gf(r),i={};e&&mm(i,e,"mediaReference",o.prop("mediaRefId").path);for(const[a,s]of t.entries())fm(i,s.id,"effect",o.prop("effects").item(a).prop("id").path);n&&mm(i,n,"sequenceTrack",o.prop("multicamSceneId").path);return i}(t,a.prop("audioSegment").path)),s.push(qm(r,a.prop("text").path,i));const c={};return fm(c,e,"tau",a.prop("id").path),n&&mm(c,n.speakerId,"voice",a.prop("defaultSpeaker").prop("speakerId").path),s.push(c),um(s)}function Dw(e){const t=new Map;for(const n of e)for(const e of n.layers)t.set(e.id,{cardLayer:e,card:n});return t}const Ow=em("getCardLayerAndCard");function xw(e,t,n){return function(e,t){return qf(Dw,sm(e,t),Ow,Qb(e,t))}(e,t).get(n)}function kw(e,t,n){return xw(e,t,n)?.cardLayer}function Nw(e,t,n){const r=xw(e,t,n);return P()(r,"Card layer not found"),r}function Pw(e,t,n){return Nw(e,t,n).cardLayer}function Lw(e,t,n){return e.layers.find((e=>e.sourceSceneId===t&&e.sequenceSceneId===n))}function Fw(e,t,n){const r=xw(e,t,n);if(!r)return;const{card:o,cardLayer:i}=r,a=sT(e,t,o);if(i.sourceSceneId===t)return a;const s=BB(e,i.sourceSceneId)?.pin;if(!s)return{offset:a.offset,duration:0};const c=function(e,t,n){const r=UB(e,t,n),o=Kx(e,t,r),i=zB(e,t,r);return{offset:o,duration:i}}(e,t,s.id);return cp(a,c)??{offset:a.offset,duration:0}}function Uw(e,t,n){const r=fu(n,(n=>Fw(e,t,n)));if(0===r.length)return;const o=Math.min(...r.map(np));return{offset:o,duration:Math.max(...r.map(rp))-o}}function Bw(e,t,n){const{card:r,cardLayer:o}=Nw(e,t,n);return AT(e,t,o.sourceSceneId,r)}const jw=new Set(aI.map((({type:e})=>e)));function Vw(e){return jw.has(e.type)}function zw(e,t){return e.sourceSceneId===t.sourceSceneId&&e.sequenceSceneId===t.sequenceSceneId}const Gw="SCRIPT_TRACK";function Ww(e){const{id:t=Ps(),effects:n=[],isHidden:r=!1,isLocked:o=!1,...i}=e;return{id:t,effects:n,isHidden:r,isLocked:o,...i}}function Hw({doc:e,compositionId:t,cardBoundaryId:n,sourceTrackId:r,sequenceTrackId:o,fractionOfViewport:i=1}){const a=function({doc:e,compositionId:t,cardBoundaryId:n,sourceTrackId:r,sequenceTrackId:o,fractionOfViewport:i=1}){const a=vk(e,t).videoMetadata??px,s=[];if(t!==r){const n=function(e,t,n,r){const o=Qb(e,t);for(const i of o){const e=Lw(i,n,r);if(e)return e}return}(e,t,r,o);n&&s.push(...n.effects.map(iU))}if(0===s.length){const c=void 0!==o?_P(e,o):AT(e,t,r,tT(e,t,n)).at(0);c&&s.push(...function(e,t,n,r){const{audioSegment:o}=t;if(!o)return[];const{visual:i}=t;if(i)return o.effects.filter(Vw).map((e=>iU(e)))??[];if(o.mediaRefId&&n){const t=function(e){if(bg(e)){const{width:t,height:n}=Ly(e.video);return{width:t,height:n}}if(Tg(e)){const{width:t,height:n}=Ly(e.image);return{width:t,height:n}}return}(Pp(e,o.mediaRefId));if(t){const{width:e,height:o}=t;return[$w(e,o,n,r)]}}return[]}(e,c,a,i))}void 0===s.find((({type:e})=>"box"===e))&&s.push(qw(a,i));return s}({doc:e,compositionId:t,cardBoundaryId:n,sourceTrackId:r,sequenceTrackId:o,fractionOfViewport:i});return Ww({sourceSceneId:r,sequenceSceneId:o,effects:a})}function qw(e,t=1){return LE(jE,{width:t,height:e.height/e.width*t})}function $w(e,t,n,r=1){const o=n.width/e,i=n.height/t,a=Math.min(o,i);return LE(jE,{width:e*a/n.width*r,height:t*a/n.width*r})}function Kw(e,t){return(0,Me.fastDeepEqualJson)(e.layers,t)?e:(0,T.ZP)(e,(e=>{e.layers=t}))}function Yw(e,t,n,r){return e=RD(e,t,Kw(tT(e,t,n).start,r))}function Zw(e,t,n){return(0,T.ZP)(e,(e=>{e.sourceSceneId=t,e.sequenceSceneId=n}))}function Jw(e,t){return e.map((e=>{const n=e.effects.map((e=>{const n=e.keyframes[e.keyframes.length-1];return t>=n.offset?{...iU(e),keyframes:[{offset:0,value:n.value}]}:{...iU(e),keyframes:[{offset:0,value:e.keyframes[0].value}]}}));return Ww({...e,id:Ps(),effects:n})}))}function Qw(e,t,n){const{card:r}=Nw(e,t,n.id),o=hu(r.layers,(e=>e.id===n.id?n:e));return o!==r.layers&&(e=Yw(e,t,r.id,o)),e}function Xw({doc:e,compositionId:t,cardLayerId:n,newSourceTrackId:r,newSequenceTrackId:o}){const{cardLayer:i,card:a}=Nw(e,t,n);if(i.sourceSceneId===r&&i.sequenceSceneId===o)return e;const s=a.layers.map((e=>e.id===n?Zw(e,r,o):e.sourceSceneId===r&&e.sequenceSceneId===o?Zw(e,i.sourceSceneId,i.sourceSceneId&&i.sequenceSceneId):e));return Yw(e,t,a.id,s)}function eC(e,t){for(const n of Array.isArray(t)?t:[t])e=ZF(e,n,!0);return e}function tC(e,t,n,r){for(const o of Array.isArray(n)?n:[n]){let i=Pw(e,t,o);for(const e of Array.isArray(r)?r:[r]){const t=Array.isArray(n)&&n.length>1&&void 0===i.effects.find((({type:t})=>t===e.type));i=eC(i,t?iU(e):e)}e=Qw(e,t,i)}return e}function nC(e,t,n,r){return tC(e=Qw(e,t,{...Pw(e,t,n),effects:[]}),t,n,r)}function rC(e,t){return iC(e).offset-t}function oC(e){return e.keyframes[e.keyframes.length-1].offset}function iC(e){return{offset:e.controlledTimeRange.offset+e.anchor.timeOffset,duration:oC(e)}}function aC(e,t,n,r){const o=SU(e,t,r.start),i=o+n.anchor.timeOffset+oC(n),a=dT(e,t,i);return{offset:o,duration:(a?rp(sT(e,t,a)):i)-o}}function sC(e,t,n,r,o){if(!o)return bu();const i=function(e,t){return Tu(e.filter((e=>"layer"===e.anchor.type&&e.anchor.layerId===t)))}(n,o.id);return i.map((n=>({...n,controlledTimeRange:aC(e,t,n,r)})))}const cC=em("getStoryboardCues");function dC(e,t,n,r,o){const i=Qb(e,n);var a;return Tu(0===(a=Array.from(ss(fu(i,(i=>{const a=Lw(i,r,o);return sC(e,n,t,i,a)}))))).length?a:[...a].sort(((e,t)=>{const n=iC(e),r=iC(t);return n.offset!==r.offset?n.offset-r.offset:-(n.duration-r.duration)})))}function lC(e,t,n){const r=kw(e,t,n);return r?function(e,t,n,r){const o=vk(e,t);if(P()(o.type===Jh.Composition,"Not a composition"),!o.storyboardCues)return bu();return qf(dC,im(e.projectId,t,`${n}+${r}`),cC,e,o.storyboardCues,t,n,r)}(e,t,r.sourceSceneId,r.sequenceSceneId):bu()}const uC={[GE]:"hasPosition",[HE]:"hasScale",[YE]:"hasRotation",[VE]:"hasBox",[Wy]:"hasOpacity",[$E]:"hasTargetPosition"};function fC(e){const t={...TE};for(const n of e.keyframes){const e=Object.keys(n.props);for(const n of e)t[uC[n]]=!0}return t}function mC(e,t,n){const r=vk(e,t);if(P()(r.type===Jh.Composition,"Not a composition"),r.storyboardCues)return r.storyboardCues.find((e=>e.id===n))}const pC=em("applyAllStoryboardCues");function gC(e,t){return function(e,t){return qf(EC,sm(e,t),pC,e,t)}(e,t.trackId)}function hC(e,t,n){return im(e,n,t.id)}function vC(e,t,n,r,o){const{keyframes:i}=e;if(0===i.length)return!1;let a=!1;for(let l=0;l<i.length;l++){const u=i[l],f=u.props;for(const i of ye(f)){const m=f[i];if(void 0===m)continue;const p=uI[i];let g=[...r[i]??[]];if(void 0===g||0===g.length?g=[{offset:Math.min(0,t),value:p.defaultValue}]:1===g?.length&&t<g[0].offset&&(g=[{offset:t,value:g[0].value},...g.slice(1)]),0===l){const r={offset:t,value:t<0?rU([...n[i]??g],e.anchor.timeOffset,p):g[g.length-1].value};1===g.length&&uy(g[0].offset,r.offset,o)?g=[r,...g.slice(1)]:(s=g[g.length-1].offset,c=r.offset,ly(s,d=o)<ly(c,d)?g=[...g,r]:uy(g[g.length-1].offset,r.offset,o))}const h={offset:t+u.offset,value:m,curve:u.curve};g=[...g,h],r[i]=g,a=!0}}var s,c,d;return a}function EC(e,t){if(!e.isStoryboard)return e;if(!vk(e,t).storyboardCues)return e;const{projectId:n}=e,r=vk(e,t).videoMetadata;if(!r)return e;const o=new Map,i=new Map;let a=!1;for(const s of Qb(e,t)){const c=SU(e,t,s.start),d=SU(e,t,s.end)-c,l=s.layers,u=hu(l,(o=>{const s=lC(e,t,o.id);if(!s||0===s.length)return o;a=!0;const l={};for(const e of o.effects)l[e.type]=e.keyframes;let u=!1;for(const n of s){const a=rC(n,c);if(f=d,ly(a,m=r)>=ly(f,m))break;if(fy(a+oC(n),0,r))continue;const s={};if(a<0){const r=dT(e,t,iC(n).offset);if(void 0!==r){let e=Lw(r,o.sourceSceneId,o.sequenceSceneId);if(void 0!==e){e=i.get(e.id)??e;for(const t of e.effects)s[t.type]=t.keyframes}}}u=vC(n,a,s,l,r)||u}var f,m;if(!u)return o;const p=[];for(const e of o.effects){const t=l[e.type];if(P()(t,`Did not merge keyframes for ${e.type}`),!(t.length>=e.keyframes.length))throw new Error("Fewer keyframes than expected");p.push({...e,keyframes:t}),delete l[e.type]}for(const e of ye(l)){P()(fI(e),`Invalid effect type: ${e}`);const t=uI[e];p.push(t(l[e],hC(n,o,e)))}return eC(o,p)}));if(u!==l){o.set(s.id,Kw(s.start,u));for(const e of u)i.set(e.id,e)}}return o.size>0&&(e=_D(e,t,(e=>o.get(e.id)??e))),a&&(e={...e,projectId:`${e.projectId}-tmp-storyboard-cues`}),e}function yC(e,t,n){let r;const o=vk(e,t).storyboardCues;if(o){r=[];const e=new Set;for(const t of n)pU(t)&&t.layers.forEach((t=>e.add(t.id)));for(const t of o)e.has(t.anchor.layerId)&&r.push(t)}return r}function SC(e,t){const n=Gf(t);return um(e.map(((e,t)=>{const r={};return mm(r,e.anchor.layerId,"cardLayer",n.item(t).prop("anchor").prop("layerId").path),r})))}const IC=(0,Yl.createCachedSelector)(((e,t)=>Wx(e,t).LEGACY_voiceoverMetadataTrack),((e,t)=>Wx(e,t).noAudioTrack),((e,t)=>Wx(e,t).pins),((e,t)=>Wx(e,t).cues),((e,t)=>Wx(e,t).cards),((e,t,n,r,o)=>[e,t,n,r,o]))({...yp("getTrackComponentLists"),keySelector:sm});const bC=["LEGACY_voiceoverMetadataTrack","noAudioTrack","pins","cues","cards"];function*TC(e){for(const t of e)for(const e of t.components)yield[e,t]}function*wC(e,t){for(const n of bP(e,t))for(const{highlighterId:e,range:t}of Rw(n))yield{tau:n,highlighterId:e,range:t}}function CC(e,t){if(e.isStoryboard)return!1;if(function(e,t){let n,r=0;for(const o of Lx(e,t).taus){const e=o.audioSegment;r+=1,e&&n&&bF(n,e)&&(r-=1),n=e}return r>1}(e,t))return!0;const n=_P(e,t);if(!n)return!1;const r=JP(e,t,n.id);return!!r&&(!(!Ag(r)&&!Boolean(r.audio&&r.audio.LEGACY_perChannelRefs))||!hd(_k(e,t),r.audio.duration))}const _C=em("tracksReferenceSummaryCache");function AC(e,t,n,r){return Em(RC,cm(t,e),_C,e,t,n,r)}function RC(e,t,n,r){const o=Gf(e);return um([...n.map(((e,n)=>function(e,t,n,r){return Em(DC,function(e,t,n){return im(e,t.id,n.join("/"))}(t,n,e),MC,e,n.id,r,n.effects,n.timeline,n.storyboardCues,n.type,n.type===Jh.Transcript?n.transcriptVoiceoverRefId:void 0)}(o.item(n).path,t,e,r)))])}const MC=em("trackReferenceSummaryCache");function DC(e,t,n,r,o,i,a,s){const c={},d=Gf(e);for(const[l,u]of r.entries())fm(c,u.id,"effect",d.prop("effects").item(l).prop("id").path);return fm(c,t,function(e){switch(e){case Jh.Transcript:return"transcript";case Jh.Pin:return"pinTrack";case Jh.Sequence:return"sequenceTrack";case Jh.Composition:return"composition";case Jh.Restorable:return"restorableTrack";default:throw new Error(`Unknown track type: ${e}`)}}(a),d.prop("id").path),s&&mm(c,s,"mediaReference",Gf(e).prop("transcriptVoiceoverRefId").path),um([c,Gx(o,d.prop("timeline").path,n),i?SC(i,d.prop("storyboardCues").path):{}])}function OC({videoMetadata:e,effects:t,gain:n,suppressRoomtone:r,pan:o,isSoloed:i,isMuted:a,timeline:s,duckingParameters:c},d){return lx(d=(0,T.Uy)(d,(s=>{s.videoMetadata=e,s.gain=n,s.suppressRoomtone=r,s.pan=o,s.isSoloed=i,s.isMuted=a,s.effects=t.map(iU),s.duckingParameters=c})),function({superTau:e},t){return zx(t,function({pan:e,gain:t,effects:n},r){return(0,T.Uy)(r,(r=>{r.pan=e,r.gain=t,r.effects=n.map(iU)}))}(e,t.superTau))}(s,d.timeline))}function xC(e={}){return WC({...e,type:xu.cardTrackComponentList})}const kC=(0,fp.PW)((()=>[gU()]));function NC(e,t){return HC(e,t,kC())}function PC(e,t){return xC({...qC(e,t,kC()),type:void 0})}function LC(e){return Boolean(e&&e.type===xu.cardTrackComponentList)}function FC(e,t){const n=Gf(t).prop("components");return um([{},...e.components.map(((e,t)=>function(e,t){const n=ek(e,t),r={},o=Gf(t).prop("layers"),{layers:i}=e;for(let a=0;a<i.length;a++){const e=i[a],t=o.item(a);fm(r,e.id,"cardLayer",t.prop("id").path),mm(r,e.sourceSceneId,"cardLayerTrack",t.prop("sourceSceneId").path),void 0!==e.sequenceSceneId&&"all"!==e.sequenceSceneId&&mm(r,e.sequenceSceneId,"sequenceTrack",t.prop("sequenceSceneId").path);for(let n=0;n<e.effects.length;n++){fm(r,e.effects[n].id,"effect",t.prop("effects").item(n).prop("id").path)}}return um([n,r])}(e,n.item(t).path)))])}function UC(e={}){return WC({...e,type:xu.pinTrackComponentList})}const BC=(0,fp.PW)((()=>[LB()]));function jC(e,t){return HC(e,t,BC())}function VC(e,t){return UC({...qC(e,t,BC()),type:void 0})}function zC(e){return Boolean(e&&e.type===xu.pinTrackComponentList)}function GC(e,t){const n=Gf(t);return um([{},...e.components.map(((e,t)=>function(e,t){const n=ek(e,t),r={},{sceneId:o,endAnchor:i}=e,a=Gf(t);if(mm(r,o,"pinTrack",a.prop("sceneId").path),"cardBoundary"===i?.type){const e=Gf(a.prop("endAnchor").path);mm(r,i.cardBoundaryId,"component",e.prop("cardBoundaryId").path)}return um([n,r])}(e,n.prop("components").item(t).path)))])}function WC({id:e=Ps(),components:t=[],type:n}){return{type:n,id:e,components:t}}function HC({id:e,type:t,components:n},r,o){return{id:e,type:t,components:fu(n,(e=>Fu(o,e,r)))}}function qC({id:e,components:t,type:n},r,o){return WC({id:e,type:n,components:t.map((e=>Uu(o,e,r)))})}function $C(e,t){let n;for(const r of e.components){if(n){if(!Qx(t,n,r))return!1;if(r.sortTiebreaker<n.sortTiebreaker)return!1}n=r}return!0}function*KC(e,t){for(const n of t.components)yield*Xx(e,n)}function YC(e,t,n){const r=e.components.findIndex((e=>e.id===t));return r<0||(0,Me.fastDeepEqualJson)(e.components[r],n)?e:(0,T.ZP)(e,(e=>{e.components[r]=n}))}function ZC(e,t,n,r){const o=[...n[r].components];let i=!1;const{getTauData:a}=GV(e,t).tausAndDataLinkedSub();for(let s=1;s<o.length;s++){const n=o[s-1],c=o[s],d=$x(a(n.tauAnchor.tauId),n),l=$x(a(c.tauAnchor.tauId),c),u=n.tauAnchor,f=c.tauAnchor;hd(d,l)||u.tauId!==f.tauId||u.location===f.location||u.location<f.location===d<l||(Ht(new Ta(`Discrepancy in time/text component ordering in ${r} track components`),"component-anchor-order"),o[s-1]=PD(e,t,n,d),o[s]=PD(e,t,c,l),i=!0)}return i?Bx({...n,[r]:{...n[r],components:o}}):n}function JC(e,t){const n=Wx(e,t);if(0===n.cards.components.length||0===n.pins.components.length)return e;let r=-1/0;const o=new Set;let i;const a=[],{getTauData:s}=GV(e,t).tausAndDataLinkedSub(),c=ak(e,t,IC(e,t).filter((e=>LC(e)||zC(e))));function d(){r=-1/0,o.clear()}function l(){if(i){let e=i.id;for(const t of o)a.push({pinComp:t,prevComponentId:e}),e=t.id;i=void 0,d()}}for(const u of c){const e=$x(s(u.tauAnchor.tauId),u);PB(u)?(l(),r!==e&&(d(),r=e),o.add(u)):pU(u)&&(r===e?i=u:(l(),d()))}l();for(const{pinComp:u,prevComponentId:f}of a)e=n_(e,t,Wx(e,t).pins,u,f,void 0,!0,!0,!1);return e}function QC(e,t,n,r){if(function(e,t,n){const{getTauData:r}=GV(e,t).tausAndDataLinkedSub();return $C(n,r)}(e,t,n[r]))return ZC(e,t,n,r);const{getTauData:o}=GV(e,t).tausAndDataLinkedSub(),i=[...n[r].components].sort(((e,t)=>Qx(o,e,t)?Ie.OrderedAscending:Ie.OrderedDescending));let a=0;for(let s=0;s<i.length;s++){let e=i[s];e.sortTiebreaker<=a&&(e=xD(e,a+.001),i[s]=e),a=e.sortTiebreaker}return ZC(e,t,Bx({...n,[r]:{...n[r],components:i}}),r)}function XC(e,t,n){if(GV(e,t).getAreComponentsOrdered())return e;const r=vk(e,t),o=r.timeline;let i=o;const a=n?.assumeNoTauOrderChange?.prevTimeline;for(const s of bC)a&&o[s]===a[s]||(i=QC(e,t,i,s));return i!==o&&(e=ix(e,lx(r,i))),e}function e_(e,t,n,r,o,i,a){P()(Number.isInteger(r),"Expected afterTextOffset to be an integer"),P()(Number.isInteger(o),"Expected byDelta to be an integer");const{tau:s,timeOffset:c,duration:d}=GV(e,t).tausAndDataBasic().getTauData(n),l=s.audioSegment?.speed??1,u=c+d,f=s.text.string.length;return _D(e,t,(s=>{const{tauAnchor:d}=s;var m;if(!(d.tauId===n&&d.location>=r))return s;{const r=d.location+o;if((m=s).type!==xu.voiceComponent&&m.type!==xu.cueComponent||!(r>f||r<0)){const o=Math.max(Math.min(r,f),0);let d=OD(s,{tauId:n,location:o});const m=a[s.id];if(void 0===m)return d;const p=qx(e,t,d),g=Math.max(c,Math.min(u,m+i/l));return hd(g,p)||(d=PD(e,t,d,g/l)),d}}}))}function t_(e,t,n,r){const o=n-r;return ND(e,(e.offsetFromBaseTime/t+o)*t)}function n_(e,t,n,r,o,i,a=!0,s=!0,c=!0){let d=n,l=r.sortTiebreaker;const u=void 0!==o?nk(e,t,o):void 0,f=void 0!==i?nk(e,t,i):void 0,m=u?.[0],p=u?.[1],g=f?.[0],h=m?.sortTiebreaker,v=g?.sortTiebreaker;if(void 0!==h&&void 0!==v)if(h>v){if(m&&p){const n=xD(m,v-.5),r=YC(p,m.id,n);e=CD(e,t,r,a,s),d.id===r.id&&(d=r)}l=v-.25}else l=(h+v)/2;else void 0!==h?l=h+.5:void 0!==v&&(l=v-.5);const E=((r=xD(r,l)).tauAnchor?TP(e,t,r.tauAnchor.tauId):void 0)?.audioSegment?.speed??1;let y=qx(e,t,r);if(r.tauAnchor){const n=r.tauAnchor.tauId,o=r.tauAnchor.location;for(const i of ck(e,t,n)){if(i.tauAnchor.location<=o)continue;const n=qx(e,t,i);if(n>=y)break;y=qx(e,t,r=t_(r,E,n,y))}}const S=g&&qx(e,t,g);void 0!==S&&S<y&&(y=qx(e,t,r=t_(r,E,S,y)));const I=m&&qx(e,t,m);return void 0!==I&&I>y&&(y=qx(e,t,r=t_(r,E,I,y))),d=d.components.some((e=>e.id===r.id))?YC(d,r.id,r):function(e,t){return(0,T.ZP)(e,(e=>{e.components.push(t)}))}(d,r),CD(e,t,d,a,s,c)}const r_=.01;function o_(e,t){for(let n=t-1;n>=0;n--)if(!e[n].isBlocked)return n}function i_(e,t){const n=e.length;for(let r=t+1;r<n;r++)if(!e[r].isBlocked)return r}function a_(e,t,n,r){if(0===r.size)return e;const o=bP(e,t),{projectId:i}=e,a=hu(o,(e=>{for(const t of n){const n=r.get(c_(i,e.id,t));if(n){if(!e.audioSegment)throw new Error("Tau without audio segment should not have fade update");e=VM(e,FF(e.audioSegment,"audioFades"===t?NF:PF,n.fadeInDuration,n.fadeOutDuration,n.fadeInShape,n.fadeOutShape,n.headTransitionEffect,n.tailTransitionEffect))}}return e}));return a===o?e:Cx(e,t,xx(Lx(e,t),a))}function s_(e,t,n,r,o,i=!0,a=!1){const{taus:s,getTauData:c}=GV(e,t).tausAndDataBasic(),d=new Map,l=c(n).index,u="fadeInDuration"in o&&o.fadeInDuration,f="fadeOutDuration"in o&&o.fadeOutDuration,m="fadeInShape"in o&&o.fadeInShape,p="fadeOutShape"in o&&o.fadeOutShape,g="headTransitionEffect"in o&&o.headTransitionEffect,h="tailTransitionEffect"in o&&o.tailTransitionEffect;for(const v of r)d_(e.projectId,l,s,v,d,u,f,m,p,g,h,i);return e=a_(e,t,r,d),a&&(e=sO(e,t)),e}function c_(e,t,n){return im(e,t,n)}function d_(e,t,n,r,o,i,a,s,c,d,l,u){const f=n[t];if(!f.audioSegment)throw new Error("No audio");const m=f.audioSegment.speed,p=c_(e,f.id,r),g=o.get(p)||f.audioSegment[r]||ph;if("number"===typeof i&&i<0){const a=o_(n,t),c=void 0!==a?n[a]:void 0;if(void 0!==a&&c&&!EN(c)&&c.audioSegment){if(u){const t=c.audioSegment.speed,l=o.get(c_(e,c.id,r))||c.audioSegment[r],u=(f.audioSegment.duration-Math.abs(g?.fadeOutDuration||0))/m-r_,p=(c.audioSegment.duration-Math.abs(l?.fadeInDuration||0))/t-r_,h=Math.min(Math.min(f.audioSegment.offset/m,u),p);d_(e,a,n,r,o,!1,i=-Math.min(-i,h),!1,s,!1,d,!1)}}else i=0}if("number"===typeof a&&a<0){const i=i_(n,t),s=void 0!==i?n[i]:void 0;if(void 0!==i&&s&&!EN(s)&&s.audioSegment){if(u){const t=s.audioSegment.speed,d=o.get(c_(e,s.id,r))||s.audioSegment[r],u=(f.audioSegment.duration-Math.abs(g?.fadeInDuration||0))/m-r_,p=(s.audioSegment.duration-Math.abs(d?.fadeOutDuration||0))/t-r_,h=Math.min(Math.min(s.audioSegment.offset,u),p);d_(e,i,n,r,o,a=-Math.min(-a,h),!1,c,!1,l,!1,!1)}}else a=0}if(u&&"number"===typeof i&&i>=0){const i=o_(n,t),a=void 0!==i?n[i]:void 0,s=a?o.get(c_(e,a.id,r))||a.audioSegment?.[r]:void 0;s&&void 0!==i&&a&&!EN(a)&&s.fadeOutDuration&&s.fadeOutDuration<0&&d_(e,i,n,r,o,!1,0,!1,!1,!1,!1,!1)}if(u&&"number"===typeof a&&a>=0&&u){const i=i_(n,t),a=void 0!==i?n[i]:void 0,s=a?o.get(c_(e,a.id,r))||a.audioSegment?.[r]:void 0;s&&void 0!==i&&a&&!EN(a)&&s.fadeInDuration&&s.fadeInDuration<0&&d_(e,i,n,r,o,0,!1,!1,!1,!1,!1,!1)}if("number"===typeof i&&i>0){const e=_F(f.audioSegment)-Math.abs(g.fadeOutDuration||0)-r_;i=Math.min(i,e)}if("number"===typeof a&&a>0){const e=_F(f.audioSegment)-Math.abs(f.audioSegment[r]?.fadeInDuration||0)-r_;a=Math.min(a,e)}const{fadeInDuration:h,fadeOutDuration:v,fadeInShape:E,fadeOutShape:y,headTransitionEffect:S,tailTransitionEffect:I}=g,b=!1!==i?i:h,T=!1!==a?a:v,w=!1!==s?s:E,C=!1!==c?c:y,_=!1!==d?d:S,A=!1!==l?l:I;h===b&&v===T&&E===w&&y===C&&S===_&&I===A||o.set(p,{fadeInDuration:b,fadeOutDuration:T,fadeInShape:w,fadeOutShape:C,headTransitionEffect:_,tailTransitionEffect:A})}function l_(e,t){const{doc:n,newTrackId:r}=ux(e,t);e=n;let o=!1;for(const i of e.compositions){const n=GV(e,i.id).tausAndDataBasic().tausData;for(const e of n){if((e?.scratchSequenceTauInfo?.tau.replacedContentSceneId||e?.tau.replacedContentSceneId)===t){o=!0;break}}}return o||(e=function(e,t){const n=vk(e,t);let{compositions:r,transcripts:o,sequenceScenes:i,pinScenes:a,restorableScenes:s}=e;switch(n.type){case Jh.Composition:r=Hp(e,t);break;case Jh.Transcript:o=jp(e,t);break;case Jh.Sequence:i=Zp(e,t);break;case Jh.Pin:a=tg(e,t);break;case Jh.Restorable:s=ig(e,t);break;default:throw new Error(`Removed track has invalid type: ${n.type}`)}if(e=ex(e,r,o,i,a,s),e=Jv(e,t),n.type===Jh.Pin)for(const c of yk(e))e=_D(e,c,(e=>{if(!PB(e)||e.sceneId!==t)return e}));return e}(e,t)),{doc:e,newTrackId:r}}function u_(e,t){if(!e.audio.analyses?.bleed)return t;const n=e.audio.analyses.bleed;if(0===n.length)return t;const r=[];let o=0,i=!1;const a=zg(t);for(const c of n)o<c.offset&&r.push(hL(a,o,c.offset-o,sL)),gL(a,c.offset,c.duration).length>0&&(i=!0,r.push([Dh({label:"Mic bleed",startTime:c.offset,endTime:c.offset+c.duration,speakerId:void 0,category:Ch.Bleed})])),o=rp(c);const s=OL(t);return s>o&&r.push(hL(a,o,s-o,sL)),i?dL(...r):t}function f_(e,t,n){const r=e.voiceover.metadata[t];return lL(r&&zg(r),n&&zg(n),Wh)?e:{...e,voiceover:{...e.voiceover,metadata:{...e.voiceover.metadata,assetJson:cE(),[t]:n}}}}function m_(e,t){return{...e,source:t}}A.logging.groupLogger("descriptmodel/docequal");function p_(e,t){if(e===t)return!0;if(e&&t&&"object"===typeof e&&"object"===typeof t){const n=Array.isArray(e),r=Array.isArray(t);if(n&&r){const n=e.length;if(n!==t.length)return!1;for(let r=n;0!==r--;)if(!p_(e[r],t[r]))return!1;return!0}if(n!==r)return!1;const o=e instanceof Set,i=t instanceof Set;if(o!==i)return!1;if(o&&i){if(e.size!==t.size)return!1;const n=t.keys();let r;for(const t of e)if(r=n.next(),!p_(t,r.value))return!1;return!0}const a=e instanceof Map,s=t instanceof Map;if(a!==s)return!1;if(a&&s){if(e.size!==t.size)return!1;const n=t.entries();let r;for(const t of e)if(r=n.next(),!p_(t,r.value))return!1;return!0}const c=Object.keys(e).filter((t=>void 0!==e[t])),d=Object.keys(t).filter((e=>void 0!==t[e])),l=c.length;if(l!==d.length)return!1;for(let e=l;0!==e--;)if(!Object.prototype.hasOwnProperty.call(t,c[e]))return!1;for(let u=l;0!==u--;){const n=c[u];if(!p_(e[n],t[n]))return!1}return!0}return e!==e&&t!==t}function g_(e){const t={};for(const{id:n,assetKey:r}of e.mediaRefs)t[r]=n;return t}function h_(e){const t={};for(const{audio:n,id:r}of e.mediaRefs)if(n&&n.trackSceneIds)for(const e of n.trackSceneIds)t[e]=r;return t}function v_({mediaRefs:e=[],id:t}={}){return{LEGACY_id:t,mediaRefs:e}}function E_(e,t,n=!0){return hE(e,"mediaRefs",hu(e.mediaRefs,(e=>{let r;if(e.voiceover){const o=sE(e.assetKey);let i=eF(void 0,t,o,!0);if(!i){if(void 0!==e.voiceover.metadata)return e;if(n)throw new Error(`No voiceoverMetadata was available in the document and no external encoded was provided for asset key ${o}`);i=$L()}r=KL({...e.voiceover,metadata:i})}const o=t.assetJsonForAssetKey(e.assetKey,!Ag(i=e)&&!Dg(i)&&"descriptRecordingInProgress"!==i.source);var i;return o||r?UL({...e,assetJson:o??e.assetJson,voiceover:r??e.voiceover}):e})))}function y_(e,t){const{[PL]:n=!1,[LL]:r=!1}=t.encodingOptions;if(n&&r)return e;return hE(e,"mediaRefs",hu(e.mediaRefs,(e=>e.voiceover?UL({...e,assetJson:r?e.assetJson:void 0,voiceover:n?e.voiceover:{...e.voiceover,metadata:void 0}}):e)))}function S_({mediaRefs:e,LEGACY_id:t},n){return{id:t,type:xu.mediaLibrary,mediaRefs:e.map((e=>n.encodeReferencable(nF(e,n))))}}function I_(e,t){let n=t;const[r,o]=Y(t);let i=1;const a=function(e){const t={};for(const{id:n,displayName:r}of e)t[r]=n;return t}(e);for(;void 0!==a[n];)n=`${r}-${i}${o}`,i++;return n}function b_(e){return fu(e.mediaRefs,(e=>_g(e)?e:void 0))}const T_=em("mediaLibrarySummaryCache");function w_(e,t,n){return Em(C_,t,T_,e,t,n.mediaRefs)}function C_(e,t,n){const r=Gf(e);return um(n.map(((e,n)=>function(e,t,n,r){return Em(Bk,function(e,t,n){return im(e,t.id,n.join("/"))}(t,n,e),Uk,e,n.id,n.audio,n.voiceover,r)}(r.prop("mediaRefs").item(n).path,t,e,!1))))}const __="force";var A_=(e=>(e[e.Queued=0]="Queued",e[e.Publishing=100]="Publishing",e[e.QueuedTraining=200]="QueuedTraining",e[e.QueuedRetraining=201]="QueuedRetraining",e[e.Training=300]="Training",e[e.Error=400]="Error",e[e.ScriptDidNotMatch=401]="ScriptDidNotMatch",e[e.MissingConsent=402]="MissingConsent",e[e.InvalidConsent=403]="InvalidConsent",e[e.InsufficientUnscriptedAudioMatched=404]="InsufficientUnscriptedAudioMatched",e[e.UnknownVerificationFailure=405]="UnknownVerificationFailure",e[e.Done=500]="Done",e))(A_||{});const R_=new Set([400,401,402,403,404,405]),M_=new Map([["lime",{cssValue:"var(--green-800)",hex:"#72B372",name:"Green"}],["grape",{cssValue:"var(--purple-800)",hex:"#6600CC",name:"Purple"}],["mango",{cssValue:"var(--orange-800)",hex:"#DE4A1D",name:"Orange"}],["brown",{cssValue:"var(--brown-800)",hex:"#583E31",name:"Brown"}],["pomegranate",{cssValue:"var(--pink-800)",hex:"#C50052",name:"Pink"}],["cherry",{cssValue:"var(--red-800)",hex:"#C50000",name:"Red"}],["mint",{cssValue:"var(--amber-800)",hex:"#A86800",name:"Yellow"}],["aqua",{cssValue:"var(--blue-800)",hex:"#254693",name:"Blue"}]]),D_=new Map([["pomegranate",{cssValue:"#D82292",hex:"#D82292",name:"Pomegranate"}],["mango",{cssValue:"#FA8A3B",hex:"#FA8A3B",name:"Mango"}],["mint",{cssValue:"#00D1B2",hex:"#00D1B2",name:"Mint"}],["grape",{cssValue:"#9166FF",hex:"#9166FF",name:"Grape"}],["aqua",{cssValue:"#00AAFF",hex:"#00AAFF",name:"Aqua"}],["lime",{cssValue:"#33D900",hex:"#33D900",name:"Lime"}],["cherry",{cssValue:"#FF365B",hex:"#FF365B",name:"Cherry"}]]);function O_(e){return e?M_:D_}yp("getVoiceColorMap");function x_(e){return"consentStatus"in e}function k_(e){return!x_(e)&&void 0!==e.backendVoiceId}function N_(e,t){const n=t.toLowerCase();return Cp(e.voices,(e=>e.name.toLowerCase()===n))}const P_=(0,Yl.createCachedSelector)((e=>e.voices),(e=>e.isStoryboard),((e,t)=>{const n={};for(const{color:a}of e)void 0!==a&&(void 0===n[a]?n[a]=1:n[a]+=1);const r=O_(t);let o=Ya(r.keys()),i=1/0;for(const a of r.keys()){if(void 0===n[a])return a;n[a]<i&&(o=a,i=n[a])}return o}))({...yp("getNewVoiceColor"),keySelector:function(e){return e.projectId}});function L_(e,t,n){const{getTauData:r}=GV(e,t).tausAndDataForAttributedString();let o=n.location,i=n.tauId;if(o>=PP(e,t,n.tauId).string.length){const n=DP(e,t,i);if(n){const e=r(n.id).paragraphSpeakers;if(e.length>0&&0===e[0].range.location){const t=e[0].speaker.speaker;return 1===t?void 0:t}}}for(;void 0!==i;){const n=r(i).paragraphSpeakers;for(let e=n.length-1;e>=0;e--){const t=n[e];if(t.range.location<=o){const e=t.speaker.speaker;return 1===e?void 0:e}}const a=OP(e,t,i);i=a?a.id:void 0,o=1/0}}function F_(e,t,n=!1){return ug(e,t.id)||N_(e,t.name)?e:(n&&void 0===t.color&&(t=function(e,t){return(0,T.ZP)(e,(e=>{e.color=t}))}(t,P_(e))),{...e,voices:mg(e,t)})}function U_(e,t,n){let r=0,o=t[r];const i=e.map((e=>{const i=(e.startTime+e.endTime)/2;for(;o&&i>rp(o.timeRange);)r+=1,o=t[r];let a,s=!1;return o&&op(o.timeRange,i)&&(a=o.speaker,s=!0),s||!n?qh(e,a):e}));return i}const{equalFrameCounts:B_,lessThanOrEqualFrameCounts:j_}=s;function V_(e,t){let n=0,r=0;const o=e.length,i=t.length;if(0===o&&0===i)return[];const a=OL(e),s=OL(t);if(0===o)return[{offset:0,duration:s}];if(0===i)return[{offset:0,duration:a}];let c,d=0;const l=[];function u(e){void 0!==c&&(l.push({offset:c,duration:e-c}),c=void 0)}for(;n<o&&r<i;){const o=e[n],i=t[r];Hh(o,i)?(u(d),n+=1,r+=1):o.startTime<i.startTime?(void 0===c&&(c=o.startTime),n+=1,d=Math.max(d,o.endTime)):(void 0===c&&(c=i.startTime),r+=1,d=Math.max(d,i.endTime))}return d=Math.max(a,s),void 0===c&&a!==s&&(c=Math.min(a,s)),u(d),l}function z_(e,t,n){const r=function(e,t,n){const r=V_(e,t),o=V_(e,n),i=[];let a,s=0,c=0;function d(e,r){const o=e.offset,s=o+e.duration;(!a||o>=a.end)&&(a={start:o,end:s,array:r?t:n},i.push(a)),a.end=s,r&&(a.array=t)}for(;s<r.length||c<o.length;){const e=r[s],t=o[c];e&&(void 0===t||e.offset<t.offset)?(d(e,!0),s++):(d(t,!1),c++)}return i}(e,t,n);let o=0;const i=[];for(const{start:s,end:c,array:d}of r)o<s&&i.push(hL(zg(e),o,s-o)),i.push(hL(zg(d),s,c-s)),o=c;const a=Math.max(OL(e),OL(t),OL(n));return o<a&&i.push(hL(zg(e),o,a-o)),dL(...i)}function G_(e){let t=0,n=0,r=-1;const o=[];function i(e){-1!==r&&t<e&&o.push({timeRange:{offset:t,duration:e-t},speaker:r}),r=-1}return e.forEach((({speaker:e,startTime:o,endTime:a})=>{(0,Me.fastDeepEqualJson)(e,r)||(i(o),r=e,t=o),n=a})),i(n),o}function W_(e,t,n){const r=e.length;for(let o=n;o<r;o++){const{timeRange:n,speaker:r}=e[o],i=rp(n),a=B_(n.offset,t),s=B_(i,t);if(a||t<i&&!s)return{speaker:r,nextSearchStartIndex:o}}return{speaker:void 0,nextSearchStartIndex:r}}function H_(e,t){const n=new Set;for(const l of[e,t])for(const{timeRange:e}of l)n.add(e.offset),n.add(rp(e));const r=Array.from(n).sort(((e,t)=>e-t));let o,i;const a=[];function s(e){void 0!==i&&(a.push({timeRange:{offset:i,duration:e-i},speaker:o}),i=void 0)}let c=0,d=0;for(const l of r){s(l);const n=W_(e,l,c);c=n.nextSearchStartIndex;const r=n.speaker,a=W_(t,l,d);d=a.nextSearchStartIndex;const u=a.speaker;(0,Me.fastDeepEqualJson)(r,u)||(o=u,i=l)}return a}function q_(e,t,n,r){const o=G_(e),i=G_(t),a=G_(n),s=H_(o,i),c=H_(o,a);if(function(e,t,n,r){let o=0;const i=t.length;for(const a of e){const e=n(a);for(let s=o;s<i;s++){const i=t[s],c=n(i),d=rp(e);if(j_(d,c.offset)){o=s;break}if(sp(e,c)&&(!r||!r(a,i)))return!0}}return!1}(s,c,(({timeRange:e})=>e),((e,t)=>(0,Me.fastDeepEqualJson)(e.speaker,t.speaker))))return zf.s_;return U_(r,[...s,...c].sort((({timeRange:e},{timeRange:t})=>e.offset-t.offset)),!0)}function $_(e,t,n,r=[]){if(!Array.isArray(e)||!Array.isArray(t)||!Array.isArray(n))return zf.s_;const o=z_(e,t,n);return Array.isArray(o)?q_(e,t,n,o):zf.s_}A.logging.groupLogger("descriptmodel/mediareferencesenergies");const K_=65535;function Y_(e){const t=new Uint8Array(e.byteLength),n=new DataView(e),r=new DataView(t.buffer);for(let o=0;o<e.byteLength;o+=Uint16Array.BYTES_PER_ELEMENT)r.setUint16(o,n.getUint16(o,!1),!0);return t.buffer}function Z_(e,t=_){let n;return n=t?new Uint8Array(e.buffer):new Uint8Array(Y_(e.buffer)),w(n)}const J_=em("decodeEnergiesChunk");function Q_(e){const t=C(e.rmsValuesEncoded);let n;if(P()(t.length/Uint16Array.BYTES_PER_ELEMENT===e.length,"Energies chunk has invalid length"),_)n=new Uint16Array(t.buffer);else{const r=new DataView(t.buffer);n=new Uint16Array(e.length);for(let t=0;t<e.length;t++)n[t]=r.getUint16(t*Uint16Array.BYTES_PER_ELEMENT,!0)}return{offset:e.offset,length:e.length,rmsValues:new Uint16Array(t.buffer)}}function X_(e,t,n){return qf(Q_,im(e,t,`${n.offset}`),J_,n)}function eA(e,t){const n=60*e,r=Math.ceil(t.length/n),o=[];let i=0;for(let a=0;a<r;a++,i+=n){const e=i,r=Math.min(i+n,t.length),s=t.slice(e,r),c=Z_(s);o.push({offset:a*n,length:s.length,rmsValuesEncoded:c})}return{hz:e,rmsValuesEncoded:o}}function tA(e,t,n,r=!0){let o;return n&&(o=eA(n.hz,n.rmsValues)),(0,Me.fastDeepEqual)(Pp(e,t).audio?.energies,o)?e:vO(e,t,"energies",o,void 0,r)}function nA(e,t,n,r,o){const i=Math.round(r*n.hz),a=Math.max(Math.round(o*n.hz),i+1),s=Gs.getStartEnd(i,a),c=iA(e,t,n,s);let d=0,l=0;for(const u of oA(c,s)){for(const e of u)l+=e;d+=u.length}if(0!==d)return l/d}function rA(e,t,n,r){const o=Math.trunc(n*t),i=Math.trunc(r*t)+1,a=Math.max(1,Math.min(e.length-o,i-o));if(o<0||a<=0)return;let s=0;for(let c=o;c<o+a;c+=1)s+=e[c];return s/a}function*oA(e,t){const n=t.location;let r=t.length;for(let o=0;o<e.length&&!(r<=0);o++){const i=e[o],a=Gs.get(i.offset,i.length),s=Zs(a,t);if(!s){if($s(a)<=n)continue;break}Ws(s,a)?yield i.rmsValues:yield i.rmsValues.subarray(s.location-i.offset,s.location-i.offset+s.length),r-=s.length}}function iA(e,t,n,r){if(n.rmsValuesEncoded.length>0){const o=n.rmsValuesEncoded[0].length,i=Math.floor(r.location/o),a=$s(r),s=Math.ceil(a/o),c=n.rmsValuesEncoded[i],d=n.rmsValuesEncoded[s-1];if(c&&c.offset<=r.location&&d&&d.offset+d.length>=a){return n.rmsValuesEncoded.slice(i,s).map((n=>X_(e,t,n)))}}const o=nh(zg(n.rmsValuesEncoded),lh(r,qs,$s,(e=>Gs.get(e.offset,e.length)),!1));return Array.from(Yg(o,(n=>X_(e,t,n))))}const aA=1;function sA({id:e=Ps(),name:t="",color:n}={}){return{type:xu.speaker,id:e,name:t,color:n}}function cA(e){const t=e.split(".");return t.length>1&&t.pop(),t.join(".")}function dA({speakerId:e,styleId:t,generationControls:n=FM,isTTS:r=!1}){return{speakerId:e,styleId:t,generationControls:n,isTTS:r}}function lA(e){return t=>!e(t)}function uA(e){return bh(e.attrs,Ih.Placeholder)}function fA(e){return uA(e)&&e.word===Sh.Placeholder}function mA(e){return uA(e)&&e.word!==Sh.Placeholder}function pA(e){return bh(e.attrs,Ih.UserCorrection)}const gA=lA(uA),hA=lA(fA);function vA(e,t){return Fh(Sh.Placeholder,e,e+t,void 0,Ih.Placeholder,void 0,void 0)}function*EA(e,t,n){const r=.25;let o=e;for(const i of Kg(n)){let e=o;for(;e+r<i.startTime;)yield vA(e,r),e+=r;yield i,o=i.endTime}for(;o+r<e+t;)yield vA(o,r),o+=r}const yA=hp(fp.PW,[Me.fastDeepEqual]),SA=(0,Yl.createCachedSelector)((e=>e.projectId),((e,t)=>Jp(e,t).includeTranscript),((e,t)=>t),((e,t)=>bP(e,t)),((e,t)=>bP(e,t).map((n=>cN(e,t,n)))),((e,t)=>{const n=new Map;for(const r of bP(e,t)){const t=r.audioSegment?.mediaRefId;void 0===t||n.has(t)||n.set(t,Lp(e,t)?.audio?.defaultVoiceId)}return n}),((e,t)=>bP(e,t).map((n=>BP(e,t,n.id)))),((e,t)=>{const n={};for(const r of kk(e,t)){const t=Pp(e,r).audio?.energies;t&&(n[r]=t)}return n}),((e,t,n)=>n),((e,t,n,r,o,i,a,s,c)=>{if(t)return function(e,t,n,r,o,i,a,s){const c=s??FL,d=i.map((e=>Math.trunc(e*c))),l=d.reduce(((e,t)=>e+t),0),u=void 0!==s?new Uint16Array(l):void 0,f=[];let m=0,p=!1;const g=[];let h=0;for(let v=0;v<n.length;v++){const s=n[v];if(s.isBlocked)continue;const E=r[v],y=i[v],S=m+y,I=void 0!==s.audioSegment?.mediaRefId?o.get(s.audioSegment.mediaRefId):void 0;let b;if(void 0!==I&&(b=Ah(I)),E){p=!0;const e=s.audioSegment&&s.audioSegment.offset||0,n=void 0!==s.audioSegment?_F(s.audioSegment):0;let r=0;for(let o of EA(e,n,E.wordArrayView)){let n,i;hA(o)&&(n=E.rangesWithPunc[r],i=r,r+=1,b&&!o.speaker&&(o=qh(o,b))),f.push({...o,startTime:Math.max(o.startTime-e+m,m),endTime:Math.min(o.endTime-e+m,S)}),g.push({sceneId:t,tauId:s.id,rangeWithPunc:n,refWordIdx:i})}}const T=d[v];if(u&&void 0!==s.audioSegment?.mediaRefId){const t=a[s.audioSegment.mediaRefId];if(t?.hz===c){const n=Math.trunc(s.audioSegment.offset*c),r=Math.trunc(rp(s.audioSegment)*c)+1,o=n+T,i=n+(l-h),a=Math.min(o,i,r),d=Gs.getStartEnd(n,a),f=iA(e,s.audioSegment.mediaRefId,t,d);let m=h;for(const e of oA(f,d))u.set(e,m),m+=e.length;if(1!==s.audioSegment.gain){const{gain:e}=s.audioSegment;for(let t=h;t<m;t++)u[t]*=e}}}m+=y,h+=T}return{alignment:f,energies:u,hasSomeAlignment:p,wordSources:g}}(e,n,r,o,i,a,s,c)}))({...yp("getSequenceTrackAlignmentAndEnergies"),selectorCreator:yA,keySelector:sm});function IA(e,t){return Pp(e,t).audio?.trackSceneIds}const bA={};function TA(e,t){let n=bA[e.projectId];n||(n={},bA[e.projectId]=n);let r=n[t];return void 0===r&&(r=Ps(),n[t]=r),r}function wA(e,t){const n=bA[e.projectId];n&&delete n[t]}const CA=(e,t,n,r)=>{const o=e.length;let i=new Array(o).fill(0);const a=new Array(o).fill(-1),s=new Array(o).fill(-1);let c;const d=[],l=[],u=new Set;n=e.every((({energies:e})=>void 0!==e))?n:void 0;let f=!1,m=0,p=0;for(;;){i=kA(i,e,c),NA(i,a,e,hA),NA(i,s,e,pA);const o=LA(i,e,n,r,c,a,s,p);if(!o)break;let g=o.item;if(void 0===g.speaker&&hA(g)){const e=t[o.index];e&&(g=qh(g,Ah(e.id,void 0)),u.add(e))}i[o.index]+=1,c=o;let h=!0;if(mA(g))if(f)h=!1;else{const t=kA(i,e,c);for(let n=0;n<e.length;n++){const{alignment:r}=e[n];if(os(rs(r,t[n]),gA)){h=!1;break}}f=!0}h&&(d.push(g),l.push(o.source),o.overlap&&(m+=1),hA(g)&&(p=g.endTime))}const g=function(e,t){const n=[];let r,o=0,i=0;for(let a=0;a<t.length;a++){const s=t[a],c=e[a];if(r&&(r.sceneId!==s.sceneId||r.tauId!==s.tauId)){const e=(i+c.startTime)/2;n.push({offset:o,duration:e-o,sceneId:r.sceneId,tauId:r.tauId}),o=e}r=s,i=c.endTime}return r&&n.push({offset:o,duration:i-o,sceneId:r.sceneId,tauId:r.tauId}),n}(d,l),h=function(e){const t=[];let n,r,o,i;for(let a=0;a<e.length;a++){const s=e[a];o&&(o.sceneId!==s.sceneId||o.tauId!==s.tauId||void 0!==i&&void 0!==s.refWordIdx&&i+1!==s.refWordIdx)&&(t.push({sceneId:o.sceneId,tauId:o.tauId,textRange:Gs.getStartEnd(n??0,r??0)}),n=void 0,r=void 0,i=void 0),s.rangeWithPunc&&(void 0===n&&(n=s.rangeWithPunc.location),r=$s(s.rangeWithPunc)),o=s,i=s.refWordIdx??i}return o&&t.push({sceneId:o.sceneId,tauId:o.tauId,textRange:Gs.getStartEnd(n??0,r??0)}),t}(l);return{alignment:d.filter(hA),alignmentSource:g,alignmentSourceTextRanges:h,newVoices:u,overlappingWordsCount:m}},_A=new Set("Untitled"),AA=(0,Yl.createCachedSelector)(IA,((e,t,n)=>n),((e,t,n)=>{const r=IA(e,t);if(r)return r.map((t=>SA(e,t,n)))}),((e,t,n,r)=>{const o=Pp(e,t),i=e.voices,a=IA(e,t);if(a)return a.map((t=>{const n=cA(vk(e,t).name),a=n.toLowerCase(),s=Cp(i,(e=>e.name.toLowerCase()===a));if(!(!s&&!r||s&&_A.has(s.name)||o.audio?.isScratchText))return{id:s?s.id:TA(e,n),name:s?s.name:n}}))}),(()=>aA),((e,t,n,r,o)=>{if(!e||!n||!r)return"no-alignment";const i=vu(r,((e,t)=>void 0!==n[t])),a=vu(n,(e=>void 0!==e));if(void 0!==t){if(!a.every((({energies:e})=>void 0!==e)))return"no-energies"}return a.some((({hasSomeAlignment:e})=>e))?CA(a,i,t,o):"no-alignment"}))({...yp("getSequenceRefAlignment"),selectorCreator:yA,keySelector:dm}),RA=(0,Yl.createCachedSelector)(((e,t,n)=>{const r=IA(e,t);if(r)return r.map((t=>SA(e,t,n)))}),((e,t,n)=>n),((e,t)=>{if(!e)return;return function(e,t){if(0===e.length)return;const n=Math.max(...e.map((({energies:e})=>e?.length||0))),r=new Float32Array(n);for(const{energies:i}of e){if(void 0===i)return;for(let e=0;e<i.length;e++)r[e]+=i[e]**2}const o=new Uint16Array(n);for(let i=0;i<o.length;i++)o[i]=Math.min(Math.sqrt(r[i]),K_);return{hz:t,rmsValues:o}}(vu(e,(e=>void 0!==e)),t)}))({...yp("getCombinedEnergies"),selectorCreator:yA,keySelector:dm});function MA(e,t){const n=jk(e,t);if(!n.audio.trackSceneIds)return e;let r=0;for(const o of n.audio.trackSceneIds){const t=_k(e,o);r=Math.max(r,t)}return hd(r,n.audio.duration)?e:function(e,t){const n=bG(e,t);if(!n)return e;const r=jk(e,t).audio.duration;if(hd(r,_k(e,n.id)))return e;const o=AP(e,n.id);if(!o||!o.audioSegment)return e;const i=o.audioSegment.offset;if(i>r)return e;const a=vI(e,n.id,o.id,{offset:i,duration:r-i});return a?UM(e,n.id,o.id,a.tau):e}(e=vO(e,t,"duration",r),t)}const DA={};function OA(e,t){return Vk(e,t).audio.trackSceneIds.some((t=>os(Qa(kk(e,t),(t=>Pp(e,t))),Ig)))}function xA(e,t,{energyHz:n=FL,tiebreakWithLoudness:r=!0,shouldRefreshTimelineTaus:o=!0,createNewVoices:i=!0}){const a=Vk(e,t),s=Boolean(a.voiceover&&a.voiceover.metadata.alignment)||!OA(e,t)?AA(e,t,r?n:void 0,i):"no-alignment",c=RA(e,t,n);if(e=tA(e,t,c,!1),"no-alignment"===s){if(a.voiceover)e=IO(e,t);else{a.audio.trackSceneIds.some((t=>bP(e,t).some((t=>Boolean(eL(e,t))))))&&(e=yO(e,t,{}))}return e}if("no-energies"===s)return e;const{alignment:d,newVoices:l,alignmentSource:u,alignmentSourceTextRanges:f}=s;for(const v of l)if(!ug(e,v.id)){const t=sA(v);e=F_(e,t,!0),wA(e,t.name)}const m=function(e,t){let n,r="";for(let o=0;o<t.length;o++){const{sceneId:i,tauId:a,textRange:s}=t[o];0!==s.length&&(r+=(0===o?"":n===a?" ":"\n")+PP(e,i,a).string.substring(s.location,$s(s)),n=a)}return r}(e,f),p=Pp(e,t),g=bG(e,p.id)?.timeline.superTau.taus[0]?.text.string!==m;if(!g&&p.voiceover&&lL(p.voiceover.metadata.alignment&&zg(p.voiceover.metadata.alignment),zg(d),Wh)&&(0,Me.fastDeepEqualJson)(p.voiceover.metadata.alignmentSource,u))return e;const h=!p.voiceover;return h&&(e=yO(e,t,{})),e=$A(e,t,"alignment",d,{sequenceAlignmentSource:u,shouldRefreshTimelineTaus:o,recognitionFormattedText:m,forceUpdate:g}),h&&(e=sx(e,t)),e}function kA(e,t,n){return e.map(((e,r)=>function(e,{alignment:t},n){let r=e;if(n)for(;r<t.length;){const e=t[r];if(!(e.startTime<n.endTime||e.tag?.category===Ch.Bleed))break;r+=1}return r}(e,t[r],n?.item)))}function NA(e,t,n,r){for(let o=0;o<t.length;o++){const i=t[o],a=e[o];if(i>=a)continue;const{alignment:s}=n[o];t[o]=s.length;for(let e=a+1;e<s.length;e++)if(r(s[e])){t[o]=e;break}}}function PA(e,t){const{item:n}=t;return!e||n.startTime<e.item.startTime||n.startTime===e.item.startTime&&n.endTime<e.item.endTime?t:e}function LA(e,t,n,r,o,i,a,s){P()(e.length===t.length,"Expected equal number of indexes and alignments");if(!t.find((({alignment:t},n)=>e[n]<t.length)))return;const c=[];for(let v=0;v<t.length;v++){const{alignment:r,energies:o,wordSources:i}=t[v],a=e[v];if(a>=r.length)continue;let s,d;if(void 0!==n&&o){const e=r[a].startTime,t=r[a].endTime,i=Math.trunc(e*n),c=Math.trunc(t*n)+1,l=Math.max(1,Math.min(o.length-i,c-i));s=rA(o,n,e,t);const u=i+l,f=Math.max(1,Math.min(o.length-u,Math.trunc(.5*n)));if(u<0||f<=0||u+f>o.length)d=void 0;else{let e=0;for(let t=u;t<u+f;t+=1)e+=o[t];d=e/f}}c.push({item:r[a],source:i[a],index:v,energy:s,nextEnergy:d})}const d=c.reduce(PA,void 0);if(!d)return;let l=c.filter((e=>{let t=0;return o&&e.index===o.index&&(t=r),e.item.startTime<d.item.endTime+t&&e.item.endTime>d.item.startTime}));if(0===l.length)return;let u=!1,f=0;for(const v of l)if(!fA(v.item)&&(f+=1,f>=2)){u=!0;break}let m,p=1/0;for(let v=0;v<t.length;v++){const e=t[v].alignment,n=a[v];n<e.length&&(p=Math.min(e[n].startTime,p))}if(p<1/0){const e=l.filter((e=>!!pA(e.item)||e.item.endTime<=p));e.length>0&&(l=e)}for(const v of l){m||(m=v);const e=m.energy,t=v.energy;fA(m.item)!==fA(v.item)?m=fA(m.item)?v:m:void 0!==t&&(void 0===e||e<t)&&(m=v)}const g=l.find((e=>!!o&&e.index===o.index));let h=!0;if(m&&void 0!==m.energy){let e=1/0;if(g){const n=g.index,r=t[n].alignment[i[n]];r&&(e=r.startTime)}void 0!==m.nextEnergy&&void 0!==g?.nextEnergy&&m.nextEnergy<g.nextEnergy&&s+r>e&&(h=!1)}return h&&m?(m.overlap=u,fA(m.item)&&g&&fA(g.item)&&m.item.endTime>g.item.endTime&&m.item.startTime<g.item.endTime&&(m.item={...m.item,endTime:g.item.endTime}),m):(m=g,m||(m=l.reduce(PA,void 0)),m&&(m.overlap=u),m)}function FA(e,t,n,r){if(void 0!==t){if(!Ag(Pp(e,t)))return}const o=void 0!==t,i=new Map;for(const a of yk(e))if(void 0===n||n===a)for(const n of bP(e,a)){if(void 0!==r&&r!==n.id)continue;const s=n.audioSegment?.mediaRefId;if(void 0!==s&&((o||s===t)&&(!o||Ag(Pp(e,s)))))for(const t of ck(e,a,n.id))i.set(t.id,Kx(e,a,t))}return i.size>0?i:void 0}function UA(e,t){const n=Vk(e,t),r=new Set;return n.audio.trackSceneIds.forEach((t=>{const n=vk(e,t);Gk(e.projectId,n).forEach((e=>r.add(e)))})),Array.from(r).map((t=>Pp(e,t))).filter((e=>Bg(e)))}function BA(e,t,n,r){const o=e[t];let i,a=o.startTime,s=o.endTime,c=nh(n,uh({startTime:a,endTime:s},(e=>e.startTime),(e=>e.endTime)));if(0===c.length&&(0===t?r&&(a=Math.min(a,r.offset)):a=Math.min(a,e[t-1].endTime),t===e.length-1?r&&(s=Math.max(s,rp(r))):s=Math.max(s,e[t+1].startTime),c=nh(n,uh({startTime:a,endTime:s},(e=>e.startTime),(e=>e.endTime)))),0===c.length)return;let d=0;const l={offset:a,duration:s-a};for(const u of Kg(c)){const e=cp({offset:u.startTime,duration:u.endTime-u.startTime},l)?.duration;void 0!==e&&e>d&&(i=u.speaker,d=e)}return qh(o,i)}function jA(e,t,n,r,o){const i=r?zg(r):void 0,{getTauData:a}=GV(e,t).tausAndDataForAttributedString(),s=a(n).paragraphSpeakers,c=wP(e,t,n);let d,l=OP(e,t,n);for(;l;){const n=a(l.id).paragraphSpeakers;if(n.length>0){const e=n[n.length-1].speaker.speaker;d=1===e?void 0:e;break}l=OP(e,t,l.id)}const u=PP(e,t,n).string;if(!mL(zg(o),u))return i?o.map(((e,t)=>void 0!==e.speaker?e:BA(o,t,i,c.audioSegment)||e)):o;const f=function(e,t){let n=0;const r=[];for(const o of t.split("\n")){const t=n,i=new Set;if(Zh.enumerateWords(o,((t,r)=>{const o=e[n];if(n+=1,!Ph(o,t,r))throw new Error("Word mismatch in guessSpeakerIdsForWords");return o.speaker&&i.add(o.speaker),!1})),1===i.size){const o=Array.from(i)[0];r.push(...e.slice(t,n).map((e=>e.speaker?e:qh(e,o))))}else t!==n&&r.push(...e.slice(t,n))}return r}(o,u);if(f.every((e=>Boolean(e.speaker))))return f;let m=0,p=0;return Zh.enumerateWords(u,((e,t,n,r,o)=>{const a=p;p+=1;const l=f[a];if(!Ph(l,e,t))throw new Error("Word mismatch in guessSpeakerIdsForWords");if(void 0!==l.speaker)return!1;if(void 0!==c.defaultSpeaker)return f[a]=qh(l,c.defaultSpeaker),!1;if(i){const e=BA(f,a,i,c.audioSegment);if(e)return f[a]=e,!1}for(;m<s.length;){const e=s[m];if(e.range.location>o)break;d=1===e.speaker.speaker?void 0:e.speaker.speaker,m+=1}return f[a]=qh(l,d),!1})),f}const VA=(0,fp.PW)((()=>(0,zf.on)((0,zf.kk)(p_),$_,((e,t,n)=>t))));function zA(e,t,n,r,o,i,a){return{trackId:e,tauData:t,refOffset:n,tauOffset:r,intersectedDuration:o,meanEnergy:i,isInAlignmentSource:a}}function GA(e,t,n,r){if(!n)return t;let o=n.meanEnergy;if(void 0===o&&n.tauData.ref){o=0;const t=Pp(e,n.tauData.ref.id).audio?.energies;if(t){const r=n.refOffset,i=r+n.intersectedDuration;o=(nA(e.projectId,n.tauData.ref.id,t,r,i)||0)*(n.tauData.tau.audioSegment?.gain??1)}n.meanEnergy=o}let i=!1;const a=void 0!==t.tauData.ref?.id?Pp(e,t.tauData.ref.id).audio?.energies:void 0;let s=0;if(a&&t.tauData.ref){const r=t.refOffset,l=r+t.intersectedDuration;s=(nA(e.projectId,t.tauData.ref.id,a,r,l)||0)*(t.tauData.tau.audioSegment?.gain??1),t.meanEnergy=s;const u=(d=o??0,(c=s)<65&&d<65||c===d?Ie.OrderedSame:c<d?Ie.OrderedAscending:Ie.OrderedDescending);(u===Ie.OrderedDescending||u===Ie.OrderedSame&&!n.isInAlignmentSource&&t.isInAlignmentSource)&&(i=!0)}else void 0!==o&&0!==o||!(t.intersectedDuration>n.intersectedDuration||t.isInAlignmentSource&&!n.isInAlignmentSource)||(i=!0);var c,d;return t.meanEnergy=s,i?(n.isInAlignmentSource&&r(n),t):(t.isInAlignmentSource&&r(t),n)}function WA(e,t,n){const r=e.tauData.ref?.audio?.duration??1/0,o=e.tauData.tau.id;let i=t.get(o);if(i?i.modifiedTauTimeRange=up(i.modifiedTauTimeRange,{offset:e.tauOffset,duration:e.intersectedDuration}):(i={tauId:o,trackId:e.trackId,words:[],subAlignment:e.tauData.subAlignment,modifiedTauTimeRange:{offset:e.tauOffset,duration:e.intersectedDuration}},t.set(o,i)),n){const t=i.words.length>0?i.words[i.words.length-1].endTime:0;i.words.push({...n,startTime:Math.max(0,e.refOffset,t),endTime:Math.min(r,e.refOffset+e.intersectedDuration)})}}function HA(e,t,{newWords:n,refTimeRange:r,shouldRefreshTimelineTaus:o,forceRegenerateAlignmentSource:i=!1,guessSpeakers:a=!0}){const s=e;let c=zk(e,t),d=c.voiceover.metadata.alignmentSource;if(!d)throw new Error("Sequence VO ref must have alignment source");let l=c.voiceover.metadata.alignment;if(!l)throw new Error("Sequence VO ref must have alignment to propagate update");if(d.some((t=>!hk(e,t.sceneId)||!TP(e,t.sceneId,t.tauId)))||i){if(Ux.warn("Regenerating alignment source"),c=zk(e=cO(e,t,o),t),d=c.voiceover.metadata.alignmentSource,!d)throw new Error("Sequence VO ref must have alignment source");if(l=c.voiceover.metadata.alignment,!l)throw new Error("Sequence VO ref must have alignment to propagate update")}if(!Ag(c))throw new Error("Ref is not sequence ref");const u=r??{offset:0,duration:c.audio.duration},f=nh(zg(n),uh({startTime:u.offset,endTime:rp(u)},(e=>e.startTime),(e=>e.endTime))),m=function(e,t,n,r,o){const i=t.audio.trackSceneIds.filter((t=>Jp(e,t).includeTranscript)).map((t=>({trackId:t,getTauData:GV(e,t).tausAndDataBasic().getTauData}))),a=new Map;function s(e){WA(e,a,void 0)}let c,d;if(n.length>0){const e=Hg(n);e.startTime>r.offset&&(c=Fh("START",r.offset,e.startTime,void 0,Ih.Placeholder,void 0,void 0));const t=qg(n);t.endTime<rp(r)&&(d=Fh("END",t.endTime,rp(r),void 0,Ih.Placeholder,void 0,void 0))}else r.duration>0&&(c=Fh("START",r.offset,r.offset+r.duration,void 0,Ih.Placeholder,void 0,void 0));let l=0;for(const u of ss([c?[c]:[],Kg(n),d?[d]:[]])){const t={offset:u.startTime,duration:u.endTime-u.startTime};let n;for(const{trackId:r,getTauData:a}of i){const i=kP(e,r,t);let c=0;for(const d of Kg(i)){const i=a(d.id);if(!i.subAlignment||!i.ref||!d.audioSegment)continue;const u=i.timeOffset,f=i.duration,m=cp(t,{offset:u,duration:f});if(!m)continue;let p=!1,g=mu(o,l,(e=>sp(t,e)));if(void 0!==g)for(l=g;g<o.length;){const e=o[g];if(!sp(t,e))break;if(e.tauId===d.id&&e.sceneId===r){p=!0;break}g+=1}if(p||m.duration>c){const t=m.duration;c=Math.max(c,t);const o=m.offset-u+d.audioSegment.offset,a=m.offset-u;n=GA(e,zA(r,i,o,a,m.duration,void 0,p),n,s)}}}n&&WA(n,a,u!==c&&u!==d?u:void 0)}return a}(e,c,f,u,d);for(const{tauId:p,trackId:g,words:h,subAlignment:v,modifiedTauTimeRange:E}of m.values()){const t=wP(e,g,p);if(!t.audioSegment)continue;const n=nN(e,g,p);if(!n)continue;const r=[],o=h.length>0?h[0].startTime:1/0,i=h.length>0?h[h.length-1].endTime:-1/0,s=Math.min(o,E.offset+t.audioSegment.offset),c=Math.max(i,rp(E)+t.audioSegment.offset);if(t.audioSegment.offset<s){const e=hL(n,t.audioSegment.offset,s-t.audioSegment.offset,.5);r.push(e)}r.push(h);const d=rp(t.audioSegment);if(d>c){const e=hL(n,c,d-c,.5);r.push(e)}let l=dL(...r);const u=v?Array.from(Kg(v)):[],f=Array.from(Kg(n)),m=l,y=VA()(u,m,f);Array.isArray(y)&&(l=y),e=qA(e,g,p,l,!1,a).doc}return o&&(e=uO(e,s)),e}function qA(e,t,n,r,o=!1,i=!0){const{tau:a,linkedSubAlignment:s,subAlignmentInMediaDomain:c,ref:d}=GV(e,t).tausAndDataLinkedSub().getTauData(n),{audioSegment:l}=a;if(!l)return{doc:e};if(!d||!d.voiceover)return{doc:e};const u=d.voiceover.metadata.alignment,f=FA(e,l.mediaRefId,t,n),{offset:m,duration:p}=l;let g=Zg(gL(zg(r),m,p));const h=d.voiceover.metadata.alignment;i&&g.some((e=>!e.speaker))&&(g=jA(e,t,n,h,g));let v=Xk(a,!1);v=eN(v,void 0),e=Cx(e,t,Px(Lx(e,t),a.id,v));let E,y=!1;if(Ag(d)){const r=TP(e=HA(e,d.id,{newWords:g,shouldRefreshTimelineTaus:o,refTimeRange:l}),t,n);r&&FN(e,t,r.id)&&(e=HA(e,d.id,{newWords:g,shouldRefreshTimelineTaus:o,refTimeRange:l,forceRegenerateAlignmentSource:!0}),y=!0);const i=zk(e,d.id).voiceover.metadata.alignment;if(i){const e=gL(zg(i),l.offset,l.duration);if(e.length!==g.length||os(Kg(e),((e,t)=>e.word!==g[t].word))){const t=Array.from(Kg(e));E={seqRefId:d.id,expected:g,actual:t}}}}else{let n,r;c&&h&&h.length>=$g(c)&&(0===c.length||os(Kg(c),(e=>!e.extra?.isScratch)))&&(c.length>0?(n=zg(h,0,c.offset),r=zg(h,$g(c))):(n=gL(zg(h),0,m),r=zg(h,n.offset+n.length)));const i=g[0];n&&n.length>0&&i&&(n=hL(n,0,i.startTime));const a=g.length>0?g[g.length-1]:void 0;r&&r.length>0&&a&&(r=hL(r,a.endTime,qg(r).endTime));const s=dL(n,g,r);e=$A(e,d.id,"alignment",s,{shouldRefreshTimelineTaus:o}),o&&(e=sO(e,t))}const S=TP(e,t,n);let I=!1;S&&FN(e,t,S.id)&&(e=tN(e,t,n,u,f,s),I=!0);for(const b of Ik(e))e=fO(e,b.id);return{doc:e,stats:{forceUpdatedInvalidAlignment:I,regeneratedAlignmentSource:y,sequencePropagationIssue:E}}}function $A(e,t,n,r,o={}){let{shouldRefreshTimelineTaus:i=!0,forceUpdate:a=!1,sequenceAlignmentSource:s,recognitionFormattedText:c,propagateSequenceRefTimeRange:d,adaptFromExistingText:l=!0}=o,u=zk(e,t);const f="alignment"===n,m=u,{[n]:p}=u.voiceover.metadata;let g,h;if(!f&&r&&!u.voiceover.metadata.alignment&&!Ag(u)){const e=u_(u,r);e!==r&&(g=e,h={forceUpdate:a,shouldRefreshTimelineTaus:i,sequenceAlignmentSource:s,propagateSequenceRefTimeRange:d},i=!1,a=!0)}u=f_(u,n,r);const v=Boolean(u.voiceover.metadata.alignmentSource);if(f)if(u.voiceover.metadata.recognition||(u=f_(u,"recognition",r)),Ag(u)){if(!s&&!v)throw new Error("Sequence ref must already have alignment source or include alignment source in update");if(!s&&v&&r)return HA(e,t,{newWords:r,shouldRefreshTimelineTaus:i,refTimeRange:d});u=function(e,t){const n=e.voiceover,r=n.metadata;return(0,Me.fastDeepEqualJson)(r.alignmentSource,t)?e:{...e,voiceover:{...n,metadata:{...r,alignmentSource:t}}}}(u,s)}else if(s)throw new Error("Sequence alignment source should not be set if ref is not a sequence");const E=p!==u.voiceover.metadata[n];if(m===u&&!a)return e;const y=function(e,t){const n=new Map,r=VV(e);for(const o of yk(e)){const e=r.getTrackData(o);if(!t(e))continue;const{tausData:i}=e.tausAndDataLinkedSub();for(const t of i)for(const e of t.orderedComponents)n.set(e.id,Yx(t,e))}return n.size>0?n:void 0}(e,(e=>e.track.timeline.superTau.taus.some((e=>e.audioSegment?.mediaRefId===u.id)))),S=l?void 0:function(e,t){const n=new Map,r=VV(e);for(const o of yk(e)){const{tausData:e}=r.getTrackData(o).tausAndDataLinkedSub();let i;for(const r of e){if(r.ref?.id!==t||!r.annotations)continue;const e=[],a=r.linkedSubAlignment;for(const{attribute:{value:t},range:n}of r.annotations){const o=r.getTimeOffsetForTextOffset(n.location,!1);let i=r.getTimeOffsetForTextOffset($s(n),!1);if(a){const{match:e,next:t,previous:r}=a.searchForTextOffsetWithPunc($s(n)),o=e||r;o?i=Wg(a.wordArrayView,o.index).endTime:t&&(i=Wg(a.wordArrayView,t.index).startTime)}e.push({annotationId:t,timeRange:{offset:o,duration:i-o}})}e.length>0&&(i||(i=new Map,n.set(o,i)),i.set(r.tau.id,e))}}return n.size>0?n:void 0}(e,u.id),I=function(e,t){const n=new Map;for(const r of Wk(e,t,!0)){const o=GV(e,r.id),{tausData:i}=o.tausAndDataLinkedSub(),a=new Map;n.set(r.id,a);for(const{ref:e,linkedSubAlignment:n,tau:r}of i)e?.id===t&&n&&a.set(r.id,n)}return n}(e,u.id);if(e=pO(e,u),!E&&!a)return e;const b={shouldRefreshTimelineTaus:i,recognitionFormattedText:c,previousAlignment:p,previousComponentTimeOffsets:y,adaptFromExistingText:l};for(const T of e.transcripts)e=yx(e,T.id,t,n,{...b,previousLinkedSubAlignments:I.get(T.id),annotationTimeRangeMap:S?.get(T.id)});for(const T of e.sequenceScenes)e=yx(e,T.id,t,n,{...b,previousLinkedSubAlignments:I.get(T.id),annotationTimeRangeMap:S?.get(T.id)});for(const T of e.compositions)e=yx(e,T.id,t,n,{...b,previousLinkedSubAlignments:I.get(T.id),annotationTimeRangeMap:S?.get(T.id)});for(const T of e.pinScenes)e=yx(e,T.id,t,n,{...b,previousLinkedSubAlignments:I.get(T.id),annotationTimeRangeMap:S?.get(T.id)});for(const T of e.restorableScenes)e=yx(e,T.id,t,n,{...b,previousLinkedSubAlignments:I.get(T.id),annotationTimeRangeMap:S?.get(T.id)});return g&&(e=$A(e,t,"alignment",g,h)),e}function KA(e,t,n){let r=!1;const o=PP(e,t,n);if(o.string.length>0){r="\n"!==o.string[0];let i=n,a=!1;for(;r&&!a;){const n=OP(e,t,i);if(n){i=n.id;const o=PP(e,t,n.id);o.string.length>0&&("\n"===o.string[o.string.length-1]?r=!1:a=!0)}else r=!1}}return r&&(e=Cx(e,t,Ox(Lx(e,t),JM({text:bm("\n")}),n))),e}function YA(e,t,n){let r=!1;const o=PP(e,t,n);if(o.string.length>0){r="\n"!==o.string[o.string.length-1];let i=n,a=!1;for(;r&&!a;){const n=DP(e,t,i);if(n){i=n.id;const o=PP(e,t,n.id);o.string.length>0&&("\n"===o.string[0]?r=!1:a=!0)}else r=!1}}return r&&(e=Cx(e,t,Dx(Lx(e,t),JM({text:bm("\n")}),n))),e}function ZA(e,t,n,r){let o=wP(e,t,n);const i=o.audioSegment;let a=eL(e,o);if(!i||!a||TN(o))return e;hd(i.offset,0)&&hd(i.duration,a.audio.duration)||(o=zM(o,hF({...i,offset:0,duration:a.audio.duration})),e=Cx(e,t,Px(Lx(e,t),o.id,o)));const s=a.voiceover.metadata.alignment||a.voiceover.metadata.recognition;if(!s)return e;if(!a.voiceover.metadata.alignment&&(a=XP(e=$A(e,a.id,"alignment",s,{recognitionFormattedText:r}),t,o.id),!a))throw new Error("VO ref no longer exists after updating words");const c=function(e,t,n){const r=t.voiceover.metadata.alignment||t.voiceover.metadata.recognition;if(!r)throw new Error("No word items for voiceover ref");const o=zg(r);let i;if(void 0!==n&&mL(o,n))i=bm(n);else{void 0!==n&&(Ag(t)?Ht(new Error("Invalid recognitionFormattedText generated for merged sequence alignment"),"assign-text-to-transcript-sequence",{extra:{projectId:e.projectId,mediaRefId:t.id}}):Ht(new Error("Invalid recognitionFormattedText for alignment"),"assign-text-to-transcript",{extra:{projectId:e.projectId,mediaRefId:t.id}}));i=bm(TL(o))}return i}(e,a,r);return o=wP(e,t,o.id),o=0===c.string.length?jM(o,bm(" ")):jM(o,c),e=KA(e=YA(e=Cx(e,t,Px(Lx(e,t),o.id,o)),t,o.id),t,o.id)}function JA(e,t,n={offset:0,duration:t.audio.duration}){const r=bG(e,t.id);if(!r)throw new Error(`No transcript track for ref: ${t.id}`);const{taus:o}=MB(e,r.id,n,!1,!1,!1);return Cm(o.map((({text:e})=>e)))}function QA(e,t,n,r){const o=wP(e,t,n);if(""!==o.text.string&&" "!==o.text.string)return Cx(e,t,Px(Lx(e,t),o.id,GM(o,!1)));return vk(e,t).type===Jh.Transcript?ZA(e,t,n,r):function(e,t,n){const r=wP(e,t,n);if(!r.isScriptClip)throw new Error("Tau must be script clip");const o=r.audioSegment,i=XP(e,t,n);if(!o||!i||!wF(o))return e;const a=PP(e,t,n).string.length,s=JA(e,i,o);return void 0!==DP(e=_D(e=Cx(e,t,Px(Lx(e,t),n,jM(r,s))),t,(e=>{if(e.tauAnchor.tauId===n){if(e.tauAnchor.location>=a)return OD(e,{tauId:n,location:pU(e)?0:s.string.length});if(e.tauAnchor.location>s.string.length)return OD(e,{tauId:n,location:s.string.length})}return e})),t,n)&&(e=YA(e,t,n)),void 0!==OP(e,t,n)&&(e=KA(e,t,n)),sO(e,t)}(e,t,n)}function XA(e,t,n,r,o=!1,i=!1){let a;return a=o?eR(e,t,n,r):function(e,t,n,r){const o=wP(e,t,n),i=PP(e,t,n);let a=r.location;for(;a>0&&!mc(i.string,a,!1);)a-=1;let s=$s(r);for(;s<o.text.string.length&&!mc(i.string,s,!0);)s+=1;return Gs.get(a,s-a)}(e,t,n,r),i&&(a=function(e,t,n,r){const o=PP(e,t,n).string;r.location>0&&void 0===Ms.index(o,Gs.get(0,r.location))&&(r=Gs.get(0,$s(r)));$s(r)<o.length&&void 0===Ms.index(o,Gs.getStartEnd($s(r),o.length))&&(r=Gs.getStartEnd(r.location,o.length));return r}(e,t,n,a)),a}function eR(e,t,n,r){return dc(PP(e,t,n).string,r)||r}function tR(e,t,n,r,o){const i=wP(e,t,n).text.string,a=$s(r);if(r.location<0||a>i.length)return!0;let s=!1,c=!1;const d=bs;if(0===r.location)s=!0;else if(o.length>0&&d.contains(o.charAt(0)))s=!0;else if(d.contains(i.charAt(r.location-1)))s=!0;else if(0===o.length&&(a===i.length||d.contains(i.charAt(a))))return!1;return(a===i.length||o.length>0&&d.contains(o.charAt(o.length-1))||d.contains(i.charAt(a))||0===o.length)&&(c=!0),!s||!c}function nR(e,t,n,r,o,i){const a=wP(e,t,n);return function(e,t,n,r,o,i){const a=PP(e,t,n.id).string,s=$s(r)===a.length;if(!s&&!i)throw new Error("isFinalReplacementRange should only be true if editing the last character of a tau");if(!s)return!0;const c=r.length>0,d=1===o.length&&ws.contains(o);if(!c&&!d&&!i)return!1;if(n.isScriptClip)return!1;const l=DP(e,t,n.id);if(!l)return!0;if(0===a.length)return!0;const u=a.charAt(a.length-1),f=bs.contains(u);if(l.text.string.length>0){const e=l.text.string.charAt(0);if(bs.contains(e))return!0}if(n.ignoreAlignment)return!0;if(!f)return!0;let m;o.length>0?m=o.charAt(o.length-1):r.location>0&&r.location<a.length&&(m=a.charAt(r.location-1));if(!m)return!0;return bs.contains(m)}(e,t,a,r,o,i)&&function(e,t,n,r,o){if(n.ignoreAlignment)return!0;if(n.isScriptClip)return!1;if(0!==r.location)return!0;const i=OP(e,t,n.id);if(!i)return!0;if(0===n.text.string.length)return!0;if(i.text.string.length>0){const e=i.text.string.charAt(i.text.string.length-1);if(bs.contains(e))return!0}if(!bs.contains(n.text.string.charAt(0)))return!0;let a;o.length>0?a=o.charAt(0):$s(r)>0&&$s(r)<n.text.string.length&&(a=n.text.string.charAt($s(r)));if(!a)return!0;return bs.contains(a)}(e,t,a,r,o)}function rR(e,t,n){const r=sN(e,t,n);if(!r)return;const{audioSegment:o}=wP(e,t,n);if(r.length>0&&o){const e=r.elementAt(0),t=o.offset;return Math.max(0,e.startTime-t)}}function oR(e,t,n){if(wN(wP(e,t,n)))return BP(e,t,n);const r=nN(e,t,n);if(!r)return;const{audioSegment:o}=wP(e,t,n);if(r.length>0){const i=r.length>0?qg(r).endTime:BP(e,t,n),a=o?o.offset+BP(e,t,n):BP(e,t,n);return Math.max(0,a-i)}return BP(e,t,n)}function iR(e,t,n,r){const o=PP(e,t,n);if(r.location<=0&&r.length>=o.string.length)return!1;if(void 0!==Ms.index(o.string,Gs.get(0,r.location)))return!0;return void 0!==Ms.index(o.string,Gs.get($s(r),o.string.length-$s(r)))}function aR(e,t,n,r,o=-.05,i=!0){const a=wP(e,t,n);let s;const c=sN(e,t,n),d=EE(e);if(a.audioSegment&&c){const e=c.wordAfterCutForTextOffset(r,d);if(e){let t=!1;if(d){const n=function(e,t){const{buffer:n,offset:r,length:o}=e,{previous:i}=eh(n,r,r+o,(e=>{const n=e.endTime;return oL(n,t)?Ie.OrderedAscending:Ie.OrderedDescending}));return uL(e,i)}(c.wordArrayView,e.startTime);n&&i&&lB(e.startTime-n.value.endTime,!1,c)&&(s=Math.max(0,n.value.endTime-a.audioSegment.offset),t=!0)}t||(s=Math.max(0,e.startTime-a.audioSegment.offset))}else c.length>0&&r<$s(c.elementAt(0).range)&&(s=0)}if(void 0===s&&(s=$P(e,t,n,r,!1)),void 0===s||s<=0)return 0;const l=BP(e,t,n);if(hd(s,l)){if(d&&i&&a.audioSegment&&c&&c.length>0){const e=Wg(c.wordArrayView,c.length-1);if(lB(a.audioSegment.offset+l-e.endTime,!1,c))return e.endTime-a.audioSegment.offset}return l}const u=XP(e,t,n);if(!a.audioSegment||!u)return s;const f=u.voiceover.metadata.alignment;if(!f)return s;const m=a.audioSegment.speed,p=AL(f,a.audioSegment.offset,s*m,o,.01*Math.sign(o),o),g=s*m+p;return 0!==p&&g>0?g/m:s}function sR(e,t){return!mc(e.text.string,t.location,!1)||!mc(e.text.string,$s(t),!0)}function cR(e,t,n){const r=n.layers.findIndex((t=>zw(t,e)));if(-1!==r){for(let e=r-1;e>=0;e--){const r=n.layers[e],o=t.layers.findIndex((e=>zw(e,r)));if(-1!==o)return o+1}for(let e=r+1;e<n.layers.length;e++){const r=n.layers[e],o=t.layers.findIndex((e=>zw(e,r)));if(-1!==o)return o}}}function dR(e,t,{includeAudio:n,alwaysUseEndAnchor:r}){const{timeline:o}=vk(e,t),{getTauData:i}=GV(e,t).tausAndDataLinkedSub(),a={};for(const s of o.pins.components){const o=xk(e,s.sceneId);if((n||"audio"!==o)&&void 0!==o){const n=i(s.tauAnchor.tauId),o=Yx(n,s),c=r?VB(e,t,s)-o:zB(e,t,s),d=wU(e,t,$x(n,s)),l=d&&"end"!==d?Xb(e,t,d.id):void 0;a[s.id]={timeRange:{offset:o,duration:c},anchorCardIndex:l}}}return a}function lR(e,t){const n=Qb(e,t),r={};for(const[o,i]of n.entries()){const n=EU(i.start);"end"!==n&&(r[n]={index:o,card:i,cardTimeRange:sT(e,t,i)})}return r}function uR(e,t,n,r,o){const{timeline:i}=vk(e,t),a=r[n];P()(a,"could not card for start boundary");const{cardTimeRange:s,index:c}=a;return i.pins.components.filter((e=>{const t=o[e.id];return!!t&&(sp(t.timeRange,s)&&(void 0===t.anchorCardIndex||t.anchorCardIndex<=c+1))}))}function fR(e,t){if(!e.isStoryboard)return e;const n=vk(e,t);if(n.type!==Jh.Composition||!bk(e,t))return e;const r=t,{timeline:o}=n,i=dR(e,r,{includeAudio:!1,alwaysUseEndAnchor:!0}),a=lR(e,r),s=hu(o.cards.components,(t=>{const{layers:n}=t,o=a[t.id];P()(o,"could not card for start boundary");const{card:s}=o,c=uR(e,r,t.id,a,i).map((({sceneId:e})=>e)),d=[...c,r],l=_T(e,r,s),u=[...c,...l?[r]:[]],f=new Map;for(const i of d)SM(e,r,i,s,(e=>{const t=f.get(i);t?t.add(e.id):f.set(i,new Set([e.id]))}));const m=n.filter((t=>void 0===t.sourceSceneId||!!d.includes(t.sourceSceneId)&&(t.sourceSceneId!==r||(void 0===t.sequenceSceneId?_T(e,r,s):"all"===t.sequenceSceneId||f.get(t.sourceSceneId)?.has(t.sequenceSceneId))))),p=u.filter((e=>!m.some((t=>t.sourceSceneId===e&&void 0===t.sequenceSceneId)))).map((t=>Hw({doc:e,compositionId:r,cardBoundaryId:s.start.id,sourceTrackId:t,sequenceTrackId:void 0})));if(n&&n.length===m?.length&&0===p.length)return t;{const n=function(e,t,n,r,o){const i=[...r],a=IU(e,t,n.id),s=bU(e,t,n.id);for(const c of o){let e;a&&(e=cR(c,n,a)),void 0===e&&s&&"end"!==s&&(e=cR(c,n,s)),void 0===e&&(e=0),i.splice(e,0,c)}return i}(e,r,t,m,p);return Kw(t,n)}}));return s!==o.cards.components?ix(e,lx(n,(0,T.ZP)(o,(e=>{e.cards.components=s})))):e}function mR(e={}){const{text:t=""}=e;return{...Nu({...e,type:xu.markerComponent,isBlocked:!1}),text:t}}function pR(e,t){const{text:n}=e;return{...Pu(e,t),text:n}}function gR(e,t){const{text:n}=e;return mR({...Lu(e,t),text:n})}function hR(e){return ju(xu.markerComponent,0,e)}function vR(){return{isType:hR,encode:pR,decode:gR}}function ER(e,t,n){const r=vk(e,t);return r.type!==Jh.Composition?e:ix(e,function(e,t){return(0,T.ZP)(e,(e=>{void 0===e.storyboardCues&&(e.storyboardCues=[]),e.storyboardCues.push(...t)}))}(r,n))}function yR(e,t,n,r){const o=qp(e,t);return ix(e,(0,T.ZP)(o,(e=>{if(void 0===e.storyboardCues)return;const t=e.storyboardCues.findIndex((({id:e})=>e===n));P()(t>=0,`Storyboard cue ${n} not found`),e.storyboardCues[t]=r})))}function SR(e,t,n){const{card:r,cardLayer:o}=Nw(e,t,n.anchor.layerId),i=dT(e,t,SU(e,t,r.start)+n.anchor.timeOffset);if(void 0!==i&&r.start.id!==i.start.id){const a=Lw(i,o.sourceSceneId,o.sequenceSceneId);if(void 0!==a)return{type:"layer",layerId:a.id,timeOffset:n.anchor.timeOffset+SU(e,t,r.start)-SU(e,t,i.start)}}return n.anchor}const IR=(0,Ns.Z)("taus",Fs);function bR({doc:e,trackId:t,source:n,offset:r}){return Bs({seeds:["type:split",`parent:${n.id}`,`text:${n.text.string}`,`offset:${r}`],doesIdExist:n=>void 0!==TP(e,t,n),namespace:IR})}function TR(e,t){return{[`${t}text_length`]:e.text.string.length,[`${t}is_script_clip`]:e.isScriptClip,[`${t}is_blocked`]:e.isBlocked,[`${t}is_overdub`]:Boolean(e.overdubInfo),[`${t}is_gap`]:EN(e),[`${t}has_media`]:Boolean(e.audioSegment?.mediaRefId),[`${t}media_offset`]:e.audioSegment?.offset,[`${t}media_duration`]:e.audioSegment?.duration,[`${t}ignore_alignment`]:e.ignoreAlignment,[`${t}has_failed_alignment`]:void 0!==e.failedAlignmentKey}}function wR({doc:e,trackId:t,tauId:n,splitTime:r,afterTauId:o,suppressAutoMerge:i=!0,ignoreNewline:a=!1}){const s=GV(e,t).tausAndDataBasic().getTauData(n),{tau:c}=s;if(!c.audioSegment||s.isScratchText)return;const{offset:d,duration:l}=c.audioSegment;if(r<=0||r>=l)return;const u={offset:d+r,duration:l-r},f=vI(e,t,n,{offset:d,duration:r},!0,a);if(!f)return;const m=vI(e,t,n,u,!0,a);if(!m)return;const p=(0,T.ZP)(f.tau,(e=>{for(const t of LF){const n=e.audioSegment?.[t];n&&(n.fadeOutShape=void 0,n.fadeOutDuration=void 0)}e.id=n}));let g=(0,T.ZP)(m.tau,(e=>{void 0!==o&&(e.id=o);for(const t of LF){const n=e.audioSegment?.[t];n&&(n.fadeInShape=void 0,n.fadeInDuration=void 0)}e.audioSegment&&m.tau.audioSegment?.effects.length&&(e.audioSegment.effects=m.tau.audioSegment.effects.map(iU))})),h=!1,v=1;Zh.enumerateWords(g.text.string,((e,t,n,r,o,i)=>h||t!==Sh.Tag?!h||(v=1+o,!0):(v=1+o+i,h=!0,!1))),p.text.string.length+g.text.string.length>c.text.string.length+v&&qt("Text after split is longer than expected","unsnapped-split-tau",{...TR(c,"tau_"),...TR(p,"before_tau_"),...TR(g,"after_tau_"),allowable_overlap:v});const E=c.text.string.length;let y=p.text.string;!a&&1===y.length&&bs.contains(y)&&(y="");let S=g.text.string;1===S.length&&bs.contains(S)&&(S=""),g.audioSegment&&i&&(g=VM(g,OF(g.audioSegment,!0)));const I=FP(e,t,n),b=GV(e,t).tausAndDataLinkedSub().getTauData(n),w=Array.from(Qa(ck(e,t,n),(e=>({component:e,componentAnchorTimeInTau:$x(b,e)-I})))),C=b.index;e=Cx(e,t,Ax(Lx(e,t),Gs.get(C,1),[p,g]));const _=Math.max(0,E-y.length-S.length),A=y.length+_;return e=function(e,t,n,r,o,i,a,s){const c=new Map;for(const d of n)c.set(d.component.id,d);return 0===c.size?e:_D(e,t,(n=>{const d=c.get(n.id);if(!d)return n;const{component:l,componentAnchorTimeInTau:u}=d,{tauAnchor:f}=l,m=f.location;if(a===m&&u<s)return PD(e,t,OD(l,{tauId:o,location:wP(e,t,o).text.string.length},!0),FP(e,t,o)+u);if(a<=m){let n;return n=m<r?m-a:Math.max(r-a,0),PD(e,t,OD(l,{tauId:i,location:n}),FP(e,t,o)+u)}{const e=Math.max(m,0);return OD(l,{tauId:o,location:e})}}))}(e,t,w,E,p.id,g.id,A,r),e=fO(e,t),0===S.length&&(e=e_(e,t,g.id,0,1,0,{})),{doc:e,beforeTau:p,afterTau:g}}function CR(e,t,n,r){let o;for(const i of ck(e,t,n)){i.tauAnchor.location===r&&(o?o.push(i):o=[i])}return o}function _R(e,t,n,r,o,i){if(EE(e))return function(e,t,n,r,o,i){const a=n.audioSegment.duration;let s=bu();const c=TN(n)?n.audioSegment.offset:n.audioSegment.offset+r;return s=[JM({...n,audioSegment:RF(n.audioSegment,r)}),JM({...n,id:o?i??bR({doc:e,trackId:t,source:n,offset:n.text.string.length}):i,text:SE,audioSegment:hF({...UF(n.audioSegment),offset:c,duration:a-r})})],bk(e=Cx(e,t,Px(Lx(e,t),n.id,s)),t)&&(e=wB(e,t,s[0],s[1])),{doc:e,beforeTau:wP(e,t,s[0].id),afterTau:wP(e,t,s[1].id)}}(e,t,n,r,o,i);const a=n.audioSegment.duration,s=FP(e,t,n.id),c={},d={};let l=0,u=0;for(const v of ck(e,t,n.id)){const o=qx(e,t,v);o-s<r?(c[v.id]=o,l=Math.max(l,v.tauAnchor.location)):(d[v.id]=o,u=Math.max(u,n.text.string.length-v.tauAnchor.location))}const f=0===l?SE:km(n.text,0,l),m=0===u?SE:km(n.text,n.text.string.length-u),p=TN(n)?n.audioSegment.offset:n.audioSegment.offset+r,g=[JM({...n,text:f,audioSegment:RF(n.audioSegment,r)}),JM({...n,id:o?i??bR({doc:e,trackId:t,source:n,offset:l}):i,text:m,audioSegment:hF({...UF(n.audioSegment),offset:p,duration:a-r})})];e=Cx(e,t,Px(Lx(e,t),n.id,g));const h=n.text.string.length-u;return{doc:e=_D(e,t,(r=>{if(r.tauAnchor.tauId!==n.id)return r;const o=c[r.id],i=d[r.id];return void 0!==o?PD(e,t,r,o):void 0!==i?PD(e,t,OD(r,{tauId:g[1].id,location:r.tauAnchor.location-h}),i):r})),beforeTau:wP(e,t,g[0].id),afterTau:wP(e,t,g[1].id)}}function AR(e,t,n,r,o,i=!0,a=!1){const s={doc:e,beforeTau:void 0,afterTau:void 0,componentsOnBoundary:void 0},c=EE(e),d=!a&&(!c||void 0===o),l=n.tauId;let u=wP(e,t,l);if(wN(u))return function(e,t,n,r,o,i){let a=i||0;const s=FP(e,t,n.id);let c=!1,d=!1;for(const l of ck(e,t,n.id))l.tauAnchor.location<r?(a=Math.max(qx(e,t,l)-s,a),c=!0):(0===a&&(a=Math.max(qx(e,t,l)-s,a)),d=!0);return void 0!==i||d&&c&&a>0?{..._R(e,t,n,a,o),componentsOnBoundary:void 0}:d||0===r?{doc:e,beforeTau:void 0,afterTau:n,componentsOnBoundary:void 0}:{doc:e,beforeTau:n,afterTau:void 0,componentsOnBoundary:void 0}}(e,t,u,n.location,r,o);const f=u,m=PP(e,t,l),p=m.string.length,g=n.location,{isScriptClip:h}=u;let v=!1,E=!1;if(h&&u.audioSegment){const e=m.string.indexOf(IE.string);if(-1===e)throw new Error("Script clip placeholder not found in script clip");g<=e?v=!0:E=!0}if(d&&(0===g&&void 0===o||v))return s.afterTau=u,s.componentsOnBoundary=CR(e,t,u.id,g),s;if(d&&(g>=p||E))return s.beforeTau=u,s.componentsOnBoundary=CR(e,t,u.id,p),s;if(_N(u))return s;let y=JM({text:xm(m,Gs.get(g,p-g)),id:r?bR({doc:e,trackId:t,source:f,offset:g}):void 0});const S=!h&&u.audioSegment&&vN(e,u.audioSegment);if(!u.ignoreAlignment&&u.audioSegment&&void 0!==u.audioSegment.mediaRefId&&sN(e,t,l)&&S&&S.length>0){const n=u.audioSegment,r=n.mediaRefId,i=u.audioSegment.speed,a=aR(e,t,l,g)*i,s=o??0;if(a>0||s>0){const c=n.duration;let d=s*i;a>0&&void 0===o&&(d=Math.max(d,a));let l=SF(n,hF({mediaRefId:r,offset:n.offset,duration:d,suppressAutoMerge:n.suppressAutoMerge,effects:n.effects}),!0,!1,!0);l=mI(l),u=zM(u,l);let f=SF(n,hF({mediaRefId:r,offset:n.offset+d,duration:c-d,effects:n.effects.map(iU)}),!1,!0,!0);f=mI(f),f=_w(e,t,u.id,f),f.duration>0&&!hd(f.duration,0)&&(y=zM(y,f))}else{const e=SF(n,hF({mediaRefId:r,offset:n.offset,duration:n.duration,suppressAutoMerge:n.suppressAutoMerge,effects:n.effects}));y=zM(y,e),u=zM(u,void 0)}}else if(LN(e,u)&&u.audioSegment&&void 0!==u.audioSegment.mediaRefId){if(!sN(e,t,l)&&!c)return;if(c&&void 0!==o){const e=u.audioSegment;u=zM(u,hF({...e,duration:o}));const t=hF({...e,duration:e.duration-o});y=zM(y,t)}else{const e=u.audioSegment,t=SF(e,hF({mediaRefId:e.mediaRefId,offset:e.offset+e.duration,duration:0}),!1,!1,!0),n=y.ignoreAlignment;y=zM(y,t),y=Xk(y,n)}}const I=xm(m,Gs.get(0,g));var b,w;if(y=Xk(y,u.ignoreAlignment),y=gI(y,u.isBlocked),y=hI(y,u.defaultSpeaker),b=y,w=u.generationControls,y=(0,T.ZP)(b,(e=>{e.generationControls=w})),u=jM(u,I),c&&bk(e,t)){let e=!1;y.audioSegment&&dB(y.audioSegment.duration,!0,void 0)&&(""===y.text.string&&(y=jM(y,Cm([bm(" "),y.text]))),""===y.text.string.trim()&&(e=!0)),""===I.string&&u.audioSegment&&dB(u.audioSegment.duration,!0,void 0)&&(u=jM(u,Cm([I,bm(" ")]))),e&&(y=GM(y,f.isScriptClip),u=GM(u,f.isScriptClip))}let C=Dx(Lx(e,t),y,f.id);C=Px(C,f.id,u),e=Cx(e,t,C);const _=[];return e=_D(e,t,(e=>{const t=e.tauAnchor,n=t.location;if((i||n>0)&&t.tauId===l&&n>=g){const t=OD(e,{tauId:y.id,location:n-g});return n===g&&_.push(t),t}return e})),s.beforeTau=u,s.afterTau=y,s.componentsOnBoundary=_.length>0?_:void 0,s.doc=e,s}function RR(e,t,n,r,o,i,a){const s={doc:e,tau:void 0,afterTau:void 0},c=AR(s.doc,t,r,!1,o,!a);if(!c)return s;const{beforeTau:d,afterTau:l,componentsOnBoundary:u}=c;if(s.doc=c.doc,void 0===d&&void 0===l)return s;let f;if(f=n||JM(),d?s.doc=Cx(s.doc,t,Dx(Lx(s.doc,t),f,d.id)):l&&(s.doc=Cx(s.doc,t,Ox(Lx(s.doc,t),f,l.id))),u){const e=new Map;if(void 0===l){const t={tauId:f.id,location:f.text.string.length};for(const n of u)i?.includes(n.id)&&e.set(n.id,OD(n,t))}else if(void 0!==d&&a){const t={tauId:d.id,location:0};for(const n of u)i?.includes(n.id)||e.set(n.id,OD(n,t))}else if(!a){const t={tauId:f.id,location:0};for(const n of u)i?.includes(n.id)||e.set(n.id,OD(n,t))}e.size>0&&(s.doc=_D(s.doc,t,(t=>e.get(t.id)||t)))}return s.tau=f,s.afterTau=l,s}const{lengthOfCommonPrefix:MR,lengthOfCommonSuffix:DR}=a;function OR({doc:e,compositionId:t,replaceRange:n,placeholder:r,scratchTextSpeaker:o,replacedContentTrackId:i,isRegeneration:a=!1,createVideoSequence:s=!0,tauId:c,generationControls:d}){const l=function({doc:e,compositionId:t,insertRange:n,placeholder:r,scratchTextSpeaker:o,replacedContentSceneId:i,tauId:a,generationControls:s}){const c=Lf(r);P()(c.length>0,"Placeholder should be at least one character");let d=Ff(r);tp(n)&&(n=zT(e,t,n));const{location:l}=n;if(l>0){const n=Bb(e,t,l-1,l);bs.contains(n)||bs.contains(d.string[0])||(d=Cm([" ",d]))}const u=$s(n);if(u<Vb(e,t)-1){const n=Bb(e,t,u,u+1);bs.contains(n)||bs.contains(c[c.length-1])||(d=Cm([d," "]))}if(!o){const r=function(e,t,n){const r=[];return UU(e,t,n,((e,t)=>(r.push({tauId:e.id,range:t}),!1))),Tu(r)}(e,t,n);r.length>0&&(o=L_(e,t,function({tauId:e,range:{location:t}}){return{tauId:e,location:t}}(r[0])))}return JM({id:a,text:d,defaultSpeaker:o,replacedContentSceneId:i,generationControls:s})}({doc:e,compositionId:t,insertRange:n,placeholder:r,scratchTextSpeaker:o,replacedContentSceneId:i,tauId:c,generationControls:d}),u=tp(n)?n:jT(e,t,n),f=UP(e,t,np(u));if(!f)return{doc:e,tau:l};const m=ZP(e,f);if(m&&Ag(m)&&!Mg(m))return{doc:e,tau:l};if(!m||!m.video||!ON(f,m)||!f.audioSegment)return{doc:e,tau:l};if(s){const n=f.audioSegment.speed??1,r=(np(u)-FP(e,t,f.id))*n,o=f.audioSegment.offset+r,i=function(e,t){if(xM(e,t))return function(e,t){let n=0;return Zh.enumerateWords(e,(()=>(n++,!1))),t*n}(t.text.string,.4);return zN(t,void 0)}(e,l),s=u.duration/i;if(s>gF)throw new LU(a?PU.SequenceRegenerationLengthTooShort:PU.SequenceOverdubLengthTooShort);if(s<pF)throw new LU(a?PU.SequenceRegenerationLengthTooLong:PU.SequenceOverdubLengthTooLong);let c;if(Mg(m)){const t=CM(e,m.id)?.videos?.[0];if(!t)throw new LU(a?PU.SequenceRegeneration:PU.SequenceOverdub);const n=wP(e,t.trackId,t.tauId);if(!n.audioSegment?.mediaRefId)throw new LU(a?PU.SequenceRegeneration:PU.SequenceOverdub);c=eD({mediaRefId:n.audioSegment.mediaRefId,offset:n.audioSegment.offset+r,duration:i})}else c=0===u.duration||0===i?eD({mediaRefId:m.id,offset:o,duration:i}):JM({audioSegment:hF({...f.audioSegment,speed:s,offset:o,duration:u.duration*n,effects:void 0,channels:"video"})});if(!c.audioSegment)throw new Error("Created video tau did not have an audio segment");const{doc:d,seqRefId:p,videoSequenceTrackId:g}=TM(e,l,c,{...m.video,duration:c.audioSegment.duration});return{doc:d,tau:JM({audioSegment:vF(Pp(d,p)),text:l.text,defaultSpeaker:l.defaultSpeaker}),newScratchSequenceVideoTrackId:g}}return{doc:e,tau:l}}function xR(e,t,n,r,o,i){const{linkedSubAlignment:a,subAlignmentInMediaDomain:s,ref:c}=GV(e,t).tausAndDataLinkedSub().getTauData(n);if(!s||!c?.voiceover?.metadata.alignment)return;let d=[],l=s.offset,u=!1;if(a){const{match:e,next:t}=a.searchForTextOffset(r.location),n=e||t;if(!n)return;l+=n.index;const i=a.length,c=$s(r);for(let r=n.index;r<i&&a.ranges[r].location<c;r++){const e=Wg(s,r);(0,Me.fastDeepEqualJson)(o,e.speaker)?d.push(e):(u=!0,d.push(qh(e,o)))}}else{if(r.location>0||$s(r)<PP(e,t,n).string.length)return;d=Array.from(Qa(Kg(s),(e=>(0,Me.fastDeepEqualJson)(o,e.speaker)?e:(u=!0,qh(e,o)))))}if(!u)return;const f=i?.words||c.voiceover.metadata.alignment;let m=d[0].startTime,p=d[d.length-1].endTime;const g=i?.modifiedTimeRange;g&&(m=Math.min(g.offset,m),p=Math.max(p,rp(g)));const h={offset:m,duration:p-m},v=f.slice(0,l).concat(d).concat(f.slice(l+d.length));return{voRefId:c.id,updatedAlignment:{modifiedTimeRange:h,words:v}}}function kR(e,t,n,r,o){if(!DM(e,t,n))return e;const i=AR(e,t,{tauId:n,location:r.location},!1);if(!i)return e;e=i.doc;const a=i.beforeTau,s=i.afterTau;let c;if(s){const n=AR(e,t,{tauId:s.id,location:$s(r)-(a?PP(e,t,a.id).string.length:0)},!1);if(!n)return e;e=n.doc,c=n.beforeTau}if(c){const n=GV(e,t).tausAndDataBasic().getTauData(c.id),{scratchSequenceRef:r}=n;if(r){const t=CM(e,r.id);t&&(e=sO(e=UM(e,t.scratch.trackId,t.scratch.tauId,hI(wP(e,t.scratch.trackId,t.scratch.tauId),o)),t.scratch.trackId))}else e=UM(e,t,c.id,hI(n.tau,o))}return e}function NR(e,t,n){const r=new Map,o=e;let i=!1;for(const{tauAndRange:{tauId:d,range:l},speaker:u}of n){const n=wP(e,t,d),o=n&&n.audioSegment&&n.audioSegment.mediaRefId,a=xR(e,t,d,l,u,void 0!==o?r.get(o):void 0);a&&(i=!0,Ag(Pp(e,a.voRefId))?e=HA(e,a.voRefId,{newWords:a.updatedAlignment.words,shouldRefreshTimelineTaus:!1,refTimeRange:a.updatedAlignment.modifiedTimeRange,forceRegenerateAlignmentSource:!1,guessSpeakers:!1}):r.set(a.voRefId,a.updatedAlignment))}const a=hk(e,t);i&&a&&a.type===Jh.Composition&&(e=ix(e,function(e,t){return hE(e,"changedSinceLastPublish",t)}(a,!0)));for(const[d,l]of r.entries())e=$A(e,d,"alignment",l.words,{shouldRefreshTimelineTaus:!1});const s=e;for(const{tauAndRange:{tauId:d,range:l},speaker:u}of n)e=kR(e,t,d,l,u);const c=s!==e;return e=uO(e,o),c&&(e=sO(e,t)),e}const PR=A.logging.groupLogger("descriptmodel/timelinereplacecharacters"),LR=(e,t)=>{e&&qt("cannot replace characters in tau: "+t,"replace-characters-in-tau")};function FR(e,t,n,r,o,i){const a=GV(e,t).tausAndDataBasic().getTauData(n),s=a.renderedText,c=Cm([xm(s,Gs.get(0,r.location)),o,xm(s,Gs.get($s(r),s.string.length-$s(r)))]),d=Pf(o)-r.length,l=function(e,t,n,r){const{scratchSequenceRef:o}=n;if(o){const i=CM(e,o.id);if(i?.scratch){const o=wP(e,i.scratch.trackId,i.scratch.tauId);n.tau.text.string.trim()!==o.text.string.trim()&&PR.warn("updating tau text in scratch sequence that does not match"),e=0===r.string.length?UM(e,i.scratch.trackId,i.scratch.tauId,zM(jM(o,bm(" ")),void 0)):UM(e,i.scratch.trackId,i.scratch.tauId,jM(o,r));const a=jM(n.tau,r);return{doc:e=sO(e=UM(e,t,n.tau.id,a),i.scratch.trackId),newTau:a}}}}(e=_D(e,t,(o=>{if(o.tauAnchor.tauId===n){let n=!1;return i&&(n=-1!==i.indexOf(o.id)),FD(e,t,o,d,r.location,n)}return o}),{ensureSorted:!1}),t,a,c);if(l)return l;const u=jM(a.tau,c);return{doc:e=UM(e,t,n,u),newTau:u}}function UR(e,t,n,r,o,i){const a=PP(e,t,n);if(i)for(const s of i){if(!nk(e,t,s))throw new Error(`Could not find component to bump ${s}`);let n=!1;if(n=Pf(o)>0?bs.contains(Lf(o).charAt(Pf(o)-1)):!(r.location>0)||bs.contains(a.string.charAt(r.location-1)),n||(n=!($s(r)<a.string.length)||bs.contains(a.string.charAt($s(r)))),!n)return!0;break}for(const[s]of tk(e,t)){const{tauAnchor:e}=s;if(e.tauId===n&&e.location>=r.location&&e.location<=$s(r)&&(!i||-1===i.indexOf(s.id))){let t=!1;(e.location<=0||e.location>=a.string.length)&&(t=!0),!t&&r.location>0&&(t=bs.contains(a.string.charAt(r.location-1))),t||(Pf(o)>0?t=bs.contains(Lf(o).charAt(0)):$s(r)<a.string.length&&(t=bs.contains(a.string.charAt($s(r)))));if(!t)return!0}}return!1}function BR(e,t,n){const r=e/2;let o=0,i=0;return t>r&&n>r?(o=r,i=r):t<r&&n>r?(o=t,i=Math.min(e-t,n)):n<r&&t>r?(o=Math.min(e-n,t),i=n):(o=t,i=n),{bucketAmount1:o,bucketAmount2:i}}function jR(e,t,n){return Boolean(n.audioSegment&&(n.isScriptClip||CN(e,t,n)))}function VR(e,t,n,r,o,i){if(EE(e)){const a=rp(r),s={offset:FP(e,t,o.id),duration:BP(e,t,o.id)};if(jR(e,t,o)&&ip(s,a)){P()(o.audioSegment,"Missing audio segment");const e=Math.min(n,o.audioSegment.duration);return{timeToTrimFirstTau:e,timeToTrimLastTau:n-e}}if(jR(e,t,i)){P()(i.audioSegment,"Missing audio segment");const e=Math.min(n,i.audioSegment.duration);return{timeToTrimFirstTau:n-e,timeToTrimLastTau:e}}}if(o.id===i.id)throw new Error("Can't restore media from single clip.");const{bucketAmount1:a,bucketAmount2:s}=BR(n,oR(e,t,o.id)??0,rR(e,t,i.id)??0);return{timeToTrimFirstTau:a,timeToTrimLastTau:s}}function zR(e){return!!xf(e,Yu)||(!!xf(e,Zu)||e.name===Gu.Highlight)}function GR(e){return zR(e)||e.name===Gu.Annotation}function WR(e){return GR(e.attribute)}function HR(e,t){const n=t?zR:GR;return vu(e,(e=>n(e.attribute)))}function qR(e,t,n,r){let o=!1;return zb(e,t,n,!1,!1,!0,((i,a,s)=>{const c=Xj(e,t,i).length,d=eV(e,t,i).length,l=Gs.getStartEnd(s.location+c,$s(s)-d);return r(i)&&Qs(l,n)&&(o=!0),!0})),o}const{hasCharacterXBeforeY:$R}=a;function KR(e,t,n,r){const o=$R(Ds,Ms,r,void 0,!1);if(o&&function(e,t,n,r){if(0===r.length)return!1;if(!is(r,(e=>"."===e)))return!1;if(r.length>=3)return!0;const o=3-r.length;return!(n.location<o)&&is(Bb(e,t,n.location-o,n.location),(e=>"."===e))}(e,t,n,r))return{shouldCapitalizeNextWord:!1,shouldUncapitalizeWord:!0};if(!o&&function(e,t,n,r){if(r.length>0||0===n.length)return!1;const o=$s(n)-3;if(o<0)return!1;if("..."!==Bb(e,t,o,o+3))return!1;const i=n.location-3;return i<0||"..."!==Bb(e,t,i,i+3)}(e,t,n,r))return{shouldCapitalizeNextWord:!0,shouldUncapitalizeWord:!1};let i=!1,a=o;if(!o&&n.length>0){const o=Bb(e,t,n.location,$s(n));for(let r=o.length-1;r>=0;r--){const a=o.charAt(r);if(0===r&&n.location>0&&Es.contains(a)){const r=os(wb(Fb(e,t),n.location-1),(t=>t.name===Gu.Marker||Boolean(e.isStoryboard&&t.name===Gu.Pin))),o=Bb(e,t,0,n.location),a=!Ms.index(o,void 0,!0);r||a||(i=!0)}else{if(bs.contains(a))continue;Ds.contains(a)&&(i=!0)}break}const s=Ms.index(o),c=0===r.length&&void 0!==s;if(n.location>0){const r=Math.max(0,n.location-100),d=Bb(e,t,r,n.location);for(let e=d.length-1;e>=0;e--){const t=d.charAt(e);if(c&&Es.contains(t))a=!0;else if(t===qa){i=!1;const e=void 0!==s?o.charAt(s):void 0;c&&void 0!==e&&e===e.toUpperCase()&&(a=!0)}else{if(bs.contains(t))continue;Ds.contains(t)&&(i=!1,c&&(a=!0))}break}}else c&&(a=!0)}return{shouldCapitalizeNextWord:a,shouldUncapitalizeWord:i}}const{equalFrameCounts:YR,lessThanFrameCount:ZR,greaterThanFrameCount:JR,greaterThanOrEqualFrameCounts:QR}=s;function XR({doc:e,trackId:t,timeOffset:n,shouldRefreshTimelineTaus:r=!0,newTauId:o,suppressAutoMerge:i=!0,overlapsWordlessMedia:a=!1}){const s=UP(e,t,n);if(!s)return;const c=BP(e,t,s.id),d=n-FP(e,t,s.id),l=d*(s.audioSegment?.speed??1);if(!JR(d,0)||!ZR(d,c))return;let u,f;if(wN(s))({doc:e,beforeTau:u,afterTau:f}=_R(e,t,s,d,!1,o));else{const n=wR({doc:e,trackId:t,tauId:s.id,splitTime:l,afterTauId:o,suppressAutoMerge:i,ignoreNewline:a&&AP(e,t)?.id!==s.id});if(!n)return;({doc:e,afterTau:f,beforeTau:u}=n)}return r&&(e=sO(e,t)),{doc:e,selectionLocation:d,selectionType:"time",beforeTau:u,afterTau:f}}function eM(e,t,n,r,o=!1){const i=rp(n),a=n.offset,s=EE(e),c=XR({doc:e,trackId:t,timeOffset:a,shouldRefreshTimelineTaus:!1,overlapsWordlessMedia:o});c&&(e=c.doc);const d=XR({doc:e,trackId:t,timeOffset:i,shouldRefreshTimelineTaus:!1,newTauId:r,overlapsWordlessMedia:o});if(d&&(e=d.doc),s&&bk(e,t)&&c?.beforeTau&&d?.afterTau){const n=TB(e,t,c.beforeTau,d.afterTau);n&&(e=UM(e,t,n.beforeTau.id,n.beforeTau),e=_D(e=UM(e,t,n.afterTau.id,n.afterTau),t,(e=>e.tauAnchor.tauId===n.afterTau.id&&d.afterTau?OD(e,{...e.tauAnchor,location:e.tauAnchor.location+(n.afterTau.text.string.length-d.afterTau.text.string.length)}):e)))}const l=Zg(kP(e,t,n)),u=UP(e,t,a),f=UP(e,t,i);if(!u||!f)throw new Error("Could not find tau range and end taus");const m=u.id;let p=f.id;const g=GV(e,t).tausAndDataBasic().getTauData(f.id);return(!g.isScratchText&&i>g.timeOffset&&!hd(i,g.timeOffset)||!f.audioSegment&&Sd(i,_k(e,t)))&&(p=void 0),{doc:e,tauIds:l.map((e=>e.id)),startTauId:m,endTauId:p,splitNeeded:void 0!==c||void 0!==d}}const{getIndexesOf:tM}=a;function nM(e,t,n,r,{textMode:o,preferComponentTailEdit:i,canAddScratchTextTau:a=!1,isSelectionMovingBackward:s=!1,scratchTextSpeaker:c,shouldRefreshTimelineTaus:d=!0,correctCapitalization:l=!0,keepWordlessMedia:u,allowCorrectInWordlessMedia:f}){if(!e.isStoryboard&&Dk(e,t)&&Vf(r,(e=>bs.contains(e))))return;"string"!==typeof r&&(r=Om(r,WR));let m=n;if(o===NU.CorrectText&&!function(e,t){return e.length<=iM&&t.length<=iM}(m,Lf(r))&&!function(e,t,n){return qR(e,t,n,Zm)}(e,t,m))throw new LU(PU.MaxLengthExceeded);const p=EE(e),g=0===Pf(r);if(e.isStoryboard&&bk(e,t)){let n=!1;zb(e,t,m,!0,!0,!1,((e,t,r)=>!!(Zm(e)&&r.location<m.location&&$s(m)<$s(r)||hR(e)&&r.location<=m.location&&$s(m)<=$s(r))&&(n=!0,!0)));const i=Vf(r,(e=>bs.contains(e)));if(!n){let n=vT(e,t,m.location);if(n&&m.location>0&&0===m.length){const r=qb(e,t,n.start).location;m.location===r&&(n=rT(e,t,n)||n)}const d=Pf(r)>0&&Vf(r,(e=>Es.contains(e))),l=n&&ET(e,t,n),f=g&&l&&Qb(e,t).length>1&&!p;if(0!==m.location||f){if(n&&l&&!g){if(Vf(r,(e=>Is.contains(e))))return;if(d){const r=gT(e,t,n);m=Gs.get(Math.max(r,m.location),m.length)}else if(a){const o=yT(e,t,n);if(o){let i=o.text.string;const a=mT(e,t,n),s=xU(e,t,o,{location:m.location-a.location,length:m.length}).textRange.location;i=i.replace(" ","").replace(Ka,"");const d=Ff(i.slice(0,s)+r+i.slice(s)),l=new Set,u=new Set;zb(e,t,mT(e,t,n),!1,!1,!1,((e,t,n)=>!(!hR(e)&&!Zm(e))&&(n.location>=$s(m)?l.add(e.id):Qs(m,n)&&u.add(e.id),!1)));let f=JM();f=jM(f,d),Pf(f.text)>0&&(f=hI(f,c=c||L_(e,t,{tauId:o.id,location:0}))),e=Cx(e,t,Px(Lx(e,t),o.id,f,!0));const p=Pf(r),g=gT(e=_D(e,t,(e=>e.tauAnchor.tauId===o.id?u.has(e.id)?void 0:OD(e,{...e.tauAnchor,location:l.has(e.id)?s+p:0}):e)),t,n)+(Ms.index(f.text.string,void 0,!0)??0)+1;return{doc:e,selectionLocation:g,selectionType:"text",isScratchText:!0}}{const o=Ff(r);let i,a=JM();if(jU(e,t,m,(e=>{i=e})),i){a=hI(a,c=c||L_(e,t,{tauId:i.id,location:0})),a=jM(a,o);const s=mT(e=Cx(e,t,Ox(Lx(e,t),a,i.id)),t,n);if(m.location===s.location){const r=OD(n.start,{tauId:a.id,location:0});e=RD(e,t,r)}const d=m.location+Pf(r);return{doc:e,selectionLocation:d,selectionType:"text",isScratchText:!0}}}}}else if(n){const o=mT(e,t,n),a=gT(e,t,n),c=Fb(e,t).string,d=Es.contains(c[$s(o)-1]);if(g&&m.location===o.location&&1===m.length&&!l)return e=function(e,t,n){const r=rT(e,t,n);if(!r)return e;return e=_D(e,t,(o=>PB(o)?function(e,t){return function(e,t){return void 0!==e.endAnchor&&"cardBoundary"===e.endAnchor.type&&e.endAnchor.cardBoundaryId===t}(e,t.start.id)}(o,n)?LD(o,pU(n.end)?{type:"cardBoundary",cardBoundaryId:n.end.id}:{type:"endOfComposition"}):function(e,t,n,r){return!pU(n)&&hd(qx(e,t,n),iT(e,t,r))}(e,t,o,n)?uM(e,t,r.start,o):o:o)),e=sO(e=DD(e,t,n.start.id),t)}(e,t,n),{doc:e,selectionLocation:m.location,selectionType:"text"};const p=m.location<a&&m.location>o.location;let h=l&&1===m.length&&c[m.location]===Ka;if(1===m.length&&m.location>0&&g&&h&&m.location>a&&ys.contains(c.charAt(m.location-1))&&(h=!1,m={location:m.location-1,length:1}),u&&g&&ys.contains(c.charAt(m.location)))return;if((p||h)&&g&&1===m.length){let n,r;if(zb(e,t,s?Gs.getStartEnd(o.location,$s(m)):Gs.getStartEnd($s(m),a),!0,!0,!0,((t,o,i)=>{const a=function(e,t){return PB(t)&&"audio"===Ok(e,t.sceneId)}(e,t)||hR(t)||Zm(t);return s?a?(n=i,r=!1):PB(t)&&(r=!0):a?n=n??i:PB(t)&&(r=r??void 0===n),!1})),s&&(r||h)){if(m=n?Gs.get($s(n)-1,1):Gs.get(o.location,1),0===m.location&&!f)return}else!s&&r&&(m=n?Gs.get(qs(n),1):Gs.get(a,1))}else p&&Pf(r)>0&&0===m.length&&(m=Gs.get(a,m.length));if(l&&g&&m.location<=o.location+1&&1===m.length&&(m={location:o.location,length:Math.max(m.length+(m.location-o.location),o.length)}),!l&&(g||i)&&m.location<=a&&m.location>o.location){const i=Gs.get(o.location,m.location-o.location),s=vT(e,t,$s(m)-1)??n,c=s&&s.id!==n.id?mT(e,t,s):o,l=$s(m)<$s(c)?Gs.get($s(m),$s(c)-$s(m)):Gs.get($s(c),0);if(!aM(e,t,i,!1)&&!aM(e,t,l,!1)){const i=Js(o,c),l=[];let u="";UU(e,t,i,((n,r)=>{if(0===r.length)return!1;if(r.length<n.text.string.length){let o;if($s(r)<n.text.string.length){const i=AR(e,t,{tauId:n.id,location:$s(r)},!1);P()(i,"Could not split tau"),e=i.doc,i.beforeTau&&(o=i.beforeTau.id)}const i=As.index(n.text.string),a=r.location>(i??0);if(a){void 0!==i&&!a&&r.location>0&&(u=n.text.string.slice(0,r.location));const s=AR(e,t,{tauId:n.id,location:r.location},!1);P()(s,"Could not split tau"),e=s.doc,s.afterTau&&(o=s.afterTau.id)}o&&l.push(o)}else l.push(n.id);return!1}));const f=l.shift();if(!f)return;const p=rv(vM({text:`${r}${d?"\n":""}`}),f),g=new Set,h=new Set,v=new Set;zb(e,t,i,!1,!1,!1,((e,t,n)=>(Bu(e)&&Qs(m,n)?g.add(e.id):Bu(e)&&(l.includes(e.tauAnchor.tauId)||e.tauAnchor.tauId===f&&e.tauAnchor.location>p.text.string.length)?v.add(e.id):Bu(e)&&n.location<a&&h.add(e.id),!1)));const E=new Set,y=oT(e,t,s);if(y&&zb(e,t,mT(e,t,y),!1,!1,!1,(e=>(Bu(e)&&e.tauAnchor.tauId===(l.length>0?l.at(-1):f)&&E.add(e.id),!1))),e=Cx(e,t,Px(Lx(e,t),f,p)),l.length>0&&(e=Cx(e,t,Nx(Lx(e,t),l))),u){const n=jM(p,Cm([u,p.text]));e=Cx(e,t,Px(Lx(e,t),p.id,n,!0))}const S=DP(e,t,p.id);return{doc:e=_D(e,t,(e=>{if(!g.has(e.id))return E.has(e.id)&&S?e=OD(e,{tauId:S.id,location:0},!0):h.has(e.id)?e=OD(e,{tauId:p.id,location:0},!0):v.has(e.id)&&(e=OD(e,{tauId:p.id,location:p.text.string.length},!0)),PB(e)&&"cardBoundary"===e.endAnchor?.type&&g.has(e.endAnchor.cardBoundaryId)&&(e=LD(e,void 0)),e})),selectionLocation:gT(e,t,tT(e,t,n.id)),selectionType:"text"}}}if(g&&m.location>o.location&&$s(m)>$s(o)){const n=vT(e,t,$s(m));P()(void 0!==n,"No card at end of deletion range");const r=mT(e,t,n),o=$s(m)<$s(r)?Gs.get($s(m),$s(r)-$s(m)):void 0;if(o&&aM(e,t,o,!0)){const r=BT(e,t,$s(m)),o=eT(e=hM(e,t,n.start.id,r),t,n.start.id);P()(o,"Missing card we just moved");const i=mT(e,t,o).location;m=Gs.getStartEnd(m.location,i)}}}}else{if(d&&!g)return{doc:EM(e,t,0).doc,selectionLocation:0,selectionType:"text"};if(!g){if(o===NU.Write&&a&&!i){const n=EM(e,t,0),o=yT(e=n.doc,t,n.card);P()(o,"Added blank card with no gap clip");const i=Ff(Bf(r,"\n")),a=hI(jM(JM(),i),c);return{doc:e=Cx(e,t,Px(Lx(e,t),o.id,a,!0)),selectionType:"text",isScratchText:!0,selectionLocation:Pf(r)+1}}return}if(g&&1===m.length)return}}}let h=r,v=0;if(o===NU.EditMedia){const n=0===m.length&&1===Lf(h).length&&Os.contains(Lf(h)),r=0===Lf(h).length&&1===m.length&&Os.contains(Bb(e,t,m.location,$s(m)));n||r||OB(e,t,m,!0,!1,!1,!0)}const E=o===NU.EditMedia;let y;if(p){const n=function(e,t,n,r,o,i){if(Pf(n)>0&&r!==NU.CorrectText&&(r!==NU.EditMedia||"\n"===Lf(n)))return function(e,t,n,r){const o=SB(e,t,Gs.get(n.location,Math.max(1,n.length)));if(!o||qs(n)<qs(o.range)||0===o.component.range.location&&qs(n)===qs(o.range))return;const i=o.component,a=GV(e,t).tausAndDataForBasicAttributedString().getTauData(i.tauId),s=Gs.get(n.location-a.textOffset,0),c=xU(e,t,a.tau,s),d=AR(e,t,{location:c.textRange.location,tauId:i.tauId},r,BT(e,t,n.location)-a.timeOffset,!1);if(!d)return;e=d.doc;let l=d.afterTau,u=d.beforeTau,f=Lx(e,t);if(l&&l.audioSegment){l=zM(l,OF(l.audioSegment,!0)),l&&(f=Px(f,l.id,l))}if(u&&u.audioSegment){u=zM(u,OF(u.audioSegment,!0)),u&&(f=Px(f,u.id,u))}return e=Cx(e,t,f),{...d,doc:e}}(e,t,o,i);return}(e,t,r,o,m,!1);if(n&&(e=n.doc,n.afterTau&&n.beforeTau&&o===NU.Write)){const e=nL(n.doc,t,n.afterTau.id);m=Gs.get(e,m.length),y=n.afterTau}}const S=function(e,t,n,r,o,i,a,s){let c,d,l,u=n,f=!1,m=!1,p=!1;const g=new Set;let h=new Map;for(;;){h=new Map([...h.entries(),...cM(e,t,u).entries()]);const n=dM(e,t,u,f?"":r,o,g,h,i,a,s);if(p&&!n.foundComponent)break;if(n.foundComponent&&(n.replacementResult&&(c=n.replacementResult,e=n.replacementResult.doc),u=n.adjustedRange||u,f=f||n.didConsumeChars,m=n.done),void 0!==n.additionalChars&&(d=`${d||""}${n.additionalChars}`),void 0!==n.actionPadding&&(l=n.actionPadding+(l||0)),n.foundComponent&&(p=!0,g.add(n.foundComponent)),void 0===n.foundComponent||m)break}let v=f?"":r;void 0!==d&&(v=Bf(v,d));return{replacementResult:c,done:m,adjustedRange:u,charsToAdd:v,actionPadding:l}}(e,t,m,r,i,!1,E,s);if(S.done){const n=S.replacementResult;return e.isStoryboard&&n?{...n,doc:fO(n.doc,t)}:n}if(void 0!==S.actionPadding&&(v+=S.actionPadding),m=S.adjustedRange||m,h=S.charsToAdd,0===Pf(h)&&1===m.length){const n=m.location>0?Gs.get(m.location-1,3):Gs.get(m.location,2),r=Bb(e,t,n.location,$s(n));if(3===r.length&&"\n"===r.charAt(1)&&As.contains(r.charAt(0))&&As.contains(r.charAt(2))){h=" ";const n=Wb(e,t,Math.max(0,m.location-1));n&&hR(n)&&(h="\n",v+=1)}}if(e=S.replacementResult&&S.replacementResult.doc||e,o===NU.CorrectText){if(!function(e,t,n){let r=!1;const o=EE(e);return UU(e,t,n,((t,i,a)=>!(!o&&n.length>0&&0===i.length)&&(LN(e,t)?(r=!0,!1):void 0!==As.index(t.text.string,a)&&(r=!1,!0)))),r}(e,t,m))return;if(rM(e,t,m,Lf(h),o,a)&&!function(e,t,n){let r=!1;return UU(e,t,n,(t=>!!function(e,t){return LN(e,t)&&!kN(e,t)}(e,t)&&(r=!0,!0))),r}(e,t,m));else{const n=BT(e,t,qs(m)),r=function(e,t,n,r,o){const i=[];if(function(e){return e.indexOf(Sh.Tag)>=0}(r))return{doc:e};const a=EE(e);let s,c,d=0;if(o){const r=n.length>0?SB(e,t,Gs.get(qs(n),0),!0,!0,!0):void 0,o=SB(e,t,Gs.get($s(n),1),!0,!0,!0);if(s=void 0,c=void 0,r&&(s=BT(e,t,qs(n))),o&&(c=BT(e,t,$s(n))),void 0!==s&&void 0!==c&&r&&r.component===o?.component){const o=eM(e,t,{offset:s,duration:c-s});if(o&&o.tauIds.length>0){const i=sO(o.doc,t),a=CB(e,i,t,n.location);n=Gs.get(n.location+(a?.deltaLeftOfSplit||0),n.length+(a?.deltaRightOfSplit||0));const s=e;e=i;const c=wP(i,t,o.tauIds[0]),d=hN(e,t,o.tauIds[0],Gs.get(0,c.text.string.length),void 0,!0);if(d){e=d.doc;const o=CB(s,e,t,n.location)?.deltaLeftOfSplit||0,i=r.component.hasPrefix&&qs(r.range)===qs(n)?1:0;return{doc:e,adjustedRange:Gs.get(n.location+o+i,oB(c.audioSegment?.duration||0))}}}}if(void 0!==s){const r=XR({doc:e,trackId:t,timeOffset:s});if(r){const o=CB(e,e=r.doc,t,n.location),i=o?.deltaLeftOfSplit||0,a=o?.deltaRightOfSplit||0;n=Gs.get(n.location+1+i,n.length+a-1)}}if(void 0!==c&&void 0!==o){const r=XR({doc:e,trackId:t,timeOffset:c});if(r){const o=CB(e,e=r.doc,t,n.location)?.deltaLeftOfSplit||0;n=Gs.get(n.location,n.length+o)}}}return UU(e,t,n,((n,r)=>{if(n=wP(e,t,n.id),kN(e,n)){const o=PP(e,t,n.id),c=Math.max(0,r.location-10),l=Math.min(o.string.length,$s(r)+10),u=Gs.get(c,l-c),f=XA(e,t,n.id,u,!0),m=function(e,t,n){const r=Sh.Tag.length;let o=e.location,i=$s(e);const a=n.substring(e.location,$s(e));for(const s of tM(a,Sh.Tag)){const n=Gs.get(s+e.location,r);if(Ks(n,t)){if(!Qs(t,n))return}else $s(n)<=t.location?o=Math.max(o,$s(n)):i=Math.min(i,n.location)}return Gs.getStartEnd(o,i)}(f,r,o.string);if(!m)return!0;const p=function(e,t,n,r,o){const i=sN(e,t,n);if(!i)return;const{match:a,next:s}=i.searchForTextOffsetWithPunc(r.location),c=(a||s)?.index;if(void 0===c)return;let d=r.location,l=$s(r);for(let u=c;u<i.length;u++){const e=Wg(i.wordArrayView,u),t=i.rangesWithPunc[u];if(!Qs(r,t))break;if(!Qs(o,t)&&bh(e.attrs,Ih.Error)){if(!($s(t)<=o.location)){l=Math.min(l,t.location);break}d=Math.max(d,$s(t))}}return Gs.getStartEnd(d,l)}(e,t,n.id,m,f);if(!p)return!0;const g=hN(e,t,n.id,p),h=e;if(e=g.doc,g.unalignedTau){i.push(g.unalignedTau),a&&(d=function(e,t,n){if(Boolean(TP(e.doc,n,t.newTauId)))return 0;const r=GV(e.doc,n).tausAndDataForBasicAttributedString().getTauData(e.tauToBeSplit.id);if(!r.linkedSubAlignment)return 0;const o=r.linkedSubAlignment?.searchForTextOffset(e.splitLocation),i=o?.match;let a;if(i&&i.index>0)a=Gs.get(i.value.rangeWithPunc.location-1,1);else{if(i)return 0;o?.previous&&(a=Gs.get($s(o.previous.value.rangeWithPunc),1))}if(!a)return 0;let s=0,c=0;const d=a,l=rh(r.wordlessMedia,(e=>qs(e.range)>$s(d)?Ie.OrderedDescending:qs(e.range)<qs(d)?Ie.OrderedAscending:Ie.OrderedSame)),u=l.match||l.previous;if(u){const e=u.value;s=e.duration+yE(r.linkedSubAlignment),c=e.barValues?.length||0}const f=dB(s,!1,r.linkedSubAlignment)?c:0,m=GV(t.doc,n).tausAndDataForBasicAttributedString().getTauData(t.newTauId);if(0!==m.wordlessMedia?.[0]?.range.location)return 0;const p=OP(t.doc,n,t.newTauId);let g=0;if(p){const e=GV(t.doc,n).tausAndDataForBasicAttributedString().getTauData(p.id);if(e.wordlessMedia&&e.wordlessMedia.length>0){const t=e.wordlessMedia[e.wordlessMedia.length-1];qs(t.range)>=e.tau.text.string.length&&(g=oB(t.duration))}}return oB(m.wordlessMedia[0].duration)+g-f}({doc:h,tauToBeSplit:n,splitLocation:p.location},{doc:e,newTauId:g.unalignedTau.id},t)-(void 0!==s?1:0));const r=OP(e,t,g.unalignedTau.id);if(r){const n=wB(e,t,r,g.unalignedTau);if(n!==e){const r=nL(e,t,g.unalignedTau.id),o=nL(e=n,t,g.unalignedTau.id);d+=o-r+1}}}}return!1})),{doc:e,adjustedRange:Gs.get(n.location+d,n.length)}}(e,t,m,Lf(h),f);e=r.doc,p&&(void 0!==r.adjustedRange&&(m=r.adjustedRange),e=function(e,t,n,r){return BU(e,t,n,(n=>{if(void 0===n.preCorrectionText){const o=r-FP(e,t,n.id);e=UM(e,t,n.id,function(e,t){return hE(e,"preCorrectionText",{text:e.text.string,editTimeOffsetForDisambiguation:t})}(n,o))}})),e}(e,t,m,n))}}let I=!1;if(!rM(e,t,m,Lf(h),o,a)){if(0===Pf(h)&&m.length<=1&&!Wb(e,t,Math.max(0,m.location-1)))return;if(rM(e,t,m,Lf(h)+" ",o,a))h=Bf(h," "),v+=1;else{if(!rM(e,t,m," "+Lf(h),o,a))return void m.length;h=jf(h," "),I=!0}}const{shouldCapitalizeNextWord:b,shouldUncapitalizeWord:T}=KR(e,t,m,Lf(h)),w=Vb(e,t),C=oM(e,t,m,h,o,a,c,d),_=w-Vb(e=C.doc,t)-m.length+Pf(r);if(m=Gs.get(m.location-_,m.length),!C.isScratchText&&l&&(b||T)){const n=Gs.get(m.location,Pf(r));e=function(e,t,n,r){const o=Ub(e,t,Gs.get($s(n),100));if(0===o.string.length)return e;const i=As.index(o.string);if(void 0===i)return e;let a=bs.index(o.string.substr(i));if(void 0===a){if(!(o.string.length<100))return e;a=o.string.length-i}if(Wb(e,t,$s(n)+i))return e;const s=xm(o,Gs.get(i,a));if(0===s.string.length||s.string.match(/^[Ii]$|^[Ii]'+/))return e;const c=s.string[0];let d=r?c.toLocaleUpperCase():c.toLocaleLowerCase();return d===c?e:(d=bm(d,HR(Array.from(Vm(s,0)),!1)),oM(e,t,Gs.get(i+$s(n),1),d,NU.CorrectText,!1,void 0).doc)}(e,t,n,b)}if(0===m.length&&1===Lf(h).length&&Es.contains(Lf(h))){const n=Gs.get(m.location,Pf(r));e=function(e,t,n){const r=Ub(e,t,Gs.get($s(n),1));if(0===r.string.length)return e;if(!Is.contains(r.string))return e;const o=Gs.get($s(n),1);return oM(e,t,o,"",NU.CorrectText,!1,void 0).doc}(e,t,n)}e=fO(e,t),I&&0===_&&y&&(v+=1);let A=C.selectionLocation-v;if(y){A=nL(e,t,y.id);OP(e,t,y.id)?.text.string.endsWith(" ")&&!Lf(h).endsWith(" ")&&(A-=1)}return{...C,doc:e,selectionLocation:A}}function rM(e,t,n,r,o,i,a=!1){let s=!1,c=!1;return sM(e,t,n,o,(({doc:e,tauId:n,adjustedRange:d,allowAlignedWordInsertion:l,allowAlignedPuncInsertion:u,componentIdsToBump:f,isFinalReplacementRange:m,isEntirelyInComponents:p,overlapsWordlessMedia:g})=>{if(p&&!g)return e;const h=function(e,t,n,r,o,i=!1,a=!1,s=NU.EditMedia,c,d=!1,l=!0,u=!1){const f=i,m=f||a,p=wP(e,t,n);if(!m&&kN(e,p)&&!p.ignoreAlignment&&o.length>0)return LR(u,"Can't insert punc, has aligned audio, cannot ignore alignment, length > 1"),!1;if(_N(p)&&(0!==r.location||0!==r.length))return LR(u,"Read only tau with inRange location or length > 0"),!1;const g=PP(e,t,p.id);if($s(r)>g.string.length)return LR(u,"inRange upper bound > tau string length"),!1;const h=r.length===g.string.length&&0===o.length,v=0===r.length&&(0===o.length||" "===o);if(kM(e,t,p.id)&&!h&&!v)throw new LU(PU.RegenerateAlteration);if(!l&&g.string.length===r.location&&0===o.length)return!0;const E=OM(e,p);if(e.isStoryboard&&s!==NU.Write&&E){const e=void 0===Ms.index(o);return e||LR(u,"Tau is scratch text and text mode is not write"),e}if(s===NU.CorrectText&&!nR(e,t,p.id,r,o,l))return void LR(u,"Text mode is correct and change is not legal boundary correction");if(UR(e,t,p.id,r,o,c))return LR(u,"Edit will trap attached component"),!1;const y=d&&(0===r.length&&0===r.location||g.string.length===r.location||0===r.location&&r.length===g.string.length);if(EN(p)&&!y){const e=void 0===Ms.index(o);return e||LR(u,"Can only add non-word characters to gap clips"),e}if(p.isScriptClip){const n=PP(e,t,p.id),i=n.string.indexOf(IE.string);if(0===Pf(o)&&Hs(r,i))return!0;if(r.location<n.string.length&&0!==$s(r))return!!EE(e)||(LR(u,"Tau is script clip, string is empty, should not show wordless media"),!1)}if(!E&&!p.ignoreAlignment&&(nN(e,t,p.id)||p.isScriptClip&&(!EE(e)||"\n"!==o))){if(!0===UN(e,t,p.id,o,r))return!0;if(!f)return LR(u,"Aligned word insertion not allowed"),!1;if(sR(p,r))return LR(u,"Range boundaries in middle of word"),!1;if(!p.isScriptClip&&tR(e,t,p.id,r,o))return LR(u,"Tau is not script clip and insertion touches word"),!1;if(!d&&g.string.length===r.location){const r=DP(e,t,n);return!(!r||!OM(e,r))||void LR(u,"Cannot add scratch text tau, length = location, next tau is not scratch")}const i=XA(e,t,p.id,r);if(void 0===Ms.index(g.string,i)&&(0===o.length||!d))return LR(u,"Range has no words, string length is 0, cannot add scratch text"),!1;if(!d&&void 0!==Ms.index(o))return LR(u,"Cannot add scratch text tau, new text has words"),!1}return!0}(e,t,n,d,r,l,u,o,f,i,m,a);if(!1!==h)return!0===h&&(c=!0),e;s=!0})),c&&!s}function oM(e,t,n,r,o,i,a,s=!0){let c=!1,d=!0;e=sM(e,t,n,o,(({doc:n,tauId:s,adjustedRange:l,allowAlignedWordInsertion:u,allowAlignedPuncInsertion:f,componentIdsToBump:m,isFinalReplacementRange:p,trailingWordlessMediaDuration:g,previousWordlessMediaComponent:h,isScratchTextTau:v,isScriptClip:E})=>{if(d&&v&&(c=!0),E&&EE(e)&&o===NU.CorrectText)throw new LU(PU.WordlessMediaCorrection);const y=function(e,t,n,r,o,i=!1,a=!1,s=NU.EditMedia,c,d=!0,l=!1,u=!0,f,m,p=0){let g=wP(e,t,n);const h=Wx(e,t),v=e=>(e=XC(e,t,{assumeNoTauOrderChange:{prevTimeline:h}}),d?sO(e,t):e),E=Lf(o),y=i,S=y||a,I=s===NU.CorrectText;if(!S&&kN(e,g)&&!g.ignoreAlignment&&Pf(o)>0)return;if(_N(g))return;const b=PP(e,t,g.id);if($s(r)>b.string.length)return;const T=OM(e,g);if(e.isStoryboard&&s!==NU.Write&&T&&void 0!==Ms.index(E))return;if(I&&!nR(e,t,g.id,r,E,u))return;if(UR(e,t,g.id,r,o,c))return;const w=g.audioSegment;if(wN(g))return void 0===Ms.index(E)?v(e=FR(e,t,g.id,r,o,c).doc):void 0;const C=EE(e),_=0===Pf(o),A=C&&m&&0===m.range.location&&0===r.location;if(g.isScriptClip){const n=PP(e,t,g.id),i=n.string.indexOf(IE.string);if(_&&Hs(r,i)){if(A)return;const n=zM(g,void 0);return v(e=Cx(e,t,Px(Lx(e,t),g.id,n)))}if(r.location<n.string.length&&"\n"!==Lf(o)){if(C)throw new LU(PU.WordlessMediaEdit);return}}if(T||!w||void 0===w.mediaRefId||!nN(e,t,g.id)&&!g.isScriptClip||g.ignoreAlignment){const n=!I&&_&&!iR(e,t,g.id,r),i=FR(e,t,g.id,r,o,c);if(e=i.doc,g=i.newTau,f&&(e=kR(e,t,g.id,Gs.get(r.location,Pf(o)),f)),n){const n=zM(g,void 0);e=Cx(e,t,Px(Lx(e,t),g.id,n))}}else{const n=w.mediaRefId;if(!0===UN(e,t,g.id,E,r)){let n=!1;if(_&&r.length===b.string.length&&!A){if(!y)return v(e);n=!0}const i=FR(e,t,g.id,r,o,c),{newTau:a}=i;if(e=i.doc,n){const n=zM(a,void 0);e=Cx(e,t,Px(Lx(e,t),a.id,n)),g=n}else C&&p>0&&a.audioSegment&&(g=zM(a,hF({...a.audioSegment,offset:a.audioSegment.offset+p,duration:a.audioSegment.duration-p})),e=Cx(e,t,Px(Lx(e,t),a.id,g)));return v(e)}if(!y)return;if(sR(g,r))return;if(!g.isScriptClip&&tR(e,t,g.id,r,E))return;const i=XA(e,t,g.id,r);let a=o,s=l;const d=DP(e,t,g.id);s||b.string.length!==r.location||(s=Boolean(d&&OM(e,d)));const u=b.string.substr(i.location,i.length);if(void 0===Ms.index(u)){if(_||!s)return;a="",i.location<r.location&&(a+=b.string.substring(i.location,r.location)),a=jf(o,a),$s(i)>$s(r)&&(a=Bf(a,b.string.substring($s(r),$s(i))))}if(!s&&void 0!==Ms.index(Lf(a)))return;const m=mN(e,t,g.id,i.location,void 0,A),h={tauId:g.id,location:i.location};let S;if(!f&&Pf(a)>0&&(f=L_(e,t,h)),bk(e,t)&&d&&OM(e,d)&&o.toString().length>0){const n=OR({doc:e,compositionId:t,replaceRange:{offset:FP(e,t,d.id),duration:0},placeholder:o.toString(),scratchTextSpeaker:f});e=n.doc,S=n.tau}let{doc:I,tau:T,afterTau:R}=RR(e,t,S,h,m,void 0,A);g=wP(e=I,t,g.id);const M=g.audioSegment,D=nN(e,t,g.id);if(M&&!M.suppressAutoMerge&&D&&0===D.length)if(A);else{const n=zM(g,void 0);e=Cx(e,t,Px(Lx(e,t),g.id,n))}if(T&&(T=jM(T,Ff(a)),Pf(T.text)>0&&(T=hI(T,f)),e=Cx(e,t,Px(Lx(e,t),T.id,T))),R){const r=R.audioSegment;if(r){const o=aR(e,t,R.id,i.length)*r.speed+p,a=FR(e,t,R.id,Gs.get(0,i.length),"",c);e=a.doc,R=a.newTau;const s=0===o;let d=SF(r,hF({mediaRefId:n,offset:r.offset+o,duration:r.duration-o,effects:r.effects}),s,!0,!0);d=mI(d),d=_w(e,t,g.id,d);const l=vN(e,d);let u;u=l&&(l.length>0||C&&lB(d.duration,!1,D))?zM(R,d):zM(R,void 0),e=Cx(e,t,Px(Lx(e,t),R.id,u)),R=u}}_P(e,t)||(e=Cx(e,t,Rx(Lx(e,t),JM())))}return v(e)}(n,t,s,l,d?r:"",u,f,o,m,!1,i,p,a,h,g);return y&&(d=!1),y??n})),s&&(e=sO(e,t));const l=Pf(r);return{selectionLocation:n.location+l,selectionType:"text",isScratchText:c,doc:e}}const iM=100;function aM(e,t,n,r){if(!tp(n)){let o=!1;const i=EE(e);return UU(e,t,n,((e,t,n,r,a,s)=>{if(s)return o=o||i,i;const c=e.text.string.substring(t.location,$s(t));return void 0!==Ms.index(c)&&(o=!0,!0)})),r&&!o&&zb(e,t,n,!1,!1,!1,((e,t,n)=>!(!Zm(e)&&!hR(e))&&(o=!0,!0))),o}for(const o of Kg(kP(e,t,n)))if(void 0!==Ms.index(o.text.string))return!0;return!1}function sM(e,t,n,r,o){const i=r===NU.EditMedia||r===NU.Write,a=r===NU.EditMedia||r===NU.CorrectText||r===NU.Write,s=EE(e),c=[],{getTauData:d}=GV(e,t).tausAndDataForAttributedString();UU(e,t,n,((e,t,n)=>(c.push({tauId:e.id,renderedRange:n,tauData:d(e.id)}),!1)));for(let l=0;l<c.length;l++){const{tauId:n,tauData:r,renderedRange:d}=c[l];let u=xU(e,t,r.tau,d);_N(r.tau)&&1===u.textRange.location&&0===u.textRange.length&&(u=xU(e,t,r.tau,{location:0,length:0}));const f=u.textRange,m=u.componentIdsToBump,p=l===c.length-1;let g=0;if(s&&u.overlapsWordlessMedia){const e=u.overlappingWordlessMediaRanges.find((e=>qs(e)>=qs(d)&&$s(e)>=$s(d)));e&&(g=nB($s(d)-qs(e))+yE(r.subAlignment))}const h=o({doc:e,tauId:n,adjustedRange:f,allowAlignedWordInsertion:i,allowAlignedPuncInsertion:a,componentIdsToBump:m,isFinalReplacementRange:p,isEntirelyInComponents:u.isEntirelyInComponents,overlapsWordlessMedia:u.overlapsWordlessMedia,previousWordlessMediaComponent:u.previousComponent&&tB(u.previousComponent)?u.previousComponent:void 0,isScratchTextTau:r.isScratchText,isScriptClip:r.tau.isScriptClip,trailingWordlessMediaDuration:g});if(!h)break;e=h}return e}function cM(e,t,n){const r=new Map;return zb(e,t,n,!0,!0,!0,(n=>(tB(n)||r.set(n.id,Qj(e,t,n).length),!1))),r}function dM(e,t,n,r,o,i,a,s,c,d){const l=Gb(e,t,n,!0,!0,i,!0);let u=l?.component,f=!1;if(l){let o,d=0,m=0;const{component:p,range:g,componentRenderedRange:h}=l,v=tB(p);f=!v&&n.location>=h.location;const E=f?r:"",y=void 0!==Es.index(Lf(E)),S=Pf(E)>0;let I=!1,b=n.location+Pf(E);const T=oV(e,t,p).length,w=iV(e,t,p).length,C=tV(e,t,p).length,_=nV(e,t,p).length;if(v&&0!==Lf(r).length&&(qs(n)===$s(h)||$s(n)===qs(h)||p.hasPrefix&&$s(n)===qs(h)+T))return!p.hasPrefix||" "!==Lf(r)||$s(n)!==qs(h)&&$s(n)!==qs(h)+KU.length?{doc:e,foundComponent:u,done:!1,didConsumeChars:!1,replacementResult:{selectionLocation:b,selectionType:"text",doc:e},adjustedRange:o}:{doc:e,foundComponent:u,done:!0,didConsumeChars:!0,replacementResult:{selectionLocation:b,selectionType:"text",doc:e},adjustedRange:o};const A=rV(e,t,p).length,R=v?p.attributedString.string.length:a.get(p.id);if(void 0===R)throw new Error("original component length not found");if(v&&0===Lf(E).length&&c){const r=Math.max(n.location,h.location+T),a=Math.min($s(h)-w,$s(n)),s=Qs(h,n),c=GV(e,t).tausAndDataLinkedSub().getTauData(p.tauId);if(c.tau.isBlocked||r===a+w&&n.location>h.location)return{doc:e,foundComponent:u,done:s,didConsumeChars:!1,replacementResult:{selectionLocation:b,selectionType:"text",doc:e},adjustedRange:n};if(r>a)return{doc:e,foundComponent:u,done:s,didConsumeChars:!1,replacementResult:{selectionLocation:b,selectionType:"text",doc:e},adjustedRange:Gs.get(r+1,n.length-1)};const d=T>0&&n.location<=h.location,l=yE(c.linkedSubAlignment),f=d?l:0,m=a-r,g=p.hasPrefix?p.duration+l:p.duration,v=BT(e,t,d?h.location:r),E=nB(m)+f;let y=(0===T||d)&&m+T+w===h.length;const S=y?g:E,I={offset:v,duration:S};let C=DP(e,t,p.tauId);const _=OP(e,t,p.tauId),A=C&&(Hs(h,qs(n))||Hs(h,$s(n)))?bB(C.text.string):-1;let R=0;S>0&&(e=function(e,t,n,r,o=!0,i=!1){const a=[...n].reverse();for(const s of a){const n=s.duration-r;if(vd(n,0))throw new Error("Cannot delete time range with negative duration");const a=kP(e,t,s,o),c=Hg(a),d=qg(a);let l=0;if(c.id!==d.id){const{timeToTrimFirstTau:r,timeToTrimLastTau:o}=VR(e,t,n,s,c,d);if(l=r+o,c.audioSegment&&r>0){const n=c.audioSegment.offset,o=c.audioSegment.duration-r*c.audioSegment.speed;e=bM(e,t,c.id,n/c.audioSegment.speed,o/c.audioSegment.speed,!1)}if(d.audioSegment&&o>0){const n=o*d.audioSegment.speed,r=d.audioSegment.offset+n,i=d.audioSegment.duration-n;e=bM(e,t,d.id,r/d.audioSegment.speed,i/d.audioSegment.speed,!1)}}if(yd(n,l)){const o=DB(e,t,EE(e)?{offset:s.offset+r,duration:n-l}:{offset:s.offset+r/2,duration:n-l},{shouldRefreshTimelineTaus:!1,preservePartialScratchTexts:!0,preserveComponentsAtStartAndEndOfRange:EE(e),overlapsWordlessMedia:i});o&&(e=o.doc)}}return sO(e=fO(e,t),t)}(e,t,[I],0,!1,!0));const M=TP(e,t,p.tauId);if(A>0&&M){C=DP(e,t,p.tauId);R=(C?bB(C.text.string):-1)-A}if(dB(g-S,p.hasSuffix,c.linkedSubAlignment)){let r=0;if(p.hasSuffix&&" "===M?.text.string&&qs(n)>=qs(h)){const n=ck(e,t,p.tauId);n.length>0&&(r=n[n.length-1].tauAnchor.location)}o=Gs.get(n.location+r,n.length-m)}else{let e=0;p.hasPrefix||p.hasSuffix||!_?.text.string.endsWith(" ")&&!C?.text.string.startsWith(" ")&&" "!==c.tau.text.string||(e=1),o=Gs.get(qs(n)>=qs(h)?qs(h)+(d?0:T):qs(n),n.length+R-($s(n)>=$s(h)?h.length:m)-e),y=!0}if(!y){const r=Gb(e,t,n,!0,!0,i,!0);if(r&&tB(r.component)){if(u=r.component,qs(n)>=qs(h)&&$s(r.componentRenderedRange)>qs(o)){const e=Math.max(0,h.length-r.componentRenderedRange.length);o=Gs.get($s(r.componentRenderedRange),Math.max(0,n.length-e))}}else if(n.location>0){const r=Gb(e,t,Gs.get(n.location-1,1),!0,!0,i,!0);if(r&&tB(r.component)){u=r.component;const e=h.length-r.componentRenderedRange.length;e>=0&&(o=Gs.get($s(r.componentRenderedRange),Math.max(0,n.length-e)))}}}return{doc:e,foundComponent:u,done:s,didConsumeChars:!0,replacementResult:{selectionLocation:b,selectionType:"text",doc:e},adjustedRange:o}}if(hR(p)){if(g.length>0&&($s(g)<=C||g.location>=A-_))return{doc:e,done:!1,foundComponent:u,didConsumeChars:!1,adjustedRange:o};if(g.location<=T&&$s(g)>=A-w&&0===Pf(E)){const n=Hb(e,t,p.id);e=n.doc,b=n.selectionRange.location,d=-Math.min(R,g.length),m=-g.location,f=!1}else{if(y||S&&T>0&&(Ws(g,Gs.get(0,T))||$s(g)<T)||g.location>A-w||g.location===A-w&&g.length>0){let t,r;if(g.location>=C&&g.location<=T){const e=$s(g)<=T?$s(g):T;o=Gs.get(n.location-e+C,n.length),0===C&&T>0&&y&&1===Pf(E)&&(r="\n",t=(t||0)+1)}else if(g.location>=A-w){let e=Math.max($s(h)-_);n.location>e&&(e=n.location),o=Gs.get(e,Math.max(0,$s(n)-e)),o.location>n.location&&(t=o.location-n.location),0===_&&y&&1===Pf(E)&&(r="\n",t=(t||0)+1)}return{doc:e,done:!1,foundComponent:u,didConsumeChars:!1,adjustedRange:o,additionalChars:r,actionPadding:t}}if(!s&&(c||Ks(h,n))){const r=p.text.slice(0,Math.max(0,g.location-T))+Lf(E)+p.text.slice(Math.max(0,$s(g)-T)),o=r.length-p.text.length,i=Pf(E)-g.length;if(o!==i){b+=o-i}const a=UD(p,r);e=RD(e,t,a),d=Pf(E)-g.length,Ks(n,Gs.get($s(h)-w,w))&&(m+=w),u=a}}I=!0}else if(Zm(p)){if(0===g.length&&g.location===A-w&&Lf(E)===Zh.noteEndString)return{doc:e,done:!0,foundComponent:u,didConsumeChars:!0,replacementResult:{selectionLocation:b,selectionType:"text",doc:e}};if(1===g.location&&g.length>0||g.location<T&&$s(g)>A-T){const n=Hb(e,t,p.id);e=n.doc,b=n.selectionRange.location,d=-Math.min(A,g.length),m=-g.location,f=!1}else{if($s(g)<T||g.location>A-w)return f=!1,{doc:e,done:!1,foundComponent:u,didConsumeChars:f};if(g.location>0&&!s&&(c||Qs(h,n))){const n=BD(p,Cm([km(Ff(p.attrText),0,g.location-T),E,km(Ff(p.attrText),$s(g)-T)]));e=RD(e,t,n),d=Pf(E),u=n}}I=!0}else if(PB(p)||iw(p)||pU(p)){const o=pU(p)&&0===h.location;if(f=!1,y)return o&&0===n.location?{doc:e,done:!0,foundComponent:u,didConsumeChars:f}:{doc:e,done:g.location<A&&g.location>0,foundComponent:u,didConsumeChars:f};const i=A-oV(e,t,p).length-iV(e,t,p).length,a=1===Qb(e,t).length;if(""===r&&1===n.length&&e.isStoryboard&&(PB(p)||iw(p))&&p.sceneId&&"audio"!==Ok(e,p.sceneId))I=!0;else if(!((""===r||!c)&&n.length>=i&&g.location<i)||o&&a){if(0===g.location||g.location===i)return{doc:e,done:!1,foundComponent:u,didConsumeChars:f};if(g.location<A)return{doc:e,done:!0,foundComponent:u,didConsumeChars:f}}else{const n=Hb(e,t,p.id);e=n.doc,b=n.selectionRange.location,d=-Math.min(R,g.length),m=-g.location,I=!0}}if(I)return(n.location<h.location||$s(n)>$s(h))&&(o=Gs.get(n.location+m,n.length+d)),{doc:e,replacementResult:{selectionLocation:b,selectionType:"text",doc:e},done:!o,adjustedRange:o,foundComponent:u,didConsumeChars:f}}return{doc:e,done:!1,foundComponent:u,didConsumeChars:f}}function lM({doc:e,compositionId:t,location:n,taus:r,trackComponents:o,storyboardCues:i,layerOrder:a,preserveTauIds:s=!1,shouldRefreshTimelineTaus:c=!0,allowBlankCardReplacement:d=!1,shouldDuplicateReferencedTracks:l=!0,logFailureReason:u=!1}){if(!function(e,t,n,r=!1){return rM(e,t,Gs.get(n,0)," ",NU.EditMedia,!0,r)}(e,t,n,u))throw new LU(PU.InvalidInsertLocation);o=hu(o,(e=>pU(e)?_U(e,t):e));const f=vk(e,t).type;l&&(r=Eu(r,(n=>{let r=n,o=t;const i=function(e,t){const n=ZP(e,t);if(!t.audioSegment||!n||!Mg(n))return;const r=CM(e,n.id);if(!r)return;const o=Pp(e,n.id),{scratch:i,videos:a}=r,s=rv(wP(e,i.trackId,i.tauId),Ps());let c,d;a?.[0]&&(c=wP(e,a[0].trackId,a[0].tauId),d=rv(c,Ps()));const{doc:l,seqRefId:u}=TM(e,s,d,o.video);e=l;const f=zM(t,MF(t.audioSegment,u));return{doc:e,sequenceTau:f}}(e,n);if(i){const{doc:a,sequenceTau:s}=i;e=a,n=s;const{tauId:c,trackId:d}=wM(e,t,n);r=wP(e,d,c),o=d}if(r.replacedContentSceneId){const{doc:t,newTrackId:i}=l_(e,r.replacedContentSceneId);e=t,r.id===n.id?n={...n,replacedContentSceneId:i}:e=UM(e,o,r.id,{...r,replacedContentSceneId:i})}return n}))),o=o.filter((e=>jD(e,f)));const m=Vb(e,t);let[p,g,h]=s?[r,o,a]:_B(r,o,a);if(jU(e,t,Gs.get(n,0),((r,o,i)=>{if(0!==o.location&&o.location!==PP(e,t,r.id).string.length&&LN(e,r)&&!kN(e,r)&&(!EE(e)||!r.isScriptClip))throw new LU(PU.MediaEditInUnalignedTau);const[a,...s]=p,{componentIdsToBump:l}=xU(e,t,r,i),u=Za(fs(Ja(ck(e,t,r.id),(e=>e.tauAnchor.location===o.location)),(e=>Boolean(l?.includes(e.id)))))?.id;let f;if(a&&p){const i=e.isStoryboard?vT(e,t,n):void 0;if(i&&bk(e,t)&&ET(e,t,i)&&!ST(e,t,i)&&(!yN(a)||d)){const r=yT(e,t,i);P()(void 0!==r,"Missing gap clip in blank card");const o=new Set;zb(e,t,mT(e,t,i),!1,!1,!1,((e,t,r)=>((hR(e)||Zm(e))&&r.location>=n&&o.add(e.id),!1))),e=Cx(e,t,Px(Lx(e,t),r.id,p,!1));const s=p[p.length-1];e=YA(e,t,s.id);const c={tauId:s.id,location:s.text.string.length};e=_D(e,t,(e=>e.tauAnchor.tauId===r.id?OD(e,o.has(e.id)?c:{tauId:a.id,location:0}):e)),f=i.start.id}else{const i={tauId:r.id,location:o.location},c=Boolean(SB(e,t,Gs.get(n,1),!0,!0,!0));let d;c&&(d=BT(e,t,n)-FP(e,t,r.id));const u=RR(e,t,a,i,d,l,c);e=Cx(e=u.doc,t,Dx(Lx(e,t),s,a.id))}}e=fR(e=g.reduce(((n,r,o)=>{if(f&&0===o&&pU(r)&&0===r.tauAnchor.location){const o=vU(e,t,f);n=Hb(e,t,f).doc,r={...r,layers:[...r.layers,...o.layers.filter((e=>e.sourceSceneId!==t))]}}return MD(n,t,r,u,l?l[0]:void 0,!1,!1)}),e),t);for(const n of p)e=tN(e,t,n.id,void 0,void 0,void 0);c&&(e=sO(e,t),p=p.filter((n=>void 0!==TP(e,t,n.id))))})),h){const n=vk(e,t);e=ix(e,lx(n,tS(n.timeline,cS(Xy(e,t),h))))}i&&e.isStoryboard&&(e=ER(e,t,i));const v=Vb(e,t)-m;return{doc:e=vx(e,t,r),selectionLocation:Math.max(0,n+v),selectionType:"text",newTauIds:p.map((({id:e})=>e)),newComponentIds:g.map((({id:e})=>e))}}function uM(e,t,n,r){return OD(ND(r,n.offsetFromBaseTime),n.tauAnchor)}function fM(e,t,n,r,{resetOffset:o=!1}={}){const i=vU(e,t,n),a=uM(0,0,i,UB(e,t,r));return RD(e,t,o?kD(a,i.offsetFromAnchor):a)}function mM(e,t,n,r,o=r){let i,a;const s=SU(e,t,r),c=Kx(e,t,n),d=zB(e,t,n);if(vd(c,s)&&("cardBoundary"===n.endAnchor?.type||"endOfComposition"===n.endAnchor?.type)&&vd(s,c+d)){if(({doc:e,newPinTrackId:i,newComponentId:a}=function(e,t,n,r=n){const o=ux(e,n.sceneId,vk(e,n.sceneId).name);e=o.doc;const i=o.newTrackId,a=HD(e,t,r.tauAnchor,xB({sceneId:i,endAnchor:n.endAnchor,fillBehavior:n.fillBehavior,offsetFromBaseTime:r.offsetFromBaseTime,offsetFromAnchor:r.offsetFromAnchor}));return{doc:e=a.doc,newPinTrackId:i,newComponentId:a.component.id}}(e,t,n,o)),void 0===n.fillBehavior&&(e=DB(e,i,{offset:0,duration:s-c}).doc),"audio"!==xk(e,i)){const r=UB(e,t,a),o=uT(e,t,{offset:Kx(e,t,r),duration:zB(e,t,r)});for(const a of o){if(ST(e,t,a))continue;const r=Lw(a,i,void 0);P()(void 0!==r,"Missing card layer for pin"),e=Xw({doc:e,compositionId:t,cardLayerId:r.id,newSourceTrackId:n.sceneId})}}e=RD(e,t,LD(n,{type:"cardBoundary",cardBoundaryId:r.id}))}return{doc:e,newPinTrackId:i,newComponentId:a}}function pM({doc:e,compositionId:t,splitCardBoundary:n,nextCardBoundary:r=n,splitAudioPins:o=!1}){const i=[];for(const a of Wx(e,t).pins.components){if("audio"===xk(e,a.sceneId)&&!o)continue;const s=mM(e,t,a,n,r);e=s.doc,void 0!==s.newPinTrackId&&i.push(s.newPinTrackId)}return{doc:e,newPinTrackIds:i}}function gM(e,t,n,r){const o="text"===n.type?vT(e,t,n.renderedLocation):dT(e,t,n.timeOffset);if(o){if("text"===n.type&&!function(e,t,n){const r=vT(e,t,n);if(!r)return{canSplit:!1,isAfterContentRenderLoc:!1};const o=gT(e,t,r);return n<=o?{canSplit:!1,isAfterContentRenderLoc:!1}:aM(e,t,{location:o,length:n-o},!1)?{canSplit:!0,isAfterContentRenderLoc:!0}:{canSplit:!1,isAfterContentRenderLoc:!0}}(e,t,n.renderedLocation).canSplit||"time"===n.type&&hd(function(e,t,n){if("end"===n)return SU(e,t,"end");const r=vU(e,t,n);return SU(e,t,r)}(e,t,o.start.id),n.timeOffset))throw new LU(PU.OverlappingCardBoundary);e=_D(e,t,(n=>PB(n)&&function(e,t,n,r){return!pU(n)&&op(sT(e,t,r),Kx(e,t,n))}(e,t,n,o)&&void 0===n.endAnchor?LD(n,"end"===o.end?{type:"endOfComposition"}:{type:"cardBoundary",cardBoundaryId:o.end.id}):n))}const i=o?.start?vU(e,t,o.start.id):void 0,a="time"===n.type?n.timeOffset:BT(e,t,n.renderedLocation);let s=[];i&&(s=function(e,t,n){if(0===n.length)return bu();const r=Uw(e,t,n);return r?vu(lC(e,t,n[0]),(e=>sp(r,iC(e)))):bu()}(e,t,i.layers.map((e=>e.id))));let c=[],d=[];if(i){const n=vU(gC(e,WT(e.projectId,t)),t,i.id);c=[...n.layers],d=n.effects.map(iU)}const l=uU({effects:d,layers:Jw(c,a-(i?SU(e,t,i):0)),videoFades:i?{fadeInDuration:void 0,fadeInShape:void 0,fadeOutDuration:i.videoFades?.fadeOutDuration,fadeOutShape:i.videoFades?.fadeOutShape,tailTransitionEffect:i.videoFades?.tailTransitionEffect}:void 0});let u,f;"text"===n.type?(u=n.renderedLocation,f=IB(e,t,Gs.get(n.renderedLocation,1)),void 0!==f&&(n={type:"time",timeOffset:a},u=a)):u=n.timeOffset;const m=XR({doc:e,trackId:t,timeOffset:a,suppressAutoMerge:!1,shouldRefreshTimelineTaus:!1,overlapsWordlessMedia:Boolean(f)});EE(e=m?.doc??e)&&f&&m&&m.beforeTau&&m.afterTau&&(e=wB(e,t,m.beforeTau,m.afterTau));const p="text"===n.type?WD(e,t,u,l,void 0!==f):function(e,t,n,r){const o=UT(e,t,n,!1);if(!o)throw new Error("No tau to attach component at range");const i={tauId:o.tauId,location:o.range.location},a=HD(e,t,i,r,!1);e=a.doc;let s=a.component;if(s=PD(e,t,s,n),!nk(e=RD(e,t,s),t,s.id))throw new LU(PU.CueOverlap);const c=qb(e,t,s);return{doc:e,selectionRange:c||Gs.get(0,0),anchoredComponent:s}}(e,t,u,l);if(e=p.doc,i&&(e=RD(e,t,function(e,t){void 0!==t.fadeInDuration&&hd(t.fadeInDuration,0)&&(t.fadeInDuration=void 0);void 0!==t.fadeOutDuration&&hd(t.fadeOutDuration,0)&&(t.fadeOutDuration=void 0);return(0,T.Uy)(e,(e=>{e.videoFades?e.videoFades={...e.videoFades,...t}:e.videoFades={fadeInDuration:t.fadeInDuration,fadeOutDuration:t.fadeOutDuration,fadeInShape:t.fadeInShape,fadeOutShape:t.fadeOutShape,headTransitionEffect:t.headTransitionEffect,tailTransitionEffect:t.tailTransitionEffect}}))}(i,{fadeOutDuration:void 0,fadeOutShape:void 0,tailTransitionEffect:void 0}))),m&&m.afterTau&&p.anchoredComponent&&(e=RD(e,t,OD(p.anchoredComponent,{tauId:m.afterTau.id,location:0}))),!r&&"text"===n.type)if(m?.beforeTau)e=UM(e,t,m.beforeTau.id,jM(m.beforeTau,Cm([m.beforeTau.text,"\n"])));else{const r=nM(e,t,{location:n.renderedLocation,length:0},"\n",{textMode:NU.EditMedia,preferComponentTailEdit:!1});e=r?.doc||e}const g=tT(e,t,l.id),h=sT(e,t,g);for(const v of s.filter((({id:n})=>void 0!==mC(e,t,n)))){const n=vk(e,t);P()(n.type===Jh.Composition,"Not a composition"),sp(v.controlledTimeRange,h)&&(e=yR(e,n.id,v.id,{id:v.id,anchor:SR(e,t,v),keyframes:v.keyframes}))}return{doc:e,newCard:g}}function hM(e,t,n,r){const o=vU(e,t,n),i=tT(e,t,n),a=sT(e,t,i),s=vU(RD(e,t,PD(e,t,o,r)),t,n);return _D(e,t,(r=>{if(r.id===n)return OD(ND(kD(r,s.offsetFromAnchor),s.offsetFromBaseTime),s.tauAnchor);if(PB(r)&&CU(e,t,r,o))return uM(0,0,s,r);if(PB(r)){const n=Kx(e,t,r);if(op(a,n))return function(e,t,n,r){const o=Kx(e,t,r),i=kD(OD(r,n.tauAnchor,!0),0);return PD(e,t,i,o)}(e,t,s,r)}return r}))}function vM({text:e="",duration:t=5}={}){return XM({duration:t,text:bm(`${Ka}${e}`)})}function EM(e,t,n,r=5){const o=Fb(e,t).string,i=Vb(e,t),a=vT(e,t,n);let s=!1,c=!1;if(a){const r=mT(e,t,a);n===r.location+1?n-=1:s=function(e,t,n,r){if(r<=n.location||r>=$s(n))return!1;let o=!1;return UU(e,t,Gs.getStartEnd(r,$s(n)),((e,t)=>void 0!==Ms.index(e.text.string,t)&&(o=!0,!0))),o}(e,t,r,n),n===r.location&&(c=!0)}const d=vM({text:n<i&&(Cs.contains(o[n])||a&&s)?"\n":"",duration:r});if(n===i&&a){const n=AP(e,t);P()(n,"No taus in composition"),e=Cx(e,t,Dx(Lx(e,t),d,n.id))}else e=lM({doc:e,compositionId:t,location:n,taus:[d],trackComponents:[],layerOrder:void 0,storyboardCues:void 0,preserveTauIds:!0,shouldRefreshTimelineTaus:!1}).doc;const l=uU({layers:[]}),u=vU(e=HD(e,t,{tauId:d.id,location:0},l).doc,t,l.id);let f;const m=DP(e,t,d.id)?.id;if(a&&s){if(void 0===m)throw new Error("Adding a card in the middle of an existing card, but no next tau");const n=uU({layers:Jw(a.start.layers,0)});f=vU(e=HD(e,t,{tauId:m,location:0},n).doc,t,n.id)}else{if(a&&c&&void 0!==m){const n=FP(e,t,m);e=hM(e,t,a.start.id,n)}f=bU(e,t,u.id)}if(n>0&&Cs.contains(o[n-1])){e=nM(e,t,{location:n,length:0}," \n",{textMode:NU.EditMedia,preferComponentTailEdit:!1})?.doc||e}return{card:tT(e=sO(e=yM(e,t,f,vU(e,t,u.id)),t),t,u.id),doc:e}}function yM(e,t,n,r){const o=r.id,i=EU(n);return e=_D(e,t,(e=>PB(e)&&e.endAnchor&&("end"===n&&"endOfComposition"===e.endAnchor.type||"end"!==n&&"cardBoundary"===e.endAnchor.type&&e.endAnchor.cardBoundaryId===i)?LD(e,{type:"cardBoundary",cardBoundaryId:o}):e)),"end"!==n&&(e=pM({doc:e,compositionId:t,splitCardBoundary:r,nextCardBoundary:n}).doc),e}function SM(e,t,n,r,o){const i=AT(e,t,n,r),a=new Set;for(const s of i){const t=ZP(e,s);if(t&&Ag(t)&&!a.has(t.id)){for(const n of t.audio.trackSceneIds){const t=vk(e,n);Mk(t)&&o(t)}a.add(t.id)}}}function IM(e,t,n,r,o){let i=RF(n.audioSegment,o);i=AF(i,r);const a=zM(n,i),s=e;if(e=Cx(e,t,Px(Lx(e,t),n.id,a,!0)),r!==n.audioSegment.offset){const r=o-n.audioSegment.duration,i={};for(const o of ck(e,t,n.id))i[o.id]=qx(s,t,o)+r;e=_D(e,t,(n=>{const r=i[n.id];return void 0===r?n:PD(e,t,n,r)}))}return e}function bM(e,t,n,r,o,i=!1,a){const s=TP(e,t,n);if(!s)return e;const c=s.audioSegment?.speed??1,d=r*c,l=o*c,u=(s.audioSegment?s.audioSegment.offset-d:0)/c,f=e.isStoryboard&&void 0===a&&u>0?wU(e,t,GV(e,t).tausAndDataBasic().getTauData(s.id).timeOffset):void 0;if(CN(e,t,s))e=IM(e,t,s,d,l);else{const{audioSegment:n}=s;if(!n)return e;if(d<0)return e;const r=$M(e,t,s.id,{offset:d,duration:l},!i);if(!r)return e;e=s_(e=r,t,s.id,NF,s.audioSegment?.audioFades||ph,!0),e=s_(e,t,s.id,PF,s.audioSegment?.videoFades||ph,!0)}if(void 0!==a&&RP(e,t,s.id)){const t=FB(e,a.compositionId,a.componentId);if(t){if(void 0===t.endAnchor){const n=qx(e,a.compositionId,t),r=dT(e,a.compositionId,n);r&&(e=RD(e,a.compositionId,LD(t,yU(r.end))))}const n=qp(e,a.compositionId);if(a.offsetFromCardBoundary&&n.isVideo)e=function(e,t,n,r,{preserveDuration:o=!1}={}){const i=dT(e,t,r);P()(i,"setComponentTimeOffsetAnchoredToCard: No card found at time offset");const{offset:a,duration:s}=sT(e,t,i),c=GD(e,t,n,r,r<a+s/2||"end"===i.end?a:a+s,{preserveDuration:o});return P()(c,"setComponentTimeOffsetAnchoredToCard: Failed to set component time offset"),c.doc}(e,a.compositionId,a.componentId,Math.max(0,Kx(e,a.compositionId,t)-u));else{const n=!i&&e.isStoryboard&&wU(e,a.compositionId,Math.max(0,Kx(e,a.compositionId,t)-u));if(n&&pU(n))e=fM(e,a.compositionId,n.id,t.id);else{const n=t.offsetFromAnchor-u;let r;if(!e.isStoryboard&&n<0)r=function(e,t,n,r,o){const i=FB(e,t,n);if(!i)return;const a=kD(i,r),s=function(e,t,n){return UB(e,t,n).sceneId}(e=RD(e,t,a),t,a.id),c=_P(e,s);if(c&&!EN(c)&&o){const t=function(e){const t=Boolean(e?.audioFades),n=Boolean(e?.videoFades);if(t&&n)return LF;if(t)return NF;if(n)return PF;return}(c.audioSegment)||LF;e=s_(e,s,c.id,t,{fadeInDuration:Math.abs(r)},!0)}return{doc:e,selectionLocation:Kx(e,t,a),selectionType:"time"}}(e,a.compositionId,a.componentId,n,!1);else{const n=qx(e,a.compositionId,t)+t.offsetFromAnchor-u;r=GD(e,a.compositionId,a.componentId,n,n)}r&&(e=r.doc)}}}}return i||(e=sO(e,t)),f&&"end"!==f&&(e=hM(e,t,f.id,GV(e,t).tausAndDataBasic().getTauData(s.id).timeOffset)),e.isStoryboard&&vk(e,t).type===Jh.Composition&&RP(e,t,s.id)&&(e=fO(e,t)),e}function TM(e,t,n,r){const o=Ay();e=Cx(e=rx(e,o,void 0),o.id,xx(o.timeline.superTau,[t]));const i=[o.id];let a;if(n){const t=Ay({videoMetadata:r,name:"Overdub video"});a=t.id,e=Cx(e=rx(e,t,void 0),t.id,xx(t.timeline.superTau,[n])),i.push(t.id)}const s=BL({displayName:"Overdub sequence",audio:zL({trackSceneIds:i,isScratchText:!0}),video:r,assetJson:void 0});e=mO(e,s);for(const c of i)e=sO(e,c,!0);return{doc:e,seqRefId:s.id,videoSequenceTrackId:a}}function wM(e,t,n){const r="string"===typeof n?wP(e,t,n):n,o=ZP(e,r);let i=r.id,a=t;if(o&&Mg(o)){const t=CM(e,o.id);t&&t.scratch&&(i=t.scratch.tauId,a=t.scratch.trackId)}return{trackId:a,tauId:i}}function CM(e,t){const n=function(e,t){const n=Vk(e,t);if(!Mg(n))throw new Error("MediaReference is not a scratch text sequence");return n}(e,t),r=VV(e);let o,i;for(const a of n.audio.trackSceneIds){const{tausData:e}=r.getTrackData(a).tausAndDataBasic();if(0===e.length)continue;const t=e[0];if(t.isScratchText)o={trackId:a,tauId:t.tau.id};else if(t.freezeFrameTau||ON(t.tau,t.ref)){const e={trackId:a,tauId:t.tau.id};i||(i=[]),i.push(e)}}if(o)return{scratch:o,videos:i}}function _M(e,t){return(0,Me.fastDeepEqualJson)(e.overdubInfo,t)?e:{...e,overdubInfo:t}}function AM(e){return void 0===e.replacedContentSceneId&&void 0===e.generationControls?e:{...e,replacedContentSceneId:void 0,generationControls:void 0}}function RM(e){return gI(_M(zM(e,void 0),void 0),!1)}function MM(e){const t=e.overdubInfo;if(!t)return!1;const n=t.gibberishCount;return void 0!==n&&n>0}function DM(e,t,n){return GV(e,t).tausAndDataBasic().getTauData(n).isScratchText}function OM(e,t){return KN(t,void 0!==t.audioSegment?.mediaRefId?Pp(e,t.audioSegment.mediaRefId):void 0)}function xM(e,t){return $N(t,ZP(e,t))}function kM(e,t,n){return!0===NM(e,t,n)?.isRegeneration}function NM(e,t,n){const r=GV(e,t).tausAndDataBasic().getTauDataMaybe(n);return r?.scratchSequenceTauInfo?.tau.overdubInfo||r?.tau.overdubInfo}function PM(e,t,n){const r=GV(e,t).tausAndDataBasic().getTauDataMaybe(n);return r?.scratchSequenceTauInfo?.tau.replacedContentSceneId||r?.tau.replacedContentSceneId}function LM(e,t,n){const r=new Set(yu(n)),o=new Map;for(const s of r){const{trackId:n,tauId:i}=wM(e,t,s),a=XP(e,n,i);if(a&&kg(a)){for(const[t,n]of CP(e,a.id,!0)){const o=PP(e,t.id,n.id),i=rN(e,t.id,n);i&&mL(i,o.string)||r.delete(s)}s!==i&&(o.set(s,{scratchTextTauId:i,scratchTextTrackId:n}),r.delete(s))}else r.delete(s)}if(0===r.size&&0===o.size)return e;const i=bP(e,t),a=hu(i,(n=>{if(!r.has(n.id))return n;const o=eL(e,n);return o&&(e=pO(e,m_(o,kM(e,t,n.id)?"regenerationPrint":"overdubPrint"))),_M(AM(n),void 0)}));a!==i&&(e=Cx(e,t,xx(Lx(e,t),a)));for(const[s,{scratchTextTrackId:c,scratchTextTauId:d}]of o){let n=wP(e,c,d);const r=eL(e,n);r&&(e=pO(e,m_(r,kM(e,t,s)?"regenerationPrint":"overdubPrint"))),n=_M(AM(n),void 0);const o=wP(e=Cx(e,c,xx(Lx(e,c),[n])),t,s),i=ZP(e,o);i&&Mg(i)&&(e=vO(e,i.id,"isScratchText",void 0))}return e}const FM={expressiveness:.5,pacing:.5,increasePunctuationDurations:!0};function UM(e,t,n,r){return Cx(e,t,Px(Lx(e,t),n,r))}function BM(e,t,n){return sO(Cx(e,t,kx(Lx(e,t),n)),t)}function jM(e,t){return e.text===t?e:{...e,text:t,isScriptClip:!(t.string.length>0)&&e.isScriptClip}}function VM(e,t){if((void 0===t||void 0===e.audioSegment)&&t!==e.audioSegment)throw new Error("Cannot set audioSegment to or from `undefined` with updateAudioSegment");return t===e.audioSegment?e:{...e,audioSegment:t}}function zM(e,t,n=!0){return n&&t&&(t=mI(t)),(0,T.ZP)(e,(n=>{pp()(t,e.audioSegment)||(n.audioSegment=t),n.ignoreAlignment=!1,n.preCorrectionText=void 0,n.failedAlignmentKey=void 0,"video"===t?.channels&&(n.isScriptClip=!0,n.text=Im)}))}function GM(e,t){return(0,T.ZP)(e,(e=>{e.isScriptClip=t}))}function WM(e,t){return t?{...e,visual:{...e.visual,...t}}:e}function HM(e,t,n,r){if(!t.audioSegment)throw new Error("Cannot set transform on tau without audio segment");let o=t.audioSegment;r&&(o=function(e,t,n,r){let o={...t};for(const i of ye(r)){const t=n[i];if(void 0!==r[i]&&null!==r[i]&&(void 0===t||null===t||Object.values(t).some((e=>null===e||void 0===e)))){let t=LE(uI[i],r[i]);!e&&lI.has(i)&&(t=XF(t,!0)),o=ZF(o,t,!0)}}return o}(e,o,n,r));for(const i of Object.keys(n)){const e=n[i];null!==e&&void 0!==e&&(o=ZF(o,LE(uI[i],n[i]),!0))}return VM(t,o)}function qM(e,t,n){let r=wP(e,t,n);return r=GM(r,!0),sO(e=QA(e=UM(e,t,n,r),t,n,void 0),t)}function $M(e,t,n,r,o){const i=vI(e,t,n,r,o);if(!i)return;let{tau:a,textOffsetDelta:s,timeOffsetDelta:c}=i;const d={};for(const l of ck(e,t,n))d[l.id]=qx(e,t,l);return a=rv(a,n),e=e_(e=UM(e,t,n,a),t,n,0,s,c,d)}function KM(e,t,n,r){const o=wP(e,t,n);if(!EN(o))return e;return sO(e=UM(e,t,n,VM(o,xF(o.audioSegment,r||void 0))),t)}function YM(e,t){return function(e){return Boolean(void 0!==e.audioSegment?.mediaRefId)}(t)&&!TN(t)&&!MN(e,t)&&!xM(e,t)}function ZM(e,t,n,r,o=!0){const i=wP(e,t,n);if(e.isStoryboard&&!YM(e,i))return e;const a=K(r,pF,gF);if(!i.audioSegment)throw new Error("Cannot set speed for clip without an audio segment");if(i.audioSegment.speed===a)return e;const s=VM(i,kF(i.audioSegment,a));if(!s.audioSegment)throw new Error("Cannot set speed for clip without an audio segment");if(vk(e,t).type===Jh.Sequence){const r=GV(e,t).tausAndDataBasic(),o=r.taus[r.taus.length-1].id;if(i.id!==o){const o=r.getTauData(n);e=DB(e,t,{offset:o.timeOffset,duration:o.duration},{taus:[QM(e,{duration:o.duration})],shouldRefreshTimelineTaus:!1}).doc;e=DB(e,t,{offset:o.timeOffset,duration:_F(s.audioSegment)},{taus:[s],shouldRefreshTimelineTaus:!1,preserveTauIds:!0}).doc}else e=UM(e,t,n,s)}else e=UM(e,t,n,s);return o&&(e=sO(e,t)),e}function JM({id:e=Ps(),text:t=Im,audioSegment:n,ignoreAlignment:r=!1,isBlocked:o=!1,isScriptClip:i=!1,recordingSession:a,failedAlignmentKey:s,defaultSpeaker:c,overdubInfo:d,visual:l,replacedContentSceneId:u,overdubVideoPinId:f,preCorrectionText:m,generationControls:p}={}){return{id:e,text:t,audioSegment:n,ignoreAlignment:r,isBlocked:o,isScriptClip:i,recordingSession:a,failedAlignmentKey:s,defaultSpeaker:c,overdubInfo:d,visual:l,replacedContentSceneId:u,overdubVideoPinId:f,preCorrectionText:m,generationControls:p}}function QM(e,t){return XM({...t,enableRoomtone:!!e.settings.useRoomtoneOnGapClips||void 0})}function XM({id:e=Ps(),text:t=SE,offset:n=0,duration:r=1,isBlocked:o=!1,effects:i,enableRoomtone:a,suppressAutoMerge:s=!1}={}){return JM({id:e,text:t,isBlocked:o,audioSegment:hF({offset:n,duration:r,effects:i,enableRoomtone:a,suppressAutoMerge:s})})}function eD({text:e=SE,id:t=Ps(),mediaRefId:n,offset:r,effects:o,duration:i=6}){return JM({id:t,text:e,audioSegment:hF({mediaRefId:n,offset:r,duration:i,effects:o,isFreezeFrame:!0})})}function tD(e,t,n,r,o){const i=vF(n,r),a=r?.withText&&_g(n)?JA(e,n,r?.timeRange):void 0;let s=JM({text:a,...o,audioSegment:i});const c=n.video||n.image;if(c){const n=vk(e,t).videoMetadata;if(n){const t=function(e,t,n,r){const o=n/e,i=r/t;return Math.max(o,i)/Math.min(o,i)}(c.width,c.height,n.width,n.height);1!==t&&Math.abs(t-1)<=.25&&(s=HM(e.isStoryboard,s,{scale:{x:t,y:t}}))}}return s}function nD(e,t){const{id:n,audioSegment:r,text:o,ignoreAlignment:i,failedAlignmentKey:a,isScriptClip:s,recordingSession:c,defaultSpeaker:d,overdubInfo:l,visual:u,replacedContentSceneId:f,generationControls:m}=e;return{id:n,type:xu.tau,...Du(e),text:ym(o,t),audioSegment:r&&EF(r,t),ignoreAlignment:i||void 0,hasFailedAlignment:void 0!==a||void 0,failedAlignmentKey:a,isScriptClip:s||void 0,recordingSession:c,defaultSpeakerId:d?t.encodeReference(d.speakerId,xu.speaker):void 0,defaultStyleId:d?.styleId,overdubInfo:l,visual:u,replacedContentSceneId:f?t.encodeReference(f,xu.track):void 0,generationControls:m}}function rD(e,t){const{id:n,text:r,speechRecognitionPlaceholder:o,ignoreAlignment:i,failedAlignmentKey:a,hasFailedAlignment:s,isScriptClip:c,audioSegment:d,recordingSession:l,defaultSpeakerId:u,defaultStyleId:f,overdubInfo:m,visual:p,replacedContentSceneId:g,generationControls:h}=e;return JM({id:n,...Ou(e),text:Sm(r,t),ignoreAlignment:i,failedAlignmentKey:void 0===a&&s?0:a,isScriptClip:c||o,audioSegment:d&&yF(d,t),recordingSession:l,defaultSpeaker:void 0!==u?Ah(t.decodeReferenceId(u),f):void 0,overdubInfo:m,visual:p,replacedContentSceneId:void 0!==g?t.decodeReferenceId(g):void 0,generationControls:h})}function oD(e={}){return WC({...e,type:xu.cueTrackComponentList})}const iD=(0,fp.PW)((()=>[aw()]));function aD(e,t){return HC(e,t,iD())}function sD(e,t){return oD({...qC(e,t,iD()),type:void 0})}function cD(e){return Boolean(e&&e.type===xu.cueTrackComponentList)}function dD(e,t){const n=Gf(t);return um([{},...e.components.map(((e,t)=>function(e,t){const n=ek(e,t,!1),r={},{sceneId:o}=e;o&&mm(r,o,"cueTrack",Gf(t).prop("sceneId").path);return um([n,r])}(e,n.prop("components").item(t).path)))])}function lD(e){return WC({...e,type:xu.noAudioTrackComponentList})}const uD=(0,fp.PW)((()=>[vR(),Jm()])),fD=(0,fp.PW)((()=>[vR(),Jm()]));function mD(e,t){return HC(e,t,uD())}function pD(e,t){return lD({...qC(e,t,fD()),type:void 0})}function gD(e,t,n){const r=Gf(t),o=[{}];return e.components.forEach(((e,t)=>{o.push(function(e,t,n){const r=[];return Zm(e)&&r.push(qm(e.attrText,Gf(t).prop("attrText").path,n)),r.push(ek(e,t)),um(r)}(e,r.prop("components").item(t).path,n))})),um(o)}function hD(e){const{voiceId:t}=e;return{...Nu({...e,type:xu.voiceComponent,isBlocked:!1}),voiceId:t}}function vD(e,t){const{voice:n}=e;if(!n)throw new Error("No voice defined for voice component");return hD({...Lu(e,t),voiceId:t.decodeReferenceId(n)})}function ED(e){return ju(xu.voiceComponent,0,e)}function yD(e){return WC({...e,type:xu.voiceoverMetadataTrackComponentList,id:"temp:vo-meta-track"})}const SD=(0,fp.PW)((()=>[{isType:ED,encode:void 0,decode:vD}]));function ID(e,t){return yD({...qC(e,t,SD()),type:void 0})}function bD(e){return Boolean(e&&e.type===xu.voiceoverMetadataTrackComponentList)}function TD(e,t,n,r,o,i){return o!==n[r]&&(n={...n,[r]:o}),i&&(n=QC(e,t,n,r)),n}function wD(e,t,n,r,o=!0){if(i=r,Boolean(i&&i.type===xu.noAudioTrackComponentList))return TD(e,t,n,"noAudioTrack",r,o);if(bD(r))return TD(e,t,n,"LEGACY_voiceoverMetadataTrack",r,o);if(zC(r))return TD(e,t,n,"pins",r,o);if(cD(r))return TD(e,t,n,"cues",r,o);if(LC(r))return TD(e,t,n,"cards",r,o);throw new Error(`Cannot set timeline track with type ${r.type}`);var i}function CD(e,t,n,r=!0,o=!0,i=!0){const a=vk(e,t);return e=ix(e,lx(a,wD(e,t,a.timeline,n))),o&&(e=fR(e,t)),i&&(zC(n)||LC(n))&&(e=JC(e,t)),r&&(cD(n)||zC(n))&&(e=ww(e,t)),e}function _D(e,t,n,{ensureSorted:r=!0,checkValidCues:o=!0}={}){let i=Wx(e,t);const a=i;for(const s of IC(e,t)){const o=Eu(s.components,n);o!==s.components&&(i=wD(e,t,i,{...s,components:o},r))}return a===i||(e=ix(e,lx(vk(e,t),i)),r&&(e=fR(e,t)),!o||a.cues===i.cues&&a.pins===i.pins||(e=ww(e,t))),e}function AD(e,t,n,r){const o=Wx(e,t);if(hR(n)||Zm(n))return r(o.noAudioTrack,n);if(PB(n))return r(o.pins,n);if(iw(n))return r(o.cues,n);if(pU(n))return r(o.cards,n);throw new Error(`No trackComponentList for component of type ${n.type}`)}function RD(e,t,n,r,o,i){return AD(e,t,n,((n,a)=>{if(!n.components.find((e=>e.id===a.id)))throw new Error("Component does not exist on track");return n_(e,t,n,a,r,o,void 0,i)}))}function MD(e,t,n,r,o,i=!0,a=!0){return AD(e,t,n,((n,s)=>{if(n.components.find((e=>e.id===s.id)))throw new Error("Component already exists on track");return n_(e,t,n,s,r,o,i,a)}))}function DD(e,t,n){const r=nk(e,t,n);if(!r)throw new Error(`Could not find component with id: ${n}`);const[o]=r,i=AD(e,t,o,((e,t)=>function(e,t){return(0,T.ZP)(e,(e=>{const n=e.components.findIndex((e=>e.id===t));n<0||e.components.splice(n,1)}))}(e,t.id)));return CD(e,t,i)}function OD(e,t,n=!1){return n&&0!==e.offsetFromBaseTime||!function(e){return Boolean(e.tauAnchor)}(e)||(r=e.tauAnchor,o=t,void 0===r?void 0!==o:void 0===o||r!==o&&(r.tauId!==o.tauId||r.location!==o.location))?{...e,tauAnchor:t,offsetFromBaseTime:n?0:e.offsetFromBaseTime}:e;var r,o}function xD(e,t){return(0,T.ZP)(e,(e=>{e.sortTiebreaker=t}))}function kD(e,t,n=!1){return(0,T.ZP)(e,(e=>{e.offsetFromAnchor=n?t:Math.min(0,t)}))}function ND(e,t){return(0,T.ZP)(e,(e=>{e.offsetFromBaseTime=t}))}function PD(e,t,n,r){let o=n;const i=GV(e,t);if(iw(n)&&void 0!==n.sceneId){const o=VV(e).getPinAndCompositionForPinTrackId(n.sceneId);if(o){const{pin:n}=o,i=Kx(e,t,n);r=Math.max(r,i)}}const{tausData:a,getTauData:s}=i.tausAndDataLinkedSub();let c=n.tauAnchor.tauId;for(const g of a){c=g.tau.id;if(g.timeOffset+g.duration>r)break}const d=s(c);o=OD(o,{tauId:c,location:WP(e,t,c,r-d.timeOffset)});const l=Hx(d,o);if(c===n.tauAnchor.tauId){hd(l,Hx(d,n))&&!function(e,{location:t}){if(!e)return!1;const n=e.searchForTextOffset(t)?.match?.value.rangeWithPunc;return Boolean(n&&t>n.location&&t<$s(n))}(d.linkedSubAlignment,n.tauAnchor)&&(o=OD(o,n.tauAnchor))}const u=_k(e,t)-l;let f=r-l;void 0!==u&&(f=Math.min(f,u)),o=ND(o,f*(d.tau?.audioSegment?.speed??1));const m=o.tauAnchor.location,p=$x(d,o);for(const g of d.orderedComponents){if(g.id===o.id)continue;const e=$x(d,g);(g.tauAnchor.location<m&&p<e||g.tauAnchor.location>m&&p>e)&&(o=OD(o,g.tauAnchor))}return o}function LD(e,t){return(0,T.ZP)(e,(e=>{e.endAnchor=t}))}function FD(e,t,n,r,o,i=!1){P()(Number.isInteger(r),"Expected delta to be an integer"),P()(Number.isInteger(o),"Expected location to be an integer");const{tauAnchor:a}=n;let s;const c=a.location;if(o<c||o===c&&i)if(r<0){const e=Gs.get(o,-r);if($s(e)<=c)s=c-e.length;else if(e.location>=c)s=void 0;else{Zs(e,Gs.get(c,0))&&(s=e.location)}}else r>0&&o<=c&&(s=c+r);return void 0===s?n:OD(n,{tauId:a.tauId,location:s})}function UD(e,t){return(0,T.ZP)(e,(e=>{e.text=t}))}function BD(e,t){return{...e,attrText:t}}function jD(e,t){switch(t){case Jh.Sequence:case Jh.Pin:return iw(e);case Jh.Transcript:return!1;case Jh.Composition:return!0;default:return!1}}function VD(e,t,n){const{getTauData:r}=GV(e,t).tausAndDataLinkedSub();return _D(e,t,(o=>{if(function(e,t){if(e.tauAnchor.location<0||e.tauAnchor.location>t.tau.text.string.length)return!1;if(0===e.offsetFromBaseTime)return!0;const n=t.linkedSubAlignment;if(!n)return!0;const r=e.tauAnchor.location,o=$x(t,e)-t.timeOffset,i=GP(t.tau,n,o).wordOffset;if(r===i)return!0;const a=t.getTimeOffsetForTextOffset(r);return hd(t.getTimeOffsetForTextOffset(i),a)}(o,r(o.tauAnchor.tauId)))return o;const i=n?.get(o.id);if(void 0===i)throw new Error("No previous time offset for component");return PD(e,t,o,i)}))}function zD(e,t,n,r,{preserveDuration:o=!1,validateCardLayers:i=!0}={}){if(!e.isStoryboard&&r<0){const n=_P(e,t);if(n){const o=function(e,t,n,r,o){let i;const a=wP(e,t,n);let s=0,c=FP(e,t,a.id);const d=r-c,l=OP(e,t,a.id);let u=d>0;if(l){if(c=FP(e,t,a.id),EN(l)){const n=zM(l,RF(l.audioSegment,l.audioSegment.duration+d));e=Cx(e,t,Px(Lx(e,t),l.id,n,!0)),u=!1}else if(l.audioSegment&&void 0!==o){const n=Math.min(l.audioSegment.duration+d,o);if(n>0&&n!==l.audioSegment.duration){const r=$M(e,t,l.id,{offset:l.audioSegment.offset,duration:n},!0);r&&(e=r),u=!1}else u=!0}else u=!0;i=a}if(u)if(c=FP(e,t,a.id),EN(a)){const n=VM(a,RF(a.audioSegment,a.audioSegment.duration+d));e=Cx(e,t,Px(Lx(e,t),a.id,n,!0)),i=a}else{if(a.audioSegment){const n=[];for(const e of LF){const t=a.audioSegment[e];t?.fadeInDuration&&t.fadeInDuration<0&&n.push(e)}n.length>0&&(e=s_(e,t,a.id,n,{fadeInDuration:0}))}const n=QM(e,{duration:d});e=Cx(e,t,Ox(Lx(e,t),n,a.id)),i=a}if(i)return s=FP(e=sO(e,t),t,i.id),{doc:e,tauOriginalTimeOffset:c,tauNewTimeOffset:s}}(e,t,n.id,-r);o&&(e=o.doc,r=0)}}for(const[a]of tk(e,t))if(a.id===n){let n=a;if(e.isStoryboard&&PB(n)&&o){const o=dT(e,t,r+_k(e,n.sceneId));P()(void 0!==o,"Expect pin to be moved within a valid card"),e=GB(e,t,n),n=LD(n,yU(o.end))}return RD(e,t,PD(e,t,n,r),void 0,void 0,i)}return e}function GD(e,t,n,r,o,{preserveDuration:i=!1}={}){return function(e,t,n,r){for(const[o]of tk(e,t))if(o.id===n){const n=kD(o,r,e.isStoryboard);return{doc:e=RD(e,t,n),selectionLocation:Kx(e,t,n),selectionType:"time"}}}(e=zD(e,t,n,o,{preserveDuration:i,validateCardLayers:!1}),t,n,r-o)}function WD(e,t,n,r,o=!1){for(let a=n;a>=0;a--){const n=$D(e,t,a,r,o);if(n){e=n.doc;const r=n.component;return n.didWordlessMediaSplit&&bk(e,t)&&(a=gk(e,t,r).location),{doc:e,selectionRange:qD(e,t,a,r),anchoredComponent:r}}}const{tausData:i}=GV(e,t).tausAndDataForAttributedString();if(i.length>0){const o=i[i.length-1],a=o.textOffset+o.basicAttributedString.attrString.string.length;for(let i=n;i<a;i++){const n=$D(e,t,i,r,!0);if(n){e=n.doc;const r=n.component;return{doc:e,selectionRange:qD(e,t,i,r),anchoredComponent:r}}}}return{doc:e,selectionRange:Gs.get(n,0),anchoredComponent:void 0}}function HD(e,t,n,r,o=!0){const i=OD(r,n),a=i.id;let s,c;const d=n.location;for(const f of ck(e,t,n.tauId)){if(!(f.tauAnchor.location<d||f.tauAnchor.location===d&&f.offsetFromBaseTime<=r.offsetFromBaseTime)){c=f.id;break}s=f.id}const l=nk(e=MD(e,t,i,s,c,o,o),t,a);if(!l){if(iw(i))throw new LU(PU.CueOverlap);throw new Error("Added component does not exist")}const u=qb(e,t,l[0]);return{doc:e,component:l[0],selectionRange:u||Gs.get(0,0)}}function qD(e,t,n,r){const o=n,i=Xj(e,t,r).length,a=Pf(zj(r));return hR(r)||Zm(r)?Gs.get(o+i,a):Gs.get(o+i+a,0)}function $D(e,t,n,r,o=!1){let i,a=n,s=!1;if(EE(e)&&bk(e,t)){if(SB(e,t,Gs.get(n,0),!0,!0,!0)){const o=XR({doc:e,trackId:t,timeOffset:BT(e,t,n),overlapsWordlessMedia:!0});if(o&&o.afterTau){e=o.doc,o.beforeTau&&bk(e,t)&&(e=wB(e,t,o.beforeTau,o.afterTau));i=OD(r,!o.beforeTau||"\n"===o.beforeTau.text.string&&"\n"===o.afterTau.text.string?{tauId:o.afterTau.id,location:0}:{tauId:o.beforeTau.id,location:o.beforeTau.text.string.length}),e=MD(e,t,i,void 0,void 0),s=!0}}}if(a>=0&&!s){if(e.isStoryboard&&0===a&&!pU(r))return;const{tausData:n}=GV(e,t).tausAndDataForAttributedString();for(const s of n){if(a<0)break;const{renderedText:n,basicAttributedString:c,tau:d}=s,l=c.attrString.string.length;if(a<l||!o&&a===l&&!iw(r)){const o=xU(e,t,d,Gs.get(a,0)),s=o.textRange;if(o.isEntirelyInComponents&&!o.overlapsWordlessMedia)break;if(_N(d))break;const c=n.string;if(s.location>0&&$s(s)+1<c.length){const e=c.substr(s.location-1,2);if(void 0===bs.index(e))break}i=OD(r,{tauId:d.id,location:s.location});const l=i.id,u=o.componentIdsToBump&&o.componentIdsToBump.length>0?o.componentIdsToBump[0]:void 0;e=MD(e,t,i,o.previousComponent&&Bu(o.previousComponent)?o.previousComponent.id:void 0,u);const f=nk(e,t,l);if(!f){if(iw(i))throw new LU(PU.CueOverlap);throw new Error("Added component does not exist")}i=f[0];break}a-=l}}if(i)return{doc:e,component:i,length:Qj(e,t,i).length,didWordlessMediaSplit:s}}class KD extends class{constructor(){this.isInitial=!0}areEqualResults(e,t){return(0,Me.fastDeepEqual)(e,t)}apply(){const e=this.getItems(),t=this.isInitial?Gs.get(0,e.length):this.getChangedIndices();if(this.isInitial=!1,!t)return void(this.lastChangedIndices=void 0);const n=t.location,r=$s(t);let o=n>0?this.getResult(e[n-1]):void 0;for(let a=n;a<r;a++){const n=e[a],r=this.compute(n,o,t);this.setResult(n,o,r),o=r}let i=r;for(;i<e.length;i++){const n=e[i],r=this.getPrevResult(n);if(this.areEqualResults(o,r))break;const a=this.compute(n,o,t);this.setResult(n,o,a),o=a}this.lastChangedIndices=Gs.getStartEnd(n,i)}}{constructor(e){super(),this.trackData=e,this.tag={CLOCK:1}}apply(){super.apply(),Ob(this.tag)}setResult(e,t,n){e.updateMemos[this.key]={prevResult:t,result:n}}getResult(e){return e.updateMemos[this.key]?.result}getPrevResult(e){return e.updateMemos[this.key]?.prevResult}getChangedIndices(){return this.trackData.changedIndices(this.tag)}}class YD extends KD{getItems(){return this.trackData.tausAndDataForBasicAttributedString().tausData}getItem(e){return this.trackData.tausAndDataForBasicAttributedString().getTauData(e)}}class ZD extends KD{getItems(){return this.trackData.tausAndDataLinkedSub().tausData}getItem(e){return this.trackData.tausAndDataLinkedSub().getTauData(e)}}function JD(e,t){return function({done:e,value:t},n){return e?n:t}(e.next(),t)}const{lessThanOrEqualFrameCounts:QD}=s;function XD(e,t,n,r,o,i,a,s){const c=n.audioSegment,d=i.audioSegment,l=n.isBlocked===i.isBlocked;if(c&&void 0!==c.mediaRefId&&d&&c.mediaRefId===d.mediaRefId&&c.speed===d.speed&&(l||0===o.string.length||0===s.string.length)&&c.speed===d.speed&&n.ignoreAlignment===i.ignoreAlignment&&n.isScriptClip===i.isScriptClip&&!d.suppressAutoMerge&&c.channels===d.channels&&c.multicamSceneId===d.multicamSceneId&&!c.isFreezeFrame&&!d.isFreezeFrame&&!n.recordingSession&&!i.recordingSession&&!n.visual&&!i.visual&&hd(c.offset+c.duration,d.offset)&&(!e.isStoryboard||void 0===wU(e,t,a.timeOffset))){let r=hF({mediaRefId:c.mediaRefId,offset:c.offset,duration:d.offset+d.duration-c.offset,suppressAutoMerge:c.suppressAutoMerge,effects:pI(c,d),speed:c.speed});r=SF(c,r,!0,!1,!0),r=SF(d,r,!1,!0,!1),n.isScriptClip&&(o=n.text,s=i.text);let a=Cm([o,s]);if(!n.ignoreAlignment&&!n.isScriptClip){const t=vN(e,r);if(t&&!mL(t,a.string)){const e=Cm([o," ",s]);if(!mL(t,e.string))return!1;a=e}}const u=n.ignoreAlignment,f=jM(gI(Xk(zM(n,r),u),l||0!==o.string.length?n.isBlocked:i.isBlocked),a);return e=Cx(e=_D(e=UM(e,t,n.id,f),t,(e=>{const{tauAnchor:t}=e;return t.tauId===i.id?OD(e,{tauId:f.id,location:t.location+o.string.length}):e})),t,kx(Lx(e,t),i.id))}}const eO={mergers:[function(e,t,n,r,o,i,a,s){if((!r.hasAudio||r.scratchSequenceTauInfo&&!r.scratchSequenceTauInfo.tau.audioSegment?.mediaRefId)&&(!a.hasAudio||a.scratchSequenceTauInfo&&!a.scratchSequenceTauInfo.tau.audioSegment?.mediaRefId)&&Boolean(r.gapClipTau)===Boolean(a.gapClipTau)&&n.isBlocked===i.isBlocked&&!r.freezeFrameTau&&!a.freezeFrameTau&&!n.visual&&!i.visual){if(r.isScratchText&&a.isScratchText&&(!Gh(n.defaultSpeaker,i.defaultSpeaker)||"running"===n.overdubInfo?.state||"running"===i.overdubInfo?.state||"running"===r.scratchSequenceTauInfo?.tau.overdubInfo?.state||"running"===a.scratchSequenceTauInfo?.tau.overdubInfo?.state))return;if(r.gapClipTau&&a.gapClipTau&&(void 0!==wU(e,t,a.timeOffset)||cB(r)||cB(a)))return;if(n.replacedContentSceneId||i.replacedContentSceneId)return;const o=Cm([n.text,i.text]);let s=jM(n,o),c=0;return r.gapClipTau&&a.gapClipTau&&(s=zM(s,RF(r.gapClipTau.audioSegment,r.gapClipTau.audioSegment.duration+a.gapClipTau.audioSegment.duration)),c=r.gapClipTau.audioSegment.duration),Cx(e=_D(e=UM(e,t,n.id,s),t,(e=>{const{tauAnchor:t}=e;if(t.tauId===i.id){let r=OD(e,{tauId:s.id,location:t.location+n.text.string.length});return c>0&&(r=ND(r,r.offsetFromBaseTime+c)),r}return e})),t,kx(Lx(e,t),i.id))}},XD,function(e,t,n,r,o,i,a,s){if(r.infinitelyExtendableTau)return;const c=n.audioSegment,d=EE(e);if(!n.isScriptClip&&0===o.string.length&&(!d||!c||!dB(c.duration,!0,r.linkedSubAlignment))||c&&c.duration<=0){const r=o.string.length;return r>0&&(e=UM(e,t,i.id,jM(i,Cm([o,s])))),Cx(e=_D(e,t,(e=>{const{tauAnchor:t}=e;return t.tauId===n.id?OD(e,{tauId:i.id,location:t.location}):r>0&&t.tauId===i.id?OD(e,{tauId:i.id,location:t.location+r}):e})),t,kx(Lx(e,t),n.id))}},function(e,t,n,r,o,i,a,s){if(!n.isScriptClip&&!i.isScriptClip&&!r.infinitelyExtendableTau&&!a.infinitelyExtendableTau){if(!a.hasAudio&&!a.isOverdub){let a=!1;if(r.hasRealAudio&&(a=!0,Zh.enumerateWords(s.string,(()=>(a=!1,!0)))),a=a||void 0===_s.index(s.string),a){const r=Cm([o,s]),a=jM(n,r);return Cx(e=_D(e=UM(e,t,n.id,a),t,(e=>{const{tauAnchor:t}=e;return t.tauId===i.id?OD(e,{tauId:a.id,location:o.string.length+t.location}):e})),t,kx(Lx(e,t),i.id))}}if(!r.hasAudio&&!r.isOverdub){let r=!1;if(a.hasRealAudio&&(r=!0,Zh.enumerateWords(o.string,(()=>(r=!1,!0)))),r=r||void 0===_s.index(o.string),r){let r="";const c=a.subAlignment;!c||o.string.endsWith(" ")||s.string.startsWith(" ")||mL(c,o.string+s.string)||(r=" ");const d=Cm([o,r,s]),l=jM(i,d);return e=_D(e=UM(e,t,i.id,l),t,(e=>{const{tauAnchor:t}=e;return t.tauId===n.id?OD(e,{tauId:l.id,location:t.location}):t.tauId===l.id?OD(e,{tauId:l.id,location:o.string.length+r.length+t.location}):e})),Cx(e,t,kx(Lx(e,t),n.id))}}}},function(e,t,n,r,o,i,a,s){if(EE(e)&&""===s.string.trim()&&!o.string.endsWith(" ")&&!o.string.endsWith("\n")&&dB(i.audioSegment?.duration||0,!0,void 0)){const r=jM(n,Cm([o," "]));return e=UM(e,t,n.id,r)}if((r.hasRealAudio||a.hasRealAudio)&&o.string.length>0&&s.string.length>0&&!i.isScriptClip){const r=o.string.charAt(o.string.length-1),a=s.string.charAt(0);if(!bs.contains(r)&&!bs.contains(a)){const r=Ms.index(s.string),a=bs.index(s.string);if(void 0!==r&&void 0!==a&&a<r){const[r,c]=Lm(s,a),d=jM(n,Cm([o,r])),l=jM(i,c);return e=UM(e,t,n.id,d),_D(e=UM(e,t,i.id,l),t,(e=>{const{tauAnchor:t}=e;return t.tauId===l.id?t.location<a?OD(e,{tauId:d.id,location:d.text.string.length+t.location}):OD(e,{tauId:l.id,location:t.location-a}):e}))}{const n=jM(i,Cm([" ",s]));return _D(e=UM(e,t,i.id,n),t,(e=>{const{tauAnchor:t}=e;return t.tauId===n.id?FD(0,0,e,1,0,!0):e}))}}}}],finalMergers:[function(e,t,n,r,o,i,a,s){const c=EE(e),d=s.string.length,l=i.audioSegment;if((!r.gapClipTau||0!==d||l)&&!a.infinitelyExtendableTau&&(!i.isScriptClip&&0===d&&(!c||l&&!dB(l.duration,!0,a.linkedSubAlignment))||l&&l.duration<=0)){const r=o.string.length;return d>0&&(e=UM(e,t,n.id,jM(n,Cm([o,s])))),Cx(e=_D(e,t,(e=>{const{tauAnchor:t}=e;return t.tauId===i.id?OD(e,{tauId:n.id,location:t.location+r}):e})),t,kx(Lx(e,t),i.id))}}],scriptClipMergers:[XD]};function tO(e,t,n,r,o,i){const{tau:a}=n,{tau:s}=r;if(_N(a)||_N(s))return;const c=n.renderedText,d=r.renderedText,l=a.isScriptClip&&s.isScriptClip?i:o;for(const u of l){const o=u(e,t,a,n,c,s,r,d);if(void 0!==o)return o||void 0}}function nO(e,t,n,r,o){let i=!1;const a=n.tau,s=a.id;if(_N(a))return{doc:e,didMerge:i};let c,d=!1;if(a.isScriptClip){if(a.audioSegment&&!QD(a.audioSegment.duration,0))return{doc:e,didMerge:i};d=!0,c=QM(e,{id:a.id})}else if(n.gapClipTau){const e=QD(n.gapClipTau.audioSegment.duration,0),t=0===a.text.string.length;(e||t)&&(d=!0,e&&(c=zM(a,RF(n.gapClipTau.audioSegment,1))),t&&(c=jM(c??a,bm(" "))))}if(d){if(n.orderedComponents.length>0)if(o)e=_D(e,t,(e=>e.tauAnchor.tauId===s?OD(e,{tauId:o.tau.id,location:0}):e));else{if(!r)return c&&(e=UM(e,t,s,c),i=!0),{doc:e,didMerge:i};{const n=r.renderedText.string.length;e=_D(e,t,(e=>e.tauAnchor.tauId===s?OD(e,{tauId:r.tau.id,location:n}):e))}}return i=!0,{doc:e=BM(e,t,s),didMerge:i}}if(0===a.text.string.length&&a.audioSegment&&a.audioSegment.duration>0){const n=jM(a,bm(" "));e=UM(e,t,a.id,n)}return{doc:e,didMerge:i}}function rO(e,t,n,r,o){if(!t)return{tau:e,lastSpeaker:void 0,updatedComponents:void 0};const i=t.length;let a=e.text;const s=a.string,c=s.length,d=[],l=gc(s,"\n");let u=JD(l,c);for(let v=0;v<t.ranges.length;v++){const e=Wg(t.wordArrayView,v).speaker,{location:n}=t.ranges[v],i=void 0!==e?e:1;n>=u?u=JD(l,c):void 0===r||Gh(i,r)||o?.endsWith("\n")||d.push(n),r=i}const f=i>0?t.ranges[i-1].location:0,m=s.lastIndexOf("\n");-1!==m&&f<m&&(r=void 0);let p=e;const g={};let h=!1;if(d.length>0){const t=[];let r=0;for(const e of d)t.push(km(a,r,e),"\n"),r=e;t.push(km(a,r)),a=Cm(t),p=jM(e,a);for(const o of n){if(o.tauAnchor.tauId!==e.id)throw new Error("component has unexpected tau id");const t=o.tauAnchor.location,{match:n,previous:r}=rh(d,(e=>oh(e-t))),i=n??r;if(!i)continue;const a=i.index+1;g[o.id]=OD(o,{tauId:e.id,location:t+a}),h=!0}}return{tau:p,lastSpeaker:r,updatedComponents:h?g:void 0}}const oO=em("ensureValidSpeakers");function iO(e,t,n,{mergers:r,finalMergers:o,scriptClipMergers:i}){let a,s=!1;const c=GV(e,t),{tausData:d}=c.tausAndDataLinkedSub(),l=d.length;let u=0,f=l;const m=c.changedIndices(n);m&&(u=m.location,f=Math.min(l,$s(m)+1));for(let p=u;p<f;p++){const n=d[p];if(a=a||d[p-1],a){const c=tO(e,t,a,n,r,i)||(p===l-1?tO(e,t,a,n,o,[]):void 0);c&&(e=c,s=!0)}if(s)break;const c=p+1<d.length?d[p+1]:void 0,{didMerge:u,doc:f}=nO(e,t,n,a,c);if(e=f,u&&(s=!0),a=n,s)break}return{doc:e,didMerge:s}}class aO extends ZD{constructor(){super(...arguments),this.key="ValidSpeakerUpdater"}areEqualResults(e,t){return void 0===e||void 0===t?e===t:e.tau===t.tau&&e.lastSpeaker===t.lastSpeaker&&(0,Me.fastDeepEqualJson)(e.updatedComponents,t.updatedComponents)}compute(e,t,n){return function(e,t,n){const{linkedSubAlignment:r,tau:o,orderedComponents:i,key:a}=e;return qf(rO,a,oO,o,r,i,t,n)}(e,t?.lastSpeaker,t?.tau.text.string)}}function sO(e,t,n=!0,r=!0){e=function(e,t,n){const r=GV(e,t).getTag("mergeTaus");for(;;){const o=iO(e,t,r,n);if(e=o.doc,!o.didMerge)break}return Ob(r),e}(e,t,eO);const o=GV(e,t),{track:i}=o,{tausData:a}=GV(e,t).tausAndDataLinkedSub(),s={},c=i.timeline.superTau.taus;o.ensureValidSpeakerUpdate.apply();const d=o.ensureValidSpeakerUpdate.lastChangedIndices;if(d){const n=$s(d),r=c.slice(d.location,n),i=hu(r,((e,t)=>{const n=a[d.location+t],r=o.ensureValidSpeakerUpdate.getResult(n);return r?.updatedComponents&&Object.assign(s,r?.updatedComponents),r?.tau||e}));r!==i&&(e=Cx(e,t,Ax(Lx(e,t),d,i))),e=_D(e,t,(e=>s[e.id]||e))}e=function(e,t){const n=GV(e,t),{tausData:r,taus:o}=n.tausAndDataLinkedSub(),i=n.getTag("cleanupTauFades");let a=0,s=r.length;const c=n.changedIndices(i);c&&(a=Math.max(0,c.location-1),s=Math.min(s,$s(c)+1));const d=new Map,{projectId:l}=e;for(let u=a;u<s;u++){const e=r[u],{audioSegment:t,ignoreAlignment:n}=e.tau;if(t&&!e.gapClipTau&&!n)for(const r of LF){const e=t[r];if(!e)continue;const{fadeInDuration:n,fadeOutDuration:i,fadeInShape:a,fadeOutShape:s,headTransitionEffect:c,tailTransitionEffect:f}=e;d_(l,u,o,r,d,n,i,a,s,"videoFades"===r?c:void 0,"videoFades"===r?f:void 0,!0)}}return e=a_(e,t,LF,d),Ob(i),e}(e=ww(e,t),t);const l=Lx(e,t),u=l.taus.length>0?l.taus[l.taus.length-1]:void 0,f=Boolean(u&&EN(u)),m=0===l.taus.length;if(f||m)e=Cx(e,t,Rx(l,JM()));else if(1===l.taus.length){const n=l.taus[0];n.audioSegment&&QD(n.audioSegment.duration,0)&&(e=UM(e,t,n.id,zM(n,void 0)))}if(r&&e.isStoryboard&&i.type===Jh.Composition)if(m)try{e=EM(e,i.id,0).doc}catch(p){}else e=1===l.taus.length&&u&&AN(u)&&!os(tk(e,t),(([e])=>!pU(e)&&e.tauAnchor.tauId===u.id))?fO(e=Cx(e,t,xx(l,vM())),t):fO(e,t);return n&&(e=function(e,t,n){const r=SG(e)[t];if(void 0===r)return e;return cO(e,r,n)}(e,t,!0)),r&&e.isStoryboard&&i.type===Jh.Sequence&&(e=function(e,t){if(!e.isStoryboard||vk(e,t).type!==Jh.Sequence)return e;const n=SG(e)[t];if(n)for(const r of Wk(e,n,!1))e=fO(e,r.id);return e}(e,i.id)),e=XC(e,t)}function cO(e,t,n,r){const o=e,i=Vk(e,t),a=i.audio.duration;Mg(i)&&(e=function(e,t){const n=CM(e,t);if(!n)return e;const{videos:r,scratch:o}=n;if(!r)return e;const i=BP(e,o.trackId,o.tauId);if(i<=0)return e;for(const{trackId:a,tauId:s}of r){const t=wP(e,a,s);wN(t)?e=IM(e,a,t,t.audioSegment.offset,i):t.audioSegment&&t.audioSegment.duration>0&&(e=ZM(e,a,s,t.audioSegment.duration/i))}return e}(e,i.id));let s=Vk(e=MA(e,t),t);Mg(s)&&(e=function(e,t,n){let r=t.video?sy(t.audio.duration,t.video):t.audio.duration;return 0===r&&(r=t.audio.duration),r===n?e:SO(e,t.id,((e,t)=>zM(e,RF(AF(e.audioSegment,0),r))),!0)}(e,s,a));const c=e!==o;s=Vk(e=function(e,t,n){const r=dm(e,t),o=DA[r],i=Eb(e,t,void 0,void 0,!0);if(!n){if(void 0!==jk(e,t).audio.localAssetKey&&!o)return DA[r]=i,e;if((0,Me.fastDeepEqual)(i,o))return e}DA[r]=i;const a=i.videoMetadata?".mp4":".m4a";return vO(e,t,"localAssetKey",`sequence-${Ps()}${a}`)}(e=xA(e,t,{tiebreakWithLoudness:!0,energyHz:FL,shouldRefreshTimelineTaus:n,createNewVoices:r}),t,c),t);const d=s.audio.duration;for(const l of s.audio.trackSceneIds){const n=vk(e,l);if(n.videoMetadata){if(e=EO(e,t,{...n.videoMetadata,duration:d}),!s.video)for(const{id:r,videoMetadata:o}of Wk(e,t,!1))o||(e=fx(e,r,n.videoMetadata));break}}return e}function dO(e,t,n){return os(bP(e,t),(e=>Boolean(e.audioSegment&&void 0!==e.audioSegment.mediaRefId&&n.has(e.audioSegment.mediaRefId))))}function lO(e,t,n){if(0===t.size)return e;const r=e,o=new Set(Ja(t,(t=>Ag(Pp(e,t)))));for(const{id:a}of Ja(e.sequenceScenes,(({id:n})=>dO(e,n,t)))){const t=SG(e)[a];void 0!==t&&o.add(t)}for(const a of o)e=cO(e,a,!1,n);const i=r!==e;for(const{id:a}of Ja(function*(e){yield*Ck(e),yield*e.sequenceScenes,yield*Ik(e),yield*e.pinScenes}(e),(({id:n})=>dO(e,n,t))))e=sO(e,a,!1);return i&&(e=uO(e,r,n)),e}function uO(e,t,n){if(e===t)return e;const r=t.mediaLibrary.mediaRefs,o=wp(r);if(r===e.mediaLibrary.mediaRefs)return e;const i=new Set;for(const a of e.mediaLibrary.mediaRefs){const e=a.id;o(e)!==a&&i.add(e)}return lO(e,i,n)}function fO(e,t){if(!e.isStoryboard)return e;if(!bk(e,t))return e;const n=Wx(e,t).cards.components;if(0===n.length){const n=uU();return WD(e,t,0,n).doc}try{IT(e,t)}catch(r){const[o]=n,i=_P(e,t);if(i){const n=vU(e=RD(e,t,OD(PD(e,t,o,0),{tauId:i.id,location:0})),t,o.id);n.tauAnchor.tauId===o.tauAnchor.tauId&&n.tauAnchor.location===o.tauAnchor.location&&n.offsetFromAnchor===o.offsetFromAnchor&&n.offsetFromBaseTime===o.offsetFromBaseTime||(e=_D(e,t,(r=>PB(r)&&CU(e,t,r,o)?uM(0,0,n,r):r)))}}return e}A.logging.groupLogger("descriptmodel/mediareferencemutators");function mO(e,t,n){if(Lp(e,t.id))throw new Error(`Cannot add ref with same id as existing ref: ${t.id}`);for(const{assetKey:i}of e.mediaLibrary.mediaRefs)if(i===t.assetKey)throw new Error(`Cannot add ref with same assetKey as existing ref: ${i}`);const r=I_(e.mediaLibrary.mediaRefs,t.displayName);r!==t.displayName&&(t={...t,displayName:r});const o=Up(e,t);return e=function(e,t,n){const r=pv(t.id);if(n)return Zv(e,r,n.folderId,n.toIndex);const o=Hv(e,t);return Zv(e=o.doc,r,o.folderId)}(e=TG(e,{...e.mediaLibrary,mediaRefs:o}),t,n),t.voiceover&&sx(e,t.id)||e}function pO(e,t,n=!1){const r=Pp(e,t.id),o=r.audio?.duration,i=t.audio?.duration;if(!n&&void 0!==o&&void 0!==i&&!Ag(t)&&!hd(o,i)&&t.assetJson){if(0!==o&&Math.abs(o-i)>=3&&!pd(o,i))throw new Error("Cannot update media reference, durations do not match");e=SO(e,t.id,(e=>i<e.audioSegment.offset+e.audioSegment.duration?JM({...e,audioSegment:RF(e.audioSegment,i-e.audioSegment.offset)}):e))}const a=I_(Fp(e,t.id),t.displayName);if(a!==t.displayName&&(t={...t,displayName:a}),e=TG(e,hE(e.mediaLibrary,"mediaRefs",Bp(e,t))),Ag(t))for(const s of Wk(e,t.id,!1))e=fO(e,s.id);if(!wg(r)&&wg(t))for(const s of Wk(e,t.id,!1))s.videoMetadata||(e=vx(e,s.id));if(Bg(r)!==Bg(t)||!Pg(r)&&Pg(t)&&!Ag(t)){const n=Hv(e,t),r=n.folderId,o=kv((e=n.doc).rootMediaFileFolder||e.rootFolder,r);e=Qv(e,[t.id],r,o?.items.length??0)}return e}function gO(e,t,n,r,o=!1){const i=function(e,t){const n=Pp(e,t);if(!n.video)throw new Error("MediaReference does not have video");return n}(e,t);return e=pO(e,(0,T.ZP)(i,(e=>{e.video[n]=r})),o),"backgroundMaskRequested"!==n&&"eyeContactRequested"!==n||(e=lO(e,new Set([t]))),e}function hO(e,t,n,r){const o=function(e,t){const n=Pp(e,t);if(!n.image)throw new Error("MediaReference does not have image");return n}(e,t);return e=pO(e,(0,T.ZP)(o,(e=>{e.image[n]=r}))),"backgroundMaskRequested"===n&&(e=lO(e,new Set([t]))),e}function vO(e,t,n,r,o=!1,i=!0){const a=jk(e,t);if(e=pO(e,(0,T.ZP)(a,(e=>{e.audio[n]=r})),o),"trackSceneIds"===n&&r)for(const s of r)e=sO(e,s);return!i||"speechEnhanceEnabled"!==n&&"studioSoundIntensity"!==n&&"energies"!==n||(e=lO(e,new Set([t]))),e}function EO(e,t,n){const r=Pp(e,t);return(0,Me.fastDeepEqualJson)(n,r.video)||(e=pO(e,{...r,video:n})),e}function yO(e,t,n){const r=jk(e,t),o=Boolean(r.voiceover);if(e=pO(e,(0,T.ZP)(r,(e=>{const t={...r.voiceover,...n};let o=r.voiceover?.isReceiptProcessing;void 0===t.transcriptReceiptId?o=void 0:t.transcriptReceiptId!==r.voiceover?.transcriptReceiptId&&(o=!0);const i=KL({...t,isReceiptProcessing:o});e.voiceover=i}))),!o){e=sx(e,t);for(const n of e.sequenceScenes)ts(kk(e,n.id),t)&&(e=sO(e,n.id))}return e}function SO(e,t,n,r=!1){for(const o of Wk(e,t,r)){const r=o.id,i=bP(e,r),a=hu(i,(e=>e.audioSegment?.mediaRefId===t?n(e,o):e));a!==i&&(e=Cx(e,r,xx(Lx(e,r),a)))}return e}function IO(e,t){const n=Pp(e,t);return _g(n)?SO(e=pO(e,f_(f_(n,"alignment",void 0),"recognition",void 0)),t,(e=>GM(jM(e,Im),!0)),!0):e}function bO({id:e=Ps(),name:t="",color:n=TS}){return{id:e,name:t,color:n}}function TO({id:e,name:t,color:n}){return bO({id:e,name:t,color:n})}function wO({id:e,name:t,color:n}){return{type:xu.highlighter,id:e,name:t,color:n}}const CO=function(e,t){return e.id!==t.id?(0,Me.fastDeepEqual)({...e,id:t.id},t):(0,Me.fastDeepEqual)(e,t)},_O=yS("rgba(250, 152, 5, 0.25)"),AO=yS("rgba(255, 27, 122, 0.25)"),RO=yS("rgba(255, 73, 27, 0.25)"),MO=yS("rgba(0, 155, 0, 0.25)"),DO=yS("rgba(0, 170, 255, 0.15)"),OO=yS("rgba(170, 128, 255, 0.25)"),xO=[bO({id:"0x:highlight:sand",name:"Sand",color:_O}),bO({id:"0x:highlight:rose",name:"Rose",color:AO}),bO({id:"0x:highlight:salmon",name:"Salmon",color:RO}),bO({id:"0x:highlight:mint",name:"Mint",color:MO}),bO({id:"0x:highlight:seaglass",name:"Seaglass",color:DO}),bO({id:"0x:highlight:violet",name:"Violet",color:OO})];const kO=new Map([["0x:highlight:sand",hS("FCE8A8")],["0x:highlight:rose",hS("FFBDD8")],["0x:highlight:salmon",hS("FFD1B9")],["0x:highlight:mint",hS("B4F0C2")],["0x:highlight:seaglass",hS("B4E5FA")],["0x:highlight:violet",hS("D4C7FC")]]),NO=new Map([["0x:highlight:sand","Yellow"],["0x:highlight:rose","Red"],["0x:highlight:salmon","Orange"],["0x:highlight:mint","Green"],["0x:highlight:seaglass","Blue"],["0x:highlight:violet","Purple"]]);function PO(e,t){for(const n of e.highlighters)if(CO(n,t))return n}var LO=n(7119),FO=n.n(LO);let UO={stringMd5HexSync:function(e){return FO().hash(e)}};Error;function BO(e,t,n,r,o,i,a,s){if(0===t.length&&0===e.length)return;const c={...i,[PL]:!0};let d=[];const l=[],u=[],f=[],m=[],p=[],g=[];let h;const v=function(e,t,n){const r=[...e];for(const c of t)if(PB(c)&&"placeholder"!==Ky(n,c.sceneId))for(const e of bP(n,c.sceneId))r.push(e);let o=n;const i=Cy();o=rx(o,i,void 0),o=Cx(o,i.id,xx(Lx(o,i.id),r));const a=pb(o,i.id),s=new Map;for(const{segments:c}of _I(a))for(const e of c)if(e.type===dS.Clip&&void 0!==e.audioSegment.mediaRefId){const t=e.audioSegment.mediaRefId,n=TF(e.audioSegment),r=s.get(t)||[];r.push(n),s.set(t,r)}for(const c of r)if(c.audioSegment&&void 0!==c.audioSegment.mediaRefId){const e=c.audioSegment.mediaRefId,t=Pp(n,e);if(t.audio&&t.audio.trackSceneIds){const t=TF(c.audioSegment),n=s.get(e)||[];n.push(t),s.set(e,n)}}return s}(e,t,r);for(;;){const i=new pE(c);i.allowExternals=!0;const E=i.encodeReferencables(f),y=[];[...l,...d].forEach((e=>{if(!Ag(e)&&!e.assetJson&&!Dg(e))throw new Error(`no asset json for ${e.displayName} (${e.assetKey})`);let t;Ag(e)&&(t=Eb(r,e.id,void 0,void 0));const n=TI(r),o=bG(r,e.id),a={mediaRef:i.encodeReferencable(nF(e,i)),ranges:(v.get(e.id)??[]).map((e=>{let r;if(t){if(MI(t,e)){const e=wI(t,n);r=UO.stringMd5HexSync(e)}}return{timeRange:e,simpleTimelineHashCode:r}})),assetJson:e.assetJson,transcript:o?i.encodeReferencable(Dy(o,i)):void 0};y.push(a)}));const S={sourceTrack:o?i.encodeReferencable({id:o.id,type:xu.track}):void 0,voices:E,mediaRefsCopyData:y,highlighters:i.encodeReferencables(u.map(wO)),restorableTracks:i.encodeReferencables(g.map((e=>Dy(e,i)))),sequenceTracks:i.encodeReferencables(p.map((e=>Dy(e,i)))),pinTracks:i.encodeReferencables(m.map((e=>Dy(e,i)))),...VO(e,i),...GO(t,i),projectId:r.projectId,videoMetadata:o?.videoMetadata,layerOrder:oS(n,i),storyboardCues:s?s.map((e=>by(e,i))):void 0,source:a};if(!i.hasInvalidDeferredReferences&&!i.hasExternalReferences)return S;const I=new Map([...i.externalReferences.entries(),...i.invalidDeferredReferences.entries()]);for(const[e,n]of I){if(h&&h.has(e))throw new Error(`Could not resolve external: ${e} ${n}`);switch(n){case xu.speaker:f.push(fg(r,e));break;case xu.highlighter:u.push(Eg(r,e));break;case xu.mediaAudioReference:case xu.mediaVoiceoverReference:{const t=Pp(r,e);d.unshift(t);const n=t.audio?.roomtoneRefId;if(void 0!==n&&!l.some((e=>e.id===n))){const e=Pp(r,n);l.unshift(e)}break}case xu.track:{const t=vk(r,e);if(t.type===Jh.Sequence)p.push(t);else if(t.type===Jh.Pin)m.push(t);else{if(t.type!==Jh.Restorable)throw new Error("Unrecognized external track type");g.push(t)}break}case xu.cardBoundaryComponent:t=t.map((t=>PB(t)&&"cardBoundary"===t.endAnchor?.type&&t.endAnchor.cardBoundaryId===e?LD(t,void 0):t));break;default:throw new Error(`Unexpected type encountered when encoding references for export: ${n}`)}}h||(d=jO(o,d)),h=new Set(I.keys())}}function jO(e,t){const n=e&&e.videoMetadata;if(n){const e=t.findIndex((e=>(0,Me.fastDeepEqualJson)(e.video,n)));if(e>0)return[t[e],...t.slice(0,e),...t.slice(e+1)]}return t}function VO(e,t){return{copiedTaus:bx(e,t)}}const zO=(0,fp.PW)((()=>[vR(),LB(),Jm(),aw(),gU()]));function GO(e,t){return{copiedComponents:fu([...e.filter((e=>pU(e))),...e.filter((e=>!pU(e)))],(e=>Fu(zO(),e,t)))}}function WO(e,t,n){if(n.audio.trackSceneIds.length!==t.audio.trackSceneIds.length)throw new Error("Different number of tracks in imported/existing sequence");for(const[r,o]of function*(...e){const t=e.map(ds);for(;;){const e=[];for(const n of t){const t=n.next();if(t.done)return;e.push(t.value)}yield e}}(n.audio.trackSceneIds,t.audio.trackSceneIds))e.set(r,o)}function HO(e,t,n,r){const o=new Map,i=[],a=[],s=new Map;for(const{mediaRef:c,transcript:d}of n){const n=VL(t.decodeReferencable(c),t),l=Cp(e.mediaLibrary.mediaRefs,(({assetKey:e})=>e===n.assetKey));if(!l)throw new Error(`Could not find ref with matching asset key: ${n.assetKey}`);if(r||!kg(l)&&!kg(n))t.rebindDecodeReferenceId(n.id,l.id);else{i.push({...n,assetKey:n.id});const e=Nk(n);void 0!==e&&n.voiceover?.metadata.alignment&&o.set(n.id,{words:n.voiceover.metadata.alignment,timeRanges:[{offset:0,duration:e}]}),d&&a.push(xy(t.decodeReferencable(d),t))}Ag(n)&&Ag(l)&&WO(s,l,n)}return{newMediaReferenceAlignments:o,newMediaReferences:i,newTranscripts:a,sequenceTrackRebindingMap:s}}function qO(e,t){const n={};for(const{mediaRef:o,assetJson:i}of t)i&&(n[Lk(o)]=i);const r=new gE(e.projectId,{},n,!0);return r.createNewIds=!0,r}function $O(e,t,n){const{voices:r=[],sourceTrack:o}=n;o&&t.decodeReferencable(o);const i=[];for(const a of t.decodeReferencables(r)){const n=N_(e,a.name);if(n)t.rebindDecodeReferenceId(a.id,n.id);else{const e=(0,T.Uy)(a,(e=>{e.id=Ps()}));i.push(e),t.rebindDecodeReferenceId(a.id,e.id)}}return{newVoices:i}}function KO(e,t,n,r,o,i){const{projectId:a,highlighters:s=[],copiedComponents:c=[],copiedTaus:d=[],pinTracks:l=[],sequenceTracks:u=[],restorableTracks:f=[]}=n,m=[];for(const I of t.decodeReferencables(s)){const n=TO(I),r=PO(e,n);if(r)t.rebindDecodeReferenceId(n.id,r.id);else{const e=rv(n,Ps());m.push(e),t.rebindDecodeReferenceId(n.id,e.id)}}const p=t.decodeReferencables(f).map((e=>Py(e,t))),g=r?t.decodeReferencables(u).map((e=>Ny(e,t))).filter((({id:e})=>r.has(e))):[];for(const[I,b]of o)t.rebindDecodeReferenceId(I,b);const h=t.decodeReferencables(l).map((e=>ky(e,t))),v=t.decodeReferencables(d).map(((e,n)=>{const r=rD(e,t),o=i.get(d[n].id);return void 0!==o?{...r,replacedContentSceneId:o}:r}));let E;if(n.sourceTrack){const e=t.decodeReferenceId(n.sourceTrack.id);E=(0,T.Uy)((t=>{for(const n of t.layers)n.sourceSceneId===e&&(n.sourceSceneId=Gw)}))}const y=c.map((e=>{const n=Uu(zO(),e,t);return pU(n)&&E?E(n):pU(n)||PB(n)?n:{...n,id:Ps()}}));let S;return n.storyboardCues&&(S=n.storyboardCues.map((e=>({...Ty(e,t),id:Ps()})))),{taus:v,components:y,newPinTracks:h,newHighlighters:m,sourceProjectId:a,newSequenceTracks:g,newRestorableTracks:p,layerOrder:iS(n.layerOrder,t),storyboardCues:S}}function YO(e,{taus:t,components:n,newPinTracks:r,layerOrder:o,storyboardCues:i},a,s=!1){let c=e;if(r)for(const y of r)c=rx(c,y,void 0);const d=BO(t,n,o,c,void 0!==a?vk(e,a):void 0,{},void 0,i);if(!d)throw new Error("Could not generate copy data to duplicate track");const{newPinTracks:l,taus:u,components:f,newVoices:m,newHighlighters:p,newMediaReferences:g,newSequenceTracks:h,layerOrder:v,storyboardCues:E}=function(e,t,n){const{mediaRefsCopyData:r=[],videoMetadata:o}=t,i=qO(e,r),a={...$O(e,i,t),...HO(e,i,r,n)},s=a.newMediaReferences&&Fk(a.newMediaReferences),c=new Map;for(const l of t.copiedTaus)void 0!==l.replacedContentSceneId&&c.set(l.id,l.replacedContentSceneId);const d={...a,...KO(e,i,t,s,a.sequenceTrackRebindingMap,c),videoMetadata:o};return i.validateDeferredDecodedIds(),d}(e,d,s);if(m.length>0)throw new Error("Taus and components should not contain voices not present in document");if(p.length>0)throw new Error("Taus and components should not contain highlighters not present in document");if(s&&g.length>0)throw new Error("Taus and components should not contain media refs not present in document");if(!s&&g.some((e=>!kg(e))))throw new Error("Taus and components should not contain non-overdub media refs not present in document");for(const y of g)e=mO(e,y);for(const y of l)e=rx(e,y);for(const y of h)e=rx(e,y);return{doc:e,taus:u,components:f,layerOrder:v,storyboardCues:E}}function ZO(e,t,n){return Ap(e,Array.from(function*(e,t){if(e===t)return;const n=wp(e),r=wp(t);for(const o of Rp(e,t,r)){const e=n(o),t=r(o);if(e)if(t){if(e.timeline.pins.components===t.timeline.pins.components)continue;const n=new Set(t.timeline.pins.components.map((e=>e.sceneId)));for(const t of e.timeline.pins.components)n.has(t.sceneId)||(yield t.sceneId)}else for(const n of e.timeline.pins.components)yield n.sceneId}}(t,n)),!0)}function JO(e,t,n,r,o){return void 0===t||0===t.length?t:Ap(t,Array.from(function*(e,t,n,r){if(t===n)return;const o=wp(t),i=wp(n),a={...e,sequenceScenes:r};for(const s of Rp(t,n,i)){const t=o(s),n=i(s);if(t)if(n){if(t.timeline.superTau.taus===n.timeline.superTau.taus)continue;const r=new Set(n.timeline.superTau.taus.map((e=>PM(a,n.id,e.id))).filter((e=>void 0!==e)));for(const n of t.timeline.superTau.taus){const o=PM(e,t.id,n.id);o&&!r.has(o)&&(yield o)}}else for(const r of t.timeline.superTau.taus){const n=PM(e,t.id,r.id);n&&(yield n)}}}(e,n,r,o)),!0)}function QO(e,t){return hu(e,(e=>{const n=e.timeline,r=n.superTau.taus,o=hu(r,(e=>{const n=e.audioSegment?.multicamSceneId;return e.audioSegment&&void 0!==n&&t.has(n)?VM(e,DF(e.audioSegment,void 0)):e}));return o===r?e:lx(e,zx(n,xx(n.superTau,o)))}))}function XO(e,t){if(e===t)return;const n=new Set(function*(e,t){if(e===t)return;const n=wp(t);for(const{id:r}of e)n(r)||(yield r)}(e,t));return 0!==n.size?n:void 0}function ex(e,t,n,r,o,i){o=ZO(o,e.compositions,t),t=function(e,t,n,r){const o=XO(n,r);if(!o)return t;const i=VV(e),a=new Set(es(o,(e=>i.getPinAndCompositionForPinTrackId(e)?.composition.id)));return hu(t,(e=>{if(!a.has(e.id))return e;const t=e.timeline.cues.components,n=vu(t,(e=>void 0===e.sceneId||!o.has(e.sceneId)));return n===t?e:lx(e,(r=e.timeline,i="cues",(s={...e.timeline.cues,components:n})===r[i]?r:{...r,[i]:s}));var r,i,s}))}(e,t,e.pinScenes,o);const a=XO(e.sequenceScenes,r);a&&(e.isStoryboard&&(t=function(e,t){return hu(e,(e=>{const n=e.timeline.cards.components,r=hu(n,(e=>{const{layers:n}=e;return hE(e,"layers",vu(n,(e=>!(void 0!==e.sequenceSceneId&&"all"!==e.sequenceSceneId&&t.has(e.sequenceSceneId)))))}));return r!==n?lx(e,{...e.timeline,cards:{...e.timeline.cards,components:r}}):e}))}(t,a)),t=QO(t,a),o=QO(o,a)),e.isStoryboard&&(t=function(e,t){const n=wp(t),r=new Set(Rp(e,t,n));return hu(t,(e=>{if(!r.has(e.id)||!e?.storyboardCues)return e;const t=new Set;for(const r of e.timeline.cards.components)for(const e of r.layers)t.add(e.id);const n=new Set;for(const r of e.storyboardCues)t.has(r.anchor.layerId)||n.add(r.id);if(0===n.size)return e;const o=e.storyboardCues.filter((e=>!n.has(e.id)));return{...e,storyboardCues:o}}))}(e.compositions,t)),i=JO(e,i,e.compositions,t,r);let s=e.rootCompositionFolder||e.rootFolder,c=e.rootSceneFolder;if(0===t.length){const n=Cy();t=[n],s=(0,T.ZP)(s,(e=>{Nv(e,mv(n.id))})),c=(0,T.ZP)(e.rootSceneFolder,(e=>{Pv(e,n.id)})),e.isStoryboard&&(t=(e=Ex(e={...e,compositions:t},n.id,{isVideo:!1})).compositions)}return t===e.compositions&&n===e.transcripts&&r===e.sequenceScenes&&o===e.pinScenes&&i===e.restorableScenes&&(e.rootCompositionFolder&&s===e.rootCompositionFolder||s===e.rootFolder)&&c===e.rootSceneFolder?e:{...e,rootFolder:e.rootCompositionFolder?e.rootFolder:s,rootCompositionFolder:e.rootCompositionFolder?s:void 0,rootSceneFolder:c,compositions:t,transcripts:n,sequenceScenes:r,pinScenes:o,restorableScenes:i}}var tx=n(87690),nx=n.n(tx);function rx(e,t,n){let{compositions:r,transcripts:o,sequenceScenes:i,pinScenes:a,restorableScenes:s}=e;switch(t.type){case Jh.Composition:r=Yp(e,t);break;case Jh.Transcript:{const n=t.transcriptVoiceoverRefId;if(bG(e,n))throw new Error(`Transcript track already exists for media ref id: ${n}`);o=Wp(e,t);break}case Jh.Sequence:i=eg(e,t);break;case Jh.Pin:a=og(e,t);break;case Jh.Restorable:s=dg(e,t);break;default:throw new Error(`Added track has invalid type: ${t.type}`)}return e=function(e,t,n){if(t.type===Jh.Pin||t.type===Jh.Sequence||t.type===Jh.Restorable)return e;if(void 0!==n&&t.type===Jh.Composition){return Zv(e,mv(t.id),n.folderId,n.toIndex)}if(t.type===Jh.Transcript)return function(e,t){return(0,T.ZP)(e,(e=>{Pv(e.rootMediaFolder,t)}))}(e,t.id);return function(e,t){return(0,T.ZP)(e,(e=>{e.rootCompositionFolder?Nv(e.rootCompositionFolder,mv(t)):(e.rootFolder||(e.rootFolder=dv()),Nv(e.rootFolder,mv(t)))}))}(e=function(e,t){return(0,T.ZP)(e,(e=>{Pv(e.rootSceneFolder,t)}))}(e,t.id),t.id)}(ex(e,r,o,i,a,s),t,n),ox(e,t.id)}function ox(e,t){const n=vk(e,t);return n.timeline.superTau.bouncedMediaRef?CC(e,t)?e:Cx(e,n.id,_x(n.timeline.superTau,void 0)):e}function ix(e,t,n){let{compositions:r,transcripts:o,sequenceScenes:i,pinScenes:a,restorableScenes:s}=e;switch(t.type){case Jh.Composition:r=Kp(e,t);break;case Jh.Transcript:o=Gp(e,t);break;case Jh.Sequence:i=Xp(e,t);break;case Jh.Pin:a=rg(e,t);break;case Jh.Restorable:s=cg(e,t);break;default:throw new Error(`Updated track has invalid type: ${t.type}`)}return e=ox(e=ex(e,r,o,i,a,s),t.id),n&&(e=sO(e,t.id)),e}function ax(e,t,n,r){const o=zk(e,t);if(!function(e){return Boolean(e.voiceover&&!e.isBounced)}(o))return;if(n===Jh.Transcript&&void 0!==bG(e,t))return;const i={name:Z(o.displayName),videoMetadata:o.video};let a;return a=n===Jh.Transcript?Ry({...i,transcriptVoiceoverRefId:o.id}):n===Jh.Pin?_y(i):n===Jh.Sequence?Ay(i):Cy(i),{doc:e=function(e,t,n,r,o){let i;if(e.isStoryboard){const n=Qb(e,t);if(n.length>0){const r=n[n.length-1];if("end"===r.end&&ET(e,t,r)){const n=r.start.tauAnchor.tauId;yN(wP(e,t,n))&&(i=n)}}}const a=tD(e,t,Pp(e,n),r,o);if(e=vx(e=qM(e=Cx(e,t,Rx(Lx(e,t),a)),t,a.id),t,a),void 0!==i&&TP(e,t,i)){const n=DP(e,t,i)?.id;void 0!==n&&(e=BM(e=_D(e,t,(e=>e.tauAnchor.tauId===i?OD(e,{tauId:n,location:0}):e)),t,i))}return{doc:sO(e,t),tau:a}}(e=rx(e,a,r),a.id,t).doc,track:vk(e,a.id)}}function sx(e,t){if(zk(e,t).isBounced)return e;if(bG(e,t))return e;const n=ax(e,t,Jh.Transcript);if(!n)throw new Error(`Could not add track for voiceover ref: ${t}`);const r=n.track.id,o=_x(Lx(n.doc,r),void 0);return Cx(n.doc,r,o)}function cx(e,t,n){const r=Ya(TC(n));if(r){const[t]=r;throw new Error(`${e} cannot contain component: ${t.type}`)}}function dx(e,t){switch(e.type){case Jh.Transcript:cx("Transcript track",0,Ja(function*({LEGACY_voiceoverMetadataTrack:e,noAudioTrack:t,pins:n,cues:r,cards:o}){yield e,yield t,yield n,yield r,yield o}(t),(e=>!bD(e)))),function(e,t,n){for(const{mediaRefId:r}of function*(e){for(const t of e.taus)t.audioSegment&&(yield t.audioSegment)}(t.superTau))if(r!==n)throw new Error(`${e} cannot contain references to multiple media assets: ${n}, ${r}`)}("Transcript track",t,e.transcriptVoiceoverRefId);break;case Jh.Pin:cx("Pin track",0,function*({LEGACY_voiceoverMetadataTrack:e,noAudioTrack:t,pins:n}){yield e,yield t,yield n}(t));break;case Jh.Sequence:cx("Sequence track",0,function*({LEGACY_voiceoverMetadataTrack:e,noAudioTrack:t,pins:n}){yield e,yield t,yield n}(t))}return function(e,t){const n=qf(nS,e,rS,t.pins.components,t.layerOrder);return n===t.layerOrder?t:tS(t,n)}(e.id,t)}function lx(e,t){return hE(e,"timeline",t=dx(e,t))}function ux(e,t,n){const r=vk(e,t);if(r.type===Jh.Transcript)throw new Error(`Cannot duplicate ${r.type} track`);const o=function(e,t,n,{includeAnnotations:r=!1,requireMediaOrComponent:o=!1,trimPins:i=!1,temporary:a=!1}={}){if(tp(n))return MB(e,t,n,r,i,a);return OB(e,t,n,r,o,i,a)}(e,t,function(e,t){return Gs.get(0,Vb(e,t))}(e,t),{requireMediaOrComponent:!0});let i;const a={name:n??`Copy of ${r.name}`,videoMetadata:r.videoMetadata};i=r.type===Jh.Pin?_y(a):r.type===Jh.Sequence?Ay(a):r.type===Jh.Restorable?My({...a,originalTextRange:r.originalTextRange}):Cy({...a,isVideo:r.isVideo}),i=OC(r,i);const s=i.id,c=YO(e,o,t);e=c.doc;const{taus:d,components:l,layerOrder:u,storyboardCues:f}=c,m=xv(e.rootCompositionFolder||e.rootFolder,t),p=m&&Bv(m,t);return{doc:e=lM({doc:e=rx(e,i,m&&{folderId:m.id,toIndex:"number"===typeof p?p+1:void 0}),compositionId:s,location:0,taus:d,trackComponents:l,layerOrder:u,storyboardCues:f,preserveTauIds:!0}).doc,newTrackId:s}}function fx(e,t,n){return e=ix(e,function(e,t){return hE(e,"videoMetadata",t)}(vk(e,t),n)),e}function mx(e,t,n){const r=$p(e,t);return r?ix(e,function(e,t){return hE(e,"isVideo",t)}(r,n)):e}const px={width:3840,height:2160,framerateNumerator:30,framerateDenominator:1};function gx(e,t,n=px){for(const r of t){const t=r.audioSegment?.mediaRefId;if(t&&(!e.isStoryboard||CF(r.audioSegment))){const r=Pp(e,t);if(Ag(r)){const t=r.audio.trackSceneIds.map((t=>hk(e,t)?.videoMetadata));return nx()(t,(e=>e?.width??0))}if(wg(r)){const{video:e}=r;return e&&e.width>=480&&e.height>=480&&py(e)>=10?Fy(e):n}}if(r.visual)return n}}function hx(e,t){return vk(e,t).videoMetadata||gx(e,bP(e,t))||px}function vx(e,t,n,r){const o=vk(e,t);if(!o.videoMetadata){const i=gx(e,n?yu(n):bP(e,o.id),r)??r;i&&(e=fx(e,t,i))}return e.isStoryboard&&bk(e,t)&&n&&yu(n).some((e=>e.visual))&&(e=mx(e,t,!0)),e}function Ex(e,t,{isVideo:n,initialBlankCardDuration:r}){return e.isStoryboard?(e=EM(e,t,0,r).doc,(n||void 0===n&&e.compositions[0]?.isVideo)&&(e=mx(e,t,!0)),e):e}function yx(e,t,n,r,o){return("alignment"===r?uN:fN)(e,t,Ja(bP(e,t),(e=>Boolean(void 0!==e.audioSegment?.mediaRefId&&(void 0===n||e.audioSegment.mediaRefId===n)))),o)}function Sx({taus:e,effects:t=[],bouncedMediaRef:n,gain:r=1,pan:o=0,id:i=Ps()}={}){return e&&0!==e.length||(e=[JM()]),{id:i,type:xu.superTau,taus:e,effects:t,bouncedMediaRef:n,gain:r,pan:o}}function Ix({id:e,assetKey:t=`${Ps()}.m4a`}={}){return BL({id:e,assetKey:t,assetJson:dE(t),isBounced:!0})}function bx(e,t){return Array.from(es(e,(e=>function(e,t){return t.encodeReferencable(nD(e,t))}(e,t))))}function Tx(e,t){const n=!t.encodingOptions.skipBouncedMediaSegmentsEncodingKey,{id:r,bouncedMediaRef:o}=e;return{id:r,type:xu.superTau,taus:bx(e.taus,t),effects:e.effects.length>0?aU(e.effects,t):void 0,...hh(e),...Xv(e),bouncedMediaRef:n&&o?nF(o,t):void 0}}function wx(e,t){const{effects:n,taus:r,bounceForTourAudioSegment:o,bouncedMediaRef:i}=e,a=t.decodeReferencables(r).map((e=>rD(e,t))),s=function(e,t){if(!e||!t.hasAssetJson(Lk(e)))return;return VL(e,t)}(i,t)||o&&Ix({id:yF(o,t).mediaRefId});return Sx({...e,taus:a,bouncedMediaRef:s,effects:n?cU(n,t):void 0,...vh(e),...eE(e)})}function Cx(e,t,n){const r=vk(e,t);return ix(e,lx(r,zx(r.timeline,n)))}function _x(e,t){return(0,T.Uy)(e,(e=>{e.bouncedMediaRef=t}))}function Ax(e,t,n){const r=yu(n);P()(t.length>=0,"Expected subrange to have non-negative length"),P()(qs(t)>=0,"Expected subrange to start at or after 0"),P()(qs(t)<=e.taus.length,"Expected subrange to start at or before tau length");const o=$s(t);P()(o>=0,"Expected subrange to end at or after 0"),P()(o<=e.taus.length,"Expected subrange to end at or before tau length");const i=t.location,a=e.taus.slice(i,o);return(0,Me.fastDeepEqualJson)(a,r)?e:{...e,taus:[...e.taus.slice(0,i),...r,...e.taus.slice(o)]}}function Rx(e,t){return Ax(e,Gs.get(e.taus.length,0),t)}function Mx(e,t){for(let n=0;n<e.taus.length;n++)if(e.taus[n].id===t)return n}function Dx(e,t,n){if(void 0!==n){const r=Mx(e,n);if(void 0===r)throw new Error("Expected afterTauId to be in this superTau");return Ax(e,Gs.get(r+1,0),t)}return Ax(e,Gs.get(0,0),t)}function Ox(e,t,n){if(void 0!==n){const r=Mx(e,n);if(void 0===r)throw new Error("Expected beforeTauId to be in this superTau");return Ax(e,Gs.get(r,0),t)}return Rx(e,t)}function xx(e,t){return Ax(e,Gs.get(0,e.taus.length),t)}function kx(e,t){return Nx(e,[t])}function Nx(e,t){const n=t.map((t=>Mx(e,t))).sort(Te);if(n.some((e=>void 0===e)))throw new Error("Expected tau to belong to this superTau");return n.reduceRight(((e,t)=>function(e,t){return P()(Number.isInteger(t),"Expected index to be an integer"),Ax(e,Gs.get(t,1),[])}(e,t)),e)}function Px(e,t,n,r=!1){const o=yu(n),i=Mx(e,t);if(void 0===i)throw new Error("Expected tau to belong to this superTau");let a=o;if(r&&a.length>0){a=[rv(a[0],t),...o.slice(1)]}return Ax(e,Gs.get(i,1),a)}function Lx(e,t){return vk(e,t).timeline.superTau}function Fx(e,t,n){const r=Gf(t),o={};for(const[i,a]of e.effects.entries())fm(o,a.id,"effect",r.prop("effects").item(i).prop("id").path);return um([o,...e.taus.map(((e,t)=>Mw(e,r.prop("taus").item(t).path,n)))])}const Ux=A.logging.groupLogger("descriptmodel/timelines");function Bx({id:e=Ps(),superTau:t=Sx({}),noAudioTrack:n=lD({}),LEGACY_voiceoverMetadataTrack:r=yD({}),pins:o=UC(),cues:i=oD(),cards:a=xC(),layerOrder:s}={}){return{id:e,superTau:t,noAudioTrack:n,LEGACY_voiceoverMetadataTrack:r,pins:o,cues:i,cards:a,layerOrder:s}}function jx({id:e,superTau:t,noAudioTrack:n,pins:r,cues:o,cards:i,layerOrder:a},s){return{id:e,type:xu.timeline,superTau:Tx(t,s),noAudioTrack:mD(n,s),pins:jC(r,s),cues:aD(o,s),cards:NC(i,s),layerOrder:oS(a,s)}}function Vx({id:e,superTau:t,noAudioTrack:n,voiceoverMetadataTrack:r,pins:o,cues:i,cards:a,layerOrder:s},c){return Bx({id:e,superTau:wx(t,c),noAudioTrack:n&&pD(n,c),LEGACY_voiceoverMetadataTrack:r&&ID(r,c),pins:o&&VC(o,c),cues:i&&sD(i,c),cards:a&&PC(a,c),layerOrder:iS(s,c)})}function zx(e,t){return e.superTau===t?e:{...e,superTau:t}}function Gx({superTau:e,noAudioTrack:t,pins:n,cues:r,cards:o,layerOrder:i},a,s){const c=Gf(a);return um([gD(t,c.prop("noAudioTrack").path,s),GC(n,c.prop("pins").path),dD(r,c.prop("cues").path),FC(o,c.prop("cards").path),Fx(e,c.prop("superTau").path,s),aS(i,c.prop("layerOrder").path)])}function Wx(e,t){return vk(e,t).timeline}function Hx(e,{tauAnchor:t}){if(t.tauId!==e.tau.id)throw new Error("tauAndRange does not match tau data id");const n=t.location;return e.timeOffset+e.getTimeOffsetForTextOffset(n)}function qx(e,t,n){return $x(GV(e,t).tausAndDataLinkedSub().getTauData(n.tauAnchor.tauId),n)}function $x(e,t){let n;if(t.tauAnchor.tauId!==e.tau.id)throw new Error("tauAndRange does not match tau data id");return n=e.tau.isBlocked?e.timeOffset:Hx(e,t)+t.offsetFromBaseTime/(e.tau.audioSegment?.speed??1),n<0?0:n}function Kx(e,t,n){return Yx(GV(e,t).tausAndDataLinkedSub().getTauData(n.tauAnchor.tauId),n)}function Yx(e,t){const n=$x(e,t)+t.offsetFromAnchor;return n<0?0:n}function Zx(e,t,n){switch(n.type){case"endOfComposition":return _k(e,t);case"cardBoundary":return Kx(e,t,vU(e,t,n.cardBoundaryId))}}function Jx(e,t){const n=e.tauAnchor,r=t.tauAnchor;if(n.tauId===r.tauId){if(n.location!==r.location)return n.location<r.location;if(e.offsetFromBaseTime!==t.offsetFromBaseTime)return e.offsetFromBaseTime<t.offsetFromBaseTime}return e.sortTiebreaker<t.sortTiebreaker}function Qx(e,t,n){const r=$x(e(t.tauAnchor.tauId),t),o=$x(e(n.tauAnchor.tauId),n);return hd(r,o)?Jx(t,n):r<o}function*Xx(e,t){PB(t)&&(yield*kk(e,t.sceneId))}function ek({id:e,tauAnchor:t},n,r=!0){const o={},i=Gf(n);return r&&fm(o,e,"component",i.prop("id").path),mm(o,t.tauId,"tau",i.prop("tauAnchor").prop("tauId").path),o}function tk(e,t){return TC(IC(e,t))}function nk(e,t,n){const r=Wx(e,t),o=FB(e,t,n);if(o)return[o,r.pins];const i=sw(e,t,n);if(i)return[i,r.cues];const a=hU(e,t,n);if(a)return[a,r.cards];const s=function(e,t,n){return XT(e,t).getItemMaybe(e,n)}(e,t,n);if(s)return[s,r.noAudioTrack];const c=function(e,t,n){return ew(e,t).getItemMaybe(e,n)}(e,t,n);return c?[c,r.LEGACY_voiceoverMetadataTrack]:void 0}function rk(e){const t={};for(const n of e.components){const e=n.tauAnchor.tauId;t[e]?t[e].push(n):t[e]=[n]}return t}function ok(e,t){const n=rk(e);return t?vE(n,((e,n)=>{const r=t[e];return r&&(0,Me.fastDeepEqualJson)(n,r)?r:n})):n}const ik=(0,Yl.createCachedSelector)(((e,t,n)=>{const r=IC(e,t).find((({type:e})=>e===n));if(!r)throw new Error(`Could not find track with type ${n}`);return r}),rk)({...yp("getTrackComponentsByTau"),keySelector:function(e,t,n){return im(e.projectId,t,n)}});function ak(e,t,n){return we(n.map((({components:e})=>e)),Qx.bind(void 0,GV(e,t).tausAndDataLinkedSub().getTauData))}function sk(e,t){return ak(e,t,IC(e,t))}function ck(e,t,n){return dk(e.projectId,n,ik(e,t,xu.voiceoverMetadataTrackComponentList)[n],ik(e,t,xu.noAudioTrackComponentList)[n],ik(e,t,xu.pinTrackComponentList)[n],ik(e,t,xu.cueTrackComponentList)[n],ik(e,t,xu.cardTrackComponentList)[n])}const dk=(0,Yl.createCachedSelector)(((e,t,n)=>n),((e,t,n,r)=>r),((e,t,n,r,o)=>o),((e,t,n,r,o,i)=>i),((e,t,n,r,o,i,a)=>a),((...e)=>we(e.map((e=>e||[])),Jx)))({...Sp("xGetOrderedTrackComponentsForTau"),keySelector:rm}),lk=em("filterMarkers");function uk(e){return e.filter(hR)}function fk(e,t){return qf(uk,sm(e,t),lk,Wx(e,t).noAudioTrack.components)}function mk(e,t){return Wx(e,t).pins.components}em("filterInlineNotes");function pk(e,t){return Wx(e,t).cards.components}function gk(e,t,n){const r=GV(e,t).tausAndDataForBasicAttributedString().getTauData(n.tauAnchor.tauId),o=r.orderedComponentsAndWordlessMedia.findIndex((e=>Bu(e)&&e.id===n.id)),i=r.orderedComponentAndWordlessMediaRenderedRanges[o];return Gs.get(r.textOffset+i.location,i.length)}function hk(e,t){return $p(e,t)||Vp(e,t)||Qp(e,t)||ng(e,t)||sg(e,t)}function vk(e,t){const n=hk(e,t);if(void 0===n)throw bp.itemNotFound(t,"tracks");return n}function*Ek(e){for(const t of e.compositions)yield t;for(const t of e.transcripts)yield t;for(const t of e.sequenceScenes)yield t;for(const t of e.pinScenes)yield t;for(const t of e.restorableScenes)yield t}function yk(e){return Qa(Ek(e),nv)}function Sk(e,t){const n=t.toLowerCase();return ns(yk(e),(e=>e.toLowerCase().startsWith(n)))}function*Ik(e){const t=e.rootCompositionFolder||e.rootFolder;for(const n of Fv(t))if(Cv(n)){const t=vk(e,n.id);t.type===Jh.Composition&&(yield t)}}function bk(e,t){return vk(e,t).type===Jh.Composition}function Tk(e,t=(()=>!0)){const n=e.rootCompositionFolder||e.rootFolder;for(const r of Fv(n))if(Cv(r)&&t(r))return r.id;if(e.rootSceneFolder)for(const r of Uv(e.rootSceneFolder))if(Dv(r))return r}function wk(e,t=(()=>!0)){const n=Tk(e,t);if(n)return n;throw new Error("no matching tracks")}function*Ck(e){for(const t of Uv(e.rootMediaFolder))if(Dv(t)){const n=vk(e,t);n.type===Jh.Transcript&&(yield n)}}function _k(e,t){return GV(e,t).duration()}const Ak=(0,Yl.createCachedSelector)(((e,t)=>e),((e,t)=>t),_k,((e,t,n)=>{if(e.isStoryboard)return n;for(const r of mk(e,t)){const o=Kx(e,t,r),i=zB(e,t,r);n=Math.max(n,o+i)}return n}))({...yp("getCompositionDuration"),keySelector:sm});function Rk(e,t,n){if(n===t)return 0;const r=BB(e,n)?.pin;return r?Kx(e,t,r):0}function Mk(e){return Boolean(e.videoMetadata&&e.timeline.superTau.taus.some((({audioSegment:e})=>e&&CF(e))))}function Dk(e,t){if(!e.isStoryboard&&!as(tk(e,t)))return!1;if(e.isStoryboard){let n=0;for(const[r]of tk(e,t)){if(!pU(r))return!1;n+=1}if(n>1)return!1}for(const n of bP(e,t)){if(n.audioSegment&&!yN(n))return!1;if(void 0!==As.index(PP(e,t,n.id).string))return!1}return!0}function Ok(e,t){let n=_P(e,t);return n&&EN(n)&&(n=DP(e,t,n.id)),n&&YP(e,n)}function xk(e,t){if(Dk(e,t))return"placeholder";return function(e){switch(e){case void 0:return"placeholder";case"audio":return"audio";case"video":return"video";case"image":return"image";case"title":case"shape":case"waveform":case"progress":return"vector"}}(Ok(e,t))}function*kk(e,t){const n=new Set;for(const r of bP(e,t))if(r.audioSegment&&void 0!==r.audioSegment.mediaRefId){yield r.audioSegment.mediaRefId;const t=Pp(e,r.audioSegment.mediaRefId);if(t.audio&&t.audio.trackSceneIds)for(const e of t.audio.trackSceneIds)n.add(e)}for(const r of IC(e,t))yield*KC(e,r);for(const r of n)yield*kk(e,r)}function Nk(e){const t=e.audio?.duration,n=e.video?.duration;return void 0!==t&&void 0!==n?Math.max(t,n):t??n}function Pk(e){if(!e.isGlobalAsset)throw new Error("No asset handle for this media reference");if(e.assetGuid)return{guid:e.assetGuid};if(e.assetLocalId)return{localId:e.assetLocalId};if(e.assetJson){const n=(t=e.assetJson)?.quality?.original?.url??t.url;if(n)return{originalFileUrl:n}}var t;throw new Error("No asset handle for this media reference")}function Lk({basename:e}){return e}function Fk(e){const t=new Set;for(const n of e)if(Ag(n))for(const e of n.audio.trackSceneIds)t.add(e);return t}const Uk=em("mediaReferenceSummaryCache");function Bk(e,t,n,r,o){const i={},a=Gf(e);if(fm(i,t,"mediaReference",a.prop("id").path),n){const{defaultVoiceId:e,trackSceneIds:t,roomtoneRefId:r}=n;void 0!==e&&mm(i,e,"voice",a.prop("audio").prop("defaultVoiceId").path),t&&t.forEach(((e,t)=>{mm(i,e,"sequenceTrack",a.prop("audio").prop("trackSceneIds").item(t).path)})),r&&mm(i,r,"mediaReference",a.prop("audio").prop("roomtoneRefId").path)}const s=[];if(r){const{alignment:e,recognition:t}=r.metadata;e&&s.push($h(e,a.prop("voiceover").prop("metadata").prop("alignment").path,o)),t&&s.push($h(t,a.prop("voiceover").prop("metadata").prop("recognition").path,o))}return um([i,...s])}function jk(e,t){const n=Pp(e,t);if(!n.audio)throw new Error("MediaReference does not have audio");return n}function Vk(e,t){const n=jk(e,t);if(!Ag(n))throw new Error("MediaReference is not a sequence");return n}function zk(e,t){const n=jk(e,t);if(!n.voiceover)throw new Error("MediaReference does not have voiceover");return n}const Gk=(0,Yl.createCachedSelector)(((e,t)=>t.timeline.superTau.taus),(e=>{const t=new Set;for(const n of e)n.audioSegment&&void 0!==n.audioSegment.mediaRefId&&t.add(n.audioSegment.mediaRefId);return t}))({...yp("getUsedMediaRefIdsForTrackExcludePins"),selectorCreator:vp(),keySelector:function(e,t){return rm(e,t.id)}});yp("getUsedMediaReferenceIds");function Wk(e,t,n){return function*(e,t,n){for(const r of Ek(e))(n||r.type!==Jh.Transcript)&&(os(kk(e,r.id),(e=>t.has(e)))||r.type===Jh.Transcript&&t.has(r.transcriptVoiceoverRefId)||r.type===Jh.Composition&&void 0!==r.fileMetadata?.artworkRefId&&t.has(r.fileMetadata.artworkRefId))&&(yield r)}(e,new Set([t]),n)}class Hk{constructor(e,t,n){this.wordItem=e,this.range=t,this.rangeWithPunc=n}get word(){return this.wordItem.word}get startTime(){return this.wordItem.startTime}get endTime(){return this.wordItem.endTime}get tag(){return this.wordItem.tag}get attrs(){return this.wordItem.attrs}get speaker(){return this.wordItem.speaker}get extra(){return this.wordItem.extra}equals(e){return Wh(this.wordItem,e.wordItem)&&Ws(this.range,e.range)}}function qk(e,t){return P()(Number.isInteger(t),"Expected textOffset to be an integer"),rh(e,(e=>t<e.location?Ie.OrderedDescending:t<$s(e)?Ie.OrderedSame:Ie.OrderedAscending))}class $k{constructor(e,t,n){this.wordArrayView=e,this.ranges=t,this.rangesWithPunc=n,P()(e.length===t.length||e.length!==n.length,"Expected word array view and ranges to have same length")}get length(){return this.ranges.length}elementAt(e){return new Hk(Wg(this.wordArrayView,e),this.ranges[e],this.rangesWithPunc[e])}map(e,t){const n=[],r=this.length;for(let o=0;o<r;o++){const t=this.elementAt(o);n.push(e(t,o,this))}return n}convertSearchResultInPlace(e){if(!e)return;const t=e;return t.value=this.elementAt(t.index),t}convertFullSearchResultInPlace(e){const t=e;return t.previous&&(t.previous.value=this.elementAt(t.previous.index)),t.match&&(t.match.value=this.elementAt(t.match.index)),t.next&&(t.next.value=this.elementAt(t.next.index)),t}searchForTextOffset(e){return this.convertFullSearchResultInPlace(qk(this.ranges,e))}searchForTextOffsetWithPunc(e){return this.convertFullSearchResultInPlace(qk(this.rangesWithPunc,e))}lastFinishedWordForTextOffset(e){P()(Number.isInteger(e),"Expected textOffset to be an integer");const t=rh(this.ranges,(t=>$s(t)<=e?Ie.OrderedAscending:Ie.OrderedDescending)),n=this.convertFullSearchResultInPlace(t);return n.previous&&n.previous.value}searchForTimeOffset(e){return this.convertFullSearchResultInPlace(pL(this.wordArrayView,e))}mostRecentWordForTimeOffset(e,t){return this.convertSearchResultInPlace(function(e,t,n=!1){const r=n?sL:0,{buffer:o,offset:i,length:a}=e,{previous:s}=eh(o,i,i+a,(e=>{const n=(e.endTime-e.startTime)*r,o=e.startTime+n;return rL(o,t)?Ie.OrderedDescending:o<t?Ie.OrderedAscending:Ie.OrderedDescending}));return uL(e,s)}(this.wordArrayView,e,t))}currentOrNextWordForTimeOffset(e,t){return this.convertSearchResultInPlace(function(e,t,n=!1){const{buffer:r,offset:o,length:i}=e,{next:a}=eh(r,o,o+i,(e=>{const r=(e.endTime-e.startTime)*(n?sL:0),o=e.endTime-r;return oL(o,t)?Ie.OrderedAscending:Ie.OrderedDescending}));return uL(e,a)}(this.wordArrayView,e,t))}wordAfterCutForTextOffset(e,t){P()(Number.isInteger(e),"Expected textOffset to be an integer");const{match:n,next:r}=this.searchForTextOffset(e);let o;return n&&(n.index>0||t)?o=n.value:r&&r.index>0&&(o=r.value),o}}var Kk=n(13256);function Yk(e,t,n,r,o,i,a,s,c,d){const l=xm(e,Gs.get(n,r));if(!c)return{droppedAttributes:l.attributes,middleAttrStr:d};if(0===l.attributes.length)return{droppedAttributes:[],middleAttrStr:d};const u=[],f=[];let m,p=0;if(o.length>0&&(p=qg(o).endTime),a.length>0?m=Hg(a).startTime:t?m=rp(t):i.length>0?m=qg(i).endTime:s.length>0&&(m=OL(s)),void 0===m)return{droppedAttributes:l.attributes,middleAttrStr:d};const g=aP(gL(zg(c),p,m-p),l.string);if(!g)return{droppedAttributes:l.attributes,middleAttrStr:d};if(g){const e=new $k(g.subAlignment,g.wordRanges,g.wordRangesWithPunc);for(const t of l.attributes){const n=e.searchForTextOffsetWithPunc(t.range.location),r=e.searchForTextOffsetWithPunc($s(t.range)),o=n.match?.value.startTime??n.next?.value.startTime??n.previous?.value.endTime,i=r.match?.value.endTime??r.previous?.value.endTime??r.next?.value.startTime;void 0!==o&&void 0!==i&&o<i?u.push({attributedRange:t,offset:o,duration:i-o}):f.push(t)}}if(0===u.length)return{droppedAttributes:f,middleAttrStr:d};const h=aP(i,d.string);if(!h)throw new Error("middleAlignment is invalid alignment for middleAttrStr");const v=[],E=new $k(h.subAlignment,h.wordRanges,h.wordRangesWithPunc);for(const{attributedRange:y,offset:S,duration:I}of u){const e=E.searchForTimeOffset(S),t=e.match?.value.rangeWithPunc.location??e.next?.value.rangeWithPunc.location??(e.previous&&$s(e.previous.value.rangeWithPunc)),n=E.searchForTimeOffset(S+I),r=(n.match&&$s(n.match.value.rangeWithPunc))??(n.previous&&$s(n.previous.value.rangeWithPunc))??n.next?.value.rangeWithPunc.location;void 0!==t&&void 0!==r&&t<r?v.push({attribute:y.attribute,range:Gs.getStartEnd(t,r)}):f.push(y)}return v.length>0&&(d=Mm(d,v)),{droppedAttributes:f,middleAttrStr:d}}function Zk(e,t,n,r,o,{isInBatch:i}={isInBatch:!1}){if(n.isScriptClip)return e;const{subAlignmentInMediaDomain:a,hasInvalidAlignment:s,ref:c}=GV(e,t.id).tausAndDataBasic().getTauData(n.id);if(!a||!s||!c)return e;const d=r.wordArrayView,l=Array.from(Qa(Kk.QI(0,d.length,0,a.length,((e,t)=>Lh(d.buffer[d.offset+e],a.buffer[a.offset+t]))),(([e,t,n,r])=>({a:Gs.getStartEnd(e,t),b:Gs.getStartEnd(n,r)})))),u=[];let f=0;const m=[];function p(e,t){if(0===e.string.length)return;let n=0===u.length;const r=u.length>0?u[u.length-1]:void 0;!n&&r&&(n=uc(bs,Ms,r.string,void 0,!1)),n||(n=uc(bs,Ms,e.string,void 0,!0)),n||(u.push(bm(" ")),f+=1),u.push(e),t&&m.push({newRange:Gs.get(f,e.string.length),oldRange:t}),f+=e.string.length}for(const{item:v,range:E}of function*(e,t,n){let r=0;for(const o of e){const e=n(o);if(e.location<r)throw new Error("ordered ranges cannot overlap");if(e.length<0)throw new Error("ordered ranges cannot have length less than 0");e.location>r&&(yield{range:Gs.getStartEnd(r,e.location)}),r=$s(e),yield{item:o,range:e}}r<t&&(yield{range:Gs.getStartEnd(r,t)})}(l,r.length,(({a:e})=>e)))if(v){if(v.b.length>0){const o=Gg(a,v.b.location,v.b.length);let i=CL(e,t.type,o,c.id);if(v.a.length>0){const e=r.rangesWithPunc[v.a.location].location,t=$s(v.a)<r.length?r.rangesWithPunc[$s(v.a)].location:n.text.string.length;i=Yk(n.text,n.audioSegment,e,t-e,Gg(r.wordArrayView,0,v.a.location),o,Gg(r.wordArrayView,$s(v.a)),a.buffer,r.wordArrayView.buffer,i).middleAttrStr}p(i,void 0)}}else{const e=E.location,t=$s(E),o=e<r.length?r.rangesWithPunc[e].location:0,i=t<r.length?r.rangesWithPunc[t].location:n.text.string.length,a=Gs.getStartEnd(o,i);p(xm(n.text,a),a)}let g=Cm(u);if(0===g.string.length&&(g=bm(" ")),!mL(a,g.string))return void Ht(new Error("Created invalid text for subAlignment"),"update-text-from-alignment-with-prev-linked-subalignment",{extra:{projectId:e.projectId}});e=UM(e,t.id,n.id,jM(n,g));const h=Boolean(c&&Ag(c));return _D(e,t.id,(r=>{if(r.tauAnchor.tauId!==n.id)return r;if(pU(r)&&0===r.tauAnchor.location)return r;const{match:i,previous:a,next:s}=rh(m,(({oldRange:e})=>ah(r.tauAnchor.location,e.location,$s(e))));let c=0;if(i)c=r.tauAnchor.location-i.value.oldRange.location+i.value.newRange.location;else{if(h&&o){const n=o.get(r.id);if(void 0===n)throw new Error("No previous playback time offset for component in sequence clip");return PD(e,t.id,r,n)}a?c=$s(a.value.newRange):s&&(c=s.value.newRange.location)}return OD(r,{tauId:n.id,location:c})}),{ensureSorted:!i})}function Jk(e,t,n,r,o){if(n.isScriptClip||!n.audioSegment)return e;const i=GV(e,t.id).tausAndDataBasic().getTauData(n.id).ref?.voiceover?.metadata?.alignment;if(!i)return e;let a;const s=t.type===Jh.Transcript,c=n.audioSegment?.mediaRefId;s||void 0===c||(a=bG(e,c));const d=n.audioSegment,l=gL(zg(i),d.offset,d.duration);let u=(a&&wL(l,e,a))??bm(EL(l));0===u.string.length&&(u=bm(" "));let f=Xk(jM(n,u),!1);e=_D(e=UM(e,t.id,n.id,f),t.id,(o=>{const{tauAnchor:i}=o;if(i.tauId===n.id){const n=r?.get(o.id);if(void 0===n)throw new Error("No previous playback time offset for component in clip");const i=kD(OD(o,{tauId:o.tauAnchor.tauId,location:0},!0),0);return PD(e,t.id,i,n)}return o}));const{linkedSubAlignment:m}=GV(e,t.id).tausAndDataLinkedSub().getTauData(n.id);if(!m)throw new Error("Tau has invalid alignment");if(o){const r=f.text.string.length,i=o.map((({timeRange:e,annotationId:t})=>{let n=function(e,t,n){const{match:r,next:o,previous:i}=e.searchForTimeOffset(t+n),a=r||o;return a?a.value.rangeWithPunc.location:i?$s(i.value.rangeWithPunc):0}(m,d.offset,e.offset),o=function(e,t,n){const{match:r,next:o,previous:i}=e.searchForTimeOffset(t+n),a=r||i;return a?$s(a.value.rangeWithPunc):o?o.value.rangeWithPunc.location:0}(m,d.offset,rp(e));return n===r&&(n-=1),o<=n&&(o=n+1),n=Math.max(0,n),o=Math.min(r,o),{range:Gs.getStartEnd(n,o),attribute:Tf(t)}}));f=jM(f,Mm(f.text,i)),e=UM(e,t.id,n.id,f)}return e}const Qk=A.logging.groupLogger("descriptmodel/tausalignment");function Xk(e,t){return(0,T.ZP)(e,(e=>{e.ignoreAlignment=t,t||(e.preCorrectionText=void 0)}))}function eN(e,t){return(0,T.ZP)(e,(e=>{e.failedAlignmentKey=t}))}function tN(e,t,n,r,o,i){const a=vk(e,t),s=wP(e,t,n);if(i){const t=Zk(e,a,s,i,o);if(t)return t}return lN(e,a,s,r,o)}function nN(e,t,n){return rN(e,t,wP(e,t,n))}function rN(e,t,n){return rP(e.projectId,n,ZP(e,n))}const oN=em("getTauPreCorrectionLinkedSubAlignmentImpl");function iN(e,t,n){return qf(aN,lm(e,t),oN,e,t,n)}function aN(e,t,n){if(void 0===t.audioSegment||void 0===t.preCorrectionText)return;const r=nP(e,t,n);if(!r)return;const o=Zg(r),i=[],a=[],s=[];Zh.enumerateWords(t.text.string,((e,t,n)=>(i.push(t),a.push(e),!1))),Zh.enumerateWords(t.preCorrectionText.text,((e,t,n)=>(s.push(t),!1)));const c=(0,zf.w5)(Array.from(s).reverse(),Array.from(i).reverse()).map((({a:e,b:t})=>({a:{location:s.length-e.location-e.length,length:e.length},b:{location:i.length-t.location-t.length,length:t.length}})));for(let f=0;f<c.length;f++){const e=c[f],n=e.a.location,r=e.b.location;if(e.a.length>0||e.b.length>0)if(0===e.b.length)o.splice(n,e.a.length);else{const n=e.a.length||1;let i=e.a.location,c=!1;const d=t.preCorrectionText.editTimeOffsetForDisambiguation;let l=-1;for(let r=0;r<o.length-1;r++){const n=o[r+1].startTime-t.audioSegment.offset,i=o[r].endTime-t.audioSegment.offset;if(o[r].word===o[r+1].word&&d<=n&&d>=i){const t=d-i,o=n-d;l=t===o?e.a.location:t>o?r+1:r;break}}l>0&&l!==e.a.location&&(l<e.a.location&&(c=!0),i=l);const u=s.length>0?o.slice(i,i+n):[],f=a.slice(r,r+e.b.length);0===e.a.length&&(c?f.splice(0,0,...u.map((e=>e.word))):f.push(...u.map((e=>e.word))));const m=u.length>0&&d>0?u[0].startTime:t.audioSegment.offset,p=((u.length>0&&d<t.audioSegment.offset+t.audioSegment.duration?u[Math.min(n,u.length)-1].endTime:t.audioSegment.offset+t.audioSegment.duration)-m)/f.length,g=f.map(((e,t)=>{const n=t*p+m,r=n+p,o=Math.min(t,u.length-1);return o>=0?{...u[o],startTime:n,endTime:r,word:e}:{startTime:n,endTime:r,word:e,attrs:Ih.UserCorrection,speaker:void 0,tag:void 0,extra:void 0}}));o.splice(i,n,...g)}}const d=zg(o),l=eP(d,t.audioSegment.offset,t.audioSegment.speed);if(!l)return;const u=aP(l,t.text.string);return u?{subAlignmentInMediaDomain:d,linkedSubAlignment:new $k(l,u.wordRanges,u.wordRangesWithPunc)}:void 0}function sN(e,t,n){return cN(e,t,wP(e,t,n))}function cN(e,t,n){return cP(e.projectId,n,n.audioSegment?.mediaRefId?Pp(e,n.audioSegment.mediaRefId):void 0)}function dN(e,t,n){const r=cP(e.projectId,n,n.audioSegment?.mediaRefId?Pp(e,n.audioSegment.mediaRefId):void 0);if(r)return r;return GV(e,t).tausAndDataLinkedSub().getTauData(n.id).preCorrectionLinkedSubAlignment}function lN(e,t,n,r,o){if(n.isScriptClip)return e;const{subAlignment:i,hasInvalidAlignment:a}=GV(e,t.id).tausAndDataBasic().getTauData(n.id);if(!i||!a)return e;let s;const c=t.type===Jh.Transcript,d=n.audioSegment&&n.audioSegment.mediaRefId;c||void 0===d||(s=bG(e,d));const l=DL(i,n.text,{subAlignmentTimeRange:n.audioSegment,transcriptTrackAndDoc:s&&{doc:e,transcriptTrack:s},allowEmptyString:!1,previousAlignment:r}),u=jM(n,l.attributedString);e=Cx(e,t.id,Px(Lx(e,t.id),n.id,u));const f=$s(l.insertionRange),m=l.newCharacters.string.length-l.insertionRange.length,p=void 0!==d&&Ag(Pp(e,d));return _D(e,t.id,(r=>{const{tauAnchor:i}=r;if(i.tauId===n.id){if(Hs(l.insertionRange,i.location)){if(p&&o){const n=o.get(r.id);if(void 0===n)throw new Error("No previous playback time offset for component in sequence clip");return PD(e,t.id,r,n)}return OD(r,{tauId:i.tauId,location:l.insertionRange.location})}return FD(0,t.id,r,m,f,!0)}return r}))}function uN(e,t,n,{shouldRefreshTimelineTaus:r,recognitionFormattedText:o,previousAlignment:i,previousComponentTimeOffsets:a,previousLinkedSubAlignments:s,adaptFromExistingText:c,annotationTimeRangeMap:d}){const l=Wx(e,t);let u=!1;const f=vk(e,t).type===Jh.Transcript;for(const m of n)if(u=!0,f&&void 0!==o)e=ZA(e,t,m.id,o);else if(m.isScriptClip)e=QA(e,t,m.id,o);else if(c){const n=vk(e,t),r=s?.get(m.id);let o;r&&(o=Zk(e,n,m,r,a,{isInBatch:!0})),o||(o=lN(e,n,m,i,a)),e=o}else{e=Jk(e,vk(e,t),m,a,d?.get(m.id))}return u&&(e=XC(e=VD(e,t,a),t,{assumeNoTauOrderChange:{prevTimeline:l}})),r&&u&&(e=sO(e,t)),e}function fN(e,t,n,{shouldRefreshTimelineTaus:r,recognitionFormattedText:o}){let i=!1;for(const a of n){i=!0;const n=a.id;a.isScriptClip&&(e=QA(e,t,n,o))}return r&&i&&(e=sO(e,t)),e}function mN(e,t,n,r,o=-.05,i=!1){P()(Number.isInteger(r),"Expected atLocation to be an integer");const a=wP(e,t,n),s=eL(e,a);if(!kN(e,a)||0===o||!a.audioSegment||!s)return;const c=s.voiceover.metadata.alignment;if(!c)return;let d=$P(e,t,n,r,!1)*a.audioSegment.speed,l=!1;if(0===d&&i){const r=GV(e,t).tausAndDataBasic().getTauData(n).subAlignment;if(r&&r.length>0){d=Wg(r,0).startTime-a.audioSegment.offset,l=!0}else d=a.audioSegment.duration,l=!0}if(d<=0)return;const u=AL(c,a.audioSegment.offset,d,o,.01*Math.sign(o),o);return!l&&0!==u&&d+u>0?(d+u)/a.audioSegment.speed:d/a.audioSegment.speed}function pN(e,t=(()=>!0)){const n="[FORCE FIX ALIGNMENT]";let r=0,o=0;const i=e,a=Np(i),s=FA(i,void 0,void 0,void 0);e=function(e,t=(()=>!0)){for(const n of e.mediaLibrary.mediaRefs)t(n)&&Xh(n)&&(e=IO(e,n.id));return e}(e,t);for(const c of e.mediaLibrary.mediaRefs)if(t(c)&&Ag(c)){const t=c.voiceover?.metadata.alignmentSource;e=cO(e,c.id,!1);const o=Pp(e,c.id).voiceover?.metadata.alignmentSource;(0,Me.fastDeepEqualJson)(t,o)||(Qk.info(`${n} Fixed sequence alignment source (${c.id})`),r+=1)}for(const c of Ek(e))for(const r of bP(e,c.id))if(FN(e,c.id,r.id)){const i=eL(e,r);if(!i||!t(i))continue;const d=a(i.id)?.voiceover?.metadata.alignment;e=tN(e,c.id,r.id,d,s,void 0),Qk.info(`${n} Fixed tau alignment (${c.id}:${r.id})`),o+=1}if(e!==i)for(const c of yk(e))e=sO(e,c);return{doc:e,stats:{alignmentSourceChanges:r,tauChanges:o}}}function gN(e,t,n,r){for(const o of LF){const i=e[o];if(i){const e=n&&void 0!==t[o]?.fadeInDuration,a=r&&void 0!==t[o]?.fadeOutDuration;t=FF(t,[o],e?i.fadeInDuration:void 0,a?i.fadeOutDuration:void 0,e?i.fadeInShape:void 0,a?i.fadeOutShape:void 0,e?i.headTransitionEffect:void 0,a?i.tailTransitionEffect:void 0)}}return t}function hN(e,t,n,r,o,i=!1,a=!1){const s=e,c={doc:e,success:!1,unalignedTau:void 0},d=PP(e,t,n),l=wP(e,t,n);if(_N(l)||l.ignoreAlignment)c.success=!kN(e,l);else if(kN(e,l))if(r)if($s(r)>d.string.length)c.success=!1;else if(sR(l,r))c.success=!1;else{const n=XA(e,t,l.id,r),u=As,f=d.string.substr(n.location,n.length);if(i||void 0!==u.index(f)){let e;const r=$s(n),i=d.string.length-r;if(e=i>0&&void 0===u.index(d.string.substr(r,i))?Gs.get(n.location,n.length+i):n,e.location>0){let n={tauId:l.id,location:e.location};const r=AR(c.doc,t,n,!1,o&&o.offset);if(!r)return c.doc=s,c.success=!1,c;c.doc=r.doc;const i=r.afterTau;if(i){n={tauId:i.id,location:e.length};const r=AR(c.doc,t,n,!1,o&&o.duration,void 0,a);if(!r)return c.doc=s,c.success=!1,c;if(c.doc=r.doc,c.unalignedTau=r.beforeTau,c.unalignedTau){let e=Xk(c.unalignedTau,!0);e.audioSegment&&l.audioSegment&&(e=VM(e,gN(l.audioSegment,e.audioSegment,!1,!0))),c.doc=Cx(c.doc,t,Px(Lx(c.doc,t),c.unalignedTau.id,e)),c.unalignedTau=e}c.success=!0}else c.success=!1}else{const n={tauId:l.id,location:e.length},r=AR(c.doc,t,n,!1,o&&rp(o));if(!r)return c.doc=s,c.success=!1,c;if(c.doc=r.doc,c.unalignedTau=r.beforeTau,c.unalignedTau){let e=Xk(c.unalignedTau,!0);e.audioSegment&&l.audioSegment&&(e=VM(e,gN(l.audioSegment,e.audioSegment,!0,!1))),c.doc=Cx(c.doc,t,Px(Lx(c.doc,t),c.unalignedTau.id,e)),c.unalignedTau=e,c.success=!0}else c.success=!1}}else c.success=!1}else{const e=Xk(l,!0);c.doc=Cx(c.doc,t,Px(Lx(c.doc,t),l.id,e)),c.success=!0,c.unalignedTau=e}else c.success=!0,c.unalignedTau=l;return c}function vN(e,t){if(!t.mediaRefId)return;const{voiceover:n}=zk(e,t.mediaRefId);return n.metadata.alignment?gL(zg(n.metadata.alignment),t.offset,t.duration):void 0}function EN(e){return Boolean(e.audioSegment&&void 0===e.audioSegment.mediaRefId&&!SN(e))}function yN(e){return EN(e)&&!e.recordingSession}function SN(e){return void 0!==e.visual}function IN(e){return SN(e)&&"captions"===e.visual.type}function bN(e){return SN(e)&&(t=e.visual,"title"===(n=t.type)||"captions"===n||"dynamicText"===n);var t,n}function TN(e){return Boolean(e.audioSegment?.isFreezeFrame)}function wN(e){return EN(e)||TN(e)||SN(e)}function CN(e,t,n){return e.isStoryboard?wN(n)||"image"===YP(e,n):wN(n)}function _N(e){return void 0!==e.recordingSession}function AN(e){return void 0===e.audioSegment&&0===e.text.string.length}function RN(e,t){return!(!t||!e.audioSegment)&&Boolean(t.audio&&wF(e.audioSegment))}function MN(e,t){const n=ZP(e,t);return void 0!==n&&Tg(n)}function DN(e,t,n){return!!n&&Boolean(EN(n)||nN(e,t,n.id))}function ON(e,t){return!(!t||!e.audioSegment)&&Boolean(t.video&&CF(e.audioSegment))}function xN(e){return 0===e.text.string.replace(Ka,"").trim().length}function kN(e,t){if(t.overdubInfo||TN(t))return!1;const n=eL(e,t);return!!n&&Boolean(n.voiceover.metadata.alignment&&!kg(n)&&!t.ignoreAlignment&&!Mg(n))}function NN(e,t){if(t.ignoreAlignment||TN(t))return!1;const n=eL(e,t);return Boolean(n?.voiceover.metadata.alignment)}function PN(e,t){return void 0!==t.audioSegment?.mediaRefId&&!TN(t)}function LN(e,t){if(t.overdubInfo||!PN(0,t))return!1;const n=QP(e,t);return!!n&&(!kg(n)&&!Mg(n))}function FN(e,t,n){return GV(e,t).tausAndDataBasic().getTauData(n).hasInvalidAlignment}function UN(e,t,n,r,o){const{text:i}=wP(e,t,n),a=sN(e,t,n);if(!a)return;const s=function(e,t,n,r,o){let i=0,a=0;if(n)i=n.location,a=e.string.length-$s(n);else{const n="string"===typeof t?t:t.string;i=nc(e.string,n);const r=Math.min(n.length,e.string.length);a=Math.min(rc(e.string,n),r-i)}const s=rh(r,(e=>i<e.location?Ie.OrderedDescending:i>=$s(e)?Ie.OrderedAscending:Ie.OrderedSame));let c,d;const l=s.match&&s.match.index,u=s.previous&&s.previous.index;void 0!==l?l>0?(c=r[l-1].location,d=l-1):(c=r[l].location,d=l):void 0!==u?(c=r[u].location,d=u):(c=0,d=0);const f=e.string.length-a,m=rh(r,(e=>f<e.location?Ie.OrderedDescending:f>=$s(e)?Ie.OrderedAscending:Ie.OrderedSame));let p,g;const h=m.match&&m.match.index,v=m.next&&m.next.index;void 0!==h?h+1<r.length?(p=e.string.length-$s(r[h+1]),g=h+1):(p=e.string.length-$s(r[h]),g=h):void 0!==v?(p=e.string.length-$s(r[v]),g=v):(p=0,g=r.length-1);const E=Gg(o,d,g+1-d);let y;if(n){let r,o;r=c<i?e.string.substr(c,i-c):"",o=p<a?e.string.substr($s(n),a-p):"",y=r+("string"===typeof t?t:t.string)+o}else{const e="string"===typeof t?t:t.string;y=e.substr(c,e.length-p-c)}return{prefixLength:c,suffixLength:p,firstWordIndex:d,lastWordIndex:g,middleString:y,subSubAlignment:E}}(i,r,o,a.ranges,a.wordArrayView);return mL(s.subSubAlignment,s.middleString)}function BN(e,t){return e===t}function jN(e,t,n,r,o,i,a=BN){if(e===r&&t===o&&n===i)return{loc:e.length,removed:0,added:0};const s=function(e,t,n,r,o,i,a){let s=0;const c=Math.min(n,i);for(;s<c&&a(e[t+s],r[o+s]);)s+=1;return s}(e,t,n,r,o,i,a),c=function(e,t,n,r,o,i,a){let s=0;const c=Math.min(n,i);for(;s<c&&a(e[t+n-s-1],r[o+i-s-1]);)s+=1;return s}(e,t+s,n-s,r,o+s,i-s,a);return{loc:s,removed:n-s-c,added:i-s-c}}function VN(e){let t=0,n=0;const r=e.length;for(;n<r;)t=(t<<5)-t+e.charCodeAt(n++)|0;return t}function zN(e,t){return e.isBlocked?0:e.audioSegment?_F(e.audioSegment):t&&t.length>0?qg(t).endTime:0}function GN(e){return void 0!==e.audioSegment?.mediaRefId&&!TN(e)}function WN(e,t){return!(e.overdubInfo||!GN(e))&&Boolean(t?.audio&&!kg(t)&&!Mg(t))}function HN(e,t){return!e.ignoreAlignment&&!TN(e)&&Boolean(t?.voiceover?.metadata.alignment)}function qN(e,t){return!e.overdubInfo&&!TN(e)&&(!!t?.voiceover&&Boolean(t.voiceover.metadata.alignment&&!e.ignoreAlignment&&!kg(t)&&!Mg(t)))}function $N(e,t){if(!KN(e,t))return!1;if(!t)return!0;if(Mg(t)){const e=t.voiceover?.metadata.alignment?.[0];return!e||Boolean(e.extra?.isScratch)}return!1}function KN(e,t){return!e.recordingSession&&!e.isScriptClip&&!e.visual&&e.text.string.length>0&&!wN(e)&&!WN(e,t)&&!function(e,t){const n=e.audioSegment;return!!n&&!WN(e,t)&&.1===n.duration}(e,t)||Boolean(t&&Mg(t))}const YN={type:"durationPerWord",durationPerWord:.4},ZN=(0,Yl.createCachedSelector)(((e,t)=>t.text.string),((e,t)=>t.defaultSpeaker),((e,t)=>t.audioSegment?.offset),((e,t,n)=>t.audioSegment?.duration),((e,t,n,r)=>{const o=function(e,t,n){const r=[];Zh.enumerateWords(e,(e=>(r.push(e),!1)));let o=0,i=1;"duration"===t.type?(i=t.duration/r.length,o=t.offset):i=t.durationPerWord;return zg(r.map(((e,t)=>Uh(e,o+i*t,o+i*(t+1),n,void 0,void 0,xL))))}(e,void 0===r||r<=0?YN:{type:"duration",offset:n??0,duration:r},t);if(0!==o.length)return o}))({...yp("xScratchTextLinkedSubAlignment"),keySelector:lm}),JN=em("computeSubAlignmentMediaDomain");function QN(e,t,n,r){if(!n&&void 0!==e&&void 0!==t&&r)return gL(zg(r),e,t)}const XN=em("computeSubAlignment");function eP(e,t,n){return!e||void 0===n||1===n||n<=0||void 0===t?e:zg(Zg(e).map((e=>{const r=e.startTime-t,o=e.endTime-t;return{...e,startTime:t+r/n,endTime:t+o/n}})))}function tP(e,t){return!!(e&&t&&_L(e,t))||e===t}function nP(e,t,n){const{audioSegment:r}=t,o=function(e,t,n,r,o,i,a,s,c,d,l,u,f,m,p){const g=n.get(t)?.result,h=qf(e,t,n,o,i,a,s,c,d,l,u,f,m,p),v=n.get(t);if(!v)throw new Error("No cache entry after fastMemo");return g&&r(h,g)?(v.result=g,g):h}(QN,lm(e,t),JN,tP,r?.offset,r?.duration,r?.isFreezeFrame,r&&wF(r)?n?.voiceover?.metadata.alignment:void 0);return!o?.length&&KN(t,n)?ZN(e,t):o}function rP(e,t,n){const{audioSegment:r}=t;return qf(eP,lm(e,t),XN,nP(e,t,n),r?.offset,r?.speed)}const oP=em("xpreviousWordRangesResults");function iP(e,t,n){if(_L(e,n.subAlignment)&&t===n.textStr)return n;const{textStr:r}=n,o=function(e,t,n=BN){return jN(e.buffer,e.offset,e.length,t.buffer,t.offset,t.length,n)}(n.subAlignment,e,Lh),{loc:i,added:a,removed:s}=vc(r,t,bs);let c=i,d=i+s;if(o.added>0||o.removed>0){const e=n.wordRanges;if(o.loc<e.length){const t=e[o.loc].location;c=Math.min(c,t)}if(o.removed>0){const t=$s(e[o.loc+o.removed-1]);d=Math.max(d,t)}}const l=a-s,u=r.length-d;let f=[],m=[],p=[],g=[];if(c>0){const e=qk(n.wordRangesWithPunc,c),t=e.match?e.match.index:e.previous?e.previous.index+1:void 0;void 0!==t&&(f=pu(n.wordRanges,t),m=pu(n.wordRangesWithPunc,t))}if(u>0){const e=qk(n.wordRangesWithPunc,d),t=e.match?e.match.index+1:e.next?e.next.index:void 0,r=({location:e,length:t})=>Gs.get(e+l,t);void 0!==t&&(p=n.wordRanges.slice(t).map(r),g=n.wordRangesWithPunc.slice(t).map(r))}if(f.length>e.length-p.length)return;const h=Gg(e,f.length,e.length-p.length-f.length),v=f.length>0?$s(f[f.length-1]):0,E=vL(h,t.substring(v,p.length>0?p[0].location:t.length));if(!E)return;const[y,S]=E,I=y.map((e=>Gs.get(v+e.location,e.length))),b=S.map((e=>Gs.get(v+e.location,e.length)));return{subAlignment:e,textStr:t,wordRanges:gu(f,I,p)??[],wordRangesWithPunc:gu(m,b,g)??[]}}function aP(e,t){const n=vL(e,t);if(!n)return;const[r,o]=n;return{textStr:t,subAlignment:e,wordRanges:r,wordRangesWithPunc:o}}function sP(e,t,n){return n&&function(e){return e.length>0}(e)?iP(e,t,n):aP(e,t)}const cP=(0,Yl.createCachedSelector)(lm,((e,t,n)=>rP(e,t,n)),((e,t)=>t.text.string),(function(e,t,n){if(!t)return;const r=sP(t,n,oP.get(e));if(r)return oP.set(e,r),new $k(t,r.wordRanges,r.wordRangesWithPunc);oP.remove(e)}))({...yp("xTauLinkedSubAlignment"),selectorCreator:hp(gp(0,pp())),keySelector:lm});function dP(e,t){const n=e.defaultSpeaker?.speakerId??"",r=t?.backendVoiceId??"",o=e.defaultSpeaker?.styleId??"";return VN(e.text.string.trim())^VN(n)^VN(r)^VN(o)}function lP(e,t,n,r,o){if(t.isBlocked||e!==Jh.Composition&&e!==Jh.Sequence||!KN(t,n))return!1;const i=o?.tau||t;r=o?o.defaultSpeaker:r;const a=void 0!==i.audioSegment?.mediaRefId,s=Boolean(i.overdubInfo),c=r?.backendVoiceId,d=i.defaultSpeaker;if(!a&&!s&&(!d||void 0===c))return!1;const l=dP(i,r),u=i.overdubInfo;if(u&&"taskKey"in u&&u.taskKey===l)return!1;if(void 0===As.index(i.text.string))return!1;if(u?.isRegeneration)return!1;const f=r&&function(e){return void 0!==e.backendVoiceId&&(x_(e)?"verified"===e.consentStatus:e.backendVoiceVersionStatus===A_.Done)}(r);return!(!u&&!f)}const uP=(0,Yl.createCachedSelector)(lm,rP,((e,t)=>t.text.string),((e,t,n)=>{if(!t)return!1;return!!sP(t,n,oP.get(e))}))({...yp("xHasLinkedSubAlignment"),keySelector:lm});function fP(e,t,n,r,o,i){return!!HN(n,r)&&(!function(e,t,n,r,o){if(lP(e,t,n,r,o))return!0;if(n&&Mg(n))return!0;const i=t.overdubInfo?.state;return void 0!==i&&"done"!==i}(t,n,r,o,i)&&(!(!function(e,t,n){const r=rP(e,t,n);return Boolean(r&&r.length>0)}(e,n,r)&&void 0===Ms.index(n.text.string))&&!uP(e,n,r)))}function mP(e){const t=vu(e.attributes,(e=>e.attribute.name===Gu.Annotation));if(0!==t.length)return t}function pP(e,t){return Boolean(e.audioSegment&&t?.video&&CF(e.audioSegment)&&!e.audioSegment.isFreezeFrame)}class gP extends Map{remove(e){this.delete(e)}}const hP=vP;function vP(e,t=new gP){return n=>{const r=t.get(n);if(void 0!==r)return r;{const r=e(n);return t.set(n,r),r}}}function EP({box:e},t){return e?{width:e.width*t.width,height:e.height*t.width}:t}function yP({position:e,targetPosition:t=e},n){return{dx:(t.x-e.x)*n.width,dy:(t.y-e.y)*n.height}}function SP(e){switch(e.type){case"captions":case"title":case"dynamicText":return"title";case"waveform":return"waveform";case"progress":return"progress";default:return"shape"}}function IP(e){return"line"===(t=e.type)||"arrow"===t;var t}function bP(e,t){return Lx(e,t).taus}function TP(e,t,n){return GV(e,t).tausAndDataBasic().getTauDataMaybe(n)?.tau}function wP(e,t,n){return GV(e,t).tausAndDataBasic().getTauData(n).tau}function*CP(e,t,n=!1){for(const r of Wk(e,t,n)){const n=r.id;for(const o of bP(e,n))o.audioSegment?.mediaRefId===t&&(yield[r,o])}}function _P(e,t){return Ya(Lx(e,t).taus)}function AP(e,t){const n=Lx(e,t).taus;return n.length>0?n[n.length-1]:void 0}function RP(e,t,n){return _P(e,t)?.id===n}function MP(e,t,n){const r=GV(e,t).tausAndDataBasic().getTauData(n).index;return P()(void 0!==r,"Expected tau to belong to this superTau"),r}function DP(e,t,n){let r=MP(e,t,n);r+=1;const o=Lx(e,t);if(r!==o.taus.length)return o.taus[r]}function OP(e,t,n){let r=MP(e,t,n);if(r-=1,-1===r)return;return Lx(e,t).taus[r]}function xP(e,t,n){const{getTauData:r,taus:o}=GV(e,t).tausAndDataBasic(),{index:i}=r(n);for(let a=i-1;a>=0;a--){const e=o[a];if(!e.isBlocked)return e}}function kP(e,t,n,r=!1){const o=NP(e,t,n,{includeAdjacentTaus:r});return zg(bP(e,t),o.location,o.length)}function NP(e,t,n,{includeAdjacentTaus:r=!1,framerates:o}={}){const i=rp(n),a=n.offset,{tausData:s}=GV(e,t).tausAndDataBasic(),c=o?py(o):void 0;if(Ed(i,0,c)&&!r)return Gs.get(0,0);const d=_k(e,t);if(Sd(a,d,c))return Gs.get(s.length,0);const l=rh(s,(({timeOffset:e})=>ih(e-a,c)));let u=0;if(l.match){const e=l.match.index;u=r?Math.max(e-1,0):e}else u=l.previous?.index??0;const f=rh(s,(({timeOffset:e})=>ih(e-i,c)));let m=s.length;if(f.match){const e=f.match.index;m=r?Math.min(e+1,s.length):e}else m=f.next?.index??s.length;return Gs.getStartEnd(u,m)}function PP(e,t,n){return GV(e,t).tausAndDataBasic().getTauData(n).renderedText}function LP(e,t,n){return GV(e,t).tausAndDataBasic().getTauData(n).wordCounter()}function FP(e,t,n){return GV(e,t).tausAndDataBasic().getTauData(n).timeOffset}function UP(e,t,n,{preferPreviousTau:r=!1}={}){hd(n,0)&&(n=0),P()(n>=0,"Expected time offset to be non-negative");const{tausData:o}=GV(e,t).tausAndDataBasic(),i=rh(o,(e=>r?Ed(n,e.timeOffset)?Ie.OrderedDescending:yd(n,e.timeOffset+e.duration)?Ie.OrderedAscending:Ie.OrderedSame:ah(n,e.timeOffset,e.timeOffset+e.duration))),a=(i.match??i.previous??(r?i.next:void 0))?.value.tau;if(a?.isBlocked){const n=xP(e,t,a.id);if(n)return n}return a}function BP(e,t,n){return GV(e,t).tausAndDataBasic().getTauData(n).duration}function jP(e,t,n){const r=BB(e,t);P()(void 0!==r,"Pin does not exist");const{pin:o,composition:i}=r;if(e.isStoryboard){const r=zB(e,i.id,o),{getTauData:a}=GV(e,t).tausAndDataBasic(),{timeOffset:s,duration:c}=a(n),d=Math.max(r-s,0);return Math.min(c,d)}return BP(e,t,n)}function VP(e,t,n){return vk(e,t).type===Jh.Pin?jP(e,t,n):BP(e,t,n)}function zP(e,t,n,r){const{videoMetadata:o}=vk(e,t);let i=n+r;return o&&r>0&&(i-=1/py(o)),i}function GP(e,t,n,r){const o=e.audioSegment?.offset??0,{match:i,next:a,previous:s}=t.searchForTimeOffset(n+o);let c,d,l;if(r&&void 0!==e.audioSegment&&(void 0===e.overdubInfo||e.overdubInfo.isRegeneration)){const r=function(e,t,n,r,o){P()(void 0!==e.audioSegment,"audioSegment must be defined");const i=e.audioSegment.offset||0;if(!r&&o&&n)return vB(e,n,o);if(n)return vB(e,n,r);if(r&&t+i>r.startTime)return vB(e,r,o);if(r)return vB(e,void 0,r);return vB(e,void 0,o)}(e,n,s?.value,i?.value,a?.value);if(lB(r,void 0===s,t)){if(a)c=a.value.startTime-(n+o),l=!0;else if(i)c=void 0;else{c=(e.audioSegment?.duration||0)-n}if(void 0!==s&&void 0!==c&&c>0){c>r-yE(t)&&(d=!0,c=void 0)}}}let u=0;return s&&d?u=s.value.rangeWithPunc.location:i?u=i.value.rangeWithPunc.location:a?u=a.value.rangeWithPunc.location:s&&(u=$s(s.value.rangeWithPunc)),{wordOffset:u,gapOffset:c,includeGapPrefix:d,includeGapSuffix:l}}function WP(e,t,n,r){return HP(e,t,n,r,!1).wordOffset}function HP(e,t,n,r,o){const i=wP(e,t,n);if(i.isBlocked||i.isScriptClip)return{wordOffset:0,gapOffset:o?r:void 0};const a=dN(e,t,i);if((void 0!==i.preCorrectionText||!i.ignoreAlignment)&&a)return GP(i,a,r,o);if(i.audioSegment&&i.audioSegment.duration>0){if(o)return{wordOffset:0,gapOffset:r};const a=LP(e,t,n),s=a.totalWords/i.audioSegment.duration,c=Math.trunc(s*r);return{wordOffset:a.offsetAtWordCount(c)}}return{wordOffset:0,gapOffset:o?r:void 0}}function qP(e,t,n,r){const{ignoreAlignment:o,audioSegment:i,text:{string:{length:a}},isScriptClip:s,isBlocked:c}=e,d=wN(e),l=hP((e=>{if(P()(Number.isInteger(e),"Expected offset to be an integer"),s){if(!i)return 0;return e>t.indexOf(IE.string)?_F(i):0}if(d)return 0;if(!o&&n){const{match:t,next:r,previous:o}=n.searchForTextOffset(e),a=t||r;if(a){const t=a.value;return n.length>0&&t.equals(n.elementAt(0))&&e<=t.range.location?0:i?Math.min(_F(i),Math.max(0,t.startTime-i.offset)):t.startTime}if(o){if(i)return _F(i);if(n.length>0)return n.elementAt(n.length-1).endTime}return 0}if(i){if(0===i.duration)return 0;if(e>=a)return _F(i);const t=r.totalWords/_F(i);if(0===t)return 0;return Math.max(0,r.wordCountAtOffset(e))/t}return 0}));return(e,t=!0)=>c&&t?0:l(e)}function $P(e,t,n,r,o=!0){return GV(e,t).tausAndDataLinkedSub().getTauData(n).getTimeOffsetForTextOffset(r,o)}function KP(e,t){return e.visual?SP(e.visual):t?ON(e,t)?"video":RN(e,t)?"audio":t.image?"image":void 0:void 0}function YP(e,t){return KP(t,ZP(e,t))}function ZP(e,t){return void 0!==t.audioSegment?.mediaRefId?Pp(e,t.audioSegment.mediaRefId):void 0}function JP(e,t,n){return QP(e,wP(e,t,n))}function QP(e,{audioSegment:t}){if(!t||void 0===t.mediaRefId)return;const n=Pp(e,t.mediaRefId);return Cg(n)?n:void 0}function XP(e,t,n){return eL(e,wP(e,t,n))}function eL(e,t){const n=QP(e,t);if(n&&n.voiceover)return n}function tL(e,t){let n=1/0;if(wN(t))return n;const r=void 0!==t.audioSegment?.mediaRefId?Pp(e,t.audioSegment.mediaRefId):void 0;if(!t.audioSegment)return n;const{offset:o,speed:i}=t.audioSegment,a=r?Nk(r):void 0;return void 0!==a&&(n=(a-o)/i),n}function nL(e,t,n){return GV(e,t).tausAndDataForBasicAttributedString().getTauData(n).textOffset}const{equalFrameCounts:rL,lessThanOrEqualFrameCounts:oL,lessThanFrameCount:iL,greaterThanOrEqualFrameCounts:aL}=s,sL=.5;function cL(e,t){const n=e.startTime;if(!(n>=t)){if(rL(n,t)){if(aL(t,e.endTime))throw new Error("Creating invalid word array: word with no duration");return{...e,startTime:t}}throw new Error("Creating invalid word array: startTime < previous endTime")}}function dL(...e){let t=[],n=0;for(const o of e)if(o&&0!==o.length)if("object"===typeof(r=o)&&Array.isArray(r.buffer)&&"number"===typeof r.length&&"number"===typeof r.offset){const e=cL(Wg(o,0),n);let r=0;e&&(t.push(e),r=1);for(const n of rs(Kg(o),r))t.push(n);n=qg(o).endTime}else{const e=cL(o[0],n);e?(t.push(e),t=t.concat(o.slice(1))):t=t.concat(o),n=o[o.length-1].endTime}var r;return t}function lL(e,t,n){if(e===t)return!0;if(void 0===e||void 0===t)return!1;if(_L(e,t))return!0;const r=e.length;if(r!==t.length)return!1;for(let o=0;o<r;o++)if(!n(Wg(e,o),Wg(t,o)))return!1;return!0}function uL(e,t){if(t)return t.index-=e.offset,t}function fL(e){let t=0;for(const n of Kg(e)){if(n.startTime<0)throw new Error("Invalid word array (word.startTime < 0)");if(n.startTime<t)throw new Error("Invalid word array (word.startTime < lastEnd)");if(n.endTime<=n.startTime)throw new Error("Invalid word array (word.endTime <= word.startTime)");t=n.endTime}}function mL(e,t){let n=0;const r=e.length;let o=!0;return Zh.enumerateWords(t,((t,i,a,s)=>{if(!(n<r))return o=!1,!0;{const r=Wg(e,n);if(n+=1,!Ph(r,t,i))return o=!1,!0}return!1})),!(n<r)&&o}function pL(e,t){const{buffer:n,offset:r,length:o}=e;return function(e,t){return t.previous=uL(e,t.previous),t.match=uL(e,t.match),t.next=uL(e,t.next),t}(e,eh(n,r,r+o,(e=>t<e.startTime?Ie.OrderedDescending:iL(t,e.endTime)?Ie.OrderedSame:Ie.OrderedAscending)))}function gL(e,t,n,r=sL){const{buffer:o,offset:i,length:a}=e,{next:s}=eh(o,i,i+a,(e=>hd(e.endTime,t)||e.endTime<t?Ie.OrderedAscending:Ie.OrderedDescending)),{previous:c}=eh(o,i,i+a,(e=>hd(e.startTime,t+n)||e.startTime>t+n?Ie.OrderedDescending:Ie.OrderedAscending));let d=s&&s.index,l=c?c.index:i;c||d!==i||(d=void 0);const u=Math.min(Math.max(r,0),1);if(u>0&&void 0!==d&&o.length>0){const e=u<1;if(d!==l){const r=o[d],i=(r.endTime-r.startTime)*u;(!e||!Rh(r))&&r.startTime<t&&r.endTime-t<i&&(d+=1);const a=o[l],s=(a.endTime-a.startTime)*u;(!e||!Rh(a))&&a.endTime>t+n&&t+n-a.startTime<=s&&(l-=1)}else{const r=o[d],i=(r.endTime-r.startTime)*u,a=Math.max(r.startTime,t),s=Math.min(r.endTime,t+n);e&&Rh(r)||!(s-a<i)||(d=void 0)}}return void 0!==d?zg(o,d,d<=l?l+1-d:0):zg(o,0,0)}function hL(e,t,n,r=0){const o=gL(e,t,n,r);if(0===o.length||aL(Hg(o).startTime,t)&&oL(qg(o).endTime,t+n))return o;const i=Zg(o),a=i[0];a.startTime<t&&(i[0]={...a,startTime:t});const s=i[i.length-1];return s.endTime>t+n&&(i[i.length-1]={...s,endTime:t+n}),zg(i)}function vL(e,t){const{buffer:n,offset:r,length:o}=e;let i=!0,a=0;const s=Math.max(Math.min(r+o,n.length)-r,0),c=new Array(s),d=new Array(s);if(Zh.enumerateWords(t,((t,n,r,o,l,u)=>a>=s?(i=!1,!0):Ph(Wg(e,a),t,n)?(c[a]=Gs.get(r,o),d[a]=Gs.get(l,u),a+=1,!1):(i=!1,!0))),!(a<s)&&i)return[c,d]}function EL(e){return function(e,t){let n=!0,r="";for(const o of e)n?(r=o,n=!1):r+=t+o;return r}(Qa(Kg(e),(({word:e})=>e))," ")}const yL=/[.!?]"?$/,SL=3,IL=300,bL="\n";function TL(e,{timeDelta:t=SL,characterThreshold:n=IL,separator:r=bL}={}){P()(t>0,"expected timeDelta to be positive"),P()(r.length>0,"expected separator to contain at least one character");let o,i,a,s=EL(e),c=0,d=0;const l=r.length;let u=0;for(const f of Kg(e))if(a||(a=f,d=0),d+=f.word.length+1,o=i,i=f,o&&i){u+=o.word.length+1;const e=i.startTime-o.endTime>=t,f=d>=n&&yL.test(o.word);if(e||f){const e=1,t=s.substring(0,u-1+c),n=s.substring(u+c);s=`${t}${r}${n}`,c+=l-e,a=i,d=i.word.length+1}}return s}function wL(e,t,n){if(e.length<=0)return;const r=zk(t,n.transcriptVoiceoverRefId),o=_P(t,n.id);if(!o)return;const i=Hg(e).startTime,a=qg(e).endTime;let s;if(function({buffer:e,offset:t,length:n}){return 0===t&&e.length===n}(e)||hd(i,0)&&hd(a,r.audio.duration))s=PP(t,n.id,o.id);else{const e={offset:i,duration:a-i};s=function(e,t,n,r){const o=wP(e,t,n);if(o.isScriptClip)return PP(e,t,n);const i=np(r),a=rp(r),s=WP(e,t,n,i),c=WP(e,t,n,a),d=eR(e,t,n,Gs.get(s,c-s)),l=xm(o.text,d).string;let u=0,f=l.length;for(;u<f&&bs.contains(l.charAt(u));)u+=1;for(;u<f&&bs.contains(l.charAt(f-1));)f-=1;const m=Gs.get(s+u,f-u);return xm(o.text,m)}(t,n.id,o.id,e)}return s&&mL(e,s.string)?s:void 0}function CL(e,t,n,r){let o,i;if(t!==Jh.Transcript&&void 0!==r&&(i=bG(e,r),i&&(o=wL(n,e,i))),!o){o=bm(TL(n))}return o}function _L(e,t){return e===t||e.length===t.length&&e.offset===t.offset&&e.buffer===t.buffer}function AL(e,t,n,r,o,i){const a=Math.sign(r),s=Math.sign(o);if(a!==s||n<=0)return 0;const c=zg(e),d=gL(c,t,n),l=gL(c,t,n,0),u=gL(c,t,n,1);let f=r;do{if(n+f<=0){f-=o;continue}const e=gL(c,t,n+f+i),r=gL(c,t,n+f+i,0),a=gL(c,t,n+f+i,1);if(_L(d,e)&&_L(l,r)&&_L(u,a))return f;f-=o}while(s*f>0);return 0}function RL(e,t){const{length:n,buffer:r,offset:o}=e;let i=0,a=!0,s=0;if(Zh.enumerateWords(t,((t,r,o,c)=>i<n&&Ph(Wg(e,i),t,r)?(s=o+c,i+=1,!1):(s=o,a=!1,!0))),a&&(s=t.length),i>0||s>0)return[zg(r,o,i),s]}function ML(e,t,n=!1){const{buffer:r}=e,o=[],i=[],a=[],s=[];Zh.enumerateWords(t,((e,t,n,r)=>(o.push(e),i.push(t),a.push(n),s.push(r),!1)));let c=t.length;if(0===o.length)return 0===r.length?[zg(e.buffer,e.offset,0),0]:void 0;let d=$g(e),l=o.length,u=!1;for(;;){if(0===l){u=!0;break}const t=o[l-1],n=i[l-1];if(d<=e.offset||!Ph(r[d-1],t,n))break;c=a[l-1],d-=1,l-=1}return u?c=0:n&&l>0&&l<o.length&&(c=a[l-1]+s[l-1]),d<r.length?[zg(r,d,e.offset+e.length-d),c]:void 0}function DL(e,t,{subAlignmentTimeRange:n,transcriptTrackAndDoc:r,allowEmptyString:o,previousAlignment:i,preferSuffix:a=!1,ignoreNewline:s=!1}){let c,d,l,u;if(a){let[n,r]=ML(e,t.string)||[zg(e.buffer,$g(e),0),t.string.length];l=n;const o=zg(e.buffer,e.offset,l.offset-e.offset),i=t.string.substring(0,r);[c,d]=RL(o,i)||[zg(e.buffer,e.offset,0),0],s&&"\n\n"===t.string?(r=1,d=1,u=1):(s&&"\n"===t.string.substr(r-1,1)&&(r-=1),u=Math.max(0,r-d))}else{[c,d]=RL(e,t.string)||[zg(e.buffer,e.offset,0),0],s&&"\n"===t.string.substr(d-1,1)&&(d-=1);const n=zg(e.buffer,e.offset+c.length,e.length-c.length),r=t.string.substring(d,t.string.length);[l,u]=ML(n,r)||[zg(e.buffer,$g(e),0),r.length]}const f=0===c.length?e.offset:$g(c),m=0===l.length?e.offset+e.length:l.offset;P()(f<=m,"Expected middle start index to be before middle end index");const p=xm(t,Gs.get(0,d)),g=xm(t,Gs.get(d+u,t.string.length-d-u)),h=zg(e.buffer,f,m-f);let v=(r&&wL(h,r.doc,r.transcriptTrack))??bm(EL(h));const E=Yk(t,n,d,u,c,h,l,e.buffer,i,v);v=E.middleAttrStr;const y=E.droppedAttributes;let S,I;S=f===m||f===e.offset||p.string.length>0&&bs.contains(p.string.charAt(p.string.length-1))||v.string.length>0&&bs.contains(v.string.charAt(0))?"":" ",I=m===f||m===$g(e)||g.string.length>0&&bs.contains(g.string.charAt(0))||v.string.length>0&&bs.contains(v.string.charAt(v.string.length-1))?"":" ";const b=Cm([S,v,I]);let T=Cm([p,b,g]),w=0;0===p.string.length?w=0===b.string.length?-(d+u):b.string.length:0===c.length&&0===b.string.length&&(w=-u),o||0!==T.string.length||(T=bm(" "));return{attributedString:T,headDelta:w,insertionRange:Gs.get(d,u),newCharacters:b,droppedAttributes:y}}function OL(e){return e.length>0?e[e.length-1].endTime:0}const xL={isScratch:!0};var kL=(e=>(e.ConnectivityFailure="connectivityFailure",e.UploadFailure="uploadFailure",e.ExternalServiceFailure="externalServiceFailure",e.AlignmentFailure="alignmentFailure",e.UnknownFailure="unknownFailure",e.CompressionFailure="compressionFailure",e.PreauthorizationFailure="preauthorizationFailure",e.AuthorizationFailure="authorizationFailure",e.NoUserFailure="noUserFailure",e))(kL||{}),NL=(e=>(e.LongformAlignment="LongformAlignment",e.SpeechRecognition="SpeechRecognition",e))(NL||{});const PL="includeMediaMetadata",LL="includeAssetJsons",FL=10;function UL({id:e=Ps(),assetKey:t,displayName:n=t,isBounced:r=!1,audio:o,voiceover:i,video:a,image:s,font:c,generativeMedia:d,source:l,assetJson:u,recordingFilePath:f,isGlobalAsset:m,assetGuid:p,assetLocalId:g,noTranscript:h}){const v=void 0!==t?t:e;return{id:e,assetKey:v,displayName:void 0!==n?n:v,isBounced:r,audio:o,voiceover:i,video:a,image:s,font:c,generativeMedia:d,source:l,assetJson:u,recordingFilePath:f,noTranscript:h,...uF({isGlobalAsset:m,assetGuid:p,assetLocalId:g,assetJson:u})}}function BL({id:e=Ps(),assetKey:t,displayName:n=t,isBounced:r=!1,audio:o=zL(),video:i,source:a,assetJson:s,recordingFilePath:c,voiceover:d,isGlobalAsset:l,assetGuid:u,assetLocalId:f}){const m=void 0!==t?t:e;return{id:e,assetKey:m,displayName:void 0!==n?n:m,isBounced:r,audio:o,voiceover:d,video:i,image:void 0,font:void 0,generativeMedia:void 0,source:a,assetJson:s,noTranscript:void 0,recordingFilePath:c,...uF({isGlobalAsset:l,assetGuid:u,assetLocalId:f,assetJson:s})}}function jL(e){if("font"===e.source)return xu.mediaFontReference;if(e.audio)return e.voiceover?xu.mediaVoiceoverReference:xu.mediaAudioReference;if(e.video)return xu.mediaVideoReference;if(e.image)return xu.mediaImageReference;throw new Error("Ref has no audio, video, nor image")}function VL(e,t){const{id:n,displayName:r,isBounced:o,type:i,source:a,isGlobalAsset:s,assetGuid:c,assetLocalId:d,noTranscript:l}=e,u=Lk(e),f=sE(u),m=i===xu.mediaAudioReference,p=i===xu.mediaVoiceoverReference;let g=function(e,t){const{duration:n,perChannelRefs:r,trackSceneIds:o,defaultVoiceId:i,defaultGain:a,diarization:s,diarizationTaskId:c,diarizationWizardResult:d,appliedDiarizationWizardResult:l,diarizationRequested:u,localAssetKey:f,analyses:m,roomtoneTaskId:p,roomtoneRefId:g,roomtoneRequested:h,speechEnhanceEnabled:v,studioSoundIntensity:E,isScratchText:y,energies:S}=e;if(void 0===n&&void 0===r&&void 0===o)return;return zL({duration:n,defaultVoiceId:void 0!==i?t.decodeReferenceId(i):void 0,defaultGain:a,LEGACY_perChannelRefs:r&&r.map((e=>t.decodeReferenceObjectId(e))),trackSceneIds:o&&o.map((e=>t.decodeReferenceId(e,!0))),diarization:s,diarizationTaskId:c,diarizationWizardResult:d,appliedDiarizationWizardResult:l,diarizationRequested:u,localAssetKey:f,analyses:m,roomtoneTaskId:p,roomtoneRefId:void 0!==g?t.decodeReferenceId(g,!0):void 0,roomtoneRequested:Boolean(p||g||h),speechEnhanceEnabled:v,studioSoundIntensity:void 0===E&&v?1:E,isScratchText:y,energies:S})}(e,t);g||!m&&!p||(g=zL());const h=!(Boolean(g?.trackSceneIds)||"descriptRecordingInProgress"===a||s),v=t.assetJsonForAssetKey(u,h);return UL({id:n,assetKey:u,displayName:r,isBounced:Boolean(o),audio:g,voiceover:ZL(e,t,f,p&&!o),video:qL(e),image:GL(e),font:WL(e),generativeMedia:HL(e),source:a,assetJson:v,...uF({isGlobalAsset:s,assetGuid:c,assetLocalId:d,assetJson:v}),noTranscript:l})}function zL({duration:e=0,LEGACY_perChannelRefs:t,trackSceneIds:n,isScratchText:r,channelCount:o,defaultVoiceId:i,defaultGain:a,diarization:s,diarizationTaskId:c,diarizationWizardResult:d,appliedDiarizationWizardResult:l=!1,diarizationRequested:u=!1,localAssetKey:f,analyses:m,roomtoneTaskId:p,roomtoneRefId:g,roomtoneRequested:h=!1,speechEnhanceEnabled:v=!1,studioSoundIntensity:E,energies:y}={}){return{duration:e,LEGACY_perChannelRefs:t,trackSceneIds:n,isScratchText:r,channelCount:o,defaultVoiceId:i,defaultGain:a,diarization:s,diarizationTaskId:c,diarizationWizardResult:d,appliedDiarizationWizardResult:l,diarizationRequested:u,localAssetKey:f,analyses:m,roomtoneTaskId:p,roomtoneRefId:g,roomtoneRequested:h,speechEnhanceEnabled:v,studioSoundIntensity:E,energies:y}}function GL({imageHeight:e,imageWidth:t,backgroundMaskRequested:n}){if(void 0!==e&&void 0!==t)return{height:e,width:t,backgroundMaskRequested:n}}function WL({source:e,isFree:t}){if("font"===e)return{isFree:Boolean(t)}}function HL({generationId:e,generationCreatedAt:t,generationPrompt:n,generationStyles:r,generationSourceMediaRefId:o,isGenerativeMediaVisible:i}){if(void 0!==e&&void 0!==n&&void 0!==t)return{generationId:e,createdAt:t,prompt:n,styles:r||[],sourceMediaRefId:o,visible:i||!1}}function qL({duration:e,videoDuration:t,videoHeight:n,videoWidth:r,videoFramerateDenominator:o,videoFramerateNumerator:i,videoRotation:a,backgroundMaskRequested:s,eyeContactRequested:c}){if(void 0===t&&(t=e),void 0!==t&&void 0!==n&&void 0!==r&&void 0!==i&&void 0!==o)return{duration:t,height:n,width:r,framerateNumerator:i,framerateDenominator:o,rotation:a,backgroundMaskRequested:s,eyeContactRequested:c}}function $L({voRefMetadataVersion:e=1,alignment:t,recognition:n,recognitionChunkBoundaries:r,assetJson:o=cE(),alignmentSource:i}={}){return{voRefMetadataVersion:e,alignment:t,recognition:n,recognitionChunkBoundaries:r,assetJson:o,alignmentSource:i}}function KL({recognitionFailed:e=!1,recognitionError:t,wasImportedForAlignment:n=!1,wasRecordedInDescript:r=!1,transcriptReceiptId:o,transcriptionType:i,transcriptionLanguage:a,humanPoweredTranscriptReceiptId:s,metadata:c=$L(),regenerateRecognition:d=!1,isReceiptProcessing:l,errorDetectionTaskId:u,appliedErrorDetectionResult:f}={}){return{recognitionFailed:e,recognitionError:t,wasImportedForAlignment:n,wasRecordedInDescript:r,transcriptReceiptId:o,transcriptionType:i,transcriptionLanguage:a,humanPoweredTranscriptReceiptId:s,metadata:c,regenerateRecognition:d,isReceiptProcessing:l,errorDetectionTaskId:u,appliedErrorDetectionResult:f}}function YL(e){if(e===NL.LongformAlignment||e===NL.SpeechRecognition)return e}function ZL(e,t,n,r){const o=eF(e,t,n,r),{recognitionFailed:i,recognitionError:a,wasImportedForAlignment:s,wasRecordedInDescript:c,transcriptReceipt:d,transcriptionType:l,transcriptionLanguage:u,humanPoweredTranscriptReceipt:f,isReceiptProcessing:m,errorDetectionTaskId:p,appliedErrorDetectionResult:g}=e;return void 0===i&&void 0===a&&void 0===s&&void 0===c&&void 0===d&&void 0===l&&void 0===u&&void 0===f&&void 0===o&&void 0===m&&void 0===p&&void 0===g?r?KL():void 0:KL({recognitionFailed:i,recognitionError:a&&(kL[a]||kL.UnknownFailure)||void 0,wasImportedForAlignment:s,wasRecordedInDescript:c,transcriptReceiptId:d,transcriptionType:void 0!==l?YL(l):void 0,transcriptionLanguage:u,humanPoweredTranscriptReceiptId:f,metadata:o,isReceiptProcessing:m,errorDetectionTaskId:p,appliedErrorDetectionResult:g})}function JL(e){return Qm(["offset","duration","sceneId","tauId"],e)}function QL(e){return Xm(e)}function XL(e,t){if(void 0===e)return{decodedWords:void 0,didChange:!1};const n=[],r=zh(e,n,t);return fL(zg(n)),{decodedWords:n,didChange:r}}function eF(e,t,n,r){let o=t.decodedMetadataForAssetKey(n);if(o)try{!function({alignment:e,recognition:t},n){e&&tF(e,n);t&&tF(t,n)}(o,t)}catch(a){Ht(a,"decode-voiceover-metadata"),o=void 0}const i=t.encodedMetadataForAssetKey(n,r)??e;return o||(i?function({alignment:e,recognition:t,recognitionChunkBoundaries:n,alignmentSource:r},o,i,a){const s=o.assetJsonForAssetKey(i,a);if(!e&&!t&&!n&&!r&&!s)return;let c=o.regenerateAssetJsons;const{didChange:d,decodedWords:l}=XL(e,o);c=c||d;const{didChange:u,decodedWords:f}=XL(t,o);return c=c||u,$L({alignment:l,recognition:f,recognitionChunkBoundaries:n&&(m=n,Xm(m)),assetJson:c?cE():s,alignmentSource:r&&QL(r)});var m}(i,t,n,r):void 0)}function tF(e,t){const n=new Set;for(const r of e){const e=r.speaker?.speakerId;if(void 0===e)continue;if(n.has(e))continue;if(t.decodeReferenceId(e)!==e)throw new Error("Speaker id in decoded word not reference id");n.add(e)}}function nF(e,t){const{id:n,assetKey:r,displayName:o,isBounced:i,audio:a,voiceover:s,video:c,image:d,font:l,generativeMedia:u,source:f,isGlobalAsset:m,assetGuid:p,assetLocalId:g,noTranscript:h}=e;return{type:jL(e),id:n,basename:r,displayName:o,hasMetadata:Boolean(e.voiceover),isBounced:i||void 0,...a&&oF(a,t),...s&&dF(s),...t.encodingOptions[PL]&&s&&lF(s,t),...c&&iF(c),...d&&aF(d),...l&&sF(l),...u&&cF(u),source:f,isGlobalAsset:m,assetGuid:p,assetLocalId:g,noTranscript:h}}function rF(e,t){for(const n of ku)try{return t.encodeReference(e,n)}catch{}throw new Error("Cannot encode object")}function oF({duration:e,trackSceneIds:t,defaultVoiceId:n,defaultGain:r,diarization:o,diarizationWizardResult:i,appliedDiarizationWizardResult:a,diarizationTaskId:s,diarizationRequested:c,localAssetKey:d,analyses:l,roomtoneTaskId:u,roomtoneRefId:f,roomtoneRequested:m,speechEnhanceEnabled:p,studioSoundIntensity:g,isScratchText:h,energies:v},E){return{duration:void 0!==e&&e>0?e:void 0,defaultVoiceId:void 0!==n?E.encodeReference(n,xu.speaker):void 0,defaultGain:r,diarizationTaskId:s,diarization:o,diarizationWizardResult:i,appliedDiarizationWizardResult:a||void 0,diarizationRequested:c||void 0,trackSceneIds:t?t.map((e=>E.encodeReference(e,xu.track,!0))):void 0,localAssetKey:d,analyses:l,roomtoneTaskId:u,roomtoneRefId:void 0!==f?E.encodeReference(f,xu.mediaAudioReference,!0,!1):void 0,roomtoneRequested:m||void 0,speechEnhanceEnabled:p||void 0,studioSoundIntensity:g,isScratchText:h,energies:v}}function iF({duration:e,width:t,height:n,framerateDenominator:r,framerateNumerator:o,rotation:i,backgroundMaskRequested:a,eyeContactRequested:s}){return{videoDuration:e,videoWidth:t,videoHeight:n,videoFramerateNumerator:o,videoFramerateDenominator:r,videoRotation:i,backgroundMaskRequested:a,eyeContactRequested:s}}function aF({width:e,height:t,backgroundMaskRequested:n}){return{imageWidth:e,imageHeight:t,backgroundMaskRequested:n}}function sF({isFree:e}){return{isFree:e}}function cF({generationId:e,createdAt:t,prompt:n,styles:r,sourceMediaRefId:o,visible:i}){return{generationId:e,generationCreatedAt:t,generationPrompt:n,generationStyles:r,generationSourceMediaRefId:o,isGenerativeMediaVisible:i}}function dF({recognitionFailed:e,wasImportedForAlignment:t,wasRecordedInDescript:n,transcriptReceiptId:r,transcriptionType:o,transcriptionLanguage:i,humanPoweredTranscriptReceiptId:a,recognitionError:s,isReceiptProcessing:c,errorDetectionTaskId:d,appliedErrorDetectionResult:l}){return{recognitionFailed:e||void 0,wasImportedForAlignment:t||void 0,wasRecordedInDescript:n||void 0,transcriptReceipt:r,transcriptionType:o,transcriptionLanguage:i,humanPoweredTranscriptReceipt:a,recognitionError:s,isReceiptProcessing:c,errorDetectionTaskId:d,appliedErrorDetectionResult:l}}function lF(e,t){const{voRefMetadataVersion:n,alignment:r,recognition:o,recognitionChunkBoundaries:i,alignmentSource:a}=e.metadata;return r&&fL(zg(r)),o&&fL(zg(o)),{voRefMetadataVersion:n,alignment:r&&Bh(r,t),recognition:o&&Bh(o,t),recognitionChunkBoundaries:i&&(s=i,Qm(["offset","duration"],s)),alignmentSource:a&&JL(a)};var s}function uF({isGlobalAsset:e,assetGuid:t,assetLocalId:n,assetJson:r}){const o=e??r?.is_global_asset;return{isGlobalAsset:o,assetGuid:o?t??r?.guid:void 0,assetLocalId:o?n??r?.local_id:void 0}}const{equalFrameCounts:fF,lessThanOrEqualFrameCounts:mF}=s,pF=.1,gF=30;function hF({mediaRefId:e,offset:t=0,duration:n=0,gain:r=1,audioFades:o,videoFades:i,suppressAutoMerge:a=!1,enableRoomtone:s,speed:c=1,effects:d=bu(),channels:l,isFreezeFrame:u,multicamSceneId:f}={}){return{mediaRefId:e,offset:t,duration:n,gain:r,audioFades:o,videoFades:i,suppressAutoMerge:a,enableRoomtone:s,speed:c,effects:d,channels:l,isFreezeFrame:u,multicamSceneId:f}}function vF(e,{timeRange:t,autolevel:n=!0,channels:r}={}){if(t){t=dp(t,0,Nk(e))}else t={offset:0,duration:(o=e,Nk(o)??6)};var o;return hF({mediaRefId:e.id,offset:t.offset,duration:t.duration,gain:n?e.audio?.defaultGain:void 0,channels:r})}function EF(e,t){const{offset:n,duration:r,mediaRefId:o,suppressAutoMerge:i,enableRoomtone:a,speed:s,effects:c,channels:d,audioFades:l,videoFades:u,isFreezeFrame:f,multicamSceneId:m}=e;return{...void 0!==o&&{ref:rF(o,t),offset:n},duration:r,audioFades:l&&fh(l),videoFades:u&&fh(u),...hh(e),suppressAutoMerge:i||void 0,enableRoomtone:a,speed:1===s?void 0:s,effects:c.length>0?aU(c,t):void 0,channels:d,isFreezeFrame:f,multicamSceneId:void 0!==m?t.encodeReference(m,xu.track):void 0}}function yF(e,t){const{duration:n,ref:r,offset:o,suppressAutoMerge:i,enableRoomtone:a,speed:s=1,effects:c,channels:d,audioFades:l,videoFades:u,isFreezeFrame:f,multicamSceneId:m}=e;return hF({duration:n,mediaRefId:void 0!==r?t.decodeReferenceId(r):void 0,offset:o,...vh(e),audioFades:mh(l||e),videoFades:u&&mh(u),suppressAutoMerge:i,enableRoomtone:a,speed:s,effects:c?cU(c,t):void 0,channels:d,isFreezeFrame:f,multicamSceneId:void 0!==m?t.decodeReferenceId(m):void 0})}function SF(e,t,n=!0,r=!0,o=!0,i=!0){return e?(0,T.Uy)(t,(t=>{!function(e,t,n=!0,r=!0){const o=t.duration;for(const i of LF){const a=e[i],s=t[i]||{...ph};if(n&&r){let e=0;void 0!==a?.fadeInDuration&&(e=a?.fadeInDuration);let t=0;void 0!==a?.fadeOutDuration&&(t=a?.fadeOutDuration);const n=e+t;n>o&&(e=e*o/n,t=o-e),s.fadeInDuration=void 0!==a?.fadeInDuration?e:void 0,s.fadeOutDuration=void 0!==a?.fadeOutDuration?t:void 0,s.fadeInShape=a?.fadeInShape,s.fadeOutShape=a?.fadeOutShape,s.headTransitionEffect=a?.headTransitionEffect,s.tailTransitionEffect=a?.tailTransitionEffect}else if(n){let e=0;if(void 0!==s.fadeOutDuration&&(e=s.fadeOutDuration),void 0!==a?.fadeInDuration){const t=Math.max(o-e,0);s.fadeInDuration=Math.min(a?.fadeInDuration,t)}else s.fadeInDuration=void 0;s.fadeInShape=a?.fadeInShape,s.headTransitionEffect=a?.headTransitionEffect}else if(r){let e=0;if(void 0!==s.fadeInDuration&&(e=s.fadeInDuration),void 0!==a?.fadeOutDuration){const t=Math.max(o-e,0);s.fadeOutDuration=Math.min(a?.fadeOutDuration,t)}else s.fadeOutDuration=void 0;s.fadeOutShape=a?.fadeOutShape,s.tailTransitionEffect=a?.tailTransitionEffect}void 0!==s.fadeInDuration||void 0!==s.fadeOutDuration||void 0!==s.fadeInShape||void 0!==s.fadeOutShape||void 0!==s.headTransitionEffect||void 0!==s.tailTransitionEffect?t[i]=s:t[i]=void 0}}(e,t,n,r),o&&(t.gain=e.gain),i&&(t.channels=e.channels),t.isFreezeFrame=e.isFreezeFrame,t.speed=e.speed,t.multicamSceneId=e.multicamSceneId})):t}function IF(e,t){return e.mediaRefId===t.mediaRefId&&e.gain===t.gain&&e.speed===t.speed}function bF(e,t,n=44100){return IF(e,t)&&fF(e.offset+e.duration,t.offset,n)}function TF({offset:e,duration:t}){return{offset:e,duration:t}}function wF({channels:e,isFreezeFrame:t}){return Boolean("video"!==e&&!t)}function CF({channels:e}){return"audio"!==e}function _F({speed:e,duration:t}){return t/e}function AF(e,t){return t===e.offset?e:{...e,offset:t}}function RF(e,t){return t===e.duration?e:{...e,duration:t}}function MF(e,t){return t===e.mediaRefId?e:{...e,mediaRefId:t}}function DF(e,t){return e.multicamSceneId===t?e:{...e,multicamSceneId:t}}function OF(e,t){return t===e.suppressAutoMerge?e:{...e,suppressAutoMerge:t}}function xF(e,t){return t===e.enableRoomtone?e:{...e,enableRoomtone:t}}function kF(e,t){return t?t===e.speed?e:{...e,speed:t}:(Ht(new Error("Speed cannot be falsy"),"AudioSegments.setSpeed"),e)}const NF=["audioFades"],PF=["videoFades"],LF=["audioFades","videoFades"];function FF(e,t,n,r,o,i,a,s){return n=void 0===n||hd(n,0)?void 0:n,r=void 0===r||hd(r,0)?void 0:r,(0,T.Uy)(e,(e=>{for(const c of t){if(void 0===n&&void 0===r&&void 0===a&&void 0===s){e[c]=void 0;continue}const t=e[c];t?(t.fadeInDuration=n,t.fadeOutDuration=r,t.fadeInShape=o,t.fadeOutShape=i,t.headTransitionEffect=a,t.tailTransitionEffect=s):e[c]={fadeInDuration:n,fadeOutDuration:r,fadeInShape:o,fadeOutShape:i,headTransitionEffect:a,tailTransitionEffect:s}}}))}function UF(e){return 0===e.effects.length?e:{...e,effects:e.effects.map(iU)}}const{equalFrameCounts:BF,lessThanOrEqualFrameCounts:jF,greaterThanOrEqualFrameCounts:VF}=s;function zF(e,t,n){if(!t)return e([n]);const{keyframes:r}=t,o=rh(r,(({offset:e})=>ih(e-n.offset)));let i=r.length,a=!1;return o.match?(i=o.match.index,a=!0):o.next&&(i=o.next.index),{...t,keyframes:[...t.keyframes.slice(0,i),n,...t.keyframes.slice(i+(a?1:0))]}}function GF(e,t){const n=function(e,t){let n;const r=[];let o=!1;const i=t.offset,a=rp(t);let s,c;function d(e,d){if(n&&n.offset<i&&e.offset>i&&!$F(n.value,e.value)){const t=qF(n.value,e.value,i-n.offset,e.offset-n.offset,WF);r.push({offset:i,value:t,curve:n.curve}),o=!0}if(e.offset>a&&n&&n.offset<a&&!$F(n.value,e.value)){const t=qF(n.value,e.value,a-n.offset,e.offset-n.offset,WF);r.push({...e,offset:a,value:t}),o=!0}return op(t,e.offset)||BF(i,e.offset)||BF(a,e.offset)?d||r.push(e):o=!0,jF(e.offset,i)?s=e:VF(e.offset,a)&&(c=e),e}if(e.length>0&&e[0].offset>i){const t={...e[0],offset:i};d(t,!0),n=t}for(const u of e)if(d(u,!1),n=u,u.offset>a)break;if(n&&n.offset<a){const e={...n,offset:a};d(e,!0),n=e}let l=r;if(0===r.length){if(void 0!==s&&void 0!==c&&$F(s.value,c.value)){l=e.length>0&&e[0].offset<i?[{...s,offset:i}]:[{...c,offset:a}]}else l=void 0;o=!0}if(!o)return e;return l}(e.keyframes,t);if(void 0!==n)return n===e.keyframes?e:{...e,keyframes:n}}function WF(e){return e}function HF(e,t,n){return e<=0?0:e>t?1:n(e/t)}function qF(e,t,n,r,o){return function(e,t,n){if(Array.isArray(e)&&Array.isArray(t))return e.map(((e,r)=>CE(e,t[r],n)));if("number"===typeof e&&"number"===typeof t)return CE(e,t,n);throw new Error("attempted to interpolate non-number or non-number[]")}(e,t,HF(n,r,o))}function $F(e,t){return"number"===typeof e&&"number"===typeof t?BF(e,t):Array.isArray(e)&&Array.isArray(t)&&e.every((e=>"number"===typeof e))&&t.every((e=>"number"===typeof e))?e.length===t.length&&e.every(((e,n)=>BF(e,t[n]))):(0,Me.fastDeepEqualJson)(e,t)}function KF(e,t){if(BF(t,0))return e;const n=fu(e.keyframes,(({offset:e,value:n,curve:r})=>{const o=e+t;if(!(o<0))return{offset:o,value:n,curve:r}}));return n.length>0?{...e,keyframes:n}:void 0}function YF(e,t){return e.keyframes.some((({value:e})=>!(0,Me.fastDeepEqualJson)(t.defaultValue,e)))}function ZF(e,t,n=!1){const r=e.effects.findIndex((({type:e})=>e===t.type));return(0,T.ZP)(e,(e=>{-1===r?e.effects.push(t):(n&&(t=rv(t,e.effects[r].id)),(0,Me.fastDeepEqualJson)(t,e.effects[r])||(JF(e,t.type),e.effects.splice(r,0,t)))}))}function JF(e,t){e.effects.some((e=>e.type===t))&&(e.effects=e.effects.filter((e=>e.type!==t)))}function QF(e,t){return(0,T.ZP)(JF)(e,t)}function XF(e,t){return(0,T.ZP)(e,(e=>{e.isDisabled=t}))}function eU({effects:e},t){return e.find((({type:e})=>e===t.type))}function tU(e){return e.filter((e=>!e.isDisabled))}function nU(e,t,n,r=!0){const o=eU(e,t);if(!(!o||o.isDisabled&&r))return rU(o.keyframes,n,t)}function rU(e,t,n){const r=rh(e,(e=>ih(e.offset-t)));if(r.match)return r.match.value.value;const o=r.previous?.value,i=r.next?.value;if(!o)return i?.value;if(!i)return o.value;const a=o.value,s=o.offset,c=i.value,d=i.offset,l=HF(t-s,d-s,WF),u=i.curve??wE.Linear;return(0,n.easingFunctions[u])(a,c,l)}function*oU(e){0!==e.length&&(e[0].offset>0&&(yield{...e[0],offset:0}),yield*e)}function iU(e){return rv(e,Ps())}function aU(e,t){for(const n of e)t.encodeReferencable({type:xu.effect,id:n.id});return e}const sU="skipEffectIdValidation";function cU(e,t){return t.decodingOptions.skipEffectIdValidation?e:hu(e,(e=>{const{id:n}=t.decodeReferencable({id:e.id,type:xu.effect});return n!==e.id?rv(e,n):e}))}function dU(e){return null!==e&&void 0!==e&&!Number.isNaN(e)&&(!(e instanceof Object)||Object.values(e).every(dU))}function lU(e={}){const{layers:t=[],effects:n=[],...r}=e,o=Nu({...e,type:xu.cardBoundaryComponent,sortTiebreaker:0});return{...o,id:o.id,layers:t,effects:n,...r}}function uU(e={}){return lU(e)}function fU(e,t){const{videoFades:n,id:r,name:o,layers:i}=e;return t.encodeReferencable({type:xu.cardBoundaryComponent,id:r}),{...Pu(e,t),id:r,videoFades:n&&fh(n),name:o,layers:t.encodeReferencables(i.map((e=>function(e,t){const{id:n,effects:r,sourceSceneId:o}=e;return{type:xu.cardLayer,id:n,effects:aU(r,t),sourceSceneId:t.encodeReference(o,xu.track,!0,!1),sequenceSceneId:void 0!==e.sequenceSceneId&&"all"!==e.sequenceSceneId?t.encodeReference(e.sequenceSceneId,xu.track,!0,!1):void 0,isHidden:e.isHidden,isLocked:e.isLocked}}(e,t)))),effects:aU(e.effects,t)}}function mU(e,t){const{id:n,name:r,layers:o,videoFades:i}=e;return t.decodeReferencable(lU({...Lu(e,t),id:n,name:r,videoFades:i&&mh(i),layers:t.decodeReferencables(o).map((e=>function(e,t){const{id:n,effects:r,sourceSceneId:o,sequenceSceneId:i,isHidden:a,isLocked:s}=e;return{id:n,effects:cU(r,t),sourceSceneId:t.decodeReferenceId(o),sequenceSceneId:void 0!==i&&"all"!==i?t.decodeReferenceId(i):void 0,isHidden:a,isLocked:s}}(e,t))),effects:cU(e.effects,t)}))}function pU(e){return ju(xu.cardBoundaryComponent,0,e)}function gU(){return{isType:pU,encode:fU,decode:mU}}function hU(e,t,n){return QT(e,t).getItemMaybe(e,n)}function vU(e,t,n){return QT(e,t).getItem(e,n)}function EU(e){return"end"===e?e:e.id}function yU(e){return"end"===e?{type:"endOfComposition"}:{type:"cardBoundary",cardBoundaryId:e.id}}function SU(e,t,n){return"end"===n?_k(e,t):Kx(e,t,n)}function IU(e,t,n){const r=pk(e,t);if("end"===n)return r[r.length-1];const o=r.findIndex((({id:e})=>e===n));return P()(-1!==o,"getPreviousCardBoundary: card boundary not found"),0===o?void 0:r[o-1]}function bU(e,t,n){const r=pk(e,t),o=r.findIndex((({id:e})=>e===n));return P()(-1!==o,"getNextCardBoundary: card boundary not found"),o===r.length-1?"end":r[o+1]}function TU(e,t,n,r){return rh(pk(e,t),(e=>ih(Yx(r(e.tauAnchor.tauId),e)-n)))}function wU(e,t,n){return hd(n,_k(e,t))?"end":function(e,t,n){return TU(e,t,n,GV(e,t).tausAndDataLinkedSub().getTauData).match?.value}(e,t,n)}function CU(e,t,n,r){return hd(qx(e,t,n),SU(e,t,r))}function _U(e,t){return(0,T.Uy)(e,(e=>{for(const n of e.layers)n.sourceSceneId===Gw&&(n.sourceSceneId=t)}))}function AU(e,t,n){if(!t)return e;if(!n)throw new Error("foo");return Hs(n,e)?aB(t):e-($s(n)-aB(t))}function RU(e,t,n,r){let o,i=e;for(let a=t;a<r.length;a++){const e=r[a];if(e.location!==i)break;{o=o||[];const t=n[a];Bu(t)&&o.push(t.id),i=$s(e)}}return o}function MU(e,t,n,r){const o=t-1;if(o>=0&&$s(r[o])===e)return n[o]}function DU(e,t){let n=t.length>0,r=e.location;for(const o of Kg(t)){if(o.location>r){n=!1;break}r=$s(o)}return n&&$s(qg(t))>=$s(e)}function OU(e,t,n,r){let o;t.length>0&&Hg(t).location<=e.location?o=t.offset:t.offset>0&&(o=t.offset-1);const i=AU(e.location,void 0!==o?n[o]:void 0,void 0!==o?t.buffer[o]:void 0),a=$g(t)-1,s=Math.min(r,AU($s(e),n[a],t.buffer[a]));return Gs.getStartEnd(i,s)}function xU(e,t,n,r){const o=GV(e,t),{renderedText:i,components:a,componentRenderedRanges:s}=hB(o,n.id);if(0===a.length){const e=r.location,t=Math.min(i.string.length-e,r.length);return{textRange:Gs.get(e,t),isEntirelyInComponents:!1,componentIdsToBump:void 0,previousComponent:void 0,overlapsWordlessMedia:!1,overlappingWordlessMediaRanges:bu()}}const c=uh(r,qs,$s);const d=nh(zg(s),c);let l=DU(r,d),u=!1,f=bu();if(e.isStoryboard){if(l=DU(r,nh(zg(s.filter(((e,t)=>!pU(a[t])))),c)),EE(e)){const e=s.filter(((e,t)=>tB(a[t]))),t=nh(zg(e),c);f=Zg(t),u=e.length>0&&t.length>0}}return{textRange:OU(r,d,a,i.string.length),isEntirelyInComponents:l,overlapsWordlessMedia:u,overlappingWordlessMediaRanges:f,componentIdsToBump:RU($s(r),$g(d),a,s),previousComponent:MU(r.location,d.offset,a,s)}}function kU(e,t,n,r,o={wordlessMedia:!0,cardBoundary:!1,markers:!0},i){const a=GV(e,t),{textOffset:s,components:c,componentRenderedRanges:d}=hB(a,n),l=qs(r),u=$s(r),f=nh(zg(c),(e=>{if(void 0!==i&&tB(e)){const t=e.range;return ec(t,r)?Ie.OrderedSame:$s(t)<l?Ie.OrderedAscending:Ie.OrderedDescending}const t=aB(e);return t>u?Ie.OrderedDescending:l>t?Ie.OrderedAscending:Ie.OrderedSame}));let m=s;if(f.offset>0){const e=f.offset-1,t=c[e],n=d[e];m+=r.location-aB(t)+$s(n)}else m+=r.location;let p=r.length;for(let g=f.offset;g<f.offset+f.length;g++){const e=c[g],t=d[g];if(tB(e))o.wordlessMedia?void 0===i||(m+=i<=0?t.length-oB(-i):oB(i)):m+=t.length;else{const n=o.cardBoundary&&pU(e);n||aB(e)!==r.location?n&&aB(e)===$s(r)||!o.markers&&hR(e)||(p+=t.length):m+=t.length}}return 0===r.length?Gs.get(m+p,0):Gs.get(m,p)}var NU=(e=>(e.CorrectText="correct",e.EditMedia="edit",e.Write="write",e))(NU||{}),PU=(e=>(e.IncludesScratchText="includesScratchText",e.BeforeCardBoundary="beforeCardBoundary",e.AfterCardBoundary="afterCardBoundary",e.OverlappingCardBoundary="overlappingCardBoundary",e.InvalidCardInsertHasOverdub="invalidCardInsertHasOverdub",e.InvalidCardMove="invalidCardMove",e.InvalidCardMoveHasOverdub="invalidCardMoveHasOverdub",e.MaxLengthExceeded="maxLengthExceeded",e.MediaEditInUnalignedTau="mediaEditInUnalignedTau",e.MediaEditWithNoMedia="mediaEditWithNoMedia",e.InvalidStoryboardCueInsertLocation="invalidStoryboardCueInsertLocation",e.InvalidInsertLocation="invalidInsertLocation",e.UndoTrimergeFailed="undoTrimergeFailed",e.CueOverlap="cueOverlap",e.SequenceTags="sequenceTags",e.SequenceOverdub="sequenceOverdub",e.SequenceRegeneration="sequenceRegeneration",e.SequenceOverdubLengthTooShort="sequenceOverdubLengthTooShort",e.SequenceRegenerationLengthTooShort="sequenceRegenerationLengthTooShort",e.SequenceOverdubLengthTooLong="sequenceOverdubLengthTooLong",e.SequenceRegenerationLengthTooLong="sequenceRegenerationLengthTooLong",e.RegenerateAlteration="regenerateAlteration",e.WordlessMediaEdit="wordlessMediaEdit",e.WordlessMediaCorrection="wordlessMediaCorrection",e.Unknown="unknown",e))(PU||{});class LU extends Error{constructor(e){super(e),this.type=e}static typeOf(e){return e instanceof LU?e.type:"unknown"}}function FU(e,t,n,r){const o=[],i=Fb(e,t).string;let a;for(const{highlighterId:s,tau:c,range:d}of wC(e,t))if(n===s||void 0===n){let n=kU(e,t,c.id,d);r&&(n=dc(i,n)||n),a?$s(a)>=n.location?a=Gs.getStartEnd(a.location,$s(n)):(o.push(a),a=n):a=n}return a&&o.push(a),o}function UU(e,t,n,r){BU(e,t,n,((...e)=>{if(r(...e))return!0}))}function BU(e,t,n,r){const o=GV(e,t),{tausData:i}=o.tausAndDataForBasicAttributedString(),a=nh(zg(i),lh(n,qs,$s,(e=>Gs.get(e.textOffset,e.basicAttributedString.attrString.string.length)),!0));for(const s of Kg(a)){const o=s.textOffset,i=s.basicAttributedString.attrString.string.length,a=Math.max(0,n.location-o),c=Math.min(i,n.location+n.length-o),d=Gs.get(a,c-a),{tau:l}=s,u=xU(e,t,l,d),f=r(l,u.textRange,d,o,u.isEntirelyInComponents,u.overlapsWordlessMedia);if(void 0!==f)return f}}function jU(e,t,n,r){UU(e,t,n,((...e)=>(r(...e),!0)))}function VU(e,t,n,r,o){if(n>=_k(e,t))return;const i=EE(e),a=FT(e,t,n,i),s=a?wP(e,t,a.tauId):void 0,c=Boolean(s?.isScriptClip),d=!!s&&EN(s);if(!a||!i&&c||i&&d)return;const l=void 0!==r?UB(e,t,r):void 0!==o?cw(e,t,o):void 0;if(l&&hd(Kx(e,t,l),n))return;let u;if(c){const n=GV(e,t).tausAndDataForBasicAttributedString().getTauData(a.tauId);if(!n.showWordlessMedia||!n.wordlessMedia||0===n.wordlessMedia.length)return;const r=n.orderedComponentsAndWordlessMedia.findIndex((e=>tB(e)));if(r<0)throw new Error("Expected at least one wordless media component in this tau");const o=n.orderedComponentAndWordlessMediaRenderedRanges[r];u=Gs.get(n.textOffset+qs(o)+oB(a.gapTimeOffset||0),1)}else if(u=kU(e,t,a.tauId,a.range,{wordlessMedia:!1,markers:!1}),i&&void 0!==a.gapTimeOffset){const r=a.includeGapPrefix?KU.length:0,o=a.includeGapSuffix?YU.length:0,i=a.gapTimeOffset/JU;u=Gs.get(qs(u)-(Math.floor(i)+r+o),1);const{wordOffset:s}=HP(e,t,a.tauId,n,!0);zb(e,t,Gs.get(s,$s(u)-s),!1,!1,!1,((e,t,n)=>{if(!tB(e)||void 0===a.gapTimeOffset||e.tauId!==a.tauId)return!1;const r=Math.max(n.location,$s(n)-Math.round(i));return u=Gs.get(Math.max(r,u.location),1),!1}))}else if(i&&a.includeGapPrefix){const n=ys.index(Fb(e,t).string.substring(u.location))??0;u=Gs.get(u.location+n,1)}return u}function zU(e,t,n){let r=0;return UU(e,t,n,((n,o)=>(r+=function(e,t,n,r){const o=wP(e,t,n);if(o.isScriptClip)return 0;const i=o.text,a=i.string.length;if(0===r.location&&$s(r)>=a)return LP(e,t,n).totalWords;if(0<=r.location&&r.length<=a){const e=i.string.substr(r.location,r.length);let t=0;return Zh.enumerateWords(e,(()=>(t+=1,!1))),t}return 0}(e,t,n.id,o),!1))),r}Number.MAX_SAFE_INTEGER;const GU="-\u221e";function WU(e,t,n=!1){const r=function(e){return e<=0?void 0:20*Math.log10(e)}(e);return void 0===r?GU:`${r>=0?"+":""}${r.toFixed(t)}${n?"dB":""}`}function HU(e){return Math.pow(10,e/20)}const qU=["\u2500","\u2501","\u2502","\u2503","\u2504","\u2505"],$U=[];for(let BIe=0;BIe<qU.length;BIe++)BIe===qU.length-1?$U.push(1/0):$U.push((BIe+1)/qU.length);const KU=" ",YU=KU,ZU=3932.1,JU=.2,QU=.5;function XU(e,t,n,r,o,i=!0,a=!1,s=!1){const c=i?KU:"",d=a?YU:"",l=c+function(e,t){if(!e)return function(e){const t=oB(e);let n="";for(let r=0;r<t;r++)n+=qU[0];return n}(t);let n="";for(const r of e)for(let e=0;e<$U.length;e++)if(r<$U[e]){n+=qU[e];break}return n}(o,n)+d,u=Boolean(o&&o.every((e=>-1===e))),f=bm(l,[{range:Gs.get(c.length,l.length-c.length-d.length),attribute:Df(s?e:void 0,t,u)}]);return{tauId:e,isBlankCardGap:t,duration:n,range:Gs.get(r,l.length),attributedString:f,barValues:o,type:"wordlessMedia",hasPrefix:i,hasSuffix:a}}function eB(e){const t=xN(e.tau),n=e.hasRealAudio&&!e.gapClipTau;return t&&n}function tB(e){return Boolean(void 0!==e&&"wordlessMedia"===e.type)}function nB(e){return e*JU}function rB(e){return!e||0===e.length}function oB(e){return Math.max(0,Math.floor(e/JU))}function iB(e,t){return rB(e)||t?JU:QU+JU}function aB(e){return Bu(e)?e.tauAnchor.location:e.range.location}function sB(e,t){return!!EN(e.tau)&&(!(!e.cardBoundaryComps||1!==e.cardBoundaryComps.length)&&(!t||Boolean(t.cardBoundaryComps&&t.cardBoundaryComps.length>=1)||0===t.duration))}function cB(e){return e.showWordlessMedia&&e.gapClipTau&&(e.orderedComponents.length>0||void 0!==Es.index(e.renderedText.string)||void 0!==Ms.index(e.renderedText.string))}function dB(e,t,n){return lB(e,t,n)}function lB(e,t,n){return e>=iB(n,t)}function uB(e,t,n){const r=t.linkedSubAlignment??t.preCorrectionLinkedSubAlignment,o=t.tau.isScriptClip,i=sB(t,n);if(t.isOverdub||t.gapClipTau||!o&&!r&&!t.isScratchText&&!TN(t.tau))return bu();if(o||!r||0===r.length)return function(e,t,n){const r=t.tau.isBlocked?t.tau.audioSegment?.duration||0:t.duration;if(!dB(r,!1,t.linkedSubAlignment))return bu();const o=mB(e,t,t.tau.audioSegment?.offset||0,r),i=t.orderedComponents;let a=0;const s=i.length>=1?i[0]:void 0;return s&&(pU(s)||(hR(s)||Zm(s))&&0===s.tauAnchor.location)&&(a=s.tauAnchor.location),[XU(t.tau.id,sB(t,n),r,a,o,!1,!1,!0)]}(e,t,n);const a=[],s=r.length,c=yE(r);for(let d=0;d<s;d++){const n=r.wordArrayView.buffer[r.wordArrayView.offset+d],o=r.rangesWithPunc[d],l=d<s-1?r.wordArrayView.buffer[r.wordArrayView.offset+d+1]:void 0,u=t.tau.audioSegment,f=u?.offset||0;if(0===d&&lB(n.startTime-f,!0,r)){const r=Ms.index(t.tau.text.string),s=Es.index(t.tau.text.string),c=void 0!==s&&void 0!==r&&s<=r?s:qs(o),d=n.startTime-f,l=mB(e,t,f,d);a.push(XU(t.tau.id,i,d,c,l,!1,!0,!0))}const m=d===s-1;let p=l?l.startTime-n.endTime:0;if(m){const e=n.endTime,r=(u?.offset||0)+(t.tau.isBlocked?t.tau.audioSegment?.duration||0:t.duration),o=Math.max(0,r-e);p=p||0,p+=o}if(p&&lB(p,!1,r)){const r=p-c,s=mB(e,t,n.endTime+c,r);a.push(XU(t.tau.id,i,r,$s(o),s,!0,!1,0===a.length))}}return a}function fB(e){return new Array(oB(e)).fill(0)}function mB(e,t,n,r){return rB(t.linkedSubAlignment)&&r<JU?fB(JU):t.tau.audioSegment?.mediaRefId?function(e,t,n,r,o,i){const a=t?.audio?.energies;if(!a)return t&&(s=t,Boolean(s.audio)&&!s.isBounced&&!s.audio?.energies&&(Boolean(s.assetJson)||Ag(s)))&&i?function(e){return new Array(oB(e)).fill(-1)}(r):fB(r);var s;const c=i?13107:ZU,d=a.hz,l=Math.trunc(n*d),u=Math.trunc((n+r)*d);if(u<=l)return fB(r);const f=Math.round(JU*d);if(0===f)return fB(r);const m=Gs.getStartEnd(l,u),p=iA(e,t.id,a,m),g=new Uint16Array(u-l);let h=0;for(const y of oA(p,m))g.set(y,h),h+=y.length;const v=oB(r),E=[];for(let y=0;y<v;y++){E[y]=0;for(let e=0;e<f;e++)E[y]+=g[y*f+e];E[y]=E[y]/f,E[y]=E[y]<65?0:Math.min(1,E[y]/c),E[y]=E[y]*Math.min(4,o)/4}return E}(e,t.ref,n,r,t.tau.audioSegment.gain,t.tau.isScriptClip):fB(r)}function pB(e,t,n){if(0===e.length)return t;if(0===t.length)return e;const r=[];let o=0,i=0;for(;r.length<e.length+t.length;){const a=o>=e.length,s=i>=t.length;if(a&&!s){r.push(...t.slice(i));break}if(s&&!a){r.push(...e.slice(o));break}e[o].range.location<t[i].tauAnchor.location||t[i].tauAnchor.location===e[o].range.location&&!n&&(hR(t[i])||Zm(t[i]))?(r.push(e[o]),o++):(r.push(t[i]),i++)}return r}function gB(e,t){let n=0,r=0;return t.map((function(t){const o=function(e,t){return Bu(e)?Zj(e,t).string.length:e.range.length}(t,e),i=aB(t),a=n+i,s=a+o;if(a<r)throw new Error("Component starts before previous component end");const c=Gs.get(a,o);return r=s,n+=o,c}))}function hB(e,t){const{renderedText:n,textOffset:r,orderedComponentAndWordlessMediaRenderedRanges:o,orderedComponents:i,orderedComponentRenderedRanges:a,orderedComponentsAndWordlessMedia:s}=e.tausAndComponentData().getTauData(t),c=e.showWordlessMedia;return{renderedText:n,textOffset:r,components:(c?s:i)||i,componentRenderedRanges:(c?o:a)||a}}function vB(e,t,n){P()(void 0!==e.audioSegment,"audioSegment must be defined");let r=0;const o=e.audioSegment.offset||0,i=e.audioSegment.duration||0;return r=t&&n?n.startTime-t.endTime:t?o+i-t.endTime:n?n.startTime-o:i,r}function EB(e,t,n){const r=ck(e,t,n.id);let o=r;if(EE(e)){const i=GV(e,t).tausAndDataForAttributedString().getTauData(n.id);i.wordlessMedia&&(o=pB(i.wordlessMedia,r,eB(i)))}return o}function yB({doc:e,compositionId:t,currentTimeOffset:n,textOffset:r,tauData:o,tauRange:i}){if(!EE(e))return n;let a=!1;if(zb(e,t,Gs.get(r,1),!0,!0,!0,((s,c,d)=>{if(!tB(s)||s.tauId!==o.tau.id)return!1;const l=Xj(e,t,s).length,u=eV(e,t,s).length,f=$s(d),m=d.length-l-u,p=f-r-u;if(a=!0,!o.linkedSubAlignment||o.isScratchText)return n=Math.min(o.timeOffset+nB(r-d.location),o.timeOffset+o.duration),!0;if(P()(o.tau.audioSegment,"audioSegment must be defined"),hd(n,o.timeOffset))return n=r===$s(d)&&o.linkedSubAlignment&&o.linkedSubAlignment.wordArrayView.buffer.length>0?o.timeOffset+o.linkedSubAlignment.wordArrayView.buffer[0].startTime:o.timeOffset+nB(r-(d.location+l)),!0;if(p>0)if(p<=m)p!==m||s.hasPrefix?n-=nB(p):n-=s.duration;else{const{previous:e,match:t}=o.linkedSubAlignment.searchForTextOffsetWithPunc(i.location),r=e||t;n=r?o.timeOffset+(r.value.endTime-o.tau.audioSegment.offset):o.timeOffset+o.duration-nB(p)}return!0})),!a&&o.linkedSubAlignment){if(void 0!==o.tau.audioSegment){const{match:e,next:t}=o.linkedSubAlignment.searchForTextOffsetWithPunc(i.location);if(e&&$s(i)>=$s(e.value.range)){let r;r=t?t.value.startTime:e.index+1<o.linkedSubAlignment.wordArrayView.length?Wg(o.linkedSubAlignment.wordArrayView,e.index+1).startTime:o.tau.audioSegment.offset+o.duration,dB(r-e.value.endTime,0===e.index,o.linkedSubAlignment)&&(n=o.timeOffset+e.value.endTime-o.tau.audioSegment.offset)}}}else o.linkedSubAlignment||r!==o.textOffset||(n=o.timeOffset);return n}function SB(e,t,n,r=!1,o=!1,i=!1,a=!1){let s,c;return zb(e,t,a?{location:Math.max(0,n.location-1),length:n.length+2}:n,o,r,i,((e,t,r)=>{if(tB(e)){const t=qs(r)-1,o=$s(r)+1;if(!a||ec(Gs.get(t,o-t),n))return s=r,c=e,!0}return!1})),s&&c?{component:c,range:s}:void 0}function IB(e,t,n,r=!1,o=!1,i=!1,a=!1){return SB(e,t,n,r,o,i,a)?.range}function bB(e){let t=-1;for(let n=0;n<e.length;n++){const r=e.charAt(n);if(Es.contains(r))t=n;else if(As.contains(r))break}return t}function TB(e,t,n,r){if(n.text.string.endsWith("\n")&&r.text.string.startsWith("\n"))return;const o=GV(e,t).tausAndDataForBasicAttributedString().getTauData(r.id),i=Ms.index(o.renderedText.string);if(0===o.wordlessMedia.length||void 0!==i&&o.wordlessMedia[0].range.location>i)return;const a=n.text.string,s=a.length-1;let c=-1;for(let d=s;d>=0;d--){const e=a.charAt(d);if(Es.contains(e))c=d;else if(!Is.contains(e)||ys.contains(e))break}if(c>0&&c<=s||c>=0&&xN(n)){const e=km(n.text,c).string.replaceAll(" ","");if(n=jM(n,0===c?SE:km(n.text,0,c)),o.index>1||" "!==n.text.string){const t=""===r.text.string.replaceAll(" ","");r=jM(r,t?bm(e,r.text.attributes):Cm([e,r.text]))}return{beforeTau:n,afterTau:r}}}function wB(e,t,n,r){const o=TB(e,t,n,r);return o&&(e=UM(e,t,o.beforeTau.id,o.beforeTau),e=UM(e,t,o.afterTau.id,o.afterTau)),e}function CB(e,t,n,r){const o=SB(e,n,Gs.get(r,1));if(!o)return;const i=SB(t,n,Gs.get(Math.max(0,r-1),1),!1,!0),a=SB(t,n,Gs.get(r+1,0),!0,!1),s=o.component.hasPrefix&&r===o.range.location+1;if(i){if(i.component.tauId!==a?.component.tauId){const e=wP(t,n,o.component.tauId),s=DP(t,n,e.id)?.text.string.startsWith("\n"),c=s&&qs(o.component.range)>=e.text.string.length-1?-1:1,d=$s(i.range)+c-r,l=$s(o.range)-(o.component.hasSuffix?1:0)-r;return{deltaLeftOfSplit:d,deltaRightOfSplit:a?$s(a.range)-c-r-l:-l}}if(s)return{deltaLeftOfSplit:-1,deltaRightOfSplit:i.range.length-o.range.length}}return s?{deltaLeftOfSplit:-1,deltaRightOfSplit:0}:void 0}function _B(e,t,n){const r=new Map,o=e.map((e=>{const t=Ps();return r.set(e.id,t),rv(e,t)})),i=new Map;for(const d of t)pU(d)&&i.set(d.id,Ps());const a=new Map,s=fu(t,(e=>{const t=r.get(e.tauAnchor.tauId);if(void 0===t)return;if(PB(e)&&"cardBoundary"===e.endAnchor?.type){const t=i.get(e.endAnchor.cardBoundaryId);void 0!==t&&(e=LD(e,{type:"cardBoundary",cardBoundaryId:t}))}const n=pU(e)&&i.get(e.id)||Ps();return a.set(e.id,n),OD(rv(e,n),{tauId:t,location:e.tauAnchor.location})}));let c;return n&&(c=fu(n,(e=>e===Yy?Yy:a.get(e)))),[o,s,c]}function AB(e,t,n,r,o){let i=fs(ms(bP(e,t),(e=>e.id===n)),(e=>e.id===r));o||(i=Qa(i,(e=>jM(e,Om(e.text,(({attribute:e})=>e.name!==Gu.Annotation))))));const a=Array.from(i),s=new Set(a.map((e=>e.id))),c=Array.from(Ja(sk(e,t),(e=>s.has(e.tauAnchor.tauId)))),d=yC(e,t,c);return{taus:a,components:c,newPinTracks:void 0,layerOrder:sS(e,t,c),storyboardCues:d}}function RB(e,t,n,r,o){let i=[];if(e.isStoryboard){let r=wU(e,t,n.offset);if(!pU(r)){const o=gM(e,t,{type:"time",timeOffset:n.offset},!0);e=o.doc,r=o.newCard.start}const o=pM({doc:e,compositionId:t,splitCardBoundary:r,splitAudioPins:!0});e=o.doc,i=o.newPinTrackIds.map((t=>vk(e,t)))}else e=_D(e,t,(a=>{if(!PB(a))return a;let s=a;const c=Kx(e,t,s),d=_k(e,s.sceneId),l=c+d;let u=!1,f=!1;if(!sp(n,{offset:c,duration:d}))return s;if(c<n.offset&&(u=!0),l>rp(n)&&(f=!0),!u&&!f)return s;const m=u?n.offset-c:0,p=f?rp(n)-c:d,g=function({duckingParameters:e,pan:t,isMuted:n,isSoloed:r,effects:o,gain:i,suppressRoomtone:a,videoMetadata:s}){return{duckingParameters:e,pan:t,isMuted:n,isSoloed:r,effects:o.map(iU),gain:i,suppressRoomtone:a,videoMetadata:s}}(vk(e,s.sceneId)),h=_y(g),v=YO(e=rx(e,h,void 0),MB(e,s.sceneId,{offset:m,duration:p-m},!1,!1,o),s.sceneId,o);return e=lM({doc:e=v.doc,compositionId:h.id,location:0,taus:v.taus,trackComponents:v.components,layerOrder:v.layerOrder,storyboardCues:v.storyboardCues,preserveTauIds:!0}).doc,i.push(vk(e,h.id)),s=PD(e,t,{...s,sceneId:h.id},c+m),u&&(s=OD(s,{tauId:r,location:0})),s}));return{doc:e,newPinTracks:i}}function MB(e,t,n,r,o,i){if(i&&bk(e,t)){const r=Array.from(es(Kg(kP(e,t,n)),(t=>{const n=eL(e,t);if(n&&kg(n))return t.id})));r.length>0&&(e=LM(e,t,r))}let a;const s=eM(e,t,n);e=s.doc;const{startTauId:c,endTauId:d}=s;if(o){const r=RB(e,t,n,c,i);e=r.doc,a=r.newPinTracks}return{...AB(e,t,c,d,r),newPinTracks:a}}function DB(e,t,n,{taus:r=[],trackComponents:o=[],layerOrder:i,cardLayerOrder:a,endNewTauId:s,shouldRefreshTimelineTaus:c=!0,preserveTauIds:d=!1,preservePins:l=!1,preserveCardBoundaries:u=!1,preserveComponentsAtStartAndEndOfRange:f=!1,preservePartialScratchTexts:m=!1,overlapsWordlessMedia:p=!1}={}){const g=Np(e);let h=_k(e,t);const v=vk(e,t).type;o=hu(o=vu(o,(e=>jD(e,v))),(e=>pU(e)?_U(e,t):e)),n.offset+n.duration>h&&(h=_k(e=Cx(e,t,Rx(Lx(e,t),QM(e,{duration:n.offset-h+n.duration}))),t));let E=r,y=o,S=i;if(d){for(const n of r)if(TP(e,t,n.id))throw new Error("Inserting tau id that already exists");for(const n of y)if(nk(e,t,n.id))throw new Error("Inserting component id that already exists")}else[E,y,S]=_B(r,o,i);const I=y.find((e=>pU(e)));let b,T,w=new Set;if(n.offset<=0&&0===n.duration)e=Cx(e,t,(C=Lx(e,t),_=E,Ax(C,Gs.get(0,0),_)));else{n.offset<=0&&(n={offset:0,duration:n.duration});const r=eM(e,t,n,s,p);e=r.doc;const{startTauId:o,endTauId:i,splitNeeded:a}=r;if(a||n.duration>0){let{taus:r,components:a}=AB(e,t,o,i,!0);m&&r.length>0&&DM(e,t,r[0].id)&&vd(FP(e,t,r[0].id),n.offset)&&(r=r.slice(1));const s=new Set,c=a.filter(pU),d=Ya(c);if(d){s.add(d.id);const n=Za(c);if(n){const r=qx(e,t,n);Xa(a,(n=>{PB(n)&&hd(r,qx(e,t,n))&&s.add(n.id)}))}}const p=new Set(c.flatMap((n=>jB(e,t,n.id))).map((({id:e})=>e))),g=new Set(a.map((e=>e.id)));if(l||u){if(0===E.length)throw new Error("Cannot preserve pins or card boundaries if replacing with no taus");b=new Map(es(a,(n=>l&&PB(n)||u&&pU(n)?[n.id,qx(e,t,n)]:void 0)))}const h=fu(y,(t=>PB(t)?ng(e,t.sceneId):void 0));l||(T=new Set(fu(a,(e=>PB(e)&&h.find((t=>t.id===e.sceneId))?e.id:void 0)))),f&&Xa(a,(r=>{const o=qx(e,t,r);(hd(o,n.offset)||hd(o,n.offset+n.duration))&&s.add(r.id)}));const v=GV(e,t).tausAndDataBasic().getTauData(r.length>0?r[0].id:o).index,S=UP(e=Cx(e,t,Ax(Lx(e,t),Gs.get(v,r.length),[])),t,n.offset);e=_D(e,t,(e=>(PB(e)&&"cardBoundary"===e.endAnchor?.type&&g.has(e.endAnchor.cardBoundaryId)&&!b?.has(e.endAnchor.cardBoundaryId)&&!s.has(e.endAnchor.cardBoundaryId)&&(e=LD(e,void 0)),S&&(b?.has(e.id)||T?.has(e.id))?OD(e,{tauId:S.id,location:0}):void 0!==i&&s.has(e.id)?OD(e,{tauId:i,location:0}):g.has(e.id)?void 0:d&&PB(e)&&p?.has(e.id)?LD(e,void 0!==i?{type:"cardBoundary",cardBoundaryId:d.id}:{type:"endOfComposition"}):e)));for(const t of h)ng(e,t.id)||(e=rx(e,t))}if(I){const r=wU(e,t,n.offset);pU(r)&&(w=new Set(jB(e,t,r.id).map((({id:e})=>e))))}e=Cx(e,t,Ox(Lx(e,t),E,i))}var C,_;for(const M of y)e=MD(e,t,M,void 0,void 0,!0,!1);if(bk(e,t))for(const M of y)PB(M)&&"cardBoundary"===M.endAnchor?.type&&!hU(e,t,M.endAnchor.cardBoundaryId)&&(e=RD(e,t,LD(M,void 0),void 0,void 0,!1));if(pU(I)&&w.size>0&&(e=_D(e,t,(e=>PB(e)&&w?.has(e.id)?LD(e,{type:"cardBoundary",cardBoundaryId:I.id}):e))),e=fR(e,t),b)for(const[M,D]of b)e=zD(e,t,M,D);if(T)for(const M of T)nk(e,t,M)&&(e=DD(e,t,M));for(const M of E){const n=M.audioSegment?.mediaRefId;let r;void 0!==n&&(r=g(n)?.voiceover?.metadata.alignment),e=tN(e,t,M.id,r,void 0,void 0)}e=fO(e,t),c&&(e=sO(e,t));const A=vk(e,t);if(S&&A.type===Jh.Composition&&(e=ix(e,lx(A,tS(A.timeline,cS(Xy(e,t),S))))),a&&A.type===Jh.Composition){const n=y.filter(pU).map((e=>e.id));for(const r of n){const n=tT(e,t,r);let o=[],i=[...n.layers];for(const{sourceSceneId:e,sequenceSceneId:t}of a){const r=Lw(n,e,t);r&&(o.push(r),i=i.filter((n=>n.sourceSceneId!==e||n.sequenceSceneId!==t)))}o=[...o,...i],e=Yw(e,t,n.id,o)}}const R=_k(e,t)-h;return{doc:e,selectionLocation:rp(n)+R,selectionType:"time",newTauIds:E.map((({id:e})=>e)),newComponentIds:y.map((({id:e})=>e))}}function OB(e,t,n,r,o,i,a){const s=[],c=[],d=new Map,l=new Map;let u,f,m=!1;const p=function(e,t,n){return!!EE(e)&&0===zU(e,t,n)&&void 0!==IB(e,t,n)}(e,t,n),g=!!EE(e)&&void 0!==SB(e,t,Gs.get(n.location,0)),h=!!EE(e)&&void 0!==SB(e,t,Gs.get($s(n),0),!0,!0,!0);if(i&&(u=jT(e,t,n),f=0,e.isStoryboard)){const r=wU(e,t,u.offset);pU(r)&&(n=Js(qb(e,t,r),n))}if(a&&bk(e,t)){const r=[];UU(e,t,n,(t=>{const n=eL(e,t);return n&&kg(n)&&r.push(t.id),!1})),r.length>0&&(e=LM(e,t,r))}const{getTauData:v}=GV(e,t).tausAndDataLinkedSub();UU(e,t,n,((r,o,i,a)=>{const c=v(r.id);if(p&&(eB(c)||0===o.length))return!1;let u=function(e,t,n,r,o=-.05,i,a=!1,s=!1){const c=wP(e,t,n),{audioSegment:d}=c,l=EE(e);let u=r;c.isScriptClip&&(u=Gs.get(0,c.text.string.length));const f=xm(c.text,u);let m;if(kN(e,c)&&d&&sN(e,t,n)){const f=d.mediaRefId;if(void 0!==f){let p=0,g=0;if(Ws(Gs.get(0,PP(e,t,n).string.length),u))p=0,g=d.duration;else{g=aR(e,t,n,$s(u),o,!s);const f=mN(e,t,n,u.location,o,a);if(p=void 0!==f?f:$P(e,t,n,u.location,!1),l&&i&&bk(e,t)){const n=GV(e,t).tausAndDataForAttributedString().getTauData(c.id);g=yB({doc:e,compositionId:t,currentTimeOffset:g+n.timeOffset,textOffset:$s(i),tauData:n,tauRange:Gs.get($s(r),0)})-n.timeOffset}p*=d.speed,g*=d.speed}m=SF(d,hF({mediaRefId:f,offset:d.offset+p,duration:g-p,multicamSceneId:d.multicamSceneId,speed:d.speed}),0===p,hd(g,d.duration),!0)}}else if(d){const i=d.mediaRefId;if(void 0!==i)if(iR(e,t,n,u)){if(l){let r=aR(e,t,n,$s(u),o),s=0;const c=mN(e,t,n,u.location,o,a);s=void 0!==c?c:$P(e,t,n,u.location,!1),s*=d.speed,r*=d.speed,m=SF(d,hF({mediaRefId:i,offset:d.offset+s,duration:r-s,multicamSceneId:d.multicamSceneId,speed:d.speed}),0===s,hd(r,d.duration),!0)}}else{let o=d.duration;c.isScriptClip&&(Hs(r,PP(e,t,n).string.indexOf(IE.string))||(o=0)),m=SF(d,hF({mediaRefId:i,offset:d.offset,duration:o,multicamSceneId:d.multicamSceneId,speed:d.speed}),!0,!0,!0)}else void 0===i&&(m=d)}return m&&d&&hd(m.offset,d.offset)&&(m=OF(m,d.suppressAutoMerge)),m&&d&&(m=mI({...m,effects:d.effects.map(iU)}),m=_w(e,t,n,m)),JM({text:f,audioSegment:m,ignoreAlignment:c.ignoreAlignment,isBlocked:c.isBlocked,isScriptClip:c.isScriptClip,defaultSpeaker:c.defaultSpeaker,overdubInfo:c.overdubInfo,visual:c.visual,replacedContentSceneId:c.replacedContentSceneId})}(e,t,r.id,o,f,n,g,h);const E=OM(e,r);if(r.audioSegment&&!u.audioSegment&&!E)throw new LU(PU.MediaEditInUnalignedTau);return u.audioSegment?u.audioSegment.duration>0?m=!0:u=zM(u,void 0):E&&(m=!0),d.set(r.id,{subTau:u,subRange:o}),l.set(u.id,a),s.push(u),!1}));let E=!1;if(zb(e,t,n,!1,!1,!1,((r,o,i)=>{if(tB(r)){const o=function(e,t,n,r,o,i){if(!EE(e))return;const a=wP(e,t,n.tauId);P()(a.audioSegment,"Wordless media tau must have an audio segment");const s=Math.max(qs(i),qs(o)),c=Math.min($s(o),$s(i)),d=BT(e,t,s),l={offset:d,duration:BT(e,t,c)-d},u=l.offset-FP(e,t,a.id)+a.audioSegment.offset,f=r.get(n.tauId);if(f&&f.subTau.audioSegment){const e=s===qs(o)?u:f.subTau.audioSegment.offset,t=c===$s(o)?u+l.duration:f.subTau.audioSegment.offset+f.subTau.audioSegment.duration;return{replaceExistingSubTau:!0,newSubTau:JM({...f.subTau,audioSegment:{...f.subTau.audioSegment,offset:e,duration:t-e}})}}return{replaceExistingSubTau:!1,newSubTau:JM({...a,id:n.tauId,audioSegment:{...a.audioSegment,offset:u,duration:l.duration}})}}(e,t,r,d,n,i);if(o){m=!0,E=!0;const{replaceExistingSubTau:e,newSubTau:t}=o;if(e){const e=d.get(r.tauId);P()(e,"found taus must include existing tau");const n=s.findIndex((t=>t.id===e.subTau.id));P()(n>=0,"taus must include the existing subTau"),d.set(r.tauId,{subTau:t,subRange:e.subRange}),s.splice(n,1,t)}else d.set(r.tauId,{subTau:t,subRange:Gs.get(0,t.text.string.length)}),s.push(t);l.set(t.id,qs(i))}return!1}return!1})),s.sort(((e,t)=>(l.get(e.id)??0)-(l.get(t.id)??0))),zb(e,t,n,!1,!1,!1,((n,r,o)=>{if(tB(n))return!1;if(r.length<o.length){if(!Zm(n)&&!hR(n))return!1;{const o=Xj(e,t,n).length,i=Pf(zj(n)),a=r.location-o,s=Math.min(i,$s(r)-o);if(s<=a)return!1;hR(n)?n=UD(n,n.text.substring(a,s)):Zm(n)&&(n=BD(n,km(n.attrText,a,s)))}}const{tauAnchor:i}=n,a=d.get(i.tauId);if(!a)return!1;if(a.subRange.location>i.location||$s(a.subRange)<i.location)return!1;const s=OD(n,{tauId:a.subTau.id,location:i.location-a.subRange.location});return c.push(s),m=m||s.type!==xu.cardBoundaryComponent,!1})),o&&!m)throw new LU(PU.MediaEditWithNoMedia);const y=yC(e,t,c),S={taus:r?s:hu(s,(e=>jM(e,Om(e.text,(e=>e.attribute.name!==Gu.Annotation))))),components:c,newPinTracks:void 0,layerOrder:sS(e,t,c),storyboardCues:y};return i&&u?function(e,t,n,r,o,i,a){const{taus:s,components:c,layerOrder:d}=n;if(0===s.length)return n;const l=[];for(const v of sk(e,t))PB(v)&&sp(r,{offset:FP(e,t,v.tauAnchor.tauId),duration:BP(e,t,v.tauAnchor.tauId)})&&l.push([v,vk(e,v.sceneId),Kx(e,t,v)]);const u=DB(e,t,r,{taus:s,trackComponents:c,layerOrder:d,shouldRefreshTimelineTaus:!1,preservePartialScratchTexts:i});e=u.doc;const f=u.newTauIds,m=f[0],p=new Set(Wx(e,t).pins.components.map((e=>e.sceneId)));for(const[v,E,y]of l)hk(e,E.id)||(e=rx(e,E)),p.has(E.id)||(e=MD(e,t,PD(e,t,v,y),void 0,void 0));const g=RB(e,t,r,m,a);e=g.doc;const h=g.newPinTracks;return{...AB(e,t,m,DP(e,t,f[f.length-1])?.id,o),newPinTracks:h}}(e,t,S,u,r,E,a):S}function xB(e){const{sceneId:t,endAnchor:n,fillBehavior:r}=e;return{...Nu({...e,type:xu.pinComponent,isBlocked:!1}),sceneId:t,endAnchor:n,fillBehavior:r}}function kB(e,t){const{sceneId:n,endAnchor:r,fillBehavior:o}=e,i={...Pu(e,t),sceneId:t.encodeReference(n,xu.track),endAnchor:"cardBoundary"===r?.type?{...r,cardBoundaryId:t.encodeReference(r.cardBoundaryId,xu.cardBoundaryComponent)}:r,fillBehavior:o};return t.encodeReferencable(i)}function NB(e,t){const{sceneId:n,endAnchor:r,fillBehavior:o}=e;return t.decodeReferencable(xB({...Lu(e,t),sceneId:t.decodeReferenceId(n),endAnchor:"cardBoundary"===r?.type?{...r,cardBoundaryId:t.decodeReferenceId(r.cardBoundaryId)}:r,fillBehavior:o}))}function PB(e){return ju(xu.pinComponent,0,e)}function LB(){return{isType:PB,encode:kB,decode:NB}}function FB(e,t,n){return ZT(e,t).getItemMaybe(e,n)}function UB(e,t,n){return ZT(e,t).getItem(e,n)}function BB(e,t){return VV(e).getPinAndCompositionForPinTrackId(t)}function jB(e,t,n){return fu(vk(e,t).timeline.pins.components,(e=>{const{endAnchor:t}=e;if("cardBoundary"===t?.type&&t.cardBoundaryId===n)return e}))}function VB(e,t,n){if(n.endAnchor){return Zx(e,t,n.endAnchor)}const r=qx(e,t,n),o=function(e,t,n){const r=TU(e,t,n,GV(e,t).tausAndDataLinkedSub().getTauData);return(r.next?.value??(r.match?.value&&bU(e,t,r.match.value.id)))||(Ed(n,_k(e,t))?"end":void 0)}(e,t,r);if(!o)return r;const i=SU(e,t,o);return Math.max(i,r)}function zB(e,t,n){if(e.isStoryboard){const r=VB(e,t,n),o=Kx(e,t,n);if(void 0!==n.fillBehavior)return r-o;return K(_k(e,n.sceneId),0,r-o)}{if(void 0===n.endAnchor)return _k(e,n.sceneId);const r=Zx(e,t,n.endAnchor),o=Kx(e,t,n);return Math.max(r-o,0)}}function GB(e,t,n){const r=zB(e,t,n),o=_k(e,n.sceneId)-r;return yd(o,0)&&({doc:e}=DB(e,n.sceneId,{offset:r,duration:o})),e}function WB(e,t){const n=Wx(e,t),r=new Map;for(const o of n.pins.components)if("loop"===o.fillBehavior){const n=zB(e,t,o),i=_k(e,o.sceneId);if(Ed(i,0))continue;const a=vk(e,o.sceneId),s=a.timeline.superTau.taus;let c=s;for(let e=0,t=i;t<n;e++,t+=i)c=gu(c,s.map((t=>({...t,id:`${t.id}:loop-${e}`}))));c!==s&&r.set(o.sceneId,lx(a,zx(a.timeline,xx(a.timeline.superTau,c))))}return r.size>0&&(e={...e,pinScenes:e.pinScenes.map((e=>r.get(e.id)||e))}),e}const HB=em("applyFillBehavior");const{equalFrameCounts:qB}=s;function $B(e,t,n){const r=nN(e,t,n.id),o=Boolean(r&&r.length>0);return!DN(e,t,n)||o}function KB(e,t,n){let r=0;const o=rR(e,t,n);void 0!==o&&(r+=o);let i=OP(e,t,n);for(;i;){const n=oR(e,t,i.id);if(void 0!==n&&(r+=n),$B(e,t,i))break;i=OP(e,t,i.id)}return r}function YB(e,t,n,r){const o=wP(e,t,n),i=nN(e,t,n);if(EN(o)||i)return EN(o)||function(e,t,n,r){const o=Math.trunc(r),i=sN(e,t,n);if(!i)return!0;if(i.length>0)return o>=$s(i.elementAt(i.length-1).range);return!1}(e,t,n,r)||i&&0===i.length?function(e,t,n){let r=DP(e,t,n);for(;r&&!$B(e,t,r);)r=DP(e,t,r.id);if(r)return KB(e,t,r.id);if(EE(e)){const r=GV(e,t).tausAndDataLinkedSub().getTauData(n);if(r.linkedSubAlignment?.wordArrayView&&r.linkedSubAlignment.wordArrayView.length>0&&r.tau.audioSegment){const e=Wg(r.linkedSubAlignment.wordArrayView,r.linkedSubAlignment.wordArrayView.length-1);return r.tau.audioSegment.offset+r.duration-e.endTime}}}(e,t,n):function(e,t,n,r){const o=Math.trunc(r),i=sN(e,t,n);if(!i)return!0;if(i.length>0)return o<$s(i.elementAt(0).range);return!1}(e,t,n,r)?KB(e,t,n):function(e,t,n,r){const o=Math.trunc(r),i=sN(e,t,n);if(!i)return;const{match:a,next:s}=i.searchForTextOffset(o),c=a||s;if(c){const r=i.lastFinishedWordForTextOffset(o);return r?Math.max(0,c.value.startTime-r.endTime):rR(e,t,n)}}(e,t,n,r)}function ZB(e,t,n){let r;return UU(e,t,{location:n,length:0},((n,o,i,a,s)=>!!s||(r=YB(e,t,n.id,o.location),EE(e)&&void 0===r&&n.audioSegment&&(!NN(e,n)||EN(n))&&(r=n.audioSegment.duration),!1))),void 0!==r&&r>=0?r:void 0}function JB(e,t){return Math.max(0,e.startTime-t.offset)}function QB(e,t){return Math.min(_F(t),e.endTime-t.offset)}function XB(e,t,n){let r=UP(e,t,n);const o=r?BP(e,t,r.id):void 0;if(r&&void 0!==o&&o>0){const i=rN(e,0,r),a=r.audioSegment||hF({offset:0,duration:o});if(i){const o=FP(e,t,r.id),s=pL(i,n-o+a.offset);if(s.previous){return o+QB(s.previous.value,a)}if(s.match){const e=s.match.index-1;if(e>=0){return o+QB(Wg(i,e),a)}}}}let i=r?FP(e,t,r.id):0;for(r=r?OP(e,t,r.id):void 0;DN(e,t,r);){const n=BP(e,t,r.id);if(n>0){const o=oR(e,t,r.id),a=FP(e,t,r.id);if(void 0!==o&&!qB(o,n))return a+n-o;i=a}r=OP(e,t,r.id)}return i}const ej=new Set(["MMM","UM","UH","UHM","UHH","UMM"]),tj="repeated_words",nj=new Set(["BUT YOU KNOW","HM","I GUESS","I MEAN","I SUPPOSE","KIND OF","LIKE","MMM","OR SOMETHING","RIGHT","SO","SORT OF","UH","UM","WELL","YOU KNOW","YOU KNOW WHAT I MEAN","YOU SEE"]);function rj(e){return ej.has(Nh(e))?"basic":bh(e.attrs,Ih.Filler)?"all":void 0}function oj(e,t,n,r,o){if(!e||!t||n||!o)return;const i=[];for(let a=0;a<e.wordArrayView.length;a++){const n=Wg(e.wordArrayView,a),o=rj(n);if(void 0!==o){const s=r?0:JB(n,t),c=r?0:QB(n,t);i.push({textRange:e.rangesWithPunc[a],timeRange:{offset:s,duration:c-s},type:o,word:n.word.toLowerCase()})}}return 0!==i.length?i:void 0}const ij=em("fillerWordsInTau");function aj({tau:e,linkedSubAlignment:t,isScratchText:n,key:r,supportsFillerWords:o}){return qf(oj,r,ij,t,e.audioSegment,n,e.isBlocked,o)}function sj(e,t,n,r,o){const i=n?new Map(n.map((({tauId:e,range:t})=>[e,t]))):void 0,a="all"===o;const{tausData:s}=GV(e,t).tausAndDataLinkedSub();return[...es(s,(e=>{const t=e.tau,n=i&&i.get(t.id);if(i&&!n)return;const o=aj(e);if(!o)return;const s=e.renderedText.string.length,c=Array.from(es(o,(e=>{if(!function({type:e}){return a||"basic"===e}(e))return;let{textRange:t}=e;return!n||Ks(t,n)?(r&&$s(t)<s&&(t=Gs.get(t.location,t.length+1)),{textRange:t,timeRange:e.timeRange,word:e.word}):void 0})));return 0!==c.length?{tauId:t.id,sortedRanges:c}:void 0}))]}function cj(e){const t=[];for(let n=0;n<e.ranges.length;n++){const r=Wg(e.wordArrayView,n);if(bh(r.attrs,Ih.Error)){const o=e.rangesWithPunc[n];t.push({textRange:o,alternative:r.extra?.wordErrorAlternative})}}if(0!==t.length)return t}const dj=em("wordErrorsInTau");function lj({tau:e,linkedSubAlignment:t,isScratchText:n,key:r}){if(t&&e.audioSegment&&!n)return qf(cj,r,dj,t)}var uj=(e=>(e.ScratchText="ScratchText",e.SynthesizedText="SynthesizedText",e.BlockedTextStrikethrough="BlockedTextStrikethrough",e.BlockedText="BlockedText",e.FailedAlignmentUnderline="FailedAlignmentUnderline",e.InvalidAlignmentUnderline="InvalidAlignmentUnderline",e.UnalignedUnderline="UnalignedUnderline",e.GeneratingUnderline="GeneratingUnderline",e.GibberishUnderline="GibberishUnderline",e.NewTextOverdubRedesign="NewTextOverdubRedesign",e.GeneratingTextOverdubRedesign="GeneratingTextOverdubRedesign",e.SynthesizedUnderlineOverdubRedesign="SynthesizedUnderlineOverdubRedesign",e.FailedUnderlineOverdubRedesign="FailedUnderlineOverdubRedesign",e.OverdubMissingConsent="OverdubMissingConsent",e.RecordingWord="RecordingWord",e.IgnoredText="IgnoredText",e.Timecode="Timecode",e.Tag="Tag",e.InlineNote="InlineNote",e))(uj||{});const fj={ScratchText:"#43A1D9",SynthesizedText:"#0062ff",BlockedTextStrikethrough:"rgba(102, 102, 102, 0.5)",BlockedText:"#C1C2C5",FailedAlignmentUnderline:"#FF7A40",InvalidAlignmentUnderline:"#FF0000",UnalignedUnderline:"rgba(0, 0, 0, 0.5)",GeneratingUnderline:"#B3B3B3",GibberishUnderline:"#0062ff",NewTextOverdubRedesign:"#858585",GeneratingTextOverdubRedesign:"#858585",SynthesizedUnderlineOverdubRedesign:"#858585",FailedUnderlineOverdubRedesign:"#343434",OverdubMissingConsent:"#817412",RecordingWord:"#D98998",IgnoredText:"#B2B2B2",Timecode:"#808080",Tag:"#808080",InlineNote:"#B2B2B2"},mj={ScratchText:"var(--cyan-800)",SynthesizedText:"var(--blue-800)",BlockedTextStrikethrough:"var(--grey-200)",BlockedText:"var(--grey-200)",FailedAlignmentUnderline:"var(--orange-200)",InvalidAlignmentUnderline:"var(--red-500)",UnalignedUnderline:"var(--grey-400)",GeneratingUnderline:"var(--blue-200)",GibberishUnderline:"var(--blue-500)",NewTextOverdubRedesign:"var(--grey-400)",GeneratingTextOverdubRedesign:"var(--grey-400)",SynthesizedUnderlineOverdubRedesign:"var(--grey-400)",FailedUnderlineOverdubRedesign:"var(--grey-800)",OverdubMissingConsent:"var(--yellow-800)",RecordingWord:"var(--pink-200)",IgnoredText:"var(--grey-800)",Timecode:"var(--grey-400)",Tag:"var(--grey-400)",InlineNote:"var(--grey-800)"};function pj(e,t){if(e in uj){return(t?mj:fj)[e]}return e}function gj(e,t,n,r){if(void 0===e){const e=function(e){if(!e||!k_(e))return!e||function(e){return void 0===e.backendVoiceId}(e)||"missing"===e.consentStatus?"missing":e.consentStatus}(r);switch(e){case void 0:case"verified":return;case"missing":return"missingConsent";case"failed":return"failed";default:return"generating"}}return"running"===e?.state?"generating":"failed"===e?.state||n&&"regeneration"!==t?"failed":"done"===e?.state?"done":void 0}function hj(e,t,n,r,o,i,a){const s=Gs.get(0,t);if(!n)return bu();const c=e&&"isRegeneration"in e&&e.isRegeneration,d=o&&k_(o)?o.backendVoiceVersionStatus:void 0,l=c?"regeneration":void 0===i?"tts":"overdub",u=gj(e,l,void 0!==d&&R_.has(d),o);return[{attribute:lf,range:s},{attribute:_f({tauId:a,hasAudio:!r||"generating"===u,type:l,status:u}),range:s}]}const vj=em("notRealAudioAttributer");const Ej=Cf({line:zu.LineThrough,color:uj.BlockedTextStrikethrough}),yj=Cf({line:zu.Underline,color:uj.FailedAlignmentUnderline}),Sj=Cf({line:zu.Underline,style:Vu.Dotted,color:uj.UnalignedUnderline}),Ij=Cf({line:zu.Underline,style:Vu.Dotted,color:uj.InvalidAlignmentUnderline}),bj=Cf({line:zu.Underline,style:Vu.Dashed,color:uj.GibberishUnderline});function Tj(e,t,n,r,o,i,a,s){const c=Gs.get(0,r);return e?bu():t?[{attribute:Ej,range:c},{attribute:wf(uj.BlockedText),range:c}]:o&&void 0!==n&&n!==__?[{attribute:yj,range:c}]:!o||i&&n!==__?a?[{attribute:Ij,range:c}]:s?[{attribute:bj,range:c}]:bu():[{attribute:Sj,range:c}]}const wj=em("alignmentAudioStateAttributer");function Cj(e,t,n){if(!e)return bu();let r;for(let a=0;a<e.wordArrayView.length;a++)if(bh(Wg(e.wordArrayView,a).attrs,Ih.Placeholder)){r=a;break}if(void 0===r)return bu();const o=Gs.getStartEnd(e.rangesWithPunc[r].location,t),i=[{attribute:wf(uj.RecordingWord),range:o}];return n&&i.push({attribute:gf,range:o}),i}const _j=em("recordingWordAttributer");function Aj(e,t,n,r){const{tau:o,linkedSubAlignment:i,renderedText:a}=t,s=r?.tau,c=o.isScriptClip||0===i?.length||t.gapClipTau||!o.audioSegment&&0===o.text.string.length;if(!t.showWordlessMedia&&c||!s||o.recordingSession||t.isScratchText&&r?.isScratchText)return bu();const d=s?.audioSegment,l=o.audioSegment;if(d&&l&&o.ignoreAlignment!==s.ignoreAlignment&&bF(d,l))return bu();let u;if(t.showWordlessMedia&&c){const e=bs.index(a.string)||0;u=Gs.get(e,1)}else{const e=As.index(a.string)||0,t=Gs.get(e,1);u=dc(a.string,t)||t}return t.cardBoundaryComps?.some((({tauAnchor:e})=>e.tauId===o.id&&e.location===u.location))||(!t.showWordlessMedia||!c)&&0===u.location&&r&&r.cardBoundaryComps?.some((({tauAnchor:e})=>e.tauId===s?.id&&e.location===s.text.string.length))?bu():[{range:u,attribute:sf}]}const Rj=em("regionBoundaryAttributer");function Mj(e,t,n,r,o,i){if(i||n||r||!e?.length)return bu();const a=[],s=t.length-1,c=e.length;for(let d=0;d<c;d++){const n=e.elementAt(d),r=n.rangeWithPunc,o=d<c-1?e.elementAt(d+1):void 0,i=o?qs(o.range):s;let l=!1;for(let e=$s(r);e<=i;e++){const n=t[e];if(void 0===n)break;if(Es.contains(n)){l=!0;break}if(As.contains(n))break}if(!l)continue;const u=o&&o.startTime-n.endTime;u&&u>3&&a.push({range:r,attribute:Mf(u)})}if(o>3){const{rangeWithPunc:n}=e.elementAt(e.length-1),r=$s(n);void 0===As.index(t,Gs.get(r,s-r))&&a.push({range:n,attribute:Mf(o)})}return a}const Dj=em("wordGapAttributer");function Oj(e,t,n,r){if(void 0!==n)return bu();if(void 0!==e){const n=[{attribute:(o=r,{name:Gu.ScriptClip,value:o}),range:Gs.get(0,e)}];return t&&n.push({attribute:Rf(t),range:Gs.get(0,e)}),n}var o;return bu()}const xj=em("scriptClipAttributer");function kj(e){return e?e.map((({textRange:e,type:t})=>({range:e,attribute:"basic"===t?cf:df}))):bu()}const Nj=em("fillerWordAttributes");function Pj(e){return e?e.map((({textRange:e,alternative:t})=>({range:e,attribute:Of(t)}))):bu()}const Lj=em("wordErrorAttributes");const Fj=em("speakerAttributer");function Uj(e,t,n){if(!e||!t||void 0===n)return bu();const r=[];for(let i=0;i<e.ranges.length;i++){const a=Wg(e.wordArrayView,i);a.tag&&r.push({range:e.ranges[i],attribute:(o={mediaRefId:n,index:i+t.offset,wordlessRepresentation:a.tag.wordlessRepresentation},{name:Gu.Tag,value:o})})}var o;return r}const Bj=em("tagAttributer");const jj=[function({tauData:{key:e,tau:t,scratchSequenceTauInfo:n,renderedText:{string:{length:r}},isScratchText:o,isScratchTextWithoutAudio:i,defaultSpeaker:a}}){const{id:s,overdubInfo:c,replacedContentSceneId:d}=t;return qf(hj,e,vj,c??n?.tau?.overdubInfo,r,o,i,a,d??n?.tau?.replacedContentSceneId,s)},function({tauData:{key:e,tau:{id:t,isScriptClip:n,isBlocked:r,failedAlignmentKey:o},renderedText:{string:{length:i}},hasRealAudio:a,hasAlignedRealAudio:s,hasInvalidAlignment:c,hasGibberish:d}}){return qf(Tj,e,wj,n,r,o,i,a,s,c,d)},function({tauData:e,prevTauData:t}){return qf(Aj,e.key,Rj,xb(e.tag),e,t&&xb(t.tag),t)},function({tauData:{key:e,tau:t,linkedSubAlignment:n,renderedText:r,wordGapAfterParagraph:o,wordlessMedia:i}}){return qf(Mj,e,Dj,n,r.string,t.isScriptClip,void 0!==t.recordingSession,o,Boolean(i))},function({tauData:{key:e,tau:{id:t,recordingSession:n,isScriptClip:r},renderedText:o,scratchSequenceTauInfo:i}}){return qf(Oj,e,xj,r?o.string.length:void 0,n,i,t)},function({tauData:e}){return qf(kj,e.key,Nj,aj(e))},function({tauData:e}){return qf(Pj,e.key,Lj,lj(e))},function({tauData:{key:e,paragraphSpeakers:t,tau:n}}){let r=Fj.get(e);if(!r){r={getSpeakers:us((e=>e),((e,t)=>e.range===t.range&&e.speaker.change===t.speaker.change&&e.speaker.speaker===t.speaker.speaker&&e.speaker.previousSpeaker===t.speaker.previousSpeaker)),prevSpeakers:[],result:[]},Fj.set(e,r)}const o=r.getSpeakers(t);return o===r.prevSpeakers||(r.prevSpeakers=o,r.result=function(e){const t=[];for(const{range:r,speaker:o}of e)t.push({range:r,attribute:(n=o,{name:Gu.ParagraphSpeaker,value:n})});var n;return t}(o)),r.result},function({tauData:{key:e,linkedSubAlignment:t,subAlignmentInMediaDomain:n,ref:r}}){return qf(Uj,e,Bj,t,n,r?.voiceover?r.id:void 0)},function({tauData:{key:e,linkedSubAlignment:t,renderedText:{string:{length:n}},tau:{recordingSession:r}}}){return qf(Cj,e,_j,t,n,void 0!==r)}],Vj=em("getTauAttributedRanges");function zj(e){return tB(e)?e.attributedString.string.trim():hR(e)?e.text:Zm(e)?e.attrText:PB(e)||iw(e)?$a:pU(e)?qa:"<UNKNOWN>"}function Gj(e,t,n){const{prefix:r,outsidePrefix:o}=function(e,t){let n,r="";return tB(e)?r=e.hasPrefix?KU:"":Zm(e)?r=" (":PB(e)?r=" ":hR(e)?"\n"===t?n="\n":void 0!==t&&(r="\n"):iw(e)&&(r=" "),{prefix:r,outsidePrefix:n}}(e,t),i=zj(e),{suffix:a,outsideSuffix:s}=function(e,t){let n,r="";return tB(e)?r=e.hasSuffix?YU:"":Zm(e)?r=") ":PB(e)?r=" ":hR(e)?"\n"===t?n="\n":r="\n":iw(e)&&(r=" "),{suffix:r,outsideSuffix:n}}(e,n);if(0===r.length+Pf(i)+a.length)throw new Error("Component cannot be represented by empty string");return{outsidePrefix:o,prefix:r,content:i,suffix:a,outsideSuffix:s}}function Wj(e,t,n){const{prefix:r,content:o,suffix:i}=n,a=jf(Bf(o,i),r);return Rm(Ff(a),{attribute:Hj(e,t),range:Gs.get(0,Pf(a))})}function Hj(e,t){if(tB(e))return Df(e.tauId,e.isBlankCardGap,Boolean(e.barValues&&e.barValues.every((e=>-1===e))));if(hR(e))return n=e.id,{name:Gu.Marker,value:n};var n,r,o;if(PB(e))return r=e.id,{name:Gu.Pin,value:r};if(Zm(e))return Ju;if(iw(e))return o=e.id,{name:Gu.Cue,value:o};if(pU(e))return function(e,t){const n={id:e,isInline:!("\n"===t||void 0===t)};return{name:Gu.CardBoundary,value:n}}(e.id,t);throw new Error(`Unknown attribute for component of type ${e.type}`)}function*qj(e,t){if(e)if(t)for(const n of e)t.has(n)&&(yield n);else e&&(yield*e);else t&&(yield*t)}function $j(e){return e.attribute.name===Gu.Annotation?e.attribute.value:void 0}function Kj(e,t){return function(e){let t;for(const i of e)t||(t=[]),t.push(i);if(!t)return;t.sort();const n=t.join(":"),r=Yj[n];if(r)return r;const o=new Set(t);return Yj[n]=o,o}(es(Vm(e,t),$j))}const Yj={};function Zj(e,t){return function(e,t){return t.componentsInfo[e.id]}(e,t).attrStr}function Jj(e,t,n){return function(e,t,n){return GV(e,t).tausAndDataForBasicAttributedString().getTauData(n).basicAttributedString}(e,t,n.tauAnchor.tauId).componentsInfo[n.id]}function Qj(e,t,n){const r=Bu(n)?function(e,t,n){return Jj(e,t,n).attrStr}(e,t,n):n.attributedString;return r?r.string:""}function Xj(e,t,n){if(tB(n))return n.hasPrefix?KU:"";const r=Jj(e,t,n).parts;return r&&r.prefix||""}function eV(e,t,n){if(tB(n))return n.hasSuffix?YU:"";const r=Jj(e,t,n).parts;return r&&r.suffix||""}function tV(e,t,n){if(tB(n))return"";const r=Jj(e,t,n).parts;return r&&r.outsidePrefix||""}function nV(e,t,n){if(tB(n))return"";const r=Jj(e,t,n).parts;return r&&r.outsideSuffix||""}function rV(e,t,n){const r=Qj(e,t,n),o=tV(e,t,n),i=nV(e,t,n);return 0===o.length&&0===i.length?r:`${o}${r}${i}`}function oV(e,t,n){if(tB(n))return n.hasPrefix?KU:"";const r=Jj(e,t,n).parts;if(!r)return"";const{outsidePrefix:o="",prefix:i}=r;return`${o}${i}`}function iV(e,t,n){if(tB(n))return n.hasSuffix?YU:"";const r=Jj(e,t,n).parts;if(!r)return"";const{outsideSuffix:o="",suffix:i}=r;return`${i}${o}`}function aV(e,t,n,r,o,i){return function(e,t,n,r,o,i){const a=[];let s=0;const c={};for(const d of e){const e=aB(d);if(e===s&&a.length>0){let e=a.length-1;for(;e>=0;){const t=a[e].string.length;if(t>0){n=a[e].string[t-1],r=Kj(a[e],t-1);break}e--}}else e>0&&(n=t.string[e-1],r=Kj(t,e-1));let l,u;e===t.string.length?(l=o,u=i):(l=t.string[e],u=Kj(t,e));const f=Gj(d,n,l);let m,p=Wj(d,n,f);for(const t of qj(r,u))m||(m=[]),m.push(t);if(m&&m.length>0){const e=Gs.get(0,p.string.length);p=Mm(p,Array.from(Qa(m,(t=>({attribute:Tf(t),range:e})))))}Bu(d)&&(c[d.id]={attrStr:p,parts:f}),a.push(km(t,s,e),p),s=e}return a.push(km(t,s)),{attrString:Mm(Am(a),[]),componentsInfo:c}}(i,o=Dm(o,[{attribute:uf,range:Gs.get(0,o.string.length)}]),e,t,n,r)}const sV=em("basicTauString");class cV extends ZD{constructor(){super(...arguments),this.key="BasicTauAttributedStringsUpdate"}setResult(e,t,n){super.setResult(e,t,n),Ob(e.basicAttributedStringTag)}areEqualResults(e,t){return e===t||void 0!==e&&void 0!==t&&(e.prevChar===t.prevChar&&e.prevCharAnnotations===t.prevCharAnnotations)}getChangedIndices(){const e=super.getChangedIndices();if(!e)return;const t=Math.max(0,e.location-1),n=Math.min(this.getItems().length,$s(e)+1);return Gs.getStartEnd(t,n)}compute(e,t){const n=this.getItems()[e.index+1];let r,o;if(n){const e=n.renderedText;e.string.length>0&&(r=e.string[0],o=Kj(e,0))}let i,{prevChar:a,prevCharAnnotations:s}=t||{},c=bu();this.trackData.showWordlessMedia?(this.trackData.track.type===Jh.Composition&&(c=uB(this.trackData.projectId,e,n)),i=pB(c,e.orderedComponents,eB(e))):i=e.orderedComponents;const d=function(e,t,n,r,o,i,a,s){return qf(aV,e,sV,n,r,o,i,a,s)}(e.key,e.tau,a,s,r,o,e.renderedText,i),l=d.attrString,u=l.string.length;if(u>0){const e=u-1;a=l.string[e],s=Kj(l,e)}return{prevChar:a,prevCharAnnotations:s,basicAttributedString:d,wordlessMedia:c,orderedComponentAndWordlessMediaRenderedRanges:gB(d,i),orderedComponentsAndWordlessMedia:i}}}function dV(e,t){const n=function(e,t){const n={tauData:e,prevTauData:t},r=jj.map(((e,t)=>{const r=e(n);return 0===r.length?bu():r})),{key:o}=e,i=Vj.get(o),a=!i,s=i||{combined:bu(),allAttrs:bu()};return!a&&ls(s.allAttrs,r)||(s.allAttrs=r,s.combined=Array.from(ss(r)),a&&Vj.set(o,s)),s.combined}(e,t),{showWordlessMedia:r,orderedComponents:o,basicAttributedString:i,renderedText:a}=e;let s=a;return n&&(s=Dm(a,n)),function(e,t,n,r){const o=[];let i=0;const a=r||t;for(const s of a){const t=aB(s);let r=Bu(s)?Zj(s,n):s.attributedString;if(tB(s)){const n=km(e,t,t+s.range.length).attributes.find((e=>e.attribute.name===Gu.RegionBoundary));n&&(r=Rm(r,n),e=Om(e,(e=>e.attribute.name!==Gu.RegionBoundary)))}const a=km(e,i,t);o.push(a,r),i=t}return o.push(km(e,i)),Mm(Am(o),[])}(s,o,i,r?e.orderedComponentsAndWordlessMedia:void 0)}function lV(e,t){const{tausData:n}=t.tausAndDataForAttributedString();let r;return Sb(n.map((e=>{const t=e.tauAttributedString(r);return r=e,t})))}const{getIndexesOf:uV}=a;function fV(e,t){for(let n=e-1;n>=0;n--){const{renderedText:e}=t[n];if(e&&e.string.length>0)return e.string.charAt(e.string.length-1)}}function mV(e,t,n,r,o){if(e)return 1;if(!n)return o||(t?1:void 0);if(0===n.length)return 1;const{match:i,next:a}=n.searchForTextOffset(r),s=i||a;return s?s.value.speaker:1}function pV(e,t){let n;const r=e.length;if(t===r)return-1;for(n=t;n<r;n++){const r=e.charAt(n);if(bs.contains(r)){if(n===t&&"\n"===r)return-1;break}}return n>t?n:t+1}function gV(e){const t=[];let n=0;const r=e.attributes;let o=0,i=0;for(const[a,s]of cs(uV(e.string,"\n"))){const c=a+1===e.string.length?a:a+1,d=void 0!==s?s+1===e.string.length?s:s+1:e.string.length;for(;o<r.length;){const e=r[o];if(e.attribute===uf){if(!($s(e.range)<=c))break;i+=e.range.length}o+=1}const l=Gs.get(c,d-c);let u=!1;if(o<r.length){Ks(l,r[o].range)&&(u=!0)}if(!u){n+=1;continue}let f=0;const m=Gs.get(0,a+1);for(;o<r.length;){const e=r[o];if(e.attribute===uf){const t=e.range,n=Zs(t,m);if(!n)break;if($s(n)<$s(t)){f=n.length;break}i+=t.length}o+=1}t.push({textOffset:i+f,extraParagraphCount:n}),n=0}return n>0&&t.push({textOffset:void 0,extraParagraphCount:n}),t}const hV=em("lineStartIndexes");function vV(e,t){if(-1!==t)return Gs.getStartEnd(e,t)}function EV(e,t){return t&&void 0===e.replacedContentSceneId}function yV(e,t,n,r,o,i,a,s,c){if(e)return!0;if((d=t)!==(l=n)&&(void 0===d||void 0===l||d.speakerId!==l.speakerId||d.styleId!==l.styleId))return!0;var d,l;if(!c)return!1;const u=EV(r,o),f=void 0!==i&&EV(i,a);if(0===s&&i&&u!==f)return!0;var m,p;return!((m=t?.generationControls,p=n?.generationControls,(0,Me.fastDeepEqualJson)(m??FM,p??FM)||!u)||!f)}function SV({text:e,nextParagraphTextOffset:t,rangeToNewlineOrWhitespace:n,lastTauIsScriptClip:r}){if(r)return!1;return!(void 0===As.index(e.string,Gs.getStartEnd(n.location,t??e.string.length)))}function IV(e,t,n,r,o,i,a,s,c,d,l,u,f,m,p){const g=function(e,t,n){return qf(gV,e,hV,n)}(e,0,l),h=t.generationControls,v=t.isScriptClip,E=EN(t)||Boolean(t.recordingSession&&t.isScriptClip),y=[];let S;const I=n.string.length;let b=0,T=!1;if(void 0!==i){const e=mV(E,r,o,0,t.defaultSpeaker),l=void 0!==a?a:t.id;if(1!==e){const r=e?dA({speakerId:e.speakerId,styleId:e.styleId,generationControls:h,isTTS:EV(t,u)}):void 0,o=void 0!==a?d:vV(i,pV(n.string,i));if(o&&SV({text:n,nextParagraphTextOffset:g[i]?.textOffset,rangeToNewlineOrWhitespace:o,lastTauIsScriptClip:v})){const e={range:o,index:b,speaker:{speaker:r??1,previousSpeaker:c??1,change:yV(s,r,c,t,u,f,m,b,p)}};l===t.id?y.push(e):S={tauId:l,speaker:e},s=!1,c=r}b+=1,i=void 0,a=void 0,d=void 0}else T=!0}for(let w=0;w<g.length;w++){const{textOffset:e,extraParagraphCount:l}=g[w];if(b+=l,void 0===e){a=void 0,i=0,d=void 0;continue}if(e===I){a=void 0,i=0,d=void 0,b+=1;continue}const S=mV(E,r,o,e,t.defaultSpeaker);if(1===S){a=t.id,i=e,d=void 0,b+=1;continue}const T=S?dA({speakerId:S.speakerId,styleId:S.styleId,generationControls:h,isTTS:EV(t,u)}):void 0,C=vV(e,pV(n.string,e));C&&SV({text:n,nextParagraphTextOffset:g[w+1]?.textOffset,rangeToNewlineOrWhitespace:C,lastTauIsScriptClip:v})&&(y.push({range:C,index:b,speaker:{speaker:T??1,previousSpeaker:c??1,change:yV(s,T,c,t,u,f,m,b,p)}}),s=!1,c=T),b+=1}if(b>0&&(T&&(b+=1),void 0!==i&&(b-=1)),void 0!==i&&a===t.id){d=vV(i,pV(n.string,i))}return{tau:t,tauSpeakers:y,earlierTauSpeaker:S,getNextParaTauIndex:i,getNextParaTauId:a,isFirstSpeaker:s,lastSpeaker:c,paragraphIndex:b,nextParaTauRange:d,lastTauIsScriptClip:v,lastTauCannotHaveSpeaker:E}}const bV=em("tauParagraphSpeakers");class TV extends YD{constructor(){super(...arguments),this.key="TauParagraphSpeakersUpdate",this.extraUpdates=new Map}compute(e,t,n){const{subAlignment:r,linkedSubAlignment:o,renderedText:i,key:a,isScratchText:s}=e;let{paragraphIndex:c=0,getNextParaTauIndex:d,getNextParaTauId:l,isFirstSpeaker:u=!0,lastSpeaker:f,nextParaTauRange:m,tau:p,isScratchText:g}=t||{};t||(l=e.tau.id,d=0,m=vV(0,pV(e.renderedText.string,0)));const h=function(e,t,n,r,o,i,a,s,c,d,l,u,f,m,p){return qf(IV,e,bV,e,t,n,r,o,i,a,s,c,d,l,u,f,m,p)}(a,e.tau,i,r,o,d,l,u,f,m,e.basicAttributedString.attrString,s,p,g??!1,this.trackData.useUpdatedSpeakerBlocks.get()),v=h.tauSpeakers.map((e=>({...e,index:c+e.index})));return h.earlierTauSpeaker&&this.extraUpdates.set(h.earlierTauSpeaker.tauId,{...h.earlierTauSpeaker.speaker,index:c+h.earlierTauSpeaker.speaker.index}),{...h,initialTauSpeakers:v,tauSpeakers:v,paragraphIndex:h.paragraphIndex+c,isScratchText:s}}apply(){super.apply();const e=this.getItems();if(0===e.length)return;for(const[l,u]of this.extraUpdates){const e=this.getItem(l);if(e){const t=this.getResult(e);t&&(t.tauSpeakers=[...t.initialTauSpeakers,u])}}this.extraUpdates.clear();const t=e[e.length-1],n=this.getResult(t);if(!n)throw new Error("missing result");const{getNextParaTauId:r,getNextParaTauIndex:o,lastTauIsScriptClip:i,lastTauCannotHaveSpeaker:a,paragraphIndex:s,lastSpeaker:c,isFirstSpeaker:d}=n;if(void 0!==r&&void 0!==o&&!i&&!a){const e=this.getItem(r),t=vV(o,pV(e.renderedText.string,o));if(t){const n=this.getResult(e);if(n){const e={range:t,index:s,speaker:{speaker:void 0===c?1:c,previousSpeaker:void 0===c?1:c,change:d}};0!==n.tauSpeakers.length&&(0,Me.fastDeepEqualJson)(n.tauSpeakers[n.tauSpeakers.length-1],e)||(n.tauSpeakers=[...n.initialTauSpeakers,e])}}}}}class wV extends YD{constructor(){super(...arguments),this.key="WordGapsAfterParagraphUpdate",this.extraUpdates=new Map}apply(){super.apply();const e=this.getItems();if(e.length>0){const t=this.getResult(e[e.length-1]);void 0!==t?.lastTauIdWithWords&&this.extraUpdates.set(t.lastTauIdWithWords,t.gapBefore)}for(const[t,n]of this.extraUpdates){const e=this.getItem(t),r=this.getResult(e);r&&(r.wordGapAfterParagraph=n)}this.extraUpdates.clear()}compute(e,t){let n=0,{hasNewline:r=!1,gapBefore:o=0,lastTauIdWithWords:i}=t||{};const{tau:a,linkedSubAlignment:s,basicAttributedString:{attrString:{string:c}}}=e;for(let d=0;d<=c.length-1;d++){const e=c[d];if(Es.contains(e)){r=!0;break}if(As.contains(e))break}if(s?.length&&a.audioSegment){const t=s.wordArrayView,n=t.length,d=o+JB(Wg(t,0),a.audioSegment);void 0!==i&&this.extraUpdates.set(i,r?d:0),i=e.tau.id;const l=Wg(t,n-1);o=Math.max(0,e.duration-QB(l,a.audioSegment));for(let e=$s(s.rangesWithPunc[n-1]);e<=c.length;e++){const t=c[e];if(void 0===t){r=!1;break}if(Es.contains(t)){r=!0;break}if(As.contains(t)){r=!1;break}}}else a.isScriptClip||e.isScratchText||e.cardBoundaryComps?.length?(void 0!==i&&this.extraUpdates.set(i,r||e.cardBoundaryComps?.length?o:0),i=void 0,o=0,n=0):(o+=e.duration,n=0);return{wordGapAfterParagraph:n,hasNewline:r,gapBefore:o,lastTauIdWithWords:i}}}class CV extends YD{constructor(){super(...arguments),this.key="ComponentRenderedRangeUpdate"}areEqualResults(e,t){return e===t}compute(e,t,n){const r=this.getResult(e);if(0===e.orderedComponents.length&&r&&0===r.length)return r;const o=e.basicAttributedString;let i=0,a=0;function s(e){const t=Zj(e,o).string.length,n=e.tauAnchor.location,r=i+n,s=r+t;if(r<a)throw new Error("Component starts before previous component end");const c=Gs.get(r,t);return a=s,i+=t,c}return r&&r.length===e.orderedComponents.length?Eu(r,((t,n)=>s(e.orderedComponents[n]))):e.orderedComponents.map(s)}}function _V(e,t,n,r,o,i){const a=r.get(e);if(a){const o=i(a,t,n);if(void 0===o)return!1;o!==a&&r.set(e,o)}else{const i=o(t,n);if(!i)return!1;r.set(e,i)}return!0}function AV(e,t,n,r){if(t)for(const[o,i]of e.entries())t.has(o)||(e.delete(o),r(i));if(n)for(const o of n){const t=e.get(o);t&&(r(t),e.delete(o))}}function RV(e,t,n,r,o){const i=e.length;let a;for(let c=0;c<i;c++){const o=e[c],i=o.id;_V(i,o,c,t,n,r)||(a||(a=new Set),a.add(i))}const s=t.size===e.length-(a?.size??0)?void 0:new Set(e.map((e=>e.id)));AV(t,s,a,o)}class MV{constructor(e){this.str=e,this.countOffsets=[],this.wordEnds=[],this.strLength=0,this.needsComputing=!0,this.strLength=e.length}compute(){this.needsComputing&&(Zh.enumerateWords(this.str,((e,t,n,r)=>(this.countOffsets.push(n),this.wordEnds.push(n+r),!1))),this.needsComputing=!1)}get computedCountOffsets(){return this.compute(),this.countOffsets}get computedWordEnds(){return this.compute(),this.wordEnds}get totalWords(){return this.computedCountOffsets.length}wordCountAtOffset(e){P()(Number.isInteger(e),"offset should be an integer");const{previous:t,match:n}=rh(this.computedWordEnds,(t=>oh(t-e)));return n?n.index+1:t?t.index+1:0}offsetAtWordCount(e){return P()(Number.isInteger(e),"wordCount should be an integer"),P()(e>=0,"wordCount must not be negative"),e>=this.totalWords?this.strLength:this.computedCountOffsets[e]}}function DV(e,t,n,r=0,o=e.length){if(e===t)return!0;const i=r+o;if(r<0||i>t.length||i>e.length)return!1;for(let a=r;a<i;a++)if(!n(e[a],t[a]))return!1;return!0}class OV{constructor(e){this._length=0,this.storage=new Array(e)}get length(){return this._length}get(e){if(!(e<0||e<this.length-this.storage.length))return this.storage[e%this.storage.length]}setTail(e){this.length>0&&(this.storage[(this.length-1)%this.storage.length]=e)}push(e){this.storage[this.length%this.storage.length]=e,this._length+=1}toAvailableArray(){const e=this.storage.length,t=Math.min(this.storage.length,this.length),n=Math.max(this.length-e,0)%e,r=Math.min(e,n+t),o=this.storage.slice(n,r),i=this.storage.slice(0,t-o.length);return o.concat(i)}}function xV(e,t){if(!(0,Me.fastDeepEqual)(e,t))throw new Error(`Expected equal values : ${e} and ${t}`);e!==t&&console.warn("Values are not reference-equal",e,t)}function kV(e){let t;function n(){return n.reset&&(t=e(),n.reset=!1),t}return n.reset=!0,n}function NV(e,t){return function(n){const r=e.get(n);if(!r)throw new Error(`key ${n} not present in ${t} map`);return r}}class PV{constructor(e,t,n,r,o,i,a,s,c,d,l,u){this.projectId=e,this.trackType=t,this.orderedComponents=[],this.updateMemos={},this.needsLinkedSubAlignment=!0,this.wordCounter=kV((()=>new MV(this.tau.text.string))),this.tag={CLOCK:1},this.basicAttributedStringTag={CLOCK:1},this.tasResult=new Pb(Im),this.key=lm(e,n),this.update(n,r,o,i,a,s,c,d,l,u)}get wordGapAfterParagraph(){const e=this.updateMemos.WordGapsAfterParagraphUpdate?.result;if(!e)throw new Error("no wordGapAfterParagraph result");return e.wordGapAfterParagraph}get basicAttributedString(){const e=this.updateMemos.BasicTauAttributedStringsUpdate?.result;if(!e)throw new Error("no basicAttributedString result");return e.basicAttributedString}get wordlessMedia(){const e=this.updateMemos.BasicTauAttributedStringsUpdate?.result;if(!e)throw new Error("no basicAttributedString result");return e.wordlessMedia}get orderedComponentsAndWordlessMedia(){const e=this.updateMemos.BasicTauAttributedStringsUpdate?.result;if(!e)throw new Error("no basicAttributedString result");return e.orderedComponentsAndWordlessMedia}get orderedComponentAndWordlessMediaRenderedRanges(){const e=this.updateMemos.BasicTauAttributedStringsUpdate?.result;if(!e)throw new Error("no basicAttributedString result");return e.orderedComponentAndWordlessMediaRenderedRanges}get orderedComponentRenderedRanges(){const e=this.updateMemos.ComponentRenderedRangeUpdate?.result;if(!e)throw new Error("no orderedComponentRenderedRanges result");return e}get paragraphSpeakers(){const e=this.updateMemos.TauParagraphSpeakersUpdate?.result;if(!e)throw new Error("no paragraphSpeakers result");return e.tauSpeakers}updateWithChangedTauString(e){this.wordCounter.reset=!0}updateWithChangedShowWordlessMedia(e){this.showWordlessMedia=e}updateWithChangedTau(e){this.hasAudio=GN(e),this.gapClipTau=EN(e)?e:void 0,this.freezeFrameTau=TN(e)?e:void 0,this.infinitelyExtendableTau=wN(e)?e:void 0,this.hasCaptions=IN(e),this.annotations=mP(e.text),this.hasGibberish=MM(e)}checkTau(e){xV(this.hasAudio,GN(e)),xV(this.gapClipTau,EN(e)?e:void 0),xV(this.freezeFrameTau,TN(e)?e:void 0),xV(this.infinitelyExtendableTau,wN(e)?e:void 0),xV(this.hasCaptions,IN(e)),xV(this.annotations,mP(e.text)),xV(this.hasGibberish,MM(e))}updateWithChangedTauAndRef(e,t){var n;this.hasRealAudio=WN(e,t),this.hasAlignedAudio=HN(e,t),this.hasAlignedRealAudio=qN(e,t),this.isScratchText=KN(e,t),this.scratchSequenceRef=this.isScratchText&&t&&Mg(t)?t:void 0,this.isOverdub=(n=t,Boolean(e.overdubInfo)||Boolean(n&&Mg(n))),this.isScratchTextWithoutAudio=this.isScratchText&&$N(e,t),this.canFreezeFrame=pP(e,t),this.subAlignment=rP(this.projectId,e,t);const r=e.audioSegment;this.subAlignmentInMediaDomain=r&&1!==r.speed?nP(this.projectId,e,t):this.subAlignment,this.duration=zN(e,this.isScratchText?this.subAlignment:void 0),this.supportsFillerWords=Vg(t),this.needsLinkedSubAlignment=!0}checkTauAndRef(e,t){xV(this.hasRealAudio,WN(e,t)),xV(this.hasAlignedAudio,HN(e,t)),xV(this.hasAlignedRealAudio,qN(e,t)),xV(this.canFreezeFrame,pP(e,t)),xV(this.isScratchText,KN(e,t)),xV(this.subAlignment,rP(this.projectId,e,t)),xV(this.subAlignmentInMediaDomain,nP(this.projectId,e,t)),xV(this.duration,zN(e,this.isScratchText?this.subAlignment:void 0)),xV(this.supportsFillerWords,Vg(t))}updateWithChangedTauRefSpeaker(e,t,n,r){this.hasInvalidAlignment=fP(this.projectId,this.trackType,e,t,n,r),this.needsOverdub=lP(this.trackType,e,t,n,r)||void 0!==e.overdubInfo&&this.hasInvalidAlignment}checkTauRefSpeaker(e,t,n,r){xV(this.hasInvalidAlignment,fP(this.projectId,this.trackType,e,t,n,r)),xV(this.needsOverdub,lP(this.trackType,e,t,n,r))}updateWithChangedTauAndComponents(e,t,n,r,o,i){this.orderedComponents=dk(this.projectId,e.id,t,n,r,o,i)}checkTauComponents(e,t,n,r,o,i){xV(this.orderedComponents,dk(this.projectId,e.id,t,n,r,o,i))}update(e,t,n,r,o,i,a,s,c,d){const{tau:l,ref:u,defaultSpeaker:f,voMetaComps:m,noAudioComps:p,pinComps:g,cueComps:h,cardBoundaryComps:v,scratchSequenceTauInfo:E,showWordlessMedia:y}=this,S=e.text.string!==l?.text.string,I=e!==l,b=t!==u,T=n!==f,w=c?.tau!==E?.tau||c?.defaultSpeaker!==E?.defaultSpeaker;let C=!1;d!==y&&(this.updateWithChangedShowWordlessMedia(d),C=!0),S&&(this.updateWithChangedTauString(e.text.string),C=!0),I&&(this.updateWithChangedTau(e),C=!0);const _=I||b;_&&(this.updateWithChangedTauAndRef(e,t),C=!0);const A=_||T||w;A&&(this.updateWithChangedTauRefSpeaker(e,t,n,c),C=!0);const R=I||r!==m||o!==p||i!==g||a!==h||s!==v;R&&(this.updateWithChangedTauAndComponents(e,r,o,i,a,s),C=!0),C&&Ob(this.tag),this.voMetaComps=r,this.noAudioComps=o,this.pinComps=i,this.cueComps=a,this.cardBoundaryComps=s,this.tau=e,this.ref=t,this.scratchSequenceTauInfo=c,this.defaultSpeaker=n}tauAttributedString(e){const t=e?.tau.id;return this.tasResult.changedSince(kb(kb(this.tag,e?.tag),this.basicAttributedStringTag))&&this.prevTauId===t||(this.tasResult.set(dV(this,e)),this.prevTauId=t),this.tasResult.get()}renderedStringForTextExport(e,t){const{renderedText:n,linkedSubAlignment:r}=this,o=[];if(r)for(let a=0;a<r.ranges.length;a++){const e=r.ranges[a],t=Wg(r.wordArrayView,a).tag;t&&o.push({attribute:(i=t,{name:Gu.TextExportTag,value:i}),range:e})}var i;if(this.tau.isBlocked){const t=Gs.get(0,n.string.length);o.push(...e.map((e=>({range:t,attribute:e}))))}for(const{highlighterId:a,range:s}of Rw(this.tau))o.push(...t(a).map((e=>({range:s,attribute:e}))));return Mm(n,o)}}function LV({audioSegment:e},t){return e?.mediaRefId?t(e.mediaRefId):void 0}function FV({defaultSpeaker:e},t){return e?t(e.speakerId):void 0}function UV(e){}class BV{constructor(e,t,n,r,o,i,a){this.projectId=e,this.getSpeaker=n,this.getRef=r,this.scratchSequenceTauMap=o,this.showWordlessMedia=i,this.tauMap=new Map,this.getTauData=NV(this.tauMap,"tau data"),this.getTauDataMaybe=function(e){return function(t){return e.get(t)}}(this.tauMap),this.voMetaCompsByTau=new Pb({}),this.noAudioCompsByTau=new Pb({}),this.pinCompsByTau=new Pb({}),this.cueCompsByTau=new Pb({}),this.cardBoundaryCompsByTau=new Pb({}),this.showWordlessMediaValue=new Pb(!1),this.useUpdatedSpeakerBlocks=new Pb(!1),this.needsRenderedTexts=!0,this.tag={CLOCK:1},this.tags={},this.prevTausForComputingChange=[],this.changedTaus=new OV(100),this.tausData=[],this.updateTausTag={CLOCK:1},this.tausAndDataBasic=kV((()=>{const{projectId:e,track:t,getRef:n,getSpeaker:r,tauMap:o,voMetaCompsByTau:i,noAudioCompsByTau:a,pinCompsByTau:s,cueCompsByTau:c,cardBoundaryCompsByTau:d,updateTausTag:l,scratchSequenceTauMap:u,showWordlessMediaValue:f}=this,m=i.changedSince(l),p=c.changedSince(l),g=d.changedSince(l),h=a.changedSince(l),v=s.changedSince(l),E=n.changedSince(l),y=r.changedSince(l),S=u.changedSince(l),I=f.changedSince(l),b=E||y||v||h||p||g||m||S||I;let T=!1;const w=n.get(),C=r.get(),_=u.get(),A=i.get(),R=a.get(),M=s.get(),D=c.get(),O=d.get(),x=f.get();const{taus:k}=t.timeline.superTau;if(RV(k,o,(function(n){const r=LV(n,w),o=FV(n,C),i=n.id,a=r?_.get(r.id)?.info:void 0;return T=!0,new PV(e,t.type,n,r,o,A[i],R[i],M[i],D[i],O[i],a,x)}),(function(e,t,n){const r=e.tau!==t;if(T=T||e.index!==n,!r&&!b)return e;const o=t.id,i=r||E?LV(t,w):e.ref;return e.update(t,i,r||y?FV(t,C):e.defaultSpeaker,m?A[o]:e.voMetaComps,h?R[o]:e.noAudioComps,v?M[o]:e.pinComps,p?D[o]:e.cueComps,g?O[o]:e.cardBoundaryComps,S||E?i?_.get(i.id)?.info:void 0:e.scratchSequenceTauInfo,x),e}),UV),this.tausData.length!==k.length||T){this.tausData=function(e,t){return e.map((e=>{const n=t.get(e.id);if(!n)throw new Error(`tau ${e.id} not present in tauDataMap`);return n}))}(t.timeline.superTau.taus,o);for(let e=0;e<this.tausData.length;e++)this.tausData[e].index=e}this.updateChangedTaus(),Ob(this.updateTausTag),this.needsRenderedTexts&&(!function(e){let t;const n=e.length;for(let r=0;r<n;r++){const n=e[r],{tau:o}=n;o.isScriptClip?(n.renderedText=Cm([IE,"\n"]),t||(t=new Set),t.add(r)):n.renderedText=o.text}if(t)for(const r of t){const t=e[r],n=fV(r,e);if(n&&!Es.contains(n)){let e=t.renderedText||IE;e=t.showWordlessMedia?IE:bE[`\n${e.string}`],t.renderedText=e}}}(this.tausData),this.needsRenderedTexts=!1);const N=function(e){let t=0;for(const n of e)n.timeOffset=t,t+=n.duration;return t}(this.tausData),P=this.tausData.some((e=>e.hasCaptions));return{taus:k,getTauData:this.getTauData,getTauDataMaybe:this.getTauDataMaybe,tausData:this.tausData,duration:N,hasCaptions:P}})),this.tausAndDataLinkedSub=kV((()=>{const e=this.tausAndDataBasic(),{projectId:t,tausData:n}=this;for(const r of n)if(r.needsLinkedSubAlignment){const{tau:e,ref:n}=r;r.linkedSubAlignment=cP(t,e,n);const o=e.ignoreAlignment&&void 0!==n&&void 0!==e.preCorrectionText;r.preCorrectionLinkedSubAlignment=o?iN(t,e,n)?.linkedSubAlignment:void 0;const i=r.wordCounter();r.getTimeOffsetForTextOffset=qP(e,r.renderedText.string,r.linkedSubAlignment,i),r.needsLinkedSubAlignment=!1}return{tausData:n,taus:e.taus,getTauData:this.getTauData,getTauDataMaybe:this.getTauDataMaybe}})),this.tausAndDataForBasicAttributedString=kV((()=>{const e=this.tausAndDataLinkedSub(),{tausData:t}=this;this.basicAttrStrUpdate.apply();let n=0;for(const r of t)r.textOffset=n,n+=r.basicAttributedString.attrString.string.length;return{tausData:t,taus:e.taus,getTauData:this.getTauData,getTauDataMaybe:this.getTauDataMaybe}})),this.tausAndDataForAttributedString=kV((()=>{const e=this.tausAndDataForBasicAttributedString(),{tausData:t}=this;return this.paraSpeakerUpdate.apply(),this.wordGapsAfterParagraphUpdate.apply(),{tausData:t,taus:e.taus,getTauData:this.getTauData}})),this.tausAndComponentData=kV((()=>{const e=this.tausAndDataForAttributedString();return this.componentRenderedTauRangeUpdate.apply(),{tausData:this.tausData,taus:e.taus,getTauData:this.getTauData}})),this.basicAttrStrUpdate=new cV(this),this.paraSpeakerUpdate=new TV(this),this.ensureValidSpeakerUpdate=new aO(this),this.componentRenderedTauRangeUpdate=new CV(this),this.wordGapsAfterParagraphUpdate=new wV(this),this.showWordlessMediaValue.set(i),this.useUpdatedSpeakerBlocks.set(a),this.update(t,i,a)}getAreComponentsOrdered(){return this.areComponentsOrdered}resetTrack(){Ob(this.tag)}resetTaus(){this.tausAndDataBasic.reset=!0,this.tausAndDataLinkedSub.reset=!0,this.tausAndDataForBasicAttributedString.reset=!0,this.tausAndDataForAttributedString.reset=!0,this.tausAndComponentData.reset=!0,Ob(this.tag)}getTag(e){let t=this.tags[e];return t||(t={CLOCK:1},this.tags[e]=t),t}setPrevTausForComputingChange(e){this.prevTausForComputingChange||(this.prevTausForComputingChange=e)}updateChangedTaus(){if(!this.prevTausForComputingChange)return;const e=this.track.timeline.superTau.taus,t=this.prevTausForComputingChange,n=function(e,t,n=BN){return jN(e,0,e.length,t,0,t.length,n)}(t,e);let r;if(this.prevTausForComputingChange=void 0,n.added>0||n.removed>0){let o=n.loc,i=o+n.added;n.removed>0&&(n.added!==n.removed||!DV(t,e,((e,t)=>e.id===t.id),n.loc,n.added))&&(o=Math.max(0,o-1),i=Math.min(e.length,i+1)),r=new Set(e.slice(o,i).map((e=>e.id)))}for(const o of this.tausData){const{updateTausTag:e}=this;Nb(o.tag,e)&&(r||(r=new Set),r.add(o.tau.id))}r&&this.changedTaus.push({clock:xb(this.tag),tauIds:r})}update(e,t,n){const r=this.getRef.changedSince(this.tag),o=this.getSpeaker.changedSince(this.tag),i=this.scratchSequenceTauMap.changedSince(this.tag),{track:a}=this,s=e!==a,c=t!==this.showWordlessMediaValue.get(),d=n!==this.useUpdatedSpeakerBlocks.get();if(!o&&!r&&!s&&!i&&!c&&!d)return;let l=c||r||o||i;e.timeline.superTau.taus!==a?.timeline.superTau.taus&&(this.needsRenderedTexts=!0,l=!0),c&&(this.showWordlessMediaValue.set(t),this.showWordlessMedia=t),d&&this.useUpdatedSpeakerBlocks.set(n);const u=a?.timeline;if(e.timeline!==u){const t=e.timeline;t.LEGACY_voiceoverMetadataTrack!==u?.LEGACY_voiceoverMetadataTrack&&(this.voMetaCompsByTau.set(ok(t.LEGACY_voiceoverMetadataTrack,this.voMetaCompsByTau.get())),l=!0),t.noAudioTrack!==u?.noAudioTrack&&(this.noAudioCompsByTau.set(ok(t.noAudioTrack,this.noAudioCompsByTau.get())),l=!0),t.pins!==u?.pins&&(this.pinCompsByTau.set(ok(t.pins,this.pinCompsByTau.get())),l=!0),t.cues!==u?.cues&&(this.cueCompsByTau.set(ok(t.cues,this.cueCompsByTau.get())),t.cues.components!==u?.cues.components&&(this.cuedTrackMap=function(e){if(0===e.length)return;const t={};let n=!1;for(const r of e){const{sceneId:e}=r;if(void 0===e)continue;n=!0;let o=t[e];o||(o=[],t[e]=o),o.push(r)}return n?t:void 0}(t.cues.components)),l=!0),t.cards&&t.cards!==u?.cards&&(this.cardBoundaryCompsByTau.set(ok(t.cards,this.cardBoundaryCompsByTau.get())),l=!0)}if(l?(this.resetTaus(),a&&this.setPrevTausForComputingChange(a.timeline.superTau.taus)):this.resetTrack(),this.track=e,r||e.timeline!==u){const{getTauData:t}=this.tausAndDataLinkedSub();try{this.areComponentsOrdered=bC.every((n=>$C(e.timeline[n],t)))}catch(f){this.areComponentsOrdered=!1}}}duration(){return this.tausAndDataBasic().duration}hasCaptions(){return this.tausAndDataBasic().hasCaptions}changedIndices(e){this.tausAndDataBasic();let t=1/0,n=-1/0;const r=xb(e);for(let o=this.changedTaus.length-1;o>=0;o--){const e=this.changedTaus.get(o);if(!e)return Gs.get(0,this.track.timeline.superTau.taus.length);const{clock:i,tauIds:a}=e;if(i<=r)break;for(const r of a){const e=this.tauMap.get(r);if(e){const{index:r}=e;r<t&&(t=r),r>n&&(n=r)}}}if(t!==1/0&&n!==-1/0)return Gs.getStartEnd(t,n+1)}}const jV=em("docData");function VV(e){let t=jV.get(e.projectId);return t?(t.update(e),t):(t=new zV(e),jV.set(e.projectId,t),t)}class zV{constructor(e){this.speakerMap=new Map,this.getSpeaker=new Pb(NV(this.speakerMap,"speaker")),this.refMap=new Map,this.getRef=new Pb(NV(this.refMap,"ref")),this.compositionsMap=new Map,this.transcriptsMap=new Map,this.pinTracksMap=new Map,this.sequenceTracksMap=new Map,this.restorableTracksMap=new Map,this.pinTrackIdToCompositionAndPinMap=new Map,this.sequenceTrackIdToRefMap=new Map,this.scratchSequenceIdToScratchSequenceTauMap=new Map,this.taggedScratchSequenceTauMap=new Pb(this.scratchSequenceIdToScratchSequenceTauMap),this.makeTrackData=e=>(this.updatePinTrackMap(e,void 0),this.updateScratchSequenceMap(e,void 0),new BV(this.doc.projectId,e,this.getSpeaker,this.getRef,this.taggedScratchSequenceTauMap,EE(this.doc),Boolean(this.doc.settings.useUpdatedSpeakerBlockLogic))),this.updateTrackData=(e,t)=>{const n=e.track;return this.updatePinTrackMap(t,n),this.updateScratchSequenceMap(t,n),e.update(t,EE(this.doc),Boolean(this.doc.settings.useUpdatedSpeakerBlockLogic)),e},this.removeTrackData=({track:e})=>{this.removeFromPinTrackMap(e),this.removeFromScratchSequenceMap(e)},this.makeRefForDiffMap=e=>{if(Ag(e))for(const t of e.audio.trackSceneIds)this.sequenceTrackIdToRefMap.set(t,e);return e},this.updateRefForDiffMap=(e,t)=>{if(Ag(t)){const n=Mg(t)!==Mg(e);for(const e of t.audio.trackSceneIds)this.sequenceTrackIdToRefMap.set(e,t),n&&this.sequenceTrackIdsToUpdate.add(e)}return t},this.removeNoOp=()=>{},this.makeSpeakerForDiffMap=e=>e,this.updateSpeakerForDiffMap=(e,t)=>t,this.updatePinTrackMap=(e,t)=>{if(e.type===Jh.Composition&&e!==t)for(const n of e.timeline.pins.components)this.pinTrackIdToCompositionAndPinMap.set(n.sceneId,{pin:n,composition:e})},this.removeFromPinTrackMap=e=>{const t=e.type;if(t===Jh.Pin)this.pinTrackIdToCompositionAndPinMap.delete(e.id);else if(t===Jh.Composition)for(const n of e.timeline.pins.components)this.pinTrackIdToCompositionAndPinMap.delete(n.sceneId)},this.sequenceTrackIdsToUpdate=new Set,this.updateScratchSequenceMap=(e,t)=>{if(e.type===Jh.Sequence&&(e!==t||this.sequenceTrackIdsToUpdate.has(e.id))){const t=this.sequenceTrackIdToRefMap.get(e.id);if(!t)return;if(Mg(t)){const n=e.timeline.superTau.taus[0];if(n){if(KN(n,ZP(this.doc,n)))return this.scratchSequenceIdToScratchSequenceTauMap.set(t.id,{trackId:e.id,info:{tau:n,defaultSpeaker:FV(n,this.getSpeaker.get())}}),void this.taggedScratchSequenceTauMap.set(this.scratchSequenceIdToScratchSequenceTauMap)}const r=this.scratchSequenceIdToScratchSequenceTauMap.get(t.id);return void(!r||r.trackId!==e.id&&t.audio.trackSceneIds.some((e=>e===r.trackId))||(this.scratchSequenceIdToScratchSequenceTauMap.delete(t.id),this.taggedScratchSequenceTauMap.set(this.scratchSequenceIdToScratchSequenceTauMap)))}this.scratchSequenceIdToScratchSequenceTauMap.delete(t.id),this.taggedScratchSequenceTauMap.set(this.scratchSequenceIdToScratchSequenceTauMap)}},this.removeFromScratchSequenceMap=e=>{if(e.type===Jh.Sequence){const t=this.sequenceTrackIdToRefMap.get(e.id);if(!t)return;const n=this.scratchSequenceIdToScratchSequenceTauMap.get(t.id);Mg(t)&&n?.trackId!==e.id||(this.scratchSequenceIdToScratchSequenceTauMap.delete(t.id),this.taggedScratchSequenceTauMap.set(this.scratchSequenceIdToScratchSequenceTauMap))}},this.update(e)}update(e){const{doc:t,compositionsMap:n,transcriptsMap:r,pinTracksMap:o,sequenceTracksMap:i,restorableTracksMap:a,refMap:s,speakerMap:c,sequenceTrackIdsToUpdate:d}=this;if(e===t)return;let l=!1;e.voices!==t?.voices&&(RV(e.voices,c,this.makeSpeakerForDiffMap,this.updateSpeakerForDiffMap,this.removeNoOp),this.getSpeaker.didUpdateMutableValue(),l=!0);let u=!1;e.mediaLibrary.mediaRefs!==t?.mediaLibrary.mediaRefs&&(d.clear(),this.sequenceTrackIdToRefMap.clear(),RV(e.mediaLibrary.mediaRefs,s,this.makeRefForDiffMap,this.updateRefForDiffMap,this.removeNoOp),this.getRef.didUpdateMutableValue(),u=!0);const f=Boolean(e.settings.wordlessMediaEllipses)!==Boolean(t?.settings.wordlessMediaEllipses),m=Boolean(e.settings.useUpdatedSpeakerBlockLogic)!==Boolean(t?.settings.useUpdatedSpeakerBlockLogic),p=u||l||f||m,{compositions:g,transcripts:h,pinScenes:v,sequenceScenes:E,restorableScenes:y}=e,{compositions:S,transcripts:I,pinScenes:b,sequenceScenes:T,restorableScenes:w}=this.doc||{};this.doc=e,(p||I!==h)&&RV(e.transcripts,r,this.makeTrackData,this.updateTrackData,this.removeTrackData),void 0===y||!p&&w===y||RV(e.restorableScenes,a,this.makeTrackData,this.updateTrackData,this.removeTrackData);let C=!1;(p||T!==E||d.size>0)&&(RV(e.sequenceScenes,i,this.makeTrackData,this.updateTrackData,this.removeTrackData),C=!0),(p||b!==v||C)&&RV(e.pinScenes,o,this.makeTrackData,this.updateTrackData,this.removeTrackData),(p||S!==g||C)&&RV(e.compositions,n,this.makeTrackData,this.updateTrackData,this.removeTrackData)}getTrackData(e){const{compositionsMap:t,transcriptsMap:n,pinTracksMap:r,sequenceTracksMap:o,restorableTracksMap:i}=this,a=t.get(e)||n.get(e)||r.get(e)||o.get(e)||i.get(e);if(!a)throw new Error("no track for id");return a}getPinAndCompositionForPinTrackId(e){return this.pinTrackIdToCompositionAndPinMap.get(e)}getSequenceRefForSequenceTrackId(e){return this.sequenceTrackIdToRefMap.get(e)}}function GV(e,t){return VV(e).getTrackData(t)}const WV="32.0.0";function*HV(e){for(const t of e.compositions)yield t;for(const t of e.transcripts)yield t;for(const t of e.sequenceScenes)yield t;for(const t of e.pinScenes)yield t}var qV=n(60559);const $V=A.logging.groupLogger("descriptmodel/effectiddedupemigration");function KV(e,t){void 0===e?t.effectWithoutId=!0:t.effectIds.has(e)?t.dupeEffectIds.add(e):t.effectIds.add(e)}function YV(e,t){for(const n of e.effects)KV(n.id,t);for(const n of e.timeline.superTau.effects)KV(n.id,t);for(const n of e.timeline.superTau.taus)if(n.audioSegment?.effects)for(const e of n.audioSegment.effects)KV(e.id,t)}function ZV(e,t){for(const n of e.timeline.cards.components)for(const e of n.layers)for(const n of e.effects)KV(n.id,t);for(const n of e.timeline.superTau.taus)if(n.audioSegment?.effects)for(const e of n.audioSegment.effects)KV(e.id,t)}const JV=new Uint8Array([245,224,178,225,34,120,68,185,191,201,170,119,188,73,96,232]);function QV(e,t,...n){const r=new Uint8Array(JV);for(const a of n)try{const e=(0,qV.Z)(a);for(let t=0;t<r.length;t++)r[t]=r[t]^(e[t]??0)}catch(i){throw $V.error("Could not parse uuid",{error:`${i}`}),i}let o=(0,ks.Z)({random:r});for(let a=0;a<256&&t.has(o);a++)r[r.length-1]+=1,o=(0,ks.Z)({random:r});if(t.has(o))throw new Error("Could not generate new id");return t.add(o),rv(e,o)}function XV(e){return!e.id||e.id.startsWith("com.descript")?function(e){if("undefined"===typeof TextEncoder)throw new Error("TextEncoder unavailable");const t=(new TextEncoder).encode(e),n=new Uint8Array(16);return n.set(t.slice(0,16)),(0,ks.Z)({random:n})}(e.type):e.id}function ez(e,t){return t.has(e.id)||void 0===e.id}function tz(e,t,n){const r=hu(e.effects,(r=>ez(r,n)?QV(r,t,e.id,XV(r)):r));let o=(e=hE(e,"effects",r)).timeline.superTau;const i=hu(o.effects,(r=>ez(r,n)?QV(r,t,e.id,o.id,XV(r)):r));o=hE(e.timeline.superTau,"effects",i);const a=hu(o.taus,(r=>{if(r.audioSegment?.effects&&r.audioSegment.effects.length>0){const o=hu(r.audioSegment.effects,(o=>ez(o,n)?QV(o,t,e.id,r.id,XV(o)):o)),i=hE(r.audioSegment,"effects",o);return hE(r,"audioSegment",i)}return r}));return o=hE(o,"taus",a),lx(e,zx(e.timeline,o))}function nz(e){for(const[t,n]of kO)if(wS(e,n))return t}function rz(e,t){const n=dv({...e,items:[]});for(const r of e.items)if(t(r))n.items.push(r);else if("folder"===r.type){const e=r.items.length,o=rz(r,t);(e===o.items.length||o.items.length>0)&&n.items.push(o)}return n}function oz({type:e,folder:t,name:n,preserveIds:r,defaultFolders:o,id:i}){const a="composition"===e?cG:dG,s=dv({name:n||(t.name===uv?a:t.name),id:i||(r||o.includes(t.id)&&"media_reference"===e?t.id:t.name===uv?a:Us(t.id,e)),items:[]});for(const c of t.items)if(c.type===e)s.items.push(c);else if("folder"===c.type){const t=c.items.length,n=oz({type:e,folder:c,preserveIds:r,defaultFolders:o});(t===n.items.length||n.items.length>0)&&("project-files"===c.id&&"media_reference"===e?n.items.forEach((e=>s.items.push(e))):s.items.push(n))}return s}function iz(e){const t=HR(e.attributes,!1);return t!==e.attributes?bm(e.string,t):e}function az(e){return hu(e,(e=>{const t=e.timeline.superTau.taus,n=hu(t,(e=>hE(e,"text",iz(e.text))));t!==n&&(e=lx(e,zx(e.timeline,xx(e.timeline.superTau,n))));const r=e.timeline.noAudioTrack.components,o=hu(r,(e=>Zm(e)?hE(e,"attrText",iz(e.attrText)):e));return r!==o&&(e=lx(e,{...e.timeline,noAudioTrack:{...e.timeline.noAudioTrack,components:o}})),e}))}const sz=A.logging.groupLogger("descriptmodel/cardsequencelayermigration");function cz(e){return"attributes"in e&&void 0!==e.attributes}const dz={hasFailedAlignment:Ih.FailedAlignment,isPlaceholder:Ih.Placeholder,isFiller:Ih.Filler,isError:Ih.Error};function lz(e){return e.map((e=>{if(cz(e)){let t=Ih.None;for(const[n,r]of Se(e.attributes))r&&(t|=dz[n]);return function(e,t){return t!==e.attrs?{...e,attrs:t}:e}(e=function(e){const t={...e};return delete t.attributes,t}(e),t)}return e}))}const uz=[GS,JS,YS,...iI];function fz(e,t){for(const{start:{id:n}}of Qb(e,t)){const r=tT(e,t,n);r.layers.filter((({sourceSceneId:e})=>void 0===e)).forEach((o=>{const i=XM({id:Us("PlaceholderLayerMigration","gapTau",o.id),duration:1e100}),a=_y({id:Us("PlaceholderLayerMigration","pinScene",o.id),name:"Placeholder",timeline:Bx({id:Us("PlaceholderLayerMigration","timeline",o.id),superTau:Sx({id:Us("PlaceholderLayerMigration","superTau",o.id),taus:[i]}),noAudioTrack:lD({id:Us("PlaceholderLayerMigration","noAudioTrack",o.id)}),LEGACY_voiceoverMetadataTrack:yD({id:Us("PlaceholderLayerMigration","LEGACY_voiceoverMetadataTrack",o.id)}),pins:UC({id:Us("PlaceholderLayerMigration","pins",o.id)}),cues:oD({id:Us("PlaceholderLayerMigration","cues",o.id)}),cards:xC({id:Us("PlaceholderLayerMigration","cards",o.id)})})});e=rx(e,a);const s=xB({id:Us("PlaceholderLayerMigration","pinComponent",o.id),sceneId:a.id,offsetFromBaseTime:r.start.offsetFromBaseTime,offsetFromAnchor:r.start.offsetFromAnchor}),c=HD(e,t,r.start.tauAnchor,s);e=c.doc;const d=Us("PlaceholderLayerMigration","newCardLayer",o.id),l=tT(e,t,n),u=hu(l.layers,(e=>e.sourceSceneId===a.id&&void 0===e.sequenceSceneId?rv(e,d):e)),f=kw(e=Yw(e,t,l.id,u),t,d);if(f){const n=lC(e=nC(e,t,f.id,o.effects.map(((e,t)=>rv(e,Us("PlaceholderLayerMigration","newEffect",e.id,t.toString()))))),t,o.id);if(n.length>0)for(const r of n)e=yR(e,t,r.id,{...r,anchor:{...r.anchor,layerId:f.id}})}}))}return e}function mz(e,t){const n=vk(e,t),{timeline:r}=n,o=hu(r.cards.components,(e=>{const t=vu(e.layers,(e=>void 0!==e.sourceSceneId));return t!==e.layers?{...e,layers:t}:e}));return o!==r.cards.components&&(e=ix(e,lx(n,(0,T.ZP)(r,(e=>{e.cards.components=o}))))),e}const pz="Roboto";const gz=new Set(["EB Garamond","Josefin Sans","Lora","Manrope","Podkova","Roboto","Roboto Condensed","Roboto Mono","Roboto Slab","Sora"]);const hz=new Set(["EB Garamond","Josefin Sans","Lora","Manrope","Podkova","Roboto Sans","Roboto Condensed","Roboto Mono","Roboto Slab","Sora"]);const vz={documentVersion:"31.0.0",migrate:function(e){const t=["speechEnhanceTaskId","speechEnhanceRequested"],n=hu(e.mediaLibrary.mediaRefs,(e=>{if(!Cg(e))return e;const n=t.reduce(((e,t)=>function(e,t){if(!(t in e))return e;const n={...e};return delete n[t],n}(e,t)),e.audio);return hE(e,"audio",n)})),r=hE(e.mediaLibrary,"mediaRefs",n);return hE(e,"mediaLibrary",r)}},Ez={documentVersion:"40.0.0",migrate:function(e){if((0,Me.fastDeepEqualJson)(e.highlighters,xO))return e;const t=e.highlighters;e={...e,highlighters:xO};const n=new Set(xO.map((({id:e})=>e))),r=new Map;for(const o of t)n.has(o.id)||r.set(o.id,nz(o.color));return r.size>0&&(e=(0,T.Uy)(e,(e=>{for(const t of[e.compositions,e.transcripts,e.sequenceScenes,e.pinScenes])for(const e of t)for(const t of e.timeline.superTau.taus)for(const e of t.text.attributes)e.attribute.name!==Gu.Highlight||n.has(e.attribute.value)||(e.attribute.value=r.get(e.attribute.value)??xO[0].id)}))),e}},yz={documentVersion:"60.0.0",migrate:function(e){if(!e.isStoryboard)return e;const t=Object.values(e.settings.defaultFolders||{}),n=oz({type:"composition",folder:e.rootCompositionFolder||e.rootFolder,preserveIds:Boolean(e.rootCompositionFolder),id:Us("composition"),defaultFolders:t});let r=oz({type:"media_reference",folder:e.rootCompositionFolder||e.rootFolder,id:Us("project-files"),defaultFolders:t});const{rootMediaFileFolder:o}=e;if(o){const e=r.items.filter((e=>{if("folder"===e.type){const t=rz(e,(e=>!Lv(o,e.id,!0)));return t.items.length>0}return!Lv(o,e.id,!0)}));r=dv({...r,id:o.id,items:[...e,...o.items]})}const i=dv({id:e.rootFolder.id,name:uv,items:[]});return(0,T.ZP)(e,(e=>{e.rootFolder=i,e.rootCompositionFolder=n,e.rootMediaFileFolder=r,e.settings.defaultFolders||(e.settings.defaultFolders={}),e.settings.defaultFolders.projectFiles=r.id}))}},Sz={documentVersion:"51.0.0",migrate:function(e){try{if(!e.isStoryboard)return e;for(const t of HV(e)){if(t.type!==Jh.Composition)continue;const{videoMetadata:n,timeline:r}=t;if(!n)continue;const o=hu(r.cards.components,(r=>{const{layers:o}=r;if(o.find((e=>e.sourceSceneId===t.id&&"all"===e.sequenceSceneId)))return r;const i=tT(e,t.id,r.id),a=sT(e,t.id,i);return Zg(kP(e,t.id,a)).some((t=>{const n=ZP(e,t);return n&&Rg(n)&&void 0===t.audioSegment?.multicamSceneId}))?{...r,layers:[...o,Ww({id:Us(t.id,r.id,"applyCardSequenceLayerMigration","allSequenceLayer"),sourceSceneId:t.id,sequenceSceneId:"all",effects:[{...qw(n),id:Us(t.id,r.id,"applyCardSequenceLayerMigration","boxEffect")}]})]}:r}));o!==r.cards.components&&(e=ix(e,lx(t,(0,T.ZP)(r,(e=>{e.cards.components=o})))))}}catch(E0){sz.error(">>> Failed card layer migration",{error:`${E0}`})}return sz.info(">>> Finished card layer migration"),e}},Iz={documentVersion:"58.1.0",migrate:function(e){if(!e.isStoryboard)return e;for(const n of HV(e)){if(n.type!==Jh.Composition)continue;const{getTauData:r}=GV(e,n.id).tausAndDataBasic();try{QC(e,n.id,n.timeline,"cards")}catch(t){if(t instanceof Ta){const t=hu(n.timeline.cards.components,(t=>PD(e,n.id,t,SU(e,n.id,t))));t!==n.timeline.cards.components&&(e=ix(e,lx(n,(0,T.ZP)(n.timeline,(e=>{e.cards.components=t})))))}}const o=Qb(e,n.id).slice(1).map((({start:t})=>({cardBoundaryId:t.id,timeOffset:SU(e,n.id,t)}))),i=e;for(const{cardBoundaryId:a,timeOffset:s}of o){const o=UP(e,n.id,s);if(o&&r(o.id).timeOffset!==s)try{e=hM(e=XR({doc:e,trackId:n.id,timeOffset:s,suppressAutoMerge:!1,shouldRefreshTimelineTaus:!1,newTauId:Us("SplitClipAtCardBoundaryMigration",n.id,s.toString())})?.doc??e,n.id,a,s)}catch(t){return i}}}return e}},bz={documentVersion:"62.0.0",migrate:function(e){if(!e.isStoryboard)return e;for(const t of HV(e)){if(t.type!==Jh.Composition)continue;const{timeline:n}=t,r=hu(n.cards.components,(n=>{const{layers:r}=n,o=hu(r,(n=>{if(void 0!==n.isHidden)return n;let r=!1;return n.effects.filter((e=>e.type===Gy.type&&e.keyframes.some((({value:e})=>0===e)))).length>0&&!lC(e,t.id,n.id).some((e=>fC(e).hasOpacity))&&(r=!0),{...n,isHidden:r}}));return o===r?n:{...n,layers:o}}));r!==n.cards.components&&(e=ix(e,lx(t,(0,T.ZP)(n,(e=>{e.cards.components=r})))))}return e}},Tz={documentVersion:"65.0.0",migrate:function(e){if(!e.isStoryboard)return e;for(const t of HV(e)){if(t.type!==Jh.Composition||!t.storyboardCues)continue;const n=hu(t.storyboardCues,(n=>{const r=SR(e,t.id,n);return r.layerId!==n.anchor.layerId?{...n,anchor:r}:n}));n!==t.storyboardCues&&(e=ix(e,{...t,storyboardCues:n}))}return e}},wz={documentVersion:"70.0.0",migrate:function(e){if(void 0!==e.restorableScenes)return e;const{restorableContentScenes:t,...n}=e;return{...n,restorableScenes:t.map((e=>({...e,type:Jh.Restorable})))}}},Cz={documentVersion:"78.2.0",migrate:function(e){if(!e.compositions||!e.isStoryboard)return e;for(const t of Ek(e)){if(t.type!==Jh.Composition||!t.storyboardCues)continue;const n=Eu(t.storyboardCues,(n=>{if(kw(e,t.id,n.anchor.layerId))return n}));n!==t.storyboardCues&&(e=ix(e,{...t,storyboardCues:n}))}return e}},_z={documentVersion:"81.0.0",migrate:function(e){if(!e.isStoryboard)return e;for(const t of Ek(e)){if(t.type!==Jh.Composition||!t.storyboardCues)continue;const n=hu(t.storyboardCues,(e=>{if(e.keyframes.length>0){const t=hu(e.keyframes,(e=>e.curve?e:{...e,curve:wE.Linear}));if(t!==e.keyframes)return{...e,keyframes:t}}return e}));n!==t.storyboardCues&&(e=ix(e,{...t,storyboardCues:n}))}return e}},Az=[{documentVersion:"28.1.1",migrate:function(e){for(const t of HV(e)){void 0===t.timeline.cards&&(e=CD(e,t.id,xC({id:Us("AddCardsTrackMigration",t.id)}),!1,!1,!1));for(const n of t.timeline.pins.components)"endOfComposition"===n.endAnchor&&(e=RD(e,t.id,LD(n,{type:"endOfComposition"})))}return e}},vz,{documentVersion:WV,migrate:function(e){const t=new Set,n=new Set,r={effectWithoutId:!1,effectIds:t,dupeEffectIds:n};for(const i of[e.compositions,e.transcripts,e.pinScenes,e.sequenceScenes])for(const e of i)YV(e,r);if(0===n.size&&!r.effectWithoutId)return e;const o=t.size;return e=hE(e,"compositions",hu(e.compositions,(e=>tz(e,t,n)))),e=hE(e,"transcripts",hu(e.transcripts,(e=>tz(e,t,n)))),e=hE(e,"pinScenes",hu(e.pinScenes,(e=>tz(e,t,n)))),e=hE(e,"sequenceScenes",hu(e.sequenceScenes,(e=>tz(e,t,n)))),t.size>o&&$V.debug(`Updated ${t.size-o} effect ids`),e}},{documentVersion:"38.0.0",migrate:function(e){const t=new Set,n=new Set,r={effectWithoutId:!1,effectIds:t,dupeEffectIds:n};for(const i of[e.compositions,e.transcripts,e.pinScenes,e.sequenceScenes])for(const e of i)ZV(e,r);if(0===n.size&&!r.effectWithoutId)return e;const o=t.size;return e=hE(e,"compositions",hu(e.compositions,(e=>function(e,t,n){const r=hu(e.timeline.cards.components,(r=>{const o=hu(r.layers,(o=>{const i=hu(o.effects,(i=>ez(i,n)?QV(i,t,e.id,r.id,o.id,XV(i)):i));return hE(o,"effects",i)}));return hE(r,"layers",o)})),o=hE(e.timeline.cards,"components",r),i=hE(e.timeline,"cards",o);return lx(e,i)}(e,t,n)))),t.size>o&&$V.debug(`Updated ${t.size-o} card layer effect ids`),e}},Ez,yz,{documentVersion:"45.0.0",migrate:function(e){return e=hE(e,"compositions",az(e.compositions)),e=hE(e,"transcripts",az(e.transcripts)),e=hE(e,"pinScenes",az(e.pinScenes)),e=hE(e,"sequenceScenes",az(e.sequenceScenes))}},{documentVersion:"49.0.0",migrate:function(e){const t=e.mediaLibrary.mediaRefs.filter((e=>"descriptRecordingInProgress"===e.source));if(0===t.length)return e;const n=new Set(t.map((e=>e.id)));for(const o of[e.compositions,e.transcripts,e.sequenceScenes,e.pinScenes])for(const e of o)for(const t of e.timeline.superTau.taus)void 0!==t.recordingSession&&void 0!==t.audioSegment?.mediaRefId&&n.has(t.audioSegment.mediaRefId)&&n.delete(t.audioSegment.mediaRefId);if(0===n.size)return e;const r=e.mediaLibrary.mediaRefs.map((e=>n.has(e.id)?m_(e,"descriptRecording"):e));return{...e,mediaLibrary:{...e.mediaLibrary,mediaRefs:r}}}},Sz,{documentVersion:"53.0.0",migrate:function(e){if(!e.isStoryboard)return e;for(const t of HV(e))t.type===Jh.Composition&&(e=mx(e,t.id,void 0!==t.videoMetadata||Dk(e,t.id)&&void 0!==e.compositions[0]?.videoMetadata));return e}},{documentVersion:"53.0.0",migrate:function(e){const t=Eu(e.mediaLibrary.mediaRefs,(e=>{if(!e.voiceover?.metadata)return e;const t=e.voiceover.metadata.alignment;let n=t;t?.some(cz)&&(n=lz(t));const r=e.voiceover.metadata.recognition;let o=r;return r?.some(cz)&&(o=lz(r)),n===t&&o===r?e:{...e,voiceover:{...e.voiceover,metadata:{...e.voiceover.metadata,alignment:n,recognition:o}}}})),n=hE(e.mediaLibrary,"mediaRefs",t);return hE(e,"mediaLibrary",n)}},{documentVersion:"56.0.0",migrate:function(e){return hE(e,"sequenceScenes",hu(e.sequenceScenes,(e=>{return t=e,n=e.includeTranscript??!0,hE(t,"includeTranscript",n);var t,n})))}},{documentVersion:"58.0.0",migrate:function(e){if(!e.isStoryboard)return e;for(const t of HV(e)){if(t.type!==Jh.Composition)continue;const{timeline:n}=t,r=hu(n.cards.components,(n=>{const{layers:r}=n,o=hu(r,(r=>{if(void 0===r.sourceSceneId||r.sourceSceneId===t.id)return r;const o=_P(e,r.sourceSceneId);if(!o?.visual)return r;const i=o.audioSegment?.effects.filter((e=>uz.some((t=>t.type===e.type)))).filter((e=>!r.effects.some((t=>t.type===e.type)))).map((e=>rv(e,Us("CardLayerVectorEffectsMigration",n.id,e.id))));return void 0===i||0===i.length?r:{...r,effects:[...r.effects,...i]}}));return o===r?n:{...n,layers:o}}));r!==n.cards.components&&(e=ix(e,lx(t,(0,T.ZP)(n,(e=>{e.cards.components=r})))))}return e}},Iz,{documentVersion:"59.0.0",migrate:function(e){if(!e.isStoryboard)return e;for(const{id:t,type:n}of HV(e))n===Jh.Composition&&(e=mz(e=fz(e,t),t));return e}},bz,Tz,{documentVersion:"65.0.1",migrate:function(e){for(const t of e.compositions)e=JC(e=XC(e,t.id),t.id);return e}},{documentVersion:"68.0.0",migrate:function(e){return void 0!==e.restorableContentScenes||void 0!==e.restorableScenes?e:{...e,restorableScenes:[]}}},wz,{documentVersion:"73.0.0",migrate:function(e){return e.isStoryboard&&e.compositions?e=hE(e,"compositions",Eu(e.compositions,(e=>{let t=e.timeline,n=t.cards;const r=Eu(n.components,(e=>(hE(e,"effects",Eu(e.effects,(e=>{if(!e.keyframes.some((e=>!dU(e.value))))return e}))),e.layers?hE(e,"layers",Eu(e.layers,(e=>hE(e,"effects",Eu(e.effects,(e=>{if(!e.keyframes.some((e=>!dU(e.value))))return e})))))):e)));return n=hE(n,"components",r),t=hE(t,"cards",n),e=hE(e,"timeline",t)}))):e}},{documentVersion:"78.2.0",migrate:function(e){if(!e.compositions)return e;for(const t of Ek(e)){if(t.type!==Jh.Composition&&t.type!==Jh.Pin)continue;const n=t.timeline.superTau.taus,r=hu(n,(e=>bN(e)&&e.visual.fontFamily&&!gz.has(e.visual.fontFamily)&&!e.audioSegment?.mediaRefId?WM(e,{...e.visual,fontFamily:pz,fontWeight:500}):e));r!==n&&(e=Cx(e,t.id,{...t.timeline.superTau,taus:r}))}return e}},Cz,{documentVersion:"79.0.0",migrate:function(e){for(const[t,n]of function*(e){for(const t of Ek(e))for(const n of bP(e,t.id))yield[n,t]}(e))"missingConsent"===t.overdubInfo?.state&&(e=UM(e,n.id,t.id,RM(t)));return e}},_z,{documentVersion:"81.0.1",migrate:function(e){for(const t of Ek(e)){if(t.type!==Jh.Pin)continue;const n=hu(t.timeline.superTau.taus,(t=>{if(!bN(t)||(n=t.visual.fontFamily,hz.has(n))||void 0!==t.audioSegment.mediaRefId)return t;var n;const r=NG(e).get(t.visual.fontFamily);return r?VM(t,MF(t.audioSegment,r)):WM(t,{...t.visual,fontFamily:pz})}));n!==t.timeline.superTau.taus&&(e=Cx(e,t.id,xx(Lx(e,t.id),n)))}return e}},{documentVersion:"82.0.0",migrate:function(e){const t=new Set;let n;for(const r of e.highlighters)n||(n=Af(r.id)),t.add(r.id);return hE(e,"compositions",Eu(e.compositions,(e=>hE(e,"timeline",hE(e.timeline,"superTau",hE(e.timeline.superTau,"taus",Eu(e.timeline.superTau.taus,(e=>{const r=hE(e.text,"attributes",Eu(e.text.attributes,(e=>e.attribute.name!==Gu.Highlight||t.has(e.attribute.value)?e:void 0!==n?hE(e,"attribute",n):void 0)));return hE(e,"text",r)}))))))))}},{documentVersion:"82.1.0",migrate:function(e){const t=new Set(e.restorableScenes.map((e=>e.id)));return hE(e,"compositions",Eu(e.compositions,(e=>hE(e,"timeline",hE(e.timeline,"superTau",hE(e.timeline.superTau,"taus",Eu(e.timeline.superTau.taus,(e=>void 0===e.replacedContentSceneId||t.has(e.replacedContentSceneId)?e:{...e,replacedContentSceneId:void 0}))))))))}}];function Rz(e,t){const n=function(e){const t=new Map;for(const[n,r]of e)r.components.length>0&&t.set(n,fu(r.components,(({tau:e,tauTextOffset:t,annotationId:n})=>{if(void 0!==n&&void 0!==e&&void 0!==t)return{annotationId:n,tauId:e,range:tc(t)}})));return t}(t);for(const[r,o]of n.entries()){const t=new Map;for(const e of o){let n=t.get(e.tauId);n||(n=[],t.set(e.tauId,n)),n.push(e)}const n=hk(e,r);if(!n)continue;const i=n.timeline.superTau,{taus:a}=i,s=hu(a,(e=>{const n=t.get(e.id);if(!n)return e;const r=Gs.get(0,e.text.string.length),o=fu(n,(({range:e,annotationId:t})=>{const n=Zs(r,e);if(n)return{attribute:Tf(t),range:n}}));if(0===o.length)return e;return jM(e,Mm(e.text,o))}));s!==a&&(e=Cx(e,r,xx(i,s)))}return e}function Mz(e){if(Dv(e))return mv(e);const t=e.items.map(Mz);return dv({name:e.name,items:t})}const Dz=new Set;function Oz(e,t){return Eu(e,(e=>{for(const n of t)e=n.migrate(e)||e;return e}))}function xz(e,t){return Eu(e,(e=>{if(e.effects.length>0){e=hE(e,"effects",Oz(e.effects,t))}let n=e.timeline.superTau;if(n.effects.length>0){n=hE(n,"effects",Oz(n.effects,t))}const r=Eu(n.taus,(e=>{if(!e.audioSegment?.effects)return e;const n=Oz(e.audioSegment.effects,t),r=hE(e.audioSegment,"effects",n);return e=hE(e,"audioSegment",r)}));r!==n.taus&&(n=xx(n,r));let o=zx(e.timeline,n),i=e.timeline.cards;const a=Eu(i.components,(e=>{if(!e.effects)return{...e,effects:[]};if(0===e.effects.length)return e;return hE(e,"effects",Oz(e.effects,t))}));return i=hE(i,"components",a),o=hE(o,"cards",i),e=hE(e,"timeline",o)}))}function kz(e,t){const n=void 0!==t?function(e){return Array.from(Ja(Dz,(t=>Au()(e,t.docVersion))))}(t):Array.from(Dz);if(0===n.length)return e;const{compositions:r,transcripts:o,sequenceScenes:i,pinScenes:a}=e,s=xz(r,n),c=xz(o,n),d=xz(a,n),l=xz(i,n);return e=hE(e,"compositions",s),e=hE(e,"transcripts",c),e=hE(e,"pinScenes",d),e=hE(e,"sequenceScenes",l)}function Nz(e,t,n){const{tausData:r,taus:o}=GV(e,t.id).tausAndDataBasic(),i=hu(o,((o,i)=>{const a=r[i],s=a.ref;if(!(o.audioSegment&&s&&Rg(s)))return o;const c=function(e,t=30){return e.video?e.video:e.image?{width:e.image.width,height:e.image.height,framerateNumerator:t,framerateDenominator:1}:void 0}(s);if(!c)return o;const d=M(c.width,c.height,n.width,n.height)*M(n.width,n.height,c.width,c.height);if(1===d)return o;if(a.cueComps)for(let n of a.cueComps)if(iw(n)){for(const e of n.keyframes){const{scale:t}=e.props;if(!t)continue;const r={x:t.x*d,y:t.y*d};n=dw(n,e.id,{...e.props,scale:r})}e=RD(e,t.id,n)}const l=eU(o.audioSegment,WE)??LE(WE,WE.defaultValue),u=l.keyframes.map((({value:e,offset:t})=>({offset:t,value:{x:e.x*d,y:e.y*d}}))),f=WE(u,l.id,l.isDisabled);return VM(o,ZF(o.audioSegment,f))}));return i!==o&&(e=Cx(e,t.id,{...t.timeline.superTau,taus:i})),e}function Pz(e,t,n){const r=bP(e,t.id),o=hu(r,(r=>{if(!function(e,t){return ON(t,ZP(e,t))}(e,r)||!t.videoMetadata||!r.audioSegment)return r;const o=eU(r.audioSegment,zE);if(!o)return r;const i=M(t.videoMetadata.width,t.videoMetadata.height,n.width,n.height);if(1===i)return r;const a=t.videoMetadata.width*i,s=t.videoMetadata.height*i,c=o.keyframes.map((({value:e,offset:t})=>({offset:t,value:{x:.5+(e.x-.5)/n.width*a,y:.5+(e.y-.5)/n.height*s}}))),d=zE(c,o.id,o.isDisabled);return VM(r,ZF(r.audioSegment,d))}));return o!==r&&(e=Cx(e,t.id,{...t.timeline.superTau,taus:o})),e}function Lz(e,t,n,r){let o=VN(`inlineNote:${e}:${r}`),i=VN(`${t}:${n}`);const a=new Array(16).fill(0);for(let s=0;s<8;s++)a[s]=255&o,o>>=8;for(let s=0;s<8;s++)a[s+8]=255&i,i>>=8;return`migrated:${(0,ks.Z)({random:a})}`}function Fz(e,t){const n=jk(e,t),r=[];if(n.audio.LEGACY_perChannelRefs)for(const o of n.audio.LEGACY_perChannelRefs){const t=Fz(e,o);e=t.doc,r.push(...t.trackIds)}else{const o=Ay({name:n.displayName}),i=o.id;e=rx(e,o);const a=JM({audioSegment:hF({mediaRefId:t,offset:0,duration:n.audio.duration,gain:n.audio.defaultGain}),isScriptClip:!0});e=sO(e=qM(e=Cx(e,i,xx(Lx(e,i),[a])),i,a.id),i),r.push(i)}return{doc:e,trackIds:r}}function Uz(e,t){const n=fu(t.map((t=>SA(e,t,void 0))),(e=>void 0!==e?e:void 0));return CA(n,[],void 0,aA).alignmentSource}function Bz(e,t,n,r,o){if(n.length!==r.length)return o;const i=Pp(e,t);if(!i.voiceover||!i.voiceover.metadata.recognition)return o;const a=i.voiceover.metadata.recognition,s=r.map((t=>{const n=Pp(e,t),r=[];return n.voiceover&&(n.voiceover.metadata.alignment&&r.push(n.voiceover.metadata.alignment),n.voiceover.metadata.recognition&&r.push(n.voiceover.metadata.recognition)),r})),c=[];for(const v of s)c.push(new Array(v.length).fill(0));const d=new Array(a.length);let l=0;a.forEach(((e,t)=>{let r=o[l];for(;rp(r)<=e.startTime&&l<o.length-1;)l+=1,r=o[l];const i=r.sceneId,a=n.indexOf(i);d[t]=a>=0?a:0})),a.forEach(((e,t)=>{let n=!1;for(let r=0;r<s.length;r++){for(let o=0;o<s[r].length;o++){for(;c[r][o]<s[r][o].length;){const i=c[r][o],a=s[r][o][i];if(Hh(e,a)){d[t]=r,c[r][o]=i+1,n=!0;break}if(a.endTime>e.startTime)break;c[r][o]=i+1}if(n)break}if(n)break}}));const u=n.map((t=>{const n=_P(e,t);if(!n)throw new Error(`Track has no tau: ${t}`);return n.id}));let f,m,p=0,g=0;const h=[];return a.forEach(((e,t)=>{const r=d[t],o=n[r],i=u[r];if(void 0!==f&&void 0!==m&&o!==f){const t=(g+e.startTime)/2;t>p&&h.push({offset:p,duration:t-p,sceneId:f,tauId:m}),p=t}m=i,f=o,g=e.endTime})),g=Math.max(g,...n.map((t=>_k(e,t)))),void 0!==f&&void 0!==m&&g>p&&h.push({offset:p,duration:g-p,sceneId:f,tauId:m}),h}function jz(e,t,n){const r=Pp(e,t);if(!r.voiceover||!r.voiceover.metadata.alignment)return;if(!r.voiceover.metadata.recognition)return r.voiceover.metadata.alignment;const o=r.voiceover.metadata.alignment,i=r.voiceover.metadata.recognition,a=[];let s=0;for(const d of n){const t=XP(e,d.sceneId,d.tauId);if(t&&t.voiceover.metadata.recognition&&t.voiceover.metadata.alignment){const e=gL(zg(o),d.offset,d.duration),n=gL(zg(i),d.offset,d.duration);if(!lL(e,n,Hh))continue;const r=gL(zg(t.voiceover.metadata.recognition),d.offset,d.duration),c=gL(zg(t.voiceover.metadata.alignment),d.offset,d.duration);lL(n,r,Hh)&&!lL(n,c,Hh)&&(d.offset>s&&a.push(gL(zg(o),s,d.offset-s)),a.push(c),s=rp(d))}}const c=o.length>0?o[o.length-1].endTime:s;return c>s&&a.push(gL(zg(o),s,c-s)),dL(...a)}const Vz=A.logging.groupLogger("descriptmodel/voicecomponentmigration");function zz(e,t){for(let n=e.length-1;n>=0;n--){const r=e[n].tauAndRange;if(r.tauId===t)return r.range.location}return 1/0}function Gz(e,t){const n=Array.from(es(sk(e,t),(e=>{if(ED(e))return e}))).reverse();Vz.info(`%c[CONVERTING] ${n.length} speaker labels in scene ${t}`,{color:"255,165,0"});const r=[];for(const o of n){let{tauAnchor:n}=o;for(;n;){const i=zz(r,n.tauId),a=sN(e,t,n.tauId);if(a){const e=a.searchForTextOffset(n.location),t=e.match||e.next;if(t){let e,s=t.index;for(;s<a.length&&void 0===a.elementAt(s).speaker&&(!e||$s(e)<=i);)e=a.ranges[s],s+=1;if(e&&r.push({tauAndRange:{tauId:n.tauId,range:Gs.getStartEnd(n.location,Math.min($s(e),i))},speaker:Ah(o.voiceId)}),s!==a.length)break}}const s=DP(e,t,n.tauId);if(!s)break;n={tauId:s.id,location:0}}}return NR(e,t,r)}function Wz(e){return Array.from(Qa(Ja(e,(e=>e.timeline.LEGACY_voiceoverMetadataTrack.components.length>0)),(({id:e})=>e)))}var Hz=(e=>(e[e.Encoded=2]="Encoded",e[e.InMemory=3]="InMemory",e))(Hz||{});const qz={automaticallyLevelClips:!0,useRoomtoneOnGapClips:void 0,defaultFolders:void 0,wordlessMediaEllipses:void 0,syncProjectName:!0,useUpdatedSpeakerBlockLogic:!1},$z="82.1.0";function Kz(e){const t=e.string,n=t.length,r=[];if(e.regions instanceof Array)for(const{range:o,attributes:i}of e.regions)if(o){let e=tc(o);if($s(e)>n){const t=e.location,r=n;if(t>=r){Ht(new Error("AttributedString.decode: range starts after string length, skipping"),"decode-legacy-attributed-string");continue}Ht(new Error("AttributedString.decode: range ends after string length, trimming"),"decode-legacy-attributed-string"),e=Gs.getStartEnd(t,r)}Yz(i,(t=>{r.push({attribute:t,range:e})}))}return bm(t,r)}function Yz(e,t){if("object"!==typeof e)return;const{font:n,highlight:r}=e;switch(n){case"<descript-text-font-bold>":t(Yu);break;case"<descript-text-font-italic>":t(Zu);break;case"<descript-text-font-bold-italic>":t(Yu),t(Zu)}r&&t(Af(r))}var Zz=n(67656),Jz=n.n(Zz);function Qz(e){var t;if(Array.isArray(e)&&e.map(Qz),null!==e&&"object"===typeof e)for(const n of Object.keys(e)){const r=n,o=e;e.hasOwnProperty(r)&&("type"===r&&"string"===typeof o[r]?o[r]=(t=o[r]).startsWith("Descript.DS")?t[11].toLowerCase()+t.substring(12):t:Qz(o[r]))}}function Xz(e,t){if(e.type===xu.pause){const{id:n,duration:r}=e;return nD(XM({id:n,duration:r,...Ou(e)}),t)}if(function(e){return e.type===xu.tau}(e))return{...e,text:Kz(e.text)};throw new Error(`Cannot decode tau of type ${e.type}`)}function eG(e,t){const{id:n,type:r,voiceoverTracks:o,noAudioTracks:i,annotationTracks:a,voiceoverMetadataTracks:s,pins:c}=e;if(void 0===o||0===o.length||0===o[0].components.length)throw new Error("No superTau found when decoding legacy timeline");const d=o[0].components[0],l=i&&i[0],u=a&&a[0],f=s&&s[0],{spans:m,...p}=d;return{id:n,type:r,superTau:{...p,taus:m.map((e=>Xz(e,t)))},noAudioTrack:l&&{...l,components:l.components.map((e=>e.type===xu.inlineNoteComponent?{...e,attrText:Kz(e.text)}:e))},annotationTrack:u,voiceoverMetadataTrack:f,pins:c}}function tG(e,t){const n=e.segments;if(!n||0===n.length)throw new Error("Legacy scene has no segments");const r=void 0!==e.uuid?e.uuid.toLowerCase():e.id,o={...e,timeline:eG(n[0].timeline,t),id:r};return delete o.segments,o}function nG(e,t){if(!function(e){const t=e;return void 0!==t.model&&Array.isArray(t.model.scenes)}(e))return e;var n;void 0!==e.documentVersion&&Jz()(e.documentVersion,"1.0.0")&&(qt(`Decoding legacy document: v${e.documentVersion}`,"migrate-encoded-doc"),n=e,e=(0,T.ZP)(n,Qz)),e=function(e){const{model:{pinScenes:t=[],sequenceScenes:n=[],scenes:r,transcriptScenes:o}}=e,i=new Map;for(const a of[t,n,r,o])for(const{id:e,uuid:t}of a)void 0!==t&&t!==e&&i.set(e,t.toLowerCase());return 0===i.size?e:(0,T.ZP)(e,(e=>{for(const t of[e.sceneFolders,e.mediaFolders])t?.forEach((({items:e})=>{for(const t of e){const e=i.get(t.ref);void 0!==e&&(t.ref=e)}}))}))}(e);const{model:{pinScenes:r=[],sequenceScenes:o=[],scenes:i,transcriptScenes:a,voices:s,tutorial:c=!1}}=e;return{...e,pinScenes:r.map((e=>tG(e,t))),sequenceScenes:o.map((e=>tG(e,t))),compositions:i.map((e=>tG(e,t))),transcripts:a.map((e=>tG(e,t))),voices:s.map((e=>function(e){const{backendVoiceId:t,...n}=e;if(void 0!==t)return{...n,backendVoiceId:t};return n}(e))),tutorial:c,model:{}}}class rG{static get ClientId(){return P()(void 0!==rG._clientId,"ModelSettings.ClientId is undefined. Call ModelSettings.configure before using the model"),rG._clientId||"unknown"}static get ClientName(){return P()(void 0!==rG._clientName,"ModelSettings.ClientName is undefined. Call ModelSettings.configure before using the model"),rG._clientName||"unknown"}static get OperatingSystem(){return P()(void 0!==rG._operatingSystem,"ModelSettings.OperatingSystem is undefined. Call ModelSettings.configure before using the model"),rG._operatingSystem||"unknown"}static configure(e){rG._clientId=e.ClientId,rG._clientName=e.ClientName,rG._operatingSystem=e.OperatingSystem}}const oG=(0,Yl.createCachedSelector)([e=>e.projectId,e=>e.compositions,e=>e.transcripts,e=>e.sequenceScenes,e=>e.pinScenes,e=>e.restorableScenes,e=>e.rootFolder,e=>e.rootCompositionFolder,e=>e.rootMediaFileFolder,e=>e.highlighters,e=>e.mediaLibrary,e=>e.voices,e=>e.settings,()=>!1],aG)({...yp("Documents.getReferenceSummary"),keySelector:am});function iG(e,t){const n={},r=Gf(t);if(e.defaultFolders)for(const[o,i]of Object.entries(e.defaultFolders))void 0!==i&&mm(n,i,"folder",r.prop("defaultFolders").prop(o).path);return n}function aG(e,t,n,r,o,i,a,s,c,d,l,u,f,m){const p=Gf(),g=[AC(p.prop("compositions").path,e,t,m),AC(p.prop("transcripts").path,e,n,m),AC(p.prop("pinScenes").path,e,o,m),AC(p.prop("sequenceScenes").path,e,r,m),$v(p.prop("rootFolder").path,e,a),gm(p.prop("highlighters").path,e,d,"highlighter"),gm(p.prop("voices").path,e,u,"voice"),w_(p.prop("mediaLibrary").path,e,l),iG(f,p.prop("settings").path)];return s&&g.push($v(p.prop("rootCompositionFolder").path,e,s)),c&&g.push($v(p.prop("rootMediaFileFolder").path,e,c)),function(e){const t={};for(const n of e)for(const e of Object.values(n)){const{id:n}=e,r=t[n];r?r.push(e):t[n]=[e]}return t}(g)}const sG=A.logging.groupLogger("descriptmodel/documents"),cG="composition-root",dG="media_reference-root",lG={};function uG({mediaLibrary:e=v_({}),highlighters:t=xO,rootFolder:n,rootCompositionFolder:r,rootMediaFileFolder:o,rootSceneFolder:i=lv(),rootMediaFolder:a=lv(),projectId:s,compositions:c=Ip,transcripts:d=Ip,pinScenes:l=Ip,sequenceScenes:u=Ip,restorableScenes:f=Ip,voices:m=Ip,isTutorial:p=!1,settings:g=qz,validity:h=CG,model:v=lG,isStoryboard:E=!1,prototypeConversation:y}){if(E)(!n||n.items.length>0)&&(n=dv({name:uv,items:[]})),r||(r=dv({id:cG,items:[]})),o||(o=dv({id:dG,items:[]})),g={...g,defaultFolders:{...g.defaultFolders,projectFiles:o.id}};else if(!n){const e=function(){const e=fv("projectFiles");return{rootFolder:dv({name:uv,items:[e]}),projectFilesFolderId:e.id}}();n=e.rootFolder,g={...g,defaultFolders:{projectFiles:e.projectFilesFolderId}}}return{documentVersion:$z,mediaLibrary:e,highlighters:t,rootFolder:n,rootCompositionFolder:E?r:void 0,rootMediaFileFolder:E?o:void 0,rootSceneFolder:i,rootMediaFolder:a,projectId:s,compositions:c,transcripts:d,pinScenes:l,sequenceScenes:u,restorableScenes:f,voices:m,isTutorial:p,settings:g,validity:h,model:v,isStoryboard:E,prototypeConversation:y}}function fG(e,t){const{mediaLibrary:n,highlighters:r,rootFolder:o,rootCompositionFolder:i,rootMediaFileFolder:a,rootSceneFolder:s,rootMediaFolder:c,voices:d,pinScenes:l,sequenceScenes:u,transcripts:f,compositions:m,restorableScenes:p,isTutorial:g,settings:h,validity:v,model:E}=e,y=t.encodeReferencables(d),S=AG(e);if(v.isAlignmentValid&&!S.isAlignmentValid)throw new Error("Document has corrupt text/audio alignment data.");const I={type:xu.document,mediaLibrary:S_(n,t),highlighters:t.encodeReferencables(r.map(wO)),voices:y,tutorial:g||void 0,sequenceScenes:t.encodeReferencables(u.map((e=>Dy(e,t)))),pinScenes:t.encodeReferencables(l.map((e=>Dy(e,t)))),transcripts:t.encodeReferencables(f.map((e=>Dy(e,t)))),restorableScenes:t.encodeReferencables(p.map((e=>Dy(e,t)))),compositions:t.encodeReferencables(m.map((e=>Dy(e,t)))),rootFolders:yv(o,t),rootCompositionFolders:i?yv(i,t):void 0,rootMediaFileFolders:a?yv(a,t):void 0,sceneFolders:Iv(s,t),mediaFolders:Iv(c,t),clientId:rG.ClientId,clientName:rG.ClientName,clientOS:rG.OperatingSystem,documentVersion:$z,settings:mG(h,t),validity:S,model:E};return t.validateDeferredReferences(),I}function mG(e,t){if(!e.defaultFolders)return e;const n={};for(const[r,o]of Object.entries(e.defaultFolders))void 0!==o&&(n[r]=t.encodeReference(o,xu.folder));return{...e,defaultFolders:n}}function pG(e,t){return hu(t,(t=>{const n=t.timeline.superTau.bouncedMediaRef?.id,r=void 0!==n?Lp(e,n):void 0;if(r){const{assetKey:e,id:n}=r;return lx(t,zx(t.timeline,_x(t.timeline.superTau,Ix({id:n,assetKey:e}))))}return t}))}function gG(e,t){const{documentVersion:n,mediaLibrary:r,highlighters:o,rootFolders:i,rootCompositionFolders:a,rootMediaFileFolders:s,sceneFolders:c,mediaFolders:d,settings:l,validity:u,pinScenes:f=[],sequenceScenes:m=[],restorableScenes:p=[],compositions:g,transcripts:h,voices:v,tutorial:E=!1,model:y}=nG(e,t);let S;if(void 0!==o){const e=t.decodeReferencables(o).map(TO),n=new Set(e.map((({color:e})=>vS(e))));for(const t of xO)n.has(vS(t.color))||e.push(t);S=e}const I=t.decodeReferencables(v),b=function({mediaRefs:e,id:t},n){return v_({mediaRefs:n.decodeReferencables(e).map((e=>VL(e,n))),id:t})}(r,t),w=m.map((e=>Ny(t.decodeReferencable(e),t))),C=f.map((e=>ky(t.decodeReferencable(e),t))),_=p.map((e=>Py(t.decodeReferencable(e),t))),A=g.map((e=>function(e,t){let n=e.fileMetadata;const r=void 0!==e.fileMetadata?.artworkRefId?t.decodeReferenceId(e.fileMetadata.artworkRefId):void 0;return r!==n?.artworkRefId&&(n={...n,artworkRefId:r}),Cy({...Oy(e,t),storyboardCues:e.storyboardCues?e.storyboardCues.map((e=>Ty(e,t))):void 0,changedSinceLastPublish:e.changedSinceLastPublish,fileMetadata:n,isVideo:e.isVideo})}(t.decodeReferencable(e),t))),R=h.map((e=>xy(t.decodeReferencable(e),t))),M=new Set(A.map((e=>e.id))),D=i?gv(i,M,t):void 0,O=a?gv(a,M,t):void 0,x=s?gv(s,new Set,t):void 0,k=c?vv(c,t):lv(),N=d?vv(d,t):lv();let P=l;if(P?.defaultFolders)if(D){const e={};for(const[n,r]of Object.entries(P.defaultFolders))void 0!==r&&(e[n]=t.decodeReferenceId(r));P={...P,defaultFolders:e}}else P={...P,defaultFolders:void 0};P&&!P.useRoomtoneOnGapClips&&(P={...P,useRoomtoneOnGapClips:void 0}),P&&void 0===P.wordlessMediaEllipses&&(P={...P,wordlessMediaEllipses:void 0});let L=uG({projectId:t.projectId,mediaLibrary:b,highlighters:S,rootFolder:D,rootCompositionFolder:O,rootMediaFileFolder:x,rootSceneFolder:k,rootMediaFolder:N,compositions:A,transcripts:R,pinScenes:C,sequenceScenes:w,restorableScenes:_,voices:I,isTutorial:E,settings:P,validity:u,model:y});L=hE(L,"documentVersion",n||"0.0.0");for(const T of b_(b))L=sx(L,T.id);D||(L=function(e){const t=e.rootFolder.items,n=e.rootSceneFolder.items.map(Mz);n.length>0&&(e={...e,rootFolder:dv({...e.rootFolder,items:[...t,...n]})});const r=e.rootFolder.items.length,o=new Map;for(const i of e.mediaLibrary.mediaRefs){if(i.isBounced)continue;const t=Hv(e,i);e=t.doc;let n=o.get(t.folderId);n||(n=[],o.set(t.folderId,n)),n.push(pv(i.id))}return(0,T.ZP)(e,(t=>{const n=Gv(e,"projectFiles");void 0!==n&&zv(t.rootFolder,n,t.rootFolder.id,r);for(const[e,r]of o){const n=kv(t.rootFolder,e);n&&n.items.push(...r)}}))}(L));const F=new Map;for(const T of Fv(L.rootFolder))F.set(T.id,T);const U=new Map;if(L.rootCompositionFolder)for(const T of Fv(L.rootCompositionFolder))U.set(T.id,T);const B=new Map;if(L.rootMediaFileFolder)for(const T of Fv(L.rootMediaFileFolder))B.set(T.id,T);const j=new Set(Uv(L.rootMediaFolder)),V=new Set(Uv(L.rootSceneFolder));if(L=(0,T.ZP)(L,(e=>{const t=hu(vu(L.transcripts,(t=>function(e,{transcriptVoiceoverRefId:t}){const n=Pp(e,t);if(!n.voiceover)return!0;if(n.isBounced)return!0;if(n.voiceover.humanPoweredTranscriptReceiptId||n.voiceover.transcriptReceiptId||n.voiceover.metadata.alignment||n.voiceover.metadata.recognition||Ag(n)||Boolean(n.audio&&n.audio.LEGACY_perChannelRefs)||kg(n))return!1;return!0}(L,t)?(j.has(t.id)&&Vv(e.rootMediaFolder,t.id,!0),!1):(V.has(t.id)&&Vv(e.rootSceneFolder,t.id,!0),j.has(t.id)||Pv(e.rootMediaFolder,t.id),!0))),(e=>{if(e.timeline.superTau.bouncedMediaRef){return lx(e,zx(e.timeline,_x(e.timeline.superTau,void 0)))}return e}));for(const r of L.compositions)j.has(r.id)&&Vv(e.rootMediaFolder,r.id,!0),V.has(r.id)||Pv(e.rootSceneFolder,r.id),e.rootCompositionFolder?U.get(r.id)||Nv(e.rootCompositionFolder,mv(r.id)):F.get(r.id)||Nv(e.rootFolder,mv(r.id));e.compositions=pG(L,L.compositions),e.sequenceScenes=pG(L,L.sequenceScenes),e.pinScenes=pG(L,L.pinScenes),e.restorableScenes=L.restorableScenes,e.transcripts=t;const n=vu(L.mediaLibrary.mediaRefs,(e=>!e.isBounced));e.mediaLibrary.mediaRefs=n;for(const r of e.mediaLibrary.mediaRefs)e.rootMediaFileFolder?B.get(r.id)||Nv(e.rootMediaFileFolder,pv(r.id)):F.get(r.id)||Nv(e.rootFolder,pv(r.id))})),L=function(e){const t=[...Wz(Ck(e)).reverse(),...Wz(e.pinScenes).reverse(),...Wz(e.sequenceScenes).reverse(),...Wz(Ik(e)).reverse()];for(const n of t)e=CD(e=Gz(e,n),n,yD({}));return e}(L),L=function(e){const t=e;for(const n of e.mediaLibrary.mediaRefs){if(!n.audio||!n.audio.LEGACY_perChannelRefs)continue;const t=[];for(const s of n.audio.LEGACY_perChannelRefs){const n=Fz(e,s);e=n.doc,t.push(...n.trackIds)}const r=Uz(e,t),o=Bz(e,n.id,t,n.audio.LEGACY_perChannelRefs,r),i=jz(e,n.id,o);let a=Pp(e,n.id);if(e=pO(e,(0,T.ZP)(a,(e=>{e.voiceover&&(e.voiceover.metadata.alignmentSource=o,e.voiceover.metadata.alignment=i),e.audio&&(e.audio.trackSceneIds=t)}))),a=Pp(e,n.id),a.voiceover&&a.voiceover.metadata.alignment&&a.voiceover.metadata.alignmentSource)for(const s of a.voiceover.metadata.alignmentSource)e=HA(e,n.id,{newWords:a.voiceover.metadata.alignment,shouldRefreshTimelineTaus:!1,refTimeRange:s});for(const n of t)e=sO(e,n)}if(e!==t)for(const n of t.mediaLibrary.mediaRefs){const t=Lp(e,n.id);t&&n!==t&&t.voiceover?.metadata.alignment&&fL(zg(t.voiceover.metadata.alignment))}return e}(L),(void 0===n||Au()(n,"2.6.1"))&&(L=function(e){const t=new Set;for(const r of yk(e))for(const[n]of tk(e,r)){if(t.has(n.id))throw new Error(`Multiple components have same id before note migration: ${n.id}`);t.add(n.id)}for(const{type:r,id:o}of HV(e)){const i=[],a=[];let s=!1;for(const c of bP(e,o)){if(c.isScriptClip){a.push(c);continue}const d=c.id,l=PP(e,o,d),u=Zh.noteRangesInString(l.string);if(0===u.length){a.push(c);continue}const f=l.string.length;let m=0,p=l;for(const a of u){s=!0;let c="";const l=Gs.get(a.location+m,a.length),u=p.string.slice(l.location,$s(l))===Aw,g=void 0===As.index(p.string,Gs.get(0,l.location)),h=void 0===As.index(p.string,Gs.get($s(l),p.string.length-$s(l)));(u||h&&g)&&(c="-");const v=km(p,l.location,$s(l));p=Cm([km(p,0,l.location),c,km(p,$s(l))]);const E=l.location;if(m=p.string.length-f,r===Jh.Composition){let r=v;r.string.startsWith(Zh.noteStartString)&&(r=km(r,Zh.noteStartString.length)),r.string.endsWith(Zh.noteEndString)&&(r=km(r,0,r.string.length-Zh.noteEndString.length));const a=Lz(e.projectId,o,d,l.location);if(t.has(a))throw new Error(`Multiple components have same id in note migration: ${a}`);t.add(a);const s=$m({sortTiebreaker:0,id:a,attrText:(n=r,Tm(X(n.string),n.attributes,n.originData)),tauAnchor:{tauId:d,location:E}});i.push(s)}}a.push(jM(c,p))}if(s&&(e=Cx(e,o,xx(Lx(e,o),a)),i.length>0)){let t=Wx(e,o).noAudioTrack;t={...t,components:[...t.components,...i]},e=CD(e,o,t)}}var n;return e}(L)),t.validateDeferredDecodedIds(),(void 0===n||Au()(n,"3.4.0"))&&(L=function(e){return e.mediaLibrary.mediaRefs.some(kg)?pN(e,kg).doc:e}(L)),void 0===n||Au()(n,"3.12.2")){const e=ss(Qa([g,h,m,f],(e=>es(e,(e=>e.timeline.annotationTrack?[e.id,e.timeline.annotationTrack]:void 0)))));L=Rz(L,e)}return(void 0===n||Au()(n,"8.0.0"))&&(L=function(e){if(!e.settings.useRoomtoneOnGapClips)return e;for(const t of HV(e)){const n=t.timeline.superTau.taus,r=hu(n,(e=>EN(e)&&e.audioSegment?VM(e,xF(e.audioSegment,!0)):e));r!==n&&(e=Cx(e,t.id,{...t.timeline.superTau,taus:r}))}return e}(L)),(void 0===n||Au()(n,"27.0.0"))&&(L=function(e){for(const t of Ik(e)){const n=t.videoMetadata;if(n){e=Nz(e,t,n);for(const r of t.timeline.pins.components)e=Nz(e,vk(e,r.sceneId),n)}}for(const t of e.mediaLibrary.mediaRefs)if(Rg(t))for(const n of t.audio.trackSceneIds)e=Pz(e,vk(e,n),t.video);return e}(L)),(void 0===u||u.version<CG.version)&&(L=_G(L,AG(L))),L}function hG(e){if(Cu()(e,$z))throw function(e,t){return new Ia(`This project is not compatible with this version of Descript. The project was created with v${e} but you have v${t}.`)}(e,"82.1.2")}function vG(e,{coder:t,allowInMemoryFormat:n=!0,requireVoiceoverMetadata:r=!0}){const{documentVersion:o}=e;if(void 0!==o){if(!Mu()(o))throw new Sa(`This project has an invalid document version: ${o}`);hG(o)}let i;if(function(e){return void 0===e.documentVersion||Au()(e.documentVersion,"28.0.0")||e.format===Hz.Encoded}(e))void 0!==o&&Au()(o,WV)&&t.setDecodingOption(sU,!0),i=gG(e,t);else{if(!n)throw new ba("This project is not compatible with this version of Descript. Please contact the owner of the project. ");t.decodeReferencables(e.voices),i=hE(e,"mediaLibrary",E_(e.mediaLibrary,t,r)),i=hE(i,"projectId",t.projectId)}return i=function(e){if(hG(e.documentVersion),e.documentVersion===$z)return e;try{for(const r of b_(e.mediaLibrary))e=sx(e,r.id);const t=[...EG(e=function(e,t){for(const n of t)Au()(e.documentVersion,n.documentVersion)&&(e=n.migrate(e));return e}(e=kz(e,e.documentVersion),Az))];t.length>0&&(sG.warn(`[DOC] Removing ${t.length} unreferenced sequence tracks`),e=ex(e,e.compositions,e.transcripts,Ap(e.sequenceScenes,t),e.pinScenes,e.restorableScenes),qt("Found and fixed unreferenced sequence tracks","document-decode"));const n=function(e){const t=VV(e),n=es(e.pinScenes,(e=>{if(!t.getPinAndCompositionForPinTrackId(e.id))return e.id})),r=Ap(e.pinScenes,Array.from(n));if(r===e.pinScenes)return e;return ex(e,e.compositions,e.transcripts,e.sequenceScenes,r,e.restorableScenes)}(e);return n!==e&&(sG.warn("[DOC] Removing unreferenced pin tracks"),qt("Found and fixed unreferenced pin tracks","document-decode"),e=n),(void 0===e.validity||e.validity.version<CG.version)&&(e=_G(e,AG(e))),hE(e,"documentVersion",$z)}catch(t){throw Ht(t,"document-migrate",{level:"fatal"}),t}}(i),i}function*EG(e){const t=Fk(e.mediaLibrary.mediaRefs.values());for(const n of e.sequenceScenes)t.has(n.id)||(yield n.id)}const yG=e=>e.mediaLibrary,SG=(yp("getAssetKeysForDoc"),(0,Yl.createCachedSelector)(yG,h_)({...yp("refIdForSequenceTrackIdMap"),keySelector:am})),IG=(0,Yl.createCachedSelector)((e=>e.transcripts),(e=>{const t={};for(const n of e)t[n.transcriptVoiceoverRefId]=n.id;return t}))({...yp("getTranscriptTrackIndexes"),keySelector:am});function bG(e,t){const n=IG(e)[t];if(void 0!==n)return zp(e,n)}function TG(e,t){if(e.mediaLibrary===t)return e;const n=(r=e.mediaLibrary.mediaRefs,o=t.mediaRefs,Ap(e.sequenceScenes,Array.from(function*(e,t){const n=wp(e),r=wp(t);for(const o of Rp(e,t,r)){const e=n(o),t=r(o);if(e&&e.audio&&e.audio.trackSceneIds)if(t&&t.audio&&t.audio.trackSceneIds){if(e.audio.trackSceneIds===t.audio.trackSceneIds)continue;{const n=new Set(t.audio.trackSceneIds);for(const t of e.audio.trackSceneIds)n.has(t)||(yield t)}}else if(e.audio&&e.audio.trackSceneIds)for(const n of e.audio.trackSceneIds)yield n}}(r,o))));var r,o;return n!==(e={...e,mediaLibrary:t}).sequenceScenes&&(e=ex(e,e.compositions,e.transcripts,n,e.pinScenes,e.restorableScenes)),e}function wG(e,t){const n=bP(e,t),r=hu(n,(e=>(e.audioSegment&&(e=VM(e,kF(e.audioSegment,1))),e)));return r===n?e:Cx(e,t,xx(Lx(e,t),r))}const CG={version:3,isAlignmentValid:!0};function _G(e,t){return(0,T.ZP)(e,(e=>{e.validity.version=t.version,e.validity.isAlignmentValid=t.isAlignmentValid}))}function AG(e){return{version:CG.version,isAlignmentValid:RG(e)}}function RG(e){for(const t of Ek(e)){const{tausData:n}=GV(e,t.id).tausAndDataBasic();if(n.some((({hasInvalidAlignment:e})=>e)))return!1}return!0}function MG(e,t,n){return(0,T.ZP)(e,(e=>{e.settings[t]=n}))}function DG(e,t,n){if(!Lg(Pp(e,t)))throw new Error("Cannot set roomtone gain on non-roomtone media");return vO(e,t,"defaultGain",n)}function OG(e,t,n){const r=Pp(e,t);return Ag(r)?(r.audio.trackSceneIds.forEach((t=>{const r=vk(e,t);r.suppressRoomtone||Gk(e.projectId,r).forEach((t=>{const r=Pp(e,t);r.audio&&r.audio.roomtoneRefId&&(e=DG(e,r.audio.roomtoneRefId,n))}))})),e):e}function xG(e,t){for(const n of Ek(e)){const r=Lx(e,n.id).taus,o=hu(n.timeline.superTau.taus,(e=>EN(e)?VM(e,xF(e.audioSegment,t||void 0)):e));o!==r&&(e=Cx(e,n.id,{...n.timeline.superTau,taus:o}))}return e}function kG(e,t){return Cv(t)?Boolean(hk(e,t.id)):!!function(e){return"media_reference"===e.type}(t)&&Boolean(Lp(e,t.id))}const NG=(0,Yl.createCachedSelector)((e=>e.mediaLibrary.mediaRefs),(e=>{const t=new Map;for(const n of e)Fg(n)&&t.set(n.displayName,n.id);return t}))({...yp("getFontSet"),keySelector:am});function PG(e){try{!function(e){const t=[];for(const[o,i]of Object.entries(e)){let e,a=0,s=0;for(const{entities:t,references:n}of i)a+=t.length,s+=n.length,e||(e=t[0]);if(e)if(a>1)t.push(`Multiple ${e.type} objects with the same id: ${o}`);else for(const{references:o}of i)for(const i of o)(n=i.type)===(r=e.type)||("cueTrack"===n?Wf.has(r):"cardLayerTrack"===n&&Hf.has(r))||t.push(`Invalid reference type ${i.type}, expected ${e.type}, location: ${i.location.join(">")}`);else{if(0===s)throw new Error(`Invalid reference summary. No entity or references for ${o}`);{const e=[],n=new Set;for(const{references:t}of i)for(const r of t)e.push(`${r.location.join(">")}`),n.add(r.type);const r=n.size<=1?Array.from(n):`(${Array.from(n).join(" || ")})`;t.push(`Missing ${r} object with id: ${o}, referenced from the following locations:\n`+e.join("\n"))}}}var n,r;if(t.length>0)throw new Sa(t.join("\n"))}(oG(e)),e.isStoryboard&&function(e){for(const t of Ik(e))IT(e,t.id)}(e);for(const n of e.compositions)P()(GV(e,n.id).getAreComponentsOrdered(),"Components are in incorrect order");const t=AG(e);if(e.validity.isAlignmentValid&&!t.isAlignmentValid)throw new Error("Document has corrupt text/audio alignment data.");return t}catch(t){throw new Sa(t.message)}}const LG=["original","proxy","transcribable","font_variant","web","muxed_original_speech_enhanced","muxed_stream_speech_enhanced","speech_enhanced","background_mask","eye_contact"];var FG=(e=>(e.local="local",e.partial="partial",e.failed="failed",e.completed="completed",e.placeholder="placeholder",e))(FG||{});const UG=["preview","original"];const BG=Object.freeze({scrollPosition:void 0,timelineViewportLeft:-10,timelinePixelsPerSecond:110,isShowingWordGapDurationInput:!1,pendingOverdubRange:void 0,textCorrectionInfo:void 0,tagWordInfo:void 0,activeScriptTool:void 0,replaceInfo:void 0,hoveringInfo:void 0,focusedEditBoundaryInfo:void 0,focusedOverdubHoverInfo:void 0,focusedBlockedTextHoverInfo:void 0,scrollToIndex:void 0,scrollToTime:void 0,activeSpeakerLabel:void 0,nextActiveSpeakerLabel:void 0,bounceAudioInProgress:!1,transcriptErrorDetectionInProgress:!1,emptyStateOverridden:!1});function jG(e,t){return{history:t?[t]:[mv(wk(e))],location:0}}function VG(e){const{history:t,location:n}=e;return t[n]}function zG(e,t){const{location:n,history:r}=e,o=VG(e);if(o&&o.id===t.id&&o.type===t.type)return e;let i=[t,...r.slice(n,r.length)];return i.length>500&&(i=i.slice(0,500)),{location:0,history:i}}const{equalFrameCounts:GG}=s;function WG(e,{loc:t,added:n,removed:r},o){if(o&&GG(t,e)||t>e)return e;let i=e;return i-=Math.min(t+r,i)-t,i+n}function HG({loc:e,delta:t},n){if(0===t)return{loc:WG(e,n,!0),delta:0};const r=WG(e,n,t<0);return KG(r,WG(e+t,n,t>0)-r)}function qG({offset:e,duration:t},n){if(GG(t,0))return{offset:WG(e,n,!0),duration:0};const r=WG(e,n,!1);return{offset:r,duration:WG(e+t,n,!0)-r}}const[$G]=Vs("loc","delta");function KG(e,t){return $G(e,t)}function YG(e){return $G(e,0)}const ZG=YG(0);function JG(e){const t=tW(e),n=nW(e);return Gs.get(t,n-t)}function QG(e,t=!1){const n=$G(e.location,e.length);return t?rW(n):n}function XG({delta:e}){return e<0}function eW({delta:e}){return 0===e}function tW(e){const{loc:t,delta:n}=e;return XG(e)?t+n:t}function nW(e){const{loc:t,delta:n}=e;return XG(e)?t:t+n}function rW(e){const t=XG(e),n=t?tW(e):nW(e),r=t?nW(e):tW(e);return $G(n,r-n)}function oW(e,t,n){const r=nW(n);if(e===t||e.string===t.string)return n;let o=0;for(const[i,a,s,c]of(0,Kk.Hg)(e.string,t.string)){if(i>r)break;const e=a-i,t=c-s;if(e>t){const r=e-t;n=HG(n,{loc:i+t+o,removed:r,added:0}),o-=r}else if(e<t){const r=t-e;n=HG(n,{loc:a+o,removed:0,added:r}),o+=r}}return n}const iW=NU.EditMedia,aW=Object.freeze({textOrTimeSelection:ZG,trackedSelections:void 0,hasFocus:!1,isDraggingSelection:!1,textMode:iW,preQuasimodeTextOrTimeSelection:void 0,activePinComponentId:void 0,selectedTausMap:void 0,activeCue:void 0,activeStoryboardCue:void 0,selectedCardState:void 0,zoomToComponent:!1,scratchTextSpeaker:void 0,playheadMovingWithTextCursor:!1});function sW(e){return e.userPreferences.application.installId}function cW(e){return e.userPreferences.patientPlayback}function dW(e){return e.userPreferences.project}function lW(e){return e.userPreferences.application.apiTarget}function uW(e){return e.userPreferences.application.adminPageSelectedDriveId}function fW(e){return e.userPreferences.application.offlineStorageLocationOverride}function mW(e){return e.userPreferences.application.transcriptionLanguage}function pW(e){return e.userPreferences.application.defaultProjectType}function gW(e){return e.userPreferences.application.colorScheme}function hW(e){return e.userPreferences.application.alwaysPromptForTranscription}function vW(e){return dW(e).defaultOriginalAssetQuality}function EW(e){return dW(e).useRoomtoneOnGapClips}function yW(e){return dW(e).defaultAutomaticallyLevelClips}function SW(e){return dW(e).autoGenerateProxy}function IW(e){return dW(e).openLinksInDesktopApp}function bW(e){return e.userPreferences.application.projectFilter}function TW(e,t){return e.document.projects[t]}function wW(e,t){const n=TW(e,t);return n&&n.navHistory}function CW(e,t,n){return TW(e,t).compositions[n]||BG}function _W(e,t,n){return AW(e,t)?.tracks[n]||aW}function AW(e,t){const n=TW(e,t);return n&&n.docAndUndo.current}function RW(e,t){const n=AW(e,t);return n&&n.doc}function MW(e,t){const n=RW(e,t);if(!n)throw new Error("No document loaded");return n}function DW(e,t){const n=wW(e,t);return n&&VG(n)}function OW(e,t){if(RW(e,t)){const n=wW(e,t),r=n&&VG(n);if(r&&"composition"===r.type)return r.id}}vp()(MW,(function(e,t){const n=AW(e,t);if(!n)return;let{activeSequenceRefId:r,doc:o}=n;const i=wW(e,t),a=i&&VG(i);if(a&&"media_reference"===a.type&&(r=a.id),void 0===r)return;const s=Lp(o,r);return s&&Bg(s)&&Ag(s)?r:void 0}),((e,t)=>AW(e,t)?.selectedSequenceTausMap),((e,t,n)=>{if(void 0===t)return;const{audio:{trackSceneIds:r}}=Vk(e,t);if(n){let t=0;const o=(0,T.ZP)(n,(n=>{for(const r of n.keys()){if(!hk(e,r)){n.delete(r);continue}const o=n.get(r);if(!o){n.delete(r);continue}const i=GV(e,r).tausAndDataBasic().getTauDataMaybe;for(const e of o){i(e)||o.delete(e)}o.size>0?t+=o.size:n.delete(r)}}));if(o.size>0){const e=Ya(o.keys()),n=1===o.size&&e?r.indexOf(e):void 0;return{selectedTaus:o,count:t,trackIndex:n}}}}));function xW(e,t,n){return vk(MW(e,t),n)}function kW(e,t,n){const r=RW(e,t);return r?hk(r,n):void 0}function NW(e){return e.document.lastReplacedCharacterAtTime}function PW(e,t,n){return yg(MW(e,t),n)}function LW(){return us(((e=[])=>Qa(e,(({id:e,name:t,type:n})=>({id:e,name:t,type:n})))),Ft.wU)}LW(),LW(),LW(),LW();function FW(e,t,n){if(UW(e,t)){const r=kW(e,t,n);return r?.type===Jh.Composition&&r.isVideo}return function(e,t,n){if(UW(e,t)){const r=kW(e,t,n);return r?.type===Jh.Composition&&r.isVideo&&void 0!==r.videoMetadata}return void 0!==kW(e,t,n)?.videoMetadata}(e,t,n)}vp()([(e,t,n,r)=>{const o=MW(e,t);return function(e){return e.userPreferences.project.showAllTracks}(e)?mk(o,n):function(e,t,n,r){return fu(vk(e,t).timeline.pins.components,(o=>{let i=Kx(e,t,o),a=i+_k(e,o.sceneId);if(r&&(i=sy(i,r),a=sy(a,r)),Sd(n,i)&&vd(n,a))return o}))}(o,n,r)},(e,t,n)=>Xy(MW(e,t),n)],((e,t)=>{const n={[Yy]:Yy};for(const r of e)n[r.id]={componentId:r.id,trackId:r.sceneId};return Array.from(fu(t,(e=>n[e])))})),us(((e,t)=>t?es(t,(t=>{const n=Cp(e,(e=>e.id===t));if(n&&Mk(n))return{id:n.id,name:n.name,type:n.type}})):[]),((e,t)=>(0,Me.fastDeepEqual)(e,t)));function UW(e,t){return RW(e,t)?.isStoryboard??IH(e,t)?.isStoryboardEnabled??!1}Me.fastDeepEqual;n(3385);function BW(e,t,n=(()=>"a")){const r={};return(o,...i)=>{const a=n(o,...i);let s=r[a];const c=Date.now();if(!s||c-s.time>=t||(i.length>0||s.args.length>0)&&!pp()(i,s.args)){const t=e(o,...i);s?(s.time=c,s.value=t,s.args=i):s=r[a]={time:c,value:t,args:i}}return s.value}}const jW=(0,Yl.createCachedSelector)(((e,t)=>t),((e,t)=>e.mediaLibrary.projectAssets[t]),(e=>e.mediaLibrary.assets),((e,t,n)=>{const r={};if(void 0===t)return r;for(const o of t){const t=n[o];void 0===t&&Ma(`Project ${e} has dangling reference to asset ${o}`),r[o]=t}return r}))(((e,t)=>t));const VW=(0,Yl.createCachedSelector)(jW,(e=>e.mediaLibrary.downloadFilesInProgress),((e,t)=>{let n=0;for(const{artifacts:r}of Object.values(e))for(const e of Object.values(r)){const r=t[e.localId];void 0!==r&&r<1&&(n+=e.size*(1-r))}return n<=Number.MIN_VALUE?0:n}))(((e,t)=>t)),zW=(0,Yl.createCachedSelector)(jW,(e=>e.mediaLibrary.downloadFilesInProgress),((e,t)=>{let n=0,r=0;const o=[];for(const{artifacts:i}of Object.values(e))for(const e of Object.values(i)){const i=t[e.localId];n+=e.size,r+=e.size*(i??1),void 0!==i&&i<1&&o.push(e.localId)}return 0===n?{percentage:1,artifacts:o}:{percentage:r/n,artifacts:o}}))(((e,t)=>t));function GW(e,t){return e.mediaLibrary.uploadFilesInProgress[t]}BW((function(e){const t=new Map,n=[...e.mediaLibrary.autolevelInProgress,...e.mediaLibrary.proxyGenerationInProgress,...e.mediaLibrary.micBleedDetectionInProgress,...e.mediaLibrary.studioSoundInProgress];for(const r of n){if(!e.mediaLibrary.assets[r])continue;const{asset:n,artifacts:o}=e.mediaLibrary.assets[r],i=WW(e,n,o,{includeAll:!0});void 0!==i&&t.set(n.localId,i)}return t}),1e3),BW((function(e){const t=new Map,n=Object.keys(e.mediaLibrary.uploadFilesInProgress);for(const r of Object.keys(e.mediaLibrary.assets)){const{asset:o,artifacts:i}=e.mediaLibrary.assets[r],a=H()&&Object.values(i).some((e=>"local"===e.status));if(!Object.keys(i).some((e=>n.includes(e)))&&!a)continue;const s=WW(e,o,i,{includeAll:!0});void 0!==s&&t.set(o.localId,s)}return t}),1e3),BW((function(e){const t=[],n=_H(e),r=n?Object.keys(jW(e,n)):[];for(const o of Object.values(e.project.projects)){const n=o.project;if(!n)continue;const i=zW(e,n.id);"undefined"!==typeof i.percentage&&1!==i.percentage&&i.artifacts.some((e=>!r.includes(e)))&&t.push({projectId:n.id,projectName:n.name,downloadPercentage:i.percentage})}return t}),1e3);function WW(e,t,n,r={}){const o=Al(e),i=Object.values(n).find((e=>"original"===e.type&&!e.isLocalOnly));if(!i)return;if(i.uploadedBy!==o)return;if(!i.isLocallyCreated&&!r.includeAll)return;const a={id:t.localId,fileName:t.defaultDisplayName,statuses:{}};(function(e,t){return e.mediaLibrary.proxyGenerationInProgress.has(t)})(e,t.localId)&&(a.statuses.proxyStatus={state:"compressing",progress:.1,size:i.size},a.statuses.transcriptionStatus={state:"compressing",progress:.1,size:i.size}),e.mediaLibrary.autolevelInProgress.has(t.localId)&&(a.statuses.autolevelStatus={state:"processing",progress:0}),e.mediaLibrary.micBleedDetectionInProgress.has(t.localId)&&(a.statuses.bleedStatus={state:"processing",progress:0}),e.mediaLibrary.studioSoundInProgress.has(t.localId)&&(a.statuses.speechEnhanceStatus={state:"processing",progress:0});for(const s of Object.values(n)){if(s.uploadedBy!==o||s.status===FG.placeholder||s.isLocalOnly)continue;const t=GW(e,s.localId);let n;switch(s.type){case"original":n="originalStatus";break;case"proxy":n="proxyStatus";break;case"transcribable":n="transcriptionStatus";break;case"speech_enhanced":n="speechEnhanceStatus";break;case"background_mask":case"font_variant":case"eye_contact":case"web":case"muxed_original_speech_enhanced":case"muxed_stream_speech_enhanced":continue}if(void 0===a.statuses[n])switch(s.status){case FG.local:a.statuses[n]={state:"upload-queued",progress:0,size:s.size};break;case FG.partial:a.statuses[n]=t?{state:"uploading",progress:t??0,size:s.size}:{state:"upload-queued",progress:0,size:s.size};break;case FG.completed:a.statuses[n]={state:"uploading",progress:1,size:s.size};break;case FG.failed:a.statuses[n]={state:"uploading",progress:1,size:s.size},a.hasFailed=!0;break;default:ov(s.status)}}return!os(Object.values(a.statuses),(e=>Boolean(e&&e.progress<1)))?void 0:a}yp("getDownloadingArtifactGuidsForCard"),vp();function HW(e,t){return e.featureFlags?.flags[t]}const qW=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"globe-1x"}))),$W=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"globe"}))),KW=Nt.forwardRef((function(e,t){return Nt.createElement("div",{ref:t},Nt.createElement("div",{className:"icon-1x flex-center"},Nt.createElement(qW,{...e,type:"icon"})),Nt.createElement("div",{className:"icon-2x flex-center"},Nt.createElement($W,{...e,type:"icon"})))})),YW=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"link"}))),ZW=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"hard-drive"}))),JW=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"user-plus"}))),QW={name:"Public",description:"Searchable on Google",accessPermission:"public",icon:Nt.createElement(KW,null),tooltip:"Searchable on Google"},XW=[QW,{name:"Anyone with the link",description:"Not indexed by search engines",accessPermission:"unlisted",icon:Nt.createElement(YW,null)},{name:"Drive access required",description:"Restricted to members of this drive",accessPermission:"drive",icon:Nt.createElement(ZW,null)},{name:"Project access required",description:"Restricted to people with project access",accessPermission:"private",icon:Nt.createElement(JW,null)}];function eH(e,t,n){return"drive"!==e||e===t||n}function tH(e,t){return e.product.products[t]}const nH=(0,el.createSelector)([e=>e.product.products,Ql],((e,t)=>Object.keys(e).some((n=>t.has(n)&&Yd(e[n])))));const rH=(0,el.createSelector)([ru,tH],((e,t)=>{if(void 0===e||void 0===e.memberships||!t)return 0;const n=e.memberships.reduce(((e,t)=>e+Number(function({type:e}){return function(e){return"editor"===e}(e)}(t))),0);return Math.max(0,t.seats-n)}));(0,el.createStructuredSelector)({automaticReverseTrialsEnabledAfterOnboarding:e=>HW(e,"automatic-reverse-trials-for-new-free-drives"),canStartReverseTrial:function(e){const t=Cl(e);return!!t&&!t.reverseTrialStartedAt},hasOneOwnedDrive:e=>1===tu(e)?.length,hasPaidPlan:nH}),(0,el.createStructuredSelector)({canAddToFreeDrive:e=>HW(e,"allow-reverse-trials-for-existing-free-drives"),products:e=>e.product.products,currentUserOwnedDrives:tu});function oH(e,t){if(!t)return QW;const n=ru(e,t);if(!n)return QW;const r=n.qemPrivacyDefault||("descript_enterprise"===n.currentProduct?"unlisted":"public");return XW.find((e=>e.accessPermission===r))||QW}n(99930);const iH=new Map([[100,{normal:"Thin",italic:"Thin Italic"}],[200,{normal:"Extra Light",italic:"Extra Light Italic"}],[300,{normal:"Light",italic:"Light Italic"}],[400,{normal:"Regular",italic:"Italic"}],[500,{normal:"Medium",italic:"Medium Italic"}],[600,{normal:"Semi Bold",italic:"Semi Bold Italic"}],[700,{normal:"Bold",italic:"Bold Italic"}],[800,{normal:"Extra Bold",italic:"Extra Bold Italic"}],[900,{normal:"Black",italic:"Black Italic"}],[950,{normal:"Extra Black",italic:"Extra Black Italic"}]]);iH.get(400);n(37044).Buffer;const aH=[{name:"EB Garamond",variants:[{weight:400,style:"normal",filename:"EB_Garamond/static/EBGaramond-Regular.ttf"},{weight:400,style:"italic",filename:"EB_Garamond/static/EBGaramond-Italic.ttf"},{weight:500,style:"normal",filename:"EB_Garamond/static/EBGaramond-Medium.ttf"},{weight:500,style:"italic",filename:"EB_Garamond/static/EBGaramond-MediumItalic.ttf"},{weight:600,style:"normal",filename:"EB_Garamond/static/EBGaramond-SemiBold.ttf"},{weight:600,style:"italic",filename:"EB_Garamond/static/EBGaramond-SemiBoldItalic.ttf"},{weight:700,style:"normal",filename:"EB_Garamond/static/EBGaramond-Bold.ttf"},{weight:700,style:"italic",filename:"EB_Garamond/static/EBGaramond-BoldItalic.ttf"},{weight:800,style:"normal",filename:"EB_Garamond/static/EBGaramond-ExtraBold.ttf"},{weight:800,style:"italic",filename:"EB_Garamond/static/EBGaramond-ExtraBoldItalic.ttf"}],type:"builtin"},{name:"Josefin Sans",variants:[{weight:100,style:"normal",filename:"Josefin_Sans/static/JosefinSans-Thin.ttf"},{weight:100,style:"italic",filename:"Josefin_Sans/static/JosefinSans-ThinItalic.ttf"},{weight:200,style:"normal",filename:"Josefin_Sans/static/JosefinSans-ExtraLight.ttf"},{weight:200,style:"italic",filename:"Josefin_Sans/static/JosefinSans-ExtraLightItalic.ttf"},{weight:300,style:"normal",filename:"Josefin_Sans/static/JosefinSans-Light.ttf"},{weight:300,style:"italic",filename:"Josefin_Sans/static/JosefinSans-LightItalic.ttf"},{weight:400,style:"normal",filename:"Josefin_Sans/static/JosefinSans-Regular.ttf"},{weight:400,style:"italic",filename:"Josefin_Sans/static/JosefinSans-Italic.ttf"},{weight:500,style:"normal",filename:"Josefin_Sans/static/JosefinSans-Medium.ttf"},{weight:500,style:"italic",filename:"Josefin_Sans/static/JosefinSans-MediumItalic.ttf"},{weight:600,style:"normal",filename:"Josefin_Sans/static/JosefinSans-SemiBold.ttf"},{weight:600,style:"italic",filename:"Josefin_Sans/static/JosefinSans-SemiBoldItalic.ttf"},{weight:700,style:"normal",filename:"Josefin_Sans/static/JosefinSans-Bold.ttf"},{weight:700,style:"italic",filename:"Josefin_Sans/static/JosefinSans-BoldItalic.ttf"}],type:"builtin"},{name:"Lora",variants:[{weight:400,style:"normal",filename:"Lora/static/Lora-Regular.ttf"},{weight:400,style:"italic",filename:"Lora/static/Lora-Italic.ttf"},{weight:500,style:"normal",filename:"Lora/static/Lora-Medium.ttf"},{weight:500,style:"italic",filename:"Lora/static/Lora-MediumItalic.ttf"},{weight:600,style:"normal",filename:"Lora/static/Lora-SemiBold.ttf"},{weight:600,style:"italic",filename:"Lora/static/Lora-SemiBoldItalic.ttf"},{weight:700,style:"normal",filename:"Lora/static/Lora-Bold.ttf"},{weight:700,style:"italic",filename:"Lora/static/Lora-BoldItalic.ttf"}],type:"builtin"},{name:"Manrope",variants:[{weight:200,style:"normal",filename:"Manrope/static/Manrope-ExtraLight.ttf"},{weight:300,style:"normal",filename:"Manrope/static/Manrope-Light.ttf"},{weight:400,style:"normal",filename:"Manrope/static/Manrope-Regular.ttf"},{weight:500,style:"normal",filename:"Manrope/static/Manrope-Medium.ttf"},{weight:600,style:"normal",filename:"Manrope/static/Manrope-SemiBold.ttf"},{weight:700,style:"normal",filename:"Manrope/static/Manrope-Bold.ttf"},{weight:800,style:"normal",filename:"Manrope/static/Manrope-ExtraBold.ttf"}],type:"builtin"},{name:"Podkova",variants:[{weight:400,style:"normal",filename:"Podkova/static/Podkova-Regular.ttf"},{weight:500,style:"normal",filename:"Podkova/static/Podkova-Medium.ttf"},{weight:600,style:"normal",filename:"Podkova/static/Podkova-SemiBold.ttf"},{weight:700,style:"normal",filename:"Podkova/static/Podkova-Bold.ttf"},{weight:800,style:"normal",filename:"Podkova/static/Podkova-ExtraBold.ttf"}],type:"builtin"},{name:"Roboto",variants:[{weight:100,style:"normal",filename:"Roboto/Roboto-Thin.ttf"},{weight:100,style:"italic",filename:"Roboto/Roboto-ThinItalic.ttf"},{weight:300,style:"normal",filename:"Roboto/Roboto-Light.ttf"},{weight:300,style:"italic",filename:"Roboto/Roboto-LightItalic.ttf"},{weight:400,style:"normal",filename:"Roboto/Roboto-Regular.ttf"},{weight:400,style:"italic",filename:"Roboto/Roboto-Italic.ttf"},{weight:500,style:"normal",filename:"Roboto/Roboto-Medium.ttf"},{weight:500,style:"italic",filename:"Roboto/Roboto-MediumItalic.ttf"},{weight:700,style:"normal",filename:"Roboto/Roboto-Bold.ttf"},{weight:700,style:"italic",filename:"Roboto/Roboto-BoldItalic.ttf"},{weight:900,style:"normal",filename:"Roboto/Roboto-Black.ttf"},{weight:900,style:"italic",filename:"Roboto/Roboto-BlackItalic.ttf"}],type:"builtin"},{name:"Roboto Condensed",variants:[{weight:300,style:"normal",filename:"Roboto_Condensed/RobotoCondensed-Light.ttf"},{weight:300,style:"italic",filename:"Roboto_Condensed/RobotoCondensed-LightItalic.ttf"},{weight:400,style:"normal",filename:"Roboto_Condensed/RobotoCondensed-Regular.ttf"},{weight:400,style:"italic",filename:"Roboto_Condensed/RobotoCondensed-Italic.ttf"},{weight:700,style:"normal",filename:"Roboto_Condensed/RobotoCondensed-Bold.ttf"},{weight:700,style:"italic",filename:"Roboto_Condensed/RobotoCondensed-BoldItalic.ttf"}],type:"builtin"},{name:"Roboto Mono",variants:[{weight:100,style:"normal",filename:"Roboto_Mono/static/RobotoMono-Thin.ttf"},{weight:100,style:"italic",filename:"Roboto_Mono/static/RobotoMono-ThinItalic.ttf"},{weight:200,style:"normal",filename:"Roboto_Mono/static/RobotoMono-ExtraLight.ttf"},{weight:200,style:"italic",filename:"Roboto_Mono/static/RobotoMono-ExtraLightItalic.ttf"},{weight:300,style:"normal",filename:"Roboto_Mono/static/RobotoMono-Light.ttf"},{weight:300,style:"italic",filename:"Roboto_Mono/static/RobotoMono-LightItalic.ttf"},{weight:400,style:"normal",filename:"Roboto_Mono/static/RobotoMono-Regular.ttf"},{weight:400,style:"italic",filename:"Roboto_Mono/static/RobotoMono-Italic.ttf"},{weight:500,style:"normal",filename:"Roboto_Mono/static/RobotoMono-Medium.ttf"},{weight:500,style:"italic",filename:"Roboto_Mono/static/RobotoMono-MediumItalic.ttf"},{weight:600,style:"normal",filename:"Roboto_Mono/static/RobotoMono-SemiBold.ttf"},{weight:600,style:"italic",filename:"Roboto_Mono/static/RobotoMono-SemiBoldItalic.ttf"},{weight:700,style:"normal",filename:"Roboto_Mono/static/RobotoMono-Bold.ttf"},{weight:700,style:"italic",filename:"Roboto_Mono/static/RobotoMono-BoldItalic.ttf"}],type:"builtin"},{name:"Roboto Slab",variants:[{weight:100,style:"normal",filename:"Roboto_Slab/static/RobotoSlab-Thin.ttf"},{weight:200,style:"normal",filename:"Roboto_Slab/static/RobotoSlab-ExtraLight.ttf"},{weight:300,style:"normal",filename:"Roboto_Slab/static/RobotoSlab-Light.ttf"},{weight:400,style:"normal",filename:"Roboto_Slab/static/RobotoSlab-Regular.ttf"},{weight:500,style:"normal",filename:"Roboto_Slab/static/RobotoSlab-Medium.ttf"},{weight:600,style:"normal",filename:"Roboto_Slab/static/RobotoSlab-SemiBold.ttf"},{weight:700,style:"normal",filename:"Roboto_Slab/static/RobotoSlab-Bold.ttf"},{weight:800,style:"normal",filename:"Roboto_Slab/static/RobotoSlab-ExtraBold.ttf"},{weight:900,style:"normal",filename:"Roboto_Slab/static/RobotoSlab-Black.ttf"}],type:"builtin"},{name:"Sora",variants:[{weight:100,style:"normal",filename:"Sora/static/Sora-Thin.ttf"},{weight:200,style:"normal",filename:"Sora/static/Sora-ExtraLight.ttf"},{weight:300,style:"normal",filename:"Sora/static/Sora-Light.ttf"},{weight:400,style:"normal",filename:"Sora/static/Sora-Regular.ttf"},{weight:500,style:"normal",filename:"Sora/static/Sora-Medium.ttf"},{weight:600,style:"normal",filename:"Sora/static/Sora-SemiBold.ttf"},{weight:700,style:"normal",filename:"Sora/static/Sora-Bold.ttf"},{weight:800,style:"normal",filename:"Sora/static/Sora-ExtraBold.ttf"}],type:"builtin"}],sH={};for(const BIe of aH)sH[BIe.name]=BIe;function cH(e){return e.sort(((e,t)=>e.weight!==t.weight?e.weight-t.weight:"italic"===e.style?1:-1))}(0,at.resolve)("/","../data");var dH=n(2098);function lH(e){return"custom"===e.type||"custom_drive"===e.type}const uH={};for(const BIe of aH)uH[BIe.name]=BIe;new dH.EventEmitter;function fH(e,t){const n=[];for(const r of t){const{type:e,dataRef:t,metadata:o,status:i}=r;if("font_variant"===e&&o.font&&t){if("completed"!==i)return;const{weight:e,style:r}=o.font;n.push({weight:e,style:r,filename:t})}}if(n.length>0)return{name:e.defaultDisplayName,variants:cH(n),type:"custom"}}function mH(e,t){return"free"===bH(e,t)}function pH(e,t){const n=IH(e,t);if(n){const t=ru(e,n.driveId)?.memberships?.find((e=>e.user.id===n?.owner?.id));if(t)return"free"===t.type}return!1}function gH(e,t,n){return e===al.Edit&&t&&!n}function hH({currentUser:e,project:t,currentUserIsDriveMember:n,currentUserIsFreeMember:r,projectOwnedByFreeMember:o,skipBasicMemberEditRestriction:i}){return function({currentUser:e,project:t,currentUserIsDriveMember:n,currentUserIsFreeMember:r,projectOwnedByFreeMember:o,skipBasicMemberEditRestriction:i=!1}){return!(!e||!t)&&!(!i&&(n&&r||o)&&e.id!==t.owner?.id)&&(!!e.permissionsForProject(t).hasEditorPermissions||gH(t.permissions.driveAccess,n,r))}({currentUser:e,project:t,currentUserIsDriveMember:n,currentUserIsFreeMember:r,projectOwnedByFreeMember:o,skipBasicMemberEditRestriction:i})?al.Edit:function({currentUser:e,project:t,currentUserIsDriveMember:n,currentUserIsFreeMember:r,projectOwnedByFreeMember:o}){if(!t||!e)return!1;if(t.owner?.id===e.id)return!1;const i=t.id,a=e.ownerships?.find((e=>e.projectId===i)),s=n&&r||o;if(a){if(a.role===yl.Tester){const e=gH(t.permissions.driveAccess,n,r);return!(!s||!e)||!e}return s}if(!n)return t.permissions.publicAccess===al.Comment;const c=t.permissions.driveAccess;return c===al.Comment||c===al.Edit&&r}({currentUser:e,project:t,currentUserIsDriveMember:n,currentUserIsFreeMember:r,projectOwnedByFreeMember:o})?al.Comment:function(e,t){return!!e&&(e.permissions.publicAccess===al.View||t&&e.permissions.driveAccess===al.View)}(t,n)?al.View:al.None}function vH(e){return e.project.projects}function EH(e,t){const n=LH(e,t);return void 0===n?void 0:tH(e,n)}function yH(e,t){const n=EH(e,t)?.productGroup;return!!n&&$d(n)}function SH(e,t){return e.project.projects[t]}function IH(e,t){return SH(e,t)?.project}const bH=(0,Yl.createCachedSelector)(ru,(e=>Al(e)),((e,t)=>e?.memberships?.find((({user:{id:e}})=>e===t))?.type))(((e,t)=>t));BW((function(e,t=!0){let n=0;const r=t?DH:OH;for(const o of Object.keys(e.project.projects))n+=r(e,o);return n>Number.MIN_VALUE?n:0}),1e3);const TH=(0,el.createSelector)((e=>e.mediaLibrary.proxyGenerationInProgress),(e=>e.size>0?.1:void 0)),wH=(0,el.createSelector)((e=>e.mediaLibrary.uploadFilesInProgress),(e=>{let t=0,n=0;for(const r of Object.values(e))t+=r,n+=1;return n>0?t/n:void 0}));function CH(e,t){return e.collab.projectSyncStatus[t]}function _H(e){return e.project.activeProjectId}function AH(e){return e.project.activePublishedProjectId}const RH=(0,el.createSelector)([SH,(e,t)=>{const n=IH(e,t)?.driveId;return void 0!==n?ou(e,n):void 0},e=>Al(e)],((e,t,n)=>{if(!e?.project||!t||!n)return;const{users:r,project:o}=e;if(!r)return;let i;if(r?.length&&(i=r),o.permissions.driveAccess!==al.None){const e=new Set(r?.map((({id:e})=>e))),n=t?.filter((t=>!e.has(t.id)));n?.length&&(i=i?.concat(n)??n)}return i})),MH=(0,el.createSelector)([RH,Al],((e,t)=>e?.filter((({id:e})=>e!==t))));const DH=BW(OH,1e3,((e,t)=>t));function OH(e,t){return function(e,t){const n=SH(e,t);if(!n?.downloadProgress)return 0;const{size:r,progress:o}=n.downloadProgress;return(r||0)*((100-(o||0))/100)}(e,t)+VW(e,t)}function xH(e){return e.project.backendVoices}const kH=(0,el.createSelector)([xH,e=>e.auth.user?.id],((e,t)=>{const n=new Map(e);for(const r of n.values())!r.isPublic||t&&Ll(r,t)||n.delete(r.id);return n}));const NH=(0,el.createSelector)([vH,function(e){return e.project.userProjects||new Set},kH,Cl],((e,t,n,r)=>{const o=r?.id,i=new Set;for(const c of n.values())i.add(c.trainingDataProjectId);const a=[],s=[];return t.forEach((t=>{const n=e[t];n?.project&&r&&(o===n.project.owner?.id||n.project.permissions.publicAccess!==al.None||n.project.permissions.driveAccess!==al.None||r.ownerships?.some((e=>e.projectId===n?.project?.id)))&&!i.has(n.project.id)&&(n.project.template?.isPublic?s.push(n):a.push(n))})),{currentUserProjects:a,publicTemplateProjects:s}}));const PH=(0,el.createSelector)([NH],(({currentUserProjects:e,publicTemplateProjects:t})=>gu(e,t)));function LH(e,t){return IH(e,t)?.driveId}BW((0,Yl.createCachedSelector)(((e,t,n)=>t?jW(e,t):void 0),((e,t,n)=>n?uu(e,n):void 0),((e,t,n)=>{const r=RW(e,t);return r?NG(r):void 0}),((e,t,n)=>{const r={};if(t)for(const o of t)r[o.name]=o;if(e)for(const{asset:o,artifacts:i}of Object.values(e)){if("font"!==o.assetType)continue;const e=o.defaultDisplayName;if(n&&!n.get(e))continue;const t=Object.values(i);if(t.some((e=>e.status!==FG.completed)))continue;const a=fH(o,t);a&&lH(a)&&(r[e]=a)}return Object.values(r)}))({...yp("getCustomFonts"),keySelector:function(e,t,n){return`${t}:${n}`}}),1e3);yp("getCurrentUserTemplatesWithPermission");n(76092),n(38994);function FH(e,t){if(e.presence.users){const n=e.presence.users[t];if(n&&n.length>0)return n}}const UH=(0,Yl.createCachedSelector)((e=>e.ui.windowRoutes),((e,t)=>t),((e,t)=>e.filter((({route:e})=>e.indexOf(t)>=0)).map((({webContentsId:e})=>e))))(((e,t)=>t));function BH(e){return e.ui.activeBreakpoint}function jH(e){return t=BH(e),n=900,void 0!==t&&t<=n;var t,n}function VH(e){return!function(e){return e.ui?.hideOnboarding}(e)&&Boolean(function(e){return e.ui?.onboardingStep}(e))}function zH(e){return!!e?.clientMigrationRevisionId&&!!e?.clientMigratedAt&&!e?.revertedAt}async function GH(e,{projectId:t}){try{return function(e){return{backgroundMigrationStatus:e.status,remainingRevisions:e.remaining_revisions,clientMigrationRevisionId:e.client_migration_revision_id,clientMigratedAt:e.client_migration_timestamp?new Date(e.client_migration_timestamp):void 0,revertedAt:e.reverted_at?new Date(e.reverted_at):void 0}}(await Rc(e,si.GET,`/revision_migration/project/${t}/status`))}catch(n){return void console.warn("Failed to fetch revision migration",n)}}const WH=(0,el.createSelector)([Jl,e=>e.product.products],((e,t)=>{let n=0,r="descript_free";for(const o of e){const e=t[o.id]?.productGroup;if(void 0!==e){const t=Ud.indexOf(e);t>=n&&(n=t,r=e)}}return r}));function HH(e,t){return void 0!==e[t]}function qH(e,t){return HH(e,t)?e:void 0}function $H(e,t){const n=qH(e,"project"),r=qH(e,"document"),o=qH(e,"product"),i=qH(e,"presence"),a=qH(e,"ui"),s=HH(e,"product")&&HH(e,"auth")?e:void 0,{project_id:c=(n?_H(n):void 0),drive_id:d=(void 0!==c&&n?LH(n,c):void 0),composition_id:l=(void 0!==c&&r?OW(r,c):void 0)}=t;let u=t.subscription_plan;void 0===u&&(u=void 0===d?s?WH(s):void 0:o?tH(o,d)?.productGroup:void 0);const f={build:"web-share"};if(c){let e;if(f.project_id=c,r){e=RW(r,c)?.isStoryboard}if(void 0===e&&n){e=SH(n,c)?.project?.isStoryboardEnabled}void 0!==e&&(f.is_storyboard=e)}if(l&&(f.composition_id=l),d&&(f.drive_id=d),u&&(f.subscription_plan=u),c&&i&&FH(i,c)&&(f.multi_user=!0),c&&a&&(f.multi_window=function(e,t){return UH(e,t).length>1}(a,c)),c&&n){const e=SH(n,c)?.liveCollabMigrationMetadata?.status;e&&(zH(e)?f.live_collab_migration_status="migrated":(m=e,f.live_collab_migration_status=m?.revertedAt?"reverted":"incomplete"))}var m;return f}let KH,YH;var ZH=n(62272);const JH=new(n.n(ZH)());JH.stopCallback=()=>!1;const QH=new Map,XH=new Set;function eq(e){const{keyboardShortcut:t,eventType:n,callback:r,id:o}=e;QH.has(t)?XH.add(e):(QH.set(t,o),JH.bind(t,r,n))}function tq({keyboardShortcut:e,eventType:t}){QH.delete(e),JH.unbind(e,t)}let nq;function rq(e=Ra){void 0===nq&&0!==XH.size&&(nq=requestAnimationFrame((()=>{for(const{keyboardShortcut:t,id:n,eventType:r,callback:o}of XH)QH.has(t)?e(new Error(`${n} is attempting to double-bind "${t}" but it's already held by ${QH.get(t)}`),"keyboard-shortcut-bind"):(QH.set(t,n),JH.bind(t,o,r));nq=void 0,XH.clear()})))}const[oq,iq]=(0,Qr.k)("MenuCommandsState",{disabled:!1});function aq({onShortcut:e,menuCommand:t,disabled:n,fallbackForInput:r,eventType:o,stopPropagationAndPreventDefault:i=!0,contextId:a}){const{enabledInWeb:s,browserShortcut:c,enableInInput:d}=t,{disabled:l,contextId:u}=iq("WebMenuCommandListener");n=n??l??!1,a=a??u??"unknown";const f=Pr((n=>(!t.preventRepeat||!n.repeat)&&(!d&&jr(n,!0)?!r||(r(),!1):(e(n,t),!i))));return(0,Nt.useEffect)((()=>{if(!n&&void 0!==YH)return YH(t,e)}),[n,e,t]),function(e,t,n,r=!0,o="keydown"){(0,Nt.useEffect)((()=>{if(!r||!t)return;const i={id:e,keyboardShortcut:t,eventType:o,callback:n};return eq(i),rq(),()=>{XH.has(i)?XH.delete(i):tq(i),rq()}}),[e,r,n,t,o])}(a,c,f,!n&&s,o),_r}var sq=(e=>(e.RequestFailed="request_failed",e.RequestTimeout="request_timeout",e.Stalled="time_stalled",e.NoStateUpdates="no_state_updates",e))(sq||{});const cq=(0,pn.ZP)("PLAYBACK"),dq=cq("START"),lq=cq("SET_HOVER_PLAYHEAD"),uq=cq("CLEAR_ALL_HOVER_PLAYHEADS"),fq=cq("START_SUCCESS"),mq=cq("FAILED"),pq=cq("PAUSE"),gq=cq("PAUSE_SUCCESS"),hq=cq("TOGGLE"),vq=(cq("SPOT_AUDITION"),cq("START_FROM_TEXT_CURSOR"),cq("SEEK_TO_SELECTION")),Eq=cq("SEEK_TO_HOVER"),yq=(cq("SEEK_TO_COMPONENT"),cq("SEEK_TO_TAU"),cq("SEEK_TO_TIME")),Sq=cq("SEEK_BY_DELTA"),Iq=cq("START_BUFFERING"),bq=cq("STOP_BUFFERING"),Tq=cq("DID_SEEK"),wq=cq("AUDIO_TICK"),Cq=cq("CLEAR_ADJUSTED_PLAYHEAD_TIME"),_q=cq("SET_ADJUSTED_PLAYHEAD_TIME"),Aq=cq("SET_RATE"),Rq=cq("ALTER_RATE_BY"),Mq=cq("SET_VIDEO_BUFFER_ASPECT_RATIO"),Dq=cq("SET_VIDEO_BUFFER_SIZE"),Oq=cq("SET_PLAYABLE"),xq=cq("CLEAR_PLAYER"),kq=(cq("UPDATE_COMPOSITION_PLAYER"),cq("DID_UPDATE_COMPOSITION_PLAYER")),Nq=(cq("UPDATE_MEDIA_REF_PLAYER"),cq("UPDATE_SEQUENCE_PLAYER"),cq("UPDATE_EXPORT_PREVIEW_PLAYER"),cq("DID_UPDATE_EXPORT_PREVIEW_PLAYER")),Pq=cq("DID_UPDATE_MEDIA_REF_PLAYER"),Lq=cq("DID_UPDATE_SEQUENCE_PLAYER"),Fq=cq("STOP_TEXT_EDITOR_AUTOSCROLLING"),Uq=cq("STOP_TIMELINE_AUTOSCROLLING"),Bq=cq("ENABLE_AUTOSCROLLING"),jq=(cq("SET_CARET_TO_PLAYHEAD"),cq("STEP_FRAME"),cq("SEEK_TO_NEAREST_MARKER"),cq("SEEK_TO_MARKER"),cq("SEEK_TO_NEAREST_CARD"),cq("MOVE_PLAYHEAD_TO_CLIP"),cq("MOVE_PLAYHEAD_TO_END"),cq("SET_SCROLL_TO_TIME")),Vq="sequence:";function zq(e){return Vq+e}const Gq="media_reference:";var Wq=n(31216);const Hq=/^https?:\/\/[^/]+\/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\//;function qq(e){return e.endsWith(".json")}async function $q(e,t){const n={url:t,redirect:!1},r=function(e){const t=e.match(Hq);if(t&&t.length>1)return t[1]}(t);if(void 0===r)throw new Error("Asset url is invalid - missing project ID");return(await Rc(e,si.GET,`/projects/${r}/asset_url`,n)).url}function Kq(){return(new Date).toISOString()}function Yq(e){const t=function(e){if(e.contents.content&&void 0!==e.contents.content.size)return e.contents.content.size;let t=0;const n=e.contents.assets||{};for(const r of Object.keys(n))if(qq(r)){const e=n[r].size??0;e>t&&(t=e)}return t}(e),n=function(e){const t=e.contents.assets;if(!t)return;let n=0;const r=Object.keys(t),o=new Set;for(const i of r){const e=t[i];let r=e;e.quality&&(e.quality.preview?r=e.quality.preview:e.quality.original&&(r=e.quality.original));const a=r.url;o.has(a)||(n+=void 0===r.size?0:r.size,o.add(a))}return n}(e);if(void 0!==n)return t+n}function Zq({projectId:e,revisionId:t=(0,Zt.Z)(),baseRevisionId:n,revisionNumber:r=1,message:o,bundleVersion:i="1.0.0",createdBy:a,createdAt:s=Kq(),contents:c,isSignificant:d=!1,isNew:l=!0,forceSave:u=!1,compositionSummaries:f}){return c&&(delete c.cdn_content_url,delete c.cdn_assets),{projectId:e,revisionId:t,baseRevisionId:n,revisionNumber:r,message:o,bundleVersion:i,createdBy:a,createdAt:s,contents:c,isSignificant:d,isNew:l,forceSave:u,compositionSummaries:f}}function Jq(e,t){const{revisionId:n,revisionNumber:r=0}=e||{};return Zq({...t,baseRevisionId:n,revisionNumber:r+1,isNew:!0})}function Qq(e,{id:t,revision_number:n,message:r,bundle_version:o,created_by:i,created_at:a,contents:s,is_significant:c,composition_summaries:d}){return Zq({projectId:e,revisionId:t,revisionNumber:n,message:r,bundleVersion:o,createdBy:i,createdAt:a,contents:s,isSignificant:c,isNew:!1,compositionSummaries:d})}function Xq(e,t=[]){return t.map((t=>Qq(e,t)))}function e$(e){return e.signed_url?{...e,signed_url:e.signed_url.replace("s3.us-west-2.amazonaws.com","s3-accelerate.amazonaws.com")}:e}const t$="https://www.descript.com",n$="https://help.descript.com/hc/en-us/requests/new";function r$(e="release"){return("release"===e||"production"===e?na:"beta"===e&&ra)||"staging"===e&&oa||aa}function o$(e,t){return t||(t="production"),`${function(e=ir.publishWebTarget.get()){return("production"===e?sa:"beta"===e&&da)||"staging"===e&&ca||"staging-api"===e&&la||ua}(t)}/view/${e}`}function i$(e){return e?o$(e):t$}async function a$(e,t){const n=await Rc(e,si.GET,`/projects/${t}`);return{project:wl.fromJson(n),revisions:(n.revisions||[]).map((e=>Qq(t,e)))}}async function s$(e,t,{permissions:n,name:r,driveId:o,parentFolderId:i,editorVariant:a,hasThumbnail:s}){let c={};if(i&&o&&i===Wn(o)?c.in_recordings_folder=!0:void 0!==i&&(c.parent_id=i),void 0!==n){const e={public_access:n.publicAccess,member_access:n.driveAccess};c={...c,permissions:e}}void 0!==r&&(c={...c,name:r.length>255?r.slice(0,255):r}),void 0!==o&&(c={...c,drive_id:o}),void 0!==a&&(c.editor_variant=a),void 0!==s&&(c.has_thumbnail=s);const d=await Rc(e,si.PUT,`/projects/${t}`,void 0,c);return wl.fromJson(d)}async function c$(e,t,n,r,o){const i={role:r,user_id:n,notify:o},a=await Rc(e,si.POST,`/projects/${t}/ownerships`,void 0,i);let s=[];a.ownerships&&(s=a.ownerships.map(Sl.fromJson));let c=[];a.users&&(c=a.users.map(bl.fromJson));return[s[0],c[0]]}async function d$(e,t,n,r,o="project"){const i=(0,at.extname)(r);return await async function(e,t,n="project",r){let o;if("publish"===n)o=`/published_projects/${t}/upload_file`;else o=`/projects/${t}/upload_file`;return e$(await Rc(e,si.GET,o,r))}(e,t,o,{content_type:n,extension:i,filename:(0,at.basename)(r,i)})}function l$(e,t,n=function(){return"descript-assets"+(bi()?"":"-testing")}()){return`https://${n}.s3.amazonaws.com/${e}/${t}`}function u$(e){const t=wl.latestRevision(e);if(void 0!==t)return{revisionId:t.revisionId,compositionSummaries:t.compositionSummaries,size:W()&&t.contents?Yq(t):void 0,createdAt:t.createdAt}}function f$(e=[]){return e.map((e=>{const t=wl.fromJson(e);return{project:t,revisions:Xq(t.id,e.revisions)}}))}async function m$(e){return f$(await Rc(e,si.GET,"/projects/templates/public",{payload_version:1}))}class p${constructor(e="",t=0,n="",r="",o="",i=0,a=0,s="",c,d="",l="",u){this.id=e,this.amount=t,this.description=n,this.startDate=r,this.endDate=o,this.quantity=i,this.pricePerUnit=a,this.unitLabel=s,this.usageType=c,this.productId=d,this.productName=l,this.subscriptionItemId=u}static fromJson(e){return new p$(e.id,e.amount,e.description,e.start_date,e.end_date,e.quantity,e.price_per_unit,e.unit_label,e.usage_type,e.product_id,e.product_name,e.subscription_item_id)}static toJson(e){return{id:e.id,amount:e.amount,description:e.description,start_date:e.startDate,end_date:e.endDate,quantity:e.quantity,price_per_unit:e.pricePerUnit,unit_label:e.unitLabel,usage_type:e.usageType,product_id:e.productId,product_name:e.productName,subscription_item_id:e.subscriptionItemId}}get isRefund(){return this.amount<0}}class g${constructor(e="upcoming",t="",n={firstName:"",lastName:"",email:""},r=0,o="",i=!1,a=0,s,c,d){this.id=e,this.invoiceNumber=t,this.user=n,this.amountDue=r,this.date=o,this.paid=i,this.subtotal=a,this.percentOff=s,this.lineItems=c,this.receiptUrl=d}static fromJson(e){const t={firstName:e.user&&e.user.first_name?e.user.first_name:"",lastName:e.user&&e.user.last_name?e.user.last_name:"",email:e.user&&e.user.email?e.user.email:""},n=e.discount?e.discount.percent_off:void 0,r=e.line_items&&e.line_items.map((e=>p$.fromJson(e)));return new g$(e.id,e.number,t,e.amount_due,e.date,e.paid,e.subtotal,n,r,e.receipt_url)}static toJson(e){const t=void 0!==e.percentOff&&e.percentOff>0?{percent_off:e.percentOff}:void 0,n=e.lineItems?e.lineItems.map((e=>p$.toJson(e))):void 0;return{id:e.id,number:e.invoiceNumber,amount_due:e.amountDue,date:e.date,paid:e.paid,subtotal:e.subtotal,discount:t,line_items:n,user:{first_name:e.user.firstName,last_name:e.user.lastName,email:e.user.email},receipt_url:e.receiptUrl}}}var h$=(e=>(e.Metered="metered",e.Licensed="licensed",e))(h$||{}),v$=(e=>(e.Running="running",e.Failed="failed",e.AlignmentFailed="alignmentFailed",e.Canceled="canceled",e.Completed="completed",e.Queued="queued",e.Ready="ready",e))(v$||{}),E$=(e=>(e.GoogleCloudSpeech="google-cloud-speech",e.HumanManual="human-manual",e.ScaleApi="scale-api",e.RevAI="rev-ai",e.RevFusion="rev-ai-fusion",e.Automatic="automatic",e.Live="live",e.DeepgramV1="deepgram-v1",e.RevAiV2="rev-ai-v2",e.whisperV2="whisper-v2",e.whisperV3="whisper-v3",e))(E$||{});var y$=(e=>(e.Automatic="automatic",e.WhiteGlove="white_glove",e))(y$||{});class S${constructor(e="",t="",n=0,r=E$.Automatic,o="",i=16e3,a,s,c,d,l,u,f,m,p,g,h,v=0,E=0,y=0,S=0,I=0,b){this.id=e,this.audioFilename=t,this.audioDuration=n,this.transcriptionService=r,this.audioUrl=o,this.sampleRate=i,this.driveId=a,this.userId=s,this.createdAt=c,this.transcriptionStartedAt=d,this.transcriptionEndedAt=l,this.endResult=u,this.deliveredAt=f,this.alignment=m,this.formattedText=p,this.projectId=g,this.state=h,this.paidMinutes=v,this.prepaidMinutesUsed=E,this.freeMinutesUsed=y,this.windowMinutesUsed=S,this.pricePerMinute=I,this.language=b}static fromJson(e){const t=function(e){switch(e){case"human-manual":return"human-manual";case"google-cloud-speech":return"google-cloud-speech";case"rev-ai":return"rev-ai";case"rev-ai-fusion":return"rev-ai-fusion";case"scale-api":return"scale-api";case"automatic":return"automatic";case"deepgram-v1":return"deepgram-v1";case"rev-ai-v2":return"rev-ai-v2";case"whisper-v2":return"whisper-v2";case"whisper-v3":return"whisper-v3";default:return}}(e.transcription_service),n=e.created_at?new Date(e.created_at):void 0,r=e.delivered_at?new Date(e.delivered_at):void 0,o=e.transcription_started_at?new Date(e.transcription_started_at):void 0,i=e.transcription_ended_at?new Date(e.transcription_ended_at):void 0;return new S$(e.id,e.audio_filename,e.audio_duration,t,e.audio_url,e.sample_rate,e.drive_id,e.user_id,n,o,i,e.end_result,r,e.alignment,e.formatted_text,e.project_id,e.state,e.paid_minutes,e.prepaid_minutes_used,e.free_minutes_used,e.window_minutes_used,e.price_per_minute,e.language)}get isProcessing(){return!(void 0===this.state||!this.state)&&!(this.state===v$.Completed||this.state===v$.Canceled||this.state===v$.Failed)}get isWhiteGlove(){return this.transcriptionService===E$.HumanManual||this.transcriptionService===E$.ScaleApi}}var I$=(e=>(e.PrivateWorkspace="private",e.DriveWorkspace="drive",e.RecentProjects="recent",e.QuickRecordings="quick_recordings",e.Templates="templates",e.SharedWithMe="shared_with_me",e))(I$||{}),b$=(e=>(e.LastViewed="last_viewed",e.CreatedDate="created",e.LastModified="last_modified",e.Name="name",e.Size="size",e.Duration="duration",e.Owner="owner",e.Drive="drive_name",e))(b$||{});async function T$(e,t="me"){return await Rc(e,si.GET,`/users/${t}/drives`)}async function w$(e,t,n,r){return await Rc(e,si.PUT,`/drives/${t}/memberships/${n}`,void 0,r)}async function C$(e,t,n){await Rc(e,si.DELETE,`/drives/${t}/memberships/${n}`)}async function _$(e,t,n,r){const o={content_type:n,filename:r};return e$(await Rc(e,si.GET,`/drives/${t}/upload_file`,o))}async function A$(e,t,n){try{return(await Rc(e,si.GET,`/drives/${t}/${n}`)).map((e=>g$.fromJson(e)))}catch(r){if(404===r.statusCode)return[];throw r}}async function R$(e,t){return await A$(e,t,"invoices")}async function M$(e,t){return await A$(e,t,"invoices_upcoming")}async function D$({driveId:e,assetGuid:t}){}async function O$(e,t,n){await Rc(e,si.PUT,`/drives/${t}/editor_invites_require_approval`,void 0,{editor_invites_require_approval:n})}const x$=(0,pn.ZP)(),k$=x$.async("FETCH_DRIVE"),N$=x$.async("FETCH_DRIVES"),P$=x$("FETCH_CURRENT_USER_DRIVES"),L$=x$.async("FETCH_USER_DRIVES_FOR_ADMIN"),F$=x$.async("CREATE_DRIVE"),U$=x$.async("UPDATE_DRIVE"),B$=x$.async("DELETE_DRIVE"),j$=x$.async("FETCH_DRIVE_INVITES"),V$=x$.async("INVITE_DRIVE_MEMBERS"),z$=x$.async("RESEND_DRIVE_INVITE"),G$=x$.async("DELETE_DRIVE_INVITE"),W$=x$.async("FETCH_DRIVE_PRODUCT"),H$=x$.async("DELETE_DRIVE_PRODUCT"),q$=x$.async("UPGRADE_DRIVE_SUBSCRIPTION");var $$=(e=>(e[e.Hard=0]="Hard",e[e.MissingFeatures=1]="MissingFeatures",e[e.Break=2]="Break",e[e.AnotherProduct=3]="AnotherProduct",e[e.TechnicalIssues=4]="TechnicalIssues",e[e.NotNeeded=5]="NotNeeded",e[e.Consolidating=6]="Consolidating",e[e.Audiograms=7]="Audiograms",e[e.BatchExport=8]="BatchExport",e[e.FillerWordDetection=9]="FillerWordDetection",e[e.Publishing=10]="Publishing",e[e.Overdub=11]="Overdub",e[e.Transcription=12]="Transcription",e[e.Pricing=13]="Pricing",e))($$||{});const K$=x$.async("CANCEL_DRIVE_SUBSCRIPTION"),Y$=(x$.async("PAUSE_DRIVE_SUBSCRIPTION"),x$.async("RESUME_DRIVE_SUBSCRIPTION")),Z$=x$.async("DELETE_DRIVE_MEMBER"),J$=x$("REQUEST_ADD_DRIVE_MEMBER_MODAL"),Q$=(x$("REQUEST_LOGO_PREVIEW_MODAL"),x$.async("CLEAR_DRIVE_FREE_MINUTES")),X$=x$.async("UPDATE_DRIVE_MEMBERSHIP"),eK=x$("CLEAR_UPDATE_DRIVE_MEMBERSHIP_ERROR"),tK=x$.async("UPDATE_EDITOR_INVITES_REQUIRE_APPROVAL"),nK=x$("UPDATE_DRIVE_FONTS"),rK=x$("ARCHIVE_DRIVE_FONT");x$.async("ADD_REVERSE_TRIAL"),x$("SHOW_POST_APP_ONBOARDING_TUTORIAL_MODAL"),x$("HIDE_POST_APP_ONBOARDING_TUTORIAL_MODAL");function oK({id:e,invitee_email:t,invite_object_id:n,created_at:r,accepted_at:o,accepted_by:i,invitee_exists:a,public_properties:s,...c}){const d={id:e,inviteeEmail:t,inviteObjectId:n,createdAt:new Date(r),acceptedAt:o?new Date(o):void 0,acceptedBy:i,inviteeExists:a,name:s?.name};switch(c.invite_object_type){case"drive":return{...d,type:"drive",membershipType:c.properties.membership_type};case"project":return{...d,type:"project",projectRole:c.properties.role};default:return{...d,type:"drive",membershipType:"editor"}}}function iK(e,t,n){return[...e||[]].filter((e=>(e=>!t||t!==Ul.admins&&(t===Ul.editors?"editor"===e.membershipType:t!==Ul.basic||"free"===e.membershipType))(e)&&(e=>!n||e.inviteeEmail.toLowerCase().includes(n.toLowerCase()))(e))).sort(((e,t)=>e.membershipType!==t.membershipType?"editor"===e.membershipType?Ie.OrderedAscending:Ie.OrderedDescending:be(e.inviteeEmail,t.inviteeEmail)))}async function aK(e,t,n){const r={objectId:n,objectType:t};return(await Rc(e,si.GET,"/invites/lookup",r)).map(oK)}async function sK(e,t){return await aK(e,"drive",t)}async function cK(e,t){t.comment||(t.comment=void 0);return oK(await Rc(e,si.POST,"/invites",void 0,t))}async function dK(e,t,n,r){return await cK(e,{invite_object_type:"drive",invite_object_id:t,invitee_email:n,properties:{membership_type:r}})}async function lK(e,t,n,r){return await cK(e,{invite_object_type:"project",invite_object_id:t,invitee_email:n,properties:{role:r}})}async function uK(e,t){await Rc(e,si.DELETE,`/invites/${t}`)}const fK=(0,pn.ZP)(),mK=(fK("CHANGE_API_TARGET"),fK("CHANGE_LIVE_TRANSCRIPTION_API_TARGET"),fK("NO_USER")),pK=fK("REFETCH_USER"),gK=fK.async("UPDATE_USER"),hK=fK("PASSWORD_UPDATE_FAILED"),vK=fK("EMAIL_UPDATE_FAILED"),EK=fK("RESET_EMAIL_UPDATE_ERROR"),yK=fK("FETCH_USER_SUCCEEDED"),SK=fK("FETCH_USER_FAILED"),IK=fK("FETCH_USER_DATA_STARTED"),bK=fK("FETCH_USER_DATA_SUCCEEDED"),TK=fK("FETCH_USER_DATA_FAILED"),wK=fK("DELETE_USER"),CK=fK("DELETE_USER_FAILED"),_K=(fK("FINALIZE_ONBOARDING"),fK.async("FETCH_CARD")),AK=fK.async("SET_CARD"),RK=fK("CLEAR_CARD"),MK=fK("REQUIRE_AUTHENTICATION"),DK=fK("SIGN_OUT"),OK=fK("REQUEST_SHOW_SIGNUP_MODAL"),xK=fK("REQUEST_HIDE_SIGNUP_MODAL"),kK=(fK("REQUEST_HIDE_EDIT_IN_ELECTRON_MODAL"),fK("REQUEST_SHOW_EDIT_IN_ELECTRON_MODAL"),fK("REQUEST_HIDE_EDIT_EMAIL_MODAL")),NK=(fK("REQUEST_SHOW_EDIT_EMAIL_MODAL"),fK("REQUEST_HIDE_EDIT_PASSWORD_MODAL")),PK=fK("REQUEST_SHOW_EDIT_PASSWORD_MODAL"),LK=fK("REQUEST_EDIT_CREDIT_CARD_MODAL"),FK=fK("REQUEST_CANCEL_MODAL"),UK=(fK("REQUEST_SHARE_DATA_CONSENT_MODAL"),fK.async("FETCH_DATA_CONSENT_INFO")),BK=fK.async("SET_DATA_CONSENT"),jK=fK("USER_SIGNED_OUT"),VK=(fK.async("AUTH0_CALLBACK_FOR_WEB"),fK.async("REQUEST_CHANGE_PASSWORD_EMAIL"));var zK=(e=>(e.Account="account",e.AccountDropdownMenu="account-dropdown-menu",e.CreateNewDrive="create-new-drive",e.Members="members",e.FileSize="file-size-limit",e.ExportTimeline="export-session",e.Project="project",e.ProjectTopBanner="project-top-banner",e.DriveTopBanner="drive-top-banner",e.Transcription="transcription",e.WhiteGlove="white-glove",e.ProjectBrowser="project-browser",e.ProjectBrowserLeftSidebarCTAUpgrade="project-browser-left-sidebar-cta-upgrade",e.ProjectBrowserLeftSidebarCTAFromInactive="project-browser-left-sidebar-cta-from-inactive",e.RateLimit="rate-limit",e.FillerWords="filler-words",e.AudiogramBackgroundImage="audiogram-background-image",e.AudiogramBadge="audiogram-badge",e.BatchExport="batch-export",e.CustomFonts="custom-fonts",e.OverdubNewVoice="overdub-new-voice",e.GenerateBackgroundMask="generate-background-mask",e.GenerateStudioSound="generate-studio-sound",e.GenerateEyeContact="generate-eye-contact",e.GenerateOverdub="generate-overdub",e.OverdubShareVoice="overdub-share-voice",e.ScreenRecording="screen-recording",e.SquadCast="squadcast",e.ProjectEditorContextMenu="project-editor-context-menu",e.ProjectFilterList="project-filter-list",e.ProjectClipProperties="project-clip-properties",e.ProjectScriptToolbar="project-script-toolbar",e.CustomBranding="custom-branding",e.RemoveWatermark="remove-watermark",e.MediaSearchLimitation="media-search-limitation",e.ExportResolution="export-resolution",e))(zK||{});const GK="descript_pro",WK=fK("REQUEST_MANAGE_SUBSCRIPTION_MODAL");fK("REQUEST_PROFILE_IMAGE_PREVIEW_MODAL");var HK=n(95044);function*qK(...e){return yield*(0,Wq.qn)(e.map((({type:e})=>e)))}function $K(e,t){return function*(n){try{yield e(n.payload,...t)}catch(r){Ra(r,"action-saga",{extra:{worker:e.name,action:n.type}})}}}function*KK(e,t,...n){return yield*(0,Wq.ib)(e.type,$K(t,n))}function YK(e,t,n){const r=(0,HK.k)(e,{skipStartedAction:!0})(t);return function*(t){try{yield*r(t)}catch(o){(void 0!==n?n(o):!ji(o))&&Ra(o,e.type.toLocaleLowerCase().replace("_","-"))}}}function*ZK(e,t,n){yield*KK(e.started,YK(e,t,n))}function*JK(e,t,n){yield*function*(e,t,...n){yield*(0,Wq.A7)(e.type,$K(t,n))}(e.started,YK(e,t,n))}function*QK(e){yield*(0,Wq.gz)(AK.started(e));const t=yield*qK(AK.done,AK.failed);if(AK.failed.match(t))throw t.payload.error;return t.payload}Error;let XK;function eY(){return XK}const tY=(0,pn.ZP)("PROJECT"),nY=(tY("OPEN_NEW_PROJECT_FAILED"),tY("REQUEST_NEW_PROJECT_PAGE"),tY.async("DUPLICATE_TO_STORYBOARD")),rY=tY.async("CREATE_PROJECT"),oY=tY("PROJECT_INITIALIZED"),iY=(tY("UPDATE_PROJECT"),tY("UPDATE_PROJECT_SUCCEEDED")),aY=(tY("FETCH_PROJECT"),tY("FETCH_PROJECT_SUCCEEDED")),sY=tY("SET_PUBLISHED_PROJECTS_FOR_PROJECT"),cY=tY("FETCH_PROJECT_FAILED",void 0,!0),dY=tY("LOAD_PROJECT_FAILED"),lY=tY("FETCH_PROJECT_CONTENTS_STARTED"),uY=tY("FETCH_PROJECT_CONTENTS_COMPLETED"),fY=tY("DOCUMENT_SAVE_FAILED"),mY=tY("CLEAR_PROJECT_SAVE_ERROR"),pY=tY("SETUP_PROJECT_STATE"),gY=(tY("TRIGGER_IMPORT_PROJECT_BACKUP"),tY.async("IMPORT_PROJECT_BACKUP"),tY("TRIGGER_EXPORT_PROJECT_BACKUP"),tY.async("EXPORT_PROJECT_BACKUP"),tY("UPDATE_WHOLE_DOCUMENT"),tY("CLEAR_ACTIVE_PROJECT")),hY=tY.async("SET_ACTIVE_PROJECT"),vY=tY("SET_PROJECT_LOAD_CONTEXT"),EY=tY("CLEAR_PROJECT_LOAD_CONTEXT"),yY=tY("SET_ACTIVE_ITEM"),SY=tY("SET_ACTIVE_COMPOSITION"),IY=tY("SET_ACTIVE_SEQUENCE_REF"),bY=(tY("SELECT_SEQUENCE_TAU"),tY("SELECT_SEQUENCE_TAUS_RANGE"),tY("SET_ACTIVE_SEQUENCE_CUE"),tY("SET_ACTIVE_SEQUENCE_TRACK_ID"),tY("FETCH_SCENE_AUDIO_FAILURE")),TY=tY("TRIMERGE_FAILED"),wY=(tY("DELETE_LOCAL_ASSET"),tY.async("FETCH_PROJECT_TEMPLATES")),CY=(tY.async("DUPLICATE_PROJECT_TEMPLATE"),tY("REQUEST_PROJECTS_SEARCH")),_Y=tY.async("SEARCH_REMOTE_PROJECTS"),AY=tY.async("SEARCH_PROJECTS"),RY=(tY("REQUEST_PROJECT_CREATION_MODAL"),tY("UPDATE_PROJECT_LAST_VIEWED_AT")),MY=tY("SET_PROJECT_FOLDER_EXPANDED"),DY=(tY("SET_ROOMTONE_MODAL"),tY("SET_BATCH_ROOMTONE_MODAL"),tY("SET_ORIGINAL_ASSETS_DOWNLOAD_PARAMS"),tY("REQUEST_CORRECTION_WIZARD_MODAL"),tY("SET_ADD_FILE_FROM_LINK_MODAL_VISIBLE"),tY("SHOW_MOVE_POPOVER")),OY=(tY("REQUEST_SHOW_ADD_FONTS_MODAL"),tY("REQUEST_HIDE_ADD_FONTS_MODAL"),tY("REQUEST_SHOW_FONT_MANAGEMENT_MODAL")),xY=(tY("REQUEST_HIDE_FONT_MANAGEMENT_MODAL"),tY("REQUEST_SHOW_DELETE_FONT_MODAL"),tY("REQUEST_DELETE_FONT_MODAL"),tY("DOWNLOAD_PROJECT"),tY("CANCEL_DOWNLOAD_PROJECT"),tY("SET_MEDIA_LIBRARY_POPOVER_VISIBLE")),kY=tY("SET_SEQ_MEDIA_LIBRARY_POPOVER_VISIBLE"),NY=tY("SET_MEDIA_LIBRARY_POPOVER_SELECTED_SOURCE"),PY=(tY("VIEW_MEDIA_REFERENCE_FOR_CARD_LAYER"),tY("SET_TEMPLATE_POPOVER_SELECTED_PROJECT_ID")),LY=(tY("SET_TEMPLATE_POPOVER_OPEN"),tY("SET_SHOW_SAVE_CARD_AS_TEMPLATE_POPOVER"),tY("SET_SHOW_VIDEO_SETTINGS_MODAL"),tY("ADD_PENDING_FILES")),FY=tY("REMOVE_PENDING_FILE"),UY=tY("SHOW_HISTORICAL_VERSION"),BY=tY("SHOW_LATEST_VERSION"),jY=(tY("RESTORE_HISTORICAL_VERSION"),tY.async("CREATE_MEDIA_LIBRARY_DALL_E_IMAGES")),VY=tY.async("CREATE_MEDIA_LIBRARY_DALL_E_VARIATIONS"),zY=tY("SET_UPDATE_TITLE_FONT_FUNCTION"),GY=tY("SET_LAST_WORD_GAP_DURATION"),WY=(tY("LOAD_SAVED_COMPOSITION_PLAYHEAD"),(0,pn.ZP)("INVITE")),HY=(WY("ACCEPT_INVITE"),WY("ACCEPT_DRIVE_INVITE_SUCCESS")),qY=(WY("ACCEPT_INVITE_SUCCESS"),WY("FETCH_PROJECT_INVITES")),$Y=WY("FETCH_PROJECT_INVITES_SUCCEEDED"),KY=(WY("DELETE_PROJECT_INVITE"),WY("INVITE_USER_TO_PROJECT")),YY=WY("INVITE_USER_TO_PROJECT_FAILED"),ZY=WY("INVITE_USER_TO_PROJECT_SUCCEEDED"),JY=WY("INVITE_USER_TO_PROJECT_CLEAR_ERROR");function QY(e,t){switch(e){case ol.DRIVE:return rl.DriveWorkspace;case ol.PERSONAL:return rl.LegacyMyWorkspace;case ol.RESTRICTED:default:return rl.PrivateWorkspace}}function XY({id:e,name:t,type:n,drive_id:r}){return{id:e,name:t,type:n,driveId:r}}function eZ(e){return[{id:il(e,ol.DRIVE),drive_id:e,type:ol.DRIVE,name:QY(ol.DRIVE)},{id:il(e,ol.PERSONAL),drive_id:e,type:ol.PERSONAL,name:QY(ol.PERSONAL)}]}const tZ=rd("WORKSPACE")("WORKSPACES",async function(e){const t=[];(await Rc(e,si.GET,"/users/me/driveIds")).map((e=>{t.push(...eZ(e))}));const n={};return t.forEach((e=>n[e.id]=XY(e))),n}.bind(void 0,vt()));const nZ=(0,pn.ZP)(),rZ=(nZ("CREATE_NEW_WINDOW"),nZ("RESIZE_WINDOW"),nZ("SHOW_WINDOW"),nZ("HIDE_QUICK_EDIT_WINDOW"),nZ("SHOW_RECORDER"),nZ("CLOSE_WINDOW"),nZ("GO_BACK_TO_DRIVE_VIEW")),oZ=nZ("OPEN_TEMPLATE_BROWSER_IN_ELECTRON"),iZ=(nZ("CREATE_OR_FOCUS_PROJECT_WINDOW_ACTION"),nZ("NAVIGATE_TO_EXTERNAL_URL"));var aZ=n(87861);const sZ=(0,pn.ZP)(),cZ=sZ.async("FETCH_DRIVE_LINKS_FOR_DRIVE"),dZ=(sZ.async("FETCH_DRIVE_INVITE_LINK_INFO"),sZ.async("RESET_DRIVE_LINKS_FOR_DRIVE")),lZ=sZ.async("ENABLE_DRIVE_LINKS_FOR_DRIVE"),uZ=sZ.async("DISABLE_DRIVE_LINKS_FOR_DRIVE"),fZ=(sZ("JOIN_DRIVE_INVITE_LINK_SUCCESS"),sZ("JOIN_DRIVE_INVITE_LINK_SET_DRIVE"));var mZ=n(15634),pZ=n(78545);const gZ=A.logging.groupLogger("webmediaengine/readmimetype"),hZ=4100;function vZ(e){switch(e){case"audio/x-aiff":return"audio/aiff";case"audio/x-m4a":case"audio/m4a":return"audio/mp4";case"audio/x-aac":return"audio/aac";case"audio/x-wav":case"audio/wav":case"audio/wave":case"audio/vnd.wave":return"audio/wave";case"image/heif":return"image/heic";default:return e}}async function EZ(e){const t=e.size>hZ?e.slice(0,hZ):e,n=await t.arrayBuffer(),r=await async function(e){try{return vZ((await(0,mZ.fileTypeFromBuffer)(e))?.mime)}catch(t){return void gZ.warn("Error getting mime type from buffer",{error:`${t}`})}}(new Uint8Array(n)),o=vZ(e.name&&(0,pZ.getType)(e.name)||void 0);return r?(o&&r!==o&&gZ.warn(`Mime type from file (${r}) does not match filename (${o})`),r):o??vZ(e.type)}function*yZ({driveId:e,name:t,logo:n,shareCustomBranding:r,qemPrivacyDefault:o,newProjectPrivacyDefault:i}){if(void 0===t&&void 0===n&&void 0===r&&void 0===o&&void 0===i)return;let a;if(void 0!==n){const t=yield*(0,Wq.RE)(EZ,n),{signed_url:r,aws_url:o}=yield*(0,Wq.RE)(_$,vt(),e,t);yield*(0,Wq.RE)(fetch,r,{method:"PUT",headers:{"Content-Type":t,"Cache-Control":"max-age=31536000"},body:n}),a=o}return yield*(0,Wq.RE)(eY().updateUserDrive,e,{name:t,drive_logo_url:a,share_custom_branding:r,qem_privacy_default:o,new_project_privacy_default:i})}function*SZ({driveId:e,fetchOwnerData:t}){const n=yield*(0,Wq.RE)(eY().fetchDrive,e);if(void 0===n)throw new Error(`Drive with id ${e} does not exist`);return{drive:n,isMember:yield*(0,Wq.Ys)(eu,e)}}function*IZ({params:{driveId:e,fetchOwnerData:t},result:{drive:n,isMember:r}}){t&&(yield*(0,Wq.gz)(W$.started({driveId:e})),yield*(0,Wq.gz)(j$.started({driveId:e})),r&&function(e){td.setQueryData([tZ.cacheName],((t={})=>(0,T.ZP)(t,(t=>{eZ(e).forEach((e=>{t[e.id]=XY(e)}))}))))}(e))}function*bZ({userId:e}){return{drives:(yield*(0,Wq.RE)(T$,vt(),e)).map(Gl)}}function*TZ({localOnly:e}){const{drives:t,products:n}=yield*(0,Wq.RE)(eY().fetchUserDrives,e);return{drives:t,products:n}}function*wZ({name:e,createProductJson:t,emails:n,logoFile:r,tokenJson:o}){const i=yield*(0,Wq.Ys)(Al);if(void 0===i)throw new Error("Current user id was undefined");const a=yield*(0,Wq.RE)(eY().createUserDrive,{name:e,owner_id:i}),{id:s}=a;void 0!==o&&(yield*(0,Wq.RE)(QK,{userId:i,tokenJson:o}));try{const{product:e,driveWithLogo:o}=yield*(0,Wq.$6)({product:(0,Wq.RE)(Qd,vt(),s,t),driveWithLogo:(0,Wq.RE)(yZ,{driveId:s,logo:r})});return{drive:o||a,product:e,photoAdded:Boolean(r),membersInvitedCount:void 0!==n?n.length:0}}catch(c){throw yield*(0,Wq.RE)(eY().deleteUserDrive,s),c}}function*CZ({params:{emails:e,createProductJson:t,history:n},result:{drive:{id:r,editorInvitesRequireApproval:o}}}){if(void 0!==e&&(yield*(0,Wq.gz)(V$.started({origin:"creation",driveId:r,membershipType:"editor",emails:e,isDriveAdmin:!0,inviterMembershipType:"editor",editorInvitesRequireApproval:o}))),void 0!==n){if(td.removeQueries([tZ.cacheName]),"descript_free"!==t.product_group){const e="descript_creator"===t.product_group?"https://www.descript.com/payment/confirmation/creator":"https://www.descript.com/payment/confirmation/pro",n=new URLSearchParams({billing:t.interval?.toString()??"",seats:t.seats?.toString()??"1",extra_hours:t.extra_hours?.toString()??"0",device:Yt()()?"mobile":"desktop",from_app:W().toString(),promo:t.coupon??""});yield*(0,Wq.gz)(iZ({url:`${e}?${n.toString()}`}))}yield*(0,Wq.RE)((()=>n.push((0,jt.Gn)(pa,{driveId:r}))))}}function*_Z(e){const t=yield*(0,Wq.RE)(yZ,e),n=void 0===t?yield*(0,Wq.Ys)(ru,e.driveId):t;if(!n)throw new Error("Could not find drive");return{drive:n}}function*AZ({driveId:e}){yield*(0,Wq.RE)(eY().deleteUserDrive,e);(yield*(0,Wq.Ys)(uW))===e&&(yield*(0,Wq.gz)(Sn({driveId:void 0})))}function*RZ({params:{driveId:e,history:t}}){if(void 0===t)return;td.refetchQueries([tZ.cacheName]);if((yield*(0,Wq.Ys)(bW)).driveId===e){const e=yield*(0,Wq.Ys)(Xl);yield*(0,Wq.gz)(yn({projectFilter:{driveId:e,workspaceId:void 0}}))}t.push(fa)}function*MZ({driveId:e}){return{invites:yield*(0,Wq.RE)(sK,vt(),e)}}function*DZ({driveId:e,emails:t,membershipType:n}){const r=yield*(0,Wq.Ys)(ou,e),o=new Set(r?.map((e=>e.email))),i=t.filter((e=>!o.has(e)));return{invites:yield*(0,Wq.$6)(i.map((t=>(0,Wq.RE)(dK,vt(),e,t,n))))}}function*OZ({driveId:e,email:t,membershipType:n}){return{invite:yield*(0,Wq.RE)(dK,vt(),e,t,n)}}function*xZ({inviteId:e}){yield*(0,Wq.RE)(uK,vt(),e)}function*kZ({driveId:e,membershipId:t,updates:n}){return{membership:yield*(0,Wq.RE)(w$,vt(),e,t,n)}}function*NZ({params:{driveId:e}}){yield*(0,Wq.gz)(k$.started({driveId:e,fetchOwnerData:!0}))}function*PZ({driveId:e,editorInvitesRequireApproval:t}){yield*(0,Wq.RE)(O$,vt(),e,t)}function*LZ({params:{driveId:e}}){yield*(0,Wq.gz)(k$.started({driveId:e,fetchOwnerData:!1}))}function*FZ({driveId:e,membershipId:t}){yield*(0,Wq.RE)(C$,vt(),e,t);const n=(yield*(0,Wq.Ys)(ru,e))?.name;return{driveName:n,currentUserRemoved:yield*(0,Wq.Ys)(cu,e,t)}}function*UZ({project:{driveId:e}}){const t=yield*(0,Wq.Ys)(tH,e);(yield*(0,Wq.Ys)(_l))&&void 0===t&&(yield*(0,Wq.gz)(W$.started({driveId:e})))}function*BZ({driveId:e,history:t}){void 0!==t&&(td.removeQueries([tZ.cacheName]),yield*(0,Wq.RE)((()=>t.push((0,jt.Gn)(pa,{driveId:e})))))}function*jZ({invite:{inviteObjectId:e},history:t}){yield*BZ({driveId:e,history:t})}function*VZ({drive:e,history:t}){yield*BZ({driveId:e.id,history:t})}function*zZ({driveId:e,font:t}){const n=yield*(0,Wq.Ys)(uu,e);if(!n)return;const r=n.find((e=>e.name===t.name));r?.assetGuid&&(yield*(0,Wq.RE)(D$,{driveId:e,assetGuid:r.assetGuid}),yield*(0,Wq.gz)(nK({driveId:e,fonts:n.filter((e=>e.name!==t.name))})),yield*(0,Wq.gz)(OY({driveId:e})))}function*GZ({driveId:e}){!function(e,t=!0){j()||B()?window.location.href=e?`descriptbc://route/drives/${e}/templates`:"descriptbc://route/templates":window.location.href="https://www.descript.com/download"}(e)}function*WZ(){yield*ZK(k$,SZ),yield*KK(k$.done,IZ),yield*ZK(L$,bZ),yield*ZK(N$,TZ),yield*JK(F$,wZ),yield*KK(F$.done,CZ),yield*ZK(U$,_Z),yield*ZK(B$,AZ),yield*KK(B$.done,RZ),yield*ZK(j$,MZ),yield*ZK(V$,DZ),yield*ZK(z$,OZ),yield*ZK(G$,xZ),yield*ZK(X$,kZ),yield*KK(X$.done,NZ),yield*ZK(tK,PZ),yield*KK(tK.done,LZ),yield*ZK(Z$,FZ),yield*KK(aY,UZ),yield*KK(HY,jZ),yield*KK(fZ,VZ),yield*KK(rK,zZ),yield*KK(oZ,GZ)}const HZ=new(n(92913).Z);function qZ(){const{location:e}=document;if(!e)return"localhost";const t=e.hostname.split(".").reverse().splice(0,2).reverse().join(".");if("localhost"===t)return t;return"."+t}function $Z(){const e=new Date;return e.setDate(e.getDate()+365),e}const KZ={get:e=>HZ.get(e),set:(e,t)=>{HZ.set(e,t,{domain:qZ(),path:"/",expires:$Z(),secure:!0})},delete:e=>{HZ.remove(e,{domain:qZ(),path:"/",secure:!0})},getAll:()=>HZ.getAll()},YZ=KZ,ZZ=(0,pn.ZP)("ANNOTATIONS"),JZ=ZZ("ANNOTATIONS_LOADING"),QZ=ZZ("ANNOTATIONS_LOADED"),XZ=ZZ("COMMENTS_LOADED"),eJ=ZZ("DRAFT_ANNOTATION"),tJ=ZZ("CREATE_ANNOTATION"),nJ=ZZ.async("DELETE_ANNOTATION"),rJ=ZZ("CREATE_COMMENT"),oJ=ZZ.async("DELETE_COMMENT"),iJ=ZZ("EXPAND_ANNOTATION"),aJ=ZZ("COLLAPSE_ANNOTATION"),sJ=ZZ("ADD_ANNOTATION_DRAFT"),cJ=ZZ("ANNOTATION_CREATED"),dJ=ZZ("COMMENT_CREATED"),lJ=ZZ("ARCHIVE_ANNOTATION"),uJ=ZZ("UNARCHIVE_ANNOTATION"),fJ=ZZ("LOAD_ANNOTATIONS"),mJ=ZZ("LOAD_COMMENTS_FOR_COMPOSITION"),pJ=ZZ("ANNOTATIONS_ERROR"),gJ=(0,pn.Jy)("DOCUMENT"),hJ=gJ("SET_SCROLL_TO_INDEX"),vJ=(gJ("PROCEED_WITH_CLIP_TO_COMPOSITION_FROM_SETTINGS"),gJ("SET_SPEAKER_NAME"),gJ("UPDATE_SPEAKER_CONSENT"),gJ("UPDATE_SPEAKER_CONSENT_WITHOUT_AUTOSAVE"),gJ("DELETE_SPEAKERS"),gJ("SET_SYNC_PROJECT_NAME"),gJ("MERGE_SPEAKERS"),gJ("ADD_SPEAKER"),gJ("SET_SPEAKER_COLOR"),gJ("SET_SPEAKER_BACKEND_VOICE_ID"),gJ("SET_SPEAKER_BACKEND_VOICE_STYLES"),gJ("SAVE_DOCUMENT")),EJ=(gJ("SAVE_BACKUP"),gJ.async("SAVE_DOCUMENT_IMMEDIATELY"),gJ("FORCE_SAVE_DOCUMENT")),yJ=(gJ("SET_TRACK_NAME"),gJ("SET_INCLUDE_TRANSCRIPT"),gJ("MOVE_FOLDER_ITEMS"),gJ("ADD_FOLDER")),SJ=(gJ("RENAME_FOLDER"),gJ("REQUEST_REMOVE_FOLDER_ITEMS"),gJ("REQUEST_REMOVE_COMPOSITION_FOLDER_ITEMS"),gJ("REMOVE_FOLDER_ITEMS"),gJ("REMOVE_COMPOSITION_FOLDER_ITEMS"),gJ("UPDATE_ALIGNMENT"),gJ("MANUAL_UPDATE_ALIGNMENT"),gJ("UPDATE_WORD_TAG"),gJ("REMOVE_WORD_TAG"),gJ("SET_ALIGNMENT_FAILED"),gJ("CLEAR_IGNORE_ALIGNMENT"),gJ("INITIATED_LIVE_TRANSCRIPTION")),IJ=(gJ("UPDATE_LIVE_TRANSCRIPTION"),gJ("SET_ROOMTONE")),bJ=gJ("SET_STUDIO_SOUND"),TJ=gJ("SET_STUDIO_SOUND_INTENSITY_ACTION"),wJ=(gJ("SET_CLIP_SPEED"),gJ("SET_CLIP_SPEED_FOR_TIME_RANGE"),gJ("REPLACE_TEXT")),CJ=(gJ("REPLACE_TEXT_ERROR"),gJ("PASTE_MULTITRACK_MEDIA"),gJ("PASTE_MEDIA"),gJ("PASTE_CARD_LAYERS"),gJ("PASTE_ATTRIBUTES"),gJ.async("REPLACE_MEDIA_IN_LAYER"),gJ("DELETE_TIME_RANGE"),gJ("DELETE_TAUS"),gJ("MOVE_TIME_RANGE_IN_SLIP_MODE"),gJ("SET_ACTIVE_SEQUENCE")),_J=gJ("EXTEND_TAU"),AJ=(gJ("EXTEND_TAU_IN_SLIP_MODE"),gJ("TRIM_PIN_TAU"),gJ("SLIP_TAU"),gJ("SLIP_TIME_RANGE"),gJ("CHANGE_TAU_GAIN"),gJ("SET_TAU_GAIN_FOR_TIME_RANGE"),gJ("CHANGE_TAU_VOLUME_EFFECT"),gJ("CHANGE_TAU_FADE"),gJ("SPLIT_CLIP_AT_TIME_OFFSET"),gJ("SPLIT_TRACK_AT_TIME_OFFSET"),gJ("ADD_FREEZE_FRAME_AT_TIME_OFFSET"),gJ("INSERT_GAP_AT_TIME_OFFSET"),gJ("MOVE_CLIP_TO_TIME_OFFSET"),gJ("MOVE_CLIP_TO_TIME_OFFSET_IN_SLIP_MODE"),gJ("SPLIT_AND_MOVE_TIME_OFFSET"),gJ("SET_COMPONENT_END_ANCHOR"),gJ("TOGGLE_BOLD"),gJ("TOGGLE_ITALIC"),gJ("CLIP_TO_COMPOSITION"),gJ("COPY_TEXT_TO_NEW_COMPOSITION"),gJ("SHOW_AUDIO_EFFECT_MODAL"),gJ("CLOSE_AUDIO_EFFECT_MODAL"),gJ("ADD_TRACK_EFFECT"),gJ("UPDATE_TRACK_EFFECT"),gJ("DELETE_TRACK_EFFECT"),gJ("MOVE_TRACK_EFFECT"),gJ("SET_TRACK_EFFECT_DISABLED"),gJ("SET_VIDEO_EFFECT_DISABLED"),gJ("ADD_CLIP_AUDIO_EFFECT"),gJ("SET_SEGMENT_EFFECT"),gJ("SET_SEGMENT_EFFECT_FOR_TAU_IDS"),gJ("DELETE_SEGMENT_EFFECT"),gJ("SET_PARTIAL_POINT_2D_EFFECT"),gJ("SET_AUDIO_SEGMENT_MULTICAM_TRACK"),gJ("SET_MULTICAM_TRACK_IN_TIME_RANGE"),gJ("AUTO_MULTICAM"),gJ("SET_TRACK_MUTED"),gJ("SET_TRACK_SOLOED"),gJ("SET_PAN_TRACK"),gJ("SET_GAIN_TRACK"),gJ("SET_TRACK_DUCKING_PARAMETERS"),gJ("SET_GAIN_SUPERTAU"),gJ("SET_PAN_SUPERTAU"),gJ("CLIP_TO_COMPOSITION_WITH_SETTINGS"),gJ("COPY_HIGHLIGHTS"),gJ("TOGGLE_HIGHLIGHT"),gJ("SET_HIGHLIGHT"),gJ("TOGGLE_SHOWING_WORD_GAP_DURATION_INPUT"),gJ("TOGGLE_IGNORE"),gJ("REMOVE_IGNORED_TEXT"),gJ("SET_HOVERING_INFO")),RJ=gJ("SET_FOCUSED_BLOCKED_TEXT_INFO"),MJ=gJ("SET_REPLACING_INFO"),DJ=(gJ("DELETE_TRACK"),gJ("REQUEST_DELETE_COMPOSITION"),gJ("REQUEST_ADD_TRACK"),gJ.async("ENSURE_ENERGIES_FOR_MEDIA_REFS"),gJ("SET_ENERGIES_FOR_MEDIA_REFS"),gJ("SET_PARTIAL_ENERGIES_FOR_MEDIA_REFS"),gJ("CREATE_SEQUENCE")),OJ=(gJ("CREATE_SEQUENCE_FROM_TAU"),gJ("ADD_SEQUENCE_TRACK"),gJ("MOVE_SEQUENCE_TRACK"),gJ("REMOVE_SEQUENCE_TRACK"),gJ("REFRESH_SEQUENCE_ALIGNMENT"),gJ("ADD_TRACK")),xJ=gJ("RESET_LAST_ADDED_FOLDER"),kJ=(gJ("DUPLICATE_COMPOSITION"),gJ("ADD_INLINE_NOTE"),gJ("ADD_MARKER")),NJ=(gJ("ADD_CUE"),gJ("ADD_STORYBOARD_CUE"),gJ("REMOVE_STORYBOARD_CUE"),gJ("UPDATE_STORYBOARD_CUE_TIME_RANGE"),gJ("UPDATE_STORYBOARD_CUE_KEYFRAME"),gJ("UPDATE_STORYBOARD_CUE_ANIMATION_CURVE"),gJ("UPDATE_CARD_LAYERS_EFFECTS_WITH_STORYBOARD_CUE"),gJ("UPDATE_CARD_LAYER_IS_HIDDEN"),gJ("UPDATE_CARD_LAYERS_IS_LOCKED"),gJ("ADD_PIN_COMPONENT")),PJ=(gJ("MOVE_TIME_RANGE_TO_NEW_PIN"),gJ("MOVE_TAUS_TO_NEW_PIN"),gJ("SET_PIN_FILL_BEHAVIOR"),gJ("FINALIZE_RECORDING_SESSION_TAU"),gJ("INSERT_MEDIA_REFERENCE_TO_RENDERED_LOCATION"),gJ("INSERT_MEDIA_REFERENCE_AT_TAU"),gJ("INSERT_MEDIA_REFERENCE_IN_SLIP_MODE"),gJ("INSERT_MEDIA_REFERENCE_AT_TIME_ELASTIC"),gJ("ADD_CLIP_TO_NEW_TRACK"),gJ.async("APPLY_TEMPLATE_TO_CARD"),gJ.async("INSERT_CARD_FROM_TEMPLATE"),gJ("APPLY_TEMPLATE"),gJ("MOVE_TIME_RANGE"),gJ("MOVE_TAUS_TO_POSITION_REDESIGN"),gJ("MOVE_TAUS_TO_POSITION"),gJ("REQUEST_ADD_OVERDUB_OR_SCRATCH_TEXT"),gJ("REQUEST_REGENERATION"),gJ("REQUEST_REGENERATE_AI_SPEECH"),gJ("ADD_OVERDUB_OR_SCRATCH_TEXT"),gJ("ADD_SCRATCH_TEXT"),gJ("SET_SCRATCH_TEXT_SPEAKER"),gJ("ADD_SPEAKER_AT_LOCATION"),gJ("MOVE_SPEAKER_WITH_PARAGRAPH_INDEX"),gJ("MOVE_SPEAKER_WITH_BLOCK_KEY"),gJ("SET_PARAGRAPH_SPEAKER_LABEL_FOCUS"),gJ("SET_SPEAKER_FOR_PARAGRAPH_INDEX"),gJ("REQUEST_SET_SPEAKER_FOR_PARAGRAPH_INDEX"),gJ("SET_SPEAKER_FOR_PARAGRAPH_BLOCK_KEY"),gJ("MOVE_MARKER"),gJ("ADD_MEDIA_FILES"),gJ("ADD_MEDIA_FILES_TICK"),gJ("ADD_PASTED_MEDIA_FILES"),gJ("ADD_MEDIA_FILES_COMPLETED"),gJ("ADD_MEDIA_FILES_FAILED"),gJ.async("ADD_CLOUD_MEDIA"),gJ("SET_GENERATIVE_MEDIA_REF_VISIBLE"),gJ.async("CALCULATE_DEFAULT_GAIN_FOR_MEDIA_REF"),gJ.async("CALCULATE_DEFAULT_GAIN_FOR_EACH_TAU"),gJ.async("DETECT_MIC_BLEED_FOR_SEQUENCE"),gJ("REVERT_MIC_BLEED_DETECTION_FOR_SEQUENCE"),gJ("REMOVE_TRACK_COMPONENT_AT_LOCATION"),gJ("REMOVE_TRACK_COMPONENT"),gJ.async("COPY_MEDIA"),gJ.async("COPY_SELECTION"),gJ.async("COPY_TAUS"),gJ.async("COPY_MULTITRACK_SELECTION"),gJ.async("CUT_MULTITRACK_SELECTION"),gJ.async("CUT_SELECTION"),gJ.async("CUT_TAUS"),gJ.async("PASTE_AT_SELECTION_ASYNC"),gJ.async("PASTE_ATTRIBUTES_AT_SELECTION_ASYNC"),gJ.async("PASTE_MULTITRACK_ATTRIBUTES_AT_SELECTION_ASYNC"),gJ.async("PASTE_MULTITRACK_AT_SELECTION_ASYNC"),gJ.async("COPY_CARD"),gJ.async("SAVE_CARD_TO_TEMPLATE"),gJ.async("CUT_CARD"),gJ.async("COPY_CARD_LAYER"),gJ.async("CUT_CARD_LAYER"),gJ("NEW_COMPOSITION_TRACK_FROM_REF"),gJ("UPSERT_MEDIA_REFERENCES"),gJ("RENAME_MEDIA_REFERENCE"),gJ("DELETE_MEDIA_REFERENCES"),gJ("SHOW_DELETE_MEDIA_REFERENCE_ERROR_MODAL"),gJ("MEDIA_LIBRARY_REMOVE_MEDIA_REFERENCES"),gJ("EXPORT_MEDIA_REFERENCE"),gJ("SHOW_MERGE_MEDIA_REFERENCES_MODAL"),gJ("MERGE_MEDIA_REFERENCES"),gJ("DETACH_AUDIO_AND_VIDEO"),gJ("DETACH_AUDIO_AND_VIDEO_IN_SEQUENCE_TAU"),gJ("SET_TRACK_VIDEO_METADATA"),gJ("SET_COMPOSITION_TYPE"),gJ("MERGE_ANNOTATIONS")),LJ=(gJ("SET_COMPONENT_TIME_OFFSET"),gJ("SET_COMPONENT_TEXT_OFFSET"),gJ("SET_OFFSET_FROM_ANCHOR"),gJ("SET_PIN_COMPONENT_TIME_ANCHOR"),gJ.async("DIARIZE_MEDIA"),gJ("ADD_DIARIZATION_RESULT"),gJ("ADD_DIARIZATION_TASK_ID"),gJ("REMOVE_DIARIZATION_TASK"),gJ("CHECK_DIARIZATION_TASKS"),gJ("SET_DIARIZATION_WIZARD"),gJ("REQUEST_SET_DIARIZATION_WIZARD"),gJ("SET_SPEAKERS_FROM_DIARIZATION"),gJ("DETECT_SPEAKERS_FOR_PARAGRAPH_BLOCK_KEY"),gJ("SET_PENDING_AI_SPEECH"),gJ.async("CREATE_AI_SPEECH"),gJ("ADD_AI_SPEECH_RESULT"),gJ("REVERT_AI_SPEECH"),gJ("SET_AUDIO_REFERENCE_DEFAULT_SPEAKER_ID"),gJ("REQUEST_SET_TEXT_CORRECTION_RANGE"),gJ("SET_TEXT_CORRECTION_RANGE"),gJ("SET_ACTIVE_WORD_GAP_TAG_INFO"),gJ("TOGGLE_PUNCTUATION"),gJ("TOGGLE_CAPITALIZATION"),gJ("SET_ACTIVE_SCRIPT_TOOL"),gJ("MODIFY_COMPOSITIONS_AND_RANGES"),gJ("CORRECT_COMPOSITIONS_AND_RANGES"),gJ("REMOVE_WORDS_AND_ALIGNMENT_FOR_RANGES"),gJ("DELETE_COMPOSITION_RANGES_PRESERVING_GAPS"),gJ("SHORTEN_COMPOSITIONS_AND_RANGES"),gJ("LENGTHEN_COMPOSITIONS_AND_RANGES"),gJ("UPDATE_DURATION_FOR_RANGE"),gJ("OPEN_MEDIA_AT_PLAYHEAD"),gJ("OPEN_MEDIA_AT_PLAYHEAD_FAILED"),gJ("ADD_TAG_IN_TIME_RANGE"),gJ("FORCE_FIX_ALIGNMENT"),gJ("CLEAR_WORDS"),gJ("COPY_REVISION_CONTENTS_TO_CLIPBOARD"),gJ("SET_AUTOMATICALLY_LEVEL_CLIPS"),gJ("SET_ROOMTONE_ON_GAP_CLIPS")),FJ=gJ("SET_BATCH_PROJECT_ROOMTONE"),UJ=(gJ("SET_TAU_OVERDUB_INFO"),gJ("REQUEST_SLOW_DEBOUNCED_DOC_AI_SPEECH_GENERATION"),gJ("REQUEST_FAST_DEBOUNCED_DOC_AI_SPEECH_GENERATION"),gJ("REQUEST_DOC_OVERDUB_GENERATION_IMMEDIATELY"),gJ("PREPARE_DOC_FOR_OVERDUB"),gJ("REMOVE_UNREFERENCED_OVERDUB_MEDIA"),gJ("CANCEL_INVALID_GENERATING_SPEECH_IN_RANGE"),gJ("CLEANUP_RECORDING_TAUS"),gJ("CONVERT_OVERDUB_TO_NORMAL_AUDIO"),gJ("CONVERT_TEXT_RANGE_TO_NORMAL_AUDIO"),gJ("SHOW_REPORT_AI_SPEECH_ISSUE_MODAL"),gJ.async("FLATTEN_TRACKS"),gJ("UPDATE_TAU_EFFECTS"),gJ("MOVE_LAYER"),gJ("UPDATE_TITLE"),gJ("UPDATE_TEXT_VECTOR"),gJ("UPDATE_WAVEFORM"),gJ("UPDATE_PROGRESS_BAR"),gJ("UPDATE_CLASSIC_PROGRESS_BAR"),gJ.async("DETECT_FILLER_WORDS"),gJ.async("DETECT_TRANSCRIPTION_ERRORS"),gJ("SET_ERROR_DETECTION_TASK_ID"),gJ("SET_CUE_KEYFRAME_OFFSET"),gJ("SET_CUE_KEYFRAME_EFFECT_VALUE"),gJ("SET_CUE_SCRIPT_ANCHORING"),gJ("SET_CUE_TIME_OFFSET"),gJ("REALIGN_TIME_RANGE"),gJ("RESTORE_REMOVED_MEDIA"),gJ("ADD_ROOMTONE_TASK_ID")),BJ=gJ("REMOVE_ROOMTONE_TASK"),jJ=(gJ("CHECK_ROOMTONE_TASKS"),gJ("ASSOCIATE_ROOMTONE")),VJ=gJ("CHANGE_ROOMTONE_GAIN"),zJ=gJ("CHANGE_SEQUENCE_ROOMTONE_GAIN"),GJ=(gJ.async("GENERATE_ROOMTONE"),gJ("TOGGLE_TRACK_ROOMTONE")),WJ=(gJ("INITIATE_CORRECTION_WIZARD"),gJ("REMOVE_WORD_ERROR"),gJ("SET_COMPOSITIONS_CHANGED_SINCE_LAST_PUBLISH"),gJ("SET_COMPOSITION_FILE_METADATA"),gJ.async("DOWNLOAD_GOOGLE_FONT"),gJ.async("ADD_FONTS_TO_PROJECT"),gJ("ADD_FONT_MEDIA_REF_TO_PROJECT"),gJ("ADD_FONT_TO_PROJECT_COMPLETED"),gJ.async("COPY_FONT_FROM_DRIVE"),gJ("NEW_FONT_ADDED"),gJ("UPGRADE_TO_STORYBOARD"),gJ("ADD_CARD_BOUNDARY_AT_TIME_OFFSET"),gJ("ADD_CARD_BOUNDARY_AT_TEXT_LOCATION"),gJ("ADD_DEFAULT_EFFECTS_TO_NEW_LAYER"),gJ("ADD_DEFAULT_EFFECTS_TO_NEW_AUDIO_PIN"),gJ("SET_CARD_NAME"),gJ("SET_CARD_THUMBNAIL_TIME_OFFSET"),gJ("MOVE_CARD_BOUNDARY_TO_TEXT_OFFSET"),gJ("SET_CARD_BOUNDARY_ANCHOR"),gJ("TRIM_CARD_BOUNDARY"),gJ("UPDATE_CARD_BOUNDARY_EFFECTS"),gJ("DELETE_CARD_BOUNDARY_EFFECTS"),gJ("SET_CARD_BOUNDARY_EFFECT_DISABLED"),gJ("ANCHOR_COMPONENT_TO_CARD"),gJ("INSERT_CARD"),gJ("SELECT_CARD")),HJ=(gJ("SELECT_CARD_AT_PLAYHEAD"),gJ("MOVE_CARD_ACTION"),gJ("SELECT_CARD_LAYER_AT_PLAYHEAD"));gJ("SELECT_CARD_LAYER"),gJ("CREATE_CARD_LAYER"),gJ("DUPLICATE_CARD_LAYER"),gJ("DELETE_CARD_LAYER");gJ("ADD_CARD_LAYERS_EFFECT"),gJ("UPDATE_CARD_LAYERS_EFFECTS"),gJ("TOGGLE_CARD_LAYERS_EFFECT_ENABLED"),gJ("FORCE_CARD_LAYERS_EFFECT_DISABLED"),gJ("DELETE_CARD_LAYERS_EFFECT"),gJ("MOVE_CARD_LAYER_EFFECT"),gJ("MOVE_CARD_BOUNDARY_EFFECT"),gJ("MOVE_SCRIPT_TO_PIN"),gJ("TRANSCRIBE_AND_MOVE_PIN_TO_SCRIPT"),gJ("MOVE_PIN_TO_SCRIPT"),gJ("SWAP_CARD_LAYER_SOURCE"),gJ("RESET_CARD_LAYERS"),gJ("DELETE_CARD_BOUNDARY"),gJ("DELETE_CARD_WITH_SCRIPT"),gJ("SET_PROJECT_THUMBNAIL"),gJ("DELETE_CARD_BEFORE_BOUNDARY"),gJ("DELETE_CARD_AFTER_BOUNDARY"),gJ.async("PASTE_CARD_LAYER_ATTRIBUTES"),gJ("REORDER_CARD_LAYERS"),gJ("REORDER_CARD_LAYERS_RELATIVE"),gJ("REORDER_CARD_LAYERS_WITH_SOURCE_TRACK_ID"),gJ("SET_CARD_FADE"),gJ("APPLY_LAYER_EFFECTS_TO_ALL_CARDS"),gJ("ADD_PIN_LAYER_COMPLETED_ACTION"),gJ("SET_WORDLESS_MEDIA"),gJ("TOGGLE_WORDLESS_MEDIA"),gJ("SET_TTS_SPEAKER_BLOCKS"),gJ("HOVER_TIMELINE_TRACK"),gJ("HOVER_TIMELINE_SEGMENT"),gJ("HOVER_TIMELINE_CLIP"),gJ("INSERT_FILE_INTO_SCRIPT");const qJ=em("getAnnotationSetCache");function $J(e){const t=new Set;for(const n of e)for(const{attribute:e}of n.text.attributes)e.name===Gu.Annotation&&t.add(e.value);return t}function KJ(e,t,n){const r=new Set,o=vk(e,t),i=n.filter((e=>e.sceneId===o.id)),a=function(e,t){return qf($J,sm(e,t),qJ,bP(e,t))}(e,t),s=new Map;function c(e,t,n,o){let i=s.get(t);i||(i=[],s.set(t,i)),i.push({attribute:Tf(e),range:Gs.get(n,o)}),r.add(e)}const d=bP(e,t);i.forEach((n=>{if(a.has(n.id))return void r.add(n.id);const i=n.segmentTextOffsetLocation;let s=n.segmentTextOffsetLength,l=!1,u=0;for(const t of d){const r=PP(e,o.id,t.id),a=r.string.length;if(u+a>i){let e=Math.max(0,i-u);const o=r.string;let a=e-1,d=o.charAt(a);if(e<o.length-1&&d&&bs.contains(d));else{for(;a>=0&&(d=o.charAt(a),!d||!bs.contains(d));)s+=1,a-=1;e=a+1}let f=s;if(e+f>t.text.string.length&&(f=t.text.string.length-e),c(n.id,t.id,e,f),l=!0,s-=f,s<=0)break}u+=a}if(!l){const r=AP(e,t);r&&r.text.string.length>0&&c(n.id,r.id,r.text.string.length-1,1)}}));const l=hu(d,(e=>{let t=Om(e.text,(({attribute:e})=>e.name!==Gu.Annotation||r.has(e.value)));const n=s.get(e.id);return n&&(t=Mm(t,n)),jM(e,t)}));return l===d?e:Cx(e,t,xx(Lx(e,t),l))}function YJ(e){return e.annotations.isDraftingAnnotation}function ZJ(e,t){return e.annotations.expandedAnnotationIds.has(t)}function JJ(e){return e.annotations.annotations}const QJ=(0,el.createSelector)((e=>e.annotations.comments),(e=>Object.fromEntries([...e.entries()].map((([e,t])=>[e,[...t.values()]])))));function XJ(e,t=e.project.activeProjectId){return!!t&&!0===e.annotations.annotationsLoaded.get(t)}const eQ=(0,el.createSelector)([JJ,(e,t)=>t],((e,t)=>{const n=e.get(t)?.values();return Tu(n?Array.from(n):void 0)})),tQ=(0,el.createSelector)([function(e){return e.annotations.archivedAnnotations},(e,t)=>t],((e,t)=>{const n=e.get(t)?.values();return Tu(n?Array.from(n):void 0)})),nQ=(0,el.createSelector)([eQ,tQ],((e,t)=>[...e,...t])),rQ=(0,el.createSelector)([(e,t,n)=>n,eQ],((e,t)=>t.filter((t=>t.sceneId===e)))),oQ=(0,el.createSelector)([(e,t,n)=>n,tQ],((e,t)=>t.filter((t=>t.sceneId===e)))),iQ=(0,el.createSelector)([rQ,oQ],((e,t)=>[...e,...t])),aQ=(0,el.createSelector)([MW,(e,t,n)=>n],((e,t)=>{const n=new Map;for(const{tauId:r,annotations:o}of function*(e,t){const{tausData:n}=GV(e,t).tausAndDataBasic();for(const{annotations:r,tau:o}of n)r&&(yield{tauId:o.id,annotations:r})}(e,t))for(const{attribute:i,range:a}of o){const o=i.value;n.get(o)||n.set(o,FP(e,t,r)+$P(e,t,r,a.location))}return n}));function sQ(e,t){return nQ(e,t).reduce(((e,{sequenceNumber:t})=>t>e?t:e),0)}const cQ=(0,Yl.createCachedSelector)(((e,t)=>e.annotations.comments.get(t)),(e=>e&&0!==e.size?Array.from(e.values()).sort((({createdAt:e},{createdAt:t})=>e.getTime()-t.getTime())):void 0))(((e,t)=>t)),dQ=(0,el.createSelector)([e=>e.ui.selectedAnnotationIds],(e=>e?e.values().next().value:void 0)),lQ=(0,el.createSelector)([JJ,(e,t)=>t,dQ],((e,t,n)=>n?e.get(t)?.get(n):void 0));function uQ(e,t){return e.ui.selectedAnnotationIds?.has(t)||!1}function fQ(e,t){return e.ui.hoveringAnnotationIds?.has(t)||!1}function mQ(e,t){return e.ui.visibleTextFormAnnotationId===t}function*pQ({payload:{projectId:e}}){if(!(yield*(0,Wq.Ys)(XJ)))return;const t=yield*(0,Wq.Ys)(eQ,e);t&&(yield*(0,Wq.gz)(PJ({projectId:e,annotations:t})))}function*gQ(){yield*function*(e,t){yield*(0,Wq.ib)(e.map((({type:e})=>e)),t)}([SY,QZ,sJ,lJ,pJ,uJ],pQ)}function*hQ(){for(const e of Object.values(r))for(const t of Object.values(e))vQ(t)&&(yield t)}function vQ(e){const t=e;return!(!t||"object"!==typeof t)&&Boolean("string"===typeof t.key&&"function"===typeof t.get&&"function"===typeof t.set&&"function"===typeof t.isSet&&"function"===typeof t.clear&&"function"===typeof t.getDefault)}const EQ=new Set,yQ="setting-updated";class SQ{constructor(){this.emitter=new dH.EventEmitter,this.validKeys=new Set,this.storage={},this.updateAll=()=>{for(const{key:e}of hQ())this.updateFromStore(e,window.localStorage.getItem(e)),this.validKeys.add(e)},this.get=e=>this.storage[e],this.set=(e,t)=>{P()(this.validKeys.has(e),`Unknown setting key: ${e}`),void 0!==t?(this.storage[e]=t,window.localStorage.setItem(e,JSON.stringify(t)),this.emitter.emit(yQ,{key:e})):this.delete(e)},this.delete=e=>{delete this.storage[e],window.localStorage.removeItem(e),this.emitter.emit(yQ,{key:e})},this.getAll=()=>this.storage,this.updateAll(),window.addEventListener("storage",(({key:e,newValue:t})=>{e&&this.validKeys.has(e)&&(this.updateFromStore(e,t),this.emitter.emit(yQ,{key:e}))}))}updateFromStore(e,t){if(t)try{this.storage[e]=JSON.parse(t)}catch(n){EQ.has(e)||(Ra(n,"local-storage-get-parse",{category:Oa.AppSettings,extra:{key:e,value:t}}),EQ.add(e))}else delete this.storage[e]}}const IQ=[{number:1,exec:async()=>{!function(e){for(const t of hQ())if(t.isSet(e)){const n=t.get(e);t.set(n)}}(YZ)}},{number:2,exec:async()=>{const e=ir.installId;for(const t of hQ())t!==e&&t.clear(YZ)}},{number:3,exec:async()=>{if(!ir.installId.isSet()){const e=ir.installId.get(Jt.instance);ir.installId.set(e)}}}];async function bQ(e){Yn.latest.get()>=e.number||(await e.exec(),Yn.latest.set(e.number))}const TQ="sign_up";async function wQ(e,t,n){if(n)window.location.href=ja(Jt.authInstance,JSON.stringify({href:t$}));else{fi("Load authorizationUrl (web-share)");let e=Ua.login;const t=new URL(window.location.href);t.searchParams.has(TQ)&&("true"===t.searchParams.get(TQ)&&(e=Ua.signUp),t.searchParams.delete(TQ)),window.location.href=await Ba(Jt.authInstance,JSON.stringify({href:window.location.href}),e)}}async function CQ(e,t="me"){const n=await Rc(e,si.GET,`/users/${t}`);return bl.fromJson(n)}async function _Q(e,t="me"){const n=await async function({fetchFn:e,shouldFetchNextPage:t,initialOutput:n,reducer:r}){let o=0,i=n;for(;;){const n=await e({limit:500,offset:o});if(i=r(i,n),o+=500,!t(n,500))break}return i}({fetchFn:({offset:n,limit:r})=>async function(e,{userId:t="me",limit:n=1e3,offset:r=0}={}){const o=await Rc(e,si.GET,`/users/${t}/ownerships`,{limit:n,offset:r});let i=[];return o.ownerships&&(i=o.ownerships.map(Sl.fromJson)),[i,f$(o.projects)]}(e,{offset:n,limit:r,userId:t}),shouldFetchNextPage:([e],t)=>e.length===t,initialOutput:[[],[]],reducer:(e,t)=>[[...e[0],...t[0]],[...e[1],...t[1]]]});return[Su(n[0],(({id:e})=>e)),Su(n[1],(({project:{id:e}})=>e))]}async function AQ(e,t="me"){try{return await Rc(e,si.GET,`/users/${t}/card`)}catch(n){if(404===n.statusCode)return await Promise.resolve(void 0);throw n}}async function RQ(e,t){try{return await Rc(e,si.GET,"/users/lookup",{email:t.trim()})}catch(E0){if(404===E0.statusCode)return await Promise.resolve(void 0);throw E0}}async function MQ(e,t="me",n){const r=await Rc(e,si.PUT,`/users/${t}`,void 0,n);return bl.fromJson(r)}async function DQ(e,t){return await Rc(e,si.DELETE,`/users/${t}`),!0}async function OQ(e,t="me",n){return await Rc(e,si.POST,`/users/${t}/card`,void 0,n)}async function xQ(e,t="me"){try{const n=await Rc(e,si.GET,`/users/${t}/data_consent`,void 0);return{isOptedIn:n.is_opted_in||!1,hasResponded:n.has_responded||!1,canRetry:n.can_retry||!1}}catch(n){if(404===n.statusCode)return await Promise.resolve(void 0);throw n}}async function kQ(e,t="me",n){const r=await Rc(e,si.POST,`/users/${t}/data_consent`,void 0,{is_opted_in:n});return{isOptedIn:r.is_opted_in||!1,hasResponded:r.has_responded||!0,canRetry:!1}}async function NQ(e,t="me"){return await Rc(e,si.GET,`/users/${t}/diagnostic_write_credentials`)}async function PQ(e,t="me"){await Rc(e,si.POST,`/users/${t}/request_change_password_email`)}async function LQ(e){return(await Rc(e,si.GET,"/users/create_customer_portal_session"))?.url}async function FQ(e,t="me"){const n=await Rc(e,si.GET,`/users/${t}/auth_identities`);return{canChangeEmail:n.canChangeEmail,changeEmailHint:n.changeEmailHint,canAddUsernamePassword:n.canAddUsernamePassword,identities:n.identities.map((e=>({id:e.id,displayName:e.displayName,canChangePassword:e.canChangePassword,canRemove:e.canRemove})))}}async function UQ(e,{userId:t,authIdentityId:n}){return{authIdentityId:(await Rc(e,si.DELETE,`/users/${t}/auth_identities/${n}`)).id}}async function BQ(e,t="me"){return(await Rc(e,si.GET,`/users/${t}/authorized_clients`)).map((e=>({id:e.client_id,name:e.client_name})))}async function jQ(e,t,n){return{clientId:(await Rc(e,si.DELETE,`/users/${t}/authorized_clients/${n}`)).client_id}}async function VQ(e,t,n,r){const o={content_type:n,filename:r};return await Rc(e,si.GET,`/users/${t}/upload_file`,o)}async function zQ(e){const{jwt:t}=await Rc(e,si.GET,"/users/me/zendesk_chat_token");return t}async function GQ(e){return await Rc(e,si.GET,"/email_subscriptions/groups")}async function WQ(e,t){const{subscription_groups:n}=await Rc(e,si.GET,`/email_subscriptions/${encodeURIComponent(t)}`);return n}async function HQ(e,{email:t,subscriptionGroups:n}){const{subscription_groups:r}=await Rc(e,si.PUT,`/email_subscriptions/${encodeURIComponent(t)}`,{},{subscription_groups:n});return r}async function qQ(e,t,n){const{subscription_groups:r}=await Rc(e,si.GET,`/email_subscriptions/${encodeURIComponent(t)}/no_session`,{token:n});return r}async function $Q(e,{email:t,subscriptionGroups:n,token:r}){const{subscription_groups:o}=await Rc(e,si.PUT,`/email_subscriptions/${encodeURIComponent(t)}/no_session`,{},{subscription_groups:n,token:r});return o}const KQ={id:"no-id",email:"anonymous@descript.com"},YQ=em("alignmentAssetsMetadataCache");function ZQ(e,t,n){const r=`${e}:${t}`,o=YQ.get(r);if(o&&o.url===n.url)return o}function JQ(e,t,n,r,o){const i=`${e}:${t}`,a={url:n.url,decoded:r,encoded:o};YQ.set(i,a)}async function QQ(e,t,n,r){const{serializedDoc:o,alignmentAssetsMetadata:i,unchangedAlignmentAssetKeys:a,...s}=tX(t,n);await async function(e,t,n,r,o){if(0===n.length)return;if(!t)throw new Error("Could not load base revision assets (no base revision!)");const{contents:{assets:i},revisionId:a}=t;if(!i)throw new Error(`Could not load base revision assets for ${a}`);for(const s of n){const t=i[s];if(!t)throw new Error(`Could not load base revision asset for ${a} / ${s}`);const n=ZQ(e,s,t);r[s]={encoded:n?.encoded??await o(a,t,s),decoded:n?.decoded}}}(e,t,a,i,r);for(const c of Object.keys(i)){if(i[c].decoded)continue;const t=s.assets[c];if(!t)continue;const n=ZQ(e,c,t);n&&(i[c]={encoded:n.encoded,decoded:n.decoded})}return function(e,t,n){const{callback:r,spanOptions:o,ctx:i,userCancellationAbortController:a,errorStatus:s}=At(t,n),c=yt(e,o,i);try{r(c)}catch(d){throw a?.signal?.aborted?wt(c.span):Tt(c.span,d,s),d}finally{c.span.end()}}(yc,{ctx:vt(),errorStatus:bt.dataLoss,attributes:{[It.metricName]:yc,[It.appProjectId]:e}},(()=>function(e,t,n,r,o,i,a,s){try{cX(e,t,r,o,i)}catch(c){try{a(n),s(c)}catch(d){}throw c}}(e,t,n,o,i,s.assets,PG,(t=>{Ra(t,"model-3-validation-error",{category:Oa.Model3,extra:{project_id:e}})})))),function(e,t){try{for(const{url:e,quality:n}of Object.values(t))sX(e),n&&n.original&&sX(n.original.url),n&&n.preview&&sX(n.preview.url)}catch(E0){throw function(e,t,n){return Ra(e,"save-corrupted",{category:Oa.CreateRevision,extra:{assets:t,previousRevisionNumber:n&&n.revisionNumber,previousRevisionId:n&&n.revisionId}}),Ai(e,$i.DocumentSaveCorrupted)}(E0,t,e)}}(t,s.assets),s}function XQ(e){return e&&aE(e.url)}function eX(e,t){return function(e,{format:t,coder:n}){if(t===Hz.InMemory){const r=PG(e),o={...e,validity:r,mediaLibrary:y_(e.mediaLibrary,n),documentVersion:$z,format:t,clientId:rG.ClientId,clientName:rG.ClientName,clientOS:rG.OperatingSystem};return n.encodeReferencables(e.voices),o}return{...fG(e,n),format:t}}(e,{coder:t,format:Hz.InMemory})}function tX(e,t,n,r=!1,o=!1){const i={},a=e&&e.contents.assets||{},s={...n},c=[],d=[],l=new pE({[PL]:r,[LL]:o}),u=nE("document",".json"),f=rX(eX,t,e,l);for(const m of t.mediaLibrary.mediaRefs){const{assetKey:t,voiceover:n,assetJson:u}=m;if(u&&!o&&(i[t]=mE(u)),n&&!r){const r=sE(t),o=n.metadata.assetJson;i[r]=o;const u=XQ(o);if(u!==XQ(a[r])){const{serialized:t,json:o}=rX(lF,n,e,l);s[r]={encoded:t,decoded:n.metadata},d.push({assetKey:r,assetFilename:u,payload:o})}else c.push(r)}}for(const m of Ik(t)){const e=m.timeline.superTau.bouncedMediaRef;if(e){const{assetJson:t,assetKey:n}=e;t&&!o&&(i[n]=mE(t))}}return{content:{assetKey:"content.json",assetFilename:u,payload:f.json},assets:i,alignmentToUpload:d,serializedDoc:f.serialized,alignmentAssetsMetadata:s,unchangedAlignmentAssetKeys:c}}function nX(e){return Array.from(Qa(Ik(e),(({id:t,name:n,videoMetadata:r})=>({id:t,name:n,duration:Ak(e,t),media_type:r?"video":"audio"}))))}function rX(e,t,n,r){try{const n=e(t,r);return{serialized:n,json:JSON.stringify(n)}}catch(E0){throw oX(E0,n)}}function oX(e,t){return Ra(e,"save-corrupted",{category:Oa.CreateRevision,extra:{previousRevisionNumber:t&&t.revisionNumber,previousRevisionId:t&&t.revisionId}}),Ai(e,$i.DocumentSaveCorrupted)}function iX(e,t){const n=aE(t);return t===rE(n)?l$(e,n):t}function aX(e,t,n,r,o){const i=new gE(e,r,o),a=vG(n,{coder:i});return function(e,t,n,r){for(const o of t.mediaRefs)if(o.voiceover?.metadata){const t=sE(o.assetKey),i=n[t],a=r[t];n&&a&&JQ(e,t,i,o.voiceover.metadata,a.encoded)}}(e,a.mediaLibrary,o,r),{doc:a,missingAssetMetadata:i.missingAssetMetadata,missingAssetJsons:i.missingAssetJsons}}function sX(e){new URL(e)}function cX(e,t,n,r,o){const i=`tmp-decode-${e}`;try{aX(i,0,n,r,o)}catch(a){throw oX(a,t)}finally{!function(e){for(const[t,n]of Xf.entries()){const[t,r]=tm(n,(t=>t.startsWith(e)))}}(i)}}async function dX(e,t,n){const r={bounce_if_needed:!0,content_format_version:2,include_encoded_assets:!W()};return Qq(t,await Rc(e,si.GET,`/projects/${t}/revisions/${n}`,r))}async function lX(e,t,n,r){if(!qq(n))return{};const o=await $q(e,iX(t,r.url)),i=await fetch(o);return{[n]:await i.json()}}async function uX(e,t,n){try{const r={content_format_version:2},o=await GH(e,{projectId:t}),i=await Rc(e,si.POST,`/projects/${t}/revisions`,r,function({revisionId:e,message:t,bundleVersion:n,contents:r,baseRevisionId:o,forceSave:i,compositionSummaries:a,isLateRevision:s}){return{id:e,message:t,bundle_version:n,contents:{content_url:r.content_url,content:{...r.content,url:r.content_url},assets:r.assets,json:{}},default_scene_analysis:{},base_revision_id:o,force_save:i,composition_summaries:a,is_late_revision:s}}({...n,isLateRevision:zH(o)})),a=Qq(t,i);if(a.revisionId!==n.revisionId)throw new Oc("malformed response from server for createRevision",500);return{...a,baseRevisionId:n.baseRevisionId,forceSave:n.forceSave}}catch(r){if(ji(r)&&409===r.statusCode&&r.json.data&&r.json.data.conflict){let e;try{e=r.json.data.conflict}catch(o){throw Ma(o),r}throw new Ki(t,{...Qq(t,e),baseRevisionId:n.baseRevisionId,forceSave:n.forceSave})}throw Ma(r),r}}A.logging.groupLogger("descriptmodel/dataref");function fX(e,t){if(void 0!==e)return{type:"local-file",pathname:e,size:t}}const mX=A.logging.groupLogger("descriptmodel/fetchutils");function pX(e,t){return{Range:`bytes=${e}-${t-1}`}}class gX extends Error{constructor(){super(...arguments),this.name="NetworkError"}}async function hX(e,t){let n;try{n=await fetch(e,t)}catch(r){const t="TypeError"===r.type?r.message:String(r);throw new gX(`${t} from ${function(e){try{const t=new URL(e).origin;if(!t||"null"===t)throw new Error(`invalid url origin: ${e}`);return t}catch(r){return`(invalid url ${t=String(e),n=100,t.length>n?`${t.slice(0,n-3)}...`:t})`}var t,n}(e)}`)}if(!n.ok)throw new gX(`${n.status} fetching from ${new URL(n.url).host}`);return n}const vX=A.logging.groupLogger("descriptmodel/datareffetch");async function EX(e,t){"string"===typeof e&&(e=new URL(e));const n=await hX(e,{headers:t?pX(t[0],t[1]):{}});let r=await n.blob();t&&(function(e,t){const n=e.headers.get("Content-Range");if(!n){if(206===e.status)return mX.warn(`Server returned 206 without Content-Range header (maybe CORS): ${e.url}`),{supportsRangeRequests:!0,contentLength:void 0};const t=e.headers.get("Content-Length");return t?{supportsRangeRequests:!1,contentLength:parseInt(t,10)}:{supportsRangeRequests:!1,contentLength:void 0}}const r=n.match(/^\s*bytes\s*(\d+)-\d+\s*\/\s*(\d+)\s*$/);P()(r,`Invalid Content-Range header: ${n}`);const[,o,i]=r,a=parseInt(o,10),s=parseInt(i,10);return P()(a===t,`Server returned unexpected range: ${n}`),{supportsRangeRequests:!0,contentLength:s}}(n,t[0]).supportsRangeRequests||(vX.warn(`Server does not support range requests: ${n.url}`),r=r.slice(t[0],t[1])));const o=n.headers.get("content-type")??r.type;return new File([r],(0,at.basename)(e.pathname),{type:o})}var yX=n(58276);const SX=(0,pn.ZP)("PROJECT_MEDIA"),IX=SX("ASSET_SAVING_PROGRESS_CHANGED"),bX=(SX("ASSET_JSON_UPDATE"),SX("ASSET_CONVERSION_FAILED")),TX=(SX("ASSET_DOWNLOAD_COMPLETED"),SX("ASSET_UPLOAD_COMPLETED"),SX("ASSET_UPLOAD_FAILED"),SX("BOUNCE_AUDIO_IN_PROGRESS")),wX=(SX("POLL_FOR_BOUNCED_AUDIO"),SX("REQUEST_SHOW_PROJECT_SETTINGS_MODAL"),SX("REQUEST_HIDE_PROJECT_SETTINGS_MODAL"),SX.async("CREATE_PROXY_FILE"),SX("GET_PROJECT_ASSET_QUALITY"),SX("GET_PROJECT_ASSET_QUALITY_SUCCEEDED")),CX=(SX("UPDATE_PROJECT_ASSET_QUALITY"),SX("MEDIA_LIBRARY_ASSET_CREATED"),SX("MEDIA_LIBRARY_ASSET_UPDATED"),SX("MEDIA_LIBRARY_ASSET_ADDED_TO_PROJECT"),SX("MEDIA_LIBRARY_PROXY_GENERATION_STARTED")),_X=SX("MEDIA_LIBRARY_PROXY_GENERATION_FINISHED"),AX=SX("MEDIA_LIBRARY_PROXY_GENERATION_FAILED"),RX=(SX("MEDIA_LIBRARY_ARTIFACT_CREATED"),SX("MEDIA_LIBRARY_ARTIFACT_UPDATED")),MX=SX("MEDIA_LIBRARY_ARTIFACT_FILE_UPLOAD_STARTED"),DX=SX("MEDIA_LIBRARY_ARTIFACT_FILE_UPLOAD_PROGRESS"),OX=SX("MEDIA_LIBRARY_ARTIFACT_FILE_UPLOAD_FINISHED"),xX=SX("MEDIA_LIBRARY_ARTIFACT_FILE_UPLOAD_FAILED");SX("MEDIA_LIBRARY_ARTIFACT_FILE_DOWNLOAD_STARTED"),SX("MEDIA_LIBRARY_ARTIFACT_FILE_DOWNLOAD_PROGRESS"),SX("MEDIA_LIBRARY_ARTIFACT_FILE_DOWNLOAD_FINISHED"),SX("MEDIA_LIBRARY_ARTIFACT_FILE_DOWNLOAD_FAILED"),SX("MEDIA_LIBRARY_ASSETS_FETCHED");let kX;function NX(){if(!kX)throw new Error("No MediaLibrarian set");return kX}PX=function(e){return e.reduce(((e,t)=>(e[t]=!0,e)),{})}(["createAsset","createWebProxy","copyAssetFromDrive","copyAssetsFromProjectBatch","updateAssetMetadata","createArtifact","updateArtifactMetadata","downloadArtifactFile","setAssetDownloadPriorities","listByProject","listByAsset","syncMetadata","getArtifactSegmentList","getArtifactReadUrl","getArtifactSegmentReadUrl","getMtsVideoPlaylist","getMtsAudioPlaylist","getMtsImage","getAssetForHandle","getMediaLibraryArtifact","getPreferredMediaLibraryArtifact","getTranscriptionReadyArtifact","loadAllLocalMetadata","loadLocalMetadata","vacuumUnusedAssets"]),Object.keys(PX);var PX;const LX=void 0!==Blob.prototype.arrayBuffer?e=>e.arrayBuffer():function(e){return new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{const e=r.result;e instanceof ArrayBuffer?t(e):n(new Error("unexpected result type"))},r.onerror=n,r.readAsArrayBuffer(e)}))};async function FX(e){const t=new(FO().ArrayBuffer);try{for await(const n of async function*(e,t=2097152){if(t<=0)return void(yield await LX(e));let n=0;const r=e.size;for(;n<r;){const o=n+t;yield await LX(e.slice(n,Math.min(o,r))),n=o}}(e))t.append(n);return t.end()}finally{t.destroy()}}const UX=new Map;let BX=0;const jX={putFile(e){const t=String(BX);return UX.set(t,e),BX+=1,t},popFile(e){const t=UX.get(e);if(t)return UX.delete(e),t;throw new Error(`No file for key ${e}`)},getFileExtension(e){const t=e.name.split(".");if(t.length<=1){const t=nn[e.type];return t?t[0]:""}return t[t.length-1]},async inferAssetType(e){try{const t=await EZ(e);return t.startsWith("audio/")?"audio":t.startsWith("video/")?"video":t.startsWith("image/")?"image":"unknown"}catch(E0){Ra(E0,"web-file-mime-type",{category:Oa.GlobalAssetSync})}return"unknown"},getMd5HashForFile:async e=>await FX(e)};function VX(e,t,n){const r=Date.now(),o=(0,Zt.Z)();return rt("project_sync_uploading",{project_id:e,revision_id:t,upload_id:o,editor_open:!0,restore_revision:n}),function(n){let i;var a,s;n&&(i="Unknown Error",n.toString&&(i=n.toString()),"[object Object]"===i&&(i=JSON.stringify(n))),rt("project_sync_completed",{project_id:e,revision_id:t,upload_id:o,error:i,editor_open:!0,status:n?(s=n,s instanceof Ki||s.name===$i.Conflict?"conflict":"failed"):"success",upload_time:(a=Date.now()-r,Number((a/1e3).toFixed(a<100?3:1)))})}}class zX{async fetchMeUser(){return await CQ(vt())}async fetchMeUserLocal(){}async updateMeUser(e){return await MQ(vt(),void 0,e)}async fetchUserDrives(e){if(e)throw new Error("WebDataManager.fetchUserDrives does not support localOnlyParameter");const t=(await T$(vt(),"me")).map(Gl),n=await Promise.all(t.map((async({id:e})=>({driveId:e,product:await Jd(vt(),e)})))),r={};for(const{driveId:o,product:i}of n)void 0!==i&&(r[o]=i);return{drives:t,products:r}}async fetchDrive(e){return await async function(e,t){try{return Gl(await Rc(e,si.GET,`/drives/${t}`))}catch(n){if(404===n.statusCode)return await Promise.resolve(void 0);throw n}}(vt(),e)}async createUserDrive(e){return await async function(e,t){return Gl(await Rc(e,si.POST,"/drives",void 0,t))}(vt(),e)}async updateUserDrive(e,t){return await async function(e,t,n){return Gl(await Rc(e,si.PUT,`/drives/${t}`,void 0,n))}(vt(),e,t)}async deleteUserDrive(e){}async fetchProject(e,t){if(t)throw new Error("WebDataManager.fetchProject does not support localOnly parameter");return await a$(vt(),e)}async hasOwnershipsOnDisk(){return!1}async fetchOwnerships(e){if(e)throw new Error("WebDataManager.fetchOwnerships does not support localOnly parameter");const[t,n]=await _Q(vt(),"me");return t}async fetchOwnershipsAndProjects(e){if(e)throw new Error("WebDataManager.fetchOwnershipsAndProjects does not support localOnly parameter");const[t,n]=await _Q(vt(),"me"),r=await async function(e,t="me"){return await Rc(e,si.GET,`/users/${t}/driveIds`)}(vt()),o=(await Promise.all([m$(vt()),...r.map((e=>async function(e,t){const n=[];let r,o=!0;for(;o;){const i=await Rc(e,si.GET,`/drives/${t}/projects/paginated`,{filter:I$.Templates,folder_id:Gn,sort:b$.Name,sort_direction:"asc",after:r});n.push(...f$(i.projects)),o=i.has_more,r=i.has_more?i.cursors.after:void 0}return n}(vt(),e)))])).flat();n.push(...o);const i=n.map((({project:e,revisions:t})=>({project:e,revisionSummary:u$(t)})));return[t,i]}async fetchRevision(e,t){return await dX(vt(),e,t)}async hasRevisionsMetadata(e,t){const n={};for(const r of Object.keys(e))n[r]=!1;return n}async fetchRevisionContentAndAssetsMetadata(e,t,n){const r=await dX(vt(),e,t),o=await async function(e,t){const n=function(e){return void 0===e.contents.content?e.contents.content_url:e.contents.content.url}(t);try{const t=await $q(e,n),r=await fetch(t);return await r.json()}catch(r){const o=t.contents.content&&t.contents.content.copied_from_url;if(void 0===o||o===n)throw r;const i=await $q(e,o),a=await fetch(i);return await a.json()}}(vt(),r),i=Object.keys(r.contents.assets).filter(qq),a=await async function(e,t,n,r){const o={};for(const i of n){const n=t[i],a=void 0!==n?ZQ(e,i,n):void 0;if(a)o[i]={encoded:a.encoded,decoded:a.decoded};else{const e=await r(i);e&&(o[i]={encoded:e})}}return o}(e,n,i,(async t=>(await lX(vt(),e,t,r.contents.assets[t]))[t]));return{content:o,cachedAssetsMetadata:a}}async downloadRevisionContentAndAssetsMetadata(e,t,n,r){}async cancelRevisionDownload(e,t){}async downloadOriginalAsset(e,t,n){return!1}async cancelOriginalAssetDownload(e,t,n){}async addMediaAsset({projectId:e,displayName:t,fileRef:n,mediaMetadata:r,source:o,sourceProvider:i}){if(!(n instanceof File))throw new Error("WebDataManager.addMediaAssets only works with File objects");const a=lE(n.name);return{assetJson:await NX().uploadFileToNewAsset(vt(),{projectId:e,displayName:tv(t),file:n,legacyFilename:a,mediaMetadata:r,source:o,sourceProvider:i}),originalDataRef:(s=n.path,"string"===typeof s?fX(s):{type:"blob",file:s})};var s}async uploadJson(e,{assetFilename:t,payload:n,assetKey:r},o){const i=ic(n);return{url:await this.uploadFile(e,"application/json",n,t,o?(t,n)=>o(IX({projectId:e,assetKey:r,name:"Project Data",quality:void 0,state:"uploading",size:i,progress:n})):void 0),size:i}}async uploadFile(e,t,n,r,o){const{signed_url:i}=await d$(vt(),e,t,r);return await async function(e,t,n,r){return await new Promise(((o,i)=>{const a=new XMLHttpRequest;if(r){const t=t=>{if(t.lengthComputable){const n=Math.round(100*t.loaded/t.total);r(e,n)}};a.upload.addEventListener("progress",t)}const s=()=>{const e=new Error("Upload failed");i(e)};a.upload.addEventListener("error",s),a.upload.addEventListener("abort",s),a.onreadystatechange=()=>{const{readyState:e,status:t}=a;4===e&&(200===t?o(!0):s())},a.onerror=e=>{const t=new Error("Upload failed: "+e);i(t)},a.open("PUT",e),a.setRequestHeader("Content-Type",n),a.setRequestHeader("Cache-Control","max-age=31536000"),a.send(t)}))}(i,n,t,o),l$(e,r)}async createRevision(e,t,n,r,o,i,a){const s=VX(e,t);try{const{content:c,assets:d,alignmentToUpload:l}=await QQ(e,n,i,(async(t,n,r)=>(await lX(vt(),e,r,n))[r])),u=new yX.Z({concurrency:2}),f=[];for(const t of l)u.add((async()=>{d[t.assetKey]=await this.uploadJson(e,t,a),f.push({projectId:e,assetKey:t.assetKey,quality:void 0,asset:d[t.assetKey],shouldAutosave:!1})}));const m=await this.uploadJson(e,c,a);await u.onIdle();const p=Jq(n,{projectId:e,revisionId:t,message:r,createdBy:KQ,contents:{assets:d,content_url:m.url,content:{url:m.url,size:m.size},json:{}},forceSave:o,compositionSummaries:nX(i)}),g={revision:await uX(vt(),e,p),assetsToUpdate:f,isPending:!1};return s(),g}catch(E0){throw s(E0),E0}}async restoreRevision(e,t,n,r){const o=VX(e,t);try{const i=await uX(vt(),e,function(e,t,n,r,o){return Jq(n,{projectId:e,revisionId:t,createdBy:o,message:(i=r,`Restoring version ${i.revisionNumber}`),contents:r.contents,compositionSummaries:r.compositionSummaries});var i}(e,t,n,r,KQ));return o(),{revision:i,isPending:!1}}catch(E0){throw o(E0),E0}}async getProjectAssetQuality(e){}async updateProjectAssetQuality(e,t){return await Promise.resolve()}async adler32ForAsset(e,t){}async pushProjectChanges(){return[]}async updateProject(e,t){return await s$(vt(),e,t)}async checkProjectNeedsCleanup(e){}async cleanupProject(e){}async deleteProject(e,t){if(!t)return await async function(e,{projectId:t}){await Rc(e,si.DELETE,`/projects/${t}`)}(vt(),{projectId:e})}async removeProjectCache(e){}async legacyGetLocalMediaAssetPath(e,t,n){const{size:r,url:o}=ev(t,...n);return P()(void 0!==r,"Asset size should be defined"),function(e,t){return{type:"url",url:e,size:t}}(o,r)}getScreenRecordingSession(e){throw new Error("`getScreenRecordingSession` not supported")}deleteRecording(e,t){throw new Error("`deleteRecording` not supported")}copyMediaAssetFromProject({sourceProjectId:e,destinationProjectId:t,assetHandle:n}){return NX().copyAssetsFromProjectBatch(vt(),{sourceProjectId:e,destinationProjectId:t,handles:[n]})}createProxyFile(e){throw new Error("`createProxyFile` not supported")}readBackupFileContents(e){throw new Error("`getBackupFileContents` not supported")}async getFileDataForCreateArtifact(e){const t=await EX(e);return{inputFileKey:jX.putFile(t),md5:await jX.getMd5HashForFile(t),size:t.size,extension:jX.getFileExtension(t)}}async createAndGetFileDataForCreateArtifact(e,t){const n=new File([e],t);return{inputFileKey:jX.putFile(n),md5:await jX.getMd5HashForFile(n),size:n.size,extension:jX.getFileExtension(n)}}}function*GX(e,t){yield*(0,Wq.rM)((function*(){let n,r;try{const o=yield*(0,Wq.ZO)("*",Lt.Ef.sliding(1));for(;;){const i=yield*(0,Wq.Ys)(e);Object.is(i,n)||(yield*(0,Wq.RE)(t,i,n,r),n=i),r=yield*(0,Wq.qn)(o)}}catch(o){throw Ra(o,"take-every-value-saga",{extra:{selector:e.name,worker:t.name}}),o}}))}function*WX(e){yield Bc.get(e).start()}function*HX(){yield*GX(Al,WX)}let qX=[],$X=0;const KX=function(){const e=(0,Ft.I0)();return(0,Nt.useCallback)((function(t){$X+=1;const n=$X;try{t((e=>{if($X<n)throw new Error("Dispatched batch action after batch level was closed");qX.push(e)}))}finally{if($X-=1,0===$X&&qX.length>0){const t=qX;qX=[],e(t)}}}),[e])};var YX=n(26643);var ZX=n(58464);const JX=Yc((function(e){return{colorScheme:"system"}}))((function({children:e,colorScheme:t}){const n=(0,ZX.v)(),[r,o]=Nt.useState("system"===t?"light":t);return Nt.useLayoutEffect((()=>{"dark"===t||"system"===t&&n?(document.documentElement.classList.add("dark-ok"),o("dark")):(document.documentElement.classList.remove("dark-ok"),o("light"))}),[t,n]),Nt.createElement(Rr.Provider,{value:r},e)})),QX={small:"min-h-5",medium:"min-h-6",large:"min-h-8"};function XX(e,t){return t.some((t=>t.startsWith(e)))}const e0=Nt.forwardRef((function({className:e,size:t="medium",asChild:n,...r},o){const i=n?Co.g7:"div",a=e?.split(" ")??[];return Nt.createElement(i,{ref:o,...r,className:yo()(e,"w-full",XX("items-start",a)?"flex":"row",QX[t],!XX("py-",a)&&!XX("p-",a)&&"small"!==t&&"py-1",!XX("px-",a)&&!XX("p-",a)&&!XX("pl-",a)&&!XX("pr-",a)&&"px-2",!XX("gap-",a)&&"gap-2")})}));var t0=n(14723);const n0=Nt.memo((function({children:e,tooltipEnabled:t,resizeRef:n}){const r=Nt.useRef(_r),o=Nt.useRef(_r),[i,a]=Nt.useState(!1),s=(0,Nt.useRef)(0),c=Pr((()=>{if(0!==s.current||!o.current)return s.current;o.current.textContent="W";const t=o.current.clientWidth;return o.current.textContent=e,s.current=t,t}));return no({ref:n||r,minimumMsPerTick:100,onResize:()=>{const t=o.current;if(!t||!r.current)return;t.textContent=e;let n=r.current.clientWidth;if(t.clientWidth<=n)return;const i=c(),s=Math.floor(n/i)+5;let d=e.substring(0,s),l=e.substring(e.length-s,e.length),u=!0;for(;t.clientWidth>n&&(d.length>0||l.length>0);)u&&d.length>0?d=d.substring(0,d.length-1):l=l.substring(1,l.length),t.textContent=d+"..."+l,u=!u,n=r.current.clientWidth;a(!0)}}),Nt.createElement(ei,{title:e,asChild:!0,enabled:i&&t,disableHoverableContent:!0},Nt.createElement("div",{ref:r,className:"Text-module--SGJu9K"},Nt.createElement("span",{ref:o,className:"Text-module--GOZyqn"},e)))})),r0=(0,t0.bC)({toDirection:`${xr.upgrade.degrees}deg`,colorStops:[`${xr.upgrade.color1} 0%`,`${xr.upgrade.color2} 100%`]}),o0=Nt.memo(Nt.forwardRef((function({className:e,ellipsisOverflow:t,numeric:n,size:r="regular",weight:o="regular",color:i="standard",style:a,variant:s,children:c,resizeRef:d,tooltipEnabled:l=!0,...u},f){const m="upgrade"===i;return Nt.createElement(Mo.WV.span,{ref:f,className:yo()(e,s,{"Text-module--Ip2Dyv":!0===t,"Text-module--HCgCd8":n,"Text-module--h7F_Se":m,"Text-module--oxslGV":!s,"Text-module--dTnC1C":s}),style:{"--text-font-size":s?void 0:Dr[r],"--text-font-weight":s?void 0:Or[o],"--text-color":m||s?void 0:xr[i]||i,backgroundImage:m?r0.backgroundGradient:void 0,...a},...u},"middle"===t&&"string"===typeof c?Nt.createElement(n0,{tooltipEnabled:l,resizeRef:d},c):c)})));var i0="Link-module--O6zD0D",a0="Link-module--Jtgl9e",s0="Link-module--Oc8GoN",c0="Link-module--WL83Io";const d0=Nt.forwardRef((function({disabled:e,variant:t="primary",className:n,...r},o){const i=Pr((t=>{e&&t.preventDefault()}));return Nt.createElement("a",{ref:o,className:yo()(s0,e?"cursor-default":"cursor-pointer",n,l[t],{[i0]:e}),tabIndex:e||!r.onClick&&!r.href?-1:0,...r,onClick:(0,wo.M)(r.onClick,i)})}));var l0=n(56227);const u0=Nt.forwardRef((function({className:e,width:t=20,strokeWidth:n=5,color:r,style:o,...i},a){const s=Nt.useContext(bo)?"rgba(0, 0, 0, 0.1)":"var(--color-black-30pct)";return Nt.createElement("div",{ref:a,role:"status",className:yo()("Spinner-module--FMVOBG",e),style:{width:t,color:r||s,...o},...i},Nt.createElement(l0.T,null,"Loading"),Nt.createElement("svg",{role:"presentation","aria-hidden":!0,className:"Spinner-module--Xxsf97",viewBox:"25 25 50 50"},Nt.createElement("circle",{className:"Spinner-module--dEIci3",cx:"50",cy:"50",r:"20",fill:"none",strokeWidth:n,strokeMiterlimit:"10",style:{stroke:"currentColor"}})))}));var f0="Button-module--I6_6yQ",m0="Button-module--oBXiC2",p0="Button-module--SyCeaa",g0="Button-module--vUC2LQ",h0="Button-module--vm07Nd",v0="Button-module--ty3NYR",E0="Button-module--sBvmAI",y0="Button-module--_nxW3Z",S0="Button-module--k9OciS",I0="Button-module--auKtQH",b0="Button-module--M3inG7",T0="Button-module--PK4xhu",w0="Button-module--AjeVPs",C0="Button-module--uC8wwV",_0="Button-module--rZhJ0o",A0="Button-module--baErjk",R0="Button-module--qEyijN",M0="Button-module--qREGqd",D0="Button-module--jcgXPd",O0="Button-module--jmaljg",x0="Button-module--clkIKS",k0="Button-module--a6VUBv",N0="Button-module--E3mha2",P0="Button-module--RlpwPg",L0="Button-module--2AQvsc",F0="Button-module--AtCXdF",U0="Button-module--uSxbZf",B0="Button-module--SmHaR7",j0="Button-module--_6HVqm",V0="Button-module--chlmst",z0="Button-module--ftUEVw",G0="Button-module--Y80z51";const W0=Nt.forwardRef((function({icon:e,iconDecoration:t,hideIconOnMobile:n,children:r,className:o,variant:i="primary",padding:a,size:s="medium",corners:c,isPressed:d,isProcessing:l,disabled:f,onClick:m,iconPlacement:p="left",rightContent:g,asAnchor:h,hasChevron:v,...E},y){const S=e&&Nt.createElement("div",{className:yo()(b0,{[I0]:n})},"external-arrow"===t&&Nt.createElement("span",{className:yo()(h0,"flex-center absolute bottom-0 right-0")},Nt.createElement(Go,{size:6})),"string"===typeof e?Nt.createElement("img",{src:e,alt:""}):e),I=h?"a":"button";return Nt.createElement(Mo.WV.button,{ref:y,type:"button",className:yo()(L0,o,u[i],u[s],c&&u[c],{[P0]:l,[B0]:d,[S0]:e,[x0]:"narrow"===a}),disabled:f||l,onClick:f?Ur:m,asChild:!0,...E},Nt.createElement(I,null,Nt.createElement("div",{className:f0}),"left"===p&&S,Boolean(r)&&Nt.createElement("span",{className:yo()(C0,"row")},r,v&&Nt.createElement("div",{className:yo()("h-3 w-3 flex-center text-grey-400 pl-0.5",p0)},Nt.createElement(zo,null))),!v&&"right"===p&&S,g,l&&Nt.createElement(u0,{color:"currentColor",className:V0})))})),H0=(0,pn.ZP)("WINDOW"),q0=H0("FORCE_RELOAD_WINDOW"),$0=H0("WINDOW_ROUTES_UPDATED"),K0=(H0("ROOT_SAGA_CRASHED"),H0("SHOW_INVALID_CLIENT_MODAL")),Y0=(H0("TOGGLE_MAXIMIZE_WINDOW"),H0("DOUBLE_CLICK_TITLE_BAR")),Z0=(H0("MAIN_REDUX_ACTION"),H0("TOGGLE_LEARNING_RAIL")),J0=(H0("GROW_LEARNING_RAIL"),H0("SHRINK_LEARNING_RAIL"),H0("SET_LEARNING_VIDEO")),Q0=H0("SET_LEARNING_VIDEO_MINIMIZED"),X0=H0("SET_CANVAS_EXPANDED"),e1=H0("SET_PLAYHEAD_ON_SCREEN"),t1=H0("SET_PLAYHEAD_VISIBLE_IN_TIMELINE"),n1=H0("SET_MENU_COMMANDS"),r1=(H0("RUN_MENU_COMMAND"),(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"descript-logo"})))),o1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"descript-wordmark"})));var i1="Headerbar-module--Bp3coA";function a1({className:e,hasBorder:t=!0,...n}){const r=(0,Nt.useRef)(_r),o=Nt.useContext(bo),i=(0,Nt.useRef)(_r),a=(0,Ft.I0)(),s=Pr((e=>{Gr(r,e)&&(Gr(i,e)||Br(e.target)&&(jr(e,!1)||e.target.closest("button"))||a(Y0()))}));return o?Nt.createElement("div",{className:yo()(e,"h-7 row bg-grey-0",t&&"border-b border-grey-100-a",i1,c1&&"disable-cursors"),ref:r,...n,onDoubleClick:(0,wo.M)(n.onDoubleClick,c1?s:void 0)}):Nt.createElement("div",{ref:r,className:yo()("Headerbar",i1,e),...n,onDoubleClick:(0,wo.M)(n.onDoubleClick,c1?s:void 0)})}const s1={Wrapper:a1,Logo:function({className:e,...t}){return Nt.createElement(Zo,{className:yo()(e,"text-grey-800"),...t},Nt.createElement(r1,null))},WordMarkLogo:function(){return Nt.createElement("div",{className:"row"},Nt.createElement(Zo,null,Nt.createElement(r1,{className:"text-grey-800"})),Nt.createElement(o1,{className:"text-grey-800 mt-0.5 hidden md:block","aria-label":"Descript",style:{"--icon-size":"64px"}}))},Button:Nt.forwardRef((function({className:e,...t},n){return Nt.createElement(Yo,{ref:n,className:yo()(e,"text-grey-800 relative"),decoration:"chevron",...t},Nt.createElement(r1,null))}))},c1=B()&&W();class d1 extends Nt.PureComponent{constructor(){super(...arguments),this.onLogoClicked=()=>{this.props.history.push("/")}}render(){const{title:e="",grow:t=!1,style:n={}}=this.props;return Nt.createElement("div",{className:yo()("HeaderLogoTitle",{Grow:t}),style:n},Nt.createElement("div",{className:"LogoContainer"},Nt.createElement("button",{type:"button",onClick:this.onLogoClicked},Nt.createElement("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTciIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8cGF0aCBkPSJNMCAxOC4xOThDMCAxOS4yOS43MSAyMCAxLjgwMyAyMGg1LjI2OGMzLjE0MyAwIDUuNzEzLTEuMDYzIDcuNDYxLTIuOTI0SDB2MS4xMjJ6TTcuMDcxIDBIMS44MDNDLjcwOSAwIDAgLjcxIDAgMS44MDJ2MS4xMjJoMTQuNTMyQzEyLjc4NCAxLjA2MyAxMC4yMTQgMCA3LjA3MSAwem00LjU5NyAxMi44NWMwIC44ODQuNTc3IDEuNDU4IDEuNDY1IDEuNDU4aDMuMTU3Yy4zNTgtLjg4OC41OTgtMS44NjMuNzEtMi45MTZoLTMuODY3Yy0uODg4IDAtMS40NjUuNTczLTEuNDY1IDEuNDU4ek03LjI5MyA3LjE1N2MwIC44ODUuNTc2IDEuNDU5IDEuNDY1IDEuNDU5SDE3YTEwLjgzOCAxMC44MzggMCAwMC0uNzEtMi45MTdIOC43NThjLS44ODkgMC0xLjQ2NS41NzQtMS40NjUgMS40NTh6bTEuNDY0IDUuNjkzYzAtLjg4NS0uNTc2LTEuNDU4LTEuNDY1LTEuNDU4SDB2Mi45MTZoNy4yOTJjLjg4OSAwIDEuNDY1LS41NzQgMS40NjUtMS40NTh6TTQuMzgyIDcuMTU3YzAtLjg4NC0uNTc3LTEuNDU4LTEuNDY1LTEuNDU4SDB2Mi45MTdoMi45MTdjLjg4OCAwIDEuNDY1LS41NzQgMS40NjUtMS40NTl6IiBmaWxsPSIjMDA2MkZGIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz4KPC9zdmc+Cg==",alt:"Logo",className:"Logo"}))),e.length>0&&Nt.createElement(Nt.Fragment,null,Nt.createElement("div",{className:"LogoDivider"}),Nt.createElement("div",{className:"Title"},e)))}}const l1=(0,jt.EN)(d1),u1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"send"}))),f1=Nt.memo((function({color:e="currentColor"}){return Nt.useContext(bo)?Nt.createElement(u1,null):Nt.createElement("svg",{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M1 .618a1 1 0 01.447.106L18 9 1.447 17.276a1 1 0 01-1.44-.777L0 16.382V10h7a1 1 0 00.117-1.993L7 8H0V1.618a1 1 0 011-1z",fill:e,fillRule:"evenodd"}))})),m1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"alert"}))),p1=Nt.memo((function({color:e="var(--color-black-foreground)",opacity:t=.4}){return Nt.useContext(bo)?Nt.createElement(m1,{style:{color:e}}):Nt.createElement("svg",{"aria-hidden":!0,width:"34",height:"34",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("g",{fill:"none",fillRule:"evenodd"},Nt.createElement("circle",{strokeOpacity:".1",stroke:"#000",fillOpacity:t,fill:e,cx:"17",cy:"17",r:"16.5"}),Nt.createElement("path",{d:"M15 22.293h4V26h-4v-3.707zM19 9.78l-1 10.196h-2L15 9.78V7h4v2.78z",fill:"#FFF",fillRule:"nonzero"})))})),g1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"alert-triangle"}))),h1=Nt.memo((function({color:e="var(--color-black-foreground)",opacity:t=.4,transform:n=""}){return Nt.useContext(bo)?Nt.createElement(g1,{style:{color:e}}):Nt.createElement("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",transform:n},Nt.createElement("g",{id:"atm/icon/alert"},Nt.createElement("path",{id:"mask",fillRule:"evenodd",clipRule:"evenodd",d:"M12.2909 5.88868L3.70739 19.9519C3.51652 20.2646 3.41554 20.6239 3.41553 20.9903C3.4155 22.091 4.30783 22.9834 5.40859 22.9833L22.575 22.9829C22.9414 22.9829 23.3007 22.882 23.6134 22.6911C24.553 22.1176 24.8498 20.891 24.2764 19.9514L15.6935 5.8886C15.5284 5.61807 15.3011 5.39081 15.0306 5.2257C14.091 4.65225 12.8644 4.94908 12.2909 5.88868ZM22.5751 20.9898L5.40863 20.9902L13.9922 6.927L22.5751 20.9898ZM12.9998 10.9999H14.9998V15.9999H12.9998V10.9999ZM14.9998 16.9999H12.9998V18.9999H14.9998V16.9999Z",fill:e,fillOpacity:t})))})),v1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"arrow-up"}))),E1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"arrow-down"}))),y1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"arrow-left"}))),S1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"arrow-right-1x"}))),I1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"arrow-right"}))),b1=Nt.forwardRef((function(e,t){return Nt.createElement("div",{ref:t},Nt.createElement("div",{className:"icon-1x flex-center"},Nt.createElement(S1,{...e,type:"icon"})),Nt.createElement("div",{className:"icon-2x flex-center"},Nt.createElement(I1,{...e,type:"icon"})))}));function T1(e){switch(e){case"down":return"rotate(90deg)";case"left":return"scale(-1,1)";case"up":return"rotate(-90deg)";default:return}}const w1=Nt.memo((function({color:e="currentColor",direction:t="right",style:n,...r}){if(Nt.useContext(bo))return"up"===t?Nt.createElement(v1,{style:{color:e}}):"down"===t?Nt.createElement(E1,{style:{color:e}}):"left"===t?Nt.createElement(y1,{style:{color:e}}):Nt.createElement(b1,{style:{color:e}});const o={...n,transform:T1(t)};return Nt.createElement("svg",{width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:o,...r},Nt.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.168 15.573l-6.157 6.021-1.454-1.414 4.714-4.586H7v-2h10.27l-4.714-4.586 1.454-1.414 6.157 6v.046l.993.966-.993.967z",fill:e}))})),C1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"volume-x"}))),_1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"volume-2"}))),A1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"volume-1"}))),R1=Nt.memo((function({className:e,color:t="currentColor",opacity:n=1,muted:r,transcriptionStatus:o="none"}){const i=Nt.useContext(bo);if(r)return i?Nt.createElement(C1,{style:{color:t}}):Nt.createElement("svg",{className:e,opacity:n,width:"30",height:"30",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M16 14.696l2.217 1.28A1 1 0 0018 14v1.85V12a3 3 0 012.15 5.092l1.765 1.019A5 5 0 0018 10v.999-3a7 7 0 015.66 11.119l2.886 1.666-1 1.732L3.402 9.732l1-1.732 3.464 2H10l6-4v8.696zm-4.847-2.798L14 13.54V10l-2.847 1.898zM16 19.169V24l-6-4H5v-7.182l2 1.155V18h4l3 2v-1.985l2 1.154zm4.258 2.459A6.991 6.991 0 0118 22v-1.676l2.258 1.304z",fill:t}));switch(o){case"transcribed":return i?Nt.createElement(_1,{style:{color:t}}):Nt.createElement("svg",{className:e,opacity:n,width:"30",height:"30",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M22 12h2.326A7 7 0 0118 22v-3 1a5 5 0 004-8zm-6-6v18l-6-4H5V10h5zm-2 4l-3 2H7v6h4l3 2zm4 4v2a1 1 0 000-2zm0 4v-6a3 3 0 010 6zm4-9V8h-2V4h4v6h-1v1h-2V9zm5 0V8h-2V4h4v6h-1v1h-2V9z",fill:t}));case"transcribing":return i?Nt.createElement(A1,{style:{color:t}}):Nt.createElement("svg",{className:e,opacity:n,height:"30",width:"30",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{fill:t,d:"M16 6v18l-6-4H5V10h5zm9 9a7 7 0 01-7 7v-2a5 5 0 004.9-6h2.03c.046.327.07.66.07 1zm-11-5l-3 2H7v6h4l3 2zm4 2a3 3 0 010 6v-2a1 1 0 000-2z"}));default:return i?Nt.createElement(_1,{style:{color:t}}):Nt.createElement("svg",{className:e,width:"30",height:"30",opacity:n,viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M16 6v18l-6-4H5V10h5zm-2 4l-3 2H7v6h4l3 2zm4 4v2a1 1 0 000-2zm0 4v-6a3 3 0 010 6zm0 1v1a5 5 0 000-10v1-3a7 7 0 010 14z",fill:t}))}}));const M1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"camera"}))),D1=Nt.memo((function({color:e="currentColor",opacity:t=1}){return Nt.useContext(bo)?Nt.createElement(M1,null):Nt.createElement("svg",{opacity:t,width:"18",height:"16",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M16 16H2c-1.194 0-2-.814-2-2V4c0-1.004.806-1.818 2-2h2l2-2c-.185.28-.032.154 0 0 .161.071.181.065 0 0 .228.048.255.039 0 0 .327.02.373.013 0 0 .424.008.427.008 0 0 .457.005.481 0 1 0h4c.496 0 .52.006 1 0-.437.009-.422.01 0 0-.379.016-.35.02 0 0-.08.076.143.224 0 0l2 2h2c1.194.182 2 .996 2 2v10c0 1.186-.807 2-2 2zm0-11c0-.401-.33-.736-1-1h-2c-.27.241-.568.078-1 0l-1-2H7L6 4c-.443.078-.741.242-1 0H3c-.67.264-1 .6-1 1v8c0 .665.33 1 1 1h12c.67 0 1-.336 1-1V5zm-7 7.435A3.437 3.437 0 119 5.56a3.437 3.437 0 010 6.875zM9 7.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3z",fill:e,fillRule:"nonzero"}))})),O1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"chevron-down"})));var x1=(e=>(e[e.Down=0]="Down",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Left=3]="Left",e))(x1||{});const k1=Nt.memo((function({color:e="currentColor",direction:t=0,style:n,opacity:r=1,...o}){const i={verticalAlign:"middle",transform:`rotate(${-90*t}deg)`,...n};return Nt.useContext(bo)?Nt.createElement(O1,{style:i}):Nt.createElement("svg",{width:"7",height:"5",xmlns:"http://www.w3.org/2000/svg",style:i,opacity:r,...o},Nt.createElement("g",{stroke:e,fill:"none",fillRule:"evenodd",strokeLinecap:"square"},Nt.createElement("path",{d:"M3.5 3.621L6.328.793M3.328 3.621L.5.793"})))})),N1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"linked-on"}))),P1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"linked-off"}))),L1=Nt.memo((function({color:e="currentColor",opacity:t,linked:n=!0}){let r="M5 2a3 3 0 100 6h10a3 3 0 000-6H5zm4-2v2h2V0h4a5 5 0 010 10h-4V8H9v2H5A5 5 0 115 0h4z";n&&(r+="m5 4H6v2h8V4z");return Nt.useContext(bo)?n?Nt.createElement(N1,{style:{color:e}}):Nt.createElement(P1,{style:{color:e}}):Nt.createElement("svg",{opacity:t,width:"20",height:"10",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:r,fill:e,fillRule:"nonzero"}))})),F1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"chevron-right"}))),U1=Nt.memo((function({color:e,...t}){const n=Nt.useContext(bo),r=n?"var(--grey-800)":"var(--color-black-30pct)";return n?Nt.createElement(F1,{style:{color:r},...t}):Nt.createElement("svg",{width:"30",height:"30",xmlns:"http://www.w3.org/2000/svg",...t},Nt.createElement("path",{d:"M18.364 15.028L12 8.664V7.25l7.778 7.778L12 22.806v-1.414z",fill:r}))}));const B1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"check"}))),j1=Nt.memo((function({color:e="currentColor",opacity:t=1}){return Nt.useContext(bo)?Nt.createElement(B1,{style:{color:e}}):Nt.createElement("svg",{opacity:t,width:"11",height:"11",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{fill:e,fillRule:"evenodd",d:"M9.123.471c.292-.464.916-.61 1.393-.326a.971.971 0 01.335 1.356L5.009 10.53a1.029 1.029 0 01-1.622.138L.254 7.347a.968.968 0 01.088-1.392 1.032 1.032 0 011.43.085l2.225 2.321L9.123.471z"}))}));const V1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"x"}))),z1="close-icon-path",G1=Nt.memo((function({opacity:e=1,color:t="currentColor"}){return Nt.useContext(bo)?Nt.createElement(V1,{style:{color:t}}):Nt.createElement("svg",{opacity:e,width:"12",height:"12",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M19.28 50.92l4.27 4.27a.97.97 0 1 1-1.36 1.36l-4.27-4.27-4.27 4.27a.97.97 0 1 1-1.36-1.36l4.27-4.27-4.27-4.27a.97.97 0 1 1 1.36-1.36l4.27 4.27 4.27-4.27a.97.97 0 1 1 1.36 1.36l-4.27 4.27z",id:z1}),Nt.createElement("use",{fill:t,href:"#close-icon-path",transform:"translate(-12 -45)",fillRule:"evenodd"}))})),W1=Nt.memo((function({color:e="currentColor",...t}){return Nt.createElement("svg",{height:"34",width:"34",viewBox:"0 0 34 34",xmlns:"http://www.w3.org/2000/svg",...t},Nt.createElement("path",{d:"M31.167 0 34 2.833l-2.273 2.273a2.004 2.004 0 0 1 1.3 1.877V17.02c0 2.006-.195 3.158-.586 4.93-.39 1.77-.993 3.325-1.805 4.662a9.764 9.764 0 0 1-2.65 2.895l-.463.313c-1.264.802-2.738 1.203-4.422 1.203v-5.013c1.022 0 1.865-.284 2.527-.852.661-.569 1.203-1.32 1.624-2.256.088-.197.17-.398.247-.605l.146-.424.13-.438a12.37 12.37 0 0 0 .334-1.692l.136-1.057c.046-.4.075-.748.085-1.218l.005-.448H23.01a2.004 2.004 0 0 1-1.882-1.315l-10.055 10.06c-.148.291-.306.573-.471.847a9.764 9.764 0 0 1-2.65 2.895l-.464.313a7.378 7.378 0 0 1-1.004.534L2.834 34 0 31.167 3.065 28.1v-.343l9.916-9.907c-.004.12-.01.238-.015.352l8.04-8.043v-.345l4.837-4.836h.344L31.167 0ZM10.99 4.98c1.106 0 2.003.896 2.003 2.003v5.18L8.137 17.02l-5.162.002a2.003 2.003 0 0 1-2.004-2.003V6.983c0-1.028.774-1.875 1.77-1.99l.234-.014h8.014Zm18.03 4.006h-1.174l-2.833 2.832v1.196h4.008V8.986Zm-20.034 0H4.98v4.028h4.007V8.986Z",fill:e,fillRule:"nonzero"}))}));var H1=n(16639);H1.ZP.div`
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    background: var(--color-black-40pct);
    border-radius: 5px;
`;function q1({opacity:e=1,...t}){return Nt.useContext(bo)?Nt.createElement(O1,null):Nt.createElement("svg",{...t,width:"8",height:"10",viewBox:"0 0 8 10",opacity:e,xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M1.518 5.993l2.475 2.475 2.475-2.475h1.414l-3.89 3.889-3.888-3.89h1.414zM3.993.103l3.889 3.89H6.468L3.993 1.518 1.518 3.993H.104L3.993.103z"}))}const $1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"help-circle"}))),K1=Nt.memo((function({color:e="currentColor ",opacity:t=1}){return Nt.useContext(bo)?Nt.createElement($1,{style:{color:e}}):Nt.createElement("svg",{width:"18",height:"18",opacity:t,xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M9 16A7 7 0 109 2a7 7 0 000 14zm0 2A9 9 0 119 0a9 9 0 010 18zM6.55 7.505C6.566 6.098 7.587 5.18 9.305 5.18c1.633 0 2.697.86 2.697 2.148 0 .795-.37 1.343-1.16 1.8-.736.424-.94.665-.94 1.17v.253H8.226l-.016-.215c-.102-.919.166-1.402.913-1.832.73-.43.918-.655.918-1.128 0-.435-.354-.735-.86-.735-.515 0-.87.343-.885.864H6.55zm2.562 5.683c-.693 0-1.101-.36-1.101-.978 0-.623.408-.982 1.101-.982.693 0 1.096.36 1.096.982 0 .618-.403.978-1.096.978z",fill:e,fillRule:"nonzero"}))}));const Y1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"eye"}))),Z1=Nt.memo((function({color:e="currentColor",className:t,opacity:n=1}){return Nt.useContext(bo)?Nt.createElement(Y1,null):Nt.createElement("svg",{className:t,width:"20",height:"14",viewBox:"0 0 20 14",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("g",{stroke:e,strokeOpacity:n,strokeWidth:"2",fill:"none",fillRule:"evenodd"},Nt.createElement("path",{d:"M19.046 7.282a.737.737 0 00-.012-.022zM18.868 7c-.13-.19-.305-.423-.51-.676a20.208 20.208 0 00-2.162-2.268C14.07 2.146 11.895 1 10 1 8.105 1 5.93 2.147 3.804 4.056a20.208 20.208 0 00-2.163 2.268c-.204.253-.379.485-.51.676.131.19.306.423.51.676.595.736 1.35 1.537 2.163 2.268C5.93 11.854 8.105 13 10 13c1.895 0 4.07-1.147 6.196-3.056a20.208 20.208 0 002.163-2.268c.204-.253.379-.485.51-.676zM.955 7.28a.693.693 0 00.006-.012zm0-.562a.737.737 0 00.011.022z"}),Nt.createElement("circle",{cx:"10",cy:"7",r:"2"})))}));const J1=Nt.memo((function({color:e="currentColor"}){return Nt.createElement("svg",{width:"6",height:"10",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{fill:e,d:"M.16.84L5.99 5 .16 9.15z",fillRule:"evenodd"}))})),Q1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"minimize"}))),X1=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"maximize"}))),e2=Nt.memo((function({color:e="currentColor",exit:t}){return Nt.useContext(bo)?t?Nt.createElement(Q1,{style:{color:e}}):Nt.createElement(X1,{style:{color:e}}):t?Nt.createElement("svg",{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M11 18v-7h7v2h-5v5h-2zm2-13h5v2h-7V0h2v5zM5 5H0v2h7V0H5v5zm0 8H0v-2h7v7H5v-5z",fill:e,fillRule:"nonzero"})):Nt.createElement("svg",{width:"28",height:"28",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M23 16v7h-7v-2h5v-5h2zM12 5v2H7v14h5v2H5v-7h2v-4H5V5h7zm9 2h-5V5h7v7h-2V7z",fill:e,fillRule:"nonzero"}))}));function t2({tooltipTitle:e="Go back",route:t,disabled:n=!1}){const r=(0,Ft.v9)(bW)?.lastPath||fa,o=(0,jt.k6)(),i=(0,Nt.useCallback)((()=>{t?o.push(t):o.push(r)}),[o,r,t]);return t||W()?Nt.createElement(ei,{placement:"bottom",distance:2,enabled:!0!==n,title:e},Nt.createElement(Yo,{onClick:i,disabled:n,"data-testid":"backButton"},Nt.createElement(k1,{className:"BackIcon",direction:x1.Left}))):Nt.createElement("div",{className:"BackButton_HeaderLogoTitle"},Nt.createElement(l1,null))}const n2=Nt.memo(t2);var r2="TrafficLightsPlaceholder-module--ysZPCP";const o2=function({className:e}){return Nt.createElement("div",{className:yo()("TrafficLightsPlaceholder-module--px3tNB",e)},Nt.createElement("div",{className:r2}),Nt.createElement("div",{className:r2}),Nt.createElement("div",{className:r2}))};var i2=n(38994);const a2=Yc((function(e){return{isFullscreen:"number"===typeof e.ui?.webContentsId&&(e.ui.windowRoutes.find((t=>t.webContentsId===e.ui.webContentsId))?.windowState?.fullscreen??!1)}}))((function({projectName:e="",showBackButton:t,hideDivider:n,isFullscreen:r}){const{platform:o}=i2,i=Nt.useContext(bo);if(i){const e="darwin"===o&&!r&&Nt.createElement(o2,null);return e?Nt.createElement("div",{className:i2.platform},e):_r}return Nt.createElement("div",{className:yo()(["LeftHeaderContainer",i2.platform])},"darwin"!==o||r?!H()&&Nt.createElement("div",{className:"Spacer"}):Nt.createElement(o2,null),"darwin"===o&&!n&&!i&&!r&&!H()&&Nt.createElement("div",{className:"Divider"}),t&&Nt.createElement(n2,null),""!==e&&Nt.createElement("div",{className:"ProjectName",onDoubleClick:Fr},e))}));var s2=n(19220),c2=n(49105);function d2(e,t){const[n,r]=(0,Nt.useState)(e),o=Pr((e=>{r(e),t?.(e)}));return(0,Nt.useEffect)((()=>{r(e)}),[e]),"undefined"===typeof e?[n,o]:[e,t]}function l2(e,t){return e&&"object"===typeof e&&"type"in e&&e.type===t}function u2(e,t){const n=Nt.useRef(t);return Nt.useEffect((()=>{n.current=t}),[t]),Nt.useMemo((()=>{const t=Array.isArray(e)?e:Nt.Children.toArray(e),r=Object.entries(n.current),o={};for(const e of t){const[t]=r.find((([t,n])=>l2(e,n)))||["mainChildren"],n=t;let i=o[n];i||(i=[],o[n]=i),i.push(e)}return o}),[e])}var f2=n(81165),m2="ScrollArea-module--cnbQHh",p2=n(85808);const g2=Nt.forwardRef,h2=Nt.forwardRef((function({className:e,fullHeight:t,...n},r){return Nt.createElement(f2.fC,{ref:r,className:yo()("ScrollArea-module--MrzgLQ",e,t&&"ScrollArea-module--z1pqbD"),...n})})),v2=Nt.forwardRef((function({className:e,...t},n){const r=Nt.useRef(_r),o=(0,s2.e)(n,r),i=Nt.useRef(_r),[a]=Yr({update:()=>{r.current&&(i.current&&clearTimeout(i.current),r.current.setAttribute("data-scrolling","true"),i.current=setTimeout((()=>{r.current?.removeAttribute("data-scrolling")}),600))}});return Nt.createElement(f2.l_,{ref:o,className:yo()("ScrollArea-module--w5oPD7",e),...t,onScroll:(0,wo.M)(t.onScroll,a)})})),E2=Nt.forwardRef((function({className:e,children:t,...n},r){return Nt.createElement(f2.bU,{ref:r,...n,className:yo()("ScrollArea-module--tXlgNv",e)},Nt.createElement("div",{className:"ScrollArea-module--XSu42k"},t))})),y2=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement(f2.LW,{ref:n,orientation:"horizontal",className:yo()(m2,e),...t})})),S2=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement(f2.LW,{ref:n,orientation:"vertical",className:yo()(m2,e),...t})})),I2=f2.Ns;function b2(){return Nt.createElement(Nt.Fragment,null,Nt.createElement(y2,null,Nt.createElement(E2,null)),Nt.createElement(S2,null,Nt.createElement(E2,null)),Nt.createElement(I2,null))}const T2=Nt.forwardRef((function({children:e,asChild:t,...n},r){return Nt.createElement(h2,{ref:r,...n},Nt.createElement(v2,{asChild:t},e),Nt.createElement(b2,null))})),w2=g2((function({children:e,asChild:t,className:n,handle:r,...o},i){const[a,s]=Nt.useState(_r);return Nt.createElement(h2,{fullHeight:!0,ref:i,...o},Nt.createElement(v2,{ref:s,asChild:t},Nt.createElement(p2.OO,{ref:r,increaseViewportBy:100,...o,className:yo()(n,"h-full"),customScrollParent:a??void 0,itemContent:(t,n,r)=>e(n,t,r)})),Nt.createElement(b2,null))}));var C2="Dialog-module--SpPFqJ";const _2=c2.xz,[A2,R2]=(0,Qr.k)("Dialog",{required:!1,open:!1,isProcessing:!1,onSubmit:()=>{}});function M2({open:e,onOpenChange:t,isProcessing:n=!1,type:r,onSubmit:o,required:i=!1,...a}){const[s,c]=d2(e,t),d=Pr((e=>{c?.(!1),e.preventDefault()}));return Nt.createElement(A2,{open:s||!1,isProcessing:n,type:r,onSubmit:(0,wo.M)(o,d),required:i},Nt.createElement(c2.fC,{...a,open:s,onOpenChange:c}))}const D2=Nt.forwardRef((function({className:e,children:t,isTruncated:n,hasSeparator:r,icon:o,...i},a){return Nt.createElement("div",{ref:a,"data-testid":"dialog-title",className:yo()(e,"Dialog-module--k71yI3",{[C2]:r}),...i},Boolean(o)&&Nt.createElement(Zo,{className:"mr-2"},o),Nt.createElement(c2.Dx,{className:yo()("Dialog-module--d1VqoV",n&&"Dialog-module--ZKvjb8")},t))})),O2=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement(c2.dk,{ref:n,className:yo()(e,"Dialog-module--o6Cm2n"),...t})})),x2=(c2.h_,Nt.forwardRef((function({className:e,...t},n){return Nt.createElement(c2.aV,{className:yo()(e,"Dialog-module--iccyXl"),ref:n,...t},Nt.createElement(e0,{size:"large",className:yo()("Dialog-module--JWPrFA","absolute left-0 top-0 right-0"),"data-testid":"overlay-header"}))}))),k2=Nt.forwardRef((function({className:e,...t},n){const{isProcessing:r}=R2("Dialog.CloseButton");return r?_r:Nt.createElement(c2.x8,{ref:n,...t,className:yo()(e,"Dialog-module--mJMNdi"),asChild:!0},Nt.createElement(Yo,{"aria-label":"Close dialog","data-testid":"dialog-close-button"},Nt.createElement(G1,null)))})),N2=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement("div",{ref:n,className:yo()(e,"Dialog-module--U14q6h"),...t})})),P2=Nt.forwardRef((function({className:e,children:t,hideCloseButton:n,onEscapeKeyDown:r,onInteractOutside:o,fullHeight:i,showOverlay:a=!0,hasScrollArea:s=!0,portal:c=!0,...d},l){const u=Nt.useContext(bo),{isProcessing:f,type:m,onSubmit:p,required:g}=R2("Dialog.Content"),h=f||g,v="boolean"===typeof n?!n:!g,{footer:E,actions:y,mainChildren:S,title:I,error:b}=u2(t,{title:D2,footer:U2,actions:F2,error:N2}),T=Pr((e=>{W()&&e.target instanceof HTMLElement&&(e.target.querySelector('[data-testid="overlay-header"]')||"overlay-header"===e.target.getAttribute("data-testid"))&&e.preventDefault()})),w=Nt.createElement(c2.VY,{ref:l,"data-redesign":u||void 0,role:"alert"===m?"alertdialog":void 0,className:yo()(e,"Dialog-module--NPVZaU"),onEscapeKeyDown:h?Lr:r,onInteractOutside:h?Lr:o,onPointerDownOutside:(0,wo.M)(d.onPointerDownOutside,T),asChild:!0,"data-dialog":!0,"data-testid":"dialog-content",...d},Nt.createElement("form",{onSubmit:p},I,b,s&&S&&S.length>0?Nt.createElement(T2,{fullHeight:i,className:"Dialog-module--gPaysO"},S):S,u&&E,y,!u&&E,v&&Nt.createElement(k2,null)));return c?Nt.createElement(c2.h_,null,a&&Nt.createElement(x2,{className:"RadixDialogOverlay"}),w):w})),L2=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement("div",{ref:n,className:yo()(e,"Dialog-module--MKMPsb"),...t})})),F2=Nt.forwardRef((function({className:e,hasSeparator:t,...n},r){return Nt.createElement("div",{ref:r,className:yo()(e,"Dialog-module--QuFiEb",{[C2]:t}),...n})})),U2=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement("footer",{ref:n,className:yo()(e,"Dialog-module--uLmeXX"),...t})})),B2=Nt.forwardRef((function({children:e="Cancel",className:t,...n},r){const{isProcessing:o}=R2("Dialog.CancelButton"),i=Nt.useContext(bo);return Nt.createElement(c2.x8,{asChild:!0},Nt.createElement(W0,{ref:r,type:"button",variant:i?"light":"secondary",className:yo()(t,"Dialog-module--d7iMwA"),disabled:o,"data-testid":"dialog-cancel-button",...n},e))})),j2=Nt.forwardRef((function({children:e="Confirm",className:t,focusOnMount:n,...r},o){const i=Nt.useRef(_r),a=(0,s2.e)(o,i),{isProcessing:s,type:c}=R2("Dialog.ConfirmButton");return Nt.useEffect((()=>{requestAnimationFrame((()=>{(n||"alert"===c&&!1!==n)&&i.current?.focus()}))}),[n,c]),Nt.createElement(W0,{ref:a,type:"submit",className:yo()(t,"Dialog-module--dWY9U9"),isProcessing:s,"data-testid":"dialog-confirm-button",...r},e)})),V2=(0,pn.ZP)("TOAST"),z2=(V2("ASK_IF_CONVERT_COMPOSITION_TO_VIDEO_TOAST"),V2("SHOW_SPEAKERS_DETECTED_TOAST"),V2("SHOW_OVERDUB_LIMIT_TOAST"),V2("SHOW_TTS_LIMIT_TOAST"),V2("SHOW_REGENERATE_LIMIT_TOAST"),V2("SHOW_OVERDUB_UNSUPPORTED_LANGUAGE_TOAST"),V2("SHOW_OVERDUB_SETUP_TOAST"),V2("SHOW_MUST_UPGRADE_TO_GENERATE_OVERDUB_TOAST"),V2("SHOW_GIBBERISH_IN_OVERDUB_TOAST"),V2("SHOW_ROOMTONE_TOAST"),V2("SHOW_MIC_BLEED_DETECTION_TOAST"),V2("SHOW_PROJECT_MOVE_TOAST"),V2("SHOW_VOICE_TRAINING_SUCCEEDED_TOAST"),V2("SHOW_VOICE_TRAINING_FAILED_TOAST"),V2("SHOW_PUBLISH_SUCCESS_TOAST"),V2("SHOW_PUBLISH_FAILURE_TOAST"),V2("DISMISS")),G2=(V2("HIDE"),V2("REVEAL"),V2("SET_DOWNLOAD_PROGRESS_VISIBILITY"),V2("APP_UPDATE_AVAILABLE"),V2("APP_UPDATE_IN_PROGRESS"),V2("APP_UPDATE_NOT_AVAILABLE"),V2("APP_INSTALL_UPDATE")),W2=(V2("SHOW_DOC_ALERT_TOAST"),V2("SHOW_LOADER_TIMED_OUT_TOAST")),H2=V2("SHOW_GENERIC_TEXT_TOAST");V2("SHOW_GENERIC_TOAST"),V2("SHOW_REMOVE_QUICK_EDIT_FILLER_WORDS_TOAST"),V2("SHOW_TOO_MANY_YOUTUBE_SIGN_INS_TOAST"),V2("SHOW_MATCH_COMPOSITION_TO_TEMPLATE_ORIENTATION_TOAST"),V2("SHOW_TEXT_MODE_TOAST"),V2("SHOW_DRAG_CLIP_TOAST"),V2("SHOW_PROJECT_COMPLEXITY_LIMIT_TOAST"),V2("OPEN_RECORDING_FILE_TOAST"),V2.async("RECORD_OVER_SELECTION_TOAST");const q2=function(){(0,Nt.useEffect)((()=>{rt("force_update_modal_viewed")}),[]);const e=(0,Ft.I0)(),t=Pr((()=>{e(G2())})),n=Pr((()=>{e(iZ({url:"https://www.descript.com/download"}))}));return Nt.createElement(To,null,Nt.createElement(M2,{required:!0,type:"alert",open:!0,onSubmit:t},Nt.createElement(P2,null,Nt.createElement(D2,null,"A new version of Descript is ready!"),Nt.createElement(O2,null,Nt.createElement(o0,null,"This version of Descript is no longer supported. Restart Descript to update to the latest version.")),Nt.createElement(U2,null,Nt.createElement(d0,{onClick:n},"Download the latest Descript")),Nt.createElement(F2,null,Nt.createElement(j2,null,"Restart")))))};var $2=n(22303),K2=n.n($2);const Y2=Yc((e=>({userId:Al(e),appInstallId:sW(e)})))((function({defect:e,error:t,sentryId:n,userId:r,appInstallId:o}){const i=(0,jt.k6)(),a=e?.message??"Oh no! Something's not working.",s=!0===e?.shouldQuitToFix,c=Pr((()=>{window.location.reload()})),d=Pr((()=>{i.push(fa),c()}));return Nt.createElement(To,null,Nt.createElement("div",{className:"stack h-full"},Nt.createElement(s1.Wrapper,null,Nt.createElement("div",{className:"row px-3 gap-4"},Nt.createElement(a2,null),Nt.createElement(ei,{title:"Back to drive"},Nt.createElement(s1.Button,{onClick:d,decoration:void 0})))),Nt.createElement("div",{className:"stack flex-center flex-1",style:{userSelect:"text"}},Nt.createElement("div",{className:"row gap-4 items-start"},Nt.createElement("img",{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDQ2LjIgKDQ0NDk2KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5BcnRib2FyZDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJBcnRib2FyZCIgZmlsbD0iIzM0MkMzRSI+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMSwxMSBMMTEsMTAgTDUsMTAgTDUsMTEgTDgsMTEgTDgsMTIgTDEwLDEyIEwxMCwxMSBMMTEsMTEgWiBNMTAsNCBMMTAsMyBMOSwzIEw5LDQgTDYsNCBMNiwzIEw1LDMgTDUsNSBMMTQsNSBMMTQsNCBMMTAsNCBaIE0xLDMgTDIsMyBMMiwxMyBMMSwxMyBMMSwzIFogTTIsMTMgTDE0LDEzIEwxNCwxNCBMMiwxNCBMMiwxMyBaIE0xNCw1IEwxNSw1IEwxNSwxMyBMMTQsMTMgTDE0LDUgWiBNNiwyIEw5LDIgTDksMyBMNiwzIEw2LDIgWiBNMiwyIEw1LDIgTDUsMyBMMiwzIEwyLDIgWiBNNCw2IEw1LDYgTDUsNyBMNCw3IEw0LDYgWiBNOSw2IEwxMCw2IEwxMCw3IEw5LDcgTDksNiBaIE02LDYgTDcsNiBMNyw3IEw2LDcgTDYsNiBaIE0xMSw2IEwxMiw2IEwxMiw3IEwxMSw3IEwxMSw2IFogTTQsOCBMNSw4IEw1LDkgTDQsOSBMNCw4IFogTTksOCBMMTAsOCBMMTAsOSBMOSw5IEw5LDggWiBNNiw4IEw3LDggTDcsOSBMNiw5IEw2LDggWiBNMTEsOCBMMTIsOCBMMTIsOSBMMTEsOSBMMTEsOCBaIE01LDcgTDYsNyBMNiw4IEw1LDggTDUsNyBaIE0xMCw3IEwxMSw3IEwxMSw4IEwxMCw4IEwxMCw3IFoiIGlkPSJDb21iaW5lZC1TaGFwZSI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+",alt:"",className:"ErrorBoundaryIcon"}),Nt.createElement("div",{className:"w-lg stack gap-4"},Nt.createElement(e0,null,Nt.createElement("div",{className:"stack"},Nt.createElement(o0,{variant:"headline-3"},a),s&&Nt.createElement(o0,{variant:"body-1-regular"},"Please quit Descript and try again."))),Nt.createElement(e0,null,Nt.createElement("div",{className:"stack gap-3"},Nt.createElement(o0,{variant:"label-1-regular"},"We've logged the details so that our team can look into this further."),Nt.createElement(o0,{variant:"label-1-regular"},"In the meantime, here are some"," ",Nt.createElement(d0,{href:"https://help.descript.com/hc/en-us/articles/14815125957005"},"solutions to known issues")," ","that may help."),Nt.createElement(o0,{variant:"label-1-regular"},"If you need to reach out to customer support about this issue, please include the information below so that they can help you faster:"))),Nt.createElement("div",{className:"stack bg-grey-50 rounded p-2"},t?.name&&Nt.createElement("div",{className:"row py-1 px-2"},Nt.createElement(o0,{variant:"label-2-regular"},t?.name)),t?.message&&Nt.createElement("div",{className:"row py-1 px-2"},Nt.createElement(o0,{variant:"label-2-regular"},t?.message)),n&&Nt.createElement("div",{className:"row py-1 px-2 pt-2 gap-1"},Nt.createElement(o0,{variant:"label-2-medium"},"Error ID:"),Nt.createElement(o0,{variant:"label-2-regular"},n)),r&&Nt.createElement("div",{className:"row py-1 px-2 gap-1"},Nt.createElement(o0,{variant:"label-2-medium"},"User ID:"),Nt.createElement(o0,{variant:"label-2-regular"},r)),o&&Nt.createElement("div",{className:"row py-1 px-2 gap-1"},Nt.createElement(o0,{variant:"label-2-medium"},"Install ID:"),Nt.createElement(o0,{variant:"label-2-regular"},o))),!s&&Nt.createElement(e0,null,t&&Nt.createElement(W0,{onClick:()=>{return e=`${t?.name}\n${t?.message}\nError ID:${n}\nUser ID:${r}\nInstall ID:${o}`,K2()(e,{format:"text/plain"});var e},variant:"secondary",className:"pr-2"},"Copy error to clipboard"),Nt.createElement(W0,{onClick:c,variant:"primary"},"Reload Descript")))))))}));class Z2 extends Nt.Component{constructor(){super(...arguments),this.state={error:void 0,sentryId:void 0}}componentDidCatch(e,t){this.setState({error:e});const n=Ra(e,"react-error-boundary",{extra:t});this.setState({sentryId:n})}render(){return this.state.error||this.props.didRootSagaCrash?Nt.createElement(Y2,{defect:this.props.defect,error:this.state.error,sentryId:this.state.sentryId}):this.props.isShowingInvalidClientError?Nt.createElement(Nt.Fragment,null,this.props.children,Nt.createElement(q2,null)):this.props.children}}const J2=Yc((e=>({didRootSagaCrash:e.modal?.isShowingSagaError,isShowingInvalidClientError:e.modal?.isShowingInvalidClientError,defect:e.modal?.defect})))(Z2),{equalFrameCounts:Q2}=s;function X2(e){return Q2(e,0)?0:e}function e4(e,t){const n=e[t];if(void 0===n)throw new Error(`Could not get duration for id ${t}`);return n}function t4(e,t,n){if(Lx(t,n)===Lx(e,n))return;const r=function(e,t){const n={};let r=0;for(const o of bP(e,t)){const i=BP(e,t,o.id);n[o.id]=i,r+=i}return n[t]=r,n}(e,n),o=function(e,t){return Tp(bP(e,t))}(e,n),i=function(e,t,n,r,o){const i=bP(e,n),{tausData:a,getTauDataMaybe:s}=GV(t,n).tausAndDataBasic(),c=i.length,d=a.length;let l=0,u=0,f=0;function m(){if(u>=c)return;const e=i[u],t=[e,e4(r,e.id)*(e.audioSegment?.speed??1)];return u+=1,t}function p(){if(f>=d)return;const e=a[f],t=[e.tau,e.duration*(e.tau.audioSegment?.speed??1)];return f+=1,t}let g=m(),h=p();for(;g&&h;){const[e,t]=g,[n,r]=h;if(e.id!==n.id){if(e.audioSegment&&n.audioSegment&&e.audioSegment.mediaRefId!==n.audioSegment.mediaRefId)break;if(void 0!==o[n.id]&&o[n.id]>=u)break;const t=s(e.id);if(void 0!==t&&t.index>=f)break}if(Q2(t,r)){l+=Math.min(t,r),g=m(),h=p();continue}if(void 0===e.audioSegment&&void 0===n.audioSegment){l+=Math.min(t,r);break}if(void 0===e.audioSegment||void 0===n.audioSegment)break;const i=e.audioSegment.offset,a=n.audioSegment.offset,c=i+_F(e.audioSegment),d=a+_F(n.audioSegment);if(!Q2(i,a))break;l+=Math.min(t,r),Q2(c,d)?(g=m(),h=p()):c<d?(h=[{...n,audioSegment:{...n.audioSegment,offset:n.audioSegment.offset+t,duration:r-t,speed:1}},r-t],g=m()):(g=[{...e,audioSegment:{...e.audioSegment,offset:e.audioSegment.offset+r,duration:t-r,speed:1}},t-r],h=p())}return l}(e,t,n,r,o),a=_k(t,n),s=e4(r,n);if(Q2(i,a)&&Q2(a,s))return;const c=function(e,t,n,r,o){const i=bP(e,n),{tausData:a,duration:s}=GV(t,n).tausAndDataBasic(),c=i.length,d=a.length,l=e4(o,n),u=Math.max(0,Math.min(l,s)-r);let f=0,m=c-1,p=d-1;function g(){if(m<0)return;const e=i[m],t=[e,e4(o,e.id)];return m-=1,t}function h(){if(p<0)return;const e=a[p],r=[e.tau,BP(t,n,e.tau.id)];return p-=1,r}let v=g(),E=h();for(;v&&E&&f<u;){const[e,t]=v,[n,r]=E;if(e.id!==n.id&&e.audioSegment&&n.audioSegment&&e.audioSegment.mediaRefId!==n.audioSegment.mediaRefId)break;if(void 0===e.audioSegment||void 0===n.audioSegment){if(e.audioSegment!==n.audioSegment)break;if(f+=Math.min(t,r),Q2(t,r)){v=g(),E=h();continue}break}const o=e.audioSegment.offset,i=n.audioSegment.offset,a=o+_F(e.audioSegment),s=i+_F(n.audioSegment);if(!Q2(a,s))break;f+=Math.min(t,r),Q2(o,i)?(v=g(),E=h()):o<i?(v=[{...e,audioSegment:{...e.audioSegment,duration:i-o,speed:1}},i-o],E=h()):(E=[{...n,audioSegment:{...n.audioSegment,duration:o-i,speed:1}},o-i],v=g())}return Math.min(f,u)}(e,t,n,i,r);return{loc:i,added:X2(a-i-c),removed:X2(s-i-c)}}class n4 extends Error{constructor(e){super(e),this.type=e}static typeOf(e){return e instanceof n4?e.type:"unknown"}}function r4(e,t,n){if(n){Pp(e,t).audio?.studioSoundIntensity||(e=vO(e,t,"studioSoundIntensity",1))}return e=vO(e,t,"speechEnhanceEnabled",n)}var o4=n(32828);const i4=(0,pn.ZP)("OVERDUB_UI"),a4=i4("SET_FOCUSED_OVERDUB_INFO"),s4=i4("UNSET_FOCUSED_OVERDUB_INFO"),c4=(i4("SHOW_AI_SPEECH_VIDEO_SEQUENCES_WARNING_MODAL"),i4("HIDE_AI_SPEECH_VIDEO_SEQUENCES_WARNING_MODAL"),i4("SHOW_AI_SPEAKER_AUTHORIZATION_MODAL"),i4("HIDE_AI_SPEAKER_AUTHORIZATION_MODAL"),i4("UPDATE_AI_SPEAKER_GENERATION_CONTROLS"),i4("SET_AI_SPEAKER_BLOCK_CONTROLS_BY_BLOCK_KEY"),i4("SET_AI_SPEAKER_BLOCK_CONTROLS_BY_PARAGRAPH_INDEX"),i4("SHOW_BROWSE_STOCK_VOICES_MODAL_ACTION"),i4("IMMEDIATELY_AUTOGENERATED_AI_SPEECH"),(0,pn.Jy)("CLOUD_ARTIFACT")),d4=c4("REQUEST"),l4=c4.async("GENERATE"),u4=(c4("REMOVE"),c4("CANCEL")),f4=(c4("SHOW_TASK_CREATED_TOAST"),c4("SHOW_TASK_DONE_TOAST"),c4("CHECK_TASKS"),c4("SHOW_UPGRADE_TO_USE_TOAST"),c4("REQUEST_SHOW_PENDING_CLOUD_ARTIFACTS_MODAL"),c4("ARTIFACT_PROGRESS_UPDATED"),(0,pn.ZP)("DOCUMENT")),m4=(f4("SHOW_MANAGE_SPEAKER_LABELS"),f4("HIDE_MANAGE_SPEAKER_LABELS"),f4("DRAG_SPEAKER_LABEL"),f4("DRAG_MARKER")),p4=(f4("SHOW_CLIP_TO_COMPOSITION_SETTINGS"),f4("HIDE_CLIP_TO_COMPOSITION_SETTINGS"),f4("CHANGE_CLIP_TO_COMPOSITION_TARGET_TRACK"),f4("CHANGE_CLIP_TO_COMPOSITION_TARGET_FOLDER"),f4("UNDO"),f4("REDO"),f4("SET_UNDO_REDO_ENABLED")),g4=f4("DRAFT_CHANGE"),h4=f4("SET_TEXT_SELECTION"),v4=f4("DRAG_TEXT_SELECTION"),E4=f4("FINISH_SELECTION_DRAG"),y4=f4("DRAG_TIME_SELECTION"),S4=f4("SET_TIME_SELECTION"),I4=(f4("SET_QUASIMODE_SELECTION"),f4("EXPAND_TIME_SELECTION_TO_CLIP_BOUNDARIES"),f4("SET_SEARCH_TYPE"),f4("SET_SEARCH_RESULT_ACTION"),f4("SET_TEXT_SEARCH_FILTER"),f4("SET_CORRECT_TEXT_DEFAULT_VALUE"),f4("SET_TEXT_SEARCH_FILTER_TO_SELECTION"),f4("SET_FILLER_WORDS_SEARCH_FILTER"),f4("SET_WORD_GAP_SEARCH_FILTER"),f4("SET_HIGHLIGHTS_SEARCH_FILTER"),f4("SET_TEXT_LIST_SEARCH_FILTER"),f4("SET_SEARCH_SCOPE"),f4("TOGGLE_SEARCH_WHOLE_WORDS"),f4("TOGGLE_SEARCH_CASE_SENSITIVE"),f4("TOGGLE_SEARCH_RESULT_WRAP_AROUND"),f4("TOGGLE_SEARCH_RESULT_AUTO_ADVANCE"),f4("SET_SEARCH_RESULT_INDEX"),f4("SELECT_SEARCH_RESULT")),b4=(f4("SELECT_NEXT_SEARCH_RESULT"),f4("SELECT_PREVIOUS_SEARCH_RESULT"),f4("SELECT_SEARCH_RESULT_WITHIN_RANGE"),f4("INITIATE_PROJECT_SEARCH")),T4=(f4("PROJECT_SEARCH_REPLACE"),f4("PROJECT_SEARCH_APPLY"),f4("PROJECT_SEARCH_SHORTEN"),f4("PROJECT_SEARCH_DUPLICATE"),f4("DRAG_MEDIA_REFERENCE"),f4("DRAG_CLOUD_MEDIA"),f4("DRAG_TEMPLATE_CARD"),f4("START_DRAG_SELECTION"),f4("DRAG_OVER_CLIP"),f4("CLEAR_DRAG_OVER_CLIP"),f4("FINISH_DRAG_SELECTION"),f4("DRAG_PIN_COMPONENT"),f4("DRAG_PIN_COMPONENT_ENDPOINT"),f4("DRAG_PIN_COMPONENT_ENDPOINT_APPLY"),f4("DRAG_CUE"),f4("DRAG_CARD_BOUNDARY"),f4("DRAG_CARD"),f4("SET_DROP_TARGET_TYPE"),f4("TOGGLE_DRAG_FILE"),f4("TOGGLE_SHOWING_VIDEO_PANE")),w4=(f4("SET_SELECTED_FOLDER_ITEMS"),f4("SET_ACTIVE_MEDIA_REF")),C4=(f4("SET_SELECTED_COMPOSITION_FOLDER_ITEMS"),f4("TOGGLE_SELECTED_FOLDER_ITEMS"),f4("TOGGLE_SELECTED_COMPOSITION_FOLDER_ITEMS"),f4("SET_SELECTED_MEDIA_REFERENCE_IDS")),_4=f4("DID_SCROLL_TEXT"),A4=(f4("SET_TIMELINE_VIEWPORT_LEFT"),f4("SET_TIMELINE_PIXELS_PER_SECOND"),f4("DID_RESIZE_TEXT"),f4("SET_TEXT_MODE"),f4("SET_ACTIVE_PIN_COMPONENT")),R4=(f4("SELECT_TAU"),f4("SELECT_TAUS_RANGE"),f4("SELECT_ALL_ELEMENTS_IN_TRACK"),f4("SET_ACTIVE_CUE"),f4("SET_ACTIVE_STORYBOARD_CUE"),f4("SET_ACTIVE_EFFECT"),f4("SET_TRACK_INSPECTOR_ITEM_EXPANDED"),f4("ENSURE_TRACK_EFFECT_VISIBLE"),f4("SET_TRACK_TITLE_EDIT_STATE")),M4=f4("SET_TITLE_CLIP_EDIT_STATE"),D4=(f4("SET_SELECTED_TIMELINE_TOOL"),f4("SET_TEMPORARY_TIMELINE_TOOL"),f4("SET_TIMELINE_LAYER_DENSITY"),f4("SET_TIMELINE_EXPANDED"),f4("SET_LAYOUT_SECTION_EXPANDED")),O4=f4("SET_PROJECT_FOLDER_PANEL_OPEN"),x4=(f4("OVERRIDE_EMPTY_STATE"),f4("SHOW_CANVAS_DISABLED_BY_ANIMATION_TOAST"),f4("SHOW_LAYER_LOCK_STATE_TOAST"),f4("IGNORE_SEARCH_RESULT"),(0,pn.ZP)("EDITOR_RECORDING")),k4=(x4("REQUEST_POPOVER"),x4("OPEN_EDITOR_RECORDING_SCRIPT_POPOVER"),x4("HIDE_POPOVER"),x4("SET_MODE"),x4("SET_RECORDING_TARGET_TYPE"),x4("TOGGLE_RECORDING_TARGET_TYPE"),x4("UPDATE_AUDIO_METER_LAYOUT"),x4.async("START_RECORDING"),x4.async("STOP_RECORDING"),x4("ADD_MEDIA_REFS_TO_TARGET"),x4("ADD_CARD_STEPPING_TO_SCRIPT"),x4("REPLACE_MEDIA_IN_SCRIPT"),x4("TOGGLE_TRACK"),x4("UPDATE_TRACKS"),x4.async("COMPUTER_AUDIO/TOGGLE_ENABLED"),x4("CARD_STEP_INTERACTION"),x4("RECORDING_PAUSED"),x4("RECORDING_RESUMED"),x4("RECORDING_CANCELED"),x4("RECORDING_FAILED"),x4("STEP_TO_NEXT_CARD"),x4("ON_STEP_TO_NEXT_CARD")),N4=(x4("ON_SHOW_STEP_PREVIEW"),(0,pn.ZP)("LIVE_COLLAB")),P4=(N4("CONNECT"),N4("DISCONNECT"),N4("UPDATE_DOCUMENT")),L4=N4("RESTORE_VALID_DOCUMENT"),F4=N4("SHOW_HISTORICAL_VERSION"),U4=(N4("UPDATE_CLIENT_LIST"),N4("UPDATE_SYNC_STATUS"),N4("SYNC_ERROR"),N4("REQUEST_UPDATE_LAST_SYNC_TIME"),N4("UPDATE_LAST_SYNC_TIME")),B4=N4("ADD_PENDING_DOCUMENT_SAVE"),j4=N4("REMOVE_PENDING_DOCUMENT_SAVE"),V4=(N4("EXPORT_MERGE_DEBUG_INFO"),N4.async("RESET_PROJECT"),(0,pn.ZP)("WEBSHARE")),z4=V4("SET_PUBLISHED_PROJECT"),G4=V4("SET_PUBLISHED_PROJECT_OWNERS"),W4=V4("REFRESH_PUBLISHED_PROJECT"),H4=V4.async("UPDATE_PUBLISHED_PROJECT_THUMBNAIL"),q4=V4("WEB_SHARE_SET_ACTIVE_PROJECT"),$4=V4("SET_IS_DOCUMENT_PROCESSING"),K4=V4("SET_MEDIA_LOADING_IDLE"),Y4=V4("SET_MEDIA_LOADING"),Z4=V4("SET_MEDIA_LOADING_SUCCEEDED"),J4=V4("SET_MEDIA_LOADING_FAILED"),Q4=V4.async("SYNC_QUICK_RECORDING_PROJECT_WITH_PAGE_NAME"),X4=V4("AUTH_AND_POLL_PUBLISHED_PROJECT"),e5=V4("SET_FETCH_PUBLISHED_PROJECT_FAILED"),t5=V4("SET_VIEWS"),n5=(0,pn.ZP)("REGENERATE"),r5=n5("SET_FOCUSED_EDIT_BOUNDARY_INFO"),o5=n5("UNSET_FOCUSED_EDIT_BOUNDARY_INFO"),i5=(0,pn.ZP)();i5("UPDATE_SELECTED_SHARE_MODAL_TAB"),i5("REQUEST_SHARE_MODAL"),i5("SHOW_SHARE_MODAL");const a5=i5.async("PUBLISH_CONTENT"),s5=(i5("REQUEST_DOWNLOAD_PUBLISHED_PROJECT"),i5.async("REQUEST_DOWNLOAD_PUBLISHED_PROJECT"));i5("HIDE_PUBLISH_COMPLETE_MODAL_ACTION"),i5("SetPublishToThirdPartyErrorAction");i5("REQUEST_PUBLISH_MODAL"),i5("SHOW_PUBLISH_MODAL");const c5=(0,pn.Jy)("TRACKED_SELECTION"),d5=c5("TRACK"),l5=c5("UNTRACK");var u5=n(12071);function f5(){switch(ir.publishWebTarget.get()){case"local":return ua;case"staging":return ca;case"staging-api":return la;case"beta":return da;default:return sa}}async function m5(e,{publishedProjectId:t,updatePublishedProjectJson:n}){return await Rc(e,si.PUT,`/published_projects/${t}`,void 0,n)}async function p5(e,{publishedProjectId:t,thumbnail:n}){return await Rc(e,si.PUT,`/published_projects/${t}/thumbnail`,void 0,n,void 0,{})}async function g5(e,{publishedProjectId:t}){await Rc(e,si.DELETE,`/published_projects/${t}`)}async function h5(e,t){try{return await Rc(e,si.GET,`/published_projects/slugs/${t}`)}catch(E0){if(Wi(E0))return;throw E0}}async function v5(e,t){try{const n=await Rc(e,si.GET,`/published_projects/slugs/${t}/views`);return n.viewers=n.viewers.map(bl.fromJson),n}catch(E0){if(Wi(E0)||Vi(E0)||Gi(E0))return;throw E0}}async function E5(e,t){try{return await Rc(e,si.PUT,`/published_projects/slugs/${t}/views`)}catch(E0){if(Wi(E0))return;throw E0}}(0,T.MD)();const y5={...c,...i};const S5=/[.!?]"?$/;new RegExp(y5.BLANK_CARD_SYMBOL,"ug");const I5=bm(" ");function b5(e,t){const{isBlocked:n,audioSegment:r}=e.tau;if(n)return{words:[],trailingText:void 0};let{timeOffset:o,duration:i,linkedSubAlignment:a,renderedText:s}=e;const c=r?.offset??0,d=[];void 0!==t&&(s=Cm([t,s]));let l=a?.wordArrayView;l&&(l=hL(l,c,i));let u=0,f=0;return Zh.enumerateWords(s.string,((t,n,r,i,a,m)=>{const p=a+m,g=a>f?km(s,f,a):I5,h=km(s,r,r+i);let v,E,y,S=km(s,a,p);if(l){const e=Wg(l,u);y=e.speaker?.speakerId,e.tag&&(S=bm(`[${e.tag.label}]`)),v=Math.max(o,e.startTime-c+o),E=Math.max(o,e.endTime-c+o)}else{const t=e.getTimeOffsetForTextOffset(a),n=e.getTimeOffsetForTextOffset(p);v=Math.max(o,t+o),E=Math.max(o,n+o)}return d.push({speakerId:y,leadingNonWordText:g,text:S,textWithoutPunctuation:h,startTime:v,endTime:E,wordTextOffset:a}),f=p,u+=1,!1})),{words:d,trailingText:km(s,f,s.string.length)}}function*T5(e,t){for(const n of e)yield*w5(n,t)}function*w5(e,t){let n,r=[];for(const o of e){const{splitBefore:e=!1,splitAfter:i=!1}=t(o,n);n=o,r.length>0&&e&&(yield r,r=[]),r.push(o),i&&(yield r,r=[])}r.length>0&&(yield r)}function C5(e,t,n,r){const o=t.startTime-e.endTime;if(!(o<=0))return o>=n+r?(e.endTime+=r,void(t.startTime-=n)):n===r||o<n&&o<r?(t.startTime-=o/2,void(e.endTime=t.startTime)):void(n<=r?(t.startTime-=n,e.endTime=t.startTime):(e.endTime+=r,t.startTime=e.endTime))}function _5(e,t,n=[0,0],r,o=!1){const i=[];let a;const{tausData:s}=GV(e,t).tausAndDataLinkedSub();let c=s;if(r){const n=NP(e,t,r,{framerates:qp(e,t).videoMetadata});c=Kg(zg(s,n.location,n.length))}for(const d of c){const{words:e,trailingText:t}=b5(d,a);if(r){const{duration:t,offset:n}=r,a=n+t;for(const r of Yg(nh(zg(e),uh({startTime:n,endTime:a},(({startTime:e})=>e),(({endTime:e})=>e))),(e=>(e.startTime<n&&(e.startTime=n),e.endTime>a&&(e.endTime=a),o&&(e.startTime-=n,e.endTime-=n),e))))i.push(r)}else for(const n of e)i.push(n);a=t}if(i.length>0){const[e,t]=n;if(e>0||t>0){for(let n=1;n<i.length;n++)C5(i[n-1],i[n],e,t);i[0].startTime=Math.max(0,i[0].startTime-e),i[i.length-1].endTime+=t}}return i}function A5(e,t,n,r,o,i){let a=_5(e,t,r,o,i);return n&&(a=function(e,t){let n;const r=[];for(let o=0;o<e.length;o++){const i=e[o],{speakerId:a}=i;if(void 0===a||a===n)r.push(i);else{const{leadingNonWordText:e,startTime:n}=i,o=t(a);r.push({speakerId:a,text:o,textWithoutPunctuation:o,startTime:n,endTime:n,leadingNonWordText:e,wordTextOffset:i.wordTextOffset}),r.push({...i,leadingNonWordText:I5})}n=a}return r}(a,(t=>bm(fg(e,t).name+":")))),function(e){return T5(e,((e,t)=>({splitBefore:t?.speakerId!==e.speakerId||e.leadingNonWordText&&void 0!==Es.index(e.leadingNonWordText.string)})))}([a])}function R5(e,t){return t?fg(e,t).name:void 0}function M5(e,t,n){const r=_5(e,t);if(!r.length)return[];const o=[];let i,a=[],s=0;function c(){o.push({speaker:R5(e,i),text:a.join(" ")}),a=[]}for(const{speakerId:d,text:{string:l}}of r){if(d!==i&&s&&c(),s+=l.length,s>n)break;a.push(l),i=d}return c(),o}function D5(e,t,n){const{includeSpeakerNames:r,maxPauseDelta:o,splitOnSentence:i,wordPadding:a,timeRange:s,timeRangeOffset:c}=function({includeSpeakerNames:e=!0,splitOnSentence:t=!0,maxPauseDelta:n=2,...r}){return{splitOnSentence:t,includeSpeakerNames:e,maxPauseDelta:n,...r}}(n);let d=A5(e,t,r,a,s,c);return i&&(d=function(e){return T5(e,((e,t)=>({splitAfter:Boolean(S5.exec(e.text.string))})))}(d)),function(e,t){return T5(e,((e,n)=>({splitBefore:void 0!==n&&n.endTime-e.startTime>t})))}(d,o)}function O5(e,t,n){return Array.from(D5(e,t,n))}const x5={2:(e,t)=>(0,Me.fastDeepEqual)(e,t)},k5=em("computeCompositionSubtitleChunksArray");function N5(e,t,n=[0,0],r){const o=function(e){return T5(e,((e,t)=>({splitBefore:t?.speakerId!==e.speakerId})))}([_5(e,t,n,r)]);return fu(Array.from(o),(t=>void 0!==t[0].speakerId?{speakerId:t[0].speakerId,speakerName:fg(e,t[0].speakerId).name,startTime:t[0].startTime,endTime:t[t.length-1].endTime}:void 0))}const P5=rd("PUBLISHED");P5("PUBLISHED_PROJECTS",async function(e,{projectId:t}){return await Rc(e,si.GET,`/projects/${t}/published_projects`)}.bind(void 0,vt()),{refetchOnMount:!1,refetchOnWindowFocus:!1,staleTime:12e4});function L5(e,t="id"){return e.reduce(((e,n)=>({...e,[n[t]]:n})),{})}const F5=P5("PROJECTS",async function(e,{driveId:t}){const n=await async function(e,{driveId:t}){return await Rc(e,si.GET,`/drives/${t}/published_projects`)}(e,{driveId:t});return U5(t,...n),td.getQueryData([F5.cacheName,{driveId:t}])??{}}.bind(void 0,vt()),{refetchOnMount:!1,refetchOnWindowFocus:!1,staleTime:9e4});function U5(e,...t){td.setQueryData([F5.cacheName,{driveId:e}],((e={})=>(0,T.ZP)(e,(n=>{t.forEach((t=>{Object.entries(e).forEach((([e,{url_slug:r}])=>{t.url_slug===r&&delete n[e]})),n[t.id]=t}))}))))}function B5({driveId:e,publishedProjectId:t,onSuccess:n,onError:r,skipCacheUpdate:o}){const i=(0,Nt.useCallback)((t=>{n?.(),!o&&e&&U5(e,t)}),[n,e,o]),{mutate:a,status:s,error:c}=(0,u5.D)(m5.bind(void 0,vt()),{onSuccess:i,onError:r});return{updatePublishedProject:(0,Nt.useCallback)((async e=>{void 0!==t&&await a({publishedProjectId:t,updatePublishedProjectJson:e})}),[a,t]),isUpdating:"loading"===s,updateError:c}}function j5(e,t,n){const r=(0,Nt.useCallback)((()=>{td.setQueryData([F5.cacheName,{driveId:e}],(e=>(0,T.ZP)(e,(e=>{e&&void 0!==t&&delete e[t],n?.()}))))}),[e,n,t]),{mutate:o,status:i}=(0,u5.D)(g5.bind(void 0,vt()),{onSuccess:r});return{deletePublishedProject:(0,Nt.useCallback)((()=>{void 0!==t&&(o({publishedProjectId:t}),rt("published_project_deleted",{project_id:t}))}),[o,t]),deletionInProgress:"loading"===i}}P5("DOCUMENT_DATA",(async function({id:e,contents:{document:{cdn_url:t}},published_scene_id:n,publish_type:r}){try{const o=await fetch(t),i=await o.json(),a=vG(i,{coder:new gE(e,{},{})});return{duration:_k(a,n),transcriptPreview:"audiogram"!==r?M5(a,n,200):void 0}}catch{return{}}}),{enabled:!1,retry:!1});function V5(e){return{current:e,undos:[],redos:[]}}function z5(e,t,n){if(n>t)throw new Error("trimmedStackSize must be at most maxStackSize");let{current:r,undos:o,redos:i}=e;return o.length<=t&&i.length<=t?e:(o.length>t&&(o=o.slice(o.length-n)),i.length>t&&(i=i.slice(i.length-n)),{current:r,undos:o,redos:i})}function G5(e,t,n){const r=e[e.length-1],o=[...e];return r&&r.after===t?(o.pop(),o.push({before:r.before,after:n})):o.push({before:t,after:n}),o}function W5({undos:e,redos:t},n){return{current:n,undos:e,redos:t}}function H5({undos:e}){const{length:t}=e;if(0!==t)return e[t-1]}var q5=n(54383),$5=n.n(q5);const K5="search-all-highlights";var Y5=(e=>(e.Text="text",e.WordGaps="word_gaps",e.FillerWords="filler_words",e.AiActionClips="ai_action_clips",e))(Y5||{});function Z5(e,t){return{id:t.id,name:t.name,text:Fb(e,t.id).string}}function J5(e,t){return Z5(e,vk(e,t))}const Q5=(0,el.createSelector)((e=>e),(e=>Array.from(Qa(Ik(e),(t=>Z5(e,t))))));function X5(e,t){return{...t,timeRange:{offset:0,duration:0}}}function e3(e,t){return t}function t3(e,t,n){const r=Date.now(),o=void 0!==t?[J5(e,t)]:Q5(e),i=[];for(const a of o){const t=[],r=sj(e,a.id,void 0,!0,n);for(const{tauId:n,sortedRanges:o}of r){const r=FP(e,a.id,n);for(let i=0;i<o.length;i++){let{textRange:s,timeRange:c,word:d}=o[i];const l=2,u=wP(e,a.id,n).text.string,f=qs(s)-l,m=$s(s)-l,p=i>0?o[i-1].textRange:void 0;","===u.charAt(m)&&","===u.charAt(f)&&(!p||$s(p)<f)&&(s=Gs.get(f,s.length+l-1));const g=kU(e,a.id,n,s),h={offset:r+c.offset,duration:c.duration},v=t[t.length-1],E=v&&$s(v.textRange);if(v&&void 0!==E&&E===qs(g)&&void 0===ws.index(Bb(e,a.id,Math.max(0,E-2),E))){const{textRange:e,timeRange:n}=v;t[t.length-1]={timeRange:up(n,h),textRange:Js(e,g),word:d}}else t.push({timeRange:h,textRange:g,word:d})}}t.length>0&&i.push({matchedComposition:a,match:{text:{positions:t}},type:"filler_words"})}return{results:i,searchDuration:Date.now()-r,getPositionWithTime:e3}}var n3=(e=>(e.Project="Project",e.Composition="Composition",e))(n3||{});const r3={selectedResultIndex:void 0,textSearchFilter:"",fillerWordsSearchFilter:void 0,highlightsSearchFilter:void 0,textListSearchFilter:void 0,searchScope:"Project",searchType:Y5.Text,searchResultAction:void 0,matchWholeWords:!1,caseSensitive:!1,resultWrapAround:!0,autoAdvance:!0,correctTextDefault:"",ignoredRanges:{}};function o3({doc:e,activeCompositionId:t,activeItem:n,activeSequenceRefId:r}){return{doc:e,tracks:{},activeItem:n,activeCompositionId:t,activeSequenceRefId:r,selectedSequenceTausMap:void 0,activeSequenceCue:void 0,activeSequenceTrackId:void 0}}function i3({doc:e,activeCompositionId:t,activeSequenceRefId:n,activeItem:r}){return{docAndUndo:V5(o3({doc:e,activeCompositionId:t,activeItem:r,activeSequenceRefId:n})),navHistory:jG(e,r),lastEditMetadata:void 0,temporaryDocState:void 0,searchState:r3,compositions:{},shouldAutosave:!1,isPatch:!1,isDraggingFile:!1,isShowingVideoPane:!0,activeFolderItem:void 0,isShowingManageSpeakerLabels:!1,isShowingClipToCompositionSettings:!1,currentClipToCompositionTargetCompositionId:void 0,currentClipToCompositionTargetFolderId:void 0,currentHighlighterId:void 0,draggedMediaReferenceInfo:void 0,draggedSelectionInfo:void 0,draggedPinComponentId:void 0,draggedPinComponentEndpointId:void 0,draggedCueId:void 0,draggedSpeakerLabel:void 0,draggedMarkerId:void 0,draggedCardBoundaryId:void 0,draggedCardId:void 0,draggedCloudMedia:void 0,draggedTemplateCard:void 0,dragToInsertAtClipInfo:void 0,dropTargetType:void 0,trimmingPinTrackId:void 0,mediaRefSelection:void 0,selectedReferenceIds:new Set,selectedFolderItems:new Set,selectedCompositionItems:new Set,diarizationWizardModal:void 0,trackInspectorExpandedState:{},activeEffect:void 0,temporaryTimelineTool:void 0,isOutOfSyncWithPrimary:!1,assetJsonLastUpdated:{}}}const a3="ALWAYS_MERGE",s3="NON_UNDOABLE_KEY",c3=Object.freeze({mergeKey:s3,trackId:void 0,message:"merged",time:0,editRange:void 0,disableMergeTimeLimit:!1}),d3=Object.freeze({mergeKey:a3,trackId:void 0,message:"merged",time:0,editRange:void 0,disableMergeTimeLimit:!1});function l3(e,t){return{mergeKey:t?.mergeKey,message:e,trackId:t?.trackId,time:Date.now(),editRange:t?.editRange,disableMergeTimeLimit:t?.disableMergeTimeLimit??!1}}function u3(e,t){return void 0!==e.mergeKey&&e.mergeKey===t.mergeKey&&e.trackId===t.trackId&&(t.disableMergeTimeLimit||t.time-e.time<1e4)&&(!e.editRange||!t.editRange||t.editRange.location===$s(e.editRange)||e.editRange.location===$s(t.editRange))}function f3(e,t,n){switch(n.mergeKey){case s3:return W5(e,t);case a3:return function(e,t){const n=H5(e);if(void 0===n)return{...e,current:t};const r=G5(n.edits,e.current,t),o=[...e.undos];return o[o.length-1]={metadata:n.metadata,edits:r},{current:t,undos:o,redos:e.redos}}(e,t);default:return function(e,t,n,r){const o=H5(e),i=void 0!==r&&0===e.redos.length&&void 0!==o&&r(o.metadata,t),a=[...e.undos];let s;return void 0!==o&&i?(s=o.edits,a.pop()):s=[],s=G5(s,e.current,n),a.push({metadata:t,edits:s}),{current:n,undos:a,redos:[]}}(e,n,t,u3)}}const m3=new Set([Gu.Pin,Gu.Cue,Gu.CardBoundary]);function p3(e,t,n){let r;for(const o of Cb(e,t))if(m3.has(o.attribute.name)){if(o.range.location===t)continue;const e=n?$s(o.range):o.range.location;(void 0===r||Math.abs(e-t)<Math.abs(r-t))&&(r=e)}return void 0!==r?r:t}function g3(e,t,n){const r=e.string;return function(e,t,n,r){let o=Math.min(Math.max(t,0),e.string.length);const i=pc(e.string,o),a=$s(i),s=n?1:-1;for(;(n&&o<a||!n&&o>i.location)&&!r(o);)o+=s;return o}(e,t,n,(e=>mc(r,e,n)))}function h3(e,t,n,r,o,i){const a=tW(t),s=nW(t),c=XG(t);let d=a,l=s;r&&(d=i(e,a,c&&n)),o&&(l=i(e,s,c||n));const u=KG(d,l-d);return c?rW(u):u}function v3(e,t,n){if(eW(t)){return YG(p3(e,tW(t),n))}return h3(e,t,n,!0,!0,p3)}const E3={head:!0,tail:!0},y3={head:!1,tail:!1};var S3=(e=>(e[e.KeyboardMovingBackwards=0]="KeyboardMovingBackwards",e[e.KeyboardMovingForwards=1]="KeyboardMovingForwards",e[e.Mouse=2]="Mouse",e))(S3||{});function I3(e,t,n,r,o){const i=2!==r,a=1!==r;t=function(e,t){if(nW(e)<=t)return e;const n=t,r=tW(e);if(r>=n)return YG(n);const o=KG(r,n-r);return XG(e)?rW(o):o}(t,e.string.length);const s=eW(t)&&a||i&&a||!i&&XG(t);let c=v3(e,t,!s);const d=eW(c),l=!s;if(function(e,t){const{location:n}=pc(e.string,tW(t));for(const{name:r}of wb(e,n))if(r===Gu.ScriptClip||r===Gu.RecordingClip)return!0;return!1}(e,c))return function(e,t,n,r){const o=tW(t),i=nW(t),a=pc(e.string,o);if(i-a.location===1){if(n&&eW(n)){const e=KG(a.location,1);return r?e:rW(e)}if(r)return YG(Math.min($s(a)+1,e.string.length))}return t}(e,c,n,l);const{head:u,tail:f}=function(e,t,n){const r=tW(t),o=nW(t);if(n===NU.CorrectText){let t=!1;for(const{name:o}of wb(e,r))if(o===Gu.Tag){t=!0;break}let n=!1;if(o>r){for(const{name:r}of wb(e,o-1))if(r===Gu.Tag){n=!0;break}}else n=t;return{head:t,tail:n}}const i=JG(t);for(const{attribute:{name:a},range:s}of Cb(e,r))if(Qs(s,i)&&(a===Gu.Marker||a===Gu.ScratchText||a===Gu.InlineNote))return y3;return E3}(e,c,o);return c=function(e,t,n,r,o){return h3(e,t,o,n,r,g3)}(e,c,u,f,l),c=function(e,t){const n=e.string,r=tW(t),o=nW(t)-1;if(void 0===ys.index(n.charAt(r))||void 0===ys.index(n.charAt(o)))return t;if(r>0&&void 0!==ys.index(n.charAt(r-1))||o<n.length-1&&void 0!==ys.index(n.charAt(o+1)))return t;const i=Ts.index(n,Gs.get(0,r),!0);if(void 0!==i&&n.charAt(i)!==y5.PIN_COMPONENT_SYMBOL&&n.charAt(i)!==y5.CARD_BOUNDARY_SYMBOL&&n.charAt(i)!==y5.BLANK_CARD_SYMBOL){const e=o+1<n.length?n.charAt(o+1):void 0;return KG(i,o-i+1+(void 0!==e&&Is.contains(e)?1:0))}return t}(e,c),d&&(c=l?YG(nW(c)):function(e){return YG(tW(e))}(c)),c}const b3=T.ZP;function T3(e,t,n,r={}){const o=n.textOrTimeSelection,i=r.newSelection||o;if(tp(i)){const e=dp(i,0,void 0);return tp(o)&&ap(o,e)?o:e}const a=tp(o)?void 0:o,{isDragging:s=!1,isKeyboardEvent:c=!0,isSelectionMovingBackward:d=!1}=r;return s||0===i.loc&&0===i.delta&&(0,Me.fastDeepEqual)(o,i)?i:I3(Fb(e,t),i,a,c?d?S3.KeyboardMovingBackwards:S3.KeyboardMovingForwards:S3.Mouse,n.textMode)}const w3=e=>(0,T.Uy)(((t,n)=>{e(t.projects[n.projectId],n)})),C3=e=>(t,n)=>(0,T.Uy)(t,(t=>{const{projectId:r,compositionId:o}=n,i=t.projects[r].compositions;i[o]||(i[o]={...BG}),e(i[o],n,t.projects[r].docAndUndo.current.doc)}));function _3(e,t,n){for(const r of yk(n)){const o=e[r];if(o&&hk(t,r)){const e=o.textOrTimeSelection;if(tp(e)){const i=t4(t,n,r);i&&(o.textOrTimeSelection=qG(e,i))}else o.textOrTimeSelection=oW(Fb(t,r),Fb(n,r),e)}}}function A3(e,t,n){for(const{id:r}of n.compositions){R3(r,e[r],t,n)}}function R3(e,t,n,r){if(t?.trackedSelections&&t.trackedSelections.size>0&&hk(n,e)){const o=Fb(n,e),i=Fb(r,e);for(const[e,n]of t.trackedSelections)t.trackedSelections.set(e,I3(i,oW(o,i,n),n,S3.KeyboardMovingBackwards,NU.EditMedia))}}const M3=e=>(t,n)=>{const{projectId:r,rethrowError:o}=n,i=t.projects[r];if(!i){const e=new Error(`Attempt to edit project that isn't loaded: ${r}`);if(Ra(e,"document-reducer",{extra:{projectId:r}}),o)throw e;return t}let a=i.navHistory;try{const o=i.docAndUndo,s=o.current.doc,c=e(o,n,i);if(void 0===c)return t;let d,l;if(c.temporaryDocState)d={...i,temporaryDocState:c.temporaryDocState};else{const{docAndUndo:e,shouldAutosave:t=!0,isPatch:n=!1,preserveTemporaryDoc:r=!1,lastEditMetadata:u}=c;l=c.docAlert;const f=e.current.doc,m=(0,T.Uy)(e,(t=>{const{tracks:r,activeItem:i}=t.current;i&&kG(f,i)||(t.current.activeItem=mv(wk(f)));const c=VG(a);!Ov(i,c)&&Ov(i,o.current.activeItem)&&e.undos.length>o.undos.length&&(t.current.activeItem=c),n&&_3(r,s,f)})),{activeItem:p}=m.current;a=!p||Ov(p,o.current.activeItem)&&m.undos.length===o.undos.length&&m.redos.length===o.redos.length?function(e,t){let n=VG(e);for(;n;){const{location:r,history:o}=e;if(kG(t,n)){if(!(o.length>1&&n.id===o[r-1]?.id))break;n=VG(e={location:r-1,history:[...o.slice(0,r-1),...o.slice(r)]})}else n=VG(e={location:Math.min(r,o.length-2),history:[...o.slice(0,r),...o.slice(r+1)]})}return 0===e.history.length&&(e=zG(e,mv(wk(t)))),e}(a,f):zG(a,p),d={...i,lastEditMetadata:u,docAndUndo:z5(m,400,200),navHistory:a,shouldAutosave:t,isPatch:n,temporaryDocState:r?i.temporaryDocState:void 0}}return{...t,docAlert:l,projects:{...t.projects,[r]:d}}}catch(E0){const{context:r="replace"}=n;if(E0 instanceof LU||E0 instanceof n4||Ra(E0,"edit-document-m2",{extra:{context:r}}),o)throw E0;return{...t,docAlert:{alert:E0,context:r}}}},D3=e=>M3(((t,n,r)=>{const o=e(t.current,n,r);if(void 0===o)return;let{metadata:i,docUndoState:a,...s}=o;const{trackId:c,temporary:d=!1}=n;if(a=hE(a,"tracks",(0,T.Uy)(a.tracks,(e=>{A3(e,t.current.doc,a.doc)}))),d)return{temporaryDocState:a};const l=!o.disableTrackIdInference;return void 0===i.trackId&&void 0!==c&&l&&(i={...i,trackId:c}),{docAndUndo:f3(t,a,i),lastEditMetadata:i,...s}}));function O3(e,t){for(const n of Object.keys(e.tracks)){if(t===n)continue;const r=e.tracks[n],o=r.textOrTimeSelection;r.textOrTimeSelection=tp(o)?{offset:o.offset,duration:0}:KG(o.loc,0)}}const x3=e=>D3(((t,n)=>{let r,o=n.compositionId??n.trackId;void 0===o&&"composition"===t.activeItem?.type&&(r=hk(t.doc,t.activeItem.id));const i=e(t.doc,n,void 0!==o?t.tracks[o]:void 0);if(void 0===i)return;const{doc:a,selectionUpdate:s,...c}=i,d=a!==t.doc?{...t,doc:a}:t;return{docUndoState:(0,T.Uy)(d,(e=>{if(r&&r!==hk(a,r.id)&&(o=r.id),void 0!==o&&hk(a,o)){void 0===e.tracks[o]&&(e.tracks[o]={...aW});const t=e.tracks[o],n=Boolean(s&&s.isQuasimode),r=t.textOrTimeSelection,i=s&&n?{...s,newSelection:s.newSelection||t.preQuasimodeTextOrTimeSelection}:s;if(t.textOrTimeSelection=T3(a,o,t,i),s){const{isDragging:i,hasFocus:c,newSelection:d,clearActivePinComponent:l,clearOtherSelections:u,setActivePin:f,setSelectedTaus:m,setSelectedCard:p,clearActiveStoryboardCue:g,setActiveStoryboardCue:h}=s;if(t.preQuasimodeTextOrTimeSelection=n&&d?r:void 0,t.isDraggingSelection=!0===i,void 0!==c&&(t.hasFocus=c),l&&(t.activePinComponentId=void 0,t.selectedTausMap=void 0,t.activeCue=void 0,t.zoomToComponent=!1,t.selectedCardState=void 0),f&&(e.tracks[f.compositionId]||(e.tracks[f.compositionId]={...aW}),e.tracks[f.compositionId].activePinComponentId=f.componentId),m&&(e.tracks[m.compositionId]||(e.tracks[m.compositionId]={...aW}),e.tracks[m.compositionId].selectedTausMap=new Map([[m.trackId,new Set(m.tauIds)]]),e.tracks[m.compositionId].selectedCardState=void 0),p){e.tracks[p.compositionId].selectedCardState=p.selectedCardState,e.tracks[p.compositionId].selectedTausMap=void 0,e.tracks[p.compositionId].activeCue=void 0;const{selectedCardState:t}=p,{selectedCardState:n}=e.tracks[p.compositionId];if("cardLayerAtPlayhead"!==n?.type||"cardLayerAtPlayhead"===t?.type&&t.sourceTrackId===n.sourceTrackId&&t.sequenceTrackId===n.sequenceTrackId||(e.tracks[p.compositionId].activeStoryboardCue=void 0),"card"===t?.type&&"boundary"===t.highlight){const n=tT(a,o,t.startBoundaryId);e.tracks[p.compositionId].textOrTimeSelection={loc:mT(a,o,n).location+1,delta:0},e.tracks[p.compositionId].hasFocus="timeline"!==t.highlightOrigin}else{const t=e.tracks[p.compositionId].textOrTimeSelection,n=tp(t)?{...t,duration:0}:{...t,delta:0};e.tracks[p.compositionId].textOrTimeSelection=n}}g&&(t.activeStoryboardCue=void 0),h&&(e.tracks[h.compositionId]||(e.tracks[h.compositionId]={...aW}),e.tracks[h.compositionId].activeStoryboardCue=h.activeStoryboardCue),u&&O3(e,o)}}})),...c}})),k3=e=>(t,n,r)=>x3(((o,i)=>{const a=t(o,i);if(void 0!==a)return{doc:a,metadata:e,shouldAutosave:n,isPatch:r,preserveTemporaryDoc:!0}})),N3=k3(d3),P3=k3(c3),L3=e=>x3(((t,n,r)=>{const o=e(t,n,r);return{metadata:d3,doc:t,selectionUpdate:o,preserveTemporaryDoc:o.preserveTemporaryDoc}})),F3=(...e)=>(t,n)=>{let r;for(const o of e)t=o(t,n),r=r||t.docAlert;return r&&(t={...t,docAlert:r}),t};const U3=(0,o4.reducerWithInitialState)({projects:{},publishedProjects:{},docAlert:void 0,isAutomaticallyPaused:!1,lastReplacedCharacterAtTime:0}).case(q4,((e,{publishedProjectId:t,doc:n})=>{const r=wk(n);return{...e,projects:{...e.projects,[t]:i3({doc:n,activeCompositionId:r,activeItem:mv(r)})}}})).case(sY,((e,{projectId:t,publishedProjects:n})=>(0,T.Uy)(e,(e=>{e.publishedProjects[t]=L5(n.filter((e=>"audiogram"!==e.publish_type)),"source_scene_id")})))).case(pY,((e,{project:{id:t},doc:n,activeItem:r})=>{const o=e.projects[t],i="composition"===r?.type&&Sk(n,r.id)||o&&o.docAndUndo.current.activeCompositionId&&Sk(n,o.docAndUndo.current.activeCompositionId)||wk(n);let a;if("composition"===r?.type&&(r=mv(i)),"media_reference"===r?.type){const e=Lp(n,r.id);e?Ag(e)&&(a=r.id):r=mv(i)}return{...e,projects:{...e.projects,[t]:i3({doc:n,activeCompositionId:i,activeSequenceRefId:a,activeItem:r})}}})).case(CJ,F3(D3(((e,{sequenceRefId:t})=>({docUndoState:(0,T.Uy)(e,(e=>{e.activeSequenceRefId=t})),metadata:d3}))),w3(((e,{sequenceRefId:t})=>{t&&e.docAndUndo.current.doc.isStoryboard&&(e.selectedFolderItems=new Set([]))})))).case(dq,b3(((e,{playerKey:t})=>{"composition"===t&&(e.isAutomaticallyPaused=!1)}))).case(pq,b3(((e,{isCorrectTextPause:t,patientPlaybackPause:n,playerKey:r})=>{"composition"===r&&(e.isAutomaticallyPaused=Boolean(n||t))}))).case(hJ,C3(((e,{index:t})=>{e.scrollToIndex=t}))).case(yY,F3(D3(((e,{item:t})=>({docUndoState:(0,T.Uy)(e,(e=>{e.activeItem=t})),metadata:d3}))),w3(((e,{item:t,setAsSelected:n,selection:r})=>{n&&(e.selectedFolderItems=new Set([t]));const o=zG(e.navHistory,t);e.navHistory=o,e.mediaRefSelection=r})))).case(SY,F3(D3(((e,{compositionId:t})=>({docUndoState:(0,T.Uy)(e,(e=>{e.activeItem=mv(t)})),metadata:d3}))),w3(((e,{compositionId:t})=>{const n=mv(t),r=zG(e.navHistory,n);e.navHistory=r})))).case(a5.done,b3(((e,{params:{projectId:t,compositionId:n},result:r})=>{e.publishedProjects[t]||(e.publishedProjects[t]={}),e.publishedProjects[t][n]=r}))).case(z4,b3(((e,{publishedProject:t})=>{const{source_project_id:n,source_scene_id:r,state:o}=t;"success"===o&&(e.publishedProjects[n]||(e.publishedProjects[n]={}),e.publishedProjects[n][r]=t)}))).case(IY,F3(D3(((e,{sequenceRefId:t})=>({docUndoState:(0,T.Uy)(e,(e=>{e.activeItem=pv(t)})),metadata:d3}))),w3(((e,{sequenceRefId:t,selection:n})=>{if(t){const n=pv(t),r=zG(e.navHistory,n);e.navHistory=r}e.mediaRefSelection=n})))).case(TX,C3(((e,{inProgress:t})=>{e.bounceAudioInProgress=t}))).case(AJ,C3(((e,{hoveringInfo:t})=>{e.hoveringInfo=t}))).case(MJ,C3(((e,{cardBoundaryId:t,variant:n})=>{e.replaceInfo=t&&n?{cardBoundaryId:t,variant:n}:void 0}))).case(k4,C3(((e,{finish:t})=>{t&&(e.replaceInfo=void 0)}))).case(r5,C3(((e,{focusedEditBoundaryInfo:t})=>{e.focusedEditBoundaryInfo=t}))).case(o5,C3((e=>{e.focusedEditBoundaryInfo=void 0}))).case(a4,C3(((e,{focusedOverdubHoverInfo:t})=>{e.focusedOverdubHoverInfo=t}))).case(s4,C3((e=>{e.focusedOverdubHoverInfo=void 0}))).case(RJ,C3(((e,{focusedBlockedTextHoverInfo:t})=>{e.focusedBlockedTextHoverInfo=t}))).case(_4,C3(((e,{scrollTop:t,textOffset:n})=>{e.scrollPosition={textOffset:n,scrollTop:t}}))).case(sJ,L3((e=>({hasFocus:!1})))).case(cJ,L3((e=>({hasFocus:!0})))).case(PJ,P3(((e,{annotations:t})=>function(e,t){for(const{id:n}of Ik(e))e=KJ(e,n,t);return e}(e,t)),!1)).case(nJ.done,(e=>(t,n)=>e(t,{...n.params,result:n.result}))(P3(((e,{compositionId:t,annotation:{id:n}})=>function(e,t,n){const r=bP(e,t),o=Tf(n);function i({attribute:e}){return!(0,Me.fastDeepEqualJson)(o,e)}const a=hu(r,(e=>jM(e,Om(e.text,i))));return a===r?e:Cx(e,t,xx(Lx(e,t),a))}(e,t,n))))).case(v4,L3(((e,{selection:t})=>({newSelection:t,hasFocus:!0,isDragging:!0,isKeyboardEvent:!1,clearActivePinComponent:!0})))).case(E4,L3(((e,{hasFocus:t})=>({hasFocus:t,isDragging:!1,isKeyboardEvent:!1})))).case(h4,L3(((e,{selection:t,hasFocus:n,clearActivePinComponent:r=!0})=>({newSelection:t,clearActivePinComponent:r,preserveTemporaryDoc:!0,hasFocus:n,isKeyboardEvent:!1}))));var B3;U3.case(UJ,N3(((e,{mediaRefId:t,taskId:n})=>(e=vO(e,t,"roomtoneTaskId",n),vO(e,t,"roomtoneRequested",!0))))).case(BJ,P3(((e,{mediaRefId:t})=>Lp(e,t)?vO(e,t,"roomtoneTaskId",void 0):e))).case(LJ,x3(((e,{useRoomtone:t})=>({metadata:l3("change project setting - room tone"),doc:MG(e,"useRoomtoneOnGapClips",t)})))).case(IJ,x3(((e,{trackId:t,tauId:n,enableRoomtone:r})=>({metadata:l3("set room tone"),doc:KM(e,t,n,r)})))).case(jJ,P3(((e,{mediaRefId:t,roomtoneRefId:n})=>vO(e,t,"roomtoneRefId",n)))).case(VJ,x3(((e,{roomtoneRefId:t,gain:n})=>({metadata:l3("change room tone gain"),doc:DG(e,t,n)})))).case(zJ,x3(((e,{sequenceRefId:t,gain:n})=>({metadata:l3("change room tone gain"),doc:OG(e,t,n)})))).case(GJ,x3(((e,{trackId:t,roomtoneEnabled:n})=>{let r=vk(e,t);return r=function(e,t){return hE(e,"suppressRoomtone",t)}(r,!n),e=ix(e,r,!0),{metadata:l3("set roomtone"),doc:e}}))).case(FJ,x3(((e,{useRoomtone:t})=>({metadata:l3(t?"batch enable room tone":"batch disable room tone"),doc:xG(e,t)})))).case(TJ,x3(((e,{mediaRefId:t,intensity:n})=>{const r=Pp(e,t);return(Ag(r)?UA(e,t).filter((e=>{if(Cg(e))return e})):[r]).forEach((t=>{void 0!==t.audio?.studioSoundIntensity&&(e=vO(e,t.id,"studioSoundIntensity",n))})),{metadata:l3("set Studio Sound intensity"),doc:e}}))).case(bJ,x3(((e,{enabled:t,mediaRefIds:n})=>{for(const r of n){if(Ag(Pp(e,r))){UA(e,r).forEach((n=>{Cg(n)&&(t&&!n.audio?.studioSoundIntensity&&(e=vO(e,n.id,"studioSoundIntensity",1)),e=vO(e,n.id,"speechEnhanceEnabled",t))}))}else e=r4(e,r,t)}return{metadata:l3(t?"enable Studio Sound":"disable Studio Sound"),doc:e}}))).case(d4,x3(((e,{taskSpec:t,mediaRefId:n})=>{const r=Pp(e,n);switch(t.artifactType){case"background_mask":return P()(wg(r),"Can only generate Green Screen for video or image"),{metadata:l3("generate Green Screen"),doc:bg(r)?gO(e,n,"backgroundMaskRequested",!0):hO(e,n,"backgroundMaskRequested",!0)};case"eye_contact":return P()(bg(r),"Can only generate Eye Contact for video"),{metadata:l3("generate Eye Contact"),doc:gO(e,n,"eyeContactRequested",!0)};default:return}}))).case(l4.failed,(e=>(t,n)=>e(t,{...n.params,error:n.error}))(P3(((e,{taskSpec:t,mediaRefId:n})=>{const r=Pp(e,n);switch(t.artifactType){case"speech_enhanced":return P()(Cg(r),"Can only generate Studio Sound for audio"),vO(e,n,"speechEnhanceEnabled",!1);case"background_mask":return P()(wg(r),"Can only generate Green Screen for video or image"),bg(r)?gO(e,n,"backgroundMaskRequested",!1):hO(e,n,"backgroundMaskRequested",!1);case"eye_contact":return P()(bg(r),"Can only generate Eye Contact for video"),gO(e,n,"eyeContactRequested",!1);default:return e}})))),U3.case(F4,P3(((e,{doc:t})=>t))),U3.case(P4,M3(((e,{doc:t})=>{const n=e.current.doc;if(n===t)return;return{docAndUndo:W5(e,(0,T.Uy)({...e.current,doc:t},(e=>{_3(e.tracks,n,t),A3(e.tracks,n,t)}))),lastEditMetadata:{message:"update"},shouldAutosave:!1,preserveTemporaryDoc:!0}}))),U3.case(L4,M3(((e,{doc:t})=>{if(t!==e.current.doc)return{docAndUndo:V5(o3({doc:t,activeCompositionId:e.current.activeCompositionId,activeItem:e.current.activeItem})),lastEditMetadata:{message:"restore"},shouldAutosave:!1,preserveTemporaryDoc:!1}}))),U3.case(d5,D3(((e,{compositionId:t,selectionId:n,textSelection:r})=>({docUndoState:e=(0,T.Uy)(e,(o=>{o.tracks[t]||(o.tracks[t]={...aW}),o.tracks[t].trackedSelections||(o.tracks[t].trackedSelections=new Map),o.tracks[t].trackedSelections?.set(n,r),R3(t,o.tracks[t],e.doc,e.doc)})),metadata:d3,skipSelectionUpdate:!0})))).case(l5,(B3=(e,{selectionId:t})=>(e.trackedSelections?.delete(t),0===e.trackedSelections?.size&&(e.trackedSelections=void 0),{metadata:d3,skipSelectionUpdate:!0}),(e,t)=>{const{projectId:n}=t;P()(!(t.compositionId&&t.trackId),"ambiguous update: compositionId and trackId cannot both exist in payload");const r=t.compositionId??t.trackId;let o=l3("track updated");const i=e.projects[n].docAndUndo.current.tracks[r],a=(0,T.Uy)(i||aW,(i=>{const a=B3(i,t);a?.metadata&&(o=a.metadata),a?.skipSelectionUpdate||(i.textOrTimeSelection=T3(e.projects[n].docAndUndo.current.doc,r,i))}));if(a!==i){const t=(0,T.Uy)(e.projects[n].docAndUndo.current,(e=>{e.tracks[r]=a}));return{...e,projects:{...e.projects,[n]:{...e.projects[n],docAndUndo:z5(f3(e.projects[n].docAndUndo,t,o),400,200)}}}}return e}));const j3=U3.build();function V3(e,t,...n){const r=fu(n,(t=>{if(void 0!==t)return e(t)})),o=z3(...r);if(o)return t(o)}function z3(...e){const t=e.filter((e=>void 0!==e)),n=t[0];if(void 0===n)return;if(t.every((e=>(0,Me.fastDeepEqualJson)(n,e))))return n;let r;for(const o of e)if(void 0!==o)if(void 0!==r){for(const e in o)if(o.hasOwnProperty(e)){const t=o[e],n=r[e];t instanceof Array||n instanceof Array||"object"!==typeof t||"object"!==typeof n?void 0!==t&&null!==n&&(r[e]=t):r[e]=z3(n,t)}}else r=Object.assign({},o);return r}const G3=(0,pn.ZP)("BACKEND_VOICES"),W3=(G3("FETCH_BACKEND_VOICES"),G3("SET_BACKEND_VOICE_ACTION")),H3=G3("SET_BACKEND_VOICES_ACTION"),q3=(G3("UPDATE_VOICE_VERSION_STATUS_ACTION"),G3("UPDATE_DOCUMENT_VOICE_VERSION_STATUS_ACTION"),G3("SET_DEFAULT_BACKEND_VOICE"),G3.async("CREATE_BACKEND_VOICE")),$3=(G3.async("CREATE_BACKEND_VOICE_AND_UPLOAD_CONSENT"),G3.async("UPLOAD_BACKEND_VOICE"),G3.async("DUPLICATE_OVERDUB_TRAINING_PROJECT"),G3("REQUEST_NEW_SPEAKER_MODAL"),G3("REQUEST_SHARE_VOICE_MODAL"),G3("SHOW_CREATE_VOICE_STYLE_MODAL"),G3("HIDE_CREATE_VOICE_STYLE_MODAL"),G3("SET_MANAGE_VOICE_STYLES_MODAL"),G3.async("CREATE_VOICE_STYLE"),G3.async("DELETE_BACKEND_VOICE")),K3=G3.async("UPDATE_BACKEND_VOICE"),Y3=G3("CONFIRM_DELETE_BACKEND_VOICE_PERMISSION"),Z3=G3.async("DELETE_BACKEND_VOICE_PERMISSION"),J3=G3.async("CREATE_BACKEND_VOICE_PERMISSION"),Q3=G3.async("RETRAIN_VOICE");function X3(e,t){return(0,Me.fastDeepEqual)(e,t)?t:e}const e8=(0,pn.ZP)(),t8=(e8.async("CREATE_DRIVE_MEMBER_UPGRADE_REQUEST"),e8.async("HANDLE_DRIVE_MEMBER_UPGRADE_REQUEST")),n8=e8.async("FETCH_PENDING_DRIVE_MEMBER_UPGRADE_REQUESTS");e8("REQUEST_DRIVE_MEMBER_UPGRADE_REQUEST_MODAL");function r8(e,t){const n=new Set;return t.forEach((t=>{n.add(t.id);const r=V3(Wl,Gl,e.drives[t.id],t);void 0!==r&&(e.drives[r.id]=r)})),n}const o8=(0,o4.reducerWithInitialState)({drives:{},userDriveIdsForAdmin:{},invites:{},inviteLinks:{},inviteInProgress:!1,updateDriveInProgress:!1,pendingDriveMembershipUpgradeRequests:{},updateDriveMembershipInProgress:!1,driveFonts:{}}).case(k$.started,(e=>(0,T.ZP)(e,(e=>{void 0===typeof e.isLoading&&(e.isLoading=!0)})))).case(k$.done,((e,{result:{drive:t,isMember:n}})=>(0,T.ZP)(e,(e=>{e.drives[t.id]=X3(t,e.drives[t.id]),e.isLoading=!1})))).case(k$.failed,(e=>(0,T.ZP)(e,(e=>{e.isLoading=!1})))).case(U$.started,(e=>(0,T.ZP)(e,(e=>{e.updateDriveInProgress=!0})))).case(U$.done,((e,{result:{drive:t}})=>(0,T.ZP)(e,(e=>{e.updateDriveInProgress=!1,e.drives[t.id]=X3(t,e.drives[t.id])})))).case(U$.failed,(e=>(0,T.ZP)(e,(e=>{e.updateDriveInProgress=!1})))).case(B$.started,(e=>(0,T.ZP)(e,(e=>{e.deleteDriveInProgress=!0})))).case(B$.done,((e,{params:{driveId:t}})=>(0,T.ZP)(e,(e=>{e.deleteDriveInProgress=!1,delete e.drives[t]})))).case(B$.failed,(e=>(0,T.ZP)(e,(e=>{e.deleteDriveInProgress=!1})))).case(P$,((e,{drives:t})=>(0,T.ZP)(e,(e=>{r8(e,t)})))).case(N$.started,(e=>(0,T.ZP)(e,(e=>{void 0===typeof e.isLoading&&(e.isLoading=!0)})))).case(N$.done,((e,{result:t})=>(0,T.ZP)(e,(e=>{r8(e,t.drives),e.isLoading=!1})))).case(N$.failed,(e=>(0,T.ZP)(e,(e=>{e.isLoading=!1})))).case(L$.done,((e,{params:{userId:t},result:{drives:n}})=>(0,T.ZP)(e,(e=>{e.userDriveIdsForAdmin[t]=r8(e,n)})))).cases([cZ.done,dZ.done,lZ.done,uZ.done],((e,{params:{driveId:t},result:{driveInviteLinkObj:n}})=>(0,T.ZP)(e,(e=>{e.inviteLinks[t]=n})))).case(F$.started,(e=>(0,T.ZP)(e,(e=>{e.createDriveInProgress=!0,e.createDriveError=void 0})))).case(F$.done,((e,{result:{drive:t}})=>(0,T.ZP)(e,(e=>{e.createDriveInProgress=!1,e.drives[t.id]=t})))).case(F$.failed,((e,{error:t})=>(0,T.ZP)(e,(e=>{e.createDriveInProgress=!1,e.createDriveError=t})))).case(j$.done,((e,{params:{driveId:t},result:{invites:n}})=>(0,T.ZP)(e,(e=>{e.invites[t]=n})))).case(V$.started,b3((e=>{e.inviteInProgress=!0,e.inviteError=void 0}))).case(V$.done,b3(((e,{params:{driveId:t},result:{invites:n}})=>{for(const r of n){let n=e.invites[t];if(!n){n=[r];continue}const o=n.findIndex((({id:e})=>e===r.id));-1===o?n.push(r):n.splice(o,1,r)}e.inviteInProgress=!1}))).case(V$.failed,b3(((e,{error:t})=>{e.inviteError=t,e.inviteInProgress=!1}))).case(n8.started,((e,{driveId:t})=>(0,T.ZP)(e,(e=>{void 0===e.pendingDriveMembershipUpgradeRequests[t]?.isLoading&&(e.pendingDriveMembershipUpgradeRequests[t]={...e.pendingDriveMembershipUpgradeRequests[t],isLoading:!0})})))).case(n8.done,((e,{params:{driveId:t},result:{upgradeRequests:n}})=>(0,T.ZP)(e,(e=>{e.pendingDriveMembershipUpgradeRequests[t]={upgradeRequests:n,isLoading:!1}})))).case(n8.failed,((e,{params:{driveId:t},error:n})=>(0,T.ZP)(e,(e=>{e.pendingDriveMembershipUpgradeRequests[t]={...e.pendingDriveMembershipUpgradeRequests[t],isLoading:!1,error:n}})))).case(t8.started,((e,{driveId:t,upgradeRequestId:n})=>(0,T.ZP)(e,(e=>{e.updateDriveMembershipInProgress=!0,e.updateDriveMembershipError=void 0;const r=e.pendingDriveMembershipUpgradeRequests[t]?.upgradeRequests;if(r){const e=r.findIndex((({id:e})=>e===n));-1!==e&&r.splice(e,1)}})))).case(t8.done,((e,{params:{driveId:t,approve:n,driveMembershipId:r}})=>(0,T.ZP)(e,(e=>{const o=e.drives[t]?.memberships;if(o){const e=o.findIndex((({id:e})=>e===r));if(-1!==e){const t=o[e];o.splice(e,1,{...t,type:n?"editor":"free"})}}e.updateDriveMembershipInProgress=!1})))).case(t8.failed,(e=>(0,T.ZP)(e,(e=>{e.updateDriveMembershipInProgress=!1})))).case(J$,b3(((e,t)=>{t||(e.inviteError=void 0)}))).case(G$.done,((e,{params:{driveId:t,inviteId:n}})=>(0,T.ZP)(e,(e=>{const r=e.invites[t];void 0!==r&&(e.invites[t]=r.filter((({id:e})=>e!==n)))})))).case(X$.started,b3((e=>{e.updateDriveMembershipError=void 0,e.updateDriveMembershipInProgress=!0}))).case(X$.done,b3(((e,{result:{membership:t}})=>{e.updateDriveMembershipInProgress=!1;const n=jl(t),{driveId:r,id:o}=n,i=e.drives[r];if(!i)return;const a=e.pendingDriveMembershipUpgradeRequests[r]?.upgradeRequests;if(a){const e=a.findIndex((({driveMembershipId:e})=>e===o));-1!==e&&a.splice(e,1)}if(!i.memberships)return void(i.memberships=[n]);const s=i.memberships.findIndex((({id:e})=>e===o));-1!==s?i.memberships.splice(s,1,n):i.memberships.push(n)}))).case(X$.failed,b3(((e,{error:t})=>{e.updateDriveMembershipError=t,e.updateDriveMembershipInProgress=!1}))).case(eK,b3((e=>{e.updateDriveMembershipError=void 0}))).case(Z$.done,((e,{params:{driveId:t,membershipId:n}})=>(0,T.ZP)(e,(e=>{const r=e.drives[t].memberships;if(void 0===r)return;e.drives[t]={...e.drives[t],memberships:r.filter((({id:e})=>e!==n))};const o=e.pendingDriveMembershipUpgradeRequests[t]?.upgradeRequests||[],i=o.findIndex((({driveMembershipId:e})=>e===n));-1!==i&&o.splice(i,1)})))).case(Z3.done,((e,{params:{backendVoicePermission:{driveId:t,id:n}}})=>(0,T.ZP)(e,(e=>{if(t){const r=e.drives[t].voicePermissions;if(void 0===r)return;e.drives[t]={...e.drives[t],voicePermissions:r.filter((({id:e})=>e!==n))}}})))).case(J3.done,((e,{params:t,result:n})=>(0,T.ZP)(e,(e=>{const{driveId:t}=n;t&&(e.drives[t]={...e.drives[t],voicePermissions:[...e.drives[t].voicePermissions??[],n]})})))).case(q$.done,((e,{params:{driveId:t},result:{updatedDrive:n}})=>(0,T.ZP)(e,(e=>{void 0!==n&&(e.drives[t]=n)})))).cases([HY,fZ],b3(((e,{drive:t})=>{e.drives[t.id]=t}))).case(H$.started,b3((e=>{e.deleteDriveProductInProgress=!0}))).cases([H$.done,H$.failed],b3((e=>{e.deleteDriveProductInProgress=!1}))).case(gK.done,b3(((e,{result:{user:t}})=>{Object.keys(e.drives).forEach((n=>{const r=e.drives[n].memberships;void 0!==r&&(e.drives[n]={...e.drives[n],memberships:r.map((e=>e.user.id===t.id?{...e,user:t}:e))})}))}))).case(nK,((e,{driveId:t,fonts:n})=>(0,T.ZP)(e,(e=>{e.driveFonts[t]=n}))));const i8=o8.build();function a8(e){return Number(e.toFixed(3))}function s8(e,t,n){const r=new URL(e);return r.searchParams.set("t",String(a8(t))),n&&r.searchParams.set("end",String(a8(n))),r.toString()}function c8(){let e=document.location?.search??"";return e.startsWith("?")&&(e=e.substring(1,e.length)),(0,aZ.parse)(e)?.selectedAnnotation}function d8(){if("undefined"===typeof document)return;let e=document.location?.search??"";e.startsWith("?")&&(e=e.substring(1,e.length));const t=(0,aZ.parse)(e);return t.t?{start:Number(t.t),end:t.end?Number(t.end):void 0}:void 0}const l8={isLoading:!1,annotations:new Map,archivedAnnotations:new Map,isDraftingAnnotation:!1,comments:new Map,errors:new Map,annotationsLoaded:new Map,expandedAnnotationIds:new Set};function u8(e,t,n){const r=n.isArchived?e.archivedAnnotations:e.annotations,o=r.get(t);o?o.set(n.id,n):r.set(t,new Map([[n.id,n]]));(n.isArchived?e.annotations:e.archivedAnnotations).get(t)?.delete(n.id)}const f8=(0,o4.reducerWithInitialState)(l8).case(SY,(e=>{const t=[],n=c8();return n&&t.push(n),{...e,selectedAnnotationIds:new Set(t),hoveringAnnotationIds:void 0}})).case(QZ,((e,{annotations:t,archivedAnnotations:n,projectId:r})=>(0,T.ZP)(e,(e=>{!e.annotations.has(r)&&t.length&&e.annotations.set(r,new Map);const o=e.annotations.get(r);!e.archivedAnnotations.has(r)&&n.length&&e.archivedAnnotations.set(r,new Map);const i=e.archivedAnnotations.get(r);t.forEach((e=>{o?.set(e.id,e),i?.delete(e.id)})),n.forEach((e=>{i?.set(e.id,e),o?.delete(e.id)})),e.annotationsLoaded.set(r,!0)})))).case(XZ,((e,{comments:t,annotationId:n})=>(0,T.ZP)(e,(e=>{e.comments.set(n,t.reduce(((e,t)=>e.set(t.id,t)),new Map))})))).cases([tJ,cJ],((e,{projectId:t,annotation:n})=>(0,T.ZP)(e,(e=>{u8(e,t,n),e.isDraftingAnnotation=!1,e.errors.delete(n.id)})))).case(nJ.done,((e,{params:{projectId:t,annotation:{id:n,isArchived:r}}})=>(0,T.ZP)(e,(e=>{const o=r?e.archivedAnnotations:e.annotations,i=o.get(t);i&&(i.delete(n),0===i.size&&o.delete(t))})))).case(JZ,((e,{isLoading:t})=>(0,T.ZP)(e,(e=>{e.isLoading=t})))).case(sJ,((e,{projectId:t,annotation:n})=>(0,T.ZP)(e,(e=>{u8(e,t,n),e.isDraftingAnnotation=!0})))).case(uJ,((e,{projectId:t,annotation:n})=>(0,T.ZP)(e,(e=>{n.isArchived=!1,u8(e,t,n),e.lastArchivedAnnotation=void 0})))).case(lJ,((e,{projectId:t,annotation:n})=>(0,T.ZP)(e,(e=>{if(n.isNew)return e.annotations.get(t)?.delete(n.id),void(e.isDraftingAnnotation=!1);n.isArchived=!0,e.lastArchivedAnnotation=n,u8(e,t,n)})))).case(pJ,((e,{projectId:t,annotation:n,annotationId:r,error:o})=>(0,T.ZP)(e,(e=>{n&&u8(e,t,n),e.errors.set(r,o)})))).cases([dJ,rJ],((e,{comment:t})=>(0,T.ZP)(e,(e=>{const{annotationId:n}=t,r=e.comments.get(n);r?r.set(t.id,t):e.comments.set(n,new Map([[t.id,t]])),e.expandedAnnotationIds.add(n),e.errors.delete(n)})))).case(oJ.done,((e,{params:{annotationId:t,commentId:n}})=>(0,T.ZP)(e,(e=>{e.comments.get(t)?.delete(n)})))).case(iJ,((e,{annotationId:t})=>(0,T.ZP)(e,(e=>{e.expandedAnnotationIds.add(t)})))).case(aJ,((e,{annotationId:t})=>(0,T.ZP)(e,(e=>{e.expandedAnnotationIds.delete(t)})))).build();function m8(e,t){const n=e.playables[t];if(n)return n;const r={playable:void 0,source:void 0,currentlyPlayingId:void 0,playerError:void 0,signature:void 0,lastPlayedDate:void 0,aspectRatio:void 0,viewportPixelSize:void 0,playbackRate:1,isBuffering:!1,isPlaying:!1,isPlayingTime:void 0,tickCount:0};return e.playables[t]=r,r}function p8(e,t){const n=e.players[t];if(n)return n;const r=function(e){return{id:e,isTextEditorAutoScrollingWhilePlaying:!1,isTimelineAutoScrollingWhilePlaying:void 0,lastSeekOrigin:void 0,currentPlayheadTime:0,targetPlayheadTime:d8()?.start,hoverPlayheadTime:void 0,playheadTimeDelta:0,scrollToTime:void 0,endTimeOverride:void 0,playheadTimeOnAutoPause:void 0}}(t);return e.players[t]=r,r}function g8(e,t){const n=m8(e,t);if(void 0!==n.currentlyPlayingId)return p8(e,n.currentlyPlayingId)}function h8(e,t){const n=m8(e,t);n.tickCount+=1;const r=g8(e,t),o=n.playable;o&&r&&(r.currentPlayheadTime=o.currentTime)}function v8(e){for(const t of Object.values(e.players))t.hoverPlayheadTime=void 0}function E8(e,t,n,r){const o=g8(e,t);o&&(void 0!==n&&(o.isTextEditorAutoScrollingWhilePlaying=n),void 0!==r&&(o.isTimelineAutoScrollingWhilePlaying=r))}const y8=(0,o4.reducerWithInitialState)({playables:{},players:{}}).cases([hY.done,gY],(e=>(0,T.Uy)(e,(e=>{e.players={}})))).case(SY,((e,{compositionId:t})=>(0,T.Uy)(e,(e=>{m8(e,"composition").currentlyPlayingId=t})))).case(uq,(e=>(0,T.Uy)(e,v8))).case(bY,((e,{error:t})=>(0,T.Uy)(e,(e=>{const n=m8(e,"composition");n.playable=void 0,n.playerError=t})))).case(Oq,((e,{playable:t,source:n})=>(0,T.Uy)(e,(e=>{const r=m8(e,n.playerKey);r.playable!==t&&(r.playable=t,r.playerError=void 0),r.source=n})))).case(xq,((e,{playerKey:t})=>(0,T.Uy)(e,(e=>{const n=e.playables[t];n&&(n.playable=void 0,n.source=void 0)})))).case(kq,((e,{compositionId:t})=>(0,T.Uy)(e,(e=>{m8(e,"composition").currentlyPlayingId=t;p8(e,t).playheadTimeDelta=0,h8(e,"composition")})))).case(Nq,((e,{compositionId:t,selection:n})=>(0,T.Uy)(e,(e=>{const r=m8(e,"export_preview");r.currentlyPlayingId=function(e,t){return"export_preview:"+e+":"+JSON.stringify(t)}(t,n);p8(e,r.currentlyPlayingId).playheadTimeDelta=0,h8(e,"export_preview")})))).case(Pq,((e,{mediaRefId:t})=>(0,T.Uy)(e,(e=>{const n=m8(e,"media_reference");n.currentlyPlayingId=function(e){return Gq+e}(t);const r=p8(e,n.currentlyPlayingId);r.playheadTimeDelta=0,r.endTimeOverride=void 0,r.playheadTimeOnAutoPause=void 0})))).case(Lq,((e,{sequenceRefId:t})=>(0,T.Uy)(e,(e=>{const n=m8(e,"sequence");n.currentlyPlayingId=zq(t);const r=p8(e,n.currentlyPlayingId);r.lastSeekOrigin=void 0,r.playheadTimeDelta=0})))).case(dq,((e,{playerKey:t})=>(0,T.Uy)(e,(e=>{m8(e,t).lastPlayedDate=Date.now();const n=g8(e,t);n&&(n.lastSeekOrigin=void 0)})))).case(fq,((e,{playerKey:t})=>(0,T.Uy)(e,(e=>{const n=g8(e,t),r=m8(e,t);r.tickCount=0,r.isPlayingTime=Date.now(),r.isPlaying=!0,n&&(n.targetPlayheadTime=void 0)})))).case(SJ,b3((e=>{E8(e,"composition",!0,!0)}))).case(Bq,b3(((e,{playerKey:t})=>{E8(e,t,!0,!0)}))).case(jq,b3(((e,{playerKey:t,time:n})=>{const r=g8(e,t);r&&(r.scrollToTime=n)}))).case(Iq,((e,{playerKey:t})=>(0,T.Uy)(e,(e=>{m8(e,t).isBuffering=!0})))).case(bq,((e,{playerKey:t})=>(0,T.Uy)(e,(e=>{const n=m8(e,t),r=g8(e,t);r&&(r.targetPlayheadTime=void 0),n.isBuffering=!1})))).case(pq,((e,{playerKey:t})=>(0,T.Uy)(e,(e=>{m8(e,t)})))).case(gq,((e,{playerKey:t,timeOffset:n})=>(0,T.Uy)(e,(e=>{m8(e,t).isPlaying=!1;const r=g8(e,t);r&&(r.lastSeekOrigin=void 0,void 0!==n&&(r.currentPlayheadTime=n),r.playheadTimeOnAutoPause=void 0,r.endTimeOverride=void 0)})))).cases([Uq,_J,y4],(e=>(0,T.Uy)(e,(e=>{E8(e,"composition",void 0,!1),E8(e,"sequence",void 0,!1),E8(e,"media_reference",void 0,!1)})))).case(S4,((e,{timeRange:t})=>(0,T.Uy)(e,(e=>{t&&0!==t.duration&&(E8(e,"composition",void 0,!1),E8(e,"sequence",void 0,!1),E8(e,"media_reference",void 0,!1))})))).cases([Fq,wJ,kJ],(e=>(0,T.Uy)(e,(e=>{E8(e,"composition",!1,void 0)})))).case(v4,b3((e=>{E8(e,"composition",!1,!1),E8(e,"sequence",!1,!1)}))).case(I4,b3((e=>{E8(e,"composition",!0,!0),E8(e,"sequence",!0,!0)}))).case(g4,b3(((e,{options:t})=>{t.isSelectionEqualIgnoringFocus||E8(e,"composition",!1,void 0)}))).case(h4,b3(((e,{maintainAutoscrolling:t})=>{t||E8(e,"composition",!1,!1)}))).case(lq,((e,{timeOffset:t,playerKey:n})=>(0,T.Uy)(e,(e=>{const r=g8(e,n);r&&(r.hoverPlayheadTime=t)})))).cases([IY,CJ],((e,{playheadTime:t,sequenceRefId:n})=>(0,T.Uy)(e,(e=>{if(!n)return;m8(e,"sequence").currentlyPlayingId=zq(n);const r=g8(e,"sequence");r&&(r.targetPlayheadTime=t,r.lastSeekOrigin="timeline")})))).case(yq,((e,{timeOffset:t,origin:n,playerKey:r,endTimeOverride:o,playheadTimeOnAutoPause:i})=>(0,T.Uy)(e,(e=>{const a=g8(e,r);a&&(a.targetPlayheadTime=t,a.lastSeekOrigin=n,a.endTimeOverride=o,a.playheadTimeOnAutoPause=i)})))).case(Tq,((e,{playerKey:t,scrubbing:n})=>(0,T.Uy)(e,(e=>{const n=m8(e,t),r=g8(e,t);r&&(r.currentPlayheadTime=n.playable?n.playable.currentTime:0,r.targetPlayheadTime=void 0,r.playheadTimeDelta=0,r.isTextEditorAutoScrollingWhilePlaying=!0)})))).case(wq,((e,{playerKey:t})=>(0,T.Uy)(h8)(e,t))).case(Aq,((e,{rate:t,playerKey:n})=>(0,T.Uy)(e,(e=>{m8(e,n).playbackRate=t})))).case(Rq,((e,{alterRateBy:t,playerKey:n})=>(0,T.Uy)(e,(e=>{const r=m8(e,n);let o=Math.max(.5,Math.min(3,r.playbackRate+t));hd(o,1)&&(o=1),r.playbackRate=o})))).case(Mq,((e,{aspectRatio:t,playerKey:n})=>(0,T.Uy)(e,(e=>{m8(e,n).aspectRatio=t})))).case(Dq,((e,{playerKey:t,viewportPixelSize:n})=>(0,T.Uy)(e,(e=>{m8(e,t).viewportPixelSize=n})))).case(_q,((e,{playerKey:t,adjustedPlayheadTime:n})=>(0,T.Uy)(e,(e=>{const r=g8(e,t);r&&(r.playheadTimeDelta=n-r.currentPlayheadTime)})))).case(Cq,((e,{playerKey:t})=>(0,T.Uy)(e,(e=>{const n=g8(e,t);n&&(n.playheadTimeDelta=0)})))).build(),S8=(0,pn.ZP)("NETWORK")("NETWORK_STATUS_CHANGED");const I8=(0,o4.reducerWithInitialState)({status:"online"}).case(S8,b3(((e,{status:t})=>{e.status=t}))).build(),b8=(0,o4.reducerWithInitialState)({}).case(_K.done,b3(((e,{result:{card:t}})=>{e.card=t}))).cases([AK.started,LK],b3((e=>{e.errorCreditCard=void 0}))).case(AK.done,b3(((e,{result:{card:t}})=>{e.updatePlanError=void 0,e.card=t}))).case(AK.failed,b3(((e,{error:t})=>{e.errorCreditCard=t}))).case(RK,b3((e=>{e.card=void 0}))).cases([FK,WK],b3(((e,t)=>{void 0===t&&(e.updatePlanError=void 0)}))).cases([q$.started,Y$.started],b3((e=>{e.updatePlanInProgress=!0}))).cases([q$.done,Y$.done],b3((e=>{e.updatePlanInProgress=!1}))).cases([q$.failed,Y$.failed],b3(((e,{error:t})=>{e.updatePlanError=t,e.updatePlanInProgress=!1}))).case(gK.started,b3(((e,{userUpdates:t})=>{void 0!==t.referral_target_id&&(e.pendingReferralDriveId=t.referral_target_id)}))).case(gK.done,b3(((e,{result:{user:t}})=>{e.user=t}))).case(jK,b3((e=>{e.user=void 0}))).case(yK,b3(((e,{user:t})=>{e.user=t,e.fetchUserError=void 0,e.errorPassword=void 0,void 0===e.pendingReferralDriveId&&(e.pendingReferralDriveId=t.referralTargetId)}))).case(SK,b3(((e,{error:t})=>{e.fetchUserError=t}))).case(IK,b3((e=>{e.fetchUserDataLoading=!0}))).case(bK,b3((e=>{e.fetchUserDataLoading=!1,e.fetchUserDataError=void 0}))).case(TK,b3(((e,{error:t,sentryId:n})=>{e.fetchUserDataLoading=!1,e.fetchUserDataError={error:t,sentryId:n}}))).cases([UK.done,BK.done],b3(((e,{result:t})=>{e.dataConsentInfo=t}))).case(hK,b3(((e,{error:t})=>{e.errorPassword=t}))).case(vK,b3(((e,{error:t})=>{e.errorEmail=t}))).case(CK,b3(((e,{error:t})=>{e.deleteUserError=t}))).case(NK,b3((e=>{e.errorPassword=void 0,e.errorChangePasswordEmail=void 0}))).cases([kK,EK],b3((e=>{e.errorEmail=void 0}))).case(VK.failed,b3(((e,{error:t})=>{e.errorChangePasswordEmail=t}))).build(),T8=b8,w8=(0,pn.ZP)(),C8=(w8("CHECK_TRANSCRIPTION_LANGUAGE_AND_TRANSCRIBE"),w8("SHOW_PRE_TRANSCRIPTION_MODAL"),w8("TRANSCRIBE_MEDIA_REFERENCES"),w8("REQUEST_TRANSCRIBE_MEDIA_REFERENCES"),w8("IMPORT_TRANSCRIPT"),w8("ADD_TRANSCRIPT_RECEIPT"),w8("TRANSCRIPTION_COMPLETED"),w8("CHECK_TRANSCRIPTION"),w8("CHECK_TRANSCRIPTION_FOR_ACTIVE_PROJECT"),w8("CHECK_TRANSCRIPTION_STARTED")),_8=w8("CHECK_TRANSCRIPTION_FINISHED"),A8=(w8("DRAFT_IMPORT_TRANSCRIPTS"),w8("CLEAR_IMPORT_TRANSCRIPT"),w8("TRANSCRIPTION_FAILED"),w8("REQUEST_SHOW_INVALID_FILE_MODAL"),w8("REQUEST_HIDE_INVALID_FILE_MODAL"),w8("IMPORT_TRANSCRIPT_DELIVERED"),w8("SHOW_TRANSCRIPTION_TOAST"),w8("SET_POST_TRANSCRIPTION_MODAL_INFO"),w8("TRANSCRIPT_PROGRESS_CHANGED"),w8("REQUEST_LIVE_TRANSCRIPTION_UNAVAILABLE_TOAST"),(0,pn.ZP)());A8("SAVE_DATA");A8.async("SAVE_FILE"),A8.async("DOWNLOAD_ORIGINAL_ASSETS_PROGRESS"),A8("EXPORT_PROGRESS"),A8("EXPORT_ABORTED"),A8("EXPORT_CANCEL_REQUEST"),A8("BATCH_EXPORT_PROGRESS"),A8("OPEN_FILE_MANAGER"),A8("OPEN_FILE_MANAGER_FOR_CURRENT_USER"),A8("OPEN_FILE_MANAGER_FOR_CURRENT_PROJECT"),A8.async("SEND_DIAGNOSTIC_DATA");const R8=A8("FILE_UPLOAD_STARTED"),M8=A8("FILE_UPLOAD_FINISHED"),D8=(A8("SHOW_REPLACE_FILE_MODAL"),A8.async("REQUEST_REPLACE_FILE"),A8("REPLACE_LEGACY_ASSET"),A8.async("CONVERT_FILE"),A8("CONVERT_FILE_PROGRESS"),A8("DOWNLOAD_PROGRESS_ACTION"),A8("UNLINK_DATA_REF_ACTION"),(0,pn.ZP)("PROJECT_ADMIN")),O8=D8("PROJECTS_UPDATED"),x8=(D8("UNSYNC_PROJECT_FROM_DRIVE"),D8("UNSYNC_PROJECT_FROM_DRIVE_SUCCEEDED")),k8=(D8("REQUEST_SHOW_DELETE_PROJECT_MODAL"),D8("REQUEST_SHOW_BULK_DELETE_PROJECT_MODAL"),D8("REQUEST_HIDE_DELETE_PROJECT_MODAL"),D8("REQUEST_SHOW_BULK_MOVE_PROJECT_MODAL"),D8("REQUEST_HIDE_BULK_MOVE_PROJECT_MODAL"),D8.async("BULK_MOVE_ACTION")),N8=(D8("REQUEST_SHOW_DELETE_COMPOSITION_MODAL"),D8("REQUEST_HIDE_DELETE_COMPOSITION_MODAL"),D8("REQUEST_SHOW_CONFIRM_MOVE_PROJECT_FROM_DRIVE_TO_MY_WORKSPACE_MODAL"),D8("REQUEST_HIDE_CONFIRM_MOVE_PROJECT_FROM_DRIVE_TO_MY_WORKSPACE_MODAL"),D8("SET_PROJECT_NEEDS_CLEANUP")),P8=D8("CLEANUP_PROJECT_FILES"),L8=(D8("DELETE_PROJECT"),D8("DELETE_PROJECT_SUCCEEDED")),F8=(D8("DELETE_PROJECT_FAILED"),D8("REQUEST_SHOW_DUPLICATE_PROJECT_MODAL"),D8("REQUEST_HIDE_DUPLICATE_PROJECT_MODAL"),D8.async("DUPLICATE_PROJECT")),U8=(D8("SET_DUPLICATE_PROJECT_FOR_BUG_REPORT_MODAL"),D8("DUPLICATE_PROJECT_FOR_BUG_REPORT"),D8("COPY_PROJECT_LINK"),D8("SET_VERSION_HISTORY_VISIBLE")),B8=D8("SET_CLIP_INSPECTOR_VISIBLE"),j8=D8("SET_MIXER_VISIBLE"),V8=D8("SET_COMMENTS_SIDEBAR_VISIBLE"),z8=D8("SET_PROPERTIES_SIDEBAR_VISIBLE"),G8=(D8("REQUEST_SHOW_RENAME_PROJECT_MODAL"),D8("REQUEST_HIDE_RENAME_PROJECT_MODAL"),(0,pn.ZP)("PROJECT_OWNERSHIP")),W8=G8.async("FETCH_PROJECT_OWNERSHIPS"),H8=(G8.async("UPDATE_PROJECT_OWNERSHIP"),G8.async("DELETE_PROJECT_OWNERSHIP")),q8=G8.async("TRANSFER_PROJECT_OWNER"),$8=(0,pn.ZP)("UI"),K8=(0,pn.ZP)("UI/TIMELINE"),Y8=K8("SET_FOCUS"),Z8=K8("SET_LOCK"),J8=(0,pn.ZP)("UI/TIMELINE/VOLUME_KEYFRAME_CONTROL"),Q8=J8("SET_FOCUSED"),X8=J8("SET_DRAGGING"),e9=K8("SET_SNAP_TIME_OFFSET"),t9=K8("SET_TRIMMING"),n9=$8("SET_TIMELINE_VERTICALLY_OVERFLOWING"),r9=$8("SET_SELECTED_ANNOTATIONS"),o9=$8("SET_HOVERING_ANNOTATIONS"),i9=$8("SET_VISIBLE_TEXT_FORM_ANNOTATION_ID"),a9=$8("CLEAR_VISIBLE_TEXT_FORM_ANNOTATION_ID"),s9=$8("SET_SIDEBAR_PRIMARY_TAB"),c9=$8("SET_PROJECT_BROWSER_SEARCH_VISIBILITY"),d9=$8("SET_ACTIVE_BREAKPOINT"),l9=($8("SLOW_OP_MODAL"),$8("BETA_FEATURE_MODAL"),$8("SET_DEFECT"),$8("SET_ONBOARDING_STEP")),u9=($8("SHOW_VIDEO_PLAYER_MODAL"),$8("HIDE_VIDEO_PLAYER_MODAL"),$8("SET_CONDUCTOR_STATE")),f9=$8("PUSH_CONDUCTOR_STATE"),m9=$8("OPEN_CONDUCTOR_FILE_INPUT"),p9=$8("SET_SEARCH_ACTIVE");const g9=$8("SET_TIMELINE_CLIP_STYLE"),h9=$8("SET_PUBLISH_BROWSER_FILTER"),v9=($8("SET_INPUT_FOCUS_CHANGED"),$8("SET_SWITCH_COMPOSITION_TYPE_CHANGED"),$8("SET_SHOW_TEXT_MODE_TOAST")),E9=$8("SET_SYNC_INDICATOR_OPEN"),y9=$8("ADD_PROJECTS_TO_MULTISELECT"),S9=$8("TOGGLE_PROJECT_MULTISELECT"),I9=$8("CLEAR_PROJECT_MULTISELECT"),b9=$8("SET_HIDE_ONBOARDING"),T9=($8("DISMISS_UPGRADE_TO_STORYBOARD_PROMPT"),$8("SET_PLAYHEAD_MOVING_WITH_TEXT_CURSOR_ACTION")),w9=(0,pn.ZP)("REVISION"),C9=w9("SET_PROJECT_BASE"),_9=(w9("CREATE_REVISION"),w9("CREATE_AUTOSAVE_REVISION"),w9("RESTORE_REVISION")),A9=w9("CREATE_REVISION_STARTED"),R9=w9("SAVE_LOCAL_REVISION_STARTED"),M9=w9("SAVE_LOCAL_REVISION_COMPLETED"),D9=w9("CREATE_REVISION_PENDING"),O9=w9("CREATE_REVISION_FINISHED"),x9=w9("CREATE_REVISION_CONFLICTED"),k9=w9("CREATE_REVISION_FAILED"),N9=w9("RESTORE_REVISION_ENDED"),P9=w9("BASE_REVISION_UPDATED_MULTI_WINDOW"),L9=w9("RESTORE_LOCAL_REVISION_STARTED"),F9=w9("UPDATE_REVISION_UPLOAD_BATCH"),U9=w9("REMOVE_STALE_REVISIONS"),B9=w9("REVISION_UPLOAD_STARTED"),j9=w9("REVISION_UPLOAD_COMPLETED"),V9=w9("REVISION_UPLOAD_CONFIRMED"),z9=(w9("POLL_FOR_PROJECT_REVISIONS"),w9("NEW_REVISION_AVAILABLE")),G9=w9("FETCH_PROJECT_REVISIONS"),W9=w9("FETCH_PROJECT_REVISIONS_SUCCEEDED"),H9=(w9("DOWNLOAD_REVISION"),w9("DOWNLOAD_REVISION_PROGRESS_CHANGED")),q9=w9("DOWNLOAD_REVISION_SUCCEEDED"),$9=w9("DOWNLOAD_REVISION_FAILED"),K9={projects:{},userProjects:void 0,searchTerm:void 0,isSearchingProject:!1,isSearchingProjectBrowser:!1,localProjectSearchIds:void 0,remoteProjectSearchResults:void 0,isInsertingFileIntoScript:!1,revisions:{},transcriptReceiptIdsBeingFetched:new Set,isShowingMovePopover:!1,isShowingVersionHistory:!1,isShowingCommentsSidebar:!1,isShowingPropertiesSidebar:!0,wasShowingPropertiesSidebar:!0,isShowingMixer:!1,activeProjectId:void 0,activePublishedProjectId:void 0,backendVoices:new Map,templates:void 0,duplicateInProgress:!1,mediaLibraryPopoverSelectedSource:void 0,mediaLibraryPopoverSearchTerm:void 0,templatePopoverSelectedProjectId:void 0,isShowingMediaLibraryPopover:!1,isShowingSequenceEditorMediaLibraryPopover:!1,publishedProjectDownloadStatus:{},generativeMediaPrompt:void 0,generativeMediaError:void 0,generativeMediaInProgressInfo:void 0};function Y9(){return{project:void 0,loadContext:void 0,users:void 0,downloaded:!1,fileUploads:new Set,creating:{liveCollab:!1,revision:!1},activating:!1,fetchingContents:!1,fetchingOwnerships:!1,fileSaveProgress:{},assetQuality:void 0,folderExpandedMap:{},cachedOriginalFiles:!1,docSyncMetadata:void 0,pendingActiveItem:void 0,pendingAddedFiles:{},activeHistoricalVersion:void 0,quickRecordingInfo:{shouldFocusCompositionTitle:!1,waitingForArtifact:!1,waitingForDoc:!1}}}function Z9(){return{type:"revision",revisionIds:new Set,latestRevisionSummary:void 0,creatingRevision:!1,unsavedRevisionModification:!1,fetchingRevisions:!1,duplicatingRevision:!1,localSaveRevisionIds:{},localRestoreRevisionIds:{},savingRevisionIds:new Set,latestBaseRevision:void 0,cloudBaseDoc:void 0,cloudBaseRevision:void 0}}function J9(e,t){const n=e.projects[t];if(n)return n;const r=Y9();return e.projects[t]=r,r}function Q9(e,t){const n=J9(e,t.id);if(n.project=t,!n.docSyncMetadata||t.isLiveCollabEnabled)t.isLiveCollabEnabled?n.docSyncMetadata={type:"live-collab",pendingDocumentSaves:{}}:n.docSyncMetadata=Z9();else if(!t.isLiveCollabEnabled&&"live-collab"===n.docSyncMetadata.type)throw function(){const e=new Error("Project is not marked live collab but it's docSyncMetadata is type live-collab");return e.name=Oi,e}();return n}function X9(e){return b3(((t,n)=>{const r=e6(n)?n.project.id:void 0!==n.projectId?n.projectId:n.params.projectId;e(t,J9(t,r),n)}))}function e6(e){return void 0!==e.project}function t6(e=(()=>{})){return b3(((t,n)=>{const r=e6(n)?n.project:n.result.project;e(t,Q9(t,r),n)}))}function n6(e,t,n,r){if("revision"===n.docSyncMetadata?.type)if(0!==r.length){for(const e of r)n.docSyncMetadata.revisionIds.add(e.revisionId);r.forEach((n=>{const r=n.revisionId,o=(0,T.Js)(t.revisions),i=o&&o[r];if(i&&!i.isNew&&n.isNew)return void Ma(new Error("attempting to add isNew=true revision on top of isNew=false"),{type:"add-project-revision",projectId:e,revisionId:r});const a=V3((e=>e),(e=>e),i,n);a&&(t.revisions[r]=a)}))}else Ma("addProjectRevisions called with no revisions!")}function r6(e,t,n){const r=e.projects[t];let o=r.docSyncMetadata;if("revision"!==o?.type)throw new Error(`Cannot update cloud base doc. docSyncMetadata is type: ${o?.type}`);return o={...o,cloudBaseDoc:n},{...e,projects:{...e.projects,[t]:{...r,docSyncMetadata:o}}}}function o6(e,t){return{...e,result:void 0!==e.result?t(e.result):void 0}}const i6={endpoint:"speech_enhancement",payloadJsonFromPayload:function(e){return{audio_asset_id:e.assetId,audio_artifact_id:e.artifactId}},resultFromResultJson:function(e){return{assetId:e.speech_enhancement_audio_asset_id,artifactId:e.speech_enhancement_audio_artifact_id}}},a6=(function({endpoint:e,resultFromResultJson:t}){}(i6),function({endpoint:e,payloadJsonFromPayload:t,resultFromResultJson:n}){}(i6),{name:"studio_sound",displayName:"Studio Sound",type:"blocking",errorCategory:Oa.StudioSound,artifactType:"speech_enhanced",inputArtifactType:"original",spec:i6,validTypes:["audio"],upgradeOrigin:zK.GenerateStudioSound,spanName:"AIFeature.studioSound"}),s6={display:"Files",id:"project-files",mediaTypes:["audio","image","video"]};const c6=(0,pn.ZP)("QUICK_RECORDING"),d6=(c6("UPDATE_AUDIO_VIDEO_DEVICES"),c6("UPDATE_AUDIO_DEVICES"),c6.async("FETCH_VIDEO_DEVICES"),c6("NAVIGATOR_MEDIA_DEVICES_CHANGED"),c6("START_QUICK_EDIT_RECORDING"),c6("FINISH_QUICK_EDIT_RECORDING"),c6.async("PUBLISH_QUICK_EDIT_RECORDING"),c6.async("DELETE_QUICK_EDIT_RECORDING"),c6("DELETE_QUICK_EDIT_FILLER_WORDS"),c6("SET_QUICK_EDIT_DELETING"),c6("QUICK_RECORDING_LIVE_TRANSCRIPTION_COMPLETED"),c6.async("SCREEN_RECORDING_MEDIA_REVISION_CREATED"),c6("SCREEN_RECORDING_ORIGINAL_MEDIA_SYNCED"),c6("REQUEST_MIC_PERMISSIONS"),c6("REQUEST_CAMERA_PERMISSIONS"),c6("REQUEST_SCREEN_PERMISSIONS"),c6("MULTIPLE_FAILED_PROMPT_ATTEMPTS"),c6.async("QUERY_PERMISSIONS"),c6("DUPLICATE_TO_QUICK_RECORDER_PROJECT_STORYBOARD"),c6("PUBLISH_QUICK_RECORDER_PROJECT"),c6("QUICK_RECORDING_PROJECT_INITIALIZING")),l6=c6("QUICK_RECORDING_ARTIFACT_READY"),u6=(0,pn.ZP)("LIVE_COLLAB_MIGRATION"),f6=(u6("CHECK_PROJECT_STATUS"),u6("SET_MIGRATION_PROJECT_METADATA"));u6("CHECK_USER_STATUS");function m6(e){e.activeProjectId=void 0}function p6(e){switch(e){case"original":return"originalStatus";case"proxy":return"proxyStatus";case"transcribable":return"transcriptionStatus";case"speech_enhanced":return"speechEnhanceStatus";default:return}}const g6=(h6=(0,o4.reducerWithInitialState)(K9),h6.case(P9,X9(((e,t,{revisionId:n})=>{if("revision"!==t.docSyncMetadata?.type||void 0!==t.activeHistoricalVersion)return;const r=e.revisions[n];r&&(t.docSyncMetadata.latestBaseRevision=r)}))).case(R9,X9(((e,t,{revisionId:n})=>{"revision"===t.docSyncMetadata?.type&&(t.docSyncMetadata.localSaveRevisionIds[n]=!0)}))).case(L9,X9(((e,t,{revisionId:n})=>{if("revision"!==t.docSyncMetadata?.type)throw new Error("RestoreLocalRevisionStartedAction: docSyncMetadata has not been initialized");t.docSyncMetadata.localRestoreRevisionIds[n]=!0,t.docSyncMetadata.localSaveRevisionIds[n]=!0}))).case(H9,((e,{projectId:t,progress:n})=>{const r=e.projects[t];return r&&(0,Me.fastDeepEqual)(n,r.downloadProgress)?e:(0,T.ZP)(e,(e=>{J9(e,t).downloadProgress=n}))})).case($9,X9(((e,t)=>{t.downloadProgress=void 0}))).case(q9,X9(((e,t,{didDownloadAssets:n})=>{n&&(t.downloaded=!0,t.downloadProgress=void 0)}))).case(G9,X9(((e,t)=>{"revision"===t.docSyncMetadata?.type&&(t.docSyncMetadata.fetchingRevisions=!0)}))).case(W9,X9(((e,t,{projectId:n,revisions:r})=>{t.docSyncMetadata&&(n6(n,e,t,r),"revision"===t.docSyncMetadata.type&&(t.docSyncMetadata.fetchingRevisions=!1))}))).case(_9,X9(((e,t)=>{if("revision"!==t.docSyncMetadata?.type)throw new Error("RequestRestoreRevisionAction called on non-revision project");t.docSyncMetadata.duplicatingRevision=!0}))).case(N9,X9(((e,t)=>{if("revision"!==t.docSyncMetadata?.type)throw new Error("RestoreRevisionEndedAction called on non-revision project");t.docSyncMetadata.duplicatingRevision=!1}))).case(U9,X9(((e,t,{staleRevisionIds:n})=>{if("revision"===t?.docSyncMetadata?.type)for(const r of n)t.docSyncMetadata.revisionIds.delete(r),delete e.revisions[r]}))).case(V9,X9(((e,t,{revisionId:n})=>{"revision"===t.docSyncMetadata?.type&&(delete t.docSyncMetadata.localSaveRevisionIds[n],delete t.docSyncMetadata.localRestoreRevisionIds[n])}))).case(vJ,X9(((e,t)=>{"revision"===t.docSyncMetadata?.type&&(t.docSyncMetadata.unsavedRevisionModification=!0)}))).case(A9,X9(((e,t,{revisionId:n})=>{"revision"===t.docSyncMetadata?.type&&(t.docSyncMetadata.unsavedRevisionModification=!1,t.docSyncMetadata.creatingRevision=!0,t.docSyncMetadata.savingRevisionIds.add(n))}))).case(M9,X9(((e,t,{projectId:n,revision:r})=>{t.docSyncMetadata&&(n6(n,e,t,[r]),"revision"===t.docSyncMetadata.type&&(void 0!==t.docSyncMetadata.latestBaseRevision&&r.baseRevisionId!==t.docSyncMetadata.latestBaseRevision.revisionId||(t.docSyncMetadata.latestBaseRevision=r),t.docSyncMetadata.unsavedRevisionModification=!1,t.docSyncMetadata.savingRevisionIds.delete(r.revisionId)))}))).case(B9,X9(((e,t,{revision:n})=>{"revision"===t.docSyncMetadata?.type&&t.docSyncMetadata.savingRevisionIds.add(n.revisionId)}))).case(j9,X9(((e,t,{projectId:n,revision:r})=>{t.docSyncMetadata&&(n6(n,e,t,[r]),"revision"===t.docSyncMetadata.type&&t.docSyncMetadata.savingRevisionIds.delete(r.revisionId))}))).cases([O9,D9],X9(((e,t,{newRevision:n})=>{"revision"===t.docSyncMetadata?.type&&(t.docSyncMetadata.creatingRevision=!1,t.docSyncMetadata.savingRevisionIds.delete(n.revisionId))}))).cases([x9,k9],X9(((e,t,{revisionId:n})=>{"revision"===t.docSyncMetadata?.type&&(t.docSyncMetadata.creatingRevision=!1,t.docSyncMetadata.savingRevisionIds.delete(n))}))).case(C9,((e,{projectId:t,cloudBaseDoc:n,cloudBaseRevision:r,isLocalRevision:o})=>r6(e=(0,T.ZP)(e,(e=>{const n=J9(e,t);if("revision"!==n.docSyncMetadata?.type)throw new Error("RevisionDocUpdateAction should not be executed on non-revision projects");n.docSyncMetadata.cloudBaseRevision=r,o||(n.docSyncMetadata.latestBaseRevision=r),n.docSyncMetadata.revisionIds.has(r.revisionId)||n6(t,e,n,[r])})),t,n))).case(z9,X9(((e,t,{revisionId:n,revisionNumber:r})=>{if("revision"!==t.docSyncMetadata?.type)throw new Error("NewRevisionAvailableAction not supported on this project.");t.docSyncMetadata.latestRemoteRevision&&t.docSyncMetadata.latestRemoteRevision.revisionNumber>r||(t.docSyncMetadata.latestRemoteRevision={id:n,revisionNumber:r})})))).case(q4,b3(((e,{publishedProjectId:t})=>{e.activePublishedProjectId=t}))).cases([yY,SY],X9(((e,t,{projectId:n})=>{e.activeProjectId=n}))).case(R8,X9(((e,t,{basename:n})=>{t.fileUploads.add(n)}))).case(M8,X9(((e,t,{basename:n})=>{t.fileUploads.delete(n)}))).case(O8,((e,{projectsAndRevisionSummaries:t,projectIdsToDownloadedMap:n,removeUnused:r})=>(0,T.ZP)(e,(e=>{const o=new Set(e.userProjects),i=new Set(e.userProjects);t.forEach((({project:t,revisionSummary:r})=>{const{id:a}=t;o.add(a),i.delete(a);const s=Q9(e,t);r&&"revision"===s.docSyncMetadata.type&&(s.docSyncMetadata.latestRevisionSummary=r);const c=n.get(a);void 0!==c&&(s.downloaded=c)})),r&&i.forEach((e=>{o.delete(e)})),e.userProjects=o})))).case(vY,X9(((e,t,{context:n})=>{t.loadContext=n}))).case(EY,X9(((e,t)=>{t.loadContext=void 0}))).case(hY.started,X9(((e,t)=>{t.activating=!0}))).case(hY.done,t6(((e,t,{result:{activeItem:n}})=>{e.activeProjectId=t.project.id,e.isShowingMovePopover=!1,t.activating=!1,t.pendingActiveItem=n}))).case(hY.failed,X9(((e,t)=>{e.isShowingMovePopover=!1,t.activating=!1}))).case(pY,(function(e,{project:t,revisionProjectMetadata:n,versionHistoryItem:r}){return t.isLiveCollabEnabled?(P()(!n,"Supplying revisionProjectMetadata on live collab projects is not supported."),function(e,t,n){return(0,T.ZP)(e,(e=>{const r=Q9(e,t);delete r.pendingActiveItem,n&&(r.activeHistoricalVersion={versionHistoryItem:n,status:"active"})}))}(e,t,r)):(P()(n,"Supplying revisionProjectMetadata is required for revision projects."),function(e,t,n,r){return r6(e=(0,T.ZP)(e,(e=>{const o=Q9(e,t);delete o.pendingActiveItem,r&&(o.activeHistoricalVersion={versionHistoryItem:r,status:"active"});const{activeRevision:i,baseRevision:a,isHistoricalRevision:s,localSaveRevisionIds:c}=n;n6(t.id,e,o,[i]),o.docSyncMetadata.cloudBaseRevision=a,s||(o.docSyncMetadata.latestBaseRevision=i),o.docSyncMetadata.localSaveRevisionIds=c})),t.id,n.baseDoc)}(e,t,n,r))})).case(gY,b3((e=>{m6(e)}))).case(oY,X9(((e,t,{dependencyType:n})=>{t.creating[n]=!1}))).case(_8,b3(((e,{receiptId:t})=>{e.transcriptReceiptIdsBeingFetched.delete(t)}))).case(C8,b3(((e,{receiptId:t})=>{e.transcriptReceiptIdsBeingFetched.add(t)}))).case(BY,X9(((e,t)=>{t.activeHistoricalVersion=void 0}))).case(cY,X9(((e,t,{error:n})=>{t.fetchError=n||new Error("Could not fetch project"),t.fetchingContents=!1,t.fetchingOwnerships=!1,"revision"===t.docSyncMetadata?.type&&(t.docSyncMetadata.fetchingRevisions=!1),m6(e)}))).case(F9,b3(((e,t)=>{for(const{projectId:n,totalJobCount:r,remainingJobCount:o}of t){J9(e,n).saveProgress=0===o?void 0:(r-o)/r}}))).case(LY,X9(((e,t,{files:n})=>{t.pendingAddedFiles={...t.pendingAddedFiles,...n}}))).case(FY,X9(((e,t,{assetIds:n})=>{n.forEach((e=>{delete t.pendingAddedFiles[e]}))}))).case(rY.started,((e,{newProjectId:t,currentUser:n,isLiveCollabEnabled:r})=>(0,T.ZP)(e,(e=>{const o=Y9();o.users=[n],o.creating=r?{revision:!1,liveCollab:!0}:{revision:!0,liveCollab:!1},o.docSyncMetadata=r?{type:"live-collab",pendingDocumentSaves:{}}:Z9(),e.projects[t]=o})))).case(fY,X9(((e,t,{revisionId:n,error:r})=>{n&&"revision"===t.docSyncMetadata?.type&&t.docSyncMetadata.savingRevisionIds.delete(n),t.saveError=r}))).case(TY,X9(((e,t,{error:n})=>{t.saveError=n}))).case(nY.started,((e,{projectId:t})=>X9(((e,t)=>{t.duplicateToStoryboardStatus="started"}))(e,{projectId:t}))).case(nY.done,((e,{params:{projectId:t}})=>X9(((e,t)=>{t.duplicateToStoryboardStatus="done"}))(e,{projectId:t}))).case(nY.failed,((e,{params:{projectId:t},error:n})=>X9(((e,t)=>{t.duplicateToStoryboardStatus="error",t.saveError=n}))(e,{projectId:t}))).case(CX,b3((function(e,{projectId:t,asset:n}){if(!n.localId)return;const r=J9(e,t),o=r.fileSaveProgress[n.localId]||{id:n.localId,fileName:n.defaultDisplayName,statuses:{}};r.fileSaveProgress[n.localId]=o}))).case(_X,b3((function(e,{projectId:t,asset:n}){if(!n.localId)return;const r=J9(e,t),o=r.fileSaveProgress[n.localId];if(!o)return;delete o.statuses.proxyStatus,!Object.values(o.statuses).some((e=>e&&e.progress<1))?delete r.fileSaveProgress[n.localId]:r.fileSaveProgress[n.localId]=o}))).case(AX,b3((function(e,{projectId:t,asset:n}){if(!n.localId)return;const r=J9(e,t),o=r.fileSaveProgress[n.localId]||{id:n.localId,fileName:n.defaultDisplayName,statuses:{}};o.hasFailed=!0,delete o.statuses.proxyStatus,r.fileSaveProgress[n.localId]=o}))).case(MX,b3((function(e,{projectId:t,asset:n,artifact:r}){if(!n.localId)return;const o=p6(r.type);if(!o)return;const i=J9(e,t),a=i.fileSaveProgress[n.localId]||{id:n.localId,fileName:n.defaultDisplayName,statuses:{}},s={state:"upload-queued",progress:0};"uploading"!==a.statuses[o]?.state&&(a.statuses[o]=s),!Object.values(a.statuses).some((e=>e&&e.progress<1))?delete i.fileSaveProgress[n.localId]:i.fileSaveProgress[n.localId]=a}))).case(DX,b3((function(e,{projectId:t,asset:n,artifact:r,progress:o}){if(!n.localId)return;const i=p6(r.type);if(!i)return;const a=J9(e,t),s=a.fileSaveProgress[n.localId];if(!s)return;const c={state:"uploading",progress:o};s.statuses[i]=c,!Object.values(s.statuses).some((e=>e&&e.progress<1))?delete a.fileSaveProgress[n.localId]:a.fileSaveProgress[n.localId]=s}))).case(OX,b3((function(e,{projectId:t,asset:n,artifact:r}){if(!n.localId)return;const o=p6(r.type);if(!o)return;const i=J9(e,t),a=i.fileSaveProgress[n.localId]||{id:n.localId,fileName:n.defaultDisplayName,statuses:{}};a.statuses[o]={state:"uploading",progress:1},!Object.values(a.statuses).some((e=>e&&e.progress<1))?delete i.fileSaveProgress[n.localId]:i.fileSaveProgress[n.localId]=a}))).case(xX,b3((function(e,{projectId:t,asset:n,artifact:r}){if(!n.localId)return;const o=p6(r.type);if(!o)return;const i=J9(e,t),a=i.fileSaveProgress[n.localId]||{id:n.localId,fileName:n.defaultDisplayName,statuses:{}};a.hasFailed=!0,a.statuses[o]={state:"uploading",progress:1},!Object.values(a.statuses).some((e=>e&&e.progress<1))?delete i.fileSaveProgress[n.localId]:i.fileSaveProgress[n.localId]=a}))).case(RX,b3((function(e,{projectId:t,asset:n,artifact:r}){if(!n.localId||"completed"!==r.status)return;const o=p6(r.type);if(!o)return;const i=J9(e,t),a=i.fileSaveProgress[n.localId];if(!a?.statuses[o])return;a.statuses[o]={state:"uploading",progress:1},!Object.values(a.statuses).some((e=>e&&e.progress<1))?delete i.fileSaveProgress[n.localId]:i.fileSaveProgress[n.localId]=a}))).case(IX,b3((function(e,{projectId:t,state:n,quality:r,assetKey:o,name:i,size:a,progress:s}){const c=J9(e,t),d=c.fileSaveProgress[o]||{id:o,fileName:i,statuses:{}},l={state:n,progress:Math.min(1,Math.max(0,s)),size:a};1===l.progress&&"compressing"===l.state&&(l.state="upload-queued",l.progress=0),d.statuses[function(e){switch(e){case"original":return"originalStatus";case"preview":return"proxyStatus";case"autolevel":return"autolevelStatus";case"bleed":return"bleedStatus";default:return"transcriptionStatus"}}(r)]=l,!Object.values(d.statuses).some((e=>e&&e.progress<1))?delete c.fileSaveProgress[o]:c.fileSaveProgress[o]=d}))).case(bX,b3((function(e,{projectId:t,assetKey:n}){const r=J9(e,t),o=r.fileSaveProgress[n]||{id:n,fileName:name,statuses:{}};o.hasFailed=!0,r.fileSaveProgress[n]=o}))).case(l4.started,b3((function(e,{taskSpec:t,projectId:n,assetLocalId:r}){if(t!==a6||!r)return;const o=J9(e,n),i=o.fileSaveProgress[r]||{id:r,statuses:{}};i.statuses.speechEnhanceStatus={state:"processing",progress:0},o.fileSaveProgress[r]=i}))).cases([l4.done,l4.failed],b3((function(e,{params:{taskSpec:t,projectId:n,assetLocalId:r}}){if(t!==a6||!r)return;const o=J9(e,n),i=o.fileSaveProgress[r];if(!i?.statuses.speechEnhanceStatus)return;i.statuses.speechEnhanceStatus={state:"processing",progress:1},!Object.values(i.statuses).some((e=>e&&e.progress<1))?delete o.fileSaveProgress[r]:o.fileSaveProgress[r]=i}))).case(u4,b3((function(e,{taskSpec:t,projectId:n,assetLocalId:r}){if(t!==a6)return;const o=e.projects[n];if(!o)return;const i=o.fileSaveProgress[r];if(i?.statuses.speechEnhanceStatus){delete i.statuses.speechEnhanceStatus;!Object.values(i.statuses).some((e=>e&&e.progress<1))?delete o.fileSaveProgress[r]:o.fileSaveProgress[r]=i}}))).case(lY,X9(((e,t)=>{t.fetchingContents=!0,t.fetchError=void 0,t.loadError=void 0}))).case(uY,X9(((e,t)=>{t.fetchingContents=!1,t.saveError=void 0}))).cases([EJ,mY],X9(((e,t)=>{t.saveError=void 0}))).case(x8,X9(((e,t)=>{t.downloadProgress=void 0,t.downloaded=!1,t.cachedOriginalFiles=!1}))).case(aY,t6(((e,t,{project:{id:n},revisions:r,isDownloaded:o})=>{t.downloaded=o,r.length>0&&n6(n,e,t,r),void 0===e.userProjects&&(e.userProjects=new Set),e.userProjects.add(n)}))).cases([iY,q8.done,rY.done],t6()).case(dY,X9(((e,t,{error:n,projectId:r,revisionId:o,versionHistoryItem:i})=>{t.loadError=n||new Error("Could not load project"),t.fetchingContents=!1,e.activeProjectId=r,i&&(t.activeHistoricalVersion={versionHistoryItem:i,status:"error"})}))).case(W8.started,X9(((e,t)=>{t.fetchingOwnerships=!0}))).case(W8.done,X9(((e,t,{result:{ownerships:n,users:r,invites:o}})=>{t.fetchingOwnerships=!1,t.users=r.map((e=>{const t=bl.shallowCopy(e);return t.ownerships=n.filter((t=>t.userId===e.id)),t})),t.usersLoadError=void 0,t.invites=o,t.inviteError=void 0}))).case(W8.failed,X9(((e,t,{error:n})=>{t.fetchingOwnerships=!1,t.users=void 0,t.usersLoadError=n,t.invites=void 0}))).case(H8.done,X9(((e,t,{params:{ownershipId:n}})=>{t.users&&(t.users=t.users.filter((e=>!e.ownerships||!e.ownerships.some((e=>e.id===n)))))}))).case($Y,X9(((e,t,{invites:n})=>{t.invites=n}))).case(JY,X9(((e,t)=>{t.inviteError=void 0}))).case(YY,X9(((e,t,{message:n})=>{t.inviteError=n}))).case(N8,X9(((e,t,{needsCleanup:n})=>{t.cachedOriginalFiles=n}))).case(P8,X9(((e,t)=>{t.cachedOriginalFiles=!1}))).case(L8,((e,{projectId:t})=>(0,T.ZP)(e,(n=>{delete n.projects[t],e.templatePopoverSelectedProjectId===t&&(n.templatePopoverSelectedProjectId=void 0)})))).case(U8,((e,{visible:t})=>({...e,isShowingCommentsSidebar:!1,isSearchingProject:!1,isShowingPropertiesSidebar:!0,wasShowingPropertiesSidebar:!1,isShowingVersionHistory:t}))).case(DY,((e,{visible:t})=>({...e,isShowingMovePopover:t}))).case(B8,(e=>({...e,isShowingMixer:!1,isShowingCommentsSidebar:!1}))).case(j8,((e,{visible:t})=>({...e,isShowingMixer:t,isShowingCommentsSidebar:!1}))).case(V8,((e,{visible:t})=>({...e,isShowingCommentsSidebar:t,isShowingMixer:!1,isShowingPropertiesSidebar:!1,wasShowingPropertiesSidebar:e.isShowingPropertiesSidebar}))).case(eJ,(e=>({...e,isShowingCommentsSidebar:!0,isShowingMixer:!1,isShowingPropertiesSidebar:!1,wasShowingPropertiesSidebar:e.isShowingPropertiesSidebar}))).case(z8,((e,{visible:t})=>({...e,isShowingPropertiesSidebar:t,isShowingCommentsSidebar:!1,wasShowingPropertiesSidebar:!1}))).case(p9,b3(((e,{active:t})=>{e.isSearchingProject=t}))).case(A4,b3(((e,{activePinComponentId:t})=>{void 0!==t&&(e.isSearchingProject=!1)}))).cases([HJ,WJ],(e=>({...e,isSearchingProject:!1}))).case(wX,X9(((e,t,{quality:n})=>{t.assetQuality=n}))).case(MY,X9(((e,t,{folderId:n,expanded:r})=>{t.folderExpandedMap[n]=r}))).case(yJ,X9(((e,t,{parentFolderId:n})=>{t.folderExpandedMap[n]=!0}))).case(OJ,X9(((e,t,{folderInfo:n})=>{n&&(t.folderExpandedMap[n.folderId]=!0)}))).case(DJ,X9(((e,t,{folderInfo:n})=>{n&&(t.folderExpandedMap[n.folderId]=!0)}))).case(H3,((e,{backendVoices:t})=>({...e,backendVoices:t}))).case(W3,((e,{backendVoice:t})=>(0,T.ZP)(e,(e=>{e.backendVoices.set(t.id,t)})))).case($3.done,((e,{params:{backendVoiceId:t}})=>(0,T.ZP)(e,(e=>{e.backendVoices.delete(t)})))).cases([q3.done,K3.done],((e,{result:t})=>(0,T.ZP)(e,(e=>{t&&e.backendVoices.set(t.id,t)})))).case(wY.done,((e,{result:{templates:t}})=>({...e,templates:t}))).case(UY,X9(((e,t,{versionHistoryItem:n})=>{t.loadError=void 0,t.activeHistoricalVersion={versionHistoryItem:n,status:"requested"}}))).case(F4,X9(((e,t,{versionHistoryItem:n})=>{n&&(t.loadError=void 0,t.activeHistoricalVersion={versionHistoryItem:n,status:"active"})}))).case(U4,X9(((e,t,{latestRemoteCommitTime:n,earliestUnsyncedCommitTime:r})=>{"live-collab"===t.docSyncMetadata?.type&&(t.docSyncMetadata.latestRemoteCommitTime=n,t.docSyncMetadata.earliestUnsyncedCommitTime=r)}))).case(B4,X9(((e,t,{documentSaveRequestId:n,timestamp:r})=>{"live-collab"===t.docSyncMetadata?.type&&(t.docSyncMetadata.pendingDocumentSaves[n]=r)}))).case(j4,X9(((e,t,{documentSaveRequestId:n})=>{"live-collab"===t.docSyncMetadata?.type&&delete t.docSyncMetadata.pendingDocumentSaves[n]}))).case(P4,X9(((e,t,{doc:n})=>{if(t.loadError=void 0,"live-collab"!==t.docSyncMetadata?.type)throw new Error("Got a LiveCollabDocUpdateAction for a non-live collab project.");if(t.activeHistoricalVersion=void 0,t.quickRecordingInfo.waitingForDoc)for(const r of Object.values(n.mediaLibrary.mediaRefs)){if((Nk(r)??0)>0){t.quickRecordingInfo.waitingForDoc=!1;break}}}))).case(f6,X9(((e,t,{metadata:n})=>{t.liveCollabMigrationMetadata=n}))).case(d6,X9(((e,t)=>{t.quickRecordingInfo={shouldFocusCompositionTitle:!1,waitingForArtifact:!0,waitingForDoc:!0}}))).case(l6,X9(((e,t)=>{t.quickRecordingInfo.waitingForArtifact=!1,t.quickRecordingInfo.shouldFocusCompositionTitle=!0}))).case(CY,((e,{query:t})=>(0,T.ZP)(e,(e=>{e.searchTerm=t,t?e.isSearchingProjectBrowser=!0:(e.localProjectSearchIds=void 0,e.remoteProjectSearchResults=void 0,e.isSearchingProjectBrowser=!1)})))).case(AY.done,((e,{params:{query:t,triggeredRemoteSearch:n},result:{projectIds:r}})=>(0,T.ZP)(e,(e=>{e.searchTerm===t&&(n||(e.isSearchingProjectBrowser=!1),e.localProjectSearchIds=new Set(r))})))).case(_Y.started,(e=>(0,T.ZP)(e,(e=>{e.remoteProjectSearchResults=void 0})))).case(_Y.done,((e,{params:{query:t},result:{projectResults:n}})=>(0,T.ZP)(e,(e=>{e.searchTerm===t&&(e.remoteProjectSearchResults=n,e.isSearchingProjectBrowser=!1)})))).case(_Y.failed,((e,{params:{query:t}})=>(0,T.ZP)(e,(e=>{e.searchTerm===t&&(e.isSearchingProjectBrowser=!1)})))).case(RY,b3(((e,{projectId:t,lastViewedAt:n})=>{const r=e.projects[t];if(r?.project){const e=r.project.shallowCopy();e.lastViewedAt=n,r.project=e}}))).case(F8.started,b3((e=>{e.duplicateInProgress=!0,e.duplicateError=void 0}))).case(F8.done,b3((e=>{e.duplicateInProgress=!1}))).case(F8.failed,b3(((e,{error:t})=>{e.duplicateInProgress=!1,e.duplicateError=t}))).case(NY,b3(((e,t)=>{e.mediaLibraryPopoverSelectedSource=t}))).case(PY,b3(((e,t)=>{e.templatePopoverSelectedProjectId=t}))).case(rZ,b3((e=>{e.templatePopoverSelectedProjectId=void 0,e.isShowingMediaLibraryPopover=!1,e.isInsertingFileIntoScript=!1,e.mediaLibraryPopoverReplaceMediaParams=void 0,e.mediaLibraryPopoverSelectedSource=void 0,e.mediaLibraryPopoverSearchTerm=void 0,e.generativeMediaPrompt=void 0,e.generativeMediaInProgressInfo=void 0,e.generativeMediaError=void 0}))).case(xY,b3(((e,{visible:t,replaceMediaParams:n,isInsertingFileIntoScript:r=!1})=>{e.isShowingMediaLibraryPopover=t,e.mediaLibraryPopoverReplaceMediaParams=n,e.isInsertingFileIntoScript=r}))).case(C4,b3(((e,{selectedMediaReferenceIds:t})=>{t.size>0&&(e.isShowingMediaLibraryPopover=!0)}))).case(w4,b3(((e,{item:t,openMediaLibrary:n=!0})=>{t&&n&&(e.mediaLibraryPopoverSelectedSource={provider:s6,mediaType:"video"})}))).case(kY,b3(((e,{visible:t})=>{e.isShowingSequenceEditorMediaLibraryPopover=t}))).case(s5.started,b3(((e,{publishedProject:t})=>{e.publishedProjectDownloadStatus[t.id]=!0}))).cases([s5.done,s5.failed],b3(((e,{params:{publishedProject:t}})=>{e.publishedProjectDownloadStatus[t.id]=!1}))).case(jY.started,b3(((e,{generationId:t,prompt:n})=>{e.generativeMediaPrompt=n,e.generativeMediaInProgressInfo={generationId:t,prompt:n},e.generativeMediaError=void 0}))).case(VY.started,b3(((e,{generationId:t,mediaRef:n})=>{e.generativeMediaPrompt=n.generativeMedia.prompt,e.generativeMediaInProgressInfo={generationId:t,prompt:n.generativeMedia.prompt},e.generativeMediaError=void 0}))).cases([jY.done,VY.done],(e=>(0,T.ZP)(e,(e=>{e.generativeMediaInProgressInfo=void 0,e.generativeMediaError=void 0})))).cases([VY.failed,jY.failed],b3(((e,{error:t})=>{e.generativeMediaInProgressInfo=void 0,e.generativeMediaError=t}))).build();var h6;function v6(e,t){return(0,T.ZP)(e,(e=>{e.selectedAnnotationIds=new Set([t]),e.visibleTextFormAnnotationId=void 0}))}const E6={commands:[],timeline:{isLocked:!1,isFocused:!1,volumeKeyframeControl:{isFocused:!1,isDragging:!1},isTrimmingClip:!1,isVerticallyOverflowing:!1,snapTimeOffset:void 0},selectedAnnotationIds:void 0,hoveringAnnotationIds:void 0,hoveringAnnotationIdsSource:void 0,multiSelectedProjects:void 0,projectSelectedLast:void 0,multiSelectOperationInProgress:!1,visibleTextFormAnnotationId:void 0,sidebarPrimaryTab:void 0,showingProjectBrowserSearch:!1,windowRoutes:[],webContentsId:void 0,sideBySideVisibility:{left:!0,right:!0},activeBreakpoint:void 0,selectSequenceOnSequenceModalClose:!1,conductor:void 0,conductorFileInput:void 0,onboardingStep:void 0,onboardingResponses:{},timelineClipStyle:"single-thumbnail",isUndoEnabled:!0,publishBrowserFilter:"All Pages",lastAddedFolderId:void 0,lastAddedCompositionId:void 0,isEditingItemTitle:!1,isEditingTitleClip:!1,isShowingLearningRail:!1,learningRailUrl:void 0,learningVideoUrl:void 0,learningVideoSlug:void 0,learningVideoMinimized:void 0,voiceIdsInRetrainSaga:new Set,isPropertyPanelLayoutSectionExpanded:!1,isProjectFolderPanelOpen:!1,showTextModeToast:!0,hideOnboarding:!1,syncIndicatorOpen:!1,updateTitleFontFunction:void 0,lastWordGapDuration:void 0,playheadVisibleInScript:!0,playheadVisibleInTimeline:!0,canvasExpanded:!1},y6=(0,o4.reducerWithInitialState)(E6).case(SY,(e=>{const t=[],n=c8(),r=function(){let e=document.location?.search??"";return e.startsWith("?")&&(e=e.substring(1,e.length)),Boolean((0,aZ.parse)(e)?.reply)}();return n&&t.push(n),{...e,selectedAnnotationIds:new Set(t),visibleTextFormAnnotationId:n&&r?n:void 0}})).case(Z0,((e,{visible:t,url:n})=>(0,T.ZP)(e,(e=>{e.learningRailUrl=n??"https://learn.descript.com",e.isShowingLearningRail=t})))).case(X0,((e,{expanded:t})=>(0,T.ZP)(e,(e=>{e.canvasExpanded=t})))).cases([T4,vn],(e=>(0,T.ZP)(e,(e=>{e.canvasExpanded=!1})))).case(J0,((e,{url:t,slug:n})=>(0,T.ZP)(e,(e=>{e.learningVideoUrl=t,e.learningVideoSlug=n})))).case(e1,((e,{visible:t})=>(0,T.ZP)(e,(e=>{e.playheadVisibleInScript=t})))).case(t1,((e,{visible:t})=>(0,T.ZP)(e,(e=>{e.playheadVisibleInTimeline=t})))).case(Q0,((e,{minimized:t})=>(0,T.ZP)(e,(e=>{e.learningVideoMinimized=t})))).case(n1,((e,{commands:t})=>(0,T.ZP)(e,(e=>{e.commands=X3(t,e.commands)})))).case(Z8,((e,{isLocked:t})=>(0,T.ZP)(e,(e=>{e.timeline.isLocked=t})))).case(Y8,((e,{isFocused:t})=>(0,T.ZP)(e,(e=>{e.timeline.isFocused=t})))).case(Q8,b3(((e,t)=>{e.timeline.volumeKeyframeControl.isFocused=t}))).case(X8,b3(((e,t)=>{e.timeline.volumeKeyframeControl.isDragging=t}))).case(t9,b3(((e,t)=>{e.timeline.isTrimmingClip=t}))).case(n9,b3(((e,t)=>{e.timeline.isVerticallyOverflowing=t}))).case(e9,b3(((e,t)=>{e.timeline.snapTimeOffset=t}))).case(r9,((e,{annotationIds:t})=>(0,T.ZP)(e,(e=>{e.selectedAnnotationIds=t,(!e.selectedAnnotationIds||e.visibleTextFormAnnotationId&&!e.selectedAnnotationIds.has(e.visibleTextFormAnnotationId))&&(e.visibleTextFormAnnotationId=void 0)})))).case(y9,((e,{projectSelectedLast:t,projects:n})=>(0,T.ZP)(e,(e=>{if(!e.multiSelectOperationInProgress){e.multiSelectedProjects||(e.multiSelectedProjects=new Map);for(const t of n)e.multiSelectedProjects.set(t.id,t);e.projectSelectedLast=t}})))).case(S9,((e,{project:t})=>(0,T.ZP)(e,(e=>{e.multiSelectOperationInProgress||(e.multiSelectedProjects||(e.multiSelectedProjects=new Map),e.projectSelectedLast=t,e.multiSelectedProjects.has(t.id)?e.multiSelectedProjects.delete(t.id):e.multiSelectedProjects.set(t.id,t),0===e.multiSelectedProjects.size&&(e.multiSelectedProjects=void 0))})))).case(I9,(e=>(0,T.ZP)(e,(e=>{e.multiSelectOperationInProgress||(e.multiSelectedProjects=void 0,e.projectSelectedLast=void 0)})))).cases([k8.started],(e=>(0,T.ZP)(e,(e=>{e.multiSelectOperationInProgress=!0})))).cases([k8.done,k8.failed],(e=>(0,T.ZP)(e,(e=>{e.multiSelectOperationInProgress=!1,e.multiSelectedProjects=void 0,e.projectSelectedLast=void 0})))).cases([sJ,uJ],((e,{annotation:t})=>v6(e,t.id))).case(pJ,((e,{annotationId:t})=>v6(e,t))).case(o9,((e,{annotationIds:t,source:n})=>(0,T.ZP)(e,(e=>{e.hoveringAnnotationIds=t,e.hoveringAnnotationIdsSource=n})))).case(i9,((e,{annotationId:t})=>(0,T.ZP)(e,(e=>{e.visibleTextFormAnnotationId=t})))).case(a9,(e=>(0,T.ZP)(e,(e=>{e.visibleTextFormAnnotationId=void 0})))).case(s9,b3(((e,t)=>{e.sidebarPrimaryTab=t.tab,e.lastAddedFolderId=void 0,e.lastAddedCompositionId=void 0}))).case(hn,b3(((e,t)=>{t&&(e.sidebarPrimaryTab=void 0)}))).case(nJ.done,((e,{params:{annotation:{id:t}}})=>(0,T.ZP)(e,(e=>{e.selectedAnnotationIds?.delete(t),e.hoveringAnnotationIds?.delete(t),e.visibleTextFormAnnotationId===t&&(e.visibleTextFormAnnotationId=void 0)})))).case(c9,((e,{visible:t})=>(0,T.ZP)(e,(e=>{e.showingProjectBrowserSearch=t})))).case(d9,((e,{breakpoint:t})=>(0,T.ZP)(e,(e=>{e.activeBreakpoint=t})))).case($0,((e,{routes:t,webContentsId:n})=>(0,T.ZP)(e,(r=>{r.windowRoutes=X3(t,e.windowRoutes),r.webContentsId=n})))).case(p9,b3(((e,{active:t})=>{t&&(e.conductor=void 0)}))).case(u9,((e,t)=>(0,T.ZP)(e,(n=>{n.conductor=X3(t,e.conductor),n.conductorFileInput=void 0})))).case(f9,b3(((e,{context:t,name:n})=>{e.conductor={context:t,name:n,previous:e.conductor},e.conductorFileInput=void 0}))).case(m9,b3(((e,t)=>{e.conductorFileInput=t}))).case(CJ,b3(((e,{selectOnClose:t})=>{e.selectSequenceOnSequenceModalClose=Boolean(t)}))).case(DJ,b3(((e,{setActive:t})=>{t&&(e.selectSequenceOnSequenceModalClose=!0)}))).case(g9,b3(((e,{timelineClipStyle:t})=>{e.timelineClipStyle=t}))).case(p4,b3(((e,{enabled:t})=>{e.isUndoEnabled=t}))).case(R4,b3(((e,{isEditing:t})=>{e.isEditingItemTitle=t}))).case(M4,b3(((e,{isEditing:t})=>{e.isEditingTitleClip=t}))).case(NJ,b3(((e,{contents:t})=>{"vector"===t?.type&&"title"===t.vector.type&&(e.isEditingTitleClip=!0)}))).case(l9,b3(((e,t)=>{const{step:n}=t;if("complete"===n)e.onboardingStep=void 0,e.onboardingResponses={};else{e.onboardingStep=n;const{responses:r}=t;r&&(e.onboardingResponses={...r,...e.onboardingResponses})}}))).case(h9,b3(((e,{filter:t})=>{e.publishBrowserFilter=t}))).case(yJ,b3(((e,{folder:t,preventSettingLastFolder:n})=>{n||(e.lastAddedFolderId=t?.id),e.lastAddedCompositionId=void 0}))).case(OJ,b3(((e,{track:t})=>{e.lastAddedFolderId=void 0,e.lastAddedCompositionId=t.id}))).case(xJ,b3((e=>{e.lastAddedFolderId=void 0}))).case(Q3.started,b3(((e,{voiceId:t})=>{e.voiceIdsInRetrainSaga.add(t)}))).cases([Q3.done,Q3.failed],b3(((e,{params:{voiceId:t}})=>{e.voiceIdsInRetrainSaga.delete(t)}))).case(D4,b3(((e,{expanded:t})=>{e.isPropertyPanelLayoutSectionExpanded=t}))).case(O4,b3(((e,{open:t,focusCurrentComposition:n})=>{e.canvasExpanded&&(e.canvasExpanded=!1,!1===t)||(e.isProjectFolderPanelOpen=n?"focus-composition":t)}))).case(b4,b3((e=>{e.isProjectFolderPanelOpen=!1}))).case(v9,b3(((e,{value:t})=>{e.showTextModeToast=t}))).case(b9,b3(((e,{value:t})=>{e.hideOnboarding=t}))).case(E9,b3(((e,{value:t})=>{e.syncIndicatorOpen=t}))).case(zY,b3(((e,t)=>{e.updateTitleFontFunction=t}))).case(GY,b3(((e,{duration:t})=>{e.lastWordGapDuration=t}))),S6=y6.build(),I6=(0,o4.reducerWithInitialState)({products:{}}).case(P$,b3(((e,{products:t})=>{e.products=t}))).case(N$.done,b3(((e,{result:{products:t}})=>{e.products=t}))).case(F$.done,b3(((e,{result:{drive:{id:t},product:n}})=>{e.products[t]=n}))).cases([W$.done,K$.done,Y$.done,q$.done],b3(((e,{params:{driveId:t},result:{product:n}})=>{e.products[t]=X3(n,e.products[t])}))).build(),b6=I6;function T6(e){const t=document.getElementById(e)?.textContent;var n;if(t&&0!==t.trim().length)return n=t,JSON.parse(n.replace(/&lt;/g,"<")?.replace(/&amp;/g,"&"))}const w6={publishedProject:T6("metadata"),owners:[],isDocumentProcessing:!1,isShowingSignup:!1,isFullscreen:!1,mediaLoadingState:"idle",loadMediaError:void 0,fetchPublishedProjectError:void 0,views:void 0},C6=(0,o4.reducerWithInitialState)(w6).case(z4,b3(((e,{publishedProject:t})=>{e.publishedProject=t,e.fetchPublishedProjectError=void 0}))).case(G4,b3(((e,{owners:t})=>{e.owners=t}))).case($4,b3(((e,{isDocumentProcessing:t})=>{e.isDocumentProcessing=t}))).case(t5,b3(((e,{views:t})=>{e.views=t}))).case(K4,b3((e=>{e.mediaLoadingState="idle",e.loadMediaError=void 0}))).case(Y4,b3((e=>{e.mediaLoadingState="loading"}))).case(Z4,b3((e=>{e.mediaLoadingState="success"}))).case(J4,b3(((e,{error:t})=>{e.mediaLoadingState="failure",e.loadMediaError=t}))).case(OK,b3((e=>{e.isShowingSignup=!0}))).case(xK,b3((e=>{e.isShowingSignup=!1}))).case(e5,b3(((e,{error:t})=>{e.fetchPublishedProjectError=t}))).build(),_6=C6,A6=(0,pn.ZP)("FEATURE_FLAGS"),R6=A6("RELOAD"),M6=A6("SET_OVERRIDE");const D6=Lc.getAllValues();function O6(e){return"undefined"!==typeof D6[e]}function x6(e,t){const n=D6[e];if(void 0!==n)switch(typeof n){case"boolean":return"true"===t.toLowerCase();case"number":return parseFloat(t);case"string":return t;case"object":try{return JSON.parse(t)}catch(r){return void console.error("Invalid JSON format",r)}default:return void console.error("Unsupported type for",e)}}function k6(e){const t=zc(),n=function(){const e={};if(q===U.release)return e;const t=new URLSearchParams(window.location.search);for(const[n,r]of t){const t=n.slice(3);O6(t)&&r!==_r&&(e[t]=x6(t,r))}return e}();return(0,T.Uy)(e,(e=>{for(const[t,r]of Se(n))e.flags[t]=r;for(const[n,r]of Se(t))e.flags[n]=r}))}const N6=(0,o4.reducerWithInitialState)({flags:zc()}).case(R6,k6).case(M6,((e,{key:t,value:n})=>(ir.featureFlagOverrides.set({...ir.featureFlagOverrides.get(),[t]:n}),k6(e)))).build(),P6=N6,L6=(0,o4.reducerWithInitialState)({status:"idle"}).case(H4.started,b3((e=>{e.status="loading"}))).case(H4.done,b3((e=>{e.status="idle"}))).case(H4.failed,b3((e=>{e.status="error"}))).build(),F6=(0,pn.ZP)("SHARE_TOAST"),U6=F6("SHOW_SHARE_TOAST"),B6=F6("DISMISS_SHARE_TOAST"),j6=(0,o4.reducerWithInitialState)({toasts:[]}).case(U6,b3(((e,t)=>{const n=e.toasts.findIndex((e=>e.id===t.id));-1===n?e.toasts.push(t):e.toasts[n]=t}))).case(B6,b3(((e,{toastId:t})=>{e.toasts=e.toasts.filter((e=>e.id!==t))}))),V6={drive:i8,annotations:f8,auth:T8,document:j3,network:I8,playback:y8,project:g6,ui:S6,publish:_6,product:b6,featureFlags:P6,thumbnail:L6,toast:j6.build()},z6=(0,Ut.UY)(V6);function G6(e){return e.document.isAutomaticallyPaused}function W6(e,t){const n=function(e,t){return function(e,t){const n=TW(e,t);return n&&(n.temporaryDocState||n.docAndUndo.current)}(e,t)?.doc}(e,t);if(!n)throw new Error("No document loaded");return n}function H6(e,t,n){return CW(e,t,n).hoveringInfo}function q6(e,t){return TW(e,t).draggedMediaReferenceInfo}function $6(e,t){return q6(e,t)?.id}function K6(e,t){return TW(e,t).draggedPinComponentId}function Y6(e,t){return TW(e,t).draggedCueId}function Z6(e,t){return TW(e,t).draggedCardBoundaryId}function J6(e,t){return TW(e,t).draggedCloudMedia}function Q6(e,t){return TW(e,t).dropTargetType}const X6=(0,el.createSelector)(MW,((e,t,n)=>n),((e,t,n,r)=>r),((e,t,n)=>function(e,t,n,r){const o=nk(e,t,n);if(o){const[e]=o;if(r(e))return e}}(e,t,n,hR)));function e7(e,t){return TW(e,t).draggedSpeakerLabel}function t7(e,t){return void 0!==$6(e,t)||void 0!==K6(e,t)||void 0!==Y6(e,t)||void 0!==Z6(e,t)||void 0!==e7(e,t)||void 0!==J6(e,t)||void 0!==function(e,t){return TW(e,t).draggedTemplateCard}(e,t)||function(e,t){return TW(e,t).isDraggingFile}(e,t)}function n7(e,t,n){return CW(e,t,n).activeScriptTool}function r7(e,t,n){return CW(e,t,n).pendingOverdubRange}function o7(e,t,n){return CW(e,t,n).textCorrectionInfo}const i7=(0,el.createSelector)(r7,o7,((e,t)=>{if(e)return{range:e,type:"overdub"};if(t){return{range:function(e){let t=e.renderedRange;return e.selectionRange&&(t=Gs.get(t.location+e.selectionRange.location,e.selectionRange.length)),t}(t),type:"correction"}}}));function a7(e,t,n){return _W(e,t,n).textMode}vp()(W6,((e,t,n)=>n),((e,t,n)=>_W(e,t,n).selectedTausMap),((e,t,n)=>{if(n){let t=0;const r=(0,T.ZP)(n,(n=>{for(const r of n.keys()){if(!hk(e,r)){n.delete(r);continue}const o=n.get(r);if(!o){n.delete(r);continue}const i=GV(e,r).tausAndDataBasic().getTauDataMaybe;for(const e of o){i(e)||o.delete(e)}o.size>0?t+=o.size:n.delete(r)}}));if(r.size>0)return{selectedTaus:r,count:t}}}));const s7=(0,el.createSelector)(((e,t,n)=>n.trackId),((e,t,n)=>sw(MW(e,t),n.trackId,n.cueId)),((e,t)=>t&&{trackId:e,cue:t}));function c7(e,t,n,r=!1){const{activePinComponentId:o}=_W(e,t,n);if(void 0===o)return;const i=FB(r?W6(e,t):MW(e,t),n,o);return PB(i)?i.id:void 0}const d7=(0,el.createSelector)((e=>e),((e,t)=>t),((e,t)=>!1));const l7=(e,t,n)=>Boolean(Vc("playhead-and-text-cursor-together")&&(a7(e,t,n)===NU.Write||_W(e,t,n).playheadMovingWithTextCursor));function u7(e,t){const n=y7(e,t);return!!n&&n.isPlaying}function f7(e){return u7(e,"composition")}function m7(e,t){const n=y7(e,t);if(n&&void 0!==n.currentlyPlayingId)return S7(e,n.currentlyPlayingId)}function p7(e,t,n){const r=S7(e,n);if(!r)return 0;if(void 0!==r.targetPlayheadTime)return r.targetPlayheadTime;const o=r.currentPlayheadTime+r.playheadTimeDelta;return o<0?(console.warn("current playhead time is < 0"),0):o}function g7(e){const t=_H(e);if(void 0===t)return 0;const n=OW(e,t);return void 0===n?0:p7(e,0,n)}function h7(e,t){if("composition"===t)return g7(e);const n=v7(e,t);if(void 0===n)return 0;const r=S7(e,n);return r?void 0!==r.targetPlayheadTime?r.targetPlayheadTime:r.currentPlayheadTime+r.playheadTimeDelta:0}function v7(e,t){const n=y7(e,t);return n&&n.currentlyPlayingId}function E7(e,t){const n=y7(e,t);return!!n&&n.isBuffering}function y7(e,t){return e.playback.playables[t]}function S7(e,t){return e.playback.players[t]}function I7(e,t){return y7(e,t)?.playable}function b7(e,t){const n=y7(e,"composition");return n&&n.currentlyPlayingId===t?n.playable:void 0}function T7(e,t){const n=y7(e,t);return n?n.playbackRate:1}function w7(e,t){return y7(e,t)?.playable?.duration??0}function C7(e,t){return m7(e,t)?.playheadTimeOnAutoPause}function _7(e){return!0}function A7(){return(0,Lt.GG)((e=>{let t,n=!1;const r=()=>{n||(t=()=>{t=()=>{n||(r(),e(1))},(0,Kr.W)(t)},(0,Kr.W)(t))};return r(),()=>{n=!0,t&&Kr.W.cancel(t)}}),Lt.Ef.none())}function R7(e,t,n){return Sd(h7(e,t),n)}function M7(e,t){const n=w7(e,t);return R7(e,t,n)?n:void 0}function D7(e,t){const n=function(e,t){const n=m7(e,t)?.endTimeOverride;if(n)return K(n,0,w7(e,t))}(e,t);return void 0!==n&&R7(e,t,n)?n:void 0}function O7(e,t,n){const r=y7(e,n);return(r?.source?.media.projectId===t?r.playable?.waitingForDecodeCount:void 0)??0}function*x7(e,t){const n=yield*(0,Wq.RE)(A7);try{for(;;){if(!(yield*(0,Wq.Ys)(u7,t)))break;const r=yield*(0,Wq.Ys)(M7,t),o=yield*(0,Wq.Ys)(D7,t);if(void 0!==r&&void 0===o&&"export_preview"===t){yield*(0,Wq.gz)(yq({playerKey:t,timeOffset:0,origin:void 0,startPlaying:!0,scrubbing:!1}));break}if(void 0!==r||void 0!==o){const e=yield*(0,Wq.Ys)(C7,t);yield*(0,Wq.gz)(pq({playerKey:t,timeOffset:e??r??o,patientPlaybackPause:!1,isSideEffect:!1}));break}yield*(0,Wq.qn)(n);const i=yield*(0,Wq.Ys)(O7,e,t);if(i>0){Da("audio_decode_pause",{project_id:e,count:i}),yield*(0,Wq.gz)(dq({playerKey:t,origin:"slow-decode",isUserInitiated:!1}));break}(yield*(0,Wq.Ys)(E7,t))||(yield*(0,Wq.gz)(wq({playerKey:t})))}}finally{n.close()}}function*k7(e,t,n){const r=yield*(0,Wq.Ys)(I7,t);if(!r)return!1;if(!(yield*(0,Wq.Ys)(_7)))return!1;try{const o=yield*(0,Wq.RE)(r.play,e),{totalMs:i,audioPrefetchMs:a,videoPrefetchMs:s}=o;return e.span.setAttributes({[It.appAudioPrefetchMs]:a,[It.appVideoPrefetchMs]:s,[It.appMediaEngineType]:r.type,[It.appPlayerKey]:t,[It.appTimelineDuration]:r.duration,"app.player_play_ms":i,"app.origin":n}),yield*(0,Wq.gz)(fq({playerKey:t,stats:o,origin:n,engine:r.type})),!0}catch(E0){return yield*(0,Wq.gz)(mq({errorType:sq.RequestFailed,error:E0})),Tt(e.span,E0),!1}}function*N7(e,t){const n=(yield*(0,Wq.Ys)(_H))||(yield*(0,Wq.Ys)(AH));if(void 0===n)return;const r=yield*function*(e,t,n){const{callback:r,ctx:o,spanOptions:i,userCancellationAbortController:a}=At(t,n),s=yt(e,i,o);try{return yield*r(s)}catch(c){throw a?.signal.aborted?wt(s.span):Tt(s.span,c),c}finally{s.span.end()}}("PlaybackSaga.startPlayback",{ctx:vt()},(function*(n){try{if(!(yield*(0,Wq.Ys)(I7,e)))return!1;if(void 0!==(yield*(0,Wq.Ys)(M7,e)))yield*(0,Wq.gz)(yq({playerKey:e,timeOffset:0,origin:void 0,scrubbing:!1}));else{const t=yield*(0,Wq.Ys)(D7,e);void 0!==t&&(yield*(0,Wq.gz)(yq({playerKey:e,timeOffset:t,origin:void 0,scrubbing:!1})))}yield*(0,Wq.gz)(Iq({playerKey:e}));const r=yield*(0,Wq.RE)(k7,n,e,t);return yield*(0,Wq.gz)(bq({playerKey:e})),r}catch(E0){return yield*(0,Wq.gz)(bq({playerKey:e})),Ra(E0,"start-playback",{category:Oa.Playback}),Tt(n.span,E0),!1}}));try{r&&(yield*(0,Wq.RE)(x7,n,e))}catch(o){Ra(o,"update-playback",{category:Oa.Playback})}}function*P7({deltaTimeOffset:e,origin:t,playerKey:n}){try{const r=yield*(0,Wq.Ys)(h7,n);yield*(0,Wq.gz)(yq({playerKey:n,timeOffset:Math.max(0,r+e),origin:t,scrubbing:!1}))}catch(E0){Ra(E0,"seek-by-playback",{category:Oa.Playback})}}function*L7({timeOffset:e,playerKey:t,startPlaying:n=!1,origin:r,scrubbing:o=!1}){try{const i=yield*(0,Wq.Ys)(I7,t);if(!i)return;if(yield*(0,Wq.gz)(Iq({playerKey:t})),yield*(0,Wq.RE)(i.seek,Math.max(0,e),o,n),yield*(0,Wq.gz)(Tq({playerKey:t,scrubbing:o})),yield*(0,Wq.gz)(bq({playerKey:t})),n&&(yield*(0,Wq.gz)(dq({playerKey:t,origin:r,isUserInitiated:!0}))),yield*(0,Wq.Ys)(Vc,"playhead-and-text-cursor-together")){const e=yield*(0,Wq.Ys)(_H);if(void 0===e)return;const t=yield*(0,Wq.Ys)(OW,e);if(void 0===t)return;"script"!==r||(yield*(0,Wq.Ys)(l7,e,t))||(yield*(0,Wq.gz)(T9({projectId:e,trackId:t,value:!0})))}}catch(E0){yield*(0,Wq.gz)(bq({playerKey:t,error:E0})),Ra(E0,"seek-to-playback",{category:Oa.Playback,level:"warning"})}}function*F7({playerKey:e,timeOffset:t,patientPlaybackPause:n}){try{yield*(0,Wq.gz)(Iq({playerKey:e}));const r=yield*(0,Wq.Ys)(I7,e);if(!r)return yield*(0,Wq.gz)(gq({playerKey:e,timeOffset:t})),void(yield*(0,Wq.gz)(bq({playerKey:e})));(yield*(0,Wq.RE)(r.pause,!0))?(yield*(0,Wq.gz)(gq({playerKey:e,timeOffset:t})),yield*(0,Wq.gz)(bq({playerKey:e})),n&&(yield*(0,Wq.RE)(U7,e))):(yield*(0,Wq.gz)(bq({playerKey:e})),Ma("Pause failed"))}catch(E0){yield*(0,Wq.gz)(bq({playerKey:e})),Ra(E0,"pause-playback",{category:Oa.Playback})}}function*U7(e){const t=yield*(0,Wq.Ys)(cW);if(!t.enabled)return;const n=yield*(0,Wq.Ys)(f7),r=yield*(0,Wq.Ys)(G6),o=yield*(0,Wq.Ys)(NW);if(!n&&r){yield*(0,Wq.gw)(1e3*t.pauseInactivityTimeout);const n=yield*(0,Wq.Ys)(f7),r=yield*(0,Wq.Ys)(G6),i=yield*(0,Wq.Ys)(NW);if(!n&&r&&o===i){const n=yield*(0,Wq.Ys)(g7),r=Math.max(0,n+t.postPausePlayheadTimeDelta);yield*(0,Wq.gz)(yq({timeOffset:r,origin:void 0,playerKey:e,scrubbing:!1})),yield*(0,Wq.gz)(dq({playerKey:e,origin:"patient_playback",isUserInitiated:!1}))}}}const B7=Object.freeze(["composition","media_reference","export_preview","sequence"]);function*j7(){const e=yield*(0,Wq.Ys)(Vc,"playhead-and-text-cursor-together");let t;for(;;){let n,r;if(t||(t=yield*qK(dq)),t){n=t.payload.playerKey;for(const e of B7)e!==n&&(yield*(0,Wq.gz)(pq({playerKey:e,patientPlaybackPause:!1,isSideEffect:!0})));if(r=yield*(0,Wq.rM)(N7,n,t.payload.origin),t.payload.isUserInitiated&&e){const e=yield*(0,Wq.Ys)(_H);if(void 0===e)return;const t=yield*(0,Wq.Ys)(OW,e);if(void 0===t)return;yield*(0,Wq.gz)(T9({projectId:e,trackId:t,value:!0}))}}for(;;){const e=yield*qK(gq,dq);if(!gq.match(e)||void 0===n||e.payload.playerKey===n){t=dq.match(e)?e:void 0;break}}r&&(yield*(0,Wq.al)(r))}}var V7=n(46855);function z7(e){return e?function(e){switch(e.nodeType){case Node.ELEMENT_NODE:case Node.TEXT_NODE:return e instanceof Element&&e.textContent&&!e.attributes["data-external-text"]?e.textContent.length:0;default:return 0}}(e)+z7(e.previousSibling||void 0):0}function G7(e,t){const n=function(e){if(!(e instanceof Element))return;const t=e.attributes["data-block"];if(t&&"object"===typeof t&&"value"in t&&"true"===t.value){const t=e.attributes["data-offset-key"];if(!t)throw new Error("Block does not have offset key");const[n,r,o]=t.value.split("-");if("0"!==r||"0"!==o)throw console.log(e,t),new Error("unexpected block key value");return n}}(e);if(!n){const n=e.parentElement||void 0;return n&&"BODY"!==n.nodeName?G7(n,t+z7(e.previousSibling||void 0)):void 0}return{selectionBlock:n,selectionOffset:t}}function W7(e,t){const n=e.parentNode||void 0;return n?G7(n,t+z7(e.previousSibling||void 0)):void 0}function H7(e){const t=window.getSelection();if(!t||0===t.rangeCount)return;let n;try{n=t.getRangeAt(0)}catch(a){return void Ra(a,"get-readonly-selection")}const r=function(e){let t=!1;if(!e.isCollapsed&&e.anchorNode&&e.focusNode){const n=document.createRange();n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset),t=n.collapsed}return t}(t),o=W7(n.startContainer,n.startOffset),i=W7(n.endContainer,n.endOffset);return o&&i?(0,V7.makeSelectionState)({anchorKey:r?i.selectionBlock:o.selectionBlock,anchorOffset:r?i.selectionOffset:o.selectionOffset,focusKey:r?o.selectionBlock:i.selectionBlock,focusOffset:r?o.selectionOffset:i.selectionOffset,isBackward:r,hasFocus:e}):void 0}function q7(e,t){return`${e}`.padStart(t,"0")}function $7(e,t={}){const n=function(e){return Math.trunc(e/3600)}(e),r=function(e){return Math.trunc(e/60%60)}(e),o=function(e){return Math.trunc(e%60)}(e),i=n>0,a=i?q7(n,2):void 0,s=q7(r,!i&&t.minutePadding||2),c=q7(o,2);return void 0===a?`${s}:${c}`:`${a}:${s}:${c}`}const K7=(e,t,n)=>_W(e,t,n).selectedCardState;Sp("getUsedMediaReferenceIds-cardlayers");function Y7(e,t,n){return`${t}:${n}`}function Z7(e,t,n){const{activePinComponentId:r}=_W(e,t,n);if(void 0===r)return;return FB(MW(e,t),n,r)}function J7(e,t,n){const r=Z7(e,t,n);if(!r)return;const o=Q7(e,t,r.sceneId);return tp(o)?o:void 0}function Q7(e,t,n){return _W(e,t,n).textOrTimeSelection}const X7=(0,el.createSelector)([(e,t,n)=>xW(e,t,n).timeline.noAudioTrack.components],us((e=>es(e,(e=>{if(hR(e))return{id:`marker-${e.id}`,type:"marker",componentId:e.id,title:e.text}}))),Ft.wU)),eee=(0,el.createSelector)([(e,t,n)=>xW(e,t,n).name,X7],((e,t)=>[{id:"CompositionTitle",type:"title",title:e},...t]));function tee(e,t,n){if("title"===n.type)return 0;const r=function(e,t,n){return XT(e,t).getItem(e,n)}(e,t,n.componentId);if(!hR(r))throw new Error("Jump to item component was not a marker");return Kx(e,t,r)}const nee=(0,el.createSelector)([MW,(e,t,n)=>n,eee],((e,t,n)=>n.map((n=>{const r=tee(e,t,n);if(!e.isStoryboard)return{jumpToItem:n,timeOffset:r};let o;if("marker"===n.type){const r=nk(e,t,n.componentId);if(void 0!==r){const[n]=r,i=qb(e,t,n).location,a=vT(e,t,i);if(void 0!==a){if(mT(e,t,a).location===i-1){const n=i-2;o=n>=0?vT(e,t,n)?.start:void 0}else o=a.start}}}return{jumpToItem:n,timeOffset:r,cardBoundaryIdBeforeMarker:o?.id}})))),ree=(BW((0,el.createSelector)([nee,p7],((e,t)=>{const{match:n,previous:r}=rh(e,(({timeOffset:e})=>ih(e-t)));return(n??r)?.value.jumpToItem})),1e3),(0,el.createSelector)(MW,((e,t,n)=>n),Q7,((e,t,n)=>tp(n)?QG(zT(e,t,n)):n)));function oee(e,t,n){return JG(ree(e,t,n))}const iee=(0,Yl.createCachedSelector)(MW,((e,t,n)=>n),J7,Q7,((e,t,n,r)=>{if(!n)return tp(r)?r:jT(e,t,JG(r))}))({...yp("getTrackTimeSelection"),selectorCreator:vp(),keySelector:Y7});function aee(e,t,n){return _W(e,t,n).hasFocus}yp("getCardTextSelection"),vp();const see=(0,Yl.createCachedSelector)(MW,((e,t,n)=>n),ree,iee,((e,t,n,r)=>{if(void 0===r||r.offset<0)return;const o=EE(e);let i,a=!1;if(0!==n.delta){const r=Ub(e,t,JG(n));let o=r.string;if(Array.from(r.attributes).reverse().forEach((({attribute:e,range:t})=>{e.name!==Gu.InlineNote&&e.name!==Gu.Pin&&e.name!==Gu.Marker||(o=o.substring(0,t.location)+o.substring(t.location+t.length,o.length))})),o=o.replace(xs,"").replaceAll(y5.CARD_BOUNDARY_SYMBOL,"").replaceAll(y5.PIN_COMPONENT_SYMBOL,"").replace(y5.BLANK_CARD_SYMBOL,""),0===o.length||void 0!==Ms.index(o))return}let s=n.loc;o&&(i=IB(e,t,Gs.get(n.loc,1),!0,!0,!0,!0),a=Boolean(i),s=void 0!==i?i.location:s);const c=ZB(e,t,s);if(void 0===c||hd(c,_k(e,t))){if(!o)return;return{timeRange:r,textRange:JG(n),overlapsVisibleWordlessMedia:a}}const d={offset:XB(e,t,r.offset),duration:c},l=kP(e,t,d,!0);if(1===l.length){const{isScratchText:n,isOverdub:r}=GV(e,t).tausAndDataBasic().getTauData(Hg(l).id);if(n||r)return}const u=JG(n);return{textRange:i&&u.length>0&&u.length<i.length?u:i,timeRange:r.duration>0&&r.duration<d.duration?r:d,overlapsVisibleWordlessMedia:a}}))({...yp("getWordGapInfoAtCursor"),selectorCreator:vp(),keySelector:(e,t,n)=>rm(t,n)});const cee=vp()(MW,((e,t,n)=>n),p7,ree,l7,c7,f7,((e,t,n)=>{const r=function(e,t,n){const{activeCue:r}=_W(e,t,n);if(r)return s7(e,t,r)}(e,t,n);return r?.trackId===n?r?.cue.id:void 0}),((e,t,n,r,o,i,a,s)=>{let c=VU(e,t,n,i,s),d=!1;if(!c){c=Gs.get(VT(e,t,n).location,1);const r=Fb(e,t);c=JG(v3(r,QG(c),!0)),c=dc(r.string,c)||c,d=!0}if(o&&!a){const e=JG(r);e.location!==c.location&&(c=Gs.get(e.location,c.length))}return{renderedRange:c,isHidden:d}}));yp("getWordGapInfoAtPlayhead"),vp();function*dee({projectId:e,compositionId:t}){const n=yield*(0,Wq.Ys)(H6,e,t);if(!n||"text"!==n.type)return;const r=yield*(0,Wq.Ys)(f7),{hasAltKey:o,renderedRange:i,hasCmdKey:a}=n;let s=!r||o;if(!s){const e=H7(!0);s=!e||(0,V7.isCollapsed)(e)}const c=o&&a,d=!r&&o;if(s){const n=yield*(0,Wq.Ys)(MW,e),r=yield*(0,Wq.Ys)(oee,e,t),o=r.length>0?r.location:i.location,a=n.isStoryboard?function(e,t,n){const r=BT(e,t,n,"start",!0),o=vT(e,t,n);if(o){const{offset:n,duration:i}=sT(e,t,o),a=zP(e,t,n,i);return Math.min(r,a)}return r}(n,t,o):BT(n,t,o,"start",!0);if(c){const e=(yield*(0,Wq.Ys)(b7,t))?.duration??1/0;yield*(0,Wq.gz)(yq({playerKey:"composition",timeOffset:K(a-.75,0,e),origin:"script",endTimeOverride:K(a+.75,0,e),scrubbing:!1}))}else yield*(0,Wq.gz)(yq({playerKey:"composition",timeOffset:a,origin:"script",scrubbing:!1}))}else 0;d&&(yield*(0,Wq.gz)(dq({playerKey:"composition",isUserInitiated:!0,origin:"word_click"})))}function*lee({projectId:e,compositionId:t,startPlaying:n,origin:r}){const o=yield*(0,Wq.Ys)(f7),i=!o&&n;if(!o||n){const n=yield*(0,Wq.Ys)(MW,e),o=yield*(0,Wq.Ys)(ree,e,t);yield*(0,Wq.gz)(yq({playerKey:"composition",timeOffset:BT(n,t,tW(o),"start",!0),origin:r,scrubbing:!1}))}i&&(yield*(0,Wq.gz)(dq({playerKey:"composition",isUserInitiated:!0,origin:"word_click"})))}al.Edit;function*uee(e){yield*(0,Wq.gz)(KY(e));const t=yield*qK(YY,ZY);if(YY.match(t))throw new Error(t.payload.message)}function*fee(e){const{email:t,notify:n,projectId:r,role:o}=e;try{const e=yield*(0,Wq.RE)(RQ,vt(),t);if(e)yield*(0,Wq.gz)(JY({projectId:r})),yield*(0,Wq.RE)(c$,vt(),r,e.id,o,n),yield*(0,Wq.gz)(W8.started({projectId:r})),yield*(0,Wq.gz)(ZY({projectId:r,email:t,role:o,hasAccount:!0}));else{const e=yield*(0,Wq.RE)(lK,vt(),r,t,o);yield*(0,Wq.gz)(qY({projectId:r})),yield*(0,Wq.gz)(ZY({projectId:r,email:t,role:o,hasAccount:!1})),rt("project_member_invite_created",{project_id:r,invite_id:e.id,email:t,permission:o===yl.Tester?"comment":"edit",origin:"share_dialog"})}}catch(E0){yield*(0,Wq.gz)(YY({projectId:r,email:t,role:o,message:E0.json?.message||E0.message})),Ra(E0,"invite-project-user",{category:Oa.ProjectInvite})}}const mee="descript-user";function pee(){try{const e=localStorage.getItem(mee);if(!e)return;return bl.fromJson(JSON.parse(e))}catch(E0){return}}function gee(e){e?localStorage.setItem(mee,JSON.stringify(bl.toJSON(e))):localStorage.removeItem(mee)}function*hee(){try{const e=yield*(0,Vt.RE)(CQ,vt());yield*(0,Vt.gz)(yK({user:e})),ir.currentUserId.set(e.id),yield*(0,Vt.gz)(R6()),gee(e)}catch(E0){let t=!0;Ui(E0)||(yield*(0,Vt.gz)(SK({error:E0})),t=!1),Vi(E0)&&(fi("fetchUser unauthorized (web-share)"),t=!1),t&&Ra(E0,"fetch-user")}}function*vee(){Cc()||(fi("Logout - requireAuthentication (web-share)"),rt("logout",{source:"web-share-auth-saga-require-authentication"}),yield*(0,Vt.RE)((()=>_c(vt()))))}function*Eee(){fi("Logout - signoutUser (web-share)"),rt("logout",{source:"web-share-auth-saga-signout-user"}),yield*(0,Vt.RE)(_c,vt(),!1,!0),yield*(0,Vt.gz)(jK())}function*yee(){yield*KK(MK,vee),yield*KK(DK,Eee),yield*KK(pK,hee),yield*KK(jK,(()=>{gee()})),Cc()?yield*(0,Vt.RE)(hee):(yield*(0,Vt.gz)(mK()),gee())}var See=n(18394),Iee=n.n(See);var bee=(e=>(e.WithStudioSound="with-studio-sound",e))(bee||{}),Tee=(e=>(e.AssetMissing="asset-missing",e.FatalBounceError="fatal-bounce-error",e))(Tee||{});function wee(e){return"version"in e&&"v1"===e.version}function Cee(e,t){if(!wee(e.contents))return;const n=e.contents.media.stream;return n&&n.variants&&t in n.variants?n.variants[t]:void 0}function _ee(e){return e?.gat?.status===FG.completed}class Aee{constructor(e){this.id=e.id??"",this.text=e.text??"",this.isArchived=e.isArchived??!1,this.projectId=e.projectId??"",this.revisionId=e.revisionId,this.sceneId=e.sceneId??"",this.segmentTimeOffset=e.segmentTimeOffset??0,this.segmentTextOffsetLocation=e.segmentTextOffsetLocation??0,this.segmentTextOffsetLength=e.segmentTextOffsetLength??0,this.annotatedText=e.annotatedText??void 0,this.user=e.user??new bl,this.createdAt=e.createdAt??new Date,this.sequenceNumber=e.sequenceNumber??0,this.isNew=e.isNew??!0,this.subscriberEmails=e.subscriberEmails??[]}static fromJson(e){return new Aee({...e,isArchived:e.is_archived,projectId:e.project_id,revisionId:e.revision_id,sceneId:e.scene_id,segmentTimeOffset:e.segment_time_offset,segmentTextOffsetLocation:e.segment_text_offset_location,segmentTextOffsetLength:e.segment_text_offset_length,annotatedText:e.annotated_text,user:e.user?bl.fromJson(e.user):new bl,createdAt:e.created_at?new Date(e.created_at):new Date,sequenceNumber:e.sequence_number,isNew:!1,subscriberEmails:e.subscriber_emails||[]})}get json(){return{id:this.id,text:this.text,revision_id:this.revisionId,scene_id:this.sceneId,created_at:this.createdAt.toISOString(),segment_id:"-",segment_time_offset:this.segmentTimeOffset,segment_text_offset_location:this.segmentTextOffsetLocation,segment_text_offset_length:this.segmentTextOffsetLength,annotated_text:this.annotatedText,subscriber_emails:this.subscriberEmails}}}class Ree{constructor(e="",t="",n="",r=new bl,o=new Date,i=!0,a=[]){this.id=e,this.annotationId=t,this.text=n,this.user=r,this.createdAt=o,this.isNew=i,this.subscriberEmails=a}static fromJson(e,t){return P()(t===e.annotation_id,"Comment should belong to annotation"),new Ree(e.id,t,e.text,e.user?bl.fromJson(e.user):new bl,e.created_at?new Date(e.created_at):new Date,!1,e.subscriber_emails||[])}get json(){return{id:this.id,text:this.text,subscriber_emails:this.subscriberEmails}}}function Mee(e){return{...e,project_id:e.published_project_id}}async function Dee(e,t,n,r){return(await Rc(e,si.GET,`/published_projects/${t}/annotations`,{since:n,limit:r})).map((e=>Aee.fromJson(Mee(e))))}async function Oee(e,t,n){const r=`/published_projects/${t}/annotations/${n}/comments`;return(await Rc(e,si.GET,r)).map((e=>Ree.fromJson(e,n)))}async function xee(e,t,n){const r=await Rc(e,si.POST,`/published_projects/${t}/annotations`,void 0,function(e){return{id:e.id,text:e.text,segment_time_offset:e.segment_time_offset,segment_text_offset_location:e.segment_text_offset_location,segment_text_offset_length:e.segment_text_offset_length,annotated_text:e.annotated_text,subscriber_emails:e.subscriber_emails}}(n));return Aee.fromJson(Mee(r))}async function kee(e,t,n){await Rc(e,si.DELETE,`/published_projects/${t}/annotations/${n}`)}async function Nee(e,t,n,r){const o=await Rc(e,si.POST,`/published_projects/${t}/annotations/${n}/comments`,void 0,r);return Ree.fromJson(o,n)}async function Pee(e,t,n,r){await Rc(e,si.DELETE,`/published_projects/${t}/annotations/${n}/comments/${r}`)}async function Lee(e,t,n){await Rc(e,si.POST,`/published_projects/${t.projectId}/annotations/${t.id}/${n?"archive":"unarchive"}`)}function Fee(e){let t;if("mediaLibrary"in e&&e.project.activeProjectId){const n=DW(e,e.project.activeProjectId);if(n){const r=function(e,t,n){return e.document.publishedProjects[t]?.[n]}(e,e.project.activeProjectId,n.id);r&&(t=r)}}return t?e.publish.publishedProject?.id===t.id?e.publish.publishedProject:t:e.publish.publishedProject}function Uee(e){if(e.publish.publishedProject){const{state:t,upload_progress:n,recording_id:r}=e.publish.publishedProject;return"success"===t||!!r&&1===n?.progress}return!1}function Bee(e){if(e.publish.publishedProject){const{publishedProject:{state:t},mediaLoadingState:n}=e.publish;return"success"!==t||"success"!==n&&"idle"!==n}}function jee(e){if(e.publish.publishedProject){const{publish_type:t}=e.publish.publishedProject;return"video"===t||"audiogram"===t}}function Vee(e){return e.publish.publishedProject?e.auth.user?.id===e.publish.publishedProject.published_by.id:void 0}function zee(e){const t=Gee(e)||[],n=Vee(e),r=Cl(e)||pee();return n||t.some((e=>e.id===r?.id))||e.publish.owners.some((e=>e.userId===r?.id))}function Gee(e){const t=function(e){const t=e.publish.publishedProject?.drive_id;return t?e.drive.drives[t]:void 0}(e);return t?.memberships?.map((({user:e})=>e))}function Wee(e){const t=Gee(e),n=Al(e);return t?.filter((({id:e})=>e!==n))}var Hee=(e=>(e.ShortcutKey="shortcutKey",e.BetaBadge="betaBadge",e))(Hee||{}),qee=(e=>(e.Default="Default",e.MultiLine="MultiLine",e.Button="ToastButton",e.Tip="ToastTip",e))(qee||{}),$ee=(e=>(e.Alert="Alert",e.Spinner="Spinner",e.Checkmark="Checkmark",e.GreenCheckmark="Green Checkmark",e.PinkCheckmark="Pink Checkmark",e.Crosshair="Crosshair",e.Headphones="Headphones",e))($ee||{});function Kee(e){if(wee(e.contents)){const t=Cee(e,bee.WithStudioSound)?.gat?.status;return t===FG.partial||t===FG.placeholder}return!1}function Yee(e,t){if(!t)return!1;const n=!!e&&Kee(e),r=function(e){if(wee(e.contents))return _ee(Cee(e,bee.WithStudioSound));return!1}(t);return r&&n}function Zee(){const e=new URL(da);e.host===window.location.host&&(e.href=ca);confirm(Iee()`
        Would you like to switch to "${e.host}"?

        The model for this project is incompatible with the API. This usually happens when the model is updated in the Descript app, but has not yet been updated on the API.
    `)&&(e.pathname=window.location.pathname,e.search=window.location.search,window.location.assign(e))}async function Jee(e,t){let n=0;for(;;){try{const n=await fetch(t);if(n.status>=200&&n.status<400){const t=await n.json(),r=new gE(e,{},{});try{return vG(t,{coder:r,allowInMemoryFormat:!0,requireVoiceoverMetadata:!1})}catch(E0){if(E0 instanceof Ia)return void Zee();throw E0}}}catch(E0){console.error(E0)}n++;const r=n<300?200:1e3;await kc(r)}}async function Qee(e,t){try{return await async function(e,t){const n=await Rc(e,si.GET,`/projects/${t}/ownerships`);let r=[];n.ownerships&&(r=n.ownerships.map(Sl.fromJson));let o=[];return n.users&&(o=n.users.map(bl.fromJson)),[r,o]}(e,t)}catch(E0){return[[],[]]}}const Xee={};function*ete(){const e=yield*(0,Vt.Ys)(Fee);if(!Cc())return;if((yield*(0,Vt.Ys)(zee))&&e?.url_slug&&!1!==Xee[e?.url_slug]){const[t,[n]]=yield*(0,Vt.$6)([(0,Vt.RE)(v5,vt(),e.url_slug),(0,Vt.RE)(Qee,vt(),e.source_project_id)]);Xee[e?.url_slug]=void 0!==t,yield*(0,Vt.gz)(t5({views:t})),yield*(0,Vt.gz)(G4({owners:n}))}}function*tte({projectId:e,isNewProject:t}){if(!t)try{const t=yield*(0,Vt.Ys)(Fee);if(!t||!1===t.comments_enabled)return;(yield*(0,Vt.Ys)(XJ,e))||(yield*(0,Vt.gz)(JZ({isLoading:!0})));let n=yield*(0,Vt.Ys)(sQ,e);const r=[];let o=!0;for(;o;){const t=yield*(0,Vt.RE)(Dee,vt(),e,n,100);r.push(...t),r.length>0&&(n=r[r.length-1].sequenceNumber),o=100===t.length}const i=[],a=r.filter((e=>!!e.isArchived||(i.push(e),!1)));yield*(0,Vt.gz)(QZ({annotations:i,projectId:e,archivedAnnotations:a})),yield*(0,Vt.gz)(JZ({isLoading:!1}))}catch(E0){yield*(0,Vt.gz)(JZ({isLoading:!1})),Ra(E0,"load-annotations",{category:Oa.Comments})}}function*nte({id:e,published_scene_id:t,contents:{document:{cdn_url:n}}}){let r=uG({projectId:e});r=rx(r,Cy({id:t}),void 0),yield*(0,Vt.gz)(q4({publishedProjectId:e,doc:r})),yield*(0,Vt.gz)(SY({projectId:e,compositionId:t})),yield*(0,Vt.gz)($4({isDocumentProcessing:!0}));const o=yield*(0,Vt.RE)(Jee,e,n);o&&(yield*(0,Vt.gz)(q4({publishedProjectId:e,doc:o}))),yield*(0,Vt.gz)($4({isDocumentProcessing:!1}))}let rte=!1;function*ote(e,t){const n=yield*(0,Vt.Ys)(Fee),r=yield*(0,Vt.RE)(h5,vt(),e);if(!r||rte)return;let o=t===ite.SingleRefresh;return o||function(e,t){const n=e&&Ee(e,"current_server_time"),r=t&&Ee(t,"current_server_time");return(0,Me.fastDeepEqual)(n,r)}(n,r)||(Yee(n,r)?rte=!0:o=!0),o&&(yield*(0,Vt.gz)(z4({publishedProject:r}))),r}var ite=(e=>(e[e.SingleRefresh=0]="SingleRefresh",e[e.WaitingForStateUpdate=1]="WaitingForStateUpdate",e))(ite||{});let ate=!1;function*ste(e,t=0){if(ate)return;let n=0;for(ate=!0,rte=!1;;){let r=5e3,o=!0;try{const i=yield*(0,Vt.Ys)(Fee),a=yield*(0,Vt.RE)(ote,e,t);if(!a){if(n<=3){n+=1,r=1500;continue}return}yield*(0,Vt.RE)(ete);const{id:s,state:c}=a;switch(s!==i?.id?(yield*(0,Vt.rM)(nte,a),yield*(0,Vt.gz)(K4())):Yee(i,a)&&(yield*(0,Vt.gz)(B6({toastId:`ss-pending-${a.id}`})),yield*(0,Vt.gz)(U6({id:`ss-done-${a.id}`,message:"Studio Sound successfully applied!",subtext:"Refresh to hear your enhanced audio",icon:$ee.GreenCheckmark,style:qee.Default,actionMessage:"Refresh",actionOrRoute:{type:"action",action:q0()}}))),c){case"bouncing":r=2e3;break;case"success":if(!Kee(a))return void(ate=!1);break;case"failure":return void(ate=!1)}}catch(E0){throw E0&&"object"===typeof E0&&Vi(E0)&&(o=!1),E0}finally{o&&(yield*(0,Vt.gw)(r))}}}var cte=n(87953);function dte(){window.location.reload()}function*lte(){const e=yield*(0,Vt.Ys)((e=>e.publish.publishedProject));if(void 0===e)return;const{id:t,url_slug:n,published_scene_id:r}=e;let o;(function(e){return"success"===e.state&&!Kee(e)||"failure"===e.state})(e)||(Kee(e)&&(yield*(0,Vt.gz)(U6({id:`ss-pending-${e.id}`,message:"Applying Studio Sound",subtext:"Play video without studio sound while you wait",icon:$ee.Spinner,style:qee.Default,dismissible:!0}))),yield*(0,Vt.rM)(ste,n,ite.WaitingForStateUpdate));try{o=T6("document")}catch(E0){Ra(E0,"parse-metadata")}if(void 0===o)yield*(0,Vt.rM)(nte,e);else{const e=new gE(t,{},{});let n;try{n=vG({...o,documentVersion:(i=o.documentVersion,i&&(0,cte.gt)(i,$z)?$z:i)},{coder:e,allowInMemoryFormat:!0,requireVoiceoverMetadata:!1})}catch(E0){E0 instanceof Ia||Ra(E0,"decode");n=rx(uG({projectId:t}),Cy({id:r}),void 0),Zee()}yield*(0,Vt.gz)(q4({publishedProjectId:t,doc:n})),yield*(0,Vt.gz)(SY({projectId:t,compositionId:r}))}var i}function*ute({playerKey:e}){e&&((yield*(0,Vt.Ys)(u7,e))?yield*(0,Vt.gz)(pq({playerKey:e,patientPlaybackPause:!1,isSideEffect:!1})):yield*(0,Vt.gz)(dq({playerKey:e,isUserInitiated:!0})))}function*fte({projectId:e,name:t}){const{project:n}=yield*(0,Vt.RE)(a$,vt(),e);"quick_recording"===n.editorVariant&&(yield*(0,Vt.RE)(s$,vt(),e,{name:t}))}function*mte(){yield*ZK(W$,(function*({driveId:e}){return{product:yield*(0,Vt.RE)(Jd,vt(),e)}})),yield*KK(q0,dte),yield*KK(pq,F7),yield*KK(hq,ute),yield*KK(Sq,P7),yield*KK(yq,L7),yield*KK(vq,lee),yield*KK(Eq,dee),yield*KK(fq,(function*({playerKey:e}){yield*(0,Vt.gz)(Bq({playerKey:e}))})),yield*KK(W4,(function*({urlSlug:e}){yield*(0,Vt.RE)(ste,e)})),yield*KK(X4,(function*({urlSlug:e}){let t=!0;try{yield*(0,Vt.RE)(ste,e)}catch(E0){E0&&"object"===typeof E0&&Vi(E0)&&(t=!1),yield*(0,Vt.gz)(e5({error:E0}))}Cc()||(t&&(yield*(0,Vt.RE)(kc,1e4)),yield*(0,Vt.RE)(vee))})),yield*ZK(H4,(function*({file:e,publishedProject:t,onError:n}){const r=new FormData;e&&(r.append("file",e),r.append("size",String(e.size)));try{yield*(0,Vt.RE)(p5,vt(),{publishedProjectId:t.id,thumbnail:e?r:void 0})}catch(E0){if(Hi(E0))return void n(E0);throw E0}const o=yield*(0,Vt.RE)(h5,vt(),t.url_slug);o&&(yield*(0,Vt.gz)(z4({publishedProject:o})))})),yield*ZK(Q4,fte),yield*(0,Vt.rM)(lte),yield*GX(Cl,ete),yield*(0,Vt.rM)(j7),yield*KK(KY,fee);const e=ir.installId.get();ir.installId.set(e)}function pte(e,t){return Br(e)&&e.getAttribute(`data-${t}-time`)?e:e instanceof Text&&e.data.match(/\s+/)?"start"===t?Br(e.nextSibling)?e.nextSibling:void 0:Br(e.previousSibling)?e.previousSibling:void 0:e.parentElement}function gte(e){if(e&&e.anchorNode&&e.anchorNode.parentElement&&e.focusNode&&e.focusNode.parentElement){if("P"===e.focusNode.nodeName&&Br(e.focusNode)){const t=e.focusNode.querySelectorAll("[data-start-time]"),n=t[0],r=t[t.length-1],o=e.toString();return{timeOffset:Number(n.getAttribute("data-start-time")),endTime:Number(r.getAttribute("data-end-time")),annotatedText:o,range:{length:o.length,location:Number(n.getAttribute("data-location"))}}}{const t=e.getRangeAt(0),n=pte(t.startContainer,"start");if(!n)return;const r=pte(t.endContainer,"end")||n,o=Number(n.getAttribute("data-location")),i=Number(t.endContainer.parentElement?.getAttribute("data-location")||Br(t.endContainer.nextSibling)&&t.endContainer.nextSibling.getAttribute("data-location")||0),a=t.endContainer.parentElement?.getAttribute("data-marker");return{timeOffset:Number(n.getAttribute("data-start-time")),endTime:Number(r.getAttribute("data-end-time")),annotatedText:e.toString(),range:{length:a?0:i+Number(t.endContainer?.length||0)-o,location:o}}}}}function*hte(e,{compositionId:t,projectId:n}){const r=yield*(0,Wq.Ys)(MW,n);let o,i,a;const s=gte(document.getSelection());if(s)({timeOffset:o,annotatedText:a,range:i}=s);else{o=yield*(0,Wq.Ys)(g7);const e=FT(r,t,o);if(!e)return;i=e.range;a=wP(r,t,e.tauId).text.string.substr(i.location,i.length)}return new Aee({id:Ps(),isArchived:!1,projectId:n,sceneId:t,segmentTimeOffset:o,segmentTextOffsetLocation:i.location,segmentTextOffsetLength:i.length,annotatedText:a,user:e})}function*vte({compositionId:e,projectId:t}){const n=yield*(0,Vt.Ys)(Cl);if(void 0===n)return void(yield*(0,Vt.gz)(OK()));const r=yield*(0,Vt.RE)(hte,n,{compositionId:e,projectId:t});r&&(yield*(0,Vt.gz)(sJ({projectId:t,compositionId:e,annotation:r})))}function*Ete({publishedProjectId:e}){yield*(0,Vt.gz)(fJ({projectId:e,isNewProject:!1}))}function*yte(e,t){try{const n=yield*(0,Vt.RE)(Oee,vt(),e,t);yield*(0,Vt.gz)(XZ({comments:n,annotationId:t}))}catch(E0){Ra(E0,"load-comments",{category:Oa.Comments}),yield*(0,Vt.gz)(XZ({comments:[],annotationId:t}))}}function*Ste({projectId:e,compositionId:t}){const n=yield*(0,Vt.Ys)(iQ,e,t);yield*(0,Vt.$6)(n.map((t=>(0,Vt.RE)(yte,e,t.id))))}function*Ite({projectId:e}){const t=yield*(0,Vt.Ys)(OW,e);void 0!==t&&(yield*(0,Vt.RE)(Ste,{projectId:e,compositionId:t}))}function*bte({projectId:e,compositionId:t,annotation:n}){try{const e=yield*(0,Vt.Ys)(Fee);if(e){if((yield*(0,Vt.Ys)(Gee))?.some((e=>e.id===n.user.id)))for(const t of n.subscriberEmails)yield*(0,Vt.RE)(uee,{projectId:e.source_project_id,email:t,role:yl.Tester,notify:!0})}}catch(E0){console.error(E0)}try{const r=yield*(0,Vt.RE)(xee,vt(),n.projectId,n.json);yield*(0,Vt.gz)(cJ({projectId:e,compositionId:t,annotation:r,context:"share"}))}catch(E0){console.error(E0);const r=pJ({projectId:e,annotation:n,annotationId:n.id,error:E0??new Error("Could not create annotation")});yield*(0,Vt.gz)(r)}}function*Tte({projectId:e,annotation:{id:t}}){yield*(0,Vt.RE)(kee,vt(),e,t)}function*wte({comment:e,projectId:t,compositionId:n,annotationId:r}){try{const o=yield*(0,Vt.RE)(Nee,vt(),t,r,e.json);yield*(0,Vt.gz)(dJ({projectId:t,compositionId:n,comment:o}))}catch(E0){console.error(E0);const n=pJ({projectId:t,annotation:void 0,annotationId:r,error:E0??new Error("Could not create comment")});yield*(0,Vt.gz)(n)}}function*Cte({projectId:e,annotationId:t,commentId:n}){yield*(0,Vt.RE)(Pee,vt(),e,t,n)}function*_te({projectId:e,annotation:t,skipApi:n}){if(!n)try{yield*(0,Vt.RE)(Lee,vt(),t,!0)}catch(E0){console.error(E0);const r=pJ({projectId:e,annotation:t,annotationId:t.id,error:E0||new Error("Could not create annotation")});yield*(0,Vt.gz)(r)}}function*Ate({projectId:e,annotation:t,skipApi:n}){if(!n)try{yield*(0,Vt.RE)(Lee,vt(),t,!1)}catch(E0){console.error(E0);const r=pJ({projectId:e,annotation:t,annotationId:t.id,error:E0??new Error("Could not create annotation")});yield*(0,Vt.gz)(r)}}function*Rte({projectId:e,compositionId:t}){yield*(0,Vt.gz)(mJ({projectId:e,compositionId:t}))}function*Mte(){yield*KK(fJ,tte),yield*KK(q4,Ete),yield*KK(SY,Rte),yield*KK(QZ,Ite),yield*KK(mJ,Ste),yield*KK(tJ,bte),yield*ZK(nJ,Tte),yield*KK(rJ,wte),yield*ZK(oJ,Cte),yield*KK(lJ,_te),yield*KK(uJ,Ate),yield*KK(eJ,vte)}function Dte(){return Nt.createElement("span",{className:"AnimatedEllipsis-module--ukCnRT"},Nt.createElement("span",null,"."),Nt.createElement("span",null,"."),Nt.createElement("span",null,"."))}var Ote=n(62454),xte=n(38378),kte=n.n(xte),Nte=n(649);const Pte=Nt.forwardRef((function({style:e,...t},n){return Nt.createElement(Yo,{ref:n,...t,style:{...e,color:"var(--grey-0-base)"}})})),[Lte,Fte]=(0,Nte.k)("FullscreenShare"),Ute="Full screen is unavailable",Bte=e=>e?"Exit full screen (f)":"Full screen (f)";function jte({isFullScreen:e,setIsFullScreen:t,pause:n}){const[r,o]=(0,Nt.useState)(Bte(e));(0,Nt.useEffect)((()=>{o(Bte(e))}),[e]),(0,Nt.useEffect)((()=>{kte().isEnabled||V()||o(Ute)}),[]);const{fullscreenElement:i}=Fte("FullscreenButton"),a=(0,Nt.useCallback)((async()=>{if(i&&r!==Ute)if(V()){const[e]=i.getElementsByTagName("video"),t=e;await e.play(),t.webkitEnterFullScreen(),t.onpause=()=>n()}else kte().isEnabled&&kte().toggle(i)}),[i,n,r]);return(0,Nt.useEffect)((()=>{if(!kte().isEnabled)return;const e=()=>{const e=kte().isEnabled&&kte().isFullscreen;t(e),e||(document.body.style.setProperty("zoom","1.0000001"),requestAnimationFrame((()=>{document.body.style.removeProperty("zoom")})))};return kte().on("change",e),()=>{kte().isEnabled&&kte().off("change",e)}}),[t]),zr({keyCode:Vr.F,onPress:a,disabledInInput:!0}),Nt.createElement(ei,{title:r},Nt.createElement(Pte,{"aria-label":r,onClick:a},Nt.createElement(e2,{exit:e})))}function Vte(e,t){(0,Nt.useEffect)((()=>{Xe(e,t)}),[e,t])}function zte(e){let t,n="Failed to create Page";if(e?.userFacing){const r=e.userFacing;r.code===Tee.AssetMissing?t=r.extra?.filename?`File '${r.extra.filename}' missing while rendering`:"A file was missing while rendering":function(e){return e.code===Tee.FatalBounceError}(r)&&(t="Rendering process failed"),void 0!==t&&(n=`${n}: ${t}`)}return n}function Gte(e){const t=Fee(e);if(void 0!==t)return function({publishedProject:e,mediaLoadFailed:t,mediaLoadError:n}){const{state:r,bounce_progress:o,error_info:i}=e,a=o?.progress;switch(r){case"new":return"Initializing";case"enqueued":return"Uploading files";case"preparing":return"Preparing to render";case"bouncing":return void 0===a||0===a?"Preparing to render":`Rendering (${Math.round(100*a)}%)`;case"uploading":return"Almost ready";case"failure":return zte(i);case"success":return t?n?.message??"Failed to load media":void 0;default:throw new Error(`Unrecognized publish state: ${r}`)}}({publishedProject:t,mediaLoadFailed:"failure"===e.publish.mediaLoadingState,mediaLoadError:e.publish.loadMediaError})}function Wte(){return document.location.pathname.includes("/view/")?"share_page":"embed"}function Hte(e){const t=(0,Nt.useState)(1),[n]=t;return(0,Nt.useEffect)((()=>{e.current&&(e.current.volume=n)}),[e,n]),t}function qte(e){const t=(0,Nt.useState)(!1),[n]=t;return(0,Nt.useEffect)((()=>{e.current&&(e.current.muted=n)}),[e,n]),t}const $te=Nt.createContext({current:_r});function Kte(){const e=Nt.useContext($te),[t,n]=Nt.useState(e.current?.currentTime??0);return Nt.useEffect((()=>{const t=e.current;if(t)return t.addEventListener("timeupdate",r),()=>{t.removeEventListener("timeupdate",r)};function r(e){n(e.target.currentTime)}}),[e]),t}const Yte="composition";function Zte(){const e=(0,Ft.I0)();return{play:(0,Nt.useCallback)((()=>{e(dq({playerKey:Yte,isUserInitiated:!0,origin:void 0}))}),[e]),pause:(0,Nt.useCallback)((()=>{e(pq({playerKey:Yte,patientPlaybackPause:!1,isSideEffect:!1}))}),[e]),togglePlayback:(0,Nt.useCallback)((()=>{e(hq({playerKey:Yte}))}),[e])}}function Jte(){const e=(0,Ft.I0)();return(0,Nt.useCallback)((t=>{e(yq({playerKey:Yte,timeOffset:t,origin:void 0,scrubbing:!1}))}),[e])}const Qte=e=>e?.thumbnail?.cdn_url||e?.thumbnail?.url||(e=>e?.contents.media.thumbnail.cdn_url||e?.contents.media.thumbnail.url)(e);var Xte=n(7208);function ene({className:e,...t}){return Nt.createElement(Xte.OT,{...t,className:yo()(e,"PanelResizer-module--b5p2Fz")})}const tne=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"chevrons-left"}))),nne=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"captions"}))),rne=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"chevrons-right"})));function one(e=!1){const[t,n]=(0,Nt.useState)(e);return[t,Pr((()=>n((e=>!e)))),Pr((()=>n(!1))),n]}var ine="PublishedVideoPlayer-module--dWi7tW",ane="PublishedVideoPlayer-module--QvfUCL";function sne(){return Nt.createElement("svg",{width:"10",height:"14",viewBox:"0 0 11 15",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M.5 2a1 1 0 112 0v11a1 1 0 01-2 0V2zM8.5 2a1 1 0 112 0v11a1 1 0 01-2 0V2z",fill:"currentColor"}))}function cne(){return Nt.createElement("svg",{width:"11",height:"14",viewBox:"0 0 12 15",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M2.99.792l7.616 5.425a1.575 1.575 0 010 2.566L2.99 14.208A1.575 1.575 0 01.5 12.924V2.075A1.575 1.575 0 012.99.792z",fill:"currentColor"}))}function dne({volume:e,setVolume:t,isMuted:n,setMuted:r,onSliderVisibilityChange:o,color:i,backgroundColor:a,isVideoPlayer:s=!1}){const[c,d,l]=Nr(!1),u=n?0:e,f=n?"Unmute (m)":"Mute (m)",m=Pr((e=>{const n=parseFloat(e.target.value);t(n)})),p=Pr((()=>o?.(!0))),g=Pr((()=>{c||o?.(!1)})),h=Pr((()=>{l(),o?.(!1)})),v=Pr((()=>{r(!n)})),E=(0,Nt.useMemo)((()=>{const e={"--val":u,"--min":0,"--max":1};return i&&(e["--slider-color"]=i),a&&(e["--slider-background-color"]=a),e}),[u,i,a]);zr({keyCode:Vr.M,onPress:v,disabledInInput:!0});const y=s?Pte:Yo;return Nt.createElement("div",{className:yo()("VolumeSlider-module--VQIP35",c&&"VolumeSlider-module--OIFyR0"),onMouseEnter:p,onMouseLeave:g},Nt.createElement(ei,{title:f},Nt.createElement(y,{"aria-label":f,onClick:v,"data-testid":"mute-toggle"},Nt.createElement(R1,{muted:n}))),Nt.createElement("input",{className:"VolumeSlider-module--P54v7C",type:"range",value:u,onChange:m,onMouseDown:d,onMouseUp:h,min:0,max:1,step:.01,"aria-label":"Volume slider","aria-valuetext":100*u+"% volume",style:E}))}function lne({duration:e,seekTo:t,setVolume:n,togglePlayback:r,disabled:o=!1}){const i=Nt.useContext($te),a=Pr((()=>{const e=i.current?.currentTime??0;t(e-5)})),s=Pr((()=>{const e=i.current?.currentTime??0;t(e+5)})),c=Pr((()=>n((e=>100*e%5===0?Math.min(1,e+.05):5*Math.ceil(100*e/5)/100)))),d=Pr((()=>n((e=>100*e%5===0?Math.max(0,e-.05):5*Math.floor(100*e/5)/100))));(0,Nt.useEffect)((()=>{if(o)return;const n=n=>{if(jr(n,!0))return;const{key:o,keyCode:i}=n,l=parseInt(o,10);if(isNaN(l))switch(i){case Vr.UP_ARROW:c(),n.preventDefault();break;case Vr.DOWN_ARROW:d(),n.preventDefault();break;case Vr.RIGHT_ARROW:s(),n.preventDefault();break;case Vr.LEFT_ARROW:a(),n.preventDefault();break;case Vr.SPACE:r(),n.preventDefault();break;default:return}else{if(n.metaKey||n.ctrlKey)return;t(l*e/10)}};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)}),[o,e,a,s,t,r,d,c])}const une=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"refresh-ccw"})));function fne({onWatchAgain:e,onExit:t,project:n}){const r=(0,Nt.useRef)(_r),o=Wte(),i=!n?.custom_branding&&("embed"===o||!Cc());return zr({keyCode:Vr.ESCAPE,onPress:t,disabledInInput:!0}),Nt.createElement("div",{ref:r,className:"absolute inset-0 stack items-center justify-center gap-2 bg-grey-400-a z-1",style:{background:"var(--grey-400-a-base)"},onClick:e=>{e.target===r.current&&t()}},i&&Nt.createElement(Nt.Fragment,null,Nt.createElement("h2",{className:"text-center row h-5"},Nt.createElement(o0,{variant:"body-1-medium",className:"EndOfVideoCTA-module--uXNkDo"},"Try Descript screen recording"),Nt.createElement(o0,{variant:"body-1-medium",className:"EndOfVideoCTA-module--qtmPBs"},"Try Descript for fast video recording and editing")),Nt.createElement("div",{className:"row gap-2"},Nt.createElement(W0,{variant:"light",style:{background:"var(--grey-0)"},onClick:()=>{rt("share_player_video_cta_clicked",{button:"learn more",context:o}),window.open("https://www.descript.com/screen-recording","_blank")}},"Learn more"),Nt.createElement(W0,{onClick:()=>{rt("sign_up_clicked",{origin:"share_page",context:"post_video"}),rt("share_player_video_cta_clicked",{button:"sign up",context:o}),window.open(`${va()}/?sign_up=true`,"embed"===o?"_blank":"_self")}},"Sign up")),Nt.createElement("div",{className:"text-center row h-5"},Nt.createElement(o0,{variant:"label-1-medium",className:"EndOfVideoCTA-module--tAOg71"},"or"))),Nt.createElement(W0,{size:"large-responsive",variant:"light",icon:Nt.createElement(une,null),onClick:e,style:{background:"var(--grey-0)"}},"Play again"))}var mne=n(28904);const pne=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"minus-1x"}))),gne=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"minus"}))),hne=Nt.forwardRef((function(e,t){return Nt.createElement("div",{ref:t},Nt.createElement("div",{className:"icon-1x flex-center"},Nt.createElement(pne,{...e,type:"icon"})),Nt.createElement("div",{className:"icon-2x flex-center"},Nt.createElement(gne,{...e,type:"icon"})))}));var vne=n(59429),Ene=n(26387),yne=n(34410),Sne=n(30565),Ine="Field-module--K021Vg",bne="Field-module--u5ZAT1",Tne="Field-module--Udu2cq",wne="Field-module--T2K5Ty",Cne="Field-module--W01xTj",_ne="Field-module--tTr1KS",Ane="Field-module--WMeaFW",Rne="Field-module--yCq1Vi",Mne="Field-module--TGfi34",Dne="Field-module--nsI1Q1",One="Field-module--Yu3ceW",xne="Field-module--pRVyCT",kne="Field-module--DhzApn",Nne="Field-module--UeVKtZ",Pne="Field-module--VV23wu",Lne="Field-module--ziGmVj",Fne="Field-module--OnH1uP",Une="Field-module--OZJjes",Bne="Field-module--NDQxHY",jne="Field-module--vIb6Ri";function Vne({className:e}){return Nt.createElement("div",{className:yo()(e,Rne,Une)},Nt.createElement(zo,null))}const zne=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement(Zo,{className:Dne},Nt.createElement("div",{className:yo()(e,Rne),...t,ref:n}))})),Gne=Nt.forwardRef((function({className:e,align:t="left",disabled:n,border:r,size:o="default",hasError:i,...a},s){const c="default"===o?"defaultSize":o;return Nt.createElement(Mo.WV.div,{ref:s,"data-disabled":n,"data-readonly":a.readOnly,className:yo()(e,kne,f[c],f[t],{[wne]:"dim"===r,[Pne]:"show"===r,[Ane]:"hide"===r,[Ine]:"button"===r,[Lne]:"show-on-interaction"===r,[Cne]:i}),...a})})),Wne=Nt.forwardRef((function({className:e,align:t="left",children:n,inputId:r,underline:o,suffix:i,size:a="default",saveOnEnter:s=!0,saveOnBlur:c=!0,hasError:d,icon:l,additionalChildren:u,...m},p){const g="default"===a?"defaultSize":a,[h,v]=Nt.useState(!1),E=Nt.useRef(_r),y=(0,s2.e)(E,p),S="aria-label"in m?m["aria-label"]:void 0,I="aria-labelledby"in m?m["aria-labelledby"]:void 0,b=Pr((()=>{v(!1)})),T=Pr((e=>{"Enter"===e.key&&s&&v(!0)}));return Nt.createElement(Gne,{ref:y,className:yo()(e,kne,f[g],f[t],{[One]:m.readOnly,[Nne]:h,[Cne]:d}),...Ee(m,"aria-label","aria-labelledby"),onFocus:(0,wo.M)(m.onFocus,b),onKeyDown:(0,wo.M)(m.onKeyDown,T)},S&&r&&Nt.createElement(l0.T,null,Nt.createElement("label",{htmlFor:r},S)),Boolean(l)&&Nt.createElement(zne,{"data-testid":"field-icon"},l),Nt.createElement(Co.g7,{className:yo()(Mne,{[Bne]:o}),"aria-label":S,"aria-labelledby":I},n),i&&Nt.createElement("div",{className:yo()("relative",Fne)},Nt.createElement("span",{className:_ne},i),Nt.createElement("span",{className:yo()("absolute top-0 right-0",jne)},i)),u)}));var Hne="NumericField-module--XxdfsE",qne="NumericField-module--ryrXwo",$ne="NumericField-module--FhgEBC",Kne="NumericField-module--rQ2TT1",Yne="NumericField-module--Lmw8iB",Zne="NumericField-module--skOY0t",Jne="NumericField-module--J8HzBu",Qne="NumericField-module--gkg9jb",Xne=n(42662),ere=n(31902),tre=n(18491);function nre(e,t,n){const[,r]=String(e).match(/\.(\d+)$/)||["",""];let o=String(e);if(r.length<n||r.length>t||String(e).includes("e")){const n=e.toFixed(t);o=parseFloat(n).toString()}return o}function rre(e){const t=Ld(e.includes(":")?e:`${e}s`);if(!t)throw new Error("Time format invalid");return Fd(t)}const ore=({maximumDecimalDigits:e,minimumDecimalDigits:t})=>({name:"number",valid:/^-?\d*(?:\.\d*)?$/,parse:e=>parseFloat(e),format:n=>"number"===typeof n?nre(n,e,t):""}),ire={number:ore,logarithmic:({base:e=2,maximumDecimalDigits:t,minimumDecimalDigits:n})=>{const r=e;return{name:"logarithmic",valid:/^-?\d*(?:\.\d*)?$/,parse:e=>Math.log(parseFloat(e))/Math.log(r),format:e=>"undefined"===typeof e?"":nre(r**e,t,n)}},decibels:{name:"decibels",valid:/^[-+]?\d*(?:\.\d*)?$/,parse:e=>function(e){let t;if(e===GU)t=0;else if(""===e)t=1;else{const n=parseFloat(e);if(isNaN(n))return;t=HU(n)}return t}(e)??NaN,format:e=>void 0===e?"":WU(e,1)},degrees:({maximumDecimalDigits:e,minimumDecimalDigits:t})=>({name:"degrees",valid:/^\s*-?\d*(?:\.\d*)?\s*\xba?\s*$/,format:n=>"number"===typeof n?`${nre(n,e,t)}`:"",suffix:"\xba",parse:parseFloat}),percentage:({maximumDecimalDigits:e,minimumDecimalDigits:t})=>({name:"percentage",valid:/^-?\d*(?:\.\d*)?%?$/,format:n=>"number"===typeof n?`${nre(100*n,e,t)}`:"",suffix:"%",parse:e=>parseFloat(e)/100}),gain:({maximumDecimalDigits:e,minimumDecimalDigits:t})=>({name:"gain",valid:/^-?\d*(?:\.\d*)?%?$/,format:n=>"number"===typeof n?`${nre(100*n,e,t)}`:"",suffix:"%",parse:e=>parseFloat(e)/100}),durationShort:{name:"durationShort",valid:Dd,format:e=>"undefined"===typeof e?"":0===e?"0":Cd({signedTime:e,padMinutes:!1,padSeconds:!1,forceHours:!1,forceMinutes:!1,msDigits:e<1?2:1}).string,parse:rre},duration:{name:"duration",valid:Dd,format:e=>"undefined"===typeof e?"":Cd({signedTime:e,padMinutes:!1,padSeconds:!1,forceMinutes:e>1,msDigits:e<1?2:1}).string,parse:rre}};function are(e){return!e.dragSnapPoints||"mouse"!==e.origin||e.shiftKey||e.metaKey?"logarithmic"===e.type&&"keyboard"!==e.origin?function({value:e,max:t,min:n,direction:r,movementX:o=("increment"===r?1:-1)}){const i=K((e-n)/(t-n)+o/100,0,1);return K(i*(t-n)+n,n,t)}(e):function({direction:e,metaKey:t,shiftKey:n,value:r,min:o,max:i,movementX:a=("increment"===e?2:-2),macroStep:s,microStep:c,step:d,dragStep:l,origin:u}){const f="mouse"===u&&void 0!==l?n?10*l:t?l/10:l:n?s:t?c:d,m="increment"===e?Math.ceil(a/2):Math.floor(a/2);return K(Number(r)+f*m,o,i)}(e):function(e){const{dragSnapPoints:t,min:n,max:r,movementX:o=1}=e;let i,a=1/0;for(const c of t){const t=Math.abs(c-e.value);t<a&&(i=c,a=t)}if(void 0===i&&(i=e.value),o%4!==0)return e.value;const s=K(t.indexOf(i)+(o>0?1:-1),0,t.length-1);return K(t[s],n,r)}({...e,dragSnapPoints:e.dragSnapPoints})}const sre=(0,Xne.C)({id:"NumericField",predictableActionArguments:!0,schema:{context:{},events:{}},context:{value:0,startValue:void 0,hasEdited:!1,min:-1/0,max:1/0,step:1,isMultiValue:!1,microStep:.1,macroStep:100,displayValue:"0",previousDisplayValue:"0",type:"number",maximumDecimalDigits:2,minimumDecimalDigits:0,typeUtil:ore({maximumDecimalDigits:2,minimumDecimalDigits:0}),pointerLock:co(),lastTouchDragPixel:void 0},initial:"inactive",entry:["initialize"],on:{disable:{target:"disabled"}},states:{inactive:{on:{pointerDown:{target:"pressed",actions:["updateDragStart","requestPointerLock"]},focus:{target:"editing"},synchronize:{actions:["synchronize"]}}},disabled:{on:{enable:{target:"inactive"},synchronize:{actions:["synchronize"]}}},pressed:{on:{release:{target:"editing",actions:["cancelPointerLockRequest"]},drag:{target:"dragging",cond:"hasInitiatedDrag"}}},editing:{entry:["onEditStart","setStartValue"],on:{change:{actions:["updateDisplayValue","setHasEdited"]},step:{actions:["executeStep","setHasEdited","validOnChange"]},save:{target:"inactive",actions:["defaultToPreviousDisplayValue","clamp","removeHasEdited","validOnChange","saveIfChanged","resetStartValue","savePreviousDisplayValue"]},unmount:{actions:["saveIfChanged"]},pointerDownBorder:{target:"pressed",actions:["updateDragStart","requestPointerLock"]}},exit:["removeHasEdited"]},dragging:{invoke:{src:(e,t)=>n=>{if("drag"!==t.type||e.isMultiValue)return;let r,o,i=0;e.pointerLock.attach({event:t.event,onMoveEnd:()=>n("release"),onMove:({cursor:t,delta:a,shiftKey:s,metaKey:c})=>{const d=e.dragSnapPoints?5:2,l=Math.floor(t.x/d)*d;if(o===l)return;const u=a.x>0?"increment":"decrement";r!==u?(i=0+a.x,r=u):i+=a.x,o=l,n({type:"step",origin:"mouse",shiftKey:s,metaKey:c,movementX:e.dragSnapPoints?i:a.x,direction:r,cursor:t})}})}},on:{step:{actions:["executeStep","onUpdateCursorPosition","validOnChange"]},release:{target:"#NumericField.inactive",actions:["defaultToPreviousDisplayValue","onSave","savePreviousDisplayValue","clearLastDragPixel"]}}}}},{guards:{isDisplayValueValid:e=>{const t=e.typeUtil.parse(e.displayValue);return!(""===e.displayValue||isNaN(t)||t<e.min||t>e.max)},hasSaveValueChanged:e=>e.startValue!==e.typeUtil.parse(e.displayValue),hasInitiatedDrag:(e,t)=>"drag"===t.type&&(void 0!==e.dragStartPixel&&Math.abs(t.event.clientX-e.dragStartPixel)>=5)},actions:{synchronize:(0,ere.f0)(((e,t)=>{const n=t,r=void 0!==n.isMultiValue?n.isMultiValue:e.isMultiValue,o=r?"Mixed":e.typeUtil.format(n.value);return{isMultiValue:r,hasEdited:!1,value:n.value,min:n.min??e.min,max:n.max??e.max,displayValue:o,previousDisplayValue:o}})),executeStep:(0,ere.f0)(((e,t)=>{if(e.isMultiValue)return{value:e.value,displayValue:e.displayValue};const n=are({...t,...e,value:e.typeUtil.parse(e.displayValue||e.previousDisplayValue),type:"logarithmic"===e.typeUtil.name?"logarithmic":"gain"===e.typeUtil.name?"gain":"linear"});return{value:n,displayValue:e.typeUtil.format(n)}})),clamp:(0,ere.f0)((e=>{const t=K(e.typeUtil.parse(e.displayValue),e.min,e.max);return isNaN(t)?e:{value:t,displayValue:e.typeUtil.format(t)}})),updateDisplayValue:(0,ere.f0)(((e,t)=>{const n=t;return""===n.updatedDisplayValue||e.typeUtil.valid.test(n.updatedDisplayValue)?{displayValue:n.updatedDisplayValue}:e})),validOnChange:tre.RN([{cond:"isDisplayValueValid",actions:["onValueChange"]}]),saveIfChanged:tre.RN([{cond:"hasSaveValueChanged",actions:["onSave"]}]),setStartValue:(0,ere.f0)((e=>({...e,startValue:e.typeUtil.parse(e.displayValue)}))),resetStartValue:(0,ere.f0)({startValue:void 0}),clearLastDragPixel:(0,ere.f0)({lastTouchDragPixel:void 0}),initialize:(0,ere.f0)((e=>{let t=ire[e.type];"function"===typeof t&&(t=t(e));const n=e.isMultiValue?"Mixed":t.format(e.value);return{typeUtil:t,displayValue:n,previousDisplayValue:n}})),defaultToPreviousDisplayValue:(0,ere.f0)((e=>""===e.displayValue?{displayValue:e.previousDisplayValue}:e)),savePreviousDisplayValue:(0,ere.f0)((e=>({previousDisplayValue:e.displayValue}))),updateDragStart:(0,ere.f0)({dragStartPixel:(e,{event:t})=>(t.preventDefault(),t.clientX)}),setHasEdited:(0,ere.f0)({hasEdited:!0}),removeHasEdited:(0,ere.f0)({hasEdited:!1}),requestPointerLock:e=>{e.pointerLock.request()},cancelPointerLockRequest:(e,t)=>{t.event.stopPropagation(),e.pointerLock.cancelRequest()}}}),cre=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"horizontal-resize",type:"cursor"}))),[dre,lre]=(0,Qr.k)("NumericField"),ure={x:12,y:12},fre=Nt.forwardRef((function({className:e,placeholder:t="",type:n="number",value:r,onValueChange:o,onSave:i,min:a=-1/0,max:s=1/0,maximumDecimalDigits:c=2,minimumDecimalDigits:d=0,step:l=("percentage"===n||"gain"===n?.01:1),microStep:u=l/10,macroStep:f=10*l,disabled:p=!1,autoComplete:g="off",readOnly:h=!1,dragSnapPoints:v,dragStep:E,isMultiValue:y=!1,inputSize:S,selectOnFocus:I=!0,saveOnBlur:b=!0,saveOnEnter:T=!0,children:w,wrapperRef:C,inputStyle:_,...A},R){const M=(0,yne.M)(),D=(0,Nt.useRef)(_r),O=(0,s2.e)(D,C),x=(0,Nt.useRef)(_r),k=(0,s2.e)(x,R),N=Nt.useRef(_r),[P,L]=Yr({update:e=>{const t=e.typeUtil.parse(e.displayValue);o?.(t)}}),F=Pr((e=>{L(),o?.(e.value),i?.(e.value)})),U=Pr((()=>{x.current&&(x.current.focus(),x.current.setSelectionRange(0,Math.max(0,x.current.value.length)))})),B=Pr((()=>{I&&U()})),j=Pr(((e,{cursor:t})=>{N.current&&(t?(N.current.updateVisibility(!0),N.current.updatePosition(t)):N.current.updateVisibility(!1))}));let V,z;Hr((()=>{z("unmount")})),[V,z]=(0,Sne.e)(sre,{context:{type:n,value:r,min:a,max:s,step:l,macroStep:f,microStep:u,isMultiValue:y,maximumDecimalDigits:c,minimumDecimalDigits:d,dragSnapPoints:v,dragStep:E,base:"base"in A?A.base:void 0},actions:{onSave:F,onValueChange:P,onEditStart:B,onUpdateCursorPosition:j}});const G=Pr((()=>z("focus"))),W=Pr((()=>{b&&z("save")})),H=Pr((e=>{z({type:"pointerDown",event:e})})),q=Pr((e=>{z({type:"drag",event:e})})),$=Pr((e=>{z({type:"release",event:e})})),K=Pr((e=>{z({type:"change",updatedDisplayValue:e.target.value})})),Y=Pr((e=>{"ArrowUp"===e.key?(e.preventDefault(),z({type:"step",shiftKey:e.shiftKey,metaKey:Zr(e),origin:"keyboard",direction:"increment"}),requestAnimationFrame(U)):"ArrowDown"===e.key?(e.preventDefault(),z({type:"step",shiftKey:e.shiftKey,metaKey:Zr(e),origin:"keyboard",direction:"decrement"}),requestAnimationFrame(U)):"Enter"===e.key?(!b&&T&&z("save"),e.preventDefault(),D.current?.focus()):"Escape"===e.key&&(x.current?.blur(),e.preventDefault(),e.stopPropagation())}));$r(r)&&void 0!==r&&z({type:"synchronize",value:r}),$r(y)&&void 0!==r&&z({type:"synchronize",value:r,isMultiValue:y}),$r(s)&&void 0!==r&&z({type:"synchronize",value:r,max:s}),$r(a)&&void 0!==r&&z({type:"synchronize",value:r,min:a}),V.matches("disabled")||!p&&!h?!V.matches("disabled")||p||h||z("enable"):z("disable");const Z=V.matches("dragging");(0,Nt.useEffect)((()=>{Z&&D.current?.focus()}),[Z]);const J={onPointerDown:Pr((e=>{z({type:"pointerDownBorder",event:e}),e.stopPropagation(),e.preventDefault()})),onPointerMove:q,onPointerUp:$},Q=p?"cursor-not-allowed":"cursor-text";return Nt.createElement(dre,{id:M,...A,inputStyle:_,inputRef:k,onChange:K,displayValue:V.context.displayValue,autoComplete:g,disabled:p,readOnly:h,placeholder:t,max:s,min:a,inputSize:S},Nt.createElement(Wne,{ref:O,tabIndex:-1,className:yo()(e,Qne,Q,"relative touch-none",{"w-fit":!e?.includes("w-full"),[m[n]]:n,[qne]:V.matches("dragging"),[$ne]:y,[Kne]:V.matches("editing")}),...A,disabled:p,readOnly:h,inputId:M,suffix:y?void 0:A.suffix||V.context.typeUtil.suffix,"data-disabled":p,"data-state":V.matches("dragging")?"active":"",onKeyDown:(0,wo.M)(A.onKeyDown,Y),onFocus:(0,wo.M)(A.onFocus,G),onBlur:(0,wo.M)(A.onBlur,W),onPointerDown:(0,wo.M)(A.onPointerDown,H),onPointerMove:(0,wo.M)(A.onPointerMove,q),onPointerUp:(0,wo.M)(A.onPointerUp,$),saveOnEnter:T,additionalChildren:V.matches("editing")&&Nt.createElement(Nt.Fragment,null,Nt.createElement("div",{className:"touch-none absolute left-0 right-0 bottom-0 h-1 z-1 cursor-click-and-drag",...J}),Nt.createElement("div",{className:"touch-none absolute left-0 right-0 top-0 h-1 z-1 cursor-click-and-drag",...J}),Nt.createElement("div",{className:"touch-none absolute left-0 top-0 bottom-0 w-1 z-1 cursor-click-and-drag",...J}),Nt.createElement("div",{className:"touch-none absolute right-0 top-0 bottom-0 w-1 z-1 cursor-click-and-drag",...J}))},w),V.matches("dragging")&&Nt.createElement(lo,{ref:N,cursorPoint:ure},Nt.createElement(cre,{size:24})))})),mre=Nt.forwardRef((function({className:e,...t},n){const{inputSize:r,min:o,max:i,autoComplete:a,readOnly:s,disabled:c,placeholder:d,onChange:l,displayValue:u,inputRef:f,inputStyle:m,id:p}=lre("NumericField.Input"),g={...m||{},minWidth:(r?.76*r:1)+"em"};return Nt.createElement("div",{ref:n,...t,className:yo()(Zne,e),style:g,"data-value":u},Nt.createElement("input",{ref:f,className:yo()(Yne,c?"cursor-not-allowed":"cursor-text","label-1-regular"),id:p,placeholder:d,value:u,disabled:c,onChange:l,type:"text",inputMode:"numeric",min:o,max:i,autoComplete:a,readOnly:s}))})),pre=Nt.forwardRef((function(e,t){return Nt.createElement(fre,{ref:t,...e},Nt.createElement(mre,null))}));var gre=n(42277),hre=n.n(gre),vre="TextField-module--zfzokC",Ere="TextField-module--LtRlCd";const yre=Nt.forwardRef((function(e,t){return Nt.createElement(T2,null,Nt.createElement(hre(),{...e,innerRef:t??void 0}))})),Sre=Nt.forwardRef((function({placeholder:e,defaultValue:t,value:n,onValueChange:r,onFocusChange:o,onBlur:i,onFocus:a,onSave:s,disabled:c,autoComplete:d="off",autoSelect:l=!1,selectionRange:u,saveOnBlur:f=!0,preventFocusOnEnter:m=!1,resetOnEmptySave:p=!1,type:g="text",readOnly:h,maxLength:v,minLength:E,required:y,inputVariant:S="regular",inputClassName:I,color:b,...T},w){const C=(0,yne.M)(),_=(0,Nt.useRef)(_r),[A,R,M]=Nr(!1),D=(0,Nt.useRef)(_r),O=(0,Nt.useRef)(void 0),x=(0,s2.e)(D,w),k=Pr((()=>{document.activeElement!==D.current&&D.current?.focus()})),N=Pr((()=>{requestAnimationFrame((()=>{if(D.current)if("dynamic-height"===g){if(window.getSelection&&document.createRange){const e=document.createRange();e.selectNodeContents(D.current);const t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}}else D.current.select()}))})),P=Pr((()=>{O.current=U,l&&(u?D.current?.setSelectionRange(u.start,u.end):N()),R(),o?.(!0)})),L=Pr((e=>{document.activeElement!==D.current&&(e.preventDefault(),N())})),F=Pr((()=>{A||N()})),[U="",B]=(0,Ene.T)({prop:n,defaultProp:t,onChange:r}),j=Pr((e=>{const n=e||U;n!==O.current&&(n.trim()||!p?s?.(n):B(t))}));(0,Nt.useEffect)((()=>{"undefined"!==typeof t&&B(t)}),[B,t]);const V=Pr((e=>{B(e.target.value)})),z=Pr((e=>{"Enter"===e.key&&"area"!==g&&"dynamic-height"!==g&&(f||j(),m||_.current?.focus())})),G=Pr((()=>{f&&j(),M(),o?.(!1)})),W=Pr((()=>{A&&f&&j()}));(0,Nt.useEffect)((()=>W),[W]);const H=c?"cursor-not-allowed":"cursor-text",q={id:C,placeholder:e,disabled:c,onChange:V,onMouseDown:L,ref:x,className:yo()("TextField-module--hlXjle",I,H,"inline"===S?vre:Ere),onPointerUp:Fr,onFocus:(0,wo.M)(a,P),onBlur:(0,wo.M)(i,G)};return Nt.createElement(Wne,{...T,saveOnEnter:"area"!==g&&"dynamic-height"!==g&&T.saveOnEnter,className:yo()(T.className,"TextField-module--hfjMpO",H,"inline"===S?"body-2-medium":"label-1-regular",{"TextField-module--NiHmnW":!A,"TextField-module--P5hYry":"area"===g,"TextField-module--dAO5M2":"dynamic-height"===g}),tabIndex:-1,ref:_,disabled:c,readOnly:h,inputId:C,onClick:(0,wo.M)(T.onClick,k),onDoubleClick:(0,wo.M)(T.onDoubleClick,F),onKeyDown:(0,wo.M)(T.onKeyDown,z)},Nt.createElement("div",{className:yo()("TextField-module--nLMj6M","inline"===S?vre:Ere),"data-value":U||e},"area"===g?Nt.createElement("textarea",{...q,rows:T.rows||1,value:U,autoComplete:d,readOnly:h,maxLength:v,minLength:E,required:y}):"dynamic-height"===g?Nt.createElement(yre,{...q,tabIndex:c?-1:0,"data-role":"text-field",role:"textbox",html:U,"aria-autocomplete":d,"aria-readonly":h,"aria-required":y}):Nt.createElement("input",{...q,size:1,type:g,value:U,autoComplete:d,readOnly:h,maxLength:v,minLength:E,required:y,...b?{style:{color:b}}:{}})))}));var Ire="Menu-module--Og8JwN",bre="Menu-module--YRyzjo",Tre="Menu-module--KO6M4J",wre="Menu-module--DxAzy9",Cre="Menu-module--so9GeP",_re="Menu-module--kJgUbp",Are="Menu-module--SMgmjv",Rre="Menu-module--X0SYn_",Mre="Menu-module--PwX7Zg",Dre="Menu-module--pVKaPR",Ore="Menu-module--eG9uW1",xre="Menu-module--pqoCiw",kre="Menu-module--rBwXcM",Nre="Menu-module--BMdZlq",Pre="Menu-module--BbNVLj",Lre="Menu-module--fh3gKJ",Fre="Menu-module--KYAgOj",Ure="Menu-module--lzPrFH",Bre="Menu-module--wuucpR",jre="Menu-module--X1uu5t",Vre="Menu-module--pBxHUF",zre="Menu-module--ey08Yk",Gre="Menu-module--l_Rp9x",Wre="Menu-module--Tz0f2u",Hre="Menu-module--fb9IKj",qre="Menu-module--A8g1Qz",$re="Menu-module--sAIIig",Kre="Menu-module--kl4ewY",Yre="Menu-module--NNwjST",Zre="Menu-module--ZJIDzl",Jre="Menu-module--afShHQ";const Qre=(0,Nt.createContext)(!1),Xre=(0,Nt.createContext)(!1),eoe=(0,Nt.createContext)(!1);function toe(e){const t=(0,Nt.useContext)(Qre),n=(0,Nt.useContext)(Xre),r=(0,Nt.useContext)(eoe);return"context"===e?n:"dropdown"===e?t:r}const noe=Nt.createContext(!0),roe=Nt.forwardRef((function({children:e,className:t,disableBackground:n=!1,...r},o){const i=Mr(),a=Nt.useContext(noe);return Nt.createElement(noe.Provider,{value:!a},Nt.createElement(Co.g7,{ref:o,className:yo()(t,a&&i&&!n?"DarkBackground-module--a758Ea":"bg-grey-0"),...r},e))}));var ooe=n(48105),ioe="Checkbox-module--lqS6GK",aoe="Checkbox-module--e1j4Uv",soe="Checkbox-module--DCg72d",coe="Checkbox-module--K51Nb1",doe="Checkbox-module--MekTTj",loe="Checkbox-module--URm6k8",uoe="Checkbox-module--cwHA10",foe="Checkbox-module--Nw_Hml",moe="Checkbox-module--xMuLi_",poe="Checkbox-module--QPUoex",goe="Checkbox-module--f7tb4s",hoe="Checkbox-module--uxZa4z";function voe({color:e="#FFF"}){return Nt.createElement("svg",{width:"14",height:"10",xmlns:"http://www.w3.org/2000/svg"},Nt.createElement("path",{d:"M5 10L0 5.2l1.4-1.35L5 7.3 12.6 0 14 1.35z",fill:e,fillRule:"evenodd"}))}function Eoe({color:e="#FFF"}){return Nt.createElement("svg",{width:"12",height:"10",fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 10"},Nt.createElement("path",{d:"M11.333 1 4 8.333.667 5",stroke:e}))}function yoe(e){const t=(0,Nt.useContext)(bo)?Eoe:voe;return Nt.createElement(t,{...e})}const Soe=Nt.forwardRef((function({checked:e,children:t,fill:n,isProcessing:r,className:o,disabled:i,required:a,name:s,value:c,onCheckedChange:d,size:l="medium",isReversed:u,variant:f="default",...m},p){const h=t?"label":"div",v=Pr((t=>{t.preventDefault(),d?.("indeterminate"===e||!e,c,t)})),E="indeterminate"===e?Nt.createElement("div",{className:doe}):"menu"===f?Nt.createElement(B1,null):Nt.createElement(yoe,null);return vo(),Nt.createElement(h,{className:yo()(hoe,o,g[f],{[soe]:i,[poe]:u}),...m},Nt.createElement("div",{className:aoe},Nt.createElement(ooe.fC,{ref:p,checked:e,onClick:v,disabled:i,required:a,name:s,value:"string"===typeof c?c:void 0,className:yo()(ioe,g[l],{[coe]:"grey"===n})},r?Nt.createElement("div",{className:loe},Nt.createElement(u0,{color:"var(--grey-800)",width:14})):Nt.createElement(ooe.z$,{className:loe},E))),Boolean(t)&&Nt.createElement("span",{className:yo()(uoe,"text-grey-800")},t))}));function Ioe(e){return"string"===typeof e?ee(e):e}const[boe,Toe]=(0,Qr.k)("Menu",{type:"context"});function woe({onOpenChange:e,...t}){const{type:n}=Toe("Menu.Sub"),{scrollAreaRef:r}=_oe("Sub"),o="context"===n?vne.Tr:mne.Tr,[i,a]=d2("open"in t?t.open:void 0,e),s="context"===n?Xre:"dropdown"===n?Qre:eoe;return Nt.useEffect((()=>{const{current:e}=r;if(e&&i)return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)};function t(){a?.(!1)}}),[r,i,a]),Nt.createElement(s.Provider,{value:i},Nt.createElement(boe,{type:n},Nt.createElement(o,{...t,open:i,onOpenChange:a})))}woe.displayName="MenuSub";const[Coe,_oe]=(0,Qr.k)("MenuContent",{skipAnimation:void 0,checkStyle:"icon",preventCloseAutoFocus:void 0,contentRef:{current:_r},scrollAreaRef:{current:_r}});function Aoe({hasHeader:e,hasIcons:t,className:n,alignOffset:r,roughMaxItems:o,style:i,children:a,portal:s=!0,collisionPadding:c=8,checkStyle:d,...l}){const u=r??-4,f="sideOffset"in l?l.sideOffset:4,m=(0,Nt.useContext)(Ao),g=(0,Nt.useRef)(_r),h=(0,Nt.useRef)(_r),v=(0,Nt.useContext)(bo),{type:E}=Toe("Menu.Content"),[y,S,I]=Nr(!1),b="context"===E?vne.VY:mne.VY,T="context"===E?vne.Uv:mne.Uv,[w,C,_]=Nr(!1),A=Pr((e=>{w&&(e.preventDefault(),_()),y&&(e.preventDefault(),I())}));vo();let R=Nt.createElement(roe,null,Nt.createElement(b,{ref:g,"data-redesign":v||void 0,className:yo()(n,bre,p[E],{[Ore]:e}),alignOffset:u,sideOffset:f,...l,collisionPadding:c,onClick:(0,wo.M)(l.onClick,Fr),onMouseDown:(0,wo.M)(l.onMouseDown,Fr),onContextMenu:(0,wo.M)(l.onContextMenu,Fr),onCloseAutoFocus:(0,wo.M)(l.onCloseAutoFocus,A),onEscapeKeyDown:(0,wo.M)(l.onEscapeKeyDown,Fr),style:i},Nt.createElement(h2,{type:"auto",style:{maxHeight:o?28*(o+.5)+"px":i?.maxHeight}},Nt.createElement(v2,{ref:h,className:yo()(Tre,"stack py-1")},a),Nt.createElement(b2,null))));return s&&(R=Nt.createElement(T,{container:m?.current},R)),Nt.createElement(Coe,{skipAnimation:y,skipAnimationOn:S,preventCloseAutoFocus:C,hasIcons:(!v||"context"!==E)&&t,contentRef:g,scrollAreaRef:h,checkStyle:d},Nt.createElement(boe,{type:E},R))}function Roe({hasHeader:e,hasIcons:t,className:n,alignOffset:r,roughMaxItems:o,style:i,children:a,portal:s=!0,collisionPadding:c=8,...d}){const l=r??-4,u="sideOffset"in d?d.sideOffset??-20:void 0,f=(0,Nt.useContext)(Ao),m=(0,Nt.useRef)(_r),g=(0,Nt.useRef)(_r),h=(0,Nt.useContext)(bo),{type:v}=Toe("Menu.SubContent"),E=_oe("Menu.SubContent"),y="context"===v?vne.tu:mne.tu,S="context"===v?vne.Uv:mne.Uv;vo();const I=Nt.createElement(Coe,{...E,scrollAreaRef:g,contentRef:m,hasIcons:t??((!h||"context"!==v)&&E.hasIcons)},Nt.createElement(boe,{type:v},Nt.createElement(y,{ref:m,"data-redesign":h||void 0,className:yo()(n,bre,p[v],{[Ore]:e}),alignOffset:l,sideOffset:u,...d,collisionPadding:c,onClick:(0,wo.M)(d.onClick,Fr),onMouseDown:(0,wo.M)(d.onMouseDown,Fr),style:i},Nt.createElement(h2,{type:"auto",style:{maxHeight:o?28*(o+.5)+"px":i?.maxHeight||"calc(100vh - 10px)"}},Nt.createElement(v2,{ref:g,className:yo()(Tre,"stack py-1")},a),Nt.createElement(b2,null)))));return s?Nt.createElement(S,{container:f?.current},I):I}function Moe({className:e,...t}){const{type:n}=Toe("Menu.Separator"),r="context"===n?vne.Z0:mne.Z0;return Nt.createElement(r,{className:yo()(Hre),...t})}Roe.displayName="MenuSubContent",Moe.displayName="MenuSeparator";const Doe=Nt.forwardRef((function({className:e,isDestructive:t,isSelected:n,label:r,icon:o,iconSize:i,rightContent:a,preventAutoFocus:s,skipCloseAnimation:c,selectionStyle:d="item",sentenceCase:l=!0,...u},f){const{type:m}=Toe("Menu.Item"),g=toe(m),{hasIcons:h,preventCloseAutoFocus:v,skipAnimationOn:E}=_oe("Menu.Item"),y="context"===m?vne.ck:mne.ck,S=Pr((e=>{if(!(e.target instanceof HTMLElement)||!e.target.offsetParent)return;const t=e.target.getBoundingClientRect(),n=e.target.offsetParent.getBoundingClientRect();t.bottom===n.bottom?e.target.offsetParent.scrollTop=e.target.offsetParent.scrollTop+4:t.top===n.top&&(e.target.offsetParent.scrollTop=e.target.offsetParent.scrollTop-4)}));return Nt.createElement(y,{ref:f,className:yo()(Lre,e,p[`${d}Selection`],{[Cre]:t,[Wre]:n}),...u,onSelect:(0,wo.M)(u.onSelect,(0,wo.M)(s?v:void 0,c?E:void 0)),onPointerLeave:(0,wo.M)(u.onPointerLeave,g?void 0:Lr),onPointerMove:(0,wo.M)(u.onPointerMove,g?void 0:Lr),onFocus:(0,wo.M)(u.onFocus,S)},(!0===h||void 0===h&&o)&&Nt.createElement(Zo,{className:kre,size:i},o),Nt.createElement("div",{className:Bre},l?Ioe(r):r),Boolean(a)&&Nt.createElement("div",{className:jre},a))})),[Ooe,xoe]=(0,Qr.k)("MenuToolbar",{itemRef:{current:_r}}),koe=Nt.forwardRef((function({children:e,className:t,...n},r){const o=(0,Nt.useRef)(_r),i=(0,s2.e)(o,r),{type:a}=Toe("Menu.Toolbar"),s="context"===a?vne.ck:mne.ck,c=Pr((e=>{e.target===e.currentTarget&&o.current?.querySelector("button:not(.disabled), input:not(.disabled")?.focus()})),d=Pr((e=>{if("Tab"===e.key){const t=Array.from(o.current?.querySelectorAll("button:not(.disabled), input:not(.disabled")||[]),n=(t.findIndex((e=>e===document.activeElement))+(e.shiftKey?-1:1))%t.length;t[n<0?t.length-1:n].focus()}})),l=Pr((e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){const t=new KeyboardEvent("keydown",e);o.current?.dispatchEvent(t)}}));return Nt.createElement(Ooe,{itemRef:o},Nt.createElement(s,{ref:i,...n,className:yo()("h-5 px-2 row",t),onClick:(0,wo.M)(n.onClick,Lr),onPointerMove:(0,wo.M)(n.onPointerMove,Lr),onKeyDown:(0,wo.M)(n.onKeyDown,d),onPointerLeave:(0,wo.M)(n.onPointerLeave,Lr),onFocus:(0,wo.M)(n.onFocus,c)},Nt.createElement("div",{className:"flex-1 row gap-2",onKeyDown:l,onClick:Fr},e)))})),Noe=Nt.forwardRef((function({defaultValue:e,value:t,onValueChange:n,onSave:r,type:o="text",className:i,...a},s){const c=(0,Nt.useRef)(_r),d=(0,s2.e)(c,s),{itemRef:l}=xoe("Menu.Input"),{contentRef:u}=_oe("Menu.Input"),[f="",m]=(0,Ene.T)({prop:t,defaultProp:e,onChange:n}),p=Pr((()=>{requestAnimationFrame((()=>{c.current?.focus(),c.current?.select()}))}));(0,Nt.useEffect)(p,[p]);const g=Pr((e=>{if("ArrowDown"===e.key||"ArrowUp"===e.key||"Tab"===e.key){const t=new KeyboardEvent("keydown",e);l.current?.dispatchEvent(t),e.preventDefault()}e.stopPropagation()}));return Nt.useEffect((()=>{const e=u.current;if(e)return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)};function t(e){const t=c.current;e.target!==t&&t&&e.key.match(/^[\p{L}\p{N}]$/iu)&&(e.stopPropagation(),e.preventDefault(),t.focus(),document.execCommand("insertText",!1,e.key),setTimeout((()=>{t.setSelectionRange(t.value.length,t.value.length)}),50))}}),[u]),"text"===o?Nt.createElement(Sre,{...a,className:yo()("flex-1",i),ref:d,onPointerDown:Fr,onKeyDown:(0,wo.M)(a.onKeyDown,g),border:a.border?a.border:"show",value:f,onValueChange:m,onSave:r}):Nt.createElement(pre,{...a,selectOnFocus:!1,className:yo()("flex-1",i),ref:d,onPointerDown:Fr,onKeyDown:(0,wo.M)(a.onKeyDown,g),border:"show",value:f,onValueChange:m,onSave:r})}));function Poe({className:e,icon:t,iconSize:n,label:r,rightContent:o,isSelected:i,skipCloseAnimation:a,triggerFirstMenuItemOnClick:s,sentenceCase:c=!0,...d}){const{hasIcons:l,skipAnimationOn:u}=_oe("Menu.SubTrigger"),f=(0,Nt.useContext)(bo),m=(0,Nt.useRef)(_r),{type:p}=Toe("Menu.SubTrigger"),g="context"===p?vne.fF:mne.fF,h=Pr((()=>{if(!m.current||!s)return;const e=m.current.getAttribute("aria-controls");if(!e)return;const t=document.getElementById(e)?.querySelector('[role="menuitemradio"], [role="menuitem"]');t&&(t.focus(),t.click())})),v=Pr((e=>{if(!(e.target instanceof HTMLElement)||!e.target.offsetParent)return;const t=e.target.getBoundingClientRect(),n=e.target.offsetParent.getBoundingClientRect();t.bottom===n.bottom?e.target.offsetParent.scrollTop=e.target.offsetParent.scrollTop+4:t.top===n.top&&(e.target.offsetParent.scrollTop=e.target.offsetParent.scrollTop-4)}));return Nt.createElement(g,{ref:m,className:yo()(Lre,e,{[Wre]:i}),...d,onClick:(0,wo.M)(a?u:void 0,(0,wo.M)(d.onClick,h)),onFocus:(0,wo.M)(d.onFocus,v)},(!0===l||void 0===l&&t)&&Nt.createElement(Zo,{className:kre,size:n},t),Nt.createElement("div",{className:Bre},c?Ioe(r):r),Nt.createElement("div",{className:jre},o,!0!==d.disabled&&(f?Nt.createElement(Zo,null,Nt.createElement(F1,null)):Nt.createElement("span",{className:yo()("flex",Dre)},Nt.createElement(J1,null)))))}function Loe({className:e,shortcut:t,...n}){return void 0===t?_r:Nt.createElement("div",{className:yo()(e,qre),...n},ge(t))}function Foe({children:e,placement:t}){return(0,Nt.useContext)(bo)?Nt.createElement(ti,{title:e,className:Are,placement:t??"right"}):Nt.createElement(ei,{title:e,hasNonInteractiveTrigger:!0,className:Are,placement:t??"right"},Nt.createElement(K1,{opacity:.4}))}function Uoe({className:e,...t}){const{type:n}=Toe("Menu.Label"),r="context"===n?vne.__:mne.__;return Nt.createElement(r,{className:yo()(e,Vre),...t})}Poe.displayName="MenuSubTrigger",Loe.displayName="MenuItemShortcut",Foe.displayName="MenuItemExplanation",Uoe.displayName="MenuLabel";const Boe=Nt.createContext("");function joe(e){const{type:t}=Toe("Menu.RadioGroup"),n="context"===t?vne.Ee:mne.Ee;return Nt.createElement(Boe.Provider,{value:e.value||""},Nt.createElement(n,{...e}))}const Voe=Nt.forwardRef((function({checkStyle:e},t){return(0,Nt.useContext)(bo)?Nt.createElement(Zo,null,"component"===e?Nt.createElement(Soe,{"aria-hidden":!0,className:"pointer-events-none",checked:!0}):Nt.createElement(B1,null)):Nt.createElement("div",{ref:t,className:Pre},Nt.createElement(j1,null))}));function zoe({label:e,rightContent:t,className:n,inputType:r,icon:o,iconSize:i,preventAutoFocus:a,skipCloseAnimation:s,sentenceCase:c=!0,isChecked:d,...l}){const{preventCloseAutoFocus:u,skipAnimationOn:f,checkStyle:m}=_oe("Menu.SelectableItem"),{type:p}=Toe("Menu.SelectableItem"),g=toe(p),h="checkbox"===r?vne.oC:vne.Rk,v="checkbox"===r?mne.oC:mne.Rk,E="context"===p?h:v,y="context"===p?vne.wU:mne.wU;return Nt.createElement(E,{className:yo()(Lre,Gre,n,{[Fre]:o}),...l,onSelect:(0,wo.M)(l.onSelect,(0,wo.M)(a?u:void 0,s?f:void 0)),onPointerLeave:(0,wo.M)(l.onPointerLeave,g?void 0:Lr),onPointerMove:(0,wo.M)(l.onPointerMove,g?void 0:Lr)},d?Nt.createElement(y,{asChild:!0},"indeterminate"===l.checked?Nt.createElement(Zo,null,"component"===m?Nt.createElement(Soe,{"aria-hidden":!0,className:"pointer-events-none",checked:"indeterminate"}):Nt.createElement(hne,null)):Nt.createElement(Voe,{checkStyle:m})):"component"!==m||l.checked?o&&Nt.createElement(Zo,{className:kre,size:i},o):Nt.createElement(Zo,null,Nt.createElement(Soe,{"aria-hidden":!0,className:"pointer-events-none"})),Nt.createElement("div",{className:Bre},c?Ioe(e):e),Boolean(t)&&Nt.createElement("div",{className:jre},t))}function Goe(e){const t=Nt.useContext(Boe)===e.value;return Nt.createElement(zoe,{...e,inputType:"radio",isChecked:t})}function Woe({open:e,onOpenChange:t,...n}){const[r,o]=d2(e,t);return Nt.createElement(Qre.Provider,{value:r},Nt.createElement(mne.fC,{...n,open:e,onOpenChange:o}))}const Hoe=Nt.forwardRef((function(e,t){const n=Nt.useRef(_r),r=Nt.useContext(Qre),o=(0,s2.e)(t,n);return Nt.useEffect((()=>{n.current?.dispatchEvent(new CustomEvent("menu.open",{bubbles:!0,detail:{isOpen:r}}))}),[r]),Nt.createElement(mne.xz,{ref:o,...e})})),qoe=Roe,$oe=woe,Koe=Poe,Yoe=function(e){return Nt.createElement(zoe,{...e,inputType:"checkbox",isChecked:Boolean(e.checked)})},Zoe=joe,Joe=Goe,Qoe=Moe,Xoe=Uoe,eie=Doe;function tie(e){return Nt.createElement(boe,{type:"dropdown"},Nt.createElement(Aoe,{sideOffset:4,...e}))}const nie=[.5,1,1.25,1.5,2];function rie({playbackRate:e,setPlaybackRate:t,type:n,isVideoPlayer:r=!1}){const o=Nt.useContext($te);(0,Nt.useEffect)((()=>{o.current&&(o.current.playbackRate=e)}),[o,e]),function({playbackRate:e,type:t}){const n=(0,Nt.useRef)({playbackRate:e});(0,Nt.useEffect)((()=>{e!==n.current.playbackRate&&(rt("share_player_media_speed_changed",{speed_before:n.current.playbackRate,speed_after:e,context:Wte(),media_type:t}),n.current.playbackRate=e)}),[e,t])}({playbackRate:e,type:n});const i=(0,Nt.useMemo)((()=>nie.map((e=>Nt.createElement(Joe,{key:e,label:1===e?"Normal":`${e}x`,value:String(e)})))),[]),a=(0,Nt.useCallback)((e=>{t(Number(e))}),[t]),[s,c]=(0,Nt.useState)(!1),d=`${e}x`,l=r?Pte:Yo;return Nt.createElement(Woe,{open:s,onOpenChange:c},Nt.createElement(ei,{title:"Playback speed"},Nt.createElement(Hoe,{asChild:!0},Nt.createElement(l,{"aria-label":`Playback speed: ${d}`,"data-testid":"playback-rate-button"},Nt.createElement(o0,{variant:"label-1-regular",style:{color:r?"var(--grey-0-base)":""}},d)))),Nt.createElement(tie,{side:"top"},Nt.createElement(Nt.Fragment,null,Nt.createElement(Qoe,null),Nt.createElement(Xoe,null,"Playback Speed"),Nt.createElement(Zoe,{value:String(e),onValueChange:a},i),Nt.createElement(Qoe,null))))}function oie(){const e=(0,Ft.v9)((e=>T7(e,"composition"))),t=kr(e);(0,Nt.useEffect)((()=>{void 0!==t&&e!==t&&Da("page_playback_speed_changed",{original_value:t,value:e})}),[e,t]);const n=(0,Ft.I0)(),r=(0,Nt.useCallback)((e=>n(Aq({playerKey:"composition",rate:e}))),[n]);return{playbackRate:e,setPlaybackRate:r}}const iie=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"search"})));var aie=n(81179),sie=n.n(aie);function cie({isPlaying:e,playheadTime:t,selector:n,disabled:r,resetToTop:o}){const i=(0,Nt.useRef)(_r),[a,s]=(0,Nt.useState)(0),c=Pr((()=>{s((e=>e+1))})),d=Pr((()=>{u(),setTimeout((()=>{s((e=>e-1))}),50)})),[l,u]=Yr({minimumMsPerTick:250,update:()=>{const t=i.current,r=(t||document).querySelector(n);if(!r)return;const{viewportTop:o,viewportHeight:a,scrollTop:s}=function(e){if(e){const{top:t,height:n}=e.getBoundingClientRect();return{viewportTop:t,viewportHeight:n,scrollTop:e.scrollTop,contentHeight:e.scrollHeight}}return{viewportTop:0,viewportHeight:window.innerHeight,scrollTop:window.scrollY,contentHeight:document.body.scrollHeight}}(t||void 0),l=r.getBoundingClientRect(),u=e?10:40,m=e?40:0,p=o+u,g=o+a-m;if(l.top<p||l.bottom>g){const e=s+l.top-p-(u+m)+5;f.current!==e&&(c(),(0,Kr.W)((()=>{sie()(e,800,d,t??void 0),f.current=e})))}}}),f=(0,Nt.useRef)(-1);return(0,Nt.useEffect)((()=>{if(o)f.current=-1;else if(!r&&!a)return l(),()=>{u()}}),[t,e,a,r,o,n,l,u]),{scrollContainerRef:i,automaticScrollsInProgress:a,startAutomaticScroll:c,finishAutomaticScroll:d}}var die="EmbeddedScript-module--PxKJWL";const lie=Nt.createContext({isEmbedded:!1,showTranscript:void 0,embedType:void 0});var uie=n(54407),fie="Switch-module--wizUZk",mie="Switch-module--Ct8JSE",pie="Switch-module--VCss_x",gie="Switch-module--zMKX8h";const hie=Nt.forwardRef((function({size:e="medium",className:t,style:n,onColor:r,...o},i){return vo(),Nt.createElement(uie.fC,{...o,ref:i,className:yo()(mie,t,"string"===typeof e&&h[e]),"data-switch-state":o.checked?"checked":"unchecked",style:{...n,"--switch-width":"number"===typeof e?`${e}px`:void 0,"--switch-on-color":r}},Nt.createElement(uie.bU,{className:gie}))}));function vie({autoScroll:e,toggleAutoScroll:t}){return Nt.createElement("label",{className:"row"},Nt.createElement(hie,{size:24,className:"m-1",checked:e,onCheckedChange:t}),Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-800"},"Auto-scroll"))}function Eie({className:e,...t}){return Nt.createElement("span",{className:yo()(e,"ScriptPlaceholder-module--TJOWzC"),...t})}function yie({publishState:e}){return Nt.createElement("div",{className:yo()("ScriptPlaceholder-module--WVsCUm",{"ScriptPlaceholder-module--gMntBN":"failure"===e})},Nt.createElement("div",null,Nt.createElement(Eie,null),Nt.createElement(Eie,null),Nt.createElement(Eie,null),Nt.createElement(Eie,{style:{width:"50%"}})),Nt.createElement("div",null,Nt.createElement(Eie,null),Nt.createElement(Eie,null),Nt.createElement(Eie,{style:{width:"50%"}})),Nt.createElement(Eie,null),Nt.createElement(Eie,null))}const Sie=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"grabber"})));function Iie({tooltipEnabled:e}){return Nt.createElement(ei,{title:"Drag to change placement",enabled:e},Nt.createElement(Zo,{size:"default",className:yo()("text-grey-400","DecorationGrabber-module--eP87tc")},Nt.createElement(Nt.Fragment,null,Nt.createElement("div",{className:"DecorationGrabber-module--R4DXOT"}),Nt.createElement(Sie,null))))}var bie="Marker-module--SMAwyu";const Tie=Nt.memo((function({text:e}){return Nt.createElement(o0,{variant:wie,className:"text-grey-900 bg-grey-0 row h-5 px-2 border border-grey-400 rounded-sm ml-5",style:{whiteSpace:"nowrap"}},e)}));const wie="body-1-medium";function Cie({isLastMarkerDecoration:e,className:t,markerId:n,...r}){const o=`marker-${void 0!==n?n:""}`;return(0,Nt.useContext)(bo)?Nt.createElement(o0,{variant:wie,...r,id:o,className:yo()(t,{[bie]:e})}):Nt.createElement("span",{...r,id:o,className:yo()("Marker-module--QH2aeF",t,{[bie]:e})})}function _ie({isLastMarkerDecoration:e,className:t,dragButtonClassName:n,projectId:r,markerText:o,...i}){const a=(0,Ft.I0)(),s=(0,Nt.useContext)(bo),{hovering:c,onMouseEnter:d,onMouseLeave:l}=function(){const[e,t,n]=Nr(!1);return{onMouseEnter:t,onMouseLeave:n,hovering:e}}(),u=(0,Nt.useRef)(_r),{dragProps:f,isDragging:m}=function(e){const t=(0,Wr.c0)(e);return{...t,dragProps:{...t.dragProps,onPointerDown:t.dragProps.onPointerDown}}}({preview:u,getItems:()=>[{"descript/marker":i.markerId||"",text:o}],getAllowedDropOperations:()=>["move"],onDragStart:()=>{void 0!==i.markerId&&a(m4({projectId:r,markerId:i.markerId}))},onDragEnd:()=>a(m4({projectId:r,markerId:void 0}))});return Nt.createElement(Nt.Fragment,null,s&&Nt.createElement("div",{...f,contentEditable:!1,className:yo()("transition-opacity absolute left-0","Marker-module--KEuPnO",n,{"opacity-0":!c||m})},Nt.createElement(Iie,{tooltipEnabled:!m})),Nt.createElement(Co.g7,{className:yo()({"opacity-30":m}),onMouseEnter:d,onMouseLeave:l},Nt.createElement(Cie,{...i})),Nt.createElement(Wr.vI,{ref:u},(([e])=>Nt.createElement(Tie,{text:e.text}))))}function Aie({data:e,children:t,className:n,isHovering:r,isSelected:o,...i}){return Nt.createElement("span",{"data-testid":"script-annotation",className:yo()("Annotation-module--vQOJ9w",n,{"Annotation-module--bXK4x6":r},{"Annotation-module--_Ws9MY":o}),...i},t)}function Rie(e,t,n=t){return Boolean(e&&e.end&&(e.start>t||e.end<n))}function Mie(e){return void 0!==e.text}function Die(e){return void 0!==e.words}function Oie(e,t){const n=fk(e,t).map((n=>({timeOffset:Kx(e,t,n),text:n.text})));n.length&&n[0].timeOffset>0&&n.unshift({timeOffset:0,text:vk(e,t).name,hideInScript:!0});const r=_5(e,t);let o,i=!0,a=!1,s=[];const c=[];function d(){const t=function(e,t){return t?fg(e,t):void 0}(e,o);let n;!a&&t&&(n={name:t.name,color:t.color?O_(!0===e.isStoryboard).get(t.color)?.cssValue:void 0}),c.push({speaker:n,words:s}),s=[]}let l=0;for(const{speakerId:u,startTime:f,endTime:m,wordTextOffset:p,text:{string:g,attributes:h},textWithoutPunctuation:v,leadingNonWordText:E}of r){const e=!!E?.string?.includes("\n");i||u===o&&!e||(d(),a=u===o&&e);let t=n[0];for(;void 0!==t&&f>=t.timeOffset;)s.length&&(d(),a=!0),c.push({...t,wordTextOffset:p}),n.shift(),t=n[0];s.push({leadingNonWordText:E,text:g,textWithoutPunctuation:v.string,attributes:h,startTime:a8(f),endTime:a8(m),wordTextOffset:p}),i=!1,o=u,l=p}return r.length&&d(),n.forEach((e=>{c.push({...e,wordTextOffset:l})})),{isStoryboard:e.isStoryboard,duration:_k(e,t),content:c.map((e=>"words"in e?e:{...e,timeOffset:a8(e.timeOffset)}))}}function xie({className:e,style:t,speaker:n,timeOffset:r,...o}){return Nt.createElement(o0,{className:e,variant:"body-1-medium",style:{...t,color:n.color},"data-speaker":!0,"data-start-time":r,...o},n?.name)}var kie=n(2621),Nie=n(33160),Pie=n(79779),Lie=n(15756),Fie=n(94950),Uie=n(24562),Bie=n(37441),jie="ScrubberBarSection-module--YXxmIp";function Vie(e,t){return 100*(0===t?0:Math.max(Math.min(e/t,1),0))}function zie(e,t){return`${Vie(e,t)}%`}function Gie({startTime:e,endTime:t,currentTime:n,hoverTime:r,totalDuration:o,shouldScale:i=!0,videoTimeRange:a}){const s=t-e,c=n-e,d=void 0!==r?r-e:void 0,l=a&&Ce(a.end)&&a.start>=e&&t>a.start,u=a&&Ce(a.end)&&a.end>e&&t>=(a.end||o),f=(0,Nt.useMemo)((()=>({width:zie(s,o)})),[s,o]),m=(0,Nt.useMemo)((()=>({width:"100%",transform:`scaleX(${Vie(c,s)/100})`,transformOrigin:"0 0"})),[s,c]),p=(0,Nt.useMemo)((()=>void 0!==d?{width:zie(d,s)}:void 0),[d,s]);return Nt.createElement("div",{className:yo()("ScrubberBarSection-module--Mm0D3r ScrubberBar-module--WbGgUi",{"ScrubberBarSection-module--s5pJ8c":i}),style:f},Nt.createElement("div",{className:"ScrubberBarSection-module--sWRJCy ScrubberBarSection-module--o5Lt2G"}),Nt.createElement("div",{className:"ScrubberBarSection-module--o5Lt2G",style:m}),Nt.createElement("div",{className:"ScrubberBarSection-module--n9O5_I ScrubberBarSection-module--o5Lt2G",style:p}),l&&a&&Nt.createElement("div",{className:jie,style:{left:`calc(${zie(a.start-e,s)} - 6px)`}}),u&&a&&Ce(a.end)&&Nt.createElement("div",{className:jie,style:{left:`calc(${zie(a.end-e,s)} + 2px)`}}))}function Wie(e){const t=1e3*e;return(0,kie.Z)({seconds:(0,Nie.Z)(t),minutes:(0,Pie.Z)(t),hours:(0,Lie.Z)(t)})}function Hie(e){return e?.clientWidth??1}function qie(e){return e?.getBoundingClientRect().x}function $ie({duration:e,currentTime:t,seekTo:n,className:r,gutterClassName:o,scrubberClassName:i,hideTimeTooltip:a,children:s,sections:c,disabled:d,lightBackground:l,timeRange:u}){const[f,m]=(0,Nt.useState)(!1),[p,g]=(0,Nt.useState)(0),[h,v]=(0,Nt.useState)(!1),E=c&&c.length>1?c:[{timeOffset:0,text:""}],y=(0,Nt.useRef)(_r),S=Pr((()=>{d||f||v(!1)})),I=Pr((t=>{Fr(t);const r=Hie(y.current),o=qie(y.current),i="clientX"in(a=t)?a.clientX:a.touches[0].clientX;var a;if(void 0!==o&&void 0!==r){const t=i-o,a=Math.min(1,Math.max(0,t/r));n(a*e)}})),b=Pr((e=>{const t=qie(y.current);!d&&y.current?.contains(e.target)&&v(!0);const n="clientX"in e?e.clientX:e.touches[0].clientX;d||void 0===t||g(Math.max(0,n-t)),f&&I(e)})),T=p/Hie(y.current)*e,w=(0,Nt.useMemo)((()=>$7(T)),[T]),C=(0,Nt.useMemo)((()=>{if(c)for(let e=1;e<c.length;e++){const{text:t,timeOffset:n}=c[e];if(n>T)return c[e-1]?.text;if(e===c.length-1)return t}}),[c,T]),_=Pr((()=>{m(!0)})),A=Pr((()=>{m(!1),v(!1)})),{x:R,y:M,refs:D,strategy:O}=(0,Fie.YF)({placement:"top",middleware:[(0,Uie.cv)(8)],whileElementsMounted:(...e)=>(0,Bie.Me)(...e,{animationFrame:!0})}),x=Pr((r=>{"Home"===r.key?n(0):"End"===r.key?n(e):"PageUp"===r.key?n(t+5):"PageDown"===r.key&&n(t-5)}));Jr("mouseup",A,"undefined"===typeof window?_r:window),Jr("mousemove",f||h?b:void 0,"undefined"===typeof window?_r:window),Jr("touchmove",f||h?b:void 0,"undefined"===typeof window?_r:window);const k=(0,Nt.useContext)(Ao);return Nt.createElement("div",{className:yo()(r,"ScrubberBar-module--Vp7GTE",{"ScrubberBar-module--Zq0OTE":d,"ScrubberBar-module--aCUn83":l})},Nt.createElement("div",{className:yo()("ScrubberBar-module--qhno7Z",o)},s),Nt.createElement("div",{ref:y,className:yo()("ScrubberBar-module--WbGgUi","ScrubberBar-module--RIRdeT",i),onMouseEnter:b,onTouchStart:_,onMouseDown:_,onTouchEnd:A,onMouseUp:A,onMouseLeave:S,tabIndex:0,role:"slider","aria-label":"Seek slider","aria-valuemin":0,"aria-valuemax":e,"aria-valuenow":t,"aria-valuetext":`${Wie(t)||"0 seconds"} of ${Wie(e)}`,onClick:I,onKeyDown:x},Nt.createElement("div",{className:"ScrubberBar-module--N_frL0"},E.map(((n,r)=>Nt.createElement(Gie,{key:r,startTime:n.timeOffset,endTime:E[r+1]?.timeOffset??e,currentTime:t,hoverTime:h?T:void 0,totalDuration:e,shouldScale:E.length>1,videoTimeRange:u})))),Nt.createElement("div",{ref:D.setReference,style:{visibility:h?"visible":"hidden",left:p},className:yo()("ScrubberBar-module--GdBaoG",{"ScrubberBar-module--f5Pke1":c&&c.length>1})}),h&&!a&&Nt.createElement(io.h,{container:k?.current},Nt.createElement(Qo,{ref:D.setFloating,title:C||w,subtitle:C&&w,className:"tabular-nums",style:{position:O,top:M??0,left:R??0}}))),f&&Nt.createElement("div",{style:{position:"absolute",inset:0,zIndex:"calc(var(--processing-z-index) + 2)"},onClick:Fr}))}const Kie=(0,Nt.createContext)({playbackTimeRange:void 0,setPlaybackTimeRange:()=>{}});function Yie({children:e}){const[t,n]=(0,Nt.useState)(),r=(0,Nt.useMemo)((()=>({playbackTimeRange:t,setPlaybackTimeRange:n})),[t,n]);return(0,Nt.useLayoutEffect)((()=>{n(d8())}),[]),Nt.createElement(Kie.Provider,{value:r},e)}function Zie({togglePlayback:e,isPlaying:t,seekTo:n,...r}){const o=(0,Nt.useRef)(void 0),{playbackTimeRange:i,setPlaybackTimeRange:a}=(0,Nt.useContext)(Kie),s=Kte();(0,Nt.useEffect)((()=>{const n=s??0;t&&o.current===n?a(void 0):t&&i?.end&&i.end<=n&&(e(),o.current=n)}),[s,e,i,t,a]);const c=(0,Nt.useCallback)((e=>{a(void 0),n(e)}),[n,a]);return Nt.createElement($ie,{...r,currentTime:s,seekTo:c,timeRange:i})}const Jie=Nt.memo((function e({word:t,className:n,style:r={},isWhiteSpace:o,isEmbeddedScript:i,...a}){const{startTime:s,endTime:c,text:d,wordTextOffset:l}=t,u=(0,Nt.useRef)(!1),f=(0,Nt.useMemo)((()=>{const e={};return("attributes"in t?t.attributes:[]).forEach((t=>{if("highlight"===t.attribute.name){const n=xO.find((e=>e.id===t.attribute.value));n&&(e.background=vS(n.color),u.current=!0)}else"italic"===t.attribute.name?e.fontStyle="italic":"bold"===t.attribute.name?e.fontWeight="bold":"scratchText"!==t.attribute.name||i||(e.color=pj(uj.ScratchText))})),{...r,...e}}),[t,r,i]);return Nt.createElement(Nt.Fragment,null,t.leadingNonWordText&&t.leadingNonWordText.attributes.length?Nt.createElement(e,{isWhiteSpace:!0,word:{...t,text:t.leadingNonWordText.string,attributes:t.leadingNonWordText.attributes,leadingNonWordText:void 0},"data-whitespace":!0,isEmbeddedScript:i}):t.leadingNonWordText?.string,Nt.createElement("span",{className:yo()("EmbeddedScript-module--KwqFyJ",n,{"EmbeddedScript-module--bQDjgk":o}),style:f,"data-word":!o||void 0,"data-location":l,"data-start-time":s,"data-end-time":c,...a},d))}));function Qie({annotationId:e,isActive:t,...n}){const[r,o,i]=Nr(!1);return Nt.createElement(Aie,{"data-active-annotation":t,"data-annotation-id":e,onMouseEnter:o,onMouseLeave:i,isHovering:r||t,...n})}const Xie=Nt.memo((function({paragraph:e,annotations:t,playHeadColor:n,isEmbeddedScript:r}){const o=(0,Nt.useMemo)((()=>{const n=[],o=e.words[Symbol.iterator]();for(const e of o){const o=t?.filter((({segmentTextOffsetLocation:t,segmentTextOffsetLength:n})=>{const r=t+n;return e.wordTextOffset>=t&&(e.wordTextOffset+e.text.length<=r||e.wordTextOffset+e.textWithoutPunctuation.length<=r)}));if(o.length){const t=o.every((t=>t.segmentTextOffsetLocation===e.wordTextOffset));t&&n.push(Nt.createElement(Jie,{key:e.startTime,isWhiteSpace:!0,word:{...e,text:""},isEmbeddedScript:r})),n.push(o.reduce(((t,n)=>Nt.createElement(Qie,{key:`${n.id}-${e.startTime}`,isActive:n.active,annotationId:n.id},t)),Nt.createElement(Jie,{word:{...e,leadingNonWordText:t?void 0:e.leadingNonWordText},isEmbeddedScript:r})))}else n.push(Nt.createElement(Jie,{key:e.startTime,word:e,isEmbeddedScript:r}))}return n}),[e.words,t,r]),i=Nt.createElement("p",{className:die,"data-paragraph":!0,"data-start-time":e.words[0]?.startTime,"data-end-time":e.words[e.words.length-1]?.endTime,style:n?{"--playhead-active-color":n,"--color-playhead-faded":n}:{}},o);return Nt.createElement(Nt.Fragment,{key:`${e.speaker}-${e.words[0]?.startTime}`},e.speaker&&Nt.createElement(xie,{speaker:e.speaker,timeOffset:e.words[0].startTime}),Nt.createElement(o0,{asChild:!0,variant:"body-1-regular",className:"text-grey-800"},i))}));function eae(){return[...document.querySelectorAll("[data-word]:not([data-whitespace])")].map((e=>({el:e,start:Number(e.getAttribute("data-start-time")),end:Number(e.getAttribute("data-end-time"))})))}const tae=[];const nae=Nt.forwardRef((function({doc:e,annotations:t,name:n,className:r,scrollerRef:o,isEmbeddedScript:i,...a},s){const{playbackTimeRange:c}=(0,Nt.useContext)(Kie);let d;const l=(0,Nt.useMemo)((()=>(e?.content||[]).filter((e=>Die(e)||!e.hideInScript))),[e?.content]),u=(0,Nt.useRef)(_r);Nt.useEffect((()=>{if(!u.current)return;let e,t="smooth",n="center";c&&(e=l.findIndex((e=>!!Die(e)&&e.words?.some((e=>{const t=e.startTime,n=e.endTime||t;return!Rie(c,t,n)})))),t="auto",n="start"),-1!==e&&void 0!==e&&u.current.scrollToIndex({index:e,align:n,behavior:t})}),[c,l]);const f=Pr(((e,t="smooth")=>{if(!u.current)return;const n=rh(l,(t=>Mie(t)?t.timeOffset>e?Ie.OrderedDescending:t.timeOffset<e?Ie.OrderedAscending:Ie.OrderedSame:t.words[0].startTime>e?Ie.OrderedDescending:t.words[t.words.length-1].endTime<e?Ie.OrderedAscending:Ie.OrderedSame)),r=n.match||n.previous||n.next;if(!r||!Die(r.value))return;const o=rh(r.value.words,(t=>t.startTime>e?Ie.OrderedDescending:t.endTime<e?Ie.OrderedAscending:Ie.OrderedSame)),i=o.match||o.previous||o.next;i&&document.querySelector(`[data-start-time="${Mie(i.value)?i.value.timeOffset:i.value.startTime}"]`)||u.current.scrollToIndex({index:r.index,behavior:t})}));return(0,Nt.useImperativeHandle)(s,(()=>({scrollToTime:f}))),(0,Nt.useEffect)((()=>{const e=requestAnimationFrame((()=>{const e=[...eae(),...[...document.querySelectorAll("[data-marker]"),...document.querySelectorAll("[data-speaker]")].map((e=>({el:e,start:Number(e.getAttribute("data-start-time"))})))];for(let t=0;t<e.length;t++){const n=e[t];n.el.hasAttribute("data-dim")&&!c?n.el.removeAttribute("data-dim"):c&&Rie(c,n.start,n.end)&&n.el.setAttribute("data-dim","true")}}));return()=>{cancelAnimationFrame(e)}}),[c,t]),Nt.createElement("div",{...a,"data-editor":!0,className:yo()("max-w-xl px-5 m-auto",r)},n&&Nt.createElement("div",{className:"mb-4 mt-7"},Nt.createElement(o0,{variant:"headline-3",className:"text-grey-900"},n)),Nt.createElement(p2.OO,{ref:u,data:l,useWindowScroll:!0,initialItemCount:Math.min(10,l.length),customScrollParent:o||void 0,itemContent:(e,n)=>{if(Mie(n)){const e=t?.find((e=>e.segmentTimeOffset<=n.timeOffset&&e.segmentTextOffsetLocation<=n.wordTextOffset&&e.segmentTextOffsetLocation+e.segmentTextOffsetLength>=n.wordTextOffset));return Nt.createElement("div",{className:"mb-4",key:`${n.timeOffset}-${n.text}`,"data-marker":!0,"data-start-time":n.timeOffset},Nt.createElement(Cie,{"data-marker":!0,"data-location":n.wordTextOffset},e?Nt.createElement(Qie,{key:`${n.timeOffset}-${n.text}`,annotationId:e.id,isActive:e.active},n.text):n.text))}const r=n.speaker?.color||d?.color,o=function(e,t){return e?.filter((({segmentTextOffsetLocation:e,segmentTextOffsetLength:n})=>{const r=e+n;return t.words.some((t=>t.wordTextOffset>=e&&t.wordTextOffset<=r))}))}(t,n);return d=n.speaker||d,Nt.createElement(Xie,{key:`${n.speaker}-${n.words[0]?.startTime}`,paragraph:n,playHeadColor:r,annotations:o&&o.length?o:tae,isEmbeddedScript:i})}}))})),rae=Nt.memo(nae),oae=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"comment"}))),iae="CmdOrCtrl+Alt+M",aae="mod+alt+m",sae={label:"Comment",ipcMessage:"MenuCommand.add_comment",electronAccelerator:"CmdOrCtrl+Shift+M",browserShortcut:"mod+shift+m",enabledInWeb:!0};function cae(e){return!!e&&(e instanceof HTMLElement&&(-1!==e.className?.indexOf("DraftEditor-root")||"true"===e.getAttribute("data-editor"))||cae(e.parentNode))}function dae(e,t,n,r,o=!1){if(e||t||!r.current)return!1;if(n)return!0;const i=document.getSelection();return i!==_r&&(o||!i.isCollapsed)&&cae(i.anchorNode)}function lae({hidden:e,theme:t,centerAtPoint:n,overridePositioning:r,children:o,className:i,style:a,onMouseDown:s,includeCursor:c=!1,onLayout:d,...l}){const[u,f]=(0,Nt.useState)(e?"none":void 0),m=(0,Nt.useRef)(_r),p=kr(e),g=(0,Nt.useCallback)((()=>{if(!dae(r,e,n,m,c))return void f(e?"none":void 0);const t=m.current;if(!t)return;let o;f(e?"none":void 0);let i=!0;if(void 0!==n)o=n;else{const e=function(e){if(!e.parentElement)return;const t=document.getSelection();if(!t||0===t.rangeCount)return;const n=t.getRangeAt(0);if(!n)return;const r=document.getElementById("MainContentScrollpane");if(!r)return void Ma("Could not find scroll container by id.");if(!r.contains(t.anchorNode))return;const o=n.getBoundingClientRect(),i=e.parentElement.getBoundingClientRect(),a=r.getBoundingClientRect();let s;const c=o.height>a.height&&o.top<r.scrollTop;if(c){const e=r.scrollTop+i.top-a.top;s=r.scrollTop-e}else s=o.top-i.top;return{centerPoint:[o.left+o.width/2-i.left,s],applyTopOffset:!c}}(t);if(void 0===e)return;o=e.centerPoint,i=e.applyTopOffset}requestAnimationFrame((()=>{const n=t.getBoundingClientRect(),[r,a]=o,s=r-n.width/2,c=a-+i*(n.height+10);t.style.left=`${s}px`,t.style.top=`${c}px`,t.style.transition=p!==e?"":"all 200ms",d?.()}))}),[n,e,c,d,r,p]);return(0,Nt.useEffect)((()=>{void 0===p||n?g():setTimeout(g)}),[n,g,p]),Nt.createElement("div",{ref:m,...l,className:yo()("TextEditorControl",i,{Light:"light"===t,OverridePosition:!0===r}),onMouseDown:e=>{e.preventDefault(),s?.(e)},style:{...a,display:u}},o)}const uae=(0,Nt.memo)(lae);var fae=n(28632);const mae=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"lightbulb"})));var pae="Toast-module--qLWcZQ";const gae=Nt.forwardRef((function({onDismiss:e,id:t,className:n,onClick:r,dismissAfter:o,message:i,animation:a="slide",...s},c){const[d,l]=Nt.useState(!0),u=Nt.useRef(_r),f=(0,s2.e)(c,u),m=Pr((e=>{e||l(!1)}));return Nt.createElement(fae.fC,{ref:f,id:t,duration:o?1e3*o:1/0,open:d,onOpenChange:m,asChild:!0},Nt.createElement("li",{className:pae,"data-animation":a},Nt.createElement(roe,null,Nt.createElement("button",{id:t,type:"button",className:yo()("px-2 h-6","Toast-module--rRrcHf",n),onClick:r,...s},Nt.createElement(o0,{variant:"label-1-regular",className:"px-2"},i)))))})),hae=Nt.forwardRef((function({id:e,dismissAfter:t,dismissible:n=!1,icon:r,message:o,actionMessage:i,subtext:a,onDismiss:s,onHide:c,className:d,onClick:l,isTip:u,isMultiline:f,altText:m="",animation:p="slide",...g},h){const[v,E]=Nt.useState(!0),y=Nt.useRef(_r),[S,I]=Nt.useState(_r),b=(0,s2.e)(h,y),T=Nt.useContext(bo),w=Pr((e=>{l?.(e),e.stopPropagation()})),C=Pr((()=>{S&&(S.style.height=`${S.offsetHeight}px`),E(!1),setTimeout(c,500)})),_=Pr((e=>{e||C()}));return Nt.createElement(fae.fC,{ref:b,"data-role":"toast",...g,id:e,duration:t?1e3*t:1/0,open:v,onOpenChange:_,asChild:!0,onSwipeStart:n?void 0:Lr,onSwipeMove:n?void 0:Lr,onSwipeCancel:n?void 0:Lr,onSwipeEnd:n?void 0:Lr},Nt.createElement("li",{ref:I,className:pae,"data-animation":p},Nt.createElement(roe,null,Nt.createElement("div",{className:yo()(d,"Toast-module--dbT5LG",{"Toast-module--GlTdAS":u,"Toast-module--aicBcA":f})},u&&!r?T?Nt.createElement(Zo,null,Nt.createElement(mae,null)):Nt.createElement("div",{className:"Toast-module--voQxPz"},"\u{1f4a1}"):r&&(T?Nt.createElement(Zo,null,r):r),Boolean(o||a)&&Nt.createElement("div",{className:"Toast-module--naydt2"},Boolean(o)&&Nt.createElement(fae.Dx,{className:"Toast-module--Zan4AJ"},o),Boolean(a)&&Nt.createElement(fae.dk,{className:"Toast-module--ZnJKej"},a)),i&&Nt.createElement(fae.aU,{asChild:!0,altText:m||i,"data-testid":"toast-action-button"},T?Nt.createElement(W0,{variant:"light",onClick:w},i):Nt.createElement("button",{type:"button",className:"Toast-module--kB_mCZ",onClick:w},i)),n&&(T?Nt.createElement(fae.x8,{asChild:!0},Nt.createElement(ei,{title:"Dismiss"},Nt.createElement(Yo,{type:"button","aria-label":"Dismiss message",onClick:C,style:{pointerEvents:"auto"}},Nt.createElement(V1,null)))):Nt.createElement(fae.x8,{asChild:!0},Nt.createElement(ei,{title:"Dismiss"},Nt.createElement(Yo,{type:"button",className:"Toast-module--EwBC_w","aria-label":"Dismiss message",onClick:C,style:{pointerEvents:"auto"}},Nt.createElement(G1,null)))))))))})),vae=Nt.forwardRef((function({className:e,...t},n){const r=Nt.useContext(bo);return Nt.createElement(fae.l_,{className:yo()(e,"Toast-module--IuQX3P","pointer-events-auto"),"data-redesign":r||void 0,ref:n,...t})})),Eae=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"check-circle"}))),yae=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"crosshair"}))),Sae=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"headphones"})));const Iae=A.logging.groupLogger("webmediaengine/webaudiotracing"),bae=!1;let Tae=0;function wae(...e){bae}function Cae(e){return`${e.debugName??e.constructor.name}${void 0!==e.debugId?`[${e.debugId}]`:""}`}function _ae(e,t){try{Tae+=1,e.connect(t)}catch(E0){throw Iae.error(`WebAudioTracing.connect(${Cae(e)}, ${Cae(t)})`,{error:`${E0.message}`}),E0}finally{Tae-=1}}function Aae(e,t){try{Tae+=1,e.disconnect(t)}catch(E0){throw Iae.error(`WebAudioTracing.disconnect(${Cae(e)}, ${Cae(t)})`,{error:`${E0.message}`}),E0}finally{Tae-=1}}function Rae(e){try{Tae+=1,e.disconnect()}catch(E0){throw Iae.error(`WebAudioTracing.disconnectAll(${Cae(e)})`,{error:`${E0.message}`}),E0}finally{Tae-=1}}let Mae=1;const Dae=new WeakMap;function Oae(e,t){let n=Dae.get(e.context);n||(n={contextId:Mae++,nodeId:1},Dae.set(e.context,n));const r=`${n.contextId}_${(n.nodeId++).toString(16)}`;Object.assign(e,{debugName:t,debugId:r});const o=e;return o._impl&&(o._impl.debugName=t,o._impl.debugId=r),e}var xae=(e=>(e[e.Levels=0]="Levels",e[e.Spectrum=1]="Spectrum",e))(xae||{});const kae=A.logging.groupLogger("webmediaengine/audiocontextlatency");let Nae=!1;function Pae(e){const t=e.outputLatency;return void 0===t?Lae(e):t<=5?t:(Nae||(kae.error(`AudioContext.outputLatency is ${t} seconds. This is likely a bug in the browser`),Nae=!0),Lae(e))}function Lae(e){return e.baseLatency??0}const Fae=A.logging.groupLogger("webmediaengine/webaudiolevelsmeter");class Uae extends class{constructor(e){this.sink=e,this.sources=new Set}get active(){return this.sources.size>0}startReceiving(e){if(this.sources.has(e))throw new Error("already connected");this.sources.add(e),e.connect(this.sink),_ae(e,this.sink),1===this.sources.size&&(wae(this.constructor.name),this.onActiveChange(this.sink,!0))}stopReceiving(e){this.sources.has(e)&&(this.sources.delete(e),Aae(e,this.sink),0===this.sources.size&&(wae(this.constructor.name),this.onActiveChange(this.sink,!1)))}stopAll(){if(0!==this.sources.size){for(const e of this.sources)Aae(e,this.sink),e.stop?.();this.sources.clear(),wae(this.constructor.name),this.onActiveChange(this.sink,!1)}}}{constructor({context:e,key:t,clipLevel:n=.98,averaging:r=.95,clipLag:o=750,channels:i=2}){super(Oae(e.createGain(),"AudioMeter.sink")),this.type=xae.Levels,this.clipping=!1,this.maxVolumes=[0,0],this.lastClip=0,this._enabled=!1,this.isProcessorConnected=!1,this.subscribers=new Set,this.unsubscribe=e=>()=>{this.subscribers.has(e)||Fae.warn("Unsubscribed to WebAudioLevelsMeter multiple times with same id"),this.subscribers.delete(e),0===this.subscribers.size&&(this.enabled=!1)},this.context=e,this.key=t,this.clipLevel=n,this.averaging=r,this.clipLag=o,this.processor=Oae(e.createScriptProcessor(512,i,1),"AudioMeter.processor"),this.processor.onaudioprocess=this.onAudioProcess.bind(this)}get destination(){return this.sink}onActiveChange(){this.updateProcessorConnection()}get isRunning(){return"running"===this.context.state}updateDelayNode(){if(this.delayNode){const e=Pae(this.context);e>this.delayNode.maxDelayTime?(Fae.warn(`[WebAudioLevelsMeter] Latency increased beyond maxDelayTime ${this.delayNode.maxDelayTime} s to ${e} s, rebuilding processor`),this.removeDelayNode(),this.isProcessorConnected&&(this.disconnectProcessor(),this.connectProcessor())):this.updateDelayToOutputLatency()}}onAudioProcess(e){this.updateDelayNode();for(let t=0;t<e.inputBuffer.numberOfChannels;t+=1)this.processChannel(e,t)}reset(){this.clipping=!1,this.lastClip=0,this.maxVolumes.fill(0)}set enabled(e){e||this.reset(),this._enabled=e,this.updateProcessorConnection()}updateProcessorConnection(){this._enabled?this.connectProcessor():this.disconnectProcessor()}connectProcessor(){this.isProcessorConnected||(_ae(this.sink,this.getOrCreateDelayNode()),_ae(this.processor,this.context.destination),this.isProcessorConnected=!0)}removeDelayNode(){this.delayNode&&(Aae(this.sink,this.delayNode.node),Aae(this.delayNode.node,this.processor),this.delayNode=void 0)}getOrCreateDelayNode(){if(!this.delayNode){const e=Math.max(.3,1.5*Pae(this.context));Fae.debug(`Creating delay node with maxDelayTime ${e} s`);const t=Oae(this.context.createDelay(e),"AudioMeter.delay");this.delayNode={node:t,maxDelayTime:e},_ae(t,this.processor)}return this.updateDelayToOutputLatency(),this.delayNode.node}updateDelayToOutputLatency(){this.delayNode&&(this.delayNode.node.delayTime.value=Pae(this.context))}disconnectProcessor(){this.isProcessorConnected&&(this.delayNode&&Aae(this.sink,this.delayNode.node),Rae(this.processor),this.isProcessorConnected=!1)}connect(e){_ae(this.sink,e),this.updateProcessorConnection()}disconnect(e){this.disconnectProcessor(),Aae(this.sink,e)}shutdown(){this.disconnectProcessor(),Rae(this.sink),this.removeDelayNode(),this.processor.onaudioprocess=null}subscribe(){0===this.subscribers.size&&(this.enabled=!0);const e=Ps();return this.subscribers.add(e),this.unsubscribe(e)}processChannel(e,t){const n=e.inputBuffer.getChannelData(t),r=n.length,{clipLevel:o,maxVolumes:i,averaging:a}=this;let s=0;const c=Date.now();for(let u=0;u<r;u++){const e=n[u],t=Math.abs(e);t>s&&(s=t,t>=o&&(this.clipping=!0,this.lastClip=c))}this.clipping&&this.lastClip+this.clipLag<c&&(this.clipping=!1);const d=i[t],l=Math.max(s,d*a);i[t]=l}getMaxBuffer(){return 0}}class Bae{constructor(){if(this.type="html5",this.durationInitialized=!1,this.waitingForDecodeCount=0,this.shutdown=async()=>{await this.stop(),this.audioMeter&&(this.audioMeter.shutdown(),this.audioMeter=void 0),this.context.close(),this.audioElement&&(this.audioElement.remove(),this.audioElement=void 0,this.source=void 0)},this.play=async()=>{const e=Date.now();if(!this.audioElement)throw new Error("No audio element");return this.audioElement.currentTime=this.currentTime,"suspended"===this.context.state&&this.context.resume(),this.audioMeter=new Uae({context:this.context}),this.source&&this.source.connect(this.audioMeter.destination),await this.audioElement.play(),{totalMs:Date.now()-e}},this.pause=async()=>(await this.stopAndSeek(this.currentTime),this.audioMeter&&(this.audioMeter.shutdown(),this.audioMeter=void 0),await this.context.suspend(),!0),this.seek=async e=>{const t=Date.now(),n=this.audioElement;return n?n.readyState>=HTMLMediaElement.HAVE_ENOUGH_DATA||!this.isPlaying?(n.currentTime=e,{totalMs:Date.now()-t}):await new Promise((r=>{n.oncanplay=()=>(n.oncanplay=null,r({totalMs:Date.now()-t})),n.currentTime=e})):{totalMs:0}},this.setPlaybackRate=async e=>{this.audioElement&&(this.audioElement.playbackRate=e)},this.setVolume=e=>{if(!this.audioElement)throw new Error("No audio element");this.audioElement.volume=e},!window.AudioContext&&!window.webkitAudioContext)throw new Error("Web Audio API is not supported in this browser");this.context=window.webkitAudioContext?new webkitAudioContext:new AudioContext,this.context.suspend()}getAudioMeterForKey(e){return"master"===e?this.audioMeter:void 0}getAudioEffectForId(e){}get isPlaying(){return!!this.audioElement&&!this.audioElement.paused}get duration(){return this.audioElement&&this.durationInitialized?this.audioElement.duration:0}get currentTime(){return this.audioElement?this.audioElement.currentTime:0}get isSeekable(){return!!this.audioElement&&void 0!==this.audioElement.seekable}loadUrl(e,t=!1){return new Promise(((n,r)=>{if(console.log(`[HTML5AudioPlayer] Loading url ${e}`),this.url=e,this.durationInitialized=!1,this.audioElement&&(this.audioElement.remove(),this.audioElement=void 0),this.audioElement=new Audio,!this.audioElement)throw new Error("Could not create audio element");this.audioElement.ondurationchange=()=>{this.durationInitialized=!0,this.audioElement&&(this.audioElement.ondurationchange=null)},t?this.audioElement.oncanplaythrough=()=>{n()}:this.audioElement.oncanplay=()=>{n()},this.audioElement.onerror=()=>{this.audioElement&&this.audioElement.error?r(this.audioElement.error):r(new Error("Unknown error when loading media for playback"))},this.audioElement.src=this.url,this.audioElement.controls=!1,this.audioElement.autoplay=!1,this.audioElement.crossOrigin="*",document.body.appendChild(this.audioElement),this.initSource(),this.audioElement.load()}))}async stop(){await this.stopAndSeek(0),this.audioMeter&&(this.audioMeter.shutdown(),this.audioMeter=void 0),this.context.suspend()}async stopAndSeek(e){this.audioElement&&(await this.seek(e),this.audioElement.pause())}initSource(){this.audioElement&&!this.source&&(this.source=this.context.createMediaElementSource(this.audioElement),this.source.connect(this.context.destination))}}const jae=Nt.memo((function(e){return Nt.createElement(qo,{className:"uppercase",...e},"Beta")}));function Vae({children:e}){return Nt.createElement("span",{className:"ShortcutKey-module--DQeeuh"},e)}function zae(e,{attribute:t,range:{location:n,length:r}}){return t===Hee.ShortcutKey?Nt.createElement(Nt.Fragment,null,e.slice(0,n),Nt.createElement(Vae,null,e.substr(n,r)),e.slice(n+r)):t===Hee.BetaBadge?Nt.createElement(Nt.Fragment,null,e.slice(0,n),Nt.createElement(jae,{style:{background:"var(--grey-100-a)"}}),e.slice(n+r)):e}function Gae({icon:e}){const t=Nt.useContext(bo);switch(e){case $ee.Spinner:return Nt.createElement(u0,{color:"var(--toast-spinner-color)"});case $ee.Checkmark:return t?Nt.createElement(Eae,null):Nt.createElement("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGQ9Ik0xNSAyNGE5IDkgMCAxIDEgMC0xOCA5IDkgMCAwIDEgMCAxOHptMC0yYTcgNyAwIDEgMCAwLTE0IDcgNyAwIDAgMCAwIDE0em0yLjA3Ny0xMC41MjJhMSAxIDAgMSAxIDEuNzA2IDEuMDQ0bC0zLjc2NyA2LjE1NGExIDEgMCAwIDEtMS42MDIuMTRMMTEuMzIgMTYuNDVhMSAxIDAgMSAxIDEuNDk4LTEuMzI1bDEuMTk3IDEuMzU0IDMuMDYxLTV6IiBpZD0iYSIvPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNiAtNikiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PG1hc2sgaWQ9ImIiIGZpbGw9IiNmZmYiPjx1c2UgeGxpbms6aHJlZj0iI2EiLz48L21hc2s+PGcgbWFzaz0idXJsKCNiKSIgZmlsbD0iI0ZGRiI+PHBhdGggZD0iTTAgMGgzMHYzMEgweiIvPjwvZz48L2c+PC9zdmc+Cg==",alt:""});case $ee.GreenCheckmark:return t?Nt.createElement(Eae,null):Nt.createElement("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogIDxkZWZzPgogICAgPHBhdGggZD0iTTkgMThBOSA5IDAgMSAxIDkgMGE5IDkgMCAwIDEgMCAxOHoiIGlkPSJhIi8+CiAgPC9kZWZzPgogIDxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICA8bWFzayBpZD0iYiIgZmlsbD0iI2ZmZiI+CiAgICAgIDx1c2UgeGxpbms6aHJlZj0iI2EiLz4KICAgIDwvbWFzaz4KICAgIDx1c2UgZmlsbD0iIzAwRDFCMiIgeGxpbms6aHJlZj0iI2EiLz4KICAgIDxwYXRoIGQ9Ik0xMS4wOCA1LjQ4YTEgMSAwIDEgMSAxLjcgMS4wNGwtMy43NiA2LjE2YTEgMSAwIDAgMS0xLjYuMTRsLTIuMS0yLjM3YTEgMSAwIDEgMSAxLjUtMS4zM2wxLjIgMS4zNiAzLjA2LTV6IiBmaWxsPSIjRkZGIiBtYXNrPSJ1cmwoI2IpIi8+CiAgPC9nPgo8L3N2Zz4K",alt:""});case $ee.PinkCheckmark:return t?Nt.createElement(Eae,null):Nt.createElement("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogIDxkZWZzPgogICAgPHBhdGggZD0iTTkgMThBOSA5IDAgMSAxIDkgMGE5IDkgMCAwIDEgMCAxOHoiIGlkPSJhIi8+CiAgPC9kZWZzPgogIDxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICA8bWFzayBpZD0iYiIgZmlsbD0iI2ZmZiI+CiAgICAgIDx1c2UgeGxpbms6aHJlZj0iI2EiLz4KICAgIDwvbWFzaz4KICAgIDx1c2UgZmlsbD0iI0Q4MjI5MiIgeGxpbms6aHJlZj0iI2EiLz4KICAgIDxwYXRoIGQ9Ik0xMS4wOCA1LjQ4YTEgMSAwIDEgMSAxLjcgMS4wNGwtMy43NiA2LjE2YTEgMSAwIDAgMS0xLjYuMTRsLTIuMS0yLjM3YTEgMSAwIDEgMSAxLjUtMS4zM2wxLjIgMS4zNiAzLjA2LTV6IiBmaWxsPSIjRkZGIiBtYXNrPSJ1cmwoI2IpIi8+CiAgPC9nPgo8L3N2Zz4K",alt:""});case $ee.Crosshair:return t?Nt.createElement(yae,null):Nt.createElement("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgIDxjaXJjbGUgZmlsbD0iI0ZGRiIgY3g9IjkiIGN5PSI5IiByPSIyIi8+CiAgICA8Y2lyY2xlIHN0cm9rZT0iI0ZGRiIgc3Ryb2tlLXdpZHRoPSIyIiBjeD0iOSIgY3k9IjkiIHI9IjYiLz4KICAgIDxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik04IDBoMnY0SDh6TTggMTRoMnY0SDh6TTE1IDhoM3YyaC0zek0wIDhoM3YySDB6Ii8+CiAgPC9nPgo8L3N2Zz4K",alt:""});case $ee.Alert:return t?Nt.createElement(g1,null):Nt.createElement(h1,{color:"#ff365b",opacity:1});case $ee.Headphones:return t?Nt.createElement(Sae,null):Nt.createElement("div",{className:"ToastPresenter-module--gssoBS"},"\u{1f3a7}");default:return _r}}function Wae({animation:e,dismissToast:t,hideToast:n,onAction:r=(()=>{}),onRoute:o=(()=>{}),toast:{actionOrRoute:i,dismissAfter:a,dismissible:s,dismissAction:c,icon:d,style:l,message:u,actionMessage:f,subtext:m,attributedRange:p,subtextAttributedRange:g,id:h,count:v,sound:E,tooltip:y}}){const[S,I]=Nt.useState(a);$r(h)&&a&&I(a+1e-8*Math.random());const b=Pr((e=>{i&&("route"===i.type?o(i):r(i),t(h),e.stopPropagation())})),T=Pr((()=>{r&&c&&r({type:"action",action:c}),t(h)})),w=Pr((()=>{r&&c&&r({type:"action",action:c}),n(h)}));var C;C=E,(0,Nt.useEffect)((()=>{if(void 0===C)return;const e=C,t=new Bae;return async function(){await t.loadUrl(e,!0),await t.play()}(),()=>{t.stop()}}),[C]);const _=(0,Nt.useMemo)((()=>{let e=u;return void 0!==v&&(e=`${u} | ${v} remaining`),p?zae(e,p):e}),[u,p,v]),A=(0,Nt.useMemo)((()=>{if(m)return g?zae(m,g):m}),[m,g]),R="string"===typeof d?Nt.createElement(Gae,{icon:d}):d;return l===qee.Button?Nt.createElement(ei,{title:y?.title,subtitle:y?.subtitle,enabled:Boolean(y),placement:"top",asChild:!0,distance:0},Nt.createElement(gae,{onDismiss:T,id:h,dismissAfter:S,onClick:b,message:u,animation:e})):Nt.createElement(hae,{id:h,onDismiss:T,onHide:w,onClick:b,dismissAfter:S,icon:R,message:_,actionMessage:f,subtext:A,dismissible:s,isTip:l===qee.Tip,isMultiline:l===qee.MultiLine,animation:e})}const Hae=(0,Nt.createContext)({toasts:[]});function qae({children:e,toasts:t}){const n=(0,Nt.useMemo)((()=>({toasts:t})),[t]);return Nt.createElement(fae.zt,{swipeThreshold:1/0},Nt.createElement(Hae.Provider,{value:n},e))}function $ae(){const e=(0,Ft.I0)();return(0,Nt.useCallback)((t=>{e(U6({...t,id:`${t.id}-${(0,Zt.Z)()}`}))}),[e])}function Kae({className:e}){const{toasts:t}=(0,Nt.useContext)(Hae),n=(0,Ft.I0)(),r=(0,Nt.useCallback)((e=>{n(B6({toastId:e}))}),[n]),o=Pr((({action:e})=>{n(e)})),i=(0,Nt.useCallback)((e=>{e&&window.open(e.path,"_blank")}),[]);return Nt.createElement(Nt.Fragment,null,t.map((e=>Nt.createElement(Wae,{toast:e,key:e.id,dismissToast:r,hideToast:r,onRoute:i,onAction:o}))),Nt.createElement(vae,{className:e}))}function Yae({scrollContainerRef:e,commentsEnabled:t,draftAnnotation:n,project:r}){const o=$ae(),[i,a]=(0,Nt.useState)(_r),s=(0,Nt.useRef)(!1),c=(0,Nt.useRef)(!1),d=(0,Nt.useRef)(),l=(0,Nt.useRef)(),u=!i||i.anchorNode===i.focusNode,f=(0,Nt.useCallback)((()=>{d.current&&clearTimeout(d.current),l.current&&clearTimeout(l.current)}),[]),m=(0,Nt.useCallback)((()=>{a(_r),window.getSelection()?.empty(),e.current?.removeAttribute("data-hide-selection")}),[e]),p=(0,Nt.useCallback)((()=>{!1===s.current&&m()}),[m]);Jr("mousedown",(0,Nt.useCallback)((e=>{2!==e.button&&(s.current=!0,m(),f())}),[m,f]),e.current),Jr("mouseup",(0,Nt.useCallback)((()=>{const t=document.getSelection();if(s.current=!1,!t?.isCollapsed&&t?.anchorNode&&t?.focusNode&&e?.current?.contains(t.anchorNode)){const e=t.getRangeAt(0);e.setStart(e.startContainer.parentElement?.getAttribute("data-word")?e.startContainer:e.startContainer.nextSibling?.firstChild||e.startContainer,0);const n=e.endContainer.parentElement?.getAttribute("data-word")?e.endContainer:e.endContainer.previousSibling?.lastChild||e.endContainer;e.setEnd(n,n.nodeValue?.length||t.anchorOffset),t.addRange(e),a(t)}else m()}),[e,m]),e.current),Jr("scroll",p,e.current),Jr("mousemove",(0,Nt.useCallback)((t=>{if(f(),s.current||!1===c.current&&!window.getSelection()?.isCollapsed)return void(c.current=!1);const n=t.composedPath().find((e=>Br(e)&&e.classList?.contains(die)));d.current=setTimeout((()=>{const t=document.querySelectorAll(":hover"),r=!e?.current?.contains(t.item(t.length-1));!c.current||n&&!r||(c.current=!1,m(),f())}),250),l.current=setTimeout((()=>{n&&(a(_r),c.current=!0,requestAnimationFrame((()=>{const t=window.getSelection();if("Caret"===t?.type)return;const r=document.createRange();t?.removeAllRanges(),r.selectNodeContents(n),t?.addRange(r),a(t),e.current?.setAttribute("data-hide-selection","true")})))}),500)}),[e,f,m]),e.current);const g=!i,h=(0,Nt.useCallback)((e=>{n(),e.stopPropagation(),m()}),[n,m]),v=i$(r.url_slug),E=(0,Nt.useCallback)((e=>{const{timeOffset:t=0,endTime:n=0}=gte(i)||{},r=s8(v,t,u?void 0:n);K2()(r.toString()),e.stopPropagation(),m();const a=_d(t),s=_d(n);o({id:"link-copy-toast",style:qee.Default,dismissible:!0,dismissAfter:3,message:u?`Link copied to clipboard starting at ${a}`:`Range copied to clipboard starting at ${a} and ending at ${s}`})}),[u,i,m,o,v]);return Nt.createElement(uae,{hidden:g,onMouseEnter:f,className:"gap-2"},!g&&Nt.createElement(Nt.Fragment,null,t&&Nt.createElement(ei,{title:"Comment",subtitle:ge(sae.electronAccelerator)},Nt.createElement(Yo,{onClick:h,"data-testid":"hover-add-comment"},Nt.createElement(oae,null))),Nt.createElement(ei,{title:u?"Copy link":"Share Range"},Nt.createElement(Yo,{onClick:E,"data-testid":"hover-get-link"},Nt.createElement(YW,null)))))}var Zae=n(65342),Jae=n.n(Zae);const Qae=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"search-s"})));const Xae=Nt.forwardRef((function({style:e,className:t,placeholder:n="Search",iconSize:r,hideSearchInput:o=!1,onClear:i,children:a,...s},c){const d=Nt.useRef(_r),l=function(){const e=Nt.useRef(_r);return Nt.useEffect((()=>{if(!e.current)return;const t=new IntersectionObserver((e=>{e.forEach((e=>{(Br(e.target.nextSibling)?e.target.nextSibling:void 0)?.toggleAttribute("data-stuck",!e.isIntersecting)}))}));return t.observe(e.current),()=>{t.disconnect()}}),[e]),Nt.createElement("div",{ref:e})}(),u=(0,s2.e)(c,d);Nt.useEffect((()=>{0!==d.current?.value.length&&d.current?.select()}),[]);const f=Pr((()=>{d.current&&(d.current.value="",d.current?.select()),i&&i()})),m=Pr((()=>d.current?.focus()));return Nt.createElement(Nt.Fragment,null,l,Nt.createElement("div",{style:e,onClick:m,className:yo()("row z-1 relative rounded-sm","SearchInput-module--eXucwy",t)},Nt.createElement("div",{className:"SearchInput-module--DKXhtW"}),Nt.createElement(Zo,{size:r},Nt.createElement(Qae,null)),Nt.createElement("div",{className:"row flex-1 min-w-0"},Nt.createElement("input",{type:"search",className:yo()("SearchInput-module--eT5K02","flex-1 min-w-0 bg-transparent label-1-regular",{"SearchInput-module--wQmAK9":o}),ref:u,placeholder:n,...s}),!!d.current?.value.length&&Nt.createElement(Yo,{"aria-label":"Clear search",onClick:f},Nt.createElement(V1,{color:"var(--grey-400)"}))),a))}));var ese="Select-module--T8J1uF",tse="Select-module--NKAZjn",nse="Select-module--GYW2uy",rse="Select-module--wcaJxz",ose="Select-module--TKDsKp",ise="Select-module--jmmIjE",ase="Select-module--gF54Jw",sse="Select-module--IslSXC",cse="Select-module--F8HTMi",dse="Select-module--FZ3Dgx",lse="Select-module--FNkspd",use="Select-module--mziTAJ",fse="Select-module--apEwYK",mse="Select-module--y1tqKb",pse="Select-module--Nv0AqF",gse="Select-module--PUvt5U",hse="Select-module--OzK6c0",vse="Select-module--tuevFV",Ese="Select-module--JsTwwQ";Noe.displayName="Select.Input";koe.displayName="Select.Toolbar";Uoe.displayName="Select.Label";woe.displayName="Select.SubMenu";Poe.displayName="Select.SubMenuTrigger";Roe.displayName="Select.SubMenuOptions";Moe.displayName="Select.Separator";const yse=Foe;yse.displayName="Select.OptionExplanation";Loe.displayName="Select.OptionShortcut";const Sse=Nt.createContext((e=>{})),Ise=Nt.forwardRef((function({children:e,fullWidthLabel:t,align:n,className:r,...o},i){return Nt.createElement("button",{ref:i,type:"button",className:yo()(Ese,r,pse,{"justify-end":"right"===n}),...o},Nt.createElement("span",{className:yo()(dse,n&&gse,t&&"w-full")},e),Nt.createElement("div",{className:nse},Nt.createElement(Vne,{className:tse})))}));function bse({children:e,value:t,onValueChange:n,label:r,icon:o,size:i,variant:a="secondary",className:s,disabled:c,tooltip:d,tooltipSide:l,matchWidth:u,onEscapeKeyDown:f,style:m,id:p,menuAlign:g="start",menuSide:h,fullWidthLabel:E,open:y,onOpenChange:S,defaultOpen:I,isCentered:b,contentClassName:T,...w}){const C=Nt.useContext(bo),_="align"in w?w.align:void 0,A="aria-label"in w?w["aria-label"]:void 0,R="data-testid"in w?w["data-testid"]:void 0,M="aria-labelledby"in w?w["aria-labelledby"]:void 0,D=(0,yne.M)(p),[O,x]=(0,Ene.T)({prop:y,onChange:S,defaultProp:I}),k=Pr((()=>x(!0))),N=(0,Nt.useRef)(_r),P=Pr((e=>{d&&!e.nativeEvent.sourceCapabilities&&e.stopPropagation()})),L="redesign"===a||"redesign-light"===a||"redesign-border"===a||C?Nt.createElement(Wne,{icon:o,"aria-label":A||d||"","aria-labelledby":M,inputId:D,"data-state":O?"open":"",disabled:c,className:yo()(s,"overflow-hidden",b&&rse),style:m,align:_,onClick:c?void 0:k,"data-testid":R,border:"redesign-light"===a?"hide":"redesign-border"===a?"show":"show-on-interaction"},Nt.createElement(mne.xz,{asChild:!0,disabled:c},Nt.createElement(Ise,{ref:N,id:p,fullWidthLabel:E,align:_,onFocus:P,className:yo()({"pl-0":o})},r))):Nt.createElement(mne.xz,{ref:N,disabled:c,className:yo()(Ese,s,i&&v[i],a&&v[a]),style:m,onFocus:P,"aria-label":d,type:"button"},Boolean(o)&&Nt.createElement("span",{className:ase},o),Nt.createElement("span",{className:dse},r),Nt.createElement(q1,{className:ese}));return Nt.createElement(Sse.Provider,{value:x},Nt.createElement(eoe.Provider,{value:O},Nt.createElement(boe,{type:"select"},Nt.createElement(mne.fC,{open:O,onOpenChange:x},d?Nt.createElement(ei,{title:d,placement:l,asChild:!0},L):L,Nt.createElement(Aoe,{...Ee(w,"aria-labelledby","aria-label","align","data-testid"),hasIcons:!0,side:h,align:g,className:yo()(ose,T,u&&mse),onEscapeKeyDown:(0,wo.M)(f,Fr)},Nt.createElement(joe,{value:t,onValueChange:n},e))))))}function Tse({children:e,closeOnClick:t,onClick:n,sentenceCase:r,...o}){const i=Nt.useContext(Sse),a=Pr((()=>i(!1)));return Nt.createElement(Goe,{...o,label:e,sentenceCase:r,onClick:t?(0,wo.M)(a,n):n})}function wse({searchValue:e,searchValueSet:t,currentHighlighter:n,currentHighlighterSet:r,usedHighlighters:o,control:i}){const[a,s]=(0,Nt.useState)(e),c=(0,Nt.useMemo)((()=>Jae()((e=>t(e)),300)),[t]),d=(0,Nt.useMemo)((()=>o.find((e=>e.id===n))),[n,o]),l=Pr((e=>{s(e),c(e)}));vo(),(0,Nt.useEffect)((()=>{const t=setTimeout((()=>{e||e===a||s("")}),300);return()=>{t&&clearTimeout(t)}}),[e,a]);const{isEmbedded:u}=(0,Nt.useContext)(lie),f="undefined"!==typeof window,m=(0,Nt.useMemo)((()=>{if(!f||!u)return!1;const{controlSpacer:e}=(0,aZ.parse)(location.search);return"1"===e}),[f,u]);return Nt.createElement(e0,{className:"row px-3 py-2"},Nt.createElement("div",{className:"row flex-1 min-w-0"},Nt.createElement(Xae,{"aria-label":"Search script",className:"flex-1 min-w-0",value:a,onChange:e=>l(e.target.value),onClear:()=>l("")}),o.length>0&&!m&&Nt.createElement(bse,{label:d?.name||"All highlights",value:n||"all",onValueChange:r,variant:"redesign-light","aria-label":"Filter highlights"},Nt.createElement(Tse,{value:""},"All highlights"),o.map((e=>Nt.createElement(Tse,{key:e.id,value:e.id},function(e){return NO.get(e.id)||e.name}(e)))))),i,m&&Nt.createElement(Zo,null))}Ise.displayName="Select.Trigger",bse.displayName="Select.Root",Tse.displayName="Select.Option";var Cse="ShortcutSheet-module--Ir6z5_",_se="ShortcutSheet-module--GjOSq3",Ase="ShortcutSheet-module--CXdcHP",Rse="ShortcutSheet-module--NaODy0",Mse="ShortcutSheet-module--wuBf1O",Dse="ShortcutSheet-module--AOWbye",Ose="ShortcutSheet-module--BKumhJ",xse="ShortcutSheet-module--knqsgV",kse="ShortcutSheet-module--GrQT_X",Nse="ShortcutSheet-module--iDqmn2",Pse="ShortcutSheet-module--xDvYFH",Lse="ShortcutSheet-module--cZphtJ",Fse="ShortcutSheet-module--dwrfYJ",Use="ShortcutSheet-module--WMYEml",Bse="ShortcutSheet-module--A_MVwK";const jse=Nt.forwardRef((function({children:e,id:t,className:n="",onScroll:r,onClick:o,overlayScrollbar:i},a){const[s,c]=function(e){const[t,n]=(0,Nt.useState)(!1),r=(0,Nt.useRef)(void 0),o=(0,Nt.useCallback)((()=>{r.current?window.clearTimeout(r.current):n(!0),r.current=window.setTimeout((()=>{n(!1),r.current=void 0}),e)}),[e]),i=(0,Nt.useCallback)((()=>{r.current&&window.clearTimeout(r.current),n(!1),r.current=void 0}),[]);return(0,Nt.useEffect)((()=>()=>{r.current&&window.clearTimeout(r.current)}),[]),[t,o,i]}(600),d=(0,Nt.useCallback)((e=>{c(),r?.(e)}),[r,c]);return Nt.createElement("div",{id:t,className:yo()(n,"NativeScrollpane-module--WSMQE9",{"NativeScrollpane-module--VpAVQ7":s,"NativeScrollpane-module--O7XQHu":i}),ref:a,onScroll:d,onClick:o},e)})),Vse=(0,H1.ZP)(o0)`
    font-size: ${Dr.tiny};
    font-weight: ${Or.semibold};
    color: ${xr.subtext};
    text-transform: uppercase;
    line-height: 1.5;
    letter-spacing: 1.2px;
    white-space: nowrap;
    ${({padding:e})=>e&&H1.iv`
            padding: ${e};
        `}
    ${({width:e})=>e&&H1.iv`
            width: ${e};
        `}
        ${({maxWidth:e})=>e&&H1.iv`
            max-width: ${e};
        `}

    ${({onClick:e})=>e&&H1.iv`
            cursor: pointer;
            transition: color var(--transition-duration-normal);
            &:hover {
                color: var(--color-black-80pct);
            }

            [data-redesign] &:hover {
                color: var(--grey-800);
            }
        `}
`;var zse=n(20512);const Gse=Nt.forwardRef((function({children:e,className:t,state:n,onClose:r,isSelected:o,icon:i,size:a="medium",...s},c){const d=n?"text-grey-0":"text-grey-900",l=Pr((e=>{"Backspace"===e.key&&r?.()}));return vo(),Nt.createElement("button",{ref:c,type:"button","data-chip":"true",tabIndex:r||s.onClick||s.onKeyDown?0:-1,className:yo()(t,"row z-0 label-1-regular text-grey-900 relative rounded-sm","medium"===a?"h-5":"h-4",-1===s.tabIndex&&"cursor-default",void 0!==s.onClick&&"cursor-pointer"),...s,onKeyDown:(0,wo.M)(s.onKeyDown,l)},Nt.createElement("div",{className:yo()("absolute -z-1 border bg-grey-0 rounded-sm","Chip-module--dTfD_b",{"border-grey-100-a":!o&&!n,"bg-cyan-500-a border-cyan-500":o||"on"===s["data-state"],"bg-amber-500 border-amber-500":"warning"===n,"bg-green-500 border-none":"success"===n,"bg-red-500 border-red-500":"error"===n})}),i,Boolean(e)&&Nt.createElement(o0,{className:yo()(d,"py-1",!r&&"pr-2",!i&&"pl-2"),ellipsisOverflow:!0},e),r&&Nt.createElement(Zo,{className:d,onClick:(0,wo.M)(r,Fr),tabIndex:-1,"data-testid":"close-chip"},Nt.createElement(V1,null)))}));var Wse=n(55490);const Hse=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement(Wse.f,{ref:n,className:yo()("Separator-module--MJuJqs",e),...t})})),qse=(0,H1.ZP)(Vse)`
    line-height: 38px;
`;function $se({shortcut:e}){const t=Nt.useContext(bo),n=function(e){return pe("string"===typeof e?e:e.join("+"))}(e);return t?Nt.createElement(Gse,null,n.map(((e,t)=>Nt.createElement("span",{key:e},e,t===n.length-1?"":" ")))):Nt.createElement("div",{className:Bse},n.map((e=>Nt.createElement("span",{className:Nse,key:e},e))))}function Kse({sections:e,searchTerm:t}){const n=Nt.useContext(bo);return e?n?Nt.createElement(Nt.Fragment,null,e.map((({name:n,entries:r},o)=>{let i=r.filter((e=>e.browserShortcut||e.electronAccelerator));return t&&(i=i.filter((e=>e.label.toLowerCase().includes(t.toLowerCase())))),i.length?Nt.createElement(Nt.Fragment,{key:n},Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-medium",className:"px-2 text-grey-900"},n)),i.map(((e,t)=>Nt.createElement(e0,{key:e.label+t},Nt.createElement(o0,{variant:"label-1-regular",className:yo()("px-2 flex-1",e.nameClass&&E[e.nameClass])},ee(e.label)),Nt.createElement("div",{className:"row gap-1"},e.browserShortcut?Nt.createElement($se,{shortcut:e.browserShortcut}):e.electronAccelerator&&Nt.createElement($se,{shortcut:e.electronAccelerator}),e.alternateShortcut?.browserShortcut&&Nt.createElement($se,{shortcut:e.alternateShortcut.browserShortcut}))))),o!==e.length-1&&Nt.createElement(Hse,null)):_r}))):Nt.createElement(Nt.Fragment,null,e.map((({name:e,entries:t})=>Nt.createElement("div",{className:Fse,key:e},Nt.createElement(qse,{as:"div"},e),t.map(((e,t)=>Nt.createElement("div",{className:Rse,key:e.label+t},Nt.createElement("div",{className:yo()(Pse,e.nameClass&&E[e.nameClass])},e.label),e.browserShortcut?Nt.createElement($se,{shortcut:e.browserShortcut}):e.electronAccelerator&&Nt.createElement($se,{shortcut:e.electronAccelerator}),e.alternateShortcut?.browserShortcut&&Nt.createElement($se,{shortcut:e.alternateShortcut.browserShortcut})))))))):_r}function Yse({sections:e,open:t,onClose:n=_e}){const r=Nt.useContext(bo),o=Nt.useRef(_r),[i,a]=(0,Nt.useState)(!1),[s,c]=Nt.useState(""),d=Pr((e=>{c(e.target.value)})),l=Pr((()=>{c("")})),u=Pr((e=>{e.preventDefault(),e.stopPropagation(),e.persist(),a(!1),o.current?.addEventListener("animationend",n,{once:!0})}));$r(t)&&a(t);let f=_r;return f=r?Nt.createElement("div",{ref:o,className:yo()(Lse,i?Mse:Dse,"bg-grey-0 border border-grey-100-a rounded elevation-5 bottom-0 right-0 m-2 stack"),"data-testid":"shortcutSheet"},Nt.createElement(e0,{size:"small",className:"mt-1"},Nt.createElement(o0,{variant:"label-1-medium",className:"px-2 text-grey-900"},"Keyboard shortcuts"),Nt.createElement("div",{className:"split"}),Nt.createElement(Yo,{onClick:u,"aria-label":"Close shortcut sheet"},Nt.createElement(V1,null))),Nt.createElement(Hse,null),Nt.createElement(Xae,{placeholder:"Search for shortcuts",value:s,onChange:d,onClear:l,className:"mx-2"}),Nt.createElement(Hse,null),Nt.createElement(T2,null,Nt.createElement(Kse,{sections:e,searchTerm:s}))):Nt.createElement("div",{ref:o,className:yo()(Use,i?Mse:Dse),"data-testid":"shortcutSheet"},Nt.createElement("button",{type:"button",className:_se,onClick:u},Nt.createElement("img",{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDQ3LjEgKDQ1NDIyKSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5DbGVhcjwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIG9wYWNpdHk9IjAuMzAwMDAwMDEyIj4KICAgICAgICA8ZyBpZD0iZGVzY3JpcHQtd2ViLWFwcC1jb3B5LTE3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTI4NC4wMDAwMDAsIC0yOTMuMDAwMDAwKSIgZmlsbD0iIzAwMDczRCI+CiAgICAgICAgICAgIDxnIGlkPSJwYW5lbCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOTcwLjAwMDAwMCwgMjgxLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTMyMy4wNjA2NiwyMCBMMzI0LjgyNjU3NCwxOC4yMzQwODYxIEMzMjUuMTE1Njg5LDE3Ljk0NDk3MDkgMzI1LjEyMTMyLDE3LjQ2NDQ2NjEgMzI0LjgyODQyNywxNy4xNzE1NzI5IEMzMjQuNTMzNDkyLDE2Ljg3NjYzNzcgMzI0LjA1OTgzMSwxNi44Nzk1MDkzIDMyMy43NjU5MTQsMTcuMTczNDI1OSBMMzIyLDE4LjkzOTMzOTggTDMyMC4yMzQwODYsMTcuMTczNDI1OSBDMzE5Ljk0NDk3MSwxNi44ODQzMTA3IDMxOS40NjQ0NjYsMTYuODc4Njc5NyAzMTkuMTcxNTczLDE3LjE3MTU3MjkgQzMxOC44NzY2MzgsMTcuNDY2NTA4MSAzMTguODc5NTA5LDE3Ljk0MDE2OTUgMzE5LjE3MzQyNiwxOC4yMzQwODYxIEwzMjAuOTM5MzQsMjAgTDMxOS4xNzM0MjYsMjEuNzY1OTEzOSBDMzE4Ljg4NDMxMSwyMi4wNTUwMjkxIDMxOC44Nzg2OCwyMi41MzU1MzM5IDMxOS4xNzE1NzMsMjIuODI4NDI3MSBDMzE5LjQ2NjUwOCwyMy4xMjMzNjIzIDMxOS45NDAxNjksMjMuMTIwNDkwNyAzMjAuMjM0MDg2LDIyLjgyNjU3NDEgTDMyMiwyMS4wNjA2NjAyIEwzMjMuNzY1OTE0LDIyLjgyNjU3NDEgQzMyNC4wNTUwMjksMjMuMTE1Njg5MyAzMjQuNTM1NTM0LDIzLjEyMTMyMDMgMzI0LjgyODQyNywyMi44Mjg0MjcxIEMzMjUuMTIzMzYyLDIyLjUzMzQ5MTkgMzI1LjEyMDQ5MSwyMi4wNTk4MzA1IDMyNC44MjY1NzQsMjEuNzY1OTEzOSBMMzIzLjA2MDY2LDIwIFogTTMyMiwyOCBDMzE3LjU4MTcyMiwyOCAzMTQsMjQuNDE4Mjc4IDMxNCwyMCBDMzE0LDE1LjU4MTcyMiAzMTcuNTgxNzIyLDEyIDMyMiwxMiBDMzI2LjQxODI3OCwxMiAzMzAsMTUuNTgxNzIyIDMzMCwyMCBDMzMwLDI0LjQxODI3OCAzMjYuNDE4Mjc4LDI4IDMyMiwyOCBaIiBpZD0iQ2xlYXIiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+",alt:"Close shortcut modal"})),Nt.createElement(jse,{className:Ase},Nt.createElement(Kse,{sections:e,searchTerm:s}))),Nt.createElement(zse.z,{present:i},f)}var Zse=n(38994);Zse.platform,Zse.platform,Zse.platform,Zse.platform;const Jse=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"help-circle-stroke"}))),Qse=Nt.forwardRef((function(e,t){return Nt.createElement(Yo,{ref:t,"aria-label":"Help options",...e},Nt.createElement(Jse,null))})),Xse=[{label:"Play / Pause",browserShortcut:"Space"},{label:"Comment",browserShortcut:sae.electronAccelerator},{label:"Comment",browserShortcut:iae},{label:"Toggle fullscreen",browserShortcut:"F"},{label:"Toggle subtitles",browserShortcut:"C"},{label:"Toggle compact mode",browserShortcut:"T"},{label:"Toggle mute",browserShortcut:"M"},{label:"Seek forward 5s",browserShortcut:"\u2192"},{label:"Seek backward 5s",browserShortcut:"\u2190"},{label:"Seek to 10% to 90%",browserShortcut:"1-9"},{label:"Seek to the beginning",browserShortcut:"0"},{label:"Volume up",browserShortcut:"\u2191"},{label:"Volume down",browserShortcut:"\u2193"},{label:"Decrease playback speed",browserShortcut:"Shift+J"},{label:"Reset playback speed",browserShortcut:"Shift+K"},{label:"Increase playback speed",browserShortcut:"Shift+L"}],ece={audio:["Toggle fullscreen","Toggle compact mode","Toggle subtitles"],video:[],audiogram:["Comment","Toggle compact mode","Toggle subtitles"]};function tce({className:e,project:t}){const[n,r]=one(!1),o=function(e){return Xse.filter((t=>!("Comment"===t.label&&!e.comments_enabled)&&("Comment"!==t.label||t.browserShortcut!==aae)&&!ece[e.publish_type].includes(t.label)))}(t);return Nt.createElement(Nt.Fragment,null,Nt.createElement(ei,{title:"Keyboard Shortcuts",enabled:!n,className:e},Nt.createElement(Qse,{onClick:r})),Nt.createElement(io.h,null,Nt.createElement(Yse,{open:n,sections:[{name:"Keyboard Shortcuts",entries:o}],onClose:r})))}const nce="playhead";function rce(e){return Math.max(0,e-3)}function oce(e,t){return t?t+3:e+10}function ice(e,t){return e.slice(0,t).split(" ").filter((e=>e.length>0)).length}function ace(e,t){const n=e.map((e=>e.text)).join(" "),r=new RegExp(`\\b${t}`,"gi"),o=[];let i;for(;i=r.exec(n);){const r=ice(n,i.index),a=ice(n,i.index+t.length);o.push({startIndex:r,endIndex:a,words:e.slice(r,Math.max(a,r+1))})}return o}function sce({paragraph:e,resultStart:t,resultEnd:n,search:r,onNavigate:o,...i}){const a=rce(t),s=oce(t,n),c=e.words.slice(a,s),d=c[c.length-1];return Nt.createElement("div",{className:"EmbeddedScript-module--yc0RZh"},Nt.createElement("button",{type:"button",...i,className:"EmbeddedScript-module--wkOw7W"},0===a?void 0:"...",c.map((e=>{const t=!!r&&r.some((t=>t.startTime===e.startTime));return Nt.createElement(Jie,{key:`${e.text}-${e.startTime}`,word:e,className:t?"EmbeddedScript-module--o4j3FH":void 0,isEmbeddedScript:!0})})),s===e.words.length-1||d.text.match(/[.!?\\-]$/)?void 0:"..."),Nt.createElement(ei,{title:"Open script",placement:"left",className:"EmbeddedScript-module--fxi49Q"},Nt.createElement(Yo,{onClick:o},Nt.createElement(U1,null))))}function cce(e,t,n){return e>=t.start&&e<(n?.start||t.end)}const dce=Yt()();function lce(e){const t=eae();let n=t.find((t=>t.el.getAttribute("data-start-time")===String(a8(e))));t.forEach((e=>e.el.id="")),n||0!==e||(n=t[0]),n&&(n.el.id=nce)}const uce=Nt.forwardRef((function({visible:e=!0,autoScroll:t=!0,doc:n,isPlaying:r,seekTo:o,play:i,pause:a,onScroll:s,annotations:c,setActiveAnnotation:d,className:l,children:u,name:f,project:m,isProcessing:p,draftAnnotation:g,headerControl:h,isHidden:v,...E}){const{setPlaybackTimeRange:y}=(0,Nt.useContext)(Kie),S=(0,Nt.useRef)(_r),{isEmbedded:I}=(0,Nt.useContext)(lie),[b,T]=(0,Nt.useState)(""),w=(0,Nt.useRef)(void 0),[C,_]=(0,Nt.useState)(),[A,R]=(0,Nt.useState)([]),M=Nt.useContext($te),D=Kte(),{scrollContainerRef:O,automaticScrollsInProgress:x,startAutomaticScroll:k,finishAutomaticScroll:N}=cie({isPlaying:r,playheadTime:D,selector:"#playhead",disabled:!t}),{updateAnimatedPlayhead:P}=function({mediaRef:e,runAnimation:t}){const n=kr(t),r=Pr((()=>{const t=e?.current?.currentTime??0,n=eae();for(let e=0;e<n.length;e++){const r=n[e],o=r.el.hasAttribute("data-current-word");cce(t,r,n[e+1])?o||(r.el.setAttribute("data-current-word","true"),r.el.id=nce):o&&(r.el.removeAttribute("data-current-word"),r.el.id="")}}));return(0,Nt.useEffect)((()=>{let n=0;function o(){n+=1,n%10===0&&r(),(0,Kr.W)(o)}return t&&o(),e.current&&(e.current.onseeked=r),()=>{Kr.W.cancel(o)}}),[e,t,n,r]),{updateAnimatedPlayhead:r}}({mediaRef:M,runAnimation:!!r&&`${b}${C}`}),L=c?.find((e=>e.active)),F=Pr(((e,t)=>{if(!O.current||!n)return;const r=function(e,t){const n=rh(e.content.filter(Die),(e=>Mie(e)?oh(e.timeOffset-t):oh(e.words[0].startTime-t))),r=n.match||n.previous;if(!r)return;const o=rh(r.value.words,(e=>oh(e.startTime-t)));return(o.match||o.next||o.previous)?.value}(n,e);if(!r)return;const o=document.querySelector(`[data-word][data-start-time="${r?.startTime}"]`);if(o){const e=o.getBoundingClientRect(),t=O.current.getBoundingClientRect();if(e.top>t.top&&e.bottom<t.bottom)return}k(),S.current?.scrollToTime(e,t),setTimeout((()=>{N(),P()}),500)}));(0,Nt.useLayoutEffect)((()=>{const e=d8();e&&F(e.start)}),[F]),(0,Nt.useEffect)((()=>{void 0!==L?.segmentTimeOffset&&F(L.segmentTimeOffset,"auto")}),[L?.segmentTimeOffset,F]),(0,Nt.useEffect)((()=>{t&&M.current&&F(M.current?.currentTime,"smooth")}),[t,D,F,M]),(0,Nt.useEffect)((()=>{t&&M.current&&F(M.current?.currentTime)}),[t,F,M]);const U=(0,Nt.useMemo)((()=>{if(!n?.content)return{};const e={};function t(e){return e?.attributes.find((e=>e.attribute.name===Gu.Highlight))}function r(t,n){e[t]||(e[t]=[]),e[t].push(n)}return n.content.forEach(((e,n)=>{if("words"in e)for(let o=0;o<e.words.length;o++){const i=t(e.words[o]);if(i){const a=o;let s=t(e.words[o+1]);for(;s?.attribute.value===i.attribute.value;)s=t(e.words[++o]);r(i.attribute.value,{paragraph:e,start:a,end:o,paragraphIndex:n})}}})),e}),[n?.content]),B=xO.filter((e=>Object.keys(U).includes(e.id))),j=Pr((()=>{w.current?.()}));(0,Nt.useEffect)((()=>{v&&j()}),[v,j]);const V=Pr((async(e,t={})=>{o(e),y(void 0),j(),t.play&&i(),t.openScript&&(T(""),_(void 0),setTimeout((()=>F(e)),100))})),z=Pr((async(e,t)=>{function n(){return!(M.current&&M.current.currentTime>=t)||(a(),!1)}V(e,{play:!0}),(0,Kr.W)(n),w.current=()=>Kr.W.cancel(n)}));(0,Nt.useEffect)(j,[b,j]),(0,Nt.useLayoutEffect)((()=>{if(!n?.content)return;const e=[];if(C){let t;t=C===K5?Object.entries(U).reduce(((e,[t,n])=>[...e,...n]),[]).sort(((e,t)=>e.paragraph.words[0].startTime-t.paragraph.words[0].startTime)):U[C],t?.forEach((t=>{if(b){ace(t.paragraph.words.slice(t.start,t.end+1),b).forEach((({startIndex:n,endIndex:r,words:o})=>{const i=t.start+n,a=t.paragraph.words[rce(i)],s=t.start+r,c=t.paragraph.words[oce(i,s)];e.push(Nt.createElement(sce,{key:o[0].startTime,paragraph:t.paragraph,resultStart:i,resultEnd:s,search:o,onClick:()=>z(a.startTime,c.endTime),onNavigate:()=>V(a.startTime,{openScript:!0})}))}))}else{const n=t.paragraph.words[t.start],r=t.paragraph.words[t.end-1];e.push(Nt.createElement(sce,{key:n.startTime,paragraph:t.paragraph,resultStart:t.start,resultEnd:t.end,onClick:()=>z(n.startTime,r.endTime),onNavigate:()=>V(n.startTime,{openScript:!0})}))}}))}else if(b)for(const t of n.content)if("words"in t){ace(t.words,b).forEach((({startIndex:n,words:r})=>{if(0===r.length)return;const o=t.words[rce(n)],i=t.words[oce(n)]||t.words[t.words.length-1];e.push(Nt.createElement(sce,{key:r[0].startTime,paragraph:t,resultStart:n,search:r,onClick:()=>z(o.startTime,i.endTime),onNavigate:()=>V(o.startTime,{openScript:!0})}))}))}R(e)}),[z,b,n?.content,o,C,U,n?.duration,M,V]);const G=Pr((e=>{const t=window.getSelection(),n=t&&t.rangeCount>0?t?.getRangeAt(0):void 0,r=Br(e.target)?e.target:void 0,o=r?.getAttribute("data-paragraph")&&r.parentElement?.nextSibling&&Br(r.parentElement.nextSibling.firstChild)&&r.parentElement.nextSibling.firstChild.getAttribute("data-start-time")||r?.getAttribute("data-start-time")||r?.parentElement?.getAttribute("data-start-time")||n?.startContainer.parentElement?.getAttribute("data-start-time")||Br(n?.startContainer)&&n?.startContainer.nextElementSibling?.getAttribute("data-start-time");if("string"===typeof o){const t=Number(o);lce(t),n||V(t,{play:!0===e.altKey})}const i=r?.parentElement?.getAttribute("data-annotation-id");i&&d(i)}));let W;W=b||C?A.length>0||C?A:Nt.createElement("div",{className:"p-3 stack gap-2"},Nt.createElement(Zo,{rounded:!0,className:"bg-grey-50-a"},Nt.createElement(iie,null)),Nt.createElement(o0,{className:"px-2",variant:"label-1-regular"},"Search term is not present in script!")):p?Nt.createElement("div",{className:"EmbeddedScript-module--lJtJOC"},Nt.createElement(yie,{publishState:m?.state})):Nt.createElement(rae,{scrollerRef:O.current,annotations:c,name:f||m?.name,doc:n,onClick:G,ref:S,isEmbeddedScript:!0});const[H,q]=Nt.useState(!1);return Nt.createElement("div",{id:"MainContentScrollpane",className:yo()("EmbeddedScript-module--OMSNVn",l,{"EmbeddedScript-module--aW96wJ":"audio"===m?.publish_type,"EmbeddedScript-module--nL0jg6":e,"EmbeddedScript-module--QxabuJ":r,"EmbeddedScript-module--na746A":dce}),...E},m&&Nt.createElement(Yae,{scrollContainerRef:O,commentsEnabled:Boolean(m?.comments_enabled&&!I),draftAnnotation:g,project:m}),Nt.createElement("div",{className:"EmbeddedScript-module--XcdXCc"},Nt.createElement("div",{className:yo()(H&&"elevation-1")},Nt.createElement(wse,{currentHighlighter:C,currentHighlighterSet:_,searchValue:b,searchValueSet:T,usedHighlighters:B,control:h})),Nt.createElement(h2,{className:"flex-1",fullHeight:!0},Nt.createElement(v2,{ref:O,"data-testid":"script-container",onScroll:e=>{Br(e.target)&&q(e.target.scrollTop>0),x||s?.()}},W),Nt.createElement(b2,null)),u))})),fce=Nt.memo(uce),mce=Nt.memo((function({autoScroll:e,toggleAutoScroll:t,project:n,showHelpButton:r}){return Nt.createElement(e0,{className:"justify-between"},Nt.createElement(vie,{autoScroll:e,toggleAutoScroll:t}),r&&n&&Nt.createElement(tce,{project:n}))}));var pce="PublishedVideoPlayerOverlay-module--6_YSTG",gce="PublishedVideoPlayerOverlay-module--e6q3rR",hce="PublishedVideoPlayerOverlay-module--AXT3Oc",vce=n(2720),Ece=n(46079);const yce=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"user"})));var Sce="Avatar-module--rckTMj",Ice="Avatar-module--nfMR9n";function bce({color:e,strokeColor:t,hasNotification:n=!1,size:r,fontSize:o,fontWeight:i,fontColor:a,className:s,style:c,profileImage:d,profileImageHasBorder:l,rounded:u=!0,...f},m){const p=Nt.useContext(bo);let g=_r;return g="initials"in f&&f.initials?Nt.createElement(o0,{variant:"badge",className:"text-grey-800"},f.initials):"name"in f&&"string"===typeof f.name?Nt.createElement(o0,{variant:"badge",className:"text-grey-800"},f.name[0]):Nt.createElement(yce,{className:"w-3 text-grey-800"}),Nt.createElement(Ece.fC,{ref:m,...Ee(f,"name","initials"),className:yo()("Avatar-module--A9azCI",s,{"Avatar-module--HoeTVv":u}),style:{"--avatar-size":r?`${r}px`:void 0,"--avatar-border-color":t,"--avatar-background-color":e,"--avatar-font-color":a,"--avatar-font-weight":i,"--avatar-font-size":o,...c}},Nt.isValidElement(d)?Nt.createElement("span",{className:yo()(Ice,"flex-center",l&&"border border-grey-100-a"),style:{backgroundColor:e}},d):Nt.createElement(Nt.Fragment,null,Nt.createElement(Ece.Ee,{src:d,alt:"name"in f?f.name:"",className:Ice}),Nt.createElement(Ece.NY,{delayMs:d?600:0,asChild:!0},p?Nt.createElement("div",{className:Sce},g," "):Nt.createElement(Nt.Fragment,null,Nt.createElement("svg",{viewBox:"0 0 40 40",preserveAspectRatio:"xMinYMid meet",xmlns:"http://www.w3.org/2000/svg",className:Sce},Nt.createElement("text",{x:"20",y:"20",dy:"0.35em",textAnchor:"middle",fontFamily:"sans-serif"},"initials"in f?f.initials:""))))),n&&Nt.createElement(qo,{className:"Avatar-module--ZLISqH"}))}const Tce=(0,Nt.memo)((0,Nt.forwardRef)(bce)),wce=Nt.memo(Nt.forwardRef((function({className:e,children:t,...n},r){return Nt.createElement("button",{ref:r,type:"button",...n,className:yo()("Avatar-module--b95IWt","flex relative")},t,Nt.createElement("div",{className:yo()("Avatar-module--DE9UVe","absolute inset-0 m-1 rounded-full")}))})));function Cce({className:e,project:t}){const n=(0,Nt.useMemo)((()=>function({published_by:e}){return[e.first_name,e.last_name].join(" ")}(t)),[t]),r=(0,Nt.useMemo)((()=>new bl(t.published_by.id).color(!1,!0)),[t]),o=(0,Nt.useMemo)((()=>(0,vce.Z)(new Date(t.created_at),"MMMM d, yyyy")),[t.created_at]),i=n[0];return Nt.createElement("div",{className:yo()("AuthorDetails-module--gMF8g1",e)},i&&Nt.createElement(Tce,{profileImage:t.published_by.profile_image_cdn_url,initials:i,name:n,size:32,color:r,className:"AuthorDetails-module--NWZP7Q",strokeColor:""}),Nt.createElement("div",{className:"AuthorDetails-module--tqhQzr"},n.length>0&&Nt.createElement(Nt.Fragment,null,"By ",Nt.createElement("span",{className:"AuthorDetails-module--FzUsjU"},n)),Nt.createElement("div",{className:"AuthorDetails-module--fbo9FN"},o)))}const _ce="share-url";function Ace(){const e=document.getElementById(_ce);if(e){const t=document.createRange(),n=window.getSelection();t.selectNode(e),n?.removeAllRanges(),n?.addRange(t)}}const Rce=Nt.memo((function({sharePageUrl:e,onCloseOverlay:t,className:n}){const r=Nt.useContext($te).current?.currentTime??0,[o,i]=(0,Nt.useState)(!1),a=$ae(),s=wd(r),c=(0,Nt.useCallback)((e=>{Fr(e),t()}),[t]);(0,Nt.useEffect)(Ace,[]);const d=(0,Nt.useCallback)((e=>{e.stopPropagation(),Ace()}),[]),l=o?s8(e,r):e;return Nt.createElement("div",{className:yo()(n,"PublishedVideoPlayerOverlay-module--NEdDDM"),onClick:c},Nt.createElement("div",{className:yo()("PublishedVideoPlayerOverlay-module--piJlpi","stack")},Nt.createElement("div",{className:"PublishedVideoPlayerOverlay-module--Jdd0XX"},"Share:"),Nt.createElement("button",{type:"button",id:_ce,className:"PublishedVideoPlayerOverlay-module--HUkRJt",onClick:d},Nt.createElement(o0,{variant:"body-2-regular",ellipsisOverflow:!0},l)),Nt.createElement("div",{className:"PublishedVideoPlayerOverlay-module--YMs4lK",onClick:Fr},Nt.createElement(Soe,{checked:o,onCheckedChange:i,className:"PublishedVideoPlayerOverlay-module--OFvdne","data-testid":"start-at-time-checkbox"},`Start at ${s}`),Nt.createElement(W0,{type:"button",variant:"inspector",onClick:e=>{K2()(l),a({actionOrRoute:{type:"route",path:l},id:"share-toast",style:qee.Default,actionMessage:"Open in browser",dismissible:!0,dismissAfter:3,message:"Link copied to clipboard"+(o?` starting at ${s}`:"")})}},"Copy link"))),Nt.createElement(ei,{className:gce,title:"Close",placement:"bottom",align:"end"},Nt.createElement("button",{type:"button","aria-label":"Close",className:pce,onClick:c},Nt.createElement(G1,null))))})),Mce=Nt.memo((function({sharePageUrl:e,pageName:t,className:n,onClick:r}){const o=(0,Nt.useCallback)((n=>{Fr(n),K2()(e),"undefined"!==typeof navigator&&navigator.share&&(V()||z())?navigator.share({title:t,url:e}):r()}),[e,r,t]);return Nt.createElement(ei,{className:gce,title:"Share",placement:"bottom"},Nt.createElement("button",{type:"button","aria-label":"Share URL",className:yo()(n,pce),onClick:o},Nt.createElement(L1,null)))})),Dce=Nt.memo((function({pageName:e,project:t,controls:n,controlSpacer:r,showingShareOverlay:o,showShareOverlay:i,hideShareOverlay:a}){const s=(0,Nt.useContext)($te),{isEmbedded:c}=(0,Nt.useContext)(lie),d=i$(t?.url_slug),l=void 0!==e?e:"Project unavailable",u=Pr((e=>{e.preventDefault(),e.stopPropagation(),s.current&&!s.current.paused&&s.current.pause();const t=s.current?.currentTime;window.open(t?`${d}?t=${t}&autoplay=1`:d,"_blank")}));return o?Nt.createElement(Rce,{onCloseOverlay:a,sharePageUrl:d}):Nt.createElement("div",{className:"PublishedVideoPlayerOverlay-module--GFmbGg"},Nt.createElement("div",{className:"PublishedVideoPlayerOverlay-module--Hw9WDl"},"audiogram"!==t?.publish_type&&Nt.createElement(Nt.Fragment,null,c&&t?.allow_embedded_sharing?Nt.createElement("a",{className:yo()(hce,"PublishedVideoPlayerOverlay-module--FBPWvl"),href:d,onClick:Fr,target:"_blank",rel:"noopener noreferrer"},l):Nt.createElement("div",{className:hce},l),t&&!1!==t.display_author&&Nt.createElement(Cce,{project:t,className:"PublishedVideoPlayerOverlay-module--r3EPjy"}))),Nt.createElement("div",{className:"PublishedVideoPlayerOverlay-module--wpb3gj"},c&&t?.allow_embedded_sharing&&Nt.createElement(Nt.Fragment,null,Nt.createElement(Mce,{pageName:e,sharePageUrl:d,onClick:i}),Nt.createElement(ei,{className:gce,title:"Open in new tab",placement:"bottom"},Nt.createElement("a",{type:"button",className:pce,href:d,target:"_blank",rel:"noopener noreferrer",onClick:u},Nt.createElement(Go,null)))),n,r&&Nt.createElement("div",{className:"PublishedVideoPlayerOverlay-module--hqzmVP"})))}));function Oce({play:e,pause:t,setVolume:r,setMuted:o,seekTo:i,mediaRef:a}){(0,Nt.useEffect)((()=>{const s=async function(){if(!a||"undefined"===typeof window)return;const s=new((await n.e(149).then(n.t.bind(n,12149,23))).default.Receiver),c=[["canplay",()=>s.ready(),{once:!0}],["playing",()=>s.emit("play")],["pause",()=>s.emit("pause")],["ended",()=>s.emit("ended")],["timeupdate",()=>{s.emit("timeupdate",{seconds:a.currentTime,duration:a.duration})}]];return c.forEach((([e,t])=>{a.addEventListener(e,t)})),[["play",e],["pause",()=>t],["getPaused",e=>e(a.paused)],["mute",()=>o(!0)],["unmute",()=>o(!1)],["getMuted",e=>e(a.muted)],["setVolume",e=>r(e/100)],["getVolume",e=>e(100*a.volume)],["getDuration",e=>e(a.duration)],["setCurrentTime",i],["getCurrentTime",e=>e(a.currentTime)],["getLoop",e=>e(a.loop)],["setLoop",e=>a.loop=e]].forEach((([e,t])=>{s.on(e,t)})),()=>{c.forEach((([e,t])=>{a.removeEventListener(e,t)}))}}();return()=>{s.then((e=>e?.()))}}),[e,t,a,r,o,i])}function xce({loadingToastText:e,pauseAnimation:t}){return Nt.createElement("div",{className:"PublishedPageMediaPlayer-module--CVbbzA"},e,!t&&Nt.createElement(Dte,null))}function kce({hidden:e,duration:t}){const n=Kte();return Nt.createElement(o0,{variant:"label-1-regular",className:yo()("tabular-nums flex-0-auto","PublishedVideoPlayer-module--kBtZvJ",{hidden:e})},Nt.createElement("span",{"data-testid":"current-time"},$7(n,{minutePadding:1}))," ","/ ",$7(t,{minutePadding:1}))}const Nce=Nt.memo((function({wrapperRef:e,isFullScreen:t,setIsFullScreen:n,isPlaying:r,seekTo:o,duration:i,className:a,children:s,controlButtonChildren:c,disableKeyboardShortcuts:d,scrubberBar:l,project:u,pause:f,play:m,playbackRate:p,setPlaybackRate:g,isMobile:h,isProcessing:v,loadingToastText:E,pauseAnimation:y,canShowTranscript:S,poster:I,onPlay:b,onPause:T,onTimeUpdate:w,onCanPlay:C,trackMediaLoadStarted:_,trackMediaLoaded:A,trackMediaError:R,trackMediaStalled:M,trackMediaWaiting:D,scriptShowing:O,onShowScript:x,setAutoScroll:k}){const N=Nt.useContext($te),{isEmbedded:P}=(0,Nt.useContext)(lie),[L,F]=(0,Nt.useState)(!1),{name:U}=u||{},B=(0,Nt.useRef)(0),[j,z,G]=Nr(!1),[W,H]=qte(N),[q,$]=Hte(N),[K,Y]=(0,Nt.useState)(!1),[Z,J,Q]=Nr(),X=(0,Nt.useRef)(_r),[ee,te,ne]=Nr(!1),re=(0,Nt.useRef)(),oe=(0,Nt.useCallback)((()=>{h||(re.current=setTimeout(te,3e3))}),[te,h]),ie=(0,Nt.useCallback)((()=>{ne(),re.current&&clearTimeout(re.current),r&&oe()}),[ne,oe,r]),ae=Pr((e=>{r||k(!0),r?f():m(),Y(e?.currentTarget!==X.current),ee?ne():oe(),!1===L&&u?.url_slug&&(F(!0),E5(vt(),u.url_slug))}));(0,Nt.useEffect)((()=>{K&&J()}),[r,K,J]);const se="undefined"!==typeof window,ce=(0,Nt.useMemo)((()=>{if(!se||!P)return!0;const{hideCta:e}=(0,aZ.parse)(location.search);return!e||"1"!==e}),[se,P]),de=Kte(),le=Math.abs(de-i)<.1;$r(le&&!r)&&(le&&!r?z():G());const ue=(0,Nt.useMemo)((()=>{if(!se||!P)return!1;const{controlSpacer:e}=(0,aZ.parse)(location.search);return"1"===e}),[se,P]),[fe,me,pe]=Nr(),[ge,he]=one(),[ve,Ee]=(0,Nt.useState)(!1),ye=u?.contents.subtitles?.cdn_url||u?.contents.subtitles?.url;(0,Nt.useEffect)((()=>{e.current&&Ee(e.current.clientWidth<420)}),[e]);const[Se,Ie]=(0,Nt.useState)(!1),be=(0,Nt.useCallback)((e=>Ie(e)),[]),Te=r?"Pause":"Play",we="Subtitles (c)",Ce=ce&&j;lne({duration:i,seekTo:o,setVolume:$,togglePlayback:ae,disabled:d});const[_e,Ae]=(0,Nt.useState)("");(0,Nt.useEffect)((()=>{if(!N.current)return;const{current:e}=N,t=Array.from(N.current.textTracks),n=V()||"undefined"!==typeof navigator&&navigator.userAgent.indexOf("iPad")>-1;let r,o;for(let a=0;a<t.length;a++)if("subtitles"===t[a].id){t[a].mode=ge?n?"showing":"hidden":"disabled",r=t[a];break}if(r&&!n)return ge&&(o=requestAnimationFrame(i),e.addEventListener("cuechange",i,{once:!0})),e.addEventListener("timeupdate",i),()=>{e.removeEventListener("timeupdate",i),e.removeEventListener("cuechange",i),o&&cancelAnimationFrame(o)};function i(){if(!r)return;const t=[];if(r.cues){for(let n=0;n<r.cues.length;++n)r.cues[n].startTime<=e.currentTime&&r.cues[n].endTime>=e.currentTime&&t.push(r.cues[n]);t.length>0&&Ae(t[0].text)}}}),[ge,N]),zr({keyCode:Vr.C,onPress:he,disabledInInput:!0});const Re=I&&("audio"===u?.publish_type||!L);Oce({play:m,pause:f,setVolume:$,setMuted:H,seekTo:o,mediaRef:N.current}),(0,Nt.useLayoutEffect)((()=>{const e=d8();e&&o(e.start)}),[o,u?.created_at,P]);const Me=Pr((()=>{F(!0)}));return Nt.createElement("div",{className:yo()("PublishedVideoPlayer-module--Q6ZBBL",a,{"PublishedVideoPlayer-module--Jceo5e":ee,"PublishedVideoPlayer-module--kBshoT":t}),onMouseLeave:ne,onMouseMove:ie,"data-fullscreen":t,"data-testid":"media-player"},!L&&Nt.createElement("div",{className:yo()(ine,"PublishedVideoPlayer-module--DvlHmd")},Nt.createElement("div",{className:"rounded-full h-8 w-8 flex-center",style:{background:"var(--grey-0-base)",color:"var(--grey-800-base)"}},Nt.createElement(cne,null))),Nt.createElement("div",{className:yo()("PublishedVideoPlayer-module--vkTHwY",ine,{"PublishedVideoPlayer-module--knXY4F":Z}),onAnimationEnd:Q},r?Nt.createElement(cne,null):Nt.createElement(sne,null)),Nt.createElement("div",{"data-vjs-player":!0,className:"h-full w-full relative"},Nt.createElement("video",{onPlay:b,onTimeUpdate:w,onCanPlay:C,className:"",id:"share-page-video-player",ref:N,crossOrigin:"anonymous",playsInline:!0,preload:"metadata",onPause:e=>{T?.(e),N.current&&N.current.currentTime<N.current.duration||(N.current?.loop?(o(0),requestAnimationFrame(m)):rt("share_player_media_completed",{media_type:u?.publish_type,context:Wte(),playback_rate:p}))},onPlaying:Me,onLoadStart:_,onLoadedData:A,onError:R,onStalled:M,onWaiting:D},Nt.createElement("track",{src:ye,id:"subtitles",kind:"subtitles",label:"English",srcLang:"en"})),Re&&Nt.createElement("div",{className:"PublishedVideoPlayer-module--rWCVcv"},Nt.createElement("img",{src:I,alt:""})),_e&&ge&&Nt.createElement("div",{className:"PublishedVideoPlayer-module--xOcPIO"},Nt.createElement("div",{className:"PublishedVideoPlayer-module--Ul8L9t","data-testid":"subtitles"},_e))),s,Nt.createElement("div",{className:yo()("PublishedVideoPlayer-module--HViXma",{"PublishedVideoPlayer-module--HMZevk":V(),"PublishedVideoPlayer-module--xY3dAi":!r,"PublishedVideoPlayer-module--Mx39dH":fe,"PublishedVideoPlayer-module--mkPl66":Ce||ee}),onClick:ae,onDoubleClick:()=>{kte().isEnabled&&e.current&&B.current>=2&&kte().toggle(e.current)}},v&&Nt.createElement("div",{className:yo()("PublishedVideoPlayer-module--mcaLV1","-z-1",{"PublishedVideoPlayer-module--dztIa8":"success"===u?.state}),style:{backgroundImage:I?`url('${I}')`:void 0}},Nt.createElement("div",{className:"h-full w-full flex-center"},Nt.createElement("div",{className:"stack items-center"},Nt.createElement(Zo,null,Nt.createElement(u0,{color:"var(--dark-grey-400-base)"})),P&&Nt.createElement(o0,{variant:"label-2-medium",className:"p-2",style:{color:"var(--dark-grey-800-base)"}},"Processing...")))),Nt.createElement("div",{className:"PublishedVideoPlayer-module--CisluE",onClick:()=>B.current+=1},Nt.createElement(Dce,{pageName:U,project:u,showingShareOverlay:fe,showShareOverlay:me,hideShareOverlay:pe,controls:!O&&S&&Nt.createElement(ei,{title:"Show Transcript",placement:"bottom"},Nt.createElement("button",{type:"button",className:"PublishedVideoPlayer-module--vKr_2m","data-testid":"transcript-toggle",onClick:e=>{x(),e.stopPropagation()}},Nt.createElement(tne,{style:{color:"var(--grey-800-base)"}}))),controlSpacer:ue})),v&&E&&Nt.createElement(xce,{loadingToastText:E,pauseAnimation:y}),Nt.createElement("div",{className:"PublishedVideoPlayer-module--jHhBtA",onDoubleClick:Fr,onClick:Fr},l,Nt.createElement("div",{className:"PublishedVideoPlayer-module--tJj2RL",onClickCapture:e=>{B.current=0}},Nt.createElement("div",{className:yo()("PublishedVideoPlayer-module--adXu6W","flex-0-auto")},Nt.createElement("div",{className:ane},Nt.createElement(ei,{title:Te},Nt.createElement(Pte,{"aria-label":Te,ref:X,onClick:ae},r?Nt.createElement(sne,null):Nt.createElement(cne,null))),!V()&&Nt.createElement(dne,{volume:q,setVolume:$,isMuted:W,setMuted:H,isVideoPlayer:!0,onSliderVisibilityChange:be})),Nt.createElement(kce,{hidden:ve&&Se,duration:i})),Nt.createElement("div",{className:ane},Nt.createElement(rie,{type:u?.publish_type,playbackRate:p,setPlaybackRate:g,isVideoPlayer:!0}),c,"audiogram"!==u?.publish_type&&ye&&Nt.createElement(ei,{title:we},Nt.createElement(Pte,{"aria-label":we,"aria-pressed":ge,className:yo()(ge&&"PublishedVideoPlayer-module--IICnEh"),onClick:he},Nt.createElement(nne,null),Nt.createElement("span",{className:"PublishedVideoPlayer-module--Don4hT"}))),Nt.createElement(jte,{isFullScreen:t,setIsFullScreen:n,pause:f}))))),Ce&&Nt.createElement(fne,{project:u,onExit:G,onWatchAgain:()=>{o(0),G(),m()}}))})),Pce=Nt.memo((function(e){const{setActiveAnnotation:t,annotations:n,draftAnnotation:r,seekTo:o,...i}=e,{project:a,doc:s,isDocumentProcessing:c,isFullScreen:d,isPlaying:l,pause:u,play:f}=i,m=s?.content&&s.content.length>0||c,{isEmbedded:p,showTranscript:g}=(0,Nt.useContext)(lie),[h,v]=(0,Nt.useState)(!0),[E,y,S,I]=one(!0),b=a?.transcript_enabled&&m,[T,w,C,_]=Nr(!!b&&(!!m&&function(e,t){return(!e||!0===t)&&(t??!0)}(p,"boolean"===typeof g?g:function(){if("undefined"===typeof document)return;const{transcript:e}=(0,aZ.parse)(location.search);return"true"===e||"false"!==e&&void 0}()))),A=Pr((e=>{if(p)return;const t=function(e,t){const n=new URL(e);return t?n.searchParams.set("transcript","true"):n.searchParams.delete("transcript"),n.toString()}(window.location.href,e);window.history.replaceState(void 0,"",t)})),R=Pr((()=>{w(),A(!0)})),M=Pr((()=>{v(!1),C?.()})),D=Nt.useCallback((e=>{o(e),I(!0)}),[o,I]),[O,x]=(0,Nt.useState)(!1),k=(0,Nt.useRef)(_r),N=(0,Nt.useRef)(_r);(0,Nt.useEffect)((()=>{if(!z())return;document.querySelector("meta[name=viewport]")?.setAttribute("content","height="+window.innerHeight+", width="+window.innerWidth+", initial-scale=1.0, shrink-to-fit=no, maximum-scale=1")}),[]);const[P,L]=(0,Nt.useState)(!1);(0,Nt.useEffect)((()=>{L(!0),window.innerWidth<=500&&C()}),[C,g]),$r(a?.transcript_enabled)&&(a?.transcript_enabled?m&&w():C());const[F,U]=(0,Nt.useState)("vertical");(0,Nt.useEffect)((()=>{function e(){return p?document.body.clientWidth<1e3&&document.body.clientHeight>=document.body.clientWidth?"vertical":"horizontal":document.body.clientWidth<1200?"vertical":"horizontal"}function t(){U(e())}return U(e()),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[p]);const B=(0,Nt.useRef)(_r);return(0,Nt.useEffect)((()=>{function e(){T?B.current?.expand():B.current?.collapse()}return(0,Kr.W)(e),()=>{Kr.W.cancel(e)}}),[T]),Nt.createElement(Ao.Provider,{value:d?N:void 0},Nt.createElement("div",{ref:k,className:yo()("PublishedVideoPlayer-module--goWxHl","w-full h-full",{"PublishedVideoPlayer-module--ynFv_G":P,"PublishedVideoPlayer-module--OIsESI":p,"PublishedVideoPlayer-module--n4PmzM":b&&T})},Nt.createElement(Xte.eh,{direction:F,autoSaveId:p||!b?void 0:"published-player",id:"published-player-resizer"},Nt.createElement(Xte.s_,null,Nt.createElement(Nce,{...i,seekTo:D,wrapperRef:k,scriptShowing:T,canShowTranscript:b,onShowScript:R,setAutoScroll:I})),Nt.createElement(ene,{className:yo()("border-l border-grey-100-a",!b&&"hidden"),onDragging:x}),Nt.createElement(Xte.s_,{ref:B,className:"PublishedVideoPlayer-module--M6aO9R",collapsible:!0,minSize:p?30:20,defaultSize:T&&b?30:0,maxSize:80,onCollapse:e=>_(!e),style:{visibility:T&&b?"visible":"hidden"}},Nt.createElement(fce,{doc:s,visible:T,draftAnnotation:r,project:a,annotations:n,setActiveAnnotation:t,isPlaying:l,seekTo:D,play:f,pause:u,autoScroll:E,onScroll:()=>{O||S()},isProcessing:c,isHidden:!T,headerControl:Nt.createElement(ei,{title:"Hide Transcript",placement:"bottom",enabled:h},Nt.createElement(Yo,{onClick:()=>{M(),A(!1)},onMouseOver:()=>v(!0),"data-testid":"transcript-toggle"},Nt.createElement(rne,null)))},Nt.createElement(mce,{project:a,autoScroll:E,toggleAutoScroll:y,showHelpButton:!p})))),Nt.createElement(Ro,{ref:N})))})),Lce=Pce;var Fce=n(83265);const Uce="CALLOUT_OPEN";function Bce({open:e,onOpenChange:t,defaultOpen:n=!1,children:r,className:o,...i}){const[a,s]=(0,Ene.T)({prop:e,defaultProp:n,onChange:t}),c=Pr((e=>{s(e)})),d=(0,Nt.useRef)(),l=Pr((()=>{d.current&&clearTimeout(d.current),document.dispatchEvent(new CustomEvent(Uce)),c(!0)})),u=Pr((()=>{c(!1)})),f=Pr((()=>{d.current=setTimeout(u,100)})),m=(0,Nt.useRef)(_r);return Nt.useEffect((()=>(document.addEventListener(Uce,u),()=>document.removeEventListener(Uce,u))),[u]),Nt.createElement("div",{...i,className:yo()("flex",o),ref:m,onMouseEnter:(0,wo.M)(i.onMouseEnter,l),onMouseLeave:(0,wo.M)(i.onMouseLeave,f)},Nt.createElement(Fce.fC,{open:a,onOpenChange:c},r))}Fce.ee;const jce=Nt.forwardRef((function({className:e,...t},n){const r=(0,Nt.useRef)(_r),o=(0,s2.e)(n,r);return Nt.createElement(Fce.xz,{ref:o,tabIndex:0,className:yo()("button-focus rounded-sm",e),...t})})),Vce=Nt.forwardRef((function({className:e,side:t="top",children:n,...r},o){const i=vo();return Nt.createElement(Fce.h_,null,Nt.createElement(roe,null,Nt.createElement(Fce.VY,{ref:o,side:t,"data-redesign":!0,className:yo()("rounded-sm bg-grey-0 border border-grey-100-a text-grey-800 elevation-1 label-2-regular","portal-layer","Callout-module--yqHqz6"),...r,onOpenAutoFocus:(0,wo.M)(r.onOpenAutoFocus,i?void 0:Lr),onCloseAutoFocus:(0,wo.M)(r.onCloseAutoFocus,i?void 0:Lr)},Nt.createElement("div",{className:yo()("h-full w-full",e)},n))))}));var zce=n(31132);function Gce(e){const t=Math.floor((Date.now()-e.valueOf())/1e3);let n,r,o=Math.floor(t/31536e3);if(o>=1)n="y",r="year";else if(o=Math.floor(t/2592e3),o>=1)n="m",r="month";else if(o=Math.floor(t/86400),o>=1)n="d",r="day";else if(o=Math.floor(t/3600),o>=1)n="h",r="hour";else{if(o=Math.floor(t/60),!(o>=1))return Nt.createElement("span",null,"just now");n="min",r="minute"}return Nt.createElement("span",{"aria-label":`${o} ${1===o?r:`${r}s`} ago`},Nt.createElement("span",{"aria-hidden":!0},`${o}${n}`))}function Wce({href:e,children:t,className:n,...r}){let o,i="";if(Nt.Children.map(t,(e=>{"string"===typeof e&&(i+=e)})),void 0===e)return Nt.createElement("span",null,t);o=e,ae(o)&&(o=`mailto:${o}`);const a=o.startsWith("mailto:");return a||o.startsWith("http")||o.startsWith(":")||(o="http://"+o),Nt.createElement("a",{...r,href:o,className:yo()(n,{"LinkRenderer-module--cbRhRX":a&&i.startsWith("+")})},t)}const Hce={overrides:{a:function(e){return Nt.createElement(Wce,{target:"_blank",...e})},p:function({className:e,...t}){return Nt.createElement("p",{className:yo()("ScrubberAnnotation-module--CqnCW6",e),...t})}}};function qce({annotation:e,timeOffset:t,author:n,currentUser:r,className:o,onOpenAnnotation:i,replies:a=0,...s}){return Nt.createElement("div",{className:yo()("stack gap-2 py-2",o),...s},Nt.createElement(e0,null,Nt.createElement(Tce,{profileImage:e.user.profileImageCdnUrl,initials:e.user.initials,name:e.user.name,color:n.color(n.id===r?.id,!0)}),Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800 px-2"},e.user.name),Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-400 px-2"},Gce(e.createdAt))),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},Nt.createElement("div",{className:"ScrubberAnnotation-module--kRapcv"},Nt.createElement(zce.Z,{options:Hce},`${void 0!==t?`**@${wd(t)}** `:""}${e.text}\n`)))),Nt.createElement(e0,{className:"justify-end"},Nt.createElement(W0,{variant:"black",onClick:i},a?`View ${a} replies\u2026`:"Reply")))}function $ce({annotation:e,duration:t,currentUser:n,annotationTimeOffsets:r,onHide:o,activeAnnotation:i,replies:a,onOpenAnnotation:s,...c}){const[d,l]=(0,Nt.useState)(!1);if(e.isNew)return _r;const{user:u}=e,f=e.segmentTimeOffset/t;return Nt.createElement(Bce,{open:d||(i?e.id===i:void 0)},Nt.createElement(jce,{className:"absolute flex",style:{left:100*f+"%"},asChild:!0,"data-scrubber-annotation-trigger":!0},Nt.createElement("div",{...c,onMouseEnter:e=>{l(!0),c.onMouseEnter?.(e)},onMouseLeave:e=>{l(!1),c.onMouseLeave?.(e)}},Nt.createElement(Tce,{size:18,className:"p-0","aria-label":"Comment",initials:u.initials,name:u.name,color:bl.ColorForUserId(u.id,!0),profileImage:u.profileImageCdnUrl}))),Nt.createElement(Vce,{"data-scrubber-annotation-content":!0,side:"top",sideOffset:10,className:"max-w-xs p-2"},Nt.createElement(qce,{author:u,currentUser:n,annotation:e,replies:a,timeOffset:r.get(e.id),onMouseEnter:c.onMouseEnter,onMouseLeave:c.onMouseLeave,onOpenAnnotation:s})))}function Kce({annotations:e=[],isMobile:t,setSelectedAnnotation:n,clearHoverAnnotation:r,openAnnotation:o,duration:i,currentUser:a,activeAnnotation:s,annotationTimeOffsets:c,comments:d}){const l=(0,Nt.useRef)();if(t||!e.length)return _r;const u=e.sort(((e,t)=>e.segmentTimeOffset-t.segmentTimeOffset));function f(){l.current&&clearTimeout(l.current)}return Nt.createElement(Nt.Fragment,null,u.map((e=>Nt.createElement($ce,{key:e.id,annotation:e,duration:i,currentUser:a,annotationTimeOffsets:c,onClick:()=>n(e.id),onMouseEnter:()=>{f()},onMouseLeave:()=>{var t;f(),t=e.id,l.current=setTimeout((()=>{s===t&&r?.()}),300)},onHide:r,activeAnnotation:s,replies:d?.[e.id]?.length,onOpenAnnotation:()=>o(e.id,e.segmentTimeOffset)}))))}var Yce=n(48430),Zce=n.n(Yce),Jce=n(11054),Qce=n(84792),Xce=n(48654),ede=n(43934),tde=n(4363),nde=n(13191),rde=n(30640),ode=n(44138),ide=n(8016),ade=n(12466),sde=n(42588),cde=n(27529),dde=n(26043);var lde=n(34838);const[ude,fde]=(0,Qr.k)("ScriptCardRail"),[mde,pde]=(0,Qr.k)("ListProps"),gde=Nt.forwardRef((function(e,t){const{listProps:n,listRef:r}=pde("VirtualList"),o=(0,s2.e)(t,r);return Nt.createElement("ul",{ref:o,...(0,rde.dG)(e,n,{className:"my-1 h-full"})})}));function hde({customScrollParent:e}){const{virtualizerState:t}=fde("ListBox.Sizer"),n=Nt.useRef(e);return n.current=e,no({ref:n,minimumMsPerTick:500,onResize:e=>{if(!t)return;const n=new ide.UL(0,0,e.contentRect.width,e.contentRect.height);t.setVisibleRect(n)}}),_r}function vde({estimatedRowHeight:e,listPadding:t=16,isVirtualized:n=!1,overscan:r=2,loadingPlaceholder:o,endReached:i,rangeChanged:a,customScrollParent:s,virtualListRef:c,listGap:d,state:l,domRef:u,itemContent:f,components:m,...p}){const g=u||Nt.useRef(_r),h=l||(0,ade.n_)(p),v=(0,rde.Me)(),E=(0,sde.x)({collection:h.collection,selectionManager:h.selectionManager,onDrop:_e,acceptedDragTypes:[v],getDropOperation:e=>"item"===e.type&&"on"===e.dropPosition?"cancel":"move",...p}),y=(0,sde.h)({collection:h.collection,selectionManager:h.selectionManager,getAllowedDropOperations:()=>["move"],getItems:p.getItems||(e=>[...e].map((e=>{const t=h.collection.getItem(e);return{[v]:String(t?.key||"unknown")}})))});(0,Wr.Xu)({},y,g);const S=(0,cde.Xe)({usage:"search",sensitivity:"base"}),I=Nt.useMemo((()=>new dde.P({padding:t,collator:S})),[t,S]),b=(0,ide.FC)({layout:I,collection:h.collection,renderView:()=>Nt.createElement("div",null),renderWrapper:()=>Nt.createElement("div",null),onVisibleRectChange:_e});n&&(I.virtualizer=b.virtualizer);const{collectionProps:T}=(0,Wr.zw)({keyboardDelegate:I,dropTargetDelegate:n?I:new Wr.hO(h.collection,g,{orientation:"vertical",layout:"stack",direction:"ltr"}),...p},E,g);I.collection=h.collection;const{listBoxProps:w}=(0,ode.co)({selectionMode:"single",keyboardDelegate:I,isVirtualized:n,shouldFocusWrap:!0,...p},h,g),C={...(0,rde.dG)(w,p.onReorder?T:{},{className:`stack gap-${d||0}`})},_=Nt.useRef(void 0),A=Pr((e=>{if(!D.current)return;const t=_.current;_.current=e;const n=h.collection.getItem(e),r=t?h.collection.getItem(t):_r;n&&function(e,t,n,r){const o=document.querySelector(`[data-key="${e.key}"]`);if(!e||"number"!==typeof e.index)return;let i="start",a=0;if(o){const e=(r||document.querySelector("body")).getBoundingClientRect(),t=o.getBoundingClientRect(),n=t.top-8,s=t.bottom+8;if(n>=e.top&&s<=e.bottom&&t.left>=e.left&&t.right<=e.right)return;n>=e.top&&s>=e.bottom?(i="end",a=4):n<=e.top&&s<=e.bottom&&(i="start",a=-4)}else if(t){const n=t?.index;"number"===typeof n&&(n<e.index?(i="end",a=4):(i="start",a=-4))}n({index:e.index,offset:a,align:i})}(n,r,D.current.scrollToIndex,s)})),R=Pr((()=>{const e=h.selectionManager.focusedKey;A(e);document.querySelector(`[data-key="${e}"]`)?.focus()}));Nt.useEffect(R,[R,h.selectionManager.focusedKey]);const M=(0,lde.pu)(g),D=Nt.useRef(_r);Nt.useImperativeHandle(c,(()=>{if(!D.current)throw new Error("Virtuoso ref not set");return{...D.current,scrollToKey:A}}));const O=n?Nt.createElement(mde,{listProps:(0,rde.dG)(C,M?{}:{tabIndex:0,onFocus:R}),listRef:g},Nt.createElement(p2.OO,{ref:D,data:Array.from(h.collection),overscan:r,increaseViewportBy:2*e,className:"h-full",useWindowScroll:!s,customScrollParent:s,components:{...m,List:gde},endReached:i,rangeChanged:a,itemContent:(e,t)=>f?f(e,t):Nt.createElement(Nt.Fragment,{key:t.key},Nt.createElement("div",null,t.rendered))})):Nt.createElement("ul",{...C,ref:g},l?p.children:[...h.collection].map((e=>Nt.createElement(Nt.Fragment,{key:e.key},e.rendered))));return Nt.createElement(ude,{state:h,dropState:E,dragState:y,isVirtualized:n,estimatedRowHeight:e,virtualizerState:n?b:void 0},O,s&&Nt.createElement(hde,{customScrollParent:s}))}function Ede({modal:e,popover:t,portal:n,trigger:r,onInteractOutside:o,header:i,matchTriggerWidth:a,estimatedRowHeight:s,firstOptionDefaultActive:c=!0,isVirtualized:d,open:l,noResultsMessage:u,contentProps:f,...m}){const{"aria-label":p}=m,g=(0,tde.P)(m),h=Nt.useRef(_r),v=Nt.useRef(_r),E=Nt.useRef(_r),{inputProps:y,listBoxProps:S}=(0,nde.E)({...m,inputRef:h,listBoxRef:v,popoverRef:E},g);$r(l)&&(l?g.open("first"):(g.close(),g.setFocused(!1)));const I=Pr((()=>{!g.isFocused||g.isOpen||m.menuTrigger&&"focus"!==m.menuTrigger||g.open("first")}));Nt.useEffect(I,[I,g.inputValue]),oo((()=>{l&&g.open("first")}));const b=Pr((()=>g.setFocused(!0))),T=Pr((e=>{E.current?.contains(e.relatedTarget)||(g.setFocused(!1),g.close())})),w=function({state:e,firstOptionDefaultActive:t=!0}){return Pr((n=>{if(e.selectionManager.setFocused(!0),t&&"Enter"===n.key&&!e.selectionManager.focusedKey){const t=e.collection.getFirstKey();t&&e.setSelectedKey(t)}}))}({state:g,firstOptionDefaultActive:c});return Nt.createElement(Qce.fC,null,Nt.createElement(Qce.ee,{asChild:!0},Nt.createElement(Co.g7,{...(0,rde.dG)(y,{onFocus:b,onBlur:T,onKeyDown:w}),ref:h},r)),Nt.createElement(yde,{...(0,rde.dG)(S,f),noResultsMessage:u,listBoxRef:v,popover:t,portal:n,state:g,onInteractOutside:o,header:i,matchTriggerWidth:a,estimatedRowHeight:s,"aria-label":p,popoverRef:E,inputRef:h,isVirtualized:d}))}function yde(e){const t=Nt.useRef(_r),{listBoxRef:n=t,state:r,header:o,popoverRef:i,popover:a=!0,portal:s=!0,className:c,style:d,align:l="start",alignOffset:u,side:f,sideOffset:m=4,collisionPadding:p,avoidCollisions:g,matchTriggerWidth:h,modal:v,onInteractOutside:E,estimatedRowHeight:y,inputRef:S,"aria-label":I,isVirtualized:b,noResultsMessage:T}=e,w=Pr((e=>{S.current&&Gr(S,e)&&e.preventDefault()}));let C;if(T&&r.inputValue&&0===r.collection.size&&r.isFocused)C=Nt.createElement(Nt.Fragment,null,T);else{if(!r.isOpen)return _r;C=Nt.createElement(Sde,{"aria-label":I,estimatedRowHeight:y,header:o,isVirtualized:b,listBoxRef:n,popoverRef:i,state:r,className:c,style:d})}return a&&(C=Nt.createElement(roe,null,Nt.createElement(Qce.VY,{align:l,alignOffset:u,side:f,sideOffset:m,collisionPadding:p||8,avoidCollisions:g,"data-redesign":!0,className:yo()("Combobox-module--QOkKwY","portal-layer bg-grey-0 rounded elevation-5 border border-grey-100-a w-fit pointer-events-auto"),style:{width:h?"var(--radix-popper-anchor-width)":void 0}},C))),v&&(C=Nt.createElement(Xce.Z,{as:Co.g7,allowPinchZoom:!0},Nt.createElement(ede.XB,{asChild:!0,disableOutsidePointerEvents:v,onInteractOutside:(0,wo.M)(E,w),onDismiss:r.close},C))),s?Nt.createElement(io.h,null,C):C}function Sde(e){const t=Nt.useRef(_r),{listBoxRef:n=t,state:r,header:o,popoverRef:i,className:a,style:s,estimatedRowHeight:c,"aria-label":d,isVirtualized:l}=e,{listBoxProps:u}=(0,ode.co)(e,r,n),[f,m]=Nt.useState(_r);let p;const g={...u,domRef:n,state:r,estimatedRowHeight:c,"aria-label":d};return p=l?Nt.createElement(vde,{...g,isVirtualized:!0,customScrollParent:f??void 0,components:{Item:Co.g7},itemContent:(e,t)=>Nt.createElement(Ide,{key:t.key,item:t})},(e=>{const t=e;return Nt.createElement(Ide,{key:t.key,item:t})})):Nt.createElement(vde,{...g},[...r.collection].map((e=>Nt.createElement(Ide,{key:e.key,item:e})))),Nt.createElement(Nt.Fragment,null,o,Nt.createElement(h2,{ref:i,tabIndex:0},Nt.createElement(v2,{style:{maxHeight:"var(--radix-popper-available-height)",...s},className:yo()("Combobox-module--w6ZdPY",a),ref:m},p),Nt.createElement(b2,null)))}Ede.displayName="Combobox.Root",yde.displayName="Combobox.Content";const Ide=g2((function({item:e,...t},n){const r=Nt.useRef(_r),o=(0,s2.e)(n,r),{optionProps:i,isFocused:a,isSelected:s}=function({id:e,ref:t,draggable:n,hasAction:r,shouldUseVirtualFocus:o}){const{state:i,isVirtualized:a,dragState:s,virtualizerState:c}=fde("ListBox.Item"),{optionProps:d,isFocused:l,isSelected:u,isDisabled:f}=(0,ode.Fv)({key:e,isSelected:i.selectionManager.isSelected(e),isVirtualized:a,shouldUseVirtualFocus:o},i,t),{dragProps:m}=(0,Wr.J4)({key:e,hasAction:r},s);return no({ref:t,box:"border-box",onResize:t=>{const n=new ide.$u(t.borderBoxSize[0].inlineSize,t.borderBoxSize[0].blockSize);c?.virtualizer?.updateItemSize(e,n)}}),{isFocused:l,isSelected:u,isDisabled:f,optionProps:(0,rde.dG)(d,n?m:{})}}({id:e.key,ref:r,shouldUseVirtualFocus:!0});return Nt.createElement(Co.g7,{...(0,rde.dG)(i,t),ref:o,className:yo()(a?"Combobox-module--nIMbyF":void 0,s?"Combobox-module--bJawhu":void 0),"data-testid":"combobox-option"},e.rendered)})),bde=Nt.createElement("div",{className:yo()("Combobox-module--mclV41","absolute inset-1 mx-1 -z-1 rounded","bg-grey-50-a opacity-0 transition-opacity duration-faster")}),Tde=Nt.forwardRef((function({initials:e,name:t,email:n,color:r,className:o,...i},a){return Nt.createElement("li",{ref:a,...i,className:yo()("Combobox-module--UoVgCm",o,"row gap-2 relative z-1"),style:{padding:8}},bde,Nt.createElement(Tce,{size:32,color:r,"aria-hidden":!0,initials:e}),Nt.createElement("div",{className:"stack flex-1 min-w-0"},Nt.createElement(o0,{variant:"label-1-regular"},t),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400",ellipsisOverflow:!0},n)))}));const wde=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gi;function Cde(e){return e.replace(wde,(e=>ae(e)?e:`<a href="${e}" target="_blank">${e}</a>`))}const _de=["@","+"];function Ade(e,t){let n;for(let r=t-1;r>-1;r--)if(_de.includes(e[r])&&(n=r)," "===e[r])return n;return n}function Rde(e,t){const n=document.getSelection();if(!n)return;n.removeAllRanges();const r=document.createRange();r.setStart(e,t),r.setEnd(e,t),n.addRange(r)}const Mde=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"circle"}))),Dde=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"more-horizontal"})));var Ode=n(68018);const[xde,kde]=(0,Qr.k)("CommentThread",{isActive:!1,isReplying:!1,showingReplies:!1,isReplyingSet:()=>{},rootRef:{current:_r}}),Nde=yo()("text-blue-500");function Pde(e,t){return`<span data-mention="${e}" data-mention-email="${t}" className="${Nde}" />`}const Lde=Nt.forwardRef((function({className:e,placeholder:t,value:n,onValueChange:r,showMentions:o,showMentionsSet:i,onReply:a,onClick:s,comboboxValueSet:c,onSetMentionsEnabled:d,textareaRef:l,onBlur:u,...f},m){const p=(0,yne.M)(),g=Nt.useRef(_r),h=(0,s2.e)(l,g),v=Pr((e=>{const t=e.target,n=document.getSelection();if(!n?.focusNode)return;const r=n.focusNode.data||"",o=n.focusOffset+("ArrowLeft"===e.key||"Backspace"===e.key||"Delete"===e.key?-1:1),a=Ade(r,o),s="undefined"!==typeof a;if("Enter"===e.key&&s?(e.preventDefault(),d(!1),i(!1),c("")):"Backspace"===e.key&&s&&a===o?(d(!1),i(!1),c("")):_de.includes(e.key)||s&&"Escape"!==e.key?(d(!0),i(!0),g.current?.setAttribute("data-mentioning","true"),_de.includes(e.key)||void 0===a||" "===e.key&&(c(""),d(!1),i(!1)),"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()):(!s||"ArrowLeft"===e.key&&_de.includes(t.innerText[t.selectionStart+1])||"ArrowRight"===e.key&&!s)&&(d(!1),i(!1),g.current?.removeAttribute("data-mentioning"),Br(n?.focusNode.parentNode)&&n?.focusNode.parentNode.getAttribute("data-mention")&&"Backspace"===e.key&&0!==n.focusOffset&&(n.focusNode.parentElement?.remove(),e.preventDefault())),"-"!==r&&"*"!==r||" "!==e.key){if(r.match(/^\d+\./)&&" "===e.key){const t=document.createElement("ol"),r=document.createElement("li");t.appendChild(r),n.focusNode.parentNode?.replaceChild(t,n.focusNode),Rde(r,0),e.preventDefault()}}else{const t=document.createElement("ul"),r=document.createElement("li");t.appendChild(r),n.focusNode.parentNode?.replaceChild(t,n.focusNode),Rde(r,0),e.preventDefault()}})),E=Pr((()=>{Zce()(n,Ude)})),y=Nt.useRef(_r),S=Nt.useRef(!0),I=Pr((e=>{!y.current?.contains(e.relatedTarget)&&S.current&&u?.()})),b=Pr((e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)})),T=Pr((e=>{e?.stopPropagation(),a(Cde(n.replace(/(?:<div><br(?:\s*\/)?><\/div>)*$/,""))),r(""),S.current=!1})),w=Pr((e=>{Zr(e)&&"Enter"===e.key?T():S.current=!0})),{rootRef:C}=kde("CommentThread.CommentBoxInput"),_=Pr((e=>{if(r(e.target.value.replace(/<font color=".*">(.*)<\/font>/,"$1")),o){const e=document.getSelection();if(e?.focusNode){const t=e.focusNode.data||"",n=Ade(t,e.focusOffset);"undefined"!==typeof n&&c(t.slice(n+1,e.focusOffset))}}C.current&&(0,Jce.Z)(C.current,{scrollMode:"if-needed",block:"nearest"})}));return Nt.createElement(Wne,{ref:y,inputId:p,"aria-label":"Draft reply",className:yo()("CommentThread-module--l_LrjQ",e,"cursor-text","w-full h-auto",n&&"CommentThread-module--ZQgrrk"),border:"button",saveOnEnter:!1,onBlur:I,...(0,rde.dG)(f,{onKeyDown:w,onClick:s})},Nt.createElement("div",{ref:m,className:"flex-1"},Nt.createElement(hre(),{onKeyDown:v,innerRef:h,id:p,role:"textbox","data-role":"comment-box",className:yo()("w-full py-2 text-grey-800 label-1-regular","CommentThread-module--wEGBnR"),html:n,spellCheck:!0,tabIndex:0,onChange:_,onBlur:E,onPaste:b,placeholder:t}),n&&Nt.createElement("div",{className:"row justify-end pb-2"},Nt.createElement(ei,{title:"Send",asChild:!0},Nt.createElement(Yo,{onClick:T,disabled:!n,size:"dense",variant:"primary","aria-label":"Send comment"},Nt.createElement(v1,null))))))})),Fde=Nt.forwardRef((function({mentionableUsers:e=[],value:t,onValueChange:n,currentUser:r,className:o,onClick:i,placeholder:a="Add a comment",onReply:s,focusOnMount:c,onBlur:d},l){const u=Nt.useRef(_r),[f,m]=Nt.useState(!1),[p,g]=Nt.useState(!1),[h,v]=Nt.useState(""),E=Nt.useMemo((()=>Object.fromEntries(e.map((e=>[e.email,e])))),[e]),y=Nt.useContext(bo),{isActive:S,isReplyingSet:I,isReplying:b}=kde("CommentThread.CommentBox"),T=Pr((t=>{if(!p)return;const r=document.getSelection(),o=t?e.find((e=>e.email===t)):h&&ae(h)?{name:h,email:h}:void 0;if(!o||!r?.focusNode||!u.current)return;const i=new RegExp(`[${_de.join("")}]${h||""}`),[a,s]=r.focusNode.data.split(i),c=document.createElement("span");c.setAttribute("data-mention",o.name),c.setAttribute("aria-label",o.name),c.setAttribute("data-mention-email",o.email),c.className=Nde;const d=document.createTextNode(a||"\u200b");r.focusNode.parentNode?.replaceChild(d,r.focusNode),d.after(c);const l=document.createTextNode(s||" ");c.after(l),n(u.current.innerHTML||""),u.current.focus(),Rde(l,1)}));t||S||!b||I(!1);const w=Nt.useRef(_r),C=(0,s2.e)(l,w),_=Nt.createElement(Lde,{ref:C,textareaRef:u,className:o,showMentions:p,showMentionsSet:g,value:t,onValueChange:n,onReply:s,onClick:i,onBlur:d,placeholder:a,comboboxValueSet:v,onSetMentionsEnabled:m});return Nt.useEffect((()=>{requestAnimationFrame((()=>{c&&u.current?.focus()}))}),[c]),Nt.createElement("div",{className:"row items-end gap-1 w-full min-w-0 relative"},Nt.createElement(T2,{className:yo()("flex-1","CommentThread-module--DxgDek")},Nt.createElement(Ede,{"aria-label":"Member list",isVirtualized:!0,open:p,menuTrigger:"input",onOpenChange:g,isDisabled:!f,trigger:_,estimatedRowHeight:46,defaultItems:e,defaultFilter:(e,t)=>{const n=E[e];if(!n)return!1;const r=t.toLowerCase();return n.name.toLowerCase().includes(r)||n.email.toLowerCase().includes(r)},noResultsMessage:Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-2-medium",className:"px-2"},"No users found")),inputValue:h,onInputChange:v,selectedKey:"",onSelectionChange:T,contentProps:{style:{maxHeight:300}}},(e=>Nt.createElement(Ode.ck,{key:e.email,textValue:e.email},Nt.createElement(Tde,{initials:e.initials,name:e.name,email:e.email,color:e.color(e.id===r?.id,y)}))))))})),Ude={allowedTags:["b","i","em","strong","a","p","h1"],allowedAttributes:{a:["href"]}},Bde=Nt.forwardRef((function({children:e,timeOffset:t,onResolve:n,isActive:r,isArchived:o,onReply:i,onDiscard:a,mentionableUsers:s=[],currentUser:c,className:d,isReplying:l=!1,replyCount:u,focusOnMount:f,isNew:m,showingReplies:p,onShowingRepliesChange:g,...h},v){const E=Nt.useRef(_r),y=(0,s2.e)(v,E),[S,I,b,T]=Nr(l),[w,C]=Nt.useState(""),[_=!1,A]=(0,Ene.T)({defaultProp:void 0!==u&&l||!1,prop:p,onChange:g}),R=Pr((()=>A(!0))),M=Pr((()=>A(!1))),D=void 0!==u,O=!_&&D,x=Nt.useRef(!0),[k,N]=Nt.useState(!1),P=Pr((()=>{w?(N(!0),x.current=!0):j()})),L=Pr((()=>{N(!1)})),F=Pr((()=>{(m||w)&&P()})),U=Nt.useRef(_r),B=Pr((e=>{e?P():((0,Pt.flushSync)(L),x.current&&U.current?.querySelector('[data-role="comment-box"]')?.focus())})),j=Pr((()=>{a?.(),b(),C(""),x.current=!1}));return Nt.createElement(xde,{showingReplies:_,isReplying:S,rootRef:E,isActive:r??!1,isReplyingSet:T},Nt.createElement("div",{"data-redesign":!0,"data-active-comment":r||void 0,ref:y,className:yo()("CommentThread-module--_DBtMP",d,r?"relative bg-cyan-500-a":"hover:bg-grey-50-a",O&&"cursor-pointer"),tabIndex:0,...h,onClick:(0,wo.M)(h.onClick,O?R:void 0)},Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-medium",className:"p-1 text-grey-400","data-comment-time":!0,asChild:"string"!==typeof t},t),Nt.createElement("div",{className:"split"}),n&&c&&Nt.createElement(ei,{title:o?"Unresolve":"Resolve",className:yo()("CommentThread-module--J8PeKi","transition-opacity duration-faster",r&&"CommentThread-module--rKYIbp")},Nt.createElement(Yo,{onClick:n,"data-testid":"resolve-button"},o?Nt.createElement(Mde,null):Nt.createElement(Eae,null)))),Boolean(e)&&Nt.createElement("div",{className:"CommentThread-module--ifTDC5"},e),"number"===typeof u&&u>0&&Nt.createElement(e0,{className:"gap-0"},Nt.createElement(Zo,{className:"text-grey-400"},Nt.createElement(Dde,null)),Nt.createElement(W0,{variant:"light",className:yo()("flex-1 justify-start","CommentThread-module--NuzhwB"),onClick:O?R:M},Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400"},O?`Show ${u} more ${u>1?"replies":"reply"}`:"Hide replies"))),!O&&c&&Nt.createElement(e0,{className:"gap-0 items-start"},Nt.createElement(Tce,{size:32,initials:c.initials,profileImage:c.profileImageCdnUrl||c.profileImageUrl,"aria-hidden":!0}),Nt.createElement(Fde,{ref:U,focusOnMount:f,mentionableUsers:s,currentUser:c,value:w,onValueChange:C,onClick:I,onBlur:F,placeholder:D?"Reply":"Add a comment",onReply:i}))),Nt.createElement(M2,{type:"alert",open:k,onOpenChange:B,onSubmit:j},Nt.createElement(P2,{style:{width:300},onCloseAutoFocus:Lr},Nt.createElement(D2,null,"Discard comment?"),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,null,"Discard")))))})),jde=Nt.forwardRef((function({user:e,createdAt:t,content:n,children:r,additionalControls:o,...i},a){const{showingReplies:s}=kde("CommentThread.Comment"),c=Nt.useMemo((()=>Zce()(n,{allowedTags:["span"],allowedAttributes:{span:["class","data-mention","data-mention-email","aria-label"]}})),[n]);return Nt.createElement("div",{ref:a,...i},Nt.createElement(e0,{className:"gap-0"},Nt.createElement(Tce,{size:32,initials:e.initials,profileImage:e.profileImageCdnUrl||e.profileImageUrl,"aria-hidden":!0}),Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800 px-2"},e.name),Nt.createElement(o0,{variant:"label-2-regular",className:"text-grey-400 px-2"},Gce(t)),o),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:yo()("CommentThread-module--LpUKkY","text-grey-800 px-2")},Nt.createElement("div",{dangerouslySetInnerHTML:{__html:c}}))),s&&r)})),Vde=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"plus-1x"}))),zde=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"plus"}))),Gde=Nt.forwardRef((function(e,t){return Nt.createElement("div",{ref:t},Nt.createElement("div",{className:"icon-1x flex-center"},Nt.createElement(Vde,{...e,type:"icon"})),Nt.createElement("div",{className:"icon-2x flex-center"},Nt.createElement(zde,{...e,type:"icon"})))}));var Wde="PropertyPanel-module--Y3nAfz",Hde="PropertyPanel-module--d12lHL",qde="PropertyPanel-module--IFig8d",$de="PropertyPanel-module--SqCX5_",Kde="PropertyPanel-module--tAgu7D",Yde="PropertyPanel-module--GeDQCy",Zde="PropertyPanel-module--zz8i_n",Jde="PropertyPanel-module--aYdmxo",Qde="PropertyPanel-module--LnMbCd",Xde="PropertyPanel-module--C7hW5Q",ele="PropertyPanel-module--JninD0",tle="PropertyPanel-module--EwRGkj",nle="PropertyPanel-module--s9jgda",rle="PropertyPanel-module--VFPA9L",ole="PropertyPanel-module--bs7tU4",ile="PropertyPanel-module--bLVrv6";function ale(){return Nt.createElement("div",{className:"split"})}const sle=Nt.forwardRef((function({children:e,isActive:t,onActiveChange:n,className:r,density:o="compact",regularLabel:i=!1,noPadding:a=!1,...s},c){const d=Pr((()=>{n?.(!t)}));return"boolean"===typeof t&&n?Nt.createElement("div",{ref:c,className:yo()(r,y[o],ole,"row",{[Wde]:t}),...s},Nt.createElement("div",{className:yo()("label-1-medium",rle,Zde)},e),Nt.createElement(ale,null),Nt.createElement(Yo,{onClick:d,"aria-label":t?"Remove effect":"Add effect"},t?Nt.createElement(hne,null):Nt.createElement(Gde,null))):Nt.createElement("div",{ref:c,className:yo()(r,y[o],"row",rle,{"label-1-regular text-grey-400":i,"label-1-medium":!i,[Wde]:(t&&!i)??!0,[Qde]:i,"px-0":a}),...s},e)}));const cle=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"sliders-1x"}))),dle=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"sliders"}))),lle=Nt.forwardRef((function(e,t){return Nt.createElement("div",{ref:t},Nt.createElement("div",{className:"icon-1x flex-center"},Nt.createElement(cle,{...e,type:"icon"})),Nt.createElement("div",{className:"icon-2x flex-center"},Nt.createElement(dle,{...e,type:"icon"})))}));var ule=n(50952);const fle=(0,Nt.createContext)({});class mle{constructor(e,t){this.areEqual=e,this.hashFn=t,this.map=new Map}getValueForData(e){const t=this.hashFn(e),n=this.map.get(t);if(n)for(const{data:r,value:o}of n)if(this.areEqual(r,e))return o}setValueForData(e,t){const n=this.hashFn(t),r=this.map.get(n);if(r){for(const{data:e}of r)if(this.areEqual(e,t))return;Ma("Model data hash collision",{hashCode:n,existingData:r.map((e=>e.data)),data:t}),r.push({data:t,value:e})}else this.map.set(n,[{data:t,value:e}])}}function ple(e){return void 0===e?0:VN(e)}function gle(e){return{key:e,isEmpty:e=>void 0===e,hashCode:ple}}function hle(e){return void 0===e?0:VN(String(e))}function vle(){const e=Math.trunc((1-Math.random())*Number.MAX_SAFE_INTEGER);return t=>t?e:0}function Ele(e){return{key:e,isEmpty:e=>!e,hashCode:vle()}}const yle={key:"projectId",isEmpty:()=>!1,hashCode:VN},Sle={key:"compositionId",isEmpty:()=>!1,hashCode:VN},Ile=gle("markerId"),ble=gle("href"),Tle=gle("highlighterId"),wle=gle("scriptClipTauId"),Cle=gle("pinComponentId"),_le=gle("cueId"),Ale=Ele("hasRegionBoundary"),Rle=Ele("isScratchText"),Mle=Ele("isFillerWordBasic"),Dle=Ele("isFillerWordAll"),Ole=Ele("isRecordingTau"),xle={key:"wordGap",isEmpty:e=>void 0===e,hashCode:hle};const kle={key:"wordlessMedia",isEmpty:e=>!e,hashCode:(()=>{const e=vle(),t=vle(),n=vle();return r=>r?e(!0)^VN(r.firstWordlessMediaOfTauId??"")^t(r.isBlankCardGap)^n(r.isStillComputingEnergies):0})()},Nle={key:"wordError",isEmpty:e=>!e,hashCode:(()=>{const e=vle();return t=>{if(!t)return 0;const{alternative:n}=t;let r=e(!0);return void 0!==n&&(r^=VN(n)),r}})()},Ple={key:"wordTag",isEmpty:e=>!e,hashCode:(()=>{const e=vle();return t=>{if(!t)return 0;const{mediaRefId:n,index:r}=t;return VN(n)^e(!0)*r}})()},Lle={key:"annotationIds",isEmpty:e=>!e||0===e.length,hashCode:(()=>{const e=vle();return t=>{if(!t)return 0;let n=e(!0);return t.forEach((e=>{n^=VN(e)})),n}})()},Fle=gle("foregroundColor"),Ule={key:"textDecoration",isEmpty:e=>!e,hashCode:(()=>{const e=vle();return t=>{if(!t)return 0;const{color:n,style:r,line:o}=t;let i=e(!0);return n&&(i^=VN(n)),void 0!==r&&(i^=VN(r)),void 0!==o&&(i^=VN(o)),i}})()},Ble={key:"aiSpeechDecoration",isEmpty:e=>!e,hashCode:(()=>{const e=vle(),t=vle();return n=>{if(!n)return 0;let r=e(!0);const{hasAudio:o,type:i,status:a,tauId:s}=n;return r^=t(o),void 0!==a&&(r^=VN(a)),r^=VN(i),r^=VN(s),r}})()},jle={key:"recordingSession",isEmpty:e=>!e,hashCode:e=>{if(!e)return 0;let t=0;void 0!==e.startedAt&&(t^=VN(e.startedAt));return t^=VN(e.trackNames.join()),t}},Vle={key:"paragraphSpeaker",isEmpty:e=>void 0===e,hashCode:(()=>{const e=vle(),t=vle(),n=vle();return r=>{if(void 0===r)return 0;let o=0;return 1===r.speaker?o^=e(!0):o^=VN(`${r.speaker.speakerId}-${r.speaker.styleId}`),1===r.previousSpeaker?o^=t(!0):o^=VN(`prev-${r.previousSpeaker.speakerId}-${r.previousSpeaker.styleId}`),o^=n(r.change),o}})()},zle={key:"cardBoundary",isEmpty:e=>void 0===e,hashCode:e=>{if(void 0===e)return 0;const{type:t,cardBoundaryId:n}=e;return VN(`${t}:${n}`)}},Gle=[yle,Sle],Wle=[Ile,ble,Lle,Tle,Fle,Ule,Ble,Ale,Rle,wle,jle,Ole,Vle,Cle,_le,Mle,Dle,Nle,Ple,xle,kle,zle],Hle=Ele("hasTextCursor"),qle=gle("hasRecordingTarget"),$le=Ele("hasPlayhead"),Kle=Ele("hasHiddenPlayhead"),Yle=Ele("hasUnfocusedSelection"),Zle=Ele("hasWordGapSelection"),Jle=vle(),Qle={key:"liveCollabSelection",isEmpty:e=>void 0===e,hashCode:e=>void 0===e?0:VN(e.userId)^VN(e.clientId)^Jle(e.empty)},Xle=Ele("hasCardRangeDropTarget"),eue=Ele("hasSelectionDropTarget"),tue=Ele("hasFindResult"),nue=gle("isInRecordingReplaceRange"),rue=Ele("hasFindResultCurrent"),oue=Ele("hasPendingOverdub"),iue=Ele("hasTextCorrection"),aue=gle("pinBoundary"),sue=gle("pinHighlight"),cue=gle("selectedCardRange"),due=Ele("activeParagraph"),lue=gle("secondaryCursor"),uue={key:"hoverWord",isEmpty:e=>!e,hashCode:(()=>{const e=vle(),t=vle(),n=vle(),r=vle(),o=vle();return i=>{if(!i)return 0;const{willPlay:a,isAfterWord:s,isDraggingMedia:c,isInCardRange:d}=i;return e(!0)^t(a)^n(s)^r(c)^o(d)}})()},fue=[Hle,qle,$le,Kle,Yle,Xle,eue,nue,rue,tue,oue,iue,Qle,aue,sue,cue,due,uue,lue,Ele("editBoundaryFocusedWord"),Ele("focusedOverdubRange"),gle("focusedBlockedTauId"),Zle];function mue(e,t,n){return{req:e,opts:t,temp:n}}function pue({req:e,opts:t},n){return mue(e,t,n)}const gue=Me.fastDeepEqual;function hue(e){return function({temp:e}){if(!e)return 0;let t=0;for(const n of fue)t^=n.hashCode(e[n.key]);return t}(e)^function({req:e,opts:t}){let n=0;for(const r of Gle)n^=r.hashCode(e[r.key]);for(const r of Wle)n^=r.hashCode(t[r.key]);return n}(e)}const vue="MODEL_DATA";var Eue=(e=>(e.marker="marker",e.inlineMarkerAfterCardBoundary="inlineMarkerAfterCardBoundary",e.inlineCardBoundary="inlineCardBoundary",e.blockLevelCardBoundary="blockLevelCardBoundary",e.unstyled="unstyled",e.scriptClip="scriptClip",e.wordlessMediaScriptClipWithNewline="wordlessMediaScriptClip",e))(Eue||{});function yue(e,t){const n=Iue(e,t),r=function(e,t){const n=(0,V7.getEndKey)(t);return bue(e,n)+(0,V7.getEndOffset)(t)}(e,t),o=KG(n,r-n);return t.isBackward?rW(o):o}function Sue(e,t){return JG(yue(e,t))}function Iue(e,t){return bue(e,(0,V7.getStartKey)(t))+(0,V7.getStartOffset)(t)}function bue(e,t){let n=0;for(const[r,o]of e.blockMap){if(t===r)break;n+=o.text.length+1}return n}function Tue(e){let t=0;const n=[];for(const[r,o]of e.blockMap){if(!o||void 0===r)throw new Error("block or blockKey undefined in forEach");const e={key:r,range:Gs.get(t,o.text.length)};n.push(e),t+=e.range.length+1}return n}function wue(e,t){return(0,V7.makeSelectionState)({anchorKey:e,anchorOffset:t.location,focusKey:e,focusOffset:$s(t),isBackward:!1,hasFocus:!1})}function Cue(e,t){const n=[];let r=e.location;const o=e.length;let i=0;for(const a of t){if(r<0)break;const e=a.range.length;if(r<e||0===e&&0===r){const t=Math.min(o-i,e-r);n.push({key:a.key,range:Gs.get(r,t)}),i+=t+1,r=0}else r-=e+1;if(-1===r&&(r=0,i+=1),i>=o)break}return n}function _ue(e,t,n=!0){const r=Aue(e,JG(t),n);return r&&XG(t)?{...r,anchorKey:r.focusKey,anchorOffset:r.focusOffset,focusKey:r.anchorKey,focusOffset:r.anchorOffset,isBackward:!0}:r}function Aue(e,t,n=!0){let r,o,i=t.location,a=$s(t),s=0,c=0;for(const[d,l]of e.blockMap){const e=l.text.length;if(r||i<e+1&&(r=d,s=i),r&&(o=d,c=e,a<e+1)){o=d,c=a;break}i-=e+1,a-=e+1}if(r&&o)return{...(0,V7.makeEmptySelection)(r),focusKey:o,anchorOffset:s,focusOffset:c,hasFocus:n};{const t=(0,V7.getLastBlock)(e);if(t){const e=t.text.length,r=t.key;return{...(0,V7.makeEmptySelection)(r),focusKey:r,anchorOffset:e,focusOffset:e,hasFocus:n}}}Ra(new Error("could not compute selection"),"get-selection-for-range")}function Rue(e,t){if("inlineCardBoundary"===e.type||"blockLevelCardBoundary"===e.type){const n=function(e,t){for(const[n,r]of cs(e.keys()))if(n===t)return r?e.get(r):void 0;return}(t,e.key);"inlineMarkerAfterCardBoundary"!==n?.type&&"marker"!==n?.type&&t.set(e.key,{...e,type:"unstyled"})}else if("inlineMarkerAfterCardBoundary"===e.type||"marker"===e.type){const n=function(e,t){for(const[n,r]of function*(e){let t;for(const n of e)yield[t,n],t=n}(e.keys()))if(r===t)return n?e.get(n):void 0;return}(t,e.key);!n||"inlineCardBoundary"!==n.type&&"blockLevelCardBoundary"!==n.type?t.set(e.key,{...e,type:"marker"}):"inlineCardBoundary"!==n.type&&"blockLevelCardBoundary"!==n.type||t.set(e.key,{...e,type:"inlineMarkerAfterCardBoundary"})}}function Mue(e,t,n){if(1===e.string.length&&1===e.attributes.length&&e.attributes[0].attribute.name===Gu.CardBoundary&&void 0===_s.index(e.string))return n&&"scriptClip"===t?.type?"blockLevelCardBoundary":"inlineCardBoundary";const r=e.attributes.some((e=>e.attribute.name===Gu.Marker));return!r||"inlineCardBoundary"!==t?.type&&"blockLevelCardBoundary"!==t?.type?r?"marker":e.attributes.some((e=>e.attribute.name===Gu.ScriptClip))?"scriptClip"===t?.type?"wordlessMediaScriptClip":"scriptClip":"unstyled":"inlineMarkerAfterCardBoundary"}function Due(e){return void 0!==e.indexOf(y5.CARD_BOUNDARY_SYMBOL)&&0===e.replaceAll(y5.CARD_BOUNDARY_SYMBOL,"").replaceAll(y5.PIN_COMPONENT_SYMBOL,"").replace(y5.BLANK_CARD_SYMBOL,"").trim().length}vP((function(e){for(const{entity:t}of e.characterList)if(t){if(void 0!==(0,V7.getEntity)(t).data.opts.scriptClipTauId)return!1}return Due(e.text)}),new class{constructor(){this.weakMap=new WeakMap}get(e){return this.weakMap.get(e)}set(e,t){this.weakMap.set(e,t)}remove(e){this.weakMap.delete(e)}clear(){this.weakMap=new WeakMap}isValidCacheKey(e){return"object"===typeof e}});function Oue({blockMap:e},t){const n=e.get(t);if(n)return n}function xue(e,t,n){if(!e)return!1;const r=e.entity;if(!r)return!1;const o=(0,V7.getEntity)(r);return!!o&&n(o.data)}const kue=[!0,!0];function Nue(e,t,n,r,o,i=!0){return(0,Nt.useMemo)((()=>{if(!i)return kue;const a=Oue(e,t);if(!a)return kue;const s=a.characterList;return[n<=0||!xue(s[n-1],0,o),r>=a.text.length||!xue(s[r],0,o)]}),[n,r,e,t,o,i])}const Pue=({opts:{markerId:e}})=>void 0!==e;const Lue=Yc((function(e,{data:{req:{projectId:t,compositionId:n},opts:{markerId:r}}}){return{isVideoComposition:FW(e,t,n),isEditable:d7(e,t),markerText:r&&X6(e,t,n,r)?.text||""}}))((function({contentState:e,data:{req:{projectId:t},opts:{markerId:n}},children:r,blockKey:o,offsetKey:i,start:a,end:s,isVideoComposition:c,isEditable:d,markerText:l}){const u=(0,V7.getBlockForKey)(e,o),f=(0,Nt.useMemo)((()=>{if(void 0===i||void 0===s||void 0===n)return!1;const t=Oue(e,i.split("-")[0]);if(!t)return!0;if(s===t.text.length)return!0;const r=t.characterList[s];if(!r)return!0;const o=r.entity;if(!o)return!0;const a=(0,V7.getEntity)(o);if(!a)return!0;return a.data.opts.markerId!==n}),[n,i,s,e]),m=function(e,t,n,r){return(0,Nt.useMemo)((()=>{if(n<=0)return!0;const o=Oue(e,t);return!o||!xue(o.characterList[n-1],0,r)}),[n,e,t,r])}(e,o,a,Pue),p=c&&u.type===Eue.inlineMarkerAfterCardBoundary,g={isLastMarkerDecoration:f,markerId:n,"data-decorator-type":"marker",className:p?"Marker-module--lJ3pTL":void 0};return d&&m?Nt.createElement(_ie,{...g,projectId:t,markerText:l,dragButtonClassName:p?"Marker-module--sjcNvN":void 0},r):Nt.createElement(Cie,{...g},r)}));const Fue=Yc((function(e,{data:{req:{projectId:t},opts:{highlighterId:n}}}){return{highlighterColor:n?PW(e,t,n)?.color:void 0}}))((function({data:{req:{projectId:e},opts:{highlighterId:t}},children:n,highlighterColor:r,blockKey:o}){const i=Nt.useContext(bo),a=(0,Nt.useMemo)((()=>{return t&&r?i?{backgroundColor:IS(r)}:{backgroundColor:IS((e=t,kO.get(e)||r))}:{};var e}),[r,t,i]);return Nt.createElement("span",{className:"HighlightDecoration",style:a},n)}));const Uue=Yc((function(e){return{selectedAnnotationIds:e.ui.selectedAnnotationIds,hoveringAnnotationIds:e.ui.hoveringAnnotationIds,hideAnnotationsGutter:jH(e)}}))((function({data:e,children:t,selectedAnnotationIds:n,hoveringAnnotationIds:r,hideAnnotationsGutter:o}){const i=e.opts.annotationIds;if(!i||0===i.length)throw new Error("Cannot render annotation decoration without ids");const a=(0,Ft.I0)(),s=Nt.useContext(bo),c=(0,Nt.useMemo)((()=>i.some((e=>Boolean(n?.has(e))))),[i,n]),d=(0,Nt.useMemo)((()=>i.some((e=>Boolean(r?.has(e))))),[i,r]),l=(0,Nt.useMemo)((()=>i.map((e=>`annotation-decorator-${e}`))||[]),[i]),u=Pr((()=>{d||a(o9({annotationIds:new Set(i),source:"cursor"}))})),f=Pr((()=>{a(o9({annotationIds:void 0}))})),m=Pr((e=>{e.preventDefault(),a(r9({annotationIds:new Set(i)})),(o||s)&&a(V8({visible:!0}))}));return Nt.createElement(Aie,{onMouseOver:u,onMouseLeave:f,onMouseUp:m,className:yo()(l),isSelected:c,isHovering:d},t)}));function Bue({opts:{wordTag:e},temp:{hoverWord:t,hasPlayhead:n,focusedBlockedTauId:r}={}}){return!(!t||e||r)&&(!n&&!t.isAfterWord||(t.isDraggingMedia||t.isInCardRange))}const jue=Yc((function(e,{data:{req:{projectId:t,compositionId:n}}}){return{dropTargetType:Q6(e,t),hasActiveScriptTool:void 0!==n7(e,t,n)}}))((({children:e,data:t,contentState:n,start:r,end:o,blockKey:i,dropTargetType:a,hasActiveScriptTool:s})=>{const{temp:{hoverWord:c,hasSelectionDropTarget:d}={}}=t,[l,u]=Nue(n,i,r,o,Bue);if(c?.isDraggingMedia&&void 0!==a&&"ScriptPin"!==a&&"ScriptPinToWord"!==a&&"ScriptPinToWordlessMedia"!==a&&"ScriptClipToBlankCard"!==a)return Nt.createElement(Nt.Fragment,null,e);const f=Boolean(c?.isDraggingMedia&&!d&&u&&c.isAfterWord),m=Boolean(c?.isDraggingMedia&&!d&&l&&!c.isAfterWord);return Nt.createElement("span",{className:yo()("HoverDecoration-module--t02D8t","HoverDecoration-module--GUdEvu",c?.isDraggingMedia?f||m?{"HoverDecoration-module--XLVyCX":!0,"HoverDecoration-module--Ekxqbd":f,"HoverDecoration-module--Yri0b0":m}:{}:{"HoverDecoration-module--kCmUFF":l,"HoverDecoration-module--PKtH0k":u,"HoverDecoration-module--z5Txh6":c?.willPlay,"HoverDecoration-module--P3yU_0":s})},e)}));function Vue(e,t,n){if(!e)return{contentState:t,entityKey:void 0};if(function({opts:e,temp:t}){for(const n of Wle)if(!n.isEmpty(e[n.key]))return!1;if(!t)return!0;for(const n of fue)if(!n.isEmpty(t[n.key]))return!1;return!0}(e))throw new Error("Cannot add entity for empty ModelData");let r=n.getValueForData(e);if(!r){(0,V7.createEntity)(vue,"MUTABLE",e);const t=(0,V7.getLastCreatedEntityKey)();n.setValueForData(t,e),r=t}return{entityKey:r,contentState:t}}const zue="BOLD",Gue="ITALIC",Wue="INLINE_NOTE";const Hue="Playhead",que=Nt.forwardRef((function({isPlaying:e=!0,isStart:t,isEnd:n,pausedPlayheadTime:r,isStoryboard:o,isOverWordlessMedia:i,isHidden:a,...s},c){const d=Nt.useRef(_r),l={ref:(0,s2.e)(c,d),...s};e?(l.id=Hue,l.className=yo()("Playhead-module--m9VtJT","Playhead-module--xOwmUU",{"Playhead-module--Os5_ki":t,"Playhead-module--fKkzyC":n,"Playhead-module--_x3kZp":i})):t&&(l.id=Hue,l.className=a?void 0:"Playhead-module--t0GDHx",l["data-time"]=void 0);const u=(0,Ft.I0)();return Nt.useEffect((()=>{if(!d.current)return;const e=new IntersectionObserver((function([e]){u(e1({visible:e.isIntersecting}))}));return e.observe(d.current),()=>{e.disconnect()}}),[u]),Nt.createElement("span",{ref:c,...l})})),$ue={altPressed:!1,shiftPressed:!1,ctrlPressed:!1,metaPressed:!1,cmdPressed:!1},[Kue,Yue]=(0,Qr.k)("ModifiersContext"),Zue=Yue;function Jue({children:e}){const[t,n]=(0,Nt.useState)($ue);return(0,Nt.useEffect)((()=>{const e=e=>{n((t=>(0,T.ZP)(t,(t=>{t.altPressed=e.altKey,t.shiftPressed=e.shiftKey,t.ctrlPressed=e.ctrlKey,t.metaPressed=e.metaKey,t.cmdPressed=Zr(e)}))))},t=()=>{n($ue)};return window.addEventListener("pointerup",e,{capture:!0,passive:!0}),window.addEventListener("keydown",e,{capture:!0,passive:!0}),window.addEventListener("keyup",e,{capture:!0,passive:!0}),window.addEventListener("blur",t),()=>{window.removeEventListener("pointerup",e,{capture:!0}),window.removeEventListener("keydown",e,{capture:!0}),window.removeEventListener("keyup",e,{capture:!0}),window.removeEventListener("blur",t)}}),[]),Nt.createElement(Kue,{...t},e)}function Que(e){return Boolean(Vc("remove-recording-placeholder")&&(e.recording.editor.isRecording||e.recording.editor.isConfigOpen||e.recording.editor.isStartingSession)&&"script"===function(e){return e.recording.editor.targetType}(e))}const Xue=({temp:e,opts:t})=>Boolean(e&&e.hasPlayhead&&!t.wordTag);const efe=Yc(((e,{data:{req:{projectId:t,compositionId:n}}})=>{const r=f7(e),o=r?void 0:g7(e),i=r?void 0:lme(e,t,n),a=0===oee(e,t,n).length&&o===i,s=UW(e,t);return{playheadAndCursorTimeOverlap:a,isPlayheadMovingWithTextCursor:l7(e,t,n),selectionHasFocus:aee(e,t,n),pausedPlayheadTime:o,isStoryboard:s,textMode:a7(e,t,n),projectId:t,compositionId:n,isScriptRecordingStarting:s&&Que(e)}}))((function({start:e,end:t,contentState:n,blockKey:r,children:o,selectionHasFocus:i,pausedPlayheadTime:a,isStoryboard:s,textMode:c,playheadAndCursorTimeOverlap:d,isPlayheadMovingWithTextCursor:l,isScriptRecordingStarting:u,data:{temp:f,opts:{wordlessMedia:m}}}){const p=void 0===a,[g,h]=Nue(n,r,e,t,Xue),v=Zue("PlayheadDecorator"),E=i&&l||Boolean(f?.isInRecordingReplaceRange)&&!p||u||!p&&(c===NU.Write||s&&d&&v.cmdPressed);return Nt.createElement(que,{isStart:g,isEnd:h,pausedPlayheadTime:a,isOverWordlessMedia:void 0!==m,isPlaying:p,isStoryboard:s,isHidden:E},o)}));var tfe="CssClassDecoration-module--SV6Zqo";const nfe=["generating","failed"];function rfe(e){const{children:t,blockKey:n,start:r,end:o,contentState:i,isUvmEnabled:a,inWriteMode:s,data:{opts:{aiSpeechDecoration:{status:c,type:d,tauId:l,hasAudio:u}},temp:{focusedOverdubRange:f}={}}}=e,m="tts"===d,[p,g]=Nue(i,n,r,o,(({opts:{aiSpeechDecoration:e}})=>"failed"===e?.status)),h="failed"===c&&!(m&&s),v=(0,Nt.useMemo)((()=>{const e=m?function(e,t,n){return n?{color:pj(uj.ScratchText,!0)}:"failed"===e?{borderBottomColor:pj(uj.FailedUnderlineOverdubRedesign,!0),textDecorationColor:pj(uj.FailedUnderlineOverdubRedesign,!0)}:"done"===e||"generating"===e||t?{color:pj(uj.SynthesizedText,!0)}:{color:pj(uj.ScratchText,!0)}}(c,u,s):function(e,t){return"failed"===e?{borderBottomColor:pj(uj.FailedUnderlineOverdubRedesign,!0),textDecorationColor:pj(uj.FailedUnderlineOverdubRedesign,!0)}:"done"===e?{borderBottomColor:pj(uj.SynthesizedUnderlineOverdubRedesign,!0)}:"generating"===e?{textDecorationColor:pj(uj.GeneratingTextOverdubRedesign,!0),borderBottomColor:pj(uj.GeneratingTextOverdubRedesign,!0)}:!t||"missingConsent"!==e&&void 0!==e?{color:pj(uj.NewTextOverdubRedesign,!0)}:{color:pj(uj.OverdubMissingConsent,!0),borderBottomColor:pj(uj.SynthesizedUnderlineOverdubRedesign,!0)}}(c,a);return h&&g&&(e.paddingRight="12px",e.position="relative"),e}),[c,m,u,h,g,a,s]),E=l,y="generating"===c,S=!m||c&&nfe.includes(c);return Nt.createElement("span",{style:v,className:yo()({"bg-grey-50-a":S&&f,"AISpeechDecorationContent-module--XipB0b":!m&&y,"AISpeechDecorationContent-module--iRUDG0":m&&y,"AISpeechDecorationContent-module--TOp_gb":v.borderBottomColor}),"data-overdub-tau-id":S?E:void 0,"data-testid":`ai-speech-deco-${c}`},t,h&&g&&Nt.createElement("span",{className:yo()("text-grey-0 absolute pointer-events-none","AISpeechDecorationContent-module--oPWUIL")},Nt.createElement(g1,{color:"var(--orange-500)"})))}function ofe(e){const{data:{opts:{aiSpeechDecoration:t}}}=e;if(void 0===t)return Nt.createElement(Nt.Fragment,null,e.children);const n={...e,data:{...e.data,opts:{...e.data.opts,aiSpeechDecoration:t}}};return Nt.createElement(rfe,{...n})}function ife({data:{opts:{aiSpeechDecoration:e}},children:t}){const n=Nt.useContext(bo),r=(0,Nt.useMemo)((()=>{const t={};if(e){const{color:r,textDecorationColor:o,textDecorationLine:i,textDecorationStyle:a}=function(e){if("missingConsent"===e.status)return{color:uj.ScratchText};const{hasAudio:t,status:n}=e;return"failed"===n?{textDecorationColor:uj.FailedAlignmentUnderline,textDecorationLine:zu.Underline,textDecorationStyle:Vu.Dashed}:"done"===n?{color:uj.SynthesizedText}:t?{color:uj.SynthesizedText,textDecorationColor:uj.GeneratingUnderline,textDecorationLine:zu.Underline,textDecorationStyle:Vu.Dashed}:{color:uj.ScratchText}}(e);void 0!==r&&(t.color=pj(r,n)),void 0!==o&&(t.textDecorationColor=pj(o,n)),t.textDecorationLine=i,t.textDecorationStyle=a}return t}),[n,e]);return Nt.createElement("span",{style:r},t)}function afe(e){return(0,Ft.v9)((0,Nt.useCallback)((t=>HW(t,e)),[e]))}function sfe(e){return Boolean(HW(e,"uvm-voices"))}const cfe=Yc((function(e,{data:{req:{projectId:t,compositionId:n}}}){return{isUvmEnabled:sfe(e),inWriteMode:a7(e,t,n)===NU.Write}}))((function(e){const t=Nt.useContext(bo),n=Boolean(afe("uvm-voices")),{children:r}=e,{aiSpeechDecoration:o}=e.data.opts;if(!o)return Nt.createElement(Nt.Fragment,null,r);const{type:i}=o;return!t||"tts"===i&&!n?Nt.createElement(ife,{...e}):Nt.createElement(ofe,{...e})}));const dfe=new class{constructor(e){this.decorators=e,this.componentCache=new Map}getDecorations(e,t){const n=new Array(e.text.length).fill(null);let r,o=0;return(0,V7.findEntityRanges)(e,(e=>{const t=e.entity;if(!t)return!1;const n=(0,V7.getEntity)(t);if(!n||n.type!==vue)return!1;const o=n.data;let i="",a=!1;for(const{strategy:r}of this.decorators)r(o)?(a=!0,i+="1"):i+=".";return r=i,a}),((e,t)=>{if(r){r+=`:${o}`;for(let o=e;o<t;o++)n[o]=r;o+=1}r=void 0})),n}getComponentForKey(e){const t=this.decorators.length,n=e.substring(0,t),r=this.componentCache.get(n);if(r)return r;const o=[];for(let a=0;a<t;a++)"1"===e[a]&&o.push(this.decorators[a].component);if(0===o.length)throw new Error("unexpected empty component list");function i(e){const{entityKey:t,children:n}=e,r=(0,V7.getEntity)(t).data,i={...e,data:r};let a=Nt.createElement(Nt.Fragment,null,n);for(const s of o)a=Nt.createElement(s,i,a);return a}return this.componentCache.set(n,i),i}getPropsForKey(e){return null}}([{strategy:Xue,component:efe},{strategy:({opts:{foregroundColor:e,textDecoration:t}})=>void 0!==e||Boolean(t),component:function({data:{opts:{foregroundColor:e,textDecoration:t}},children:n}){const r=Nt.useContext(bo),o=(0,Nt.useMemo)((()=>{const n={};if(void 0!==e&&(n.color=pj(e,r)),t){const e=t.style===Vu.Dashed;void 0!==t.color&&(e?n.borderBottomColor=pj(t.color,r):n.textDecorationColor=pj(t.color,r)),e||(n.textDecorationLine=t.line,n.textDecorationStyle=t.style)}return n}),[e,r,t]);return Nt.createElement("span",{style:o,className:yo()(o.borderBottomColor&&"BasicTextDecoration-module--TscOqa"),"data-testid":"text-decoration"},n)}},{strategy:({temp:e})=>void 0!==e?.liveCollabSelection,component:function({children:e,data:{temp:t}}){return Nt.createElement("span",{className:t?.liveCollabSelection?.empty?"LiveCollabDecoration-module--mUh_up":"LiveCollabDecoration-module--o2oLig"},e)}},{strategy:function({opts:e,temp:t={}}){return Boolean(t.hasSelectionDropTarget)&&Boolean(t.hasUnfocusedSelection)&&!t.hasCardRangeDropTarget&&void 0===e.scriptClipTauId&&void 0===e.pinComponentId&&void 0===e.cueId&&!t.hasPendingOverdub},component:function({children:e}){return Nt.createElement("span",{className:yo()(tfe,"CssClassDecoration-module--ENwFow")},e)}},{strategy:function({opts:e,temp:t={}}){return Boolean(t.hasCardRangeDropTarget)&&void 0===e.scriptClipTauId&&void 0===e.pinComponentId&&void 0===e.cueId&&!t.hasPendingOverdub},component:function({children:e}){return Nt.createElement("span",{className:yo()(tfe,"CssClassDecoration-module--ulTWvJ")},e)}},{strategy:function({opts:e,temp:t={}}){return!0},component:function({children:e,data:{opts:t,temp:n={}}}){if(!(n.selectedCardRange&&!n.hasSelectionDropTarget&&!n.isInRecordingReplaceRange&&!n.hasCardRangeDropTarget))return Nt.createElement(Nt.Fragment,null,e);const r="script"===n.selectedCardRange;return Nt.createElement("span",{className:yo()(tfe,{"CssClassDecoration-module--ezXEiQ":!r,"CssClassDecoration-module--y5Ssiz":r})},e)}},{strategy:({temp:e})=>Boolean(e?.hasHiddenPlayhead),component:(lfe=Hue,function({children:e}){return Nt.createElement("span",{id:lfe},e)})},{strategy:e=>Boolean(e.opts.annotationIds&&e.opts.annotationIds.length>0),component:Uue},{strategy:()=>!0,component:function(e){return Bue(e.data)?Nt.createElement(jue,{...e}):Nt.createElement(Nt.Fragment,null,e.children)}},{strategy:({opts:{highlighterId:e}})=>void 0!==e,component:Fue},{strategy:Pue,component:Lue},{strategy:({opts:{aiSpeechDecoration:e}})=>Boolean(e),component:cfe},{strategy:({temp:e,opts:t})=>void 0!==e?.focusedBlockedTauId&&void 0===t.markerId,component:function(e){const{children:t}=e,n=afe("blocked-text-toolbar"),r=e.data.temp?.focusedBlockedTauId;return n&&r?Nt.createElement("span",{className:"bg-grey-50-a","data-blocked-text-tau-id":r},t):Nt.createElement(Nt.Fragment,null,t)}},{strategy:function({opts:e,temp:t={}}){return Boolean(t.hasWordGapSelection)&&void 0===e.scriptClipTauId&&void 0===e.pinComponentId&&void 0===e.cueId&&!t.hasPendingOverdub},component:function({children:e}){return Nt.createElement("span",{className:yo()(tfe,"CssClassDecoration-module--sjZzah")},e)}}]);var lfe;function ufe(){const e=(0,V7.createEmpty)(dfe);return{editorState:e,contentWithoutTemporaryAttrs:e.currentContent,temporaryAttributes:[],modelDataEntityCache:new mle(gue,hue),textMode:iW,blockRangesInfo:Tue(e.currentContent),useStoryboard:!1,showWordlessMedia:!1}}function ffe(e,t,n,r,o,i,a,s,c,d){const l=r||ZG,u=Ib(i);let f=function(e,t,n){const r=Array.from(e.blockMap.values()),o=[];let i=0;const a=(0,V7.makeCharacterMetadata)(),s=t.string;let c=0,d=s.indexOf("\n",c);for(-1===d&&(d=s.length);-1!==d;){const e=km(t,c,d),l=e.string,u=Mue(e,o[o.length-1],n);let f=!1,m=i;for(;m<r.length;){const e=r[m];if(m+=1,e.key.length>0&&e.text===l&&e.type===u){f=!0,o.push(e),i=m;break}}if(!f){const e=(0,V7.makeContentBlock)({key:(0,V7.genKey)(),text:l,characterList:new Array(l.length).fill(a),type:u});o.push(e)}c=d+1,d=s.indexOf("\n",c),-1===d&&c<=s.length&&(d=s.length)}const l=o.map(((e,t)=>{const n=o[t+1];return e.type!==Eue.inlineCardBoundary&&e.type!==Eue.blockLevelCardBoundary||n?.type===Eue.inlineMarkerAfterCardBoundary?e:{...e,type:Eue.unstyled}}));return{...e,blockMap:(0,V7.createFromArray)(l)}}(n.contentWithoutTemporaryAttrs,u,d);const m=Tue(f);f=gfe(e,t,f,Fm(u),Gs.get(0,u.string.length),n.modelDataEntityCache,m,c);const p=f;f=pfe(e,t,f,a,n.modelDataEntityCache,m,c);let g=(0,V7.setEditorState)(n.editorState,{allowUndo:!1});g=(0,V7.pushContent)(g,f,"change-block-data");const h=_ue(f,l,!!o&&n.editorState.selection.hasFocus);return h&&(g=!0===o?(0,V7.forceSelection)(g,h):(0,V7.acceptSelection)(g,h)),{editorState:g,contentWithoutTemporaryAttrs:p,temporaryAttributes:a,blockRangesInfo:m,useStoryboard:c,showWordlessMedia:d}}function mfe(e,t,n,r,o,i,a,s,c,d,l,u){let f=n.contentWithoutTemporaryAttrs;const m=Aue(f,Gs.get(i,0));if(!m)return{};const p=(0,V7.getStartKey)(m),g=(0,V7.getBlockForKey)(f,p),h=i-(0,V7.getStartOffset)(m);let v;s>0&&(v=new Set(function(e,t){return fs(e,((e,n)=>n===t))}(function(e){return ms(e,((e,t)=>1===t))}(ms(f.blockMap.keys(),(e=>e===p))),s)));const E=l(h,a),y={...(0,V7.makeEmptySelection)(p),focusKey:p,anchorOffset:0,focusOffset:g.text.length,hasFocus:o};let S=E.string.indexOf("\n");-1===S&&(S=E.string.length),f=V7.Modifier.replaceText(...function(e,t,n,r){const o=n.string;if(t.anchorKey!==t.focusKey)return[e,t,o];const i=t.focusKey,a=(0,V7.getBlockForKey)(e,i),s=a.text,c=nc(s,o),d=o.substr(c),l=rc(s.substr(c),d),u={...t,anchorOffset:c,focusOffset:s.length-l},f=o.substring(c,o.length-l),m=u,p=(0,V7.getBlockBefore)(e,i),g=Mue(n,p,r);if(g!==a.type&&(e=V7.Modifier.setBlockType(e,m,g)),"inlineCardBoundary"===a.type||"blockLevelCardBoundary"===a.type){const t=(0,V7.getBlockAfter)(e,i);if(t){const n=(0,V7.makeSelectionState)({anchorKey:t.key,anchorOffset:0,focusKey:t.key,focusOffset:t.text.length});e="marker"===t?.type||"inlineMarkerAfterCardBoundary"===t?.type?V7.Modifier.setBlockType(e,n,"inlineMarkerAfterCardBoundary"):V7.Modifier.setBlockType(e,n,"unstyled")}else e=V7.Modifier.setBlockType(e,m,"unstyled")}else"inlineMarkerAfterCardBoundary"===a.type&&(!p||"inlineCardBoundary"!==p.type&&"blockLevelCardBoundary"!==p.type)&&(e=V7.Modifier.setBlockType(e,m,"marker"));return[e,m,f]}(f,y,km(E,0,S),n.showWordlessMedia));const I=S+1;S!==E.string.length&&(f=function(e,t,n,r,o){const i=[];let a=-1,s=n,c=r?(0,V7.getBlockForKey)(e,r):void 0;for(;s<=t.string.length;){a=t.string.indexOf("\n",s),-1===a&&(a=t.string.length);const e=km(t,s,a),n=(0,V7.makeContentBlock)({key:(0,V7.genKey)(),text:e.string,type:Mue(e,c,o)});c=n,i.push(n),s=a+1}const d=e.blockMap,l=r?d.get(r):void 0,u=new Map;for(const[f,m]of d)if(m!==l)u.set(f,m);else{r&&l&&u.set(r,l);for(const e of i)u.set(e.key,e)}return l&&Rue(l,u),{...e,blockMap:u}}(f,E,I,p,n.showWordlessMedia)),v&&v.size>0&&(f=function(e,t){return 0===t.size?e:{...e,blockMap:(0,V7.createFromArray)(Ja(e.blockMap.values(),(e=>!t.has(e.key))))}}(f,v));const b=_ue(f,r,o)||n.editorState.selection;f={...f,selectionAfter:b};const T=Tue(f);f=gfe(e,t,f,Fm(E),Gs.get(h,E.string.length),n.modelDataEntityCache,T,n.useStoryboard);const w=f;f=pfe(e,t,f,c,n.modelDataEntityCache,T,n.useStoryboard),c.length>0&&(f=function(e,t){let n;const r=e.blockMap;for(const[o,i]of t.blockMap.entries()){const e=r.get(o);e&&e!==i&&(0,Me.fastDeepEqual)(e,i)&&(n?n[o]=e:n={[o]:e})}if(n){const e=(0,V7.mergeMapUpdates)(t.blockMap,n);return{...t,blockMap:e}}return t}(n.editorState.currentContent,f));let C=(0,V7.pushContent)(n.editorState,f,"insert-characters");return(0,Me.fastDeepEqual)(b,n.editorState.selection)||(C=n.editorState.selection.hasFocus||b.hasFocus?(0,V7.updateSelection)(C,b,!0):(0,V7.acceptSelection)(C,b)),{editorState:C,contentWithoutTemporaryAttrs:w,temporaryAttributes:c,blockRangesInfo:T}}function pfe(e,t,n,r,o,i,a){let s=0;return r.length>0&&(s=$s(r[r.length-1].range)),gfe(e,t,n,r,Gs.get(0,s),o,i,a,!0,!1)}function gfe(e,t,n,r,o,i,a,s,c=!1,d=!1){if(c&&0===r.length)return n;let l=n;const u=[],f=[];let m=o.location;for(const p of r){const r=Gs.get(p.range.location+o.location,p.range.length);if(!c&&m<r.location){const e=Cue(Gs.get(m,r.location-m),a);for(const t of e){const e=wue(t.key,t.range);u.push({selection:e,modelData:void 0,isBold:!1,isItalic:!1,isInlineNote:!1})}}m=$s(r);const i=Cue(r,a);for(const o of i){const r=wue(o.key,o.range);let i,a,d,l,m,g,h,v,E,y,S,I,b,T,w,C,_,A,R,M,D,O,x,k,N=!1,P=!1,L=!1,F=!1,U=!1,B=!1,j=!1,V=!1,z=!1,G=!1,W=!1,H=!1,q=!1,$=!1,K=!1,Y=!1,Z=!1,J=!1,Q=!1,X=!1,ee=!1,te=!1,ne=!1,re=!1,oe="";for(const e of p.attributes)if(xf(e,Yu))N=!0;else if(xf(e,Zu))P=!0;else if(xf(e,Ju))L=!0;else if(e.name===Gu.Highlight)F=!0,d=e.value;else if(e.name===Gu.Marker)F=!0,a=e.value;else if(e.name===Gu.Pin)F=!0,T=e.value;else if(e.name===Gu.Cue)F=!0,A=e.value;else if(e.name===Gu.Annotation){F=!0,void 0===i&&(i=new Set);const t=e.value;i.add(t)}else if(e.name===Gu.ForegroundColor)F=!0,l=e.value;else if(e.name===Gu.UnfocusedSelection)U=!0,G=!0;else if(e.name===Gu.WordGapSelection)U=!0,W=!0;else if(e.name===Gu.CardRangeDropTarget)U=!0,H=!0;else if(e.name===Gu.SelectedCardRange)U=!0,_=e.value;else if(e.name===Gu.SelectionDropTarget)U=!0,q=!0;else if(e.name===Gu.PinBoundary)U=!0,w=e.value;else if(e.name===Gu.PinHighlight)U=!0,C=e.value;else if(e.name===Gu.TextDecoration)F=!0,m=e.value;else if(e.name===Gu.AISpeechDecoration)F=!0,g=e.value;else if(e.name===Gu.RegionBoundary)F=!0,Y=!0;else if(e.name===Gu.FillerWordBasic)F=!0,ee=!0;else if(e.name===Gu.FillerWordAll)F=!0,te=!0;else if(e.name===Gu.WordError)F=!0,R=e.value;else if(e.name===Gu.RecordingTau)F=!0,ne=!0;else if(e.name===Gu.Playhead)U=!0,e.value?B=!0:j=!0;else if(e.name===Gu.HoveringWord)U=!0,h=e.value;else if(e.name===Gu.EditBoundaryFocusedWord)U=!0,V=!0;else if(e.name===Gu.FocusedOverdubRange)U=!0,z=!0;else if(e.name===Gu.FocusedBlockedTauId)U=!0,v=e.value;else if(e.name===Gu.LiveCollabSelection)U=!0,y=e.value;else if(e.name===Gu.ReplaceSelection)E=n.blockMap.get(o.key)?.type===Eue.scriptClip?"replace-script-clip":"replace",U=!0;else if(e.name===Gu.RecordedOver)E="recorded-over",U=!0;else if(e.name===Gu.StepPreview)E="step-preview",U=!0;else if(e.name===Gu.FindResultCurrent)U=!0,K=!0,$=!0;else if(e.name===Gu.FindResult)U=!0,$=!0;else if(e.name===Gu.ScratchText)F=!0,Q=!0;else if(e.name===Gu.ScriptClip)F=!0,S=e.value;else if(e.name===Gu.RecordingClip)F=!0,I=e.value;else if(e.name===Gu.ParagraphSpeaker)F=!0,b=e.value;else if(e.name===Gu.ActiveParagraph)U=!0,X=!0;else if(e.name===Gu.Tag)F=!0,M=e.value;else if(e.name===Gu.WordGap)F=!0,D=e.value;else if(e.name===Gu.WordlessMedia)F=!0,O=e.value;else if(e.name===Gu.PendingOverdub)U=!0,Z=!0;else if(e.name===Gu.TextCorrection)U=!0,J=!0;else if(e.name===Gu.CardBoundary&&s){const t=e.value;x={cardBoundaryId:t.id,type:t.isInline?"inline":"paragraph-break"},F=!0}else e.name===Gu.TextCursor&&s?(U=!0,re=!0):e.name===Gu.RecordingTarget?(U=!0,oe=e.value):e.name===Gu.SecondaryTextCursor&&s&&(U=!0,k=e.value);const ie=N||P||L;if(F||ie){let n;F&&(n=mue({projectId:e,compositionId:t},{markerId:a,annotationIds:i&&[...i].sort(),highlighterId:d,foregroundColor:l,textDecoration:m,aiSpeechDecoration:g,hasRegionBoundary:Y,isScratchText:Q,scriptClipTauId:S,recordingSession:I,paragraphSpeaker:b,pinComponentId:T,isFillerWordBasic:ee,isFillerWordAll:te,wordError:R,wordTag:M,wordGap:D,wordlessMedia:O,isRecordingTau:ne,cueId:A,cardBoundary:x},c?{}:void 0)),u.push({selection:r,modelData:n,isBold:N,isItalic:P,isInlineNote:L})}if(U){if(!c)continue;const n=mue({projectId:e,compositionId:t},{},{hasTextCursor:re,isInRecordingReplaceRange:E,hasRecordingTarget:oe,hasPlayhead:B,hasHiddenPlayhead:j,hasUnfocusedSelection:G,hasWordGapSelection:W,hasCardRangeDropTarget:H,hasSelectionDropTarget:q,liveCollabSelection:y,pinBoundary:w,pinHighlight:C,selectedCardRange:_,hoverWord:h,editBoundaryFocusedWord:V,focusedOverdubRange:z,focusedBlockedTauId:v,hasFindResult:$,hasFindResultCurrent:K,hasPendingOverdub:Z,hasTextCorrection:J,activeParagraph:X,secondaryCursor:k});f.push({temporaryModelData:n,selection:r})}}}if(c&&f.length>0&&(l=function(e,t,n){const r=[];for(const{temporaryModelData:o,selection:i}of t){const t=(0,V7.getStartKey)(i);if(t!==(0,V7.getEndKey)(i))throw new Error("addTemporaryModelDataEntities only supports same-block selections");const a=(0,V7.getBlockForKey)(e,t),s=(0,V7.getStartOffset)(i),c=(0,V7.getEndOffset)(i);(0,V7.findEntityRanges)(a,(()=>!0),((e,i)=>{if(e=Math.max(s,e),(i=Math.min(c,i))<=e)return;const d={...(0,V7.makeEmptySelection)(t),anchorKey:t,anchorOffset:e,focusKey:t,focusOffset:i},l=a.characterList[e].entity;if(!l)return void r.push([d,hfe(o,n)]);const u=(0,V7.getEntity)(l);if(!u)return void r.push([d,hfe(o,n)]);const f=pue(u.data,o.temp);r.push([d,hfe(f,n)])}))}return V7.Modifier.applyEntities(e,r)}(l,f,i)),!c&&m<$s(o)){const e=Cue(Gs.get(m,$s(o)-m),a);for(const t of e){const e=wue(t.key,t.range);u.push({selection:e,modelData:void 0,isBold:!1,isItalic:!1,isInlineNote:!1})}}return function(e,t,n){let r=e;const o=e.blockMap,i={};let a,s,c,d,l,u,f=0,m=!1,p=!1,g=!1,h=0,v=0;const E=e=>{const i=void 0!==e?e:f;return i>=t.length?(d=void 0,a=void 0,!1):(a=t[i],({selection:s,modelData:c,isBold:m,isItalic:p,isInlineNote:g}=a),({entityKey:l,contentState:r}=Vue(c,r,n)),d=(0,V7.getStartKey)(s),h=(0,V7.getStartOffset)(s),v=(0,V7.getEndOffset)(s),u=o.get(d),f=i+1,!0)};for(E();a;){const e=f-1,t=u.characterList,n=d;let r=!1;t.forEach(((e,t)=>{if(d!==n)return!1;if(t<h)return!0;if(t>=v){if(!E())return!1;if(d!==n)return!1}if(t<h)return!0;const o=e.entity;if(o&&o!==l||!o!==!l)return r=!0,!1;const i=e.style,a=i.has(zue),s=i.has(Gue),c=i.has(Wue);return m===a&&p===s&&g===c||(r=!0,!1)})),r&&(E(e),i[n]=t.map(((e,t)=>{if(d!==n)return e;if(t<h)return e;if(t>=v){if(!E())return e;if(d!==n)return e}if(t<h)return e;let r=!1,o=e.entity,i=e.style;const a=i.has(zue),s=i.has(Gue),c=i.has(Wue);if((o&&o!==l||!o!==!l)&&(o=l,r=!0),m!==a||p!==s||g!==c){const e=new Set;m&&e.add(zue),p&&e.add(Gue),g&&e.add(Wue),i=e,r=!0}return r?(0,V7.makeCharacterMetadata)({style:i,entity:o}):e}))),n===d&&E()}const y=Object.keys(i).reduce(((e,t)=>{const n={...o.get(t),characterList:i[t]};return e[t]=n,e}),{}),S=(0,V7.mergeMapUpdates)(r.blockMap,y);return{...r,blockMap:S}}(l,u,i)}function hfe(e,t){const n=t.getValueForData(e);if(n)return n;(0,V7.createEntity)(vue,"MUTABLE",e);const r=(0,V7.getLastCreatedEntityKey)();return t.setValueForData(r,e),r}var vfe=n(21205);function Efe({doc:e,compositionId:t,playhead:n,replaceInfo:r,hoveringInfo:o,focusedEditBoundaryInfo:i,focusedOverdubHoverInfo:a,focusedBlockedTextHoverInfo:s,isDraggingMedia:c,searchResultTextRanges:d,selectedSearchResultTextRange:l,unfocusedSelection:u,textSelectionRange:f,activePinComponentId:m,pendingOverdubOrTextCorrectionRange:p,liveCollabClients:g,draggedPinComponentEndpointId:h,selectedCardState:v,isDraggingIntoCardInScript:E,isDraggingIntoCardInCanvas:y,draggedCardBoundaryId:S,recordingTargetSelection:I,cardStepping:b,trackedSelections:T,wordGapInfo:w}){const C=[];if(n&&C.push({range:n.renderedRange,attribute:n.isHidden?Xu:Qu}),i&&C.push({range:i.wordAfterBoundaryRange,attribute:hf}),a&&C.push({range:a.textSelectionRange,attribute:vf}),s){const n=GV(e,t).tausAndDataForBasicAttributedString().getTauDataMaybe(s.tauId);if(n){const e=Gs.get(n.textOffset,n.basicAttributedString.attrString.string.length);C.push({range:e,attribute:(_=s.tauId,{name:Gu.FocusedBlockedTauId,value:_})})}}var _;if("text"===o?.type)jU(e,t,o.renderedRange,((n,r,i,a,s,d)=>{if(EE(e)&&d&&s){const n=SB(e,t,o.renderedRange);if(n)return void C.push({range:c?{location:o.renderedRange.location,length:1}:n.range,attribute:Ef({willPlay:o.hasAltKey,isDraggingMedia:c,isAfterWord:!0,isInCardRange:!1})})}if(s)return;let l=r.location;const u=PP(e,t,n.id).string;if(1===u.length&&u===Ka)return;for(;l<u.length&&!Ms.contains(u.charAt(l))&&"\n"!==u.charAt(l);)l+=1;let f=!1;if(u.length>0&&l===u.length&&(l-=1,f=!0),l<u.length&&!Ms.contains(u.charAt(l)))for(f=!0;l>=0&&!Ms.contains(u.charAt(l));)l-=1;const m=dc(u,Gs.get(l,1));if(m&&!h){const r=kU(e,t,n.id,m,{wordlessMedia:!1});C.push({range:r,attribute:Ef({willPlay:o.hasAltKey,isDraggingMedia:c,isAfterWord:f,isInCardRange:!1})})}}));else if(e.isStoryboard&&"card"===o?.type&&v?.startBoundaryId!==o.cardBoundaryId&&void 0===S){const n=eT(e,t,o.cardBoundaryId),r=n?pT(e,t,n):void 0;r&&r.length>0&&C.push({range:r,attribute:Ef({willPlay:!1,isDraggingMedia:c,isAfterWord:!1,isInCardRange:!0})})}if(e.isStoryboard&&r&&v?.startBoundaryId!==r.cardBoundaryId){const n=eT(e,t,r.cardBoundaryId),o=n?pT(e,t,n):void 0;o&&o.length>0&&C.push({range:o,attribute:"step-preview"===r.variant?nf:tf})}if(d)for(const N of d)C.push({range:N,attribute:Ws(N,l)?af:of});if(e.isStoryboard&&c){const r=function({doc:e,compositionId:t,hoveringInfo:n,playhead:r,isDraggingIntoCardInScript:o,isDraggingIntoCardInCanvas:i}){if(o&&n)switch(n.type){case"text":return vT(e,t,n.renderedRange.location);case"card":return eT(e,t,n.cardBoundaryId)}if(i&&r)return vT(e,t,r.renderedRange.location);return}({doc:e,compositionId:t,hoveringInfo:o,playhead:n,isDraggingIntoCardInScript:E,isDraggingIntoCardInCanvas:y});if(r){const n=pT(e,t,r);n.length>0&&C.push({range:n,attribute:qu})}}if(e.isStoryboard&&C.push({range:yfe(e,t,f),attribute:ef}),c&&"text"===o?.type&&Ks(f,o.renderedRange)&&C.push({range:f,attribute:Hu}),u&&C.push({range:u,attribute:Wu}),I&&C.push({attribute:tf,range:tp(I)?zT(e,t,I):I}),b.length>0&&b.forEach((n=>{const r=eT(e,t,n.cardId);if(r){const n=mT(e,t,r);n.length>0&&C.push({range:n,attribute:rf})}})),"all"===v?.highlight){const n=eT(e,t,v.startBoundaryId);if(n){const r=pT(e,t,n);if(r.length>0){const n=v.activeLayerId?kw(e,t,v.activeLayerId):void 0;n&&"script"===Ky(e,n.sourceSceneId)?C.push({range:r,attribute:bf("script")}):m||C.push({range:r,attribute:bf("card")})}}}if(g)for(const{userId:N,clientId:P,range:L}of g)C.push(yf(tp(L)?zT(e,t,L):L,N,P));w?.textRange&&w.textRange.length>0&&C.push({range:w.textRange,attribute:$u});for(const N of function*(e,t,n,r){const o=[];"text"===n?.type&&o.push(n.renderedRange.location);r&&o.push(r.location);let i,a;if(o.sort(Te),0===o.length)return;const s=Fb(e,t);for(const c of o){let e,t;for(const n of s.parts){const r=n.start;for(const o of Ja(n.attrStr.attributes,(({attribute:e})=>e.name===Gu.ParagraphSpeaker))){if(!(o.range.location+r<=c))break;e=o.range.location+r,t=o.range.length}}if(void 0!==e&&void 0!==t&&(e!==i||t!==a)){void 0===Es.index(s.string,Gs.get(e,c-e))&&(yield{range:Gs.get(e,t),attribute:Ku}),i=e,a=t}}}(e,t,o,u?void 0:f))C.push(N);if(void 0!==m){let n;void 0!==h&&"text"===o?.type&&(n=o.renderedRange.location);const r=function(e,t,n,r){const o=EE(e),i=FB(e,t,n);if(i){const n=Kx(e,t,i),a=zB(e,t,i),[s]=bP(e,i.sceneId).slice(-1);let c=zT(e,t,{offset:n,duration:a});if("cardBoundary"===i.endAnchor?.type&&(c=Gs.getStartEnd(c.location,Math.min($s(c),qb(e,t,vU(e,t,i.endAnchor.cardBoundaryId)).location))),void 0!==r){let o=VT(e,t,n+Math.max(-i.offsetFromAnchor,0)).location;o===c.location&&(o=c.location+1);const d=tL(e,s),l=d-BP(e,i.sceneId,s.id);let u;d!==1/0&&(u=VT(e,t,n+a+l).location);let f=Math.max(r,o);void 0!==u&&(f=Math.min(u,f)),c=Gs.get(c.location,f-c.location)}if(c.length>0){let n=c.location,r=$s(c);const i=(n,r,i,a,s,c)=>{if(s)return o?{location:i.location+a,length:i.length}:void 0;if(o&&c)return{location:i.location+a,length:i.length};let d=r.location;const l=PP(e,t,n.id).string;for(;d>0&&d<l.length&&!Ms.contains(l.charAt(d));)d-=1;const u=dc(l,Gs.get(d,1));let f;return u&&(f=kU(e,t,n.id,u)),o&&(!f||$s(f)<i.location+a)?{location:i.location+a,length:i.length}:f},a=BU(e,t,Gs.get(c.location,1),i),s=BU(e,t,Gs.get($s(c)-1,1),i);if(void 0!==a&&void 0!==s)return n=qs(a),r=$s(s),{pinRange:Gs.get(n,r-n),firstWord:a,lastWord:s}}}}(e,t,m,n);if(r){const{pinRange:n,firstWord:i,lastWord:a}=r,s=UB(e,t,m);if(e.isStoryboard||hd(s.offsetFromAnchor,0)||os(wb(Fb(e,t),i.location),(({name:e})=>e===Gu.Pin))||C.push({range:i,attribute:Sf("start")}),e.isStoryboard||os(wb(Fb(e,t),$s(a)),(({name:e})=>e===Gu.Pin))||C.push({range:a,attribute:Sf("end")}),e.isStoryboard)if(void 0!==v?.activeLayerId){const r=eT(e,t,v.startBoundaryId);if(r){const o=pT(e,t,r),i=Math.max(n.location,o.location),a=$s(o),s=$s(n),c=Math.min(a,s);i<c&&C.push({attribute:If("storyboardActiveLayer"),range:Gs.getStartEnd(i,c)})}}else C.push({attribute:If("storyboardActiveLayer"),range:n});else h?C.push({attribute:If("boundaryDrag"),range:n}):"text"===o?.type&&o.renderedRange.location===$s(n)?C.push({attribute:If("boundaryHover"),range:n}):C.push({attribute:If("pinClick"),range:n})}}if(p){const{range:e,type:t}=p;"overdub"===t?C.push({range:e,attribute:pf}):"correction"===t&&C.push({range:e,attribute:ff})}const A=Vb(e,t),R=Fb(e,t);let M="before",D=Math.min(f.location,Math.max(A-1,0));for(;D>0&&Es.contains(R.string[D]);)D-=1,M="after";const O=Gs.get(D,1),x=dc(R.string,O);if(C.push({range:x??O,attribute:{...mf,value:M}}),e.isStoryboard&&T&&T.size>0)for(const[N,P]of T)C.push({range:yfe(e,t,Gs.get(Math.min(P.loc+P.delta,P.loc),Math.abs(P.delta))),attribute:(k="var(--red-500)",{name:Gu.SecondaryTextCursor,value:k})});var k;return C.sort(((e,t)=>e.range.location===t.range.location?e.range.length-t.range.length:e.range.location-t.range.location)),Nf(C)}function yfe(e,t,n){const r=Fb(e,t).string,o=void 0!==Es.index(r.charAt(n.location))?n.location-1:n.location,i=Gs.get(o,1);return dc(r,i)??i}function Sfe(e,t,n){if(e===t)return n;const r=Math.min(e.parts.length,t.parts.length);for(let o=0;o<r;o++){const r=e.parts[o],i=t.parts[o];if(r.attrStr!==i.attrStr){const o=r.attrStr,a=o.string.length,s=i.attrStr,c=s.string.length,d=Math.min(c,a,n-i.start),l=Gm(o.attributes,s.attributes,d);if(l+i.start===n)return n;if(l<Math.min(a,c))return r.start+l;if(l===a&&l===c)continue;return r.start+l+Sfe(bb(e,r.start+l),bb(t,i.start+l),n-r.start-l)}if(r.end>=n)break}return Math.min(n,e.string.length,t.string.length)}function Ife(e,t,n){if(e===t)return n;const r=e.parts;let o=r.length;const i=t.parts;let a=i.length;const s=Math.min(o,a);for(let c=0;c<s;c++){o-=1,a-=1;const s=r[o],c=i[a];if(s.attrStr!==c.attrStr){const r=Math.max(0,n-c.start),o=s.attrStr,i=o.string.length,a=c.attrStr,d=a.string.length,l=Hm(o.attributes,a.attributes,i,d,r);if(0!==r&&r===l)return n;const u=d-l;if(l>0&&u<Math.min(i,d))return c.start+l;if(0===l&&i===d)continue;return Ife(bb(e,0,s.end-u),bb(t,0,c.end-u),n)}if(s.start<=n)break}return n}function bfe(e,t,n){const r=Sfe(e,t,n?n.location:Math.min(e.string.length,t.string.length));if(r===t.string.length)return;let o=r;if(n){const r=e.string.length-$s(n);o=t.string.length-r}const i=Ife(e,t,o);return Gs.get(r,i-r)}function Tfe(e,t){if(e===t)return;const n=function(e,t){const n=e.parts,r=t.parts;for(let o=0;o<n.length;o++){const i=n[o],a=r[o];if(!a)return i.start;if(i.attrStr!==a.attrStr&&i.attrStr.string!==a.attrStr.string)return i.start+nc(e.string.substring(i.start),t.string.substring(i.start))}return Math.min(e.string.length,t.string.length)}(e,t),r=function(e,t,n){const r=Math.min(e.string.length,t.string.length)-n,o=e.parts;let i=o.length;const a=t.parts;let s=a.length;const c=e.string.length-r;for(let d=0;d<o.length;d++){i-=1,s-=1;const n=o[i],d=a[s];if(!d)return e.string.length-n.end;if(n.attrStr!==d.attrStr&&n.attrStr.string!==d.attrStr.string){const o=e.string.length-n.end;return Math.min(r,o+rc(e.string.substring(0,n.end),t.string.substring(0,d.end)))}if(n.start<=c)break}return r}(e,t,n),o=Gs.get(n,e.string.length-r-n),i=bfe(e,t,n!==t.string.length||n!==e.string.length?o:void 0)||Gs.get(o.location,t.string.length-r-o.location),a=t.string.length-e.string.length,s=i.length-a,{location:c,length:d}=i;return 0!==s||0!==d?{loc:c,removed:s,added:d}:void 0}function wfe(e,t){return TW(e,t).searchState}function Cfe(e,t){return wfe(e,t).textSearchFilter}function _fe(e,t){return wfe(e,t).highlightsSearchFilter}function Afe(e,t){return wfe(e,t).searchType}function Rfe(e,t){return function(e,t){return wfe(e,t).searchScope}(e,t)===n3.Composition?OW(e,t):void 0}const Mfe=(0,el.createSelector)([MW,Rfe],((e,t)=>t3(e,t,"all"))),Dfe=(0,el.createSelector)([MW,Rfe],((e,t)=>t3(e,t,"basic")));const Ofe=(0,el.createSelector)([function(e,t){return yH(e,t)?Mfe(e,t):Dfe(e,t)},function(e,t){return wfe(e,t).fillerWordsSearchFilter}],((e,t)=>{if(!t)return e;if(0===t.size)return{...e,results:[]};const n=fu(e.results,(e=>{const{match:n,matchedComposition:r}=e;if(!n.text?.positions)return;const o=fu(n.text.positions,(e=>{let n=r.text.substr(e.textRange.location,e.textRange.length);return n=function(e){let t=0;for(;t<e.length&&!Ms.contains(e[t]);)t+=1;let n=e.length-1;for(;n>=0&&!Ms.contains(e[n]);)n-=1;return e.substring(t,Math.max(t,n+1))}(n).toUpperCase(),t.has(n)?e:nj.has(n)?void 0:t.has(tj)?e:void 0}));return 0!==o.length?{...e,match:{...n,text:{...n.text,positions:o}}}:void 0}));return{...e,results:n}}));const xfe=(0,el.createSelector)([MW,Rfe,function(e,t){return wfe(e,t).textListSearchFilter}],((e,t,n)=>function(e,t,n){const r=Date.now(),o=[];if(void 0===n)return{results:[],getPositionWithTime:X5};const i=void 0!==t?[J5(e,t)]:Q5(e);for(const a of i){const t=Fb(e,a.id).string,r=[];for(const o of n){const n=re(t,o);if(!n)continue;const i=Gs.getStartEnd(n.startIndex,n.endIndex),s=jT(e,a.id,i);r.push({timeRange:s,textRange:i})}r.length>0&&o.push({matchedComposition:a,match:{text:{positions:r}},type:"ai_action_clips"})}return{results:o,searchDuration:Date.now()-r,getPositionWithTime:e3}}(e,t,n))),kfe=(0,el.createSelector)([MW,Rfe,Cfe,function(e,t){return wfe(e,t).matchWholeWords},function(e,t){return wfe(e,t).caseSensitive}],((e,t,n,r,o)=>function(e,t,n,r=!1,o=!1){const i=Date.now();if(n.length<1)return{results:[],getPositionWithTime:X5};const a=[];let s=$5()(n);EE(e)&&(s=s.split(" ").join("[ \u2500-\u2505]* "));const c=new RegExp(r?`\\b${s}\\b`:s,"g"+(o?"":"i"));(void 0!==t?[J5(e,t)]:Q5(e)).forEach((e=>{const t={matchedComposition:e,match:{},type:"text"};let n=!1;["name","text"].forEach((r=>{const o=e[r].toString();let i;for(t.match[r]={positions:[]};i=c.exec(o);)i&&(n=!0,t.match[r]?.positions.push({textRange:Gs.get(i.index,i[0].length)}))})),n&&a.push(t)}));const d=Date.now()-i;return{results:a,searchDuration:d,getPositionWithTime:(t,n)=>"text"!==t.type?X5(0,n):{...n,timeRange:jT(e,t.matchedComposition.id,n.textRange)}}}(e,t,n,r,o))),Nfe=(0,el.createSelector)([MW,Rfe,function(e){return e.userPreferences.search.wordGapFilter}],((e,t,n)=>function(e,t,n){const r=Date.now(),o=void 0!==t?[J5(e,t)]:Q5(e),i=[];for(const a of o){const t={matchedComposition:a,match:{},type:"word_gaps"};let r;t.match.text={positions:[]};const o=bP(e,a.id),s=o.length;for(let i=0;i<s;i++){const s=o[i],{id:c,audioSegment:d,isBlocked:l}=s,u=nN(e,a.id,c),f=FP(e,a.id,c);if(u&&d&&!l){const s=u.length;for(let c=0;c<=s;c++){let l;if(0===c)l=0===s?{offset:f,duration:_F(d)}:{offset:f,duration:JB(Wg(u,c),d)},r&&(l=up(r,l));else if(c===s){const e=Wg(u,c-1);l={offset:f+QB(e,d),duration:Math.max(0,d.offset+_F(d)-e.endTime)}}else{const e=Wg(u,c),t=Wg(u,c-1);l={offset:f+QB(t,d),duration:e.startTime-t.endTime}}c===s&&(r=l,i<o.length-1)||l.duration>n&&t.match.text.positions.push({timeRange:l,textRange:zT(e,a.id,l)})}}else EN(s)?r=r?{offset:r.offset,duration:r.duration+_F(s.audioSegment)}:{offset:f,duration:_F(s.audioSegment)}:(r&&r.duration>n&&t.match.text.positions.push({timeRange:r,textRange:zT(e,a.id,r)}),r=void 0)}t.match.text.positions.length>0&&i.push(t)}return{results:i,searchDuration:Date.now()-r,getPositionWithTime:e3}}(e,t,n))),Pfe=(0,el.createSelector)([MW,Rfe,_fe],((e,t,n)=>function(e,t,n){const r=Date.now(),o=[];if(void 0!==n){const r=void 0!==t?[J5(e,t)]:Q5(e);for(const t of r){const r=[];FU(e,t.id,n===K5?void 0:n,!0).forEach((n=>{const o=jT(e,t.id,n);r.push({timeRange:o,textRange:n})})),r.length>0&&o.push({matchedComposition:t,match:{text:{positions:r}},type:"text"})}}return{results:o,searchDuration:Date.now()-r,getPositionWithTime:e3}}(e,t,n)));const Lfe=(0,el.createSelector)([MW,Afe,_fe,Cfe,Pfe,function(e,t){return wfe(e,t).ignoredRanges},(e,t)=>function(e,t,n){switch(n){case Y5.FillerWords:return Ofe(e,t);case Y5.WordGaps:return Nfe(e,t);case Y5.AiActionClips:return xfe(e,t);case Y5.Text:default:return kfe(e,t)}}(e,t,Afe(e,t))],((e,t,n,r,o,i,a)=>{let s;return s=t===Y5.Text&&0===r.length&&void 0!==n?o:void 0!==n?function(e,t,n){const r=Date.now(),o=[];for(const i of t.results){const t=Fb(e,i.matchedComposition.id);if(i.match.text){const e=[];for(const r of i.match.text.positions){let o;for(const i of Ab(t,Gu.Highlight,r.textRange)){if(n!==K5&&n!==i.value||!(qs(i.range)<=(o?$s(o):qs(r.textRange))))break;if(o=i.range,$s(o)>=$s(r.textRange)){e.push({...r});break}}}e.length>0&&o.push({matchedComposition:i.matchedComposition,match:{text:{positions:e}},type:i.type})}}return{results:o,searchDuration:t.searchDuration??0+Date.now()-r,getPositionWithTime:t.getPositionWithTime}}(e,a,n):a,s=(0,T.ZP)(s,(e=>{e.results.forEach((e=>{if(!i[e.matchedComposition.id])return;const t=i[e.matchedComposition.id];e.match.text?.positions&&(e.match.text.positions=e.match.text.positions.filter((e=>!t.some((t=>e.textRange.length===t.length&&e.textRange.location===t.location)))))})),e.results=e.results.filter((e=>e.match.text?.positions.length||e.match.name?.positions.length))})),s})),Ffe=(0,el.createSelector)([Lfe],(e=>{const t=[];for(const n of e.results)n.match.text?.positions.forEach((e=>t.push({compositionId:n.matchedComposition.id,range:e.textRange})));return t})),Ufe=(0,el.createSelector)([Lfe],(e=>{const t={};for(const n of e.results){const e=[];n.match.text?.positions.forEach((t=>e.push(t.textRange))),t[n.matchedComposition.id]=e}return t}));function Bfe(e,t){let n=0;for(const r of e.results)if(r.match.text){const o=r.match.text.positions;if(t<n+o.length){const i=o[t-n],a=e.getPositionWithTime(r,i);return{compositionId:r.matchedComposition.id,range:a.textRange,timeRange:a.timeRange}}n+=o.length}}const jfe=(0,el.createSelector)([Lfe,function(e,t){const{selectedResultIndex:n}=wfe(e,t);if(void 0===n)return;const r=Ffe(e,t);return 0!==r.length?K(n,0,r.length-1):void 0}],((e,t)=>void 0!==t?Bfe(e,t):void 0));const Vfe="tabIdStorageKey";let zfe;void 0!==zfe&&"undefined"!==typeof window&&window.addEventListener("beforeunload",(()=>{if(void 0!==zfe)try{sessionStorage.setItem(Vfe,zfe)}catch{}}));const Gfe="jdp1",Wfe="gzjdp1",Hfe="noop";Error;Error;Error;Error;class qfe extends Error{constructor(e){super(e),this.name="LiveCollabUnsupportedDeltaError"}}var $fe=n(21063);n(89742);n(1762);Symbol("delete");const Kfe={success:!1};const Yfe=new class{encode(e){return w((0,$fe.iv)(e))}decode(e){const t=C(e);return(0,$fe.rr)(t,{to:"string"})}},Zfe=new class{encode(e){return e}decode(e){return e}};const Jfe={decode:(e,t)=>e!==Wfe?Kfe:{success:!0,result:JSON.parse(Yfe.decode(t))}},Qfe={decode:(e,t)=>e!==Gfe?Kfe:{success:!0,result:JSON.parse(Zfe.decode(t))}},Xfe={decode:(e,t)=>e!==Hfe?Kfe:{success:!0,result:void 0}};new class{constructor(e){this.decoderMap=e}decode(e,t){const n=this.decoderMap.get(e);if(void 0===n)throw new qfe(`Unsupported delta serialization format: ${e}`);return n.decode(e,t)}}(new Map([[Gfe,Qfe],[Wfe,Jfe],[Hfe,Xfe]]));function eme(e,t){return e.collab?.projectClients[t]}const tme=(0,el.createSelector)(eme,((e,t,n)=>n),((e,t)=>{if(void 0!==e)return fu(e,(({userId:e,clientId:n,presence:r,self:o,timestamp:i})=>{const a=r?.selection;if(!o&&n!==zfe&&"composition"===r?.item?.type&&r.item.id===t&&a&&!tp(a)&&i&&Date.now()-new Date(i).getTime()<1e4)return{userId:e,clientId:n,range:JG(a)}}))}));function nme(e,t){if("live-collab"!==SH(e,t)?.docSyncMetadata?.type)return;const n=CH(e,t);return Boolean(n&&["pending","saving"].includes(n.localSave))}let rme;function ome({enabled:e,deviceId:t},n){return e&&t?n.find((e=>e.id===t))??function(e){return e.find((e=>e.is_default))}(n)??n[0]:void 0}Me.fastDeepEqual;function ime(e){return e.recording.editor.mode}function ame(e){const t=function(e){return e.recording.devices.audioDevices}(e);return ome(e.recording.editor.tracks.microphone,t)}function sme(e){const t=function(e){return e.recording.devices.videoDevices}(e);return ome(e.recording.editor.tracks.camera,t)}Me.fastDeepEqual;function cme(e){return e.recording?.editor.cardStepping||bu()}const dme={},lme=(0,el.createSelector)([MW,xW,(e,t,n)=>hme(e,t,n)],((e,t,n)=>{const r=Iue(n.editorState.currentContent,n.editorState.selection);return BT(e,t.id,r)})),ume=(0,Yl.createCachedSelector)([MW,(e,t)=>t,(e,t,n)=>n,function(e,t,n,r){return Boolean(HW(e,"absolute-position-playhead"))?{renderedRange:Gs.get(0,0),isHidden:!0}:cee(e,t,n,r)},function(e,t,n){return CW(e,t,n).replaceInfo},H6,function(e,t,n){return CW(e,t,n).focusedEditBoundaryInfo},function(e,t,n){return CW(e,t,n).focusedOverdubHoverInfo},function(e,t,n){return CW(e,t,n).focusedBlockedTextHoverInfo},t7,function(e,t,n){const r=UW(e,t);if(!(!r&&"ProjectSearch"!==e.ui.sidebarPrimaryTab||r&&!e.project.isSearchingProject||Afe(e,t)===Y5.WordGaps))return Ufe(e,t)[n]},function(e,t,n){const r=UW(e,t);if(!r&&"ProjectSearch"!==e.ui.sidebarPrimaryTab||r&&!e.project.isSearchingProject)return;const o=jfe(e,t);return o?.compositionId===n?o.range:void 0},function(e,t,n){const{hasFocus:r}=_W(e,t,n);if(r)return;const o=ree(e,t,n);return eW(o)?void 0:JG(o)},oee,c7,i7,tme,function(e,t){return TW(e,t).draggedPinComponentEndpointId},K7,(e,t)=>"ScriptPinToCard"===Q6(e,t),(e,t)=>"CanvasPinToCard"===Q6(e,t),Z6,e=>{if(e.recording)return e.recording.editor.targetData&&"replace-selection"===e.recording.editor.targetData.type?e.recording.editor.targetData.range:void 0},e=>cme(e),(e,t,n)=>function(e,t,n){return _W(e,t,n).trackedSelections}(e,t,n),see,function(e,t,n){return CW(e,t,n).isShowingWordGapDurationInput}],((e,t,n,r,o,i,a,s,c,d,l,u,f,m,p,g,h,v,E,y,S,I,b,T,w,C,_)=>{const A=Y7(0,t,n),R=dme[A],M=Efe({doc:e,compositionId:n,playhead:r,replaceInfo:void 0,hoveringInfo:!0===i?.hasAltKey?i:void 0,focusedEditBoundaryInfo:void 0,focusedOverdubHoverInfo:void 0,focusedBlockedTextHoverInfo:void 0,isDraggingMedia:d,searchResultTextRanges:l,selectedSearchResultTextRange:u,unfocusedSelection:f,textSelectionRange:m,activePinComponentId:p,pendingOverdubOrTextCorrectionRange:g,liveCollabClients:h,draggedPinComponentEndpointId:v,selectedCardState:E,isDraggingIntoCardInScript:y,isDraggingIntoCardInCanvas:S,draggedCardBoundaryId:I,recordingTargetSelection:b,cardStepping:T,trackedSelections:w,wordGapInfo:_?C:void 0});return kf(R,M)?R:(dme[A]=M,M)}))(Y7);function fme(e){return Array.from(e.values()).map((e=>({...e,key:"compare",characterList:e.characterList.map((e=>({data:e.entity?(0,V7.getEntity)(e.entity).data:void 0,style:e.style})))})))}const mme={};let pme=!1;const gme=(0,Yl.createCachedSelector)(((e,t)=>t),((e,t,n)=>n),MW,ree,aee,ume,a7,((e,t,n,r,o,i,a)=>{const s=Y7(0,e,t),c=mme[s],d=D.getValue("Script.compareToFullRebuild",!1,"Compares the results of the full rebuild to the optimized update of the script")&&!pme;let l;if(d){l=ffe(e,t,ufe(),r,o,Fb(n,t),i,0,Boolean(n.isStoryboard),EE(n)).editorState.currentContent.blockMap}const u=function(e,t,n,r,o,i,a,s,c){if(c&&c.compositionId!==n)throw new Error("deriveEditorState called with mismatch between previous composition id and current composition id");const d=Fb(e,n);if(!c||c.isStoryboard!==Boolean(e.isStoryboard)){const a=ufe(),s={...a,...ffe(t,n,a,r,o,d,i,0,Boolean(e.isStoryboard),EE(e))};return{compositionId:n,fastAttributedString:d,descriptEditorState:s,textSelection:r,isStoryboard:Boolean(e.isStoryboard)}}if(s){const a={...c.descriptEditorState,...ffe(t,n,c.descriptEditorState,r,o,d,i,0,Boolean(e.isStoryboard),EE(e))};return{compositionId:n,fastAttributedString:d,descriptEditorState:a,textSelection:r,isStoryboard:Boolean(e.isStoryboard)}}const l=c.fastAttributedString,u=d,f=function(e,t,n,r){if(e===t)return;const[o,i]=Mb(e,Math.min(e.string.length,n)),[a,s]=Mb(t,Math.min(t.string.length,r)),c=Tfe(o,a),d=Tfe(i,s);if(!c)return d?{...d,loc:o.string.length+d.loc}:void 0;if(!d)return c;const l=Tfe(e,t);return l&&0===d.loc&&0===c.removed&&c.loc+c.added===r?{loc:c.loc,added:c.added+d.added,removed:d.removed}:l}(l,u,tW(c.textSelection),tW(r));if(!f)return{compositionId:n,fastAttributedString:d,descriptEditorState:vme(e,t,n,r,o,i,a,c.descriptEditorState),textSelection:r,isStoryboard:Boolean(e.isStoryboard)};const{loc:m,added:p,removed:g}=f;0;const h=oc(l.string,"\n",m,m+g),v=1+oc(u.string,"\n",m,m+p),E={...c.descriptEditorState,...mfe(t,n,c.descriptEditorState,r,o,m,v,h,i,0,((t,r)=>jb(e,n,t,r)),c.descriptEditorState.blockRangesInfo)};return{compositionId:n,fastAttributedString:d,descriptEditorState:E,textSelection:r,isStoryboard:Boolean(e.isStoryboard)}}(n,e,t,r,o,i,a,!1,c);if(d&&l){const s=fme(l),d=fme(u.descriptEditorState.editorState.currentContent.blockMap),f=(0,vfe.qu)(s,d),m=(0,vfe.qu)(d,s);if(f.length>0||m.length>0){pme=!0,console.error("Optimized script update differs from full update: ",f,m);const s=`FullVSOptimizedScriptUpdateError_${(0,vce.Z)(new Date,"yyyy_MM_dd_HH_mm_ss")}.json`,d=rme;d&&d(s,JSON.stringify({projectId:e,compositionId:t,doc:n,textSelection:r,hasFocus:o,temporaryAttributes:i,textMode:a,prevResult:c}))}}return mme[s]=u,u}))(Y7);function hme(e,t,n){return gme(e,t,n).descriptEditorState}function vme(e,t,n,r,o,i,a,s){const c=_ue(s.editorState.currentContent,r,o),d=Boolean(e.isStoryboard),l=EE(e);if(i===s.temporaryAttributes&&d===s.useStoryboard&&l===s.showWordlessMedia&&a===s.textMode&&(0,Me.fastDeepEqual)(c,s.editorState.selection))return s;const u={...s.contentWithoutTemporaryAttrs,selectionAfter:c||s.editorState.selection},f=pfe(t,n,u,i,s.modelDataEntityCache,s.blockRangesInfo,d);return{editorState:(0,V7.pushContent)(s.editorState,f,"apply-entity"),contentWithoutTemporaryAttrs:u,temporaryAttributes:i,textMode:a,modelDataEntityCache:s.modelDataEntityCache,blockRangesInfo:s.blockRangesInfo,useStoryboard:d,showWordlessMedia:l}}var Eme=n(63803),yme="Popover-module--g7wumR",Sme="Popover-module--aJTM9x",Ime="Popover-module--Swiwep",bme="Popover-module--qHOmpa",Tme="Popover-module--H4Vm4i",wme="Popover-module--R7ZhZc",Cme="Popover-module--pHg77f",_me="Popover-module--MQfCaM",Ame="Popover-module--FTzOma",Rme="Popover-module--LYudLU",Mme="Popover-module--DnrDZB",Dme="Popover-module--Zq1OnU";const Ome=()=>{},[xme,kme]=(0,Qr.k)("Popover",{isOpen:!1,setIsOpen:Ome});function Nme({open:e,onOpenChange:t,modal:n=!0,...r}){const[o,i=Ome]=d2(e,t);return Nt.createElement(xme,{isOpen:o,setIsOpen:i},Nt.createElement(Fce.fC,{...r,modal:n,open:o,onOpenChange:i}))}const Pme=Nt.forwardRef((function({className:e,hasBorder:t=!0,...n},r){return Nt.createElement(e0,{asChild:!0,className:e},Nt.createElement("div",{ref:r,className:yo()({"border-b border-grey-100-a":t}),...n}))})),Lme=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement(o0,{ref:n,variant:"label-1-medium",ellipsisOverflow:!0,className:yo()("text-grey-900 px-2",Mme,e),...t})})),Fme=Nt.forwardRef((function({className:e,...t},n){const{setIsOpen:r}=kme("Popover.CloseButton"),o=Pr((()=>r(!1)));return Nt.createElement(Yo,{ref:n,"aria-label":"Close",className:yo()(e,"absolute top-0 right-0 mt-1 mr-2"),...t,onClick:(0,wo.M)(t.onClick,o)},Nt.createElement(V1,null))})),Ume=(Fce.ee,Fce.xz),Bme=Nt.forwardRef((function({className:e,sideOffset:t=8,unstyled:n=!1,children:r,portal:o=!0,elevation:i=10,hidden:a,hasArrow:s=!1,...c},d){const l=(0,Nt.useRef)(_r),u=(0,s2.e)(d,l),f=(0,Nt.useRef)(a),m=(0,Nt.useContext)(Ao),p=(0,Nt.useContext)(bo);(0,Nt.useEffect)((()=>{f.current=a}),[a]),function({hidden:e,ref:t}){Nt.useEffect((()=>{const n=requestAnimationFrame((()=>{let n=t.current?.closest("[data-radix-portal]");for(;n&&n.parentElement?.closest("[data-radix-portal]");)n=n.parentElement.closest("[data-radix-portal]");n&&(n.style.zIndex=e?"-1":"",n.style.visibility=e?"hidden":"visible")}));return()=>{n&&cancelAnimationFrame(n)}}),[e,t])}({ref:l,hidden:a});const g=Nt.createElement(roe,null,Nt.createElement(Fce.VY,{ref:u,className:yo()(e,"relative","portal-layer",bme,S[`elevation${i}`],{[Rme]:!n},s&&Dme),collisionPadding:8,sideOffset:s?t-8:t,"data-redesign":p||void 0,...c,onDoubleClick:(0,wo.M)(c.onDoubleClick,Fr),onEscapeKeyDown:(0,wo.M)(c.onEscapeKeyDown,Fr)},r,s&&Nt.createElement(Vme,null)));return o?Nt.createElement(Fce.h_,{container:m?.current},g):g})),jme=Nt.forwardRef((function(e,t){return Nt.createElement("div",{ref:t,className:"relative"},Nt.createElement("div",{className:yme}),Nt.createElement("div",{className:Ime},Nt.createElement("div",{className:Sme})))}));function Vme(){return Nt.createElement(Fce.Eh,{asChild:!0},Nt.createElement(jme,null))}const zme=V7.Editor;function Gme(e,t){let n=e%t;return n<0&&(n+=t),n}function Wme(e,t,n,r){let o=e.currentContent;(0,V7.createEntity)(`${n.type}-${Ps()}`,"IMMUTABLE",n.data),o=V7.Modifier.replaceText(e.currentContent,t,`${"MENTION"===n.type?"":"+"}${r}`,void 0,(0,V7.getLastCreatedEntityKey)());const i=(0,V7.pushContent)(e,o,"apply-entity");return o=i.currentContent,o=V7.Modifier.replaceText(o,o.selectionAfter," "),(0,V7.pushContent)(i,o,"insert-characters")}function Hme(e){const[t,n]=(0,Nt.useState)(void 0),r=(0,Nt.useCallback)((()=>{const n=window.getSelection();if(!n||0===n.rangeCount)return;if(function(e){const t=e.selection;if(!t.hasFocus)return!1;const n=e.currentContent,r=(0,V7.getBlockForKey)(n,(0,V7.getStartKey)(t));return Boolean((0,V7.getEntityAt)(r,(0,V7.getStartOffset)(t)-1))}(e))return;const r=n.getRangeAt(0);let o=r.startContainer.textContent;if(!o)return;o=o.substring(0,r.startOffset);const i=/(?:^|[ ])([@+])/gi.exec(o),a=t?t.start:i?i.index+(i[0].startsWith(" ")?1:0):-1;return-1!==a?(o=o.substring(a),{text:o,start:a,end:r.startOffset}):void 0}),[e,t]),o=(0,Nt.useRef)(_r);(0,Nt.useEffect)((()=>{const e=r();if(!e)return void n(void 0);const t=window.getSelection();if(!t||0===t.rangeCount)return;const i=t.getRangeAt(0).cloneRange();if(i.endOffset<e.start)return;i.setStart(i.startContainer,e.start);const a=i.getBoundingClientRect();let[s,c]=[a.left,a.bottom];if(o.current){const e=o.current.getBoundingClientRect();s-=e.left,c-=e.top}n((t=>t?.text===e.text&&t?.start===e.start&&t.end===e.end?t:{left:s,top:c,selectedIndex:0,...e}))}),[r]);const i=(0,Nt.useCallback)((e=>{e.preventDefault(),n(void 0)}),[n]),a=(0,Nt.useCallback)(((e,t)=>n((n=>n?(e.preventDefault(),{...n,selectedIndex:n.selectedIndex+t}):n))),[n]),s=(0,Nt.useCallback)((e=>a(e,-1)),[a]),c=(0,Nt.useCallback)((e=>a(e,1)),[a]);return{typeaheadState:t,setTypeaheadState:n,handleEscape:i,handleUpArrow:s,handleDownArrow:c,editorContainer:o}}function qme(e){if(e.type.startsWith("MENTION-"))return e.data}function $me(e){if(e.type.startsWith("INVITE-"))return e.data}const Kme=new V7.CompositeDecorator([{strategy:function(e,t,n){(0,V7.findEntityRanges)(e,(e=>{const t=e.entity;return Boolean(t&&qme((0,V7.getEntity)(t)))}),t)},component:function({entityKey:e,email:t,children:n}){const r=t||(e?(0,V7.getEntity)(e)?.data?.email:void 0);return Nt.createElement(ei,{title:r,className:"AnnotationTextFormDecorator-module--emNiaa",hasNonInteractiveTrigger:!0},Nt.createElement("span",null,n))}},{strategy:function(e,t,n){(0,V7.findEntityRanges)(e,(e=>{const t=e.entity;return Boolean(t&&$me((0,V7.getEntity)(t)))}),t)},component:function({children:e}){return Nt.createElement("span",{className:"AnnotationTextFormDecorator-module--jo9oSg AnnotationTextFormDecorator-module--R85ta4"},e)}}]),Yme=Kme;var Zme="AnnotationTextForm-module--HzSUr2";const Jme=new Set;const Qme=[],Xme=(0,Nt.createContext)({togglePlaybackWhileCommenting:!1});function epe(e,t){return e?.filter((({name:e,email:n})=>e.toLowerCase().startsWith(t.toLowerCase())||n.toLowerCase().startsWith(t.toLowerCase())))??Qme}const tpe=/^[@|+]/,npe=(0,Nt.memo)((function({selectedIndex:e,text:t,users:n,currentUser:r,onClick:o}){const i=Nt.useContext(bo),a=(0,Nt.useRef)(_r),s=(0,Nt.useCallback)(((e,t)=>{Ur(e),o(t)}),[o]),c=epe(n,t.replace(tpe,"")),d=Gme(e,c.length);return(0,Nt.useEffect)((()=>{a.current&&(0,Jce.Z)(a.current,{behavior:"smooth",scrollMode:"if-needed",block:"nearest"})}),[d]),Nt.createElement("div",{className:"MentionsTypeahead-module--S8fw_d"},0===c.length?Nt.createElement("div",{className:"MentionsTypeahead-module--ANPXOT"},"Use ",Nt.createElement("span",{className:Zme},"@")," or"," ",Nt.createElement("span",{className:Zme},"+")," to mention somebody or invite them to this project."):c.map(((e,t)=>{const n=t===d,o=!!r&&e.id===r.id;return Nt.createElement("button",{type:"button",key:e.id,ref:n?a:void 0,className:n?"MentionsTypeahead-module--FKLI4i":"MentionsTypeahead-module--mLI8H7",onMouseDown:Ur,onClick:e=>s(e,t)},Nt.createElement(Tce,{initials:e.initials,name:e.name,color:e.color(o,i),profileImage:e.profileImageCdnUrl,size:30}),Nt.createElement("div",{className:"MentionsTypeahead-module--nUL6iA"},Nt.createElement(o0,{weight:"bold",ellipsisOverflow:!0},e.name),Nt.createElement(o0,{color:"subtext",ellipsisOverflow:!0},e.email)))})))})),rpe=(0,V7.createEmpty)(Yme),ope=(0,Nt.memo)((function({projectId:e,compositionId:t,onSave:n,onRequestLayout:r,onCancelClick:o,isExpanded:i,isCta:a,focusOnRender:s}){const c=Nt.useContext(bo);(0,Nt.useEffect)((()=>{const e=setTimeout((()=>r?.()),100);return()=>clearTimeout(e)}));const{togglePlaybackWhileCommenting:d}=(0,Nt.useContext)(Xme),{projectUsers:l}=(0,Nt.useContext)(fle),u=(0,Nt.useRef)(!1),[f,m]=(0,Nt.useState)(rpe),{pause:p,play:g}=Zte(),h=(0,Ft.v9)(f7),v=(0,Nt.useRef)(!1);!function(e){const t=(0,Ft.I0)(),[n]=(0,Nt.useState)((()=>Ps())),r=e.selection.hasFocus;(0,Nt.useEffect)((()=>{r?Jme.add(n):Jme.delete(n),t(p4({enabled:0===Jme.size}))}),[t,r,n]),(0,Nt.useEffect)((()=>()=>{Jme.delete(n),t(p4({enabled:0===Jme.size}))}),[t,n])}(f);const E=(0,Nt.useCallback)((()=>{m(rpe)}),[]),y=(0,Nt.useCallback)((e=>{const t=!(0,V7.hasText)(e.currentContent);u.current?t&&(u.current=!1):m(e)}),[]),[S,I]=(0,Nt.useState)(!1),b=S||!(0,V7.hasText)(f.currentContent),T=(0,Nt.useRef)({saveDisabled:b}),w=(0,Nt.useRef)(_r),{typeaheadState:C,setTypeaheadState:_,handleEscape:A,handleUpArrow:R,handleDownArrow:M,editorContainer:D}=Hme(f);(0,Nt.useEffect)((()=>{if(s||b!==T.current.saveDisabled){w.current?.focus();const e=setTimeout((()=>{D.current&&(0,Jce.Z)(D.current,{scrollMode:"if-needed"})}),150);return()=>clearTimeout(e)}}),[D,s,b]);const O=(0,Ft.v9)((0,Nt.useCallback)((t=>(l||MH(t,e))?.sort(((e,t)=>e.name.localeCompare(t.name)))),[e,l])),x=(0,Nt.useCallback)((e=>{if(!C)return"not-handled";const{text:t}=C,n=e??C.selectedIndex,r=f.currentContent.selectionAfter,o={...r,anchorOffset:r.focusOffset-t.length},i=t.replace(tpe,""),a=epe(O,i),s=a[Gme(n,a.length)];if(s)m(Wme(f,o,{type:"MENTION",data:s},s.name));else if(ae(i))m(Wme(f,o,{type:"INVITE",data:{inviteEmail:i}},i));else{const e=V7.Modifier.replaceText(f.currentContent,o,i),t=(0,V7.pushContent)(f,e,"delete-character");m(t)}return _(void 0),"handled"}),[f,_,C,O]),{invitedEmails:k,invitedEmailsCount:N}=(0,Nt.useMemo)((()=>function(e){const t=e.currentContent,n=[];let r=0,o=0;for(const i of t.blockMap.values())(0,V7.findEntityRanges)(i,(e=>{const t=e.entity;if(!t)return!1;const i=(0,V7.getEntity)(t),a=$me(i);a&&(n.push(a.inviteEmail),o++,r++);const s=qme(i);return s&&(n.push(s.email),r++),!1}),(()=>{}));return{invitedEmails:n,allEmailsCount:r,invitedEmailsCount:o}}(f)),[f]),P=k.join(", ").replace(/, ([^,]*)$/,", and $1"),L=(0,Ft.v9)(Cl),F=(0,Ft.I0)(),U=(0,Nt.useCallback)((e=>{if(b)return;Ur(e);const t=function(e){let t,n,r,o=e.currentContent,i=0;for(const a of o.blockMap.values())i=0,(0,V7.findEntityRanges)(a,(e=>{const o=e.entity;if(!o)return!1;const i=qme((0,V7.getEntity)(o));return!!i&&(t=i,n=a,r=o,!0)}),((e,a)=>{if(!t||!n)return;const s=`+${t.email}`,c=(0,V7.makeSelectionState)({anchorKey:n.key,anchorOffset:e,focusKey:n.key,focusOffset:a,isBackward:!1,hasFocus:!1});o=V7.Modifier.replaceText(o,{...c,anchorOffset:c.anchorOffset+i,focusOffset:c.focusOffset+i},s,void 0,r),i+=s.length-(c.focusOffset-c.anchorOffset)}));return o}(f),r=(0,V7.convertFromDraftStateToRaw)(t),o=(0,Eme.I)(r);void 0!==L?(n(o,k),i?I(!0):E()):F(OK())}),[b,f,L,n,k,i,F,E]),j=(0,Nt.useCallback)((e=>{Ur(e),E(),u.current=!0,o?.()}),[E,o]),V=(0,Nt.useCallback)((e=>{if("typeahead"===e)return"handled";if("save"===e&&!b)return U(),"handled";const t=V7.RichUtils.handleKeyCommand(f,e);return t?(y(t),"handled"):"not-handled"}),[f,U,y,b]),z=(0,Nt.useCallback)((e=>{if("Enter"===e.key){if("handled"===x())return"typeahead";if(!(t=e).altKey&&B()?Boolean(t.metaKey):Boolean(t.ctrlKey))return"save"}var t;if(e.keyCode===Vr.TAB&&"handled"===x())return"typeahead";const n=C?.text.replace(tpe,"");return" "===e.key&&n&&ae(n)&&"handled"===x()?"typeahead":(0,V7.getDefaultKeyBinding)(e)}),[x,C]),G=(0,Nt.useCallback)((()=>"not-handled"),[]),W=(0,Nt.useCallback)((()=>w.current?.focus()),[]),[H,q]=(0,Nt.useState)("bottom"),[$,K]=(0,Nt.useState)(_r);return(0,Nt.useEffect)((()=>{if(!$)return;let e=!1;const t=new MutationObserver((()=>{e||(q($.getAttribute("data-side")??"bottom"),e=!0)}));return t.observe($,{attributes:!0,attributeFilter:["data-side"]}),()=>t.disconnect()}),[$]),Nt.createElement("div",{className:yo()("AnnotationTextForm-module--blbU5V Annotations-module--uQEcjU",{"AnnotationTextForm-module--yzrD24":i,"AnnotationTextForm-module--G_Dl5I":a})},L?Nt.createElement(Tce,{initials:L.initials,name:L.name,color:L.color(!0,c),profileImage:L.profileImageCdnUrl,size:30}):Nt.createElement("div",{style:{width:"30px"}}),Nt.createElement(Nme,{open:Boolean(C),modal:!1},Nt.createElement(Ume,{asChild:!0},Nt.createElement("div",{className:yo()("AnnotationTextForm-module--JAqvRO",{"AnnotationTextForm-module--tvBhXk":C&&"top"===H,"AnnotationTextForm-module--NPp76K":C&&"bottom"===H}),onClick:W,ref:D},Nt.createElement(zme,{webDriverTestID:"comment-input",ref:w,editorState:f,onChange:y,keyBindingFn:z,handleKeyCommand:V,handleBeforeInput:G,onEscape:A,onUpArrow:R,onDownArrow:M,readOnly:S,onFocus:()=>{d&&h&&(p(),v.current=!0)},onBlur:e=>{d&&v.current&&document.activeElement!==e.target&&(g(),v.current=!1)},placeholder:a?"Add a comment":void 0}),a&&Nt.createElement("button",{type:"button","aria-label":"Create comment",className:yo()("AnnotationTextForm-module--VkVN1a",{"AnnotationTextForm-module--yfvNqB":b}),onClick:U},Nt.createElement(f1,null)))),Nt.createElement(Bme,{ref:K,unstyled:!0,side:H,sideOffset:0,className:"AnnotationTextForm-module--YHocOS",style:{width:D.current?window.getComputedStyle(D.current).width:void 0},onOpenAutoFocus:Lr},Nt.createElement(npe,{text:C?.text??"",selectedIndex:C?.selectedIndex??0,users:O,currentUser:L,onClick:x}))),N>0&&Nt.createElement("div",{className:"AnnotationTextForm-module--Isnybt"},"After posting, we'll send email to ",P," to invite them to the project."),!a&&Nt.createElement("div",{className:"AnnotationTextForm-module--TZ2gTu"},Nt.createElement(W0,{variant:"light",onClick:j},"Cancel"),Nt.createElement(W0,{disabled:b,onClick:U},S?Nt.createElement(u0,{color:"white",width:18}):"Post")))})),ipe=ope;const ape=function({projectId:e,onSave:t}){const n=(0,Ft.I0)(),[r,o]=(0,Nt.useState)(""),{projectUsers:i}=(0,Nt.useContext)(fle),a=(0,Ft.v9)(Cl),s=!r,c=(0,Ft.v9)((t=>(i||MH(t,e))?.sort(((e,t)=>e.name.localeCompare(t.name))))),d=Pr((()=>{if(s)return;if(void 0===a)return void n(OK());const e=Cde(r),i=Array.from(e.matchAll(/data-mention-email="([^"]+)"/g)).map((e=>e[1]));t(e,i),o("")}));return Nt.createElement(Nt.Fragment,null,a&&Nt.createElement(e0,{className:"border-t border-grey-100-a"},Nt.createElement(Tce,{initials:a.initials,name:a.name,color:a.color(!0,!0),profileImage:a.profileImageCdnUrl,size:30})),Nt.createElement(e0,{className:"items-end"},Nt.createElement(Fde,{value:r,onValueChange:o,currentUser:a,mentionableUsers:c,onReply:d})))};const spe=Yc((function(e,{projectId:t,compositionId:n}){return{editorState:hme(e,t,n).editorState,currentTime:h7(e,"composition"),currentUser:Cl(e)}}))((function({projectId:e,compositionId:t,currentUser:n,currentTime:r,editorState:o}){const i=(0,Ft.I0)(),a=Nt.useContext(bo),s=function(e){const t=(0,Ft.oR)();return Pr(((...n)=>e(t.getState(),...n)))}(MW),c=Pr(((a,c)=>{if(!n)return;let d={};if(o.selection.focusOffset!==o.selection.anchorOffset)d=Sue(o.currentContent,o.selection);else{const n=s(e),{range:o}=FT(n,t,r)||{};o&&(d=o)}const l=new Aee({id:Ps(),text:a,projectId:e,sceneId:t,segmentTimeOffset:r,user:n,subscriberEmails:c,segmentTextOffsetLocation:d?.location,segmentTextOffsetLength:d?.length,isNew:!1});i(tJ({projectId:e,compositionId:t,annotation:l}))}));return a?Nt.createElement(ape,{projectId:e,onSave:c}):Nt.createElement("div",{className:"AnnotationsSidebarCta-module--ZTiO7a"},Nt.createElement(ipe,{projectId:e,compositionId:t,onSave:c,isCta:!0}))}));function cpe(e,t){const n=t.reduce(((e,{email:t,name:n})=>{const r=`+${t}`;let o=e;for(;o.includes(r);)o=o.replace(r,Pde(n,t));return o}),e);return n.replace(new RegExp(`(?:^|[ ])\\+(${ie.source})`,"gi"),(e=>Pde(e,e)))}function dpe(e){const t=(0,Ft.I0)(),n=Pr((n=>{const r=e||("string"===typeof n?n:void 0);r&&requestAnimationFrame((()=>{t(r9({annotationIds:new Set([r])}))}))}));return n}const lpe=Nt.forwardRef((function({text:e,...t},n){const[r,o]=(0,Nt.useState)(!1),i=Pr((t=>{e&&(t.stopPropagation(),K2()(e),o(!0))}));return(0,Nt.useEffect)((()=>{if(!r)return;const e=setTimeout((()=>{o(!1)}),1500);return()=>{clearTimeout(e)}}),[r]),r?Nt.createElement(ei,{title:"Copied!",asChild:!0,visible:!0},Nt.createElement("button",{ref:n,type:"button",onClick:i,...t})):Nt.createElement(ei,{title:"Copy",asChild:!0,enabled:Boolean(e)},Nt.createElement("button",{ref:n,type:"button",onClick:i,...t}))}));const upe=Yc((function(e,{annotation:{id:t}}){return{currentUser:Cl(e),isSelected:uQ(e,t),isHovering:fQ(e,t),comments:cQ(e,t),isReplying:mQ(e,t),isExpanded:ZJ(e,t)}}))((function({hasArchivePermission:e,projectId:t,compositionId:n,annotation:r,annotationTimeOffset:o,comments:i,currentUser:a,isSelected:s,isHovering:c,isClosestToPlayhead:d,isReplying:l,sharePageUrl:u,isExpanded:f}){const{projectUsers:m}=(0,Nt.useContext)(fle),p=(0,Ft.v9)((0,Nt.useCallback)((e=>(m||MH(e,t))?.sort(((e,t)=>e.name.localeCompare(t.name)))),[t,m])),g=(0,Ft.I0)(),h=o??r.segmentTimeOffset,v=(0,Nt.useMemo)((()=>void 0!==h?wd(h):"0:00"),[h]),E=dpe(r.id),y=Pr((e=>{e.target instanceof HTMLAnchorElement?g(iZ({url:e.target.href})):(g(yq({playerKey:"composition",origin:void 0,timeOffset:h,scrubbing:!1})),E())})),S=(0,Nt.useRef)(_r),I=Pr((e=>{const o=Array.from(e.matchAll(/data-mention-email="([^"]+)"/g)).map((e=>e[1]));if(g(V8({visible:!0})),r.isNew)r.text=e,r.subscriberEmails=o,g(tJ({projectId:t,compositionId:n,annotation:r}));else{const i=new Ree(Ps(),r.id,e,a);i.subscriberEmails=o,g(rJ({projectId:t,compositionId:n,annotationId:r.id,comment:i}))}})),b=Pr((()=>{r.isArchived?g(uJ({projectId:t,annotation:r,skipApi:!1})):g(lJ({projectId:t,annotation:r,skipApi:!1}))})),T=Pr((()=>{r.isNew&&g(lJ({projectId:t,annotation:r,skipApi:!0}))})),w=Pr((e=>{g(e?iJ({annotationId:r.id}):aJ({annotationId:r.id}))})),C=(0,Nt.useRef)(!0);Nt.useEffect((()=>{const e=document.querySelectorAll(":hover");S.current&&!e[e.length-1]?.closest("#comments-sidebar")&&(s||c||d&&C.current)&&(0,Jce.Z)(S.current,{scrollMode:"if-needed",block:C.current?"center":"nearest",behavior:C.current?void 0:"smooth"}),C.current=!1}),[s,c,d]);const _=Nt.useMemo((()=>{if(!u)return;return function(e,t){const n=new URL(e);return n.searchParams.set("selectedAnnotation",t),n.toString()}(s8(u,h),r.id)}),[u,h,r.id]),A=r.user.id===a?.id||e;return Nt.createElement(Bde,{ref:S,timeOffset:u?Nt.createElement(lpe,{text:_},v):v,onReply:I,isNew:r.isNew,isActive:s||c,isArchived:r.isArchived,onResolve:A&&!r.isNew?b:void 0,currentUser:a,onClick:y,mentionableUsers:p,isReplying:r.isNew,onDiscard:T,replyCount:i?.length,focusOnMount:r.isNew||l,showingReplies:f,onShowingRepliesChange:w,"data-testid":"annotation-thread-root"},!r.isNew&&Nt.createElement(jde,{user:r.user,createdAt:r.createdAt,content:r.text,"data-testid":"annotation-thread-comment"},i?.map((e=>Nt.createElement(jde,{key:e.id,user:e.user,createdAt:e.createdAt,"data-testid":"annotation-thread-comment",content:(0,ule.renderToStaticMarkup)(Nt.createElement(zce.Z,null,cpe(e.text,p||[])))})))))}));const fpe=Yc((function(e,{projectId:t,compositionId:n}){return{isLoading:e.annotations.isLoading||e.drive.isLoading,annotations:rQ(e,t,n),annotationTimeOffsetMap:aQ(e,t,n),archivedAnnotations:oQ(e,t,n),playheadTime:h7(e,"composition"),selectedAnnotation:lQ(e,t),isEditMode:a7(e,t,n)===NU.EditMedia,selectionHasFocus:aee(e,t,n)}}))((function({annotations:e,annotationTimeOffsetMap:t,hasArchivePermission:n,archivedAnnotations:r,disabled:o,isLoading:i,projectId:a,compositionId:s,onClose:c,showCommentBox:d,playheadTime:l,selectedAnnotation:u,isEditMode:f,selectionHasFocus:m,sharePageUrl:p}){const[g,h]=(0,Nt.useState)("Timestamp"),[v,E]=one(),y=v?r:e,S=(0,Nt.useMemo)((()=>{const e=[...y];switch(g){case"Timestamp":return e.sort((({segmentTimeOffset:e,segmentTextOffsetLocation:t},{segmentTimeOffset:n,segmentTextOffsetLocation:r})=>v?t-r:void 0!==e&&void 0!==n?e-n:t-r));case"Oldest":return e.sort((({createdAt:e},{createdAt:t})=>e.getTime()-t.getTime()));case"Newest":return e.sort((({createdAt:e},{createdAt:t})=>t.getTime()-e.getTime()));default:return y}}),[y,g,v]),I=(0,Nt.useMemo)((()=>{const e=rh(S,(({segmentTimeOffset:e})=>oh(e-l)));return e.match?.value.id||e.next?.value.id}),[S,l]);let b;const T=(0,Ft.I0)(),w=KX(),C=Pr((()=>{T(r9({annotationIds:void 0}))}));(0,Nt.useEffect)((()=>{if(u&&(f||!m))return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)};function e(e){"Escape"!==e.key||!u||!f&&m||(C(),e.stopImmediatePropagation())}}),[C,f,u,m]),Hr((()=>{w((e=>{S.forEach((t=>{t.isNew&&e(lJ({projectId:a,annotation:t,skipApi:!0}))}))}))}));const _=(0,Nt.useRef)(_r),A=Pr((()=>{u&&_.current&&_.current.scrollToIndex({index:S.findIndex((e=>e===u)),align:"center"})}));return(0,Nt.useEffect)(A,[A]),b=i?Nt.createElement("div",{className:"AnnotationsSidebar-module--viJA0Q"},Nt.createElement(u0,null)):0===S.length?Nt.createElement("div",{className:"p-3 stack gap-2"},Nt.createElement("div",{className:"row gap-2"},Nt.createElement(Zo,{className:"bg-grey-50-a",rounded:!0},Nt.createElement(oae,null)),Nt.createElement(o0,{variant:"body-1-medium",className:"text-grey-800 px-2"},v?"No archived comments":"No comments")),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 "},o||p?void 0:v?"Archived comments will appear here":"Select text to add a comment")):Nt.createElement(w2,{handle:_,data:S},(e=>Nt.createElement(Nt.Fragment,{key:e.id},Nt.createElement(upe,{hasArchivePermission:n,annotation:e,annotationTimeOffset:t.get(e.id),projectId:a,compositionId:s,isClosestToPlayhead:I===e.id,sharePageUrl:p}),Nt.createElement(Hse,{className:"my-0"})))),Nt.createElement("div",{className:"bg-grey-0 h-full stack",id:"comments-sidebar"},Nt.createElement(sle,{density:"normal"},"Comments",Nt.createElement(ale,null),Nt.createElement(Woe,null,Nt.createElement(Hoe,{asChild:!0},Nt.createElement(Yo,{"aria-label":"Comment options","data-testid":"comment-sidebar-options"},Nt.createElement(lle,null))),Nt.createElement(tie,null,Nt.createElement(Zoe,{value:g,onValueChange:h},Nt.createElement(Joe,{label:"Sort by timestamp",value:"Timestamp"}),Nt.createElement(Joe,{label:"Sort by oldest",value:"Oldest"}),Nt.createElement(Joe,{label:"Sort by newest",value:"Newest"})),Nt.createElement(Qoe,null),Nt.createElement(Yoe,{label:"Show archived comments",checked:v,onCheckedChange:E}))),Nt.createElement(Yo,{onClick:c,"aria-label":"Close comments","data-testid":"close-comments-sidebar"},Nt.createElement(V1,null))),Nt.createElement(Hse,{className:"m-0"}),b,Nt.createElement("div",{className:"flex-1",onClick:C}),d&&Nt.createElement(spe,{projectId:a,compositionId:s}))}));const mpe=Yc((function(e,t){const{projectId:n,compositionId:r}=t;return{project:Fee(e),currentUser:Cl(e),annotations:rQ(e,n,r),comments:QJ(e),annotationTimeOffsets:aQ(e,n,r),hideTimeTooltip:void 0!==e.ui.hoveringAnnotationIds,hoveringAnnotation:e.ui.hoveringAnnotationIds?.values().next().value,isPlaying:u7(e,"composition")}}))((function({annotations:e,comments:t,annotationTimeOffsets:n,duration:r,projectId:o,compositionId:i,isMobile:a,currentUser:s,hoveringAnnotation:c,project:d,isPlaying:l,...u}){const f=(0,Ft.I0)(),{togglePlayback:m}=Zte(),p=(0,Nt.useCallback)((e=>f(yq({playerKey:"composition",origin:"toolbar",timeOffset:e,scrubbing:!1}))),[f]),[g,h]=(0,Nt.useState)(!1),v=(0,Nt.useCallback)((()=>{h(!1),f(o9({annotationIds:void 0}))}),[f]),E=dpe(),y=(0,Nt.useCallback)((e=>{void 0!==s?(v(),f(i9({annotationId:e})),f(V8({visible:!0}))):f(OK())}),[s,f,v]),S=d?.comments_enabled?Nt.createElement(Kce,{annotations:e,isMobile:a,comments:t,activeAnnotation:g?c:void 0,setSelectedAnnotation:E,clearHoverAnnotation:v,duration:r,currentUser:s,annotationTimeOffsets:n,openAnnotation:y}):void 0,I=function(e,t){const{timedJumpToItems:n}=(0,Ft.v9)((0,Nt.useCallback)((n=>({timedJumpToItems:nee(n,e,t)})),[e,t]));return(0,Nt.useMemo)((()=>n.map((({jumpToItem:{title:e},timeOffset:t})=>({timeOffset:t,text:e})))),[n])}(o,i);return Nt.createElement(Zie,{...u,duration:r,seekTo:p,sections:I,togglePlayback:m,isPlaying:l,gutterClassName:yo()({"PublishedScrubberBar-module--pl03so":!!S})},S)}));function ppe({type:e}){const t=(0,Nt.useRef)(!1),{play:n,pause:r,togglePlayback:o}=Zte(),i=Pr((()=>{t.current||(rt("share_player_media_played",{type:e,context:Wte()}),t.current=!0)}));return{play:Pr((()=>{i(),n()})),pause:r,togglePlayback:Pr((()=>{i(),o()}))}}var gpe=n(63496);const hpe=e=>{if(e){if(wee(e.contents)){const t=function(e,t){if(!wee(e.contents))return;const n=e.contents.media.original;return n&&n.variants&&t in n.variants?n.variants[t]:void 0}(e,bee.WithStudioSound);if(_ee(t))return t?.cdn_url??t?.url}return e.contents.media.original?.cdn_url??e.contents.media.original?.url}};function vpe({project:e,canLoadMedia:t=!0}){const n=(0,Nt.useContext)($te),r=(e=>{if(e){if(wee(e.contents)){const t=Cee(e,bee.WithStudioSound);if(_ee(t))return t?.cdn_url??t?.url}return e.contents.media.stream?.cdn_url??e.contents.media.stream?.url}})(e),o=hpe(e),[i,a,s]=Nr(!0);(0,Nt.useEffect)((()=>{a()}),[a,r]),(0,Nt.useEffect)((()=>{if(t&&i)return function(e,t,n){let r,o=()=>{};if(!t)return o;function i(){if(t)if(gpe.Z.isSupported()&&e){const r=new gpe.Z({maxBufferLength:30,startPosition:0,debug:!1});r.attachMedia(t),t.dataset.mediaSrc="hls",r.on(gpe.Z.Events.MEDIA_ATTACHED,(()=>{r.loadSource(e)})),r.on(gpe.Z.Events.ERROR,(function(t,o){if(o.fatal)switch(o.type){case gpe.Z.ErrorTypes.NETWORK_ERROR:r.recoverMediaError(),r.startLoad();break;case gpe.Z.ErrorTypes.MEDIA_ERROR:r.recoverMediaError();break;default:r.destroy(),n(),Ra(o.error,"share-page-hlsjs-error",{extra:{streamUrl:e,hlsjsErrorData:{type:o.type,details:o.details,buffer:o.buffer,bytes:o.bytes,mimeType:o.mimeType,reason:o.reason}}})}})),o=()=>{try{r.detachMedia(),r.removeAllListeners(gpe.Z.Events.MEDIA_ATTACHED),r.removeAllListeners(gpe.Z.Events.ERROR),r.destroy()}catch(E0){Ra(E0,"hlsjs-unmount",{extra:{streamUrl:e}})}}}else n()}t.canPlayType("application/vnd.apple.mpegurl")&&e?(t.src=e,t.dataset.mediaSrc="hls",r=async n=>{n.stopImmediatePropagation(),Ra(ea(t.error),"share-page-native-hls-error",{extra:{streamUrl:e}}),i()},t.addEventListener("error",r,{once:!0})):i(),t.load(),t.pause();const a=()=>{const e=d8();e?.start&&(t.currentTime=e.start)};return t.addEventListener("loadedmetadata",a,{once:!0}),()=>{t.removeEventListener("loadedmetadata",a),r&&t.removeEventListener("error",r),o()}}(r,n.current,s)}),[i,s,r,t,n]),(0,Nt.useEffect)((()=>{if(!i)return function(e,t){if(!t)return()=>{};var n,r;n=t,(r=e)&&(n.src=r,n.dataset.mediaSrc="original"),t.load(),t.pause();const o=()=>{const e=d8();e?.start&&(t.currentTime=e.start)};return t.addEventListener("loadedmetadata",o,{once:!0}),()=>{t.removeEventListener("loadedmetadata",o)}}(o,n.current)}),[o,n,i])}class Epe{constructor(e){this.mediaElement=e,this.type="html5",this.durationInitialized=!1,this.waitingForDecodeCount=0,this.shutdown=async()=>{await this.stop()},this.play=async()=>{const e=Date.now();return this.mediaElement.currentTime=this.currentTime,await this.mediaElement.play(),{totalMs:Date.now()-e}},this.pause=async()=>(await this.stopAndSeek(this.currentTime),!0),this.seek=async(e,t,n)=>{const r=Date.now(),o=this.mediaElement;return o.readyState>=HTMLMediaElement.HAVE_ENOUGH_DATA||!this.isPlaying?(o.currentTime=e,{totalMs:Date.now()-r}):t&&this.isPlaying?{totalMs:Date.now()-r}:await new Promise((t=>{o.oncanplay=()=>(o.oncanplay=null,{totalMs:Date.now()-r}),o.currentTime=e}))},this.setPlaybackRate=async e=>{this.mediaElement.playbackRate=e},this.durationInitialized=!isNaN(this.mediaElement.duration),this.durationInitialized||(this.mediaElement.ondurationchange=()=>{this.durationInitialized=!0,this.mediaElement.ondurationchange=null})}getAudioMeterForKey(e){}getAudioEffectForId(e){}get isPlaying(){return!this.mediaElement.paused}get duration(){return this.durationInitialized?this.mediaElement.duration:0}get currentTime(){return this.mediaElement.currentTime}get isSeekable(){return void 0!==this.mediaElement.seekable}async stop(){await this.stopAndSeek(0)}async stopAndSeek(e){this.mediaElement.pause(),await this.seek(e,!1)}}function ype(){const e=(0,Nt.useContext)($te),t=(0,Ft.I0)(),n=(0,Ft.v9)(Fee),r=(0,Ft.v9)(jee),o=(0,Ft.v9)(Uee),i=n?.contents.media.stream?.cdn_url,a=n?.contents.media.original.cdn_url,s=(0,Nt.useRef)(0);(0,Nt.useEffect)((()=>{if(!o)return;const r=e.current;function c(){t(Y4())}function d(){if(!r||!n?.id||!n?.published_scene_id)return;const e=new Epe(r),o=function(e,t){return{playerKey:e,media:t}}("composition",WT(n.id,n.published_scene_id));t(Oq({playable:e,source:o})),t(kq({projectId:n.id,compositionId:n.published_scene_id}));const i=d8();i&&t(yq({playerKey:"composition",timeOffset:i.start,origin:void 0,scrubbing:!1})),t(Z4())}function l(){if(!r)return;const e=new Error("Failed to load source media");t(J4({error:e})),Ra(ea(r.error),"share-page-media-element-error",{extra:{publishedProjectId:n?.id,publishedProjectUrlSlug:n?.url_slug,url:a,streamUrl:i}})}function u(){if(V())if("visible"===document.visibilityState){const t=e.current;t&&t.paused&&(t.load(),t.currentTime=s.current)}else if("hidden"===document.visibilityState){const t=e.current;t&&t.paused&&(s.current=t.currentTime)}}return r?(r.addEventListener("error",l),r.addEventListener("loadstart",c,{once:!0}),r.addEventListener("loadeddata",d,{once:!0}),r.addEventListener("loadedmetadata",d,{once:!0}),document.addEventListener("visibilitychange",u),()=>{r.removeEventListener("error",l),r.removeEventListener("loadstart",c),r.removeEventListener("loadeddata",d),document.removeEventListener("visibilitychange",u)}):void 0}),[t,n?.url_slug,n?.id,n?.published_scene_id,i,a,r,e,o])}const Spe=[];function Ipe(e=Spe,t){return(0,Nt.useMemo)((()=>t?e.map((e=>({...e,active:e.id===t}))):e),[e,t])}const bpe=Yc((function(e,t){const n=Fee(e);return{publishedProject:n,selectedAnnotation:lQ(e,t.projectId),annotations:n?.comments_enabled?rQ(e,t.projectId,t.compositionId):void 0,isProcessing:Bee(e),isPlaying:f7(e),fullDocument:MW(e,t.projectId),isDocumentProcessing:e.publish.isDocumentProcessing}}))((function({projectId:e,compositionId:t,isMobile:n,publishedProject:r,fullDocument:o,annotations:i,selectedAnnotation:a,isDocumentProcessing:s,isProcessing:c,duration:d,...l}){const u=Ipe(i,a?.id),f=r?.state,m=Qte(r),p=oie(),g=(0,Nt.useMemo)((()=>Oie(o,t)),[t,r?.id,s]),h=function(e,t,n=!0){const[r,o]=Nr(),i=(0,Nt.useRef)(0),a=(0,Nt.useRef)(void 0),s=(0,Nt.useRef)(void 0),c=(0,Nt.useCallback)((()=>{if(void 0!==e){const t=new Image;t.crossOrigin="Anonymous",t.addEventListener("load",o),t.addEventListener("error",(()=>a.current?.())),t.src=e}}),[e,o]);return a.current=(0,Nt.useCallback)((()=>{s.current&&window.clearTimeout(s.current),i.current>=3||(i.current+=1,s.current=window.setTimeout(c,t))}),[c,t]),(0,Nt.useEffect)((()=>{n&&c()}),[n,c]),r?e:void 0}(m,1e3,"failure"!==f);vpe({project:r,canLoadMedia:"success"===r?.state}),ype();const[v,E]=(0,Nt.useState)(!1),{pause:y,play:S}=ppe({type:"video"}),I=Jte();!function({isFullScreen:e,type:t}){const n=(0,Nt.useRef)({isFullScreen:e});(0,Nt.useEffect)((()=>{if(e===n.current.isFullScreen)return;const r=n.current.isFullScreen?"fullscreen":"compact";rt("share_page_video_size_changed",{media_type:t,size_before:r,size_after:e?"fullscreen":"compact"}),n.current.isFullScreen=e}),[e,t])}({isFullScreen:v,type:r?.publish_type});const b=(0,Ft.I0)(),T=dpe(),w=Pr((e=>{T(e),b(V8({visible:!0}))})),C=Pr((()=>{b(eJ({projectId:e,compositionId:t}))}));return Nt.createElement(Lce,{...p,...l,doc:g,isMobile:n,draftAnnotation:C,setActiveAnnotation:w,annotations:u,project:r,className:"PublishedPageMediaPlayer-module--IHyXFu",isFullScreen:v,setIsFullScreen:E,play:S,pause:y,seekTo:I,poster:h,isDocumentProcessing:s,isProcessing:c,disableKeyboardShortcuts:n,duration:d,scrubberBar:Nt.createElement(mpe,{projectId:e,compositionId:t,isMobile:n,disabled:c,duration:d})})})),Tpe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"pause"}))),wpe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"play"})));function Cpe({duration:e}){const t=Kte(),n=wd(Math.min(e,t),!1,!1,!1),r=wd(e,!1,!1,!1);return Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},n," / ",r)}function _pe({timedJumpToItems:e,seekTo:t}){const n=(0,Nt.useCallback)((e=>{if(e.currentTarget&&Br(e.currentTarget)){const n=e.currentTarget.getAttribute("data-time-offset");n&&t(Number(n))}}),[t]);return e.length<2?_r:Nt.createElement(Woe,null,Nt.createElement(Hoe,{asChild:!0},Nt.createElement(W0,{variant:"light"},"Jump to")),Nt.createElement(tie,{side:"top",roughMaxItems:7},e.map((e=>Nt.createElement(eie,{key:e.jumpToItem.id,label:e.jumpToItem.title,"data-time-offset":a8(e.timeOffset),onSelect:n,sentenceCase:!1})))))}function Ape({timedJumpToItems:e,volume:t,setVolume:n,isPlaying:r,disabled:o,playbackRate:i,setPlaybackRate:a,togglePlayback:s,seekTo:c,duration:d,toggleAutoScroll:l,autoScroll:u,project:f,isMuted:m,setMuted:p}){return Nt.createElement(e0,{className:"p-0 gap-1",size:"small"},Nt.createElement(ei,{"aria-label":r?"Pause":"Play",title:"Play / Pause",subtitle:"Space"},Nt.createElement(Yo,{isPressed:r,disabled:o,onClick:s},r?Nt.createElement(Tpe,null):Nt.createElement(wpe,null))),Nt.createElement(dne,{color:"var(--cyan-500)",backgroundColor:"var(--grey-100-a)",volume:t,setVolume:n,isMuted:m,setMuted:p}),Nt.createElement(Cpe,{duration:d}),Nt.createElement("div",{className:"flex-1 flex justify-center"},!o&&Nt.createElement(_pe,{seekTo:c,timedJumpToItems:e})),Nt.createElement(rie,{type:"audio",playbackRate:i,setPlaybackRate:a}),f?.transcript_enabled&&Nt.createElement(vie,{autoScroll:u,toggleAutoScroll:l}))}function Rpe({duration:e,togglePlayback:t,isMobile:n,showTranscript:r,publishedProject:o,annotations:i,isPlaying:a,doc:s,seekTo:c,play:d,pause:l,setActiveAnnotation:u,scrubberBar:f,playbackRate:m,setPlaybackRate:p,timedJumpToItems:g,isProcessing:h,isDocumentProcessing:v,loadingToastText:E,draftAnnotation:y,trackMediaLoadStarted:S,trackMediaLoaded:I,trackMediaError:b,trackMediaStalled:T,trackMediaWaiting:w,onCanPlay:C,..._}){const A=Nt.useContext($te),R=A.current?.duration??e,{isEmbedded:M}=(0,Nt.useContext)(lie),[D,O]=qte(A),[x,k]=Hte(A),[N,P,L,F]=one(!0),[U,B,j]=Nr(),V=Pr((e=>{F(!0),lce(e),c(e)})),z=(0,Nt.useRef)(!1),G=i$(o?.url_slug),W=Pr((()=>{a||F(!0),t(),!1===z.current&&o?.url_slug&&(z.current=!0,E5(vt(),o.url_slug))}));lne({duration:e,seekTo:V,setVolume:k,togglePlayback:W,disabled:n}),Oce({play:d,pause:l,setVolume:k,setMuted:O,seekTo:c,mediaRef:A.current});const H=Pr((()=>{l(),A.current&&A.current.currentTime<R||(A.current?.loop?(c(0),requestAnimationFrame((()=>{d()}))):rt("share_player_media_completed",{media_type:o?.publish_type,context:Wte(),playback_rate:m}))}));return Nt.createElement("div",{className:"PublishedPageMediaPlayer-module--lIt4fW"},r&&Nt.createElement(fce,{doc:s,autoScroll:N,play:d,pause:l,annotations:i,setActiveAnnotation:u,draftAnnotation:y,isPlaying:a,seekTo:V,name:o?.name,project:o,onScroll:L,isProcessing:v,isHidden:!1,headerControl:M&&o?.allow_embedded_sharing?Nt.createElement(Mce,{pageName:o?.name,onClick:B,className:"PublishedPageMediaPlayer-module--ABzTzT",sharePageUrl:G}):void 0}),U&&Nt.createElement(Rce,{sharePageUrl:G,onCloseOverlay:j,className:"PublishedPageMediaPlayer-module--fne1or"}),E&&Nt.createElement(xce,{loadingToastText:E}),Nt.createElement("div",{"data-vjs-player":!0,className:"px-3 py-2 stack gap-2"},f,Nt.createElement(Ape,{timedJumpToItems:g,duration:e,playbackRate:m,setPlaybackRate:p,isPlaying:a,disabled:h,togglePlayback:W,seekTo:V,volume:x,setVolume:k,autoScroll:N,toggleAutoScroll:P,project:o,isMuted:D,setMuted:O}),Nt.createElement("audio",{crossOrigin:"anonymous",ref:A,controls:!0,preload:"auto",onPlay:d,onPause:H,onCanPlay:C,onLoadStart:S,onLoadedData:I,onError:b,onStalled:T,onWaiting:w,className:"hidden",..._})))}const Mpe=Yc((function(e,t){const n=Fee(e);return{publishedProject:n,annotations:n?.comments_enabled?rQ(e,t.projectId,t.compositionId):void 0,selectedAnnotation:lQ(e,t.projectId),isPlaying:f7(e),fullDocument:MW(e,t.projectId),timedJumpToItems:nee(e,t.projectId,t.compositionId),isDocumentProcessing:e.publish.isDocumentProcessing,isProcessing:Bee(e)}}))((function({projectId:e,compositionId:t,isMobile:n,publishedProject:r,fullDocument:o,selectedAnnotation:i,dispatch:a,isDocumentProcessing:s,isProcessing:c,annotations:d,duration:l,...u}){const f=Ipe(d,i?.id);vpe({project:r,canLoadMedia:"success"===r?.state});const{pause:m,play:p,togglePlayback:g}=ppe({type:"audio"}),h=Jte(),v=oie(),E=(0,Nt.useMemo)((()=>Oie(o,t)),[t,o]);ype();const y=dpe(),S=(0,Nt.useCallback)((()=>{a?.(eJ({projectId:e,compositionId:t}))}),[a,e,t]);return Nt.createElement(Rpe,{...u,...v,annotations:f,togglePlayback:g,draftAnnotation:S,play:p,pause:m,doc:E,seekTo:h,publishedProject:r,setActiveAnnotation:y,isDocumentProcessing:s,isProcessing:c,isMobile:n,duration:l,scrubberBar:Nt.createElement(mpe,{projectId:e,compositionId:t,disabled:c,lightBackground:!0,duration:l})})}));function Dpe({width:e,height:t},[n,r]){const o=n/e,i=r/t,a=r/e,s=n/t;return Math.max(Math.min(o,i),Math.min(a,s))}const Ope="Custom",xpe={name:"4K",width:3840,height:2160},kpe={name:"720p",width:1280,height:720},Npe=[xpe,{name:"1440p",width:2560,height:1440},{name:"1080p",width:1920,height:1080},kpe,{name:"480p",width:854,height:480}];function Ppe(e,t){if(void 0===e||void 0===t)return;return Npe.find((n=>{return r={width:e,height:t},o=[n.width,n.height],1===Dpe(r,o);var r,o}))??{name:Ope,width:e,height:t}}const Lpe=Yc((function(e,t){const{projectId:n,compositionId:r}=t,o=MW(e,n),i=xW(e,n,r);let a=w7(e,"composition");(function(e){return e>0&&Number.isFinite(e)})(a)||(a=_k(o,r));const s=Fee(e);return{mediaLoadingState:e.publish.mediaLoadingState,isProcessing:Bee(e),loadingToastText:Gte(e),isVideo:jee(e),project:s,duration:a,currentUserExists:_l(e),currentUserIsOwner:Al(e)===s?.published_by.id,compositionWidth:i.videoMetadata?.width,compositionHeight:i.videoMetadata?.height}}))((function({className:e,mediaLoadingState:t,isVideo:n,project:r,isElectron:o,currentUserExists:i,currentUserIsOwner:a,compositionWidth:s,compositionHeight:c,...d}){const{trackMediaLoadStarted:l,trackMediaLoaded:u,trackMediaError:f,trackMediaStalled:m,trackMediaWaiting:p,trackMediaCanPlay:g}=function(e,t,n){const[r]=(0,Nt.useState)((()=>Date.now())),[o,i]=(0,Nt.useState)(!1),[a,s]=(0,Nt.useState)(!1),[c,d]=(0,Nt.useState)(!1),[l,u]=(0,Nt.useState)(!1),f=(0,Nt.useMemo)((()=>({published_project_id:e?.id,project_id:e?.source_project_id,composition_id:e?.source_scene_id,published_composition_id:e?.published_scene_id,media_type:"audio"===e?.publish_type?"audio":"video",contents_version:e?.contents&&"version"in e.contents?e.contents.version:void 0,page_type:t,is_logged_in:n?.currentUserExists,is_creator:n?.currentUserIsOwner,published_width:n?.compositionWidth,published_height:n?.compositionHeight,published_approx_resolution_class:Ppe(n?.compositionWidth,n?.compositionHeight)?.name})),[t,e?.id,e?.publish_type,e?.contents,e?.source_project_id,e?.source_scene_id,e?.published_scene_id,n?.currentUserExists,n?.currentUserIsOwner,n?.compositionWidth,n?.compositionHeight]);(0,Nt.useEffect)((()=>{"failure"!==e?.state||a||(s(!0),rt("share_page_load_failed",{...f,error_type:"publish_error",message:e?.error_info?.message,publish_error_code:e?.error_info?.userFacing?.code,extra:e?.error_info?.userFacing&&"extra"in e?.error_info.userFacing?e.error_info.userFacing.extra?.filename:void 0}))}),[e?.state,a,f,e?.error_info]);const m=Pr((e=>{o||(i(!0),rt("share_page_media_load_started",{...f,media_src:e?.currentTarget?.dataset?.mediaSrc,time_to_start_load_ms:Date.now()-r}))})),p=Pr((e=>{c||(d(!0),rt("share_page_media_loaded",{...f,media_src:e?.currentTarget?.dataset?.mediaSrc,time_to_load_ms:Date.now()-r}))})),g=Pr((e=>{l||(u(!0),rt("share_page_media_playable",{...f,media_src:e?.currentTarget?.dataset?.mediaSrc,time_to_load_ms:Date.now()-r}))}));return{trackMediaLoadStarted:m,trackMediaLoaded:p,trackMediaError:Pr((e=>{s(!0),rt("share_page_load_failed",{...f,...e?.currentTarget?.error,media_src:e?.currentTarget?.dataset?.mediaSrc,error_type:"media_load_error"})})),trackMediaStalled:Pr((()=>{rt("share_page_media_stalled",{...f})})),trackMediaWaiting:Pr((()=>{rt("share_page_media_waiting",{...f})})),trackMediaCanPlay:g}}(r,"share_page",{currentUserExists:i,currentUserIsOwner:a,compositionWidth:s,compositionHeight:c}),h=Nt.useRef(_r),v="failure"===r?.state||"failure"===t,E=(0,Nt.useRef)(_r),{height:y,width:S}=ro(E),I="audio"===r?.publish_type&&!r.transcript_enabled,b=n?Nt.createElement(bpe,{...d,pauseAnimation:v,trackMediaLoadStarted:l,trackMediaLoaded:u,trackMediaError:f,trackMediaStalled:m,trackMediaWaiting:p,onCanPlay:g}):Nt.createElement(Mpe,{...d,trackMediaLoadStarted:l,trackMediaLoaded:u,trackMediaError:f,trackMediaStalled:m,trackMediaWaiting:p,onCanPlay:g});return Nt.createElement($te.Provider,{value:h},Nt.createElement("div",{ref:E,"data-media-player":!0,className:yo()("PublishedPageMediaPlayer-module--HVKkYX",e,{portraitPlayer:o&&1.2*y>S,"PublishedPageMediaPlayer-module--uRPzD_":"audiogram"===r?.publish_type,"PublishedPageMediaPlayer-module--AC7EGt":I,"PublishedPageMediaPlayer-module--pBu3oX":o})},I&&o&&Nt.createElement("div",{className:"PublishedPageMediaPlayer-module--Wg_E26"},Nt.createElement("div",{className:"PublishedPageMediaPlayer-module--jRD4we"},Nt.createElement(W1,{color:"var(--color-black-20pct)"})),Nt.createElement("div",{className:"PublishedPageMediaPlayer-module--RnVl1r"},"Transcript disabled"),Nt.createElement("div",{className:"PublishedPageMediaPlayer-module--pTlc4V"},"Enable the transcript from the share settings.")),(!o||Boolean(y))&&b))}));var Fpe=n(14121),Upe=n.n(Fpe);const Bpe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"settings"}))),jpe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"download-1x"}))),Vpe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"download"}))),zpe=Nt.forwardRef((function(e,t){return Nt.createElement("div",{ref:t},Nt.createElement("div",{className:"icon-1x flex-center"},Nt.createElement(jpe,{...e,type:"icon"})),Nt.createElement("div",{className:"icon-2x flex-center"},Nt.createElement(Vpe,{...e,type:"icon"})))})),Gpe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"code"}))),Wpe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"more-vertical"})));n(76287);const Hpe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"log-out"})));function qpe({title:e,email:t,className:n}){const r=Nt.useContext(bo);return Nt.createElement("div",{className:yo()(n,"stack px-2 py-1")},Nt.createElement(o0,{asChild:!0,ellipsisOverflow:!0,variant:r?"label-1-medium":void 0,className:r?"text-grey-800":void 0},Nt.createElement("div",null,e)),Nt.createElement(o0,{asChild:!0,color:"subtext",ellipsisOverflow:!0,style:{lineHeight:"16px"},variant:r?"label-1-regular":void 0,className:r?"text-grey-400":void 0},Nt.createElement("div",null,t)))}const $pe=(0,Nt.memo)((function({user:e,isCurrentUser:t=!1,additionalContextItems:n,hideContextItemAvatar:r}){const o=Nt.useContext(bo),[i,a]=(0,Nt.useState)(!1);return Nt.createElement(Woe,{open:i,onOpenChange:a},Nt.createElement(ei,{placement:"bottom",key:e.id,title:e.name,enabled:!i&&!t},Nt.createElement(Hoe,{"aria-label":"Open Account Menu",asChild:!0},Nt.createElement(wce,null,Nt.createElement(Tce,{size:36,initials:e.initials,name:e.name,color:e.color(t||!1,o),profileImage:e.profileImageCdnUrl})))),Nt.createElement(tie,{hasIcons:!0},Nt.createElement(Xoe,{className:"row"},!r&&Nt.createElement(Tce,{initials:e.initials,name:e.name,color:e.color(t,o),profileImage:e.profileImageCdnUrl}),Nt.createElement(qpe,{title:e.name,email:e.email})),n))}));function Kpe({currentUser:e,children:t}){const n=(0,Ft.I0)(),r=Pr((()=>{n(DK({source:"current-user-view"}))})),o=Nt.useContext(bo),i=o?Nt.createElement(Zo,null,Nt.createElement(Hpe,null)):Nt.createElement(w1,{direction:"left",style:{opacity:.4}}),a=Nt.createElement(Nt.Fragment,null,!o&&Nt.createElement(Qoe,null),t,Nt.createElement(Qoe,null),!1,Nt.createElement(eie,{label:"Logout",icon:i,onSelect:r}));return e?Nt.createElement($pe,{user:e,isCurrentUser:!0,additionalContextItems:a,hideContextItemAvatar:!o}):_r}var Ype=n(39618);function Zpe(e){return Object.keys(e).reduce(((t,n)=>{const r=e[n];return Array.isArray(r)?Object.assign(t,{[n]:r[0]}):Object.assign(t,{[n]:r})}),{})}function Jpe(){const e=(0,jt.TH)();return(0,Nt.useMemo)((()=>Zpe((0,aZ.parse)(e.search))),[e.search])}function Qpe(){const e=(0,jt.k6)(),t=(0,jt.TH)();return Pr((n=>{const r=(0,aZ.parse)(t.search);delete r[n],e.replace({...t,search:(0,Ype.stringify)(r)})}))}function Xpe(){const e=(0,jt.k6)(),t=(0,jt.TH)();return Pr(((...n)=>{const r=(0,aZ.parse)(t.search);n.forEach((e=>{delete r[e]})),e.replace({...t,search:(0,Ype.stringify)(r)})}))}function ege({origin:e,context:t}){const n=(0,Ft.I0)(),r=function(){const e=(0,jt.k6)(),t=(0,jt.TH)();return Pr(((n,r)=>{const o=(0,aZ.parse)(t.search);o[n]=r,e.replace({...t,search:(0,Ype.stringify)(o)})}))}(),o=Qpe();return{signIn:(0,Nt.useCallback)((()=>{rt("sign_in_clicked",{origin:e}),o(TQ),n(MK())}),[o,n,e]),signUp:(0,Nt.useCallback)((()=>{rt("sign_up_clicked",{origin:e,context:t}),r(TQ,"true"),n(MK())}),[n,r,e,t])}}function tge({origin:e,context:t}){const{signIn:n,signUp:r}=ege({origin:e,context:t});return Nt.createElement("div",{className:"SignInButtons-module--hnzPx6"},Nt.createElement(W0,{onClick:n,variant:"secondary"},"Sign in"),Nt.createElement(W0,{onClick:r,variant:"primary"},Nt.createElement("span",{className:"hidden md:block"},"Get Descript for Free"),Nt.createElement("span",{className:"md:hidden"},"Sign up")))}function nge(e){return"string"===typeof e?fX(e):e}function rge(e){return nge(e.studioAudio)}function oge(e){return nge(e.backgroundMask)}function ige(e){return nge(e.eyeContact)}function age(e,t,n){return{projectId:e,displayName:t.displayName,assetGuid:t.assetGuid,audio:Cg(t)?n:void 0,video:bg(t)?n:void 0,image:Tg(t)?n:void 0}}async function sge(e,t,n){const{assetJson:r,isGlobalAsset:o}=t;if(o){const r=Pk(t),o=await NX().getAssetForHandle(vt(),e,r);if(!o)return;const i=await NX().listByAsset(vt(),o);if(Fg(t)){const e=fH(o,i);if(!e)return;return{font:e,artifacts:i}}const a=await NX().getPreferredMediaLibraryArtifact(vt(),e,r,n);if(!a)return;const s=age(e,t,a.dataRef);0;const c=await NX().getMediaLibraryArtifact(vt(),e,r,"speech_enhanced");if("completed"===c?.status&&(s.studioAudio=c.dataRef),xg(t,"background_mask")){const t=await NX().getMediaLibraryArtifact(vt(),e,r,"background_mask");"completed"===t?.status&&(s.backgroundMask=t.dataRef)}if(xg(t,"eye_contact")){const t=await NX().getMediaLibraryArtifact(vt(),e,r,"eye_contact",n);"completed"===t?.status&&(s.eyeContact=t.dataRef)}return s}if(r){const o=await eY().legacyGetLocalMediaAssetPath(e,r,n);if(o)return age(e,t,o)}}function cge(){return new WeakMap}const dge=new Map([["preview",cge()],["original",cge()]]);function lge(){return new Map}const uge=new Map(LG.map((e=>[e,lge()])));function fge(e,t,n){return function(e,t,n,r){return o=>{const{assetJson:i,source:a}=o;if("descriptRecordingInProgress"===a){const e=n?.();return e?{audio:e,video:e}:void 0}const s=function(e){try{return Pk(e)}catch(E0){return}}(o);if(s){const n=function(e){return av(e,"guid")||av(e,"localId")||av(e,"originalFileUrl")}(s);if(void 0===n)return;return function(e,t,n,r,o){const[i]=n,a=i?function(e){switch(e){case void 0:return"transcribable";case"preview":return"proxy";case"original":return"original";default:ov(e)}}(i):"proxy",s=r.get(a);let c=Og(e),d=xg(e,"background_mask"),l=xg(e,"eye_contact"),u=mge(e,{studioSound:c,backgroundMask:d,eyeContact:l});const f=s.get(u);if(void 0!==f)return f;const m=t(e);function p(t){let n=!1;t&&(c&&void 0===rge(t)&&(c=!1,n=!0),d&&void 0===oge(t)&&(d=!1,n=!0),l&&void 0===ige(t)&&(l=!1,n=!0)),n&&(s.delete(u),u=mge(e,{studioSound:c,backgroundMask:d,eyeContact:l})),s.set(u,t)}s.set(u,m),m instanceof Promise?m.then((e=>p(e))):p(m);return m}(o,e,r,t.globalAssets)}if(void 0!==i)return function(e,t,n,r,o){const i=n[0]||"preview",a=r.get(i),s=a.get(o);if(void 0!==s)return s;const c=t(e);a.set(o,c),c instanceof Promise&&c.then((e=>{a.set(o,e)}));return c}(o,e,r,t.legacyAssets,i)}}((async t=>await sge(e,t,n)),{globalAssets:uge,legacyAssets:dge},t,n)}function mge(e,t){const n=Cg(e),r=bg(e),o=Tg(e),{studioSound:i,backgroundMask:a,eyeContact:s}=t,c=[i,a,s,n,r,o].reduce(((e,t)=>`${e}-${Number(Boolean(t))}`),"");return`${e.assetKey}${c}`}const pge={1:(e,t)=>(0,Me.fastDeepEqualJson)(e,t)};function gge(e,t){return $T(t)&&(e=function(e,t){return e.isStoryboard?qf(WB,sm(e,t),HB,e,t):e}(e,t.trackId)),e.isStoryboard?function(e,t){return $T(t)&&bk(e,t.trackId)}(e,t)?gC(e,t):e:mw(e,t)}const hge=em("applyPlaybackProperties");function vge(e,t){return Kf(gge,YT(e,t),hge,pge,e,t)}function Ege(e,t,{video:n,defaultFades:r=!0,roomtoneFades:o=!0,removeClipSpeed:i=!1,audioDucking:a=!0,legacyCrossfades:s}={}){let c;if(e=vge(e,t),i&&(e=function(e){let t=e;for(const n of yk(e))t=wG(t,n);return t}(e)),$T(t)){c=pb(e,t.trackId,{video:n,forceSequenceTrackRecomputation:void 0,roomtoneFades:o,audioDucking:a,legacyCrossfades:s});const r=function(e,t){if(t.range)return tp(t.range)?t.range:jT(e,t.trackId,t.range)}(e,t);r&&(c=MI(c,r)??yI)}else c=Eb(e,t.mediaRefId,t.range,n);return r?DI(c):c}function yge({fadeInDuration:e,fadeOutDuration:t,disableFadeIn:n,startOffset:r,clipDuration:o}){const i=e>0&&!n,a=t>0;if(i||a){if(r<0)throw new Error("Negative start offsets can lead to bugs like ED-2391");return Gy([...i?[{offset:r,value:0},{offset:r+e,value:1}]:[],...a?[{offset:r+o-t,value:1},{offset:r+o,value:0}]:[]])}}class Sge{constructor(){this.shaders=new Map,this.filters=new Map,this.transitions=new Map,this.generators=new Map}static getInstance(){return Sge.instance||(Sge.instance=new Sge),Sge.instance}static __testOnlyReset(){Sge.instance=void 0}register(e){const{effectId:t,type:n,shaders:r}=e;switch(n){case"filter":if(this.filters.has(t))throw new Error(`attempting to re-register ${n} module "${t}"`);this.filters.set(t,e);break;case"transition":if(this.transitions.has(t))throw new Error(`attempting to re-register ${n} module "${t}"`);this.transitions.set(t,e);break;case"generator":if(this.generators.has(t))throw new Error(`attempting to re-register ${n} module "${t}"`);this.generators.set(t,e)}for(const o of r){const e=this.shaders.get(o.shaderId);if(e&&e!==o)throw new Error(`attempting to re-register shader "${o.shaderId}"`);this.shaders.set(o.shaderId,o)}}getFilter(e){return this.filters.get(e)}getTransition(e){return this.transitions.get(e)}getGenerator(e){return this.generators.get(e)}getShaders(){return this.shaders.values()}}const Ige=Object.freeze([]),bge=Object.freeze([]);function Tge(e){const t=e.filter((e=>!e.isDisabled&&function(e){return sI.has(e.type)}(e)));return 0===t.length?Ige:t}function wge(e,t){const n=Sge.getInstance(),r=vu(e,(e=>!e.isDisabled&&(void 0!==n.getFilter(e.type)||!!t&&e.type===Hy.BACKGROUND_REMOVAL)));return 0===r.length?bge:r}function Cge(e){const t=e.find((e=>e.type===Hy.BACKGROUND_REMOVAL&&!e.isDisabled));return Boolean(t)}function _ge(e){const t=e.find((e=>e.type===Hy.EYE_CONTACT&&!e.isDisabled));return Boolean(t)}function Age(e){return vu(e,(e=>e.type in Hy))}function Rge(e){if(!e)return{headTransition:void 0,tailTransition:void 0};const{fadeInDuration:t,fadeOutDuration:n,headTransitionEffect:r,tailTransitionEffect:o}=e;return{headTransition:t&&t<0&&r?{duration:2*Math.abs(t),effect:r}:void 0,tailTransition:n&&n<0&&o?{duration:2*Math.abs(n),effect:o}:void 0}}function Mge({doc:e,composition:t,exportMetadata:n,seenMediaRefIdsForVideo:r}){const{videoMetadata:o}=t;if(!o)return;const i=({sourceTrackId:i,...a})=>function({doc:e,composition:t,sourceTrack:n,sequenceTrackId:r,layerEffects:o,layerVisualEffects:i,vectorOverrides:a,parentId:s,cardTimeRange:c,fadeInDuration:d,fadeOutDuration:l,trackMetadata:u,outerDimensions:f,exportFramerate:m,seenMediaRefIdsForVideo:p}){const g=Rk(e,t.id,n.id),h=n.id!==t.id,{getTauData:v}=GV(e,n.id).tausAndDataBasic(),E=function({doc:e,sourceTrackId:t,timeRangeInTrack:n}){const r=NP(e,t,n),o=bP(e,t),i=(o[r.location-1]?.audioSegment?.videoFades?.fadeOutDuration??0)<0,a=(o[r.location+r.length]?.audioSegment?.videoFades?.fadeInDuration??0)<0,s=r.location-(i?1:0),c=r.location+r.length+(a?1:0);if(yd(s,c))return[];return Zg(zg(o,s,c-s))}({doc:e,sourceTrackId:n.id,timeRangeInTrack:$b(e,t.id,n.id,c)});if(0===E.length)return;const y={type:"drop",timeRange:lp(c,d,l)};let S=v(E[0].id).timeOffset+g;const I=fu(E,((u,g)=>{let I=S;if(S+=h?jP(e,n.id,u.id):v(u.id).duration,({tau:u,tauStart:I}=function({doc:e,tau:t,isFirstTau:n,tauStart:r,cardTimeRange:o,fadeInDuration:i}){if(n&&Ed(r,o.offset)&&vd(i,0)&&t.audioSegment){const n=wN(t)||MN(e,t)?1/0:t.audioSegment.offset/t.audioSegment.speed,a=r-(o.offset+i),s=Math.min(n,a);if(yd(s,0))return{tau:VM(t,AF(t.audioSegment,t.audioSegment.offset-s*t.audioSegment.speed)),tauStart:r-s}}return{tau:t,tauStart:r}}({doc:e,tau:u,isFirstTau:0===g,tauStart:I,cardTimeRange:c,fadeInDuration:d})),({tau:u,tauEnd:S}=function({doc:e,sourceTrackId:t,tau:n,isLastTau:r,tauEnd:o,cardTimeRange:i,fadeOutDuration:a}){if(r&&Sd(o,i.offset+i.duration)&&vd(a,0)&&n.audioSegment){const r=tL(e,n)-VP(e,t,n.id),s=i.offset+i.duration-a-o,c=Math.min(r,s);if(yd(c,0))return{tau:VM(n,RF(n.audioSegment,n.audioSegment.duration+c*n.audioSegment.speed)),tauEnd:o+c}}return{tau:n,tauEnd:o}}({doc:e,sourceTrackId:n.id,tau:u,isLastTau:g===E.length-1,tauEnd:S,cardTimeRange:c,fadeOutDuration:l})),void 0===r){if(n.id===t.id){const t=ZP(e,u);if(t&&Ag(t))return}return kge({doc:e,compositionId:t.id,tau:u,tauStart:I,tauEnd:S,cardTimeRange:c,layerEffects:o,layerVisualEffects:i,vectorOverrides:a,parentId:s,outerDimensions:f,exportFramerate:m,seenMediaRefIdsForVideo:p,trimBehavior:y})}if("all"===r)return kge({doc:e,compositionId:t.id,tau:u,tauStart:I,tauEnd:S,cardTimeRange:c,layerEffects:o,layerVisualEffects:i,vectorOverrides:a,parentId:s,outerDimensions:f,exportFramerate:m,seenMediaRefIdsForVideo:p,trimBehavior:y});{const n=ZP(e,u);if(!u.audioSegment||!n||!Ag(n)||n.audio.trackSceneIds.indexOf(r)<0)return;return kge({doc:e,compositionId:t.id,tau:VM(u,DF(u.audioSegment,r)),tauStart:I,tauEnd:S,cardTimeRange:c,layerEffects:o,layerVisualEffects:i,vectorOverrides:a,parentId:s,outerDimensions:f,exportFramerate:m,seenMediaRefIdsForVideo:p,trimBehavior:y})}}));if(0===I.length)return;return{type:"clips",id:`${s}:source-track:${n.id}`,clips:I,width:f.width,height:f.height,effects:Ige,visualEffects:bge}}({...a,sourceTrack:vk(e,i),doc:e,composition:t,trackMetadata:o,outerDimensions:n,exportFramerate:n,seenMediaRefIdsForVideo:r}),a=Qb(e,t.id),s=fu(a,((r,s)=>function({doc:e,composition:t,card:n,getSourceTrack:r,trackMetadata:o,exportMetadata:i,isFirstCard:a,isLastCard:s}){const c=sT(e,t.id,n),d=CT(e,t.id,n),l=d.fadeInDuration??0,u=d.fadeOutDuration??0,f=l<0?2*Math.abs(l):l,m=u<0?2*Math.abs(u):u;if(hd(c.duration,0))return;const p=fu(n.layers,(t=>{if("placeholder"!==Ky(e,t.sourceSceneId)&&!0!==t.isHidden)return function({doc:e,cardLayer:t,getSourceTrack:n,cardTimeRange:r,cardFadeInDuration:o,cardFadeOutDuration:i,trackMetadata:a,exportMetadata:s}){const c=function({cardLayer:e,getSourceTrack:t,cardTimeRange:n,cardFadeInDuration:r,cardFadeOutDuration:o,trackMetadata:i,exportMetadata:a}){const s=t({sourceTrackId:e.sourceSceneId,sequenceTrackId:e.sequenceSceneId,layerEffects:Tge(e.effects).filter((e=>e.type!==Gy.type)),layerVisualEffects:wge(e.effects,!0),vectorOverrides:Oge(e),parentId:`card-layer:${e.id}`,cardTimeRange:n,fadeInDuration:r,fadeOutDuration:o});if(void 0===s)return;return{type:"sequence",id:`card-layer:${e.id}`,subsequence:s,...cy(lp(n,r,o),a),effects:Ige,effectsOffset:0,visualEffects:bge,headTransition:void 0,tailTransition:void 0,speed:1,width:a.width,height:a.height}}({cardLayer:t,getSourceTrack:n,cardTimeRange:r,cardFadeInDuration:o,cardFadeOutDuration:i,trackMetadata:a,exportMetadata:s});if(void 0===c)return;const d=xge({layerEffects:Tge(t.effects).filter((n=>{if(n.type===Gy.type)return!0;return"vector"!==Ky(e,t.sourceSceneId)&&n.type===rI.type})),layerOffset:r.offset});return{id:`card-layer-track:${c.id}`,type:"clips",clips:[c],effects:d,visualEffects:wge(t.effects,!1),width:a.width,height:a.height}}({doc:e,cardLayer:t,getSourceTrack:r,cardTimeRange:c,cardFadeInDuration:l,cardFadeOutDuration:u,trackMetadata:o,exportMetadata:i})})),g=lp(c,a?0:l,s?0:u),h=cy(g,i),v="com.descript.solidColor";for(const b of n.start.effects)b.type!==v||b.isDisabled||p.push(Dge(n.start.id,h,o,b));const E={id:`card-layers-group:${n.start.id}`,type:"group",layers:p.reverse(),effects:Ige,visualEffects:bge,width:i.width,height:i.height},{headTransition:y,tailTransition:S}=Rge(d),I=yge({fadeInDuration:void 0===y?f:0,fadeOutDuration:void 0===S?m:0,disableFadeIn:l<0,startOffset:0,clipDuration:g.duration});return{type:"sequence",id:`card:${n.start.id}`,...h,effects:I?[I]:Ige,effectsOffset:0,headTransition:y,tailTransition:S,visualEffects:wge(n.start.effects,!1),subsequence:E,speed:1,width:i.width,height:i.height}}({doc:e,composition:t,card:r,getSourceTrack:i,trackMetadata:o,exportMetadata:n,isFirstCard:0===s,isLastCard:s===a.length-1})));return{type:"clips",id:`composition:${t.id}`,clips:s,width:o.width,height:o.height,effects:Ige,visualEffects:bge}}function Dge(e,t,n,r){return{id:`card-layer-track-background:${e}`,type:"clips",clips:[{type:"generator",id:`card-background-generator:${e}:${r.id}`,generator:r,...t,effects:Ige,effectsOffset:0,visualEffects:bge,headTransition:void 0,tailTransition:void 0}],effects:Ige,visualEffects:bge,width:n.width,height:n.height}}function Oge(e){if(function(e){return"text"===e.type}(e)||function(e){return"title"===e.type}(e))return e.vectorProperties}function xge({layerEffects:e,layerOffset:t}){return e.map((e=>({...e,keyframes:e.keyframes.map((e=>({...e,offset:e.offset+t,value:e.value})))})))}function kge({doc:e,compositionId:t,tau:n,tauStart:r,tauEnd:o,cardTimeRange:i,layerEffects:a,layerVisualEffects:s,vectorOverrides:c,parentId:d,outerDimensions:l,exportFramerate:u,seenMediaRefIdsForVideo:f,trimBehavior:m}){if(n.isBlocked)return;const p=xge({layerEffects:a,layerOffset:i.offset});return Pge({doc:e,captionSourceCompositionId:t,tau:c?{...n,visual:n.visual&&{...n.visual,...c}}:n,tauStart:r,tauEnd:o,outerDimensions:l,exportFramerate:u,seenMediaRefIdsForVideo:f,trimBehavior:m,parentSpeed:1,parentId:d,storyboardLayerInfo:{outerDimensions:l,effects:p},cloudEffects:{backgroundRemoval:Cge(s)||n.audioSegment&&Cge(n.audioSegment?.effects),eyeContact:_ge(s)||n.audioSegment&&_ge(n.audioSegment?.effects)}})}function Nge(e,t){const{offset:n,duration:r,width:o,height:i,effects:a,effectsOffset:s,visualEffects:c,headTransition:d,tailTransition:l,...u}=e;let f=1;"video"===e.type&&(f=e.speed);const m={...u,offset:n,duration:r,width:o,height:i,id:`${e.id}:content`,effects:Ige,effectsOffset:s,visualEffects:bge,headTransition:void 0,tailTransition:void 0},p={...m,id:`${e.id}:mask`,mediaVariant:"backgroundMask"};return{type:"sequence",id:t,offset:n,duration:r,width:o,height:i,subsequence:{type:"multi-track-effect",id:t,effect:{id:`${t}:bgremove-effect`,type:Hy.BACKGROUND_REMOVAL,isDisabled:!1,keyframes:[]},inputs:{content:{type:"clips",id:`${t}:content`,clips:[m],width:o,height:i,effects:Ige,visualEffects:bge},mask:{type:"clips",id:`${t}:mask`,clips:[p],width:o,height:i,effects:Ige,visualEffects:bge}},width:o,height:i},effects:a,effectsOffset:s,speed:f,visualEffects:Age(c),headTransition:d,tailTransition:l}}function Pge({doc:e,captionSourceCompositionId:t,tau:n,tauStart:r,tauEnd:o,outerDimensions:i,exportFramerate:a,seenMediaRefIdsForVideo:s,trimBehavior:c,parentSpeed:d,parentId:l,parentFreezeFrameOffset:u,storyboardLayerInfo:f,cloudEffects:m,useClipEffectsInStoryboard:p=!1}){const{id:g,audioSegment:h}=n,v=function(e,t,n){const r=t.audioSegment;if(!r)return;const{visual:o}=t;if(o){if(r.mediaRefId){const t=Pp(e,r.mediaRefId);if(Fg(t))return{type:"vector",vector:o,mediaRef:t}}return{type:"vector",vector:o}}if(void 0===r.mediaRefId||!CF(r))return;const i=Pp(e,r.mediaRefId);if(Rg(i)){const{width:e,height:t}=i.video;return{type:"sequence",mediaRef:i,width:e,height:t}}if(bg(i)){const{width:e,height:t}=Ly(i.video);return{type:"video",mediaRef:i,width:e,height:t}}if(Tg(i)){const{width:e,height:t}=i.image;return{type:"image",mediaRef:i,width:e,height:t}}}(e,n);if(!v||!h)return;const E=wge(h.effects,!1),{offset:y,duration:S,opacityEffect:I,headTransition:b,tailTransition:T,mediaOffset:w}=function({audioSegment:e,tauStart:t,tauEnd:n,trimBehavior:r,exportFramerate:o,parentSpeed:i,parentId:a}){const{videoFades:s,speed:c}=e,d=i*c;let l=Math.abs(s?.fadeInDuration||0),u=Math.abs(s?.fadeOutDuration||0);const f=Math.min(s?.fadeInDuration||0,0);t+=f/i;const m=0!==f;m&&(l*=2);const p=Math.min(s?.fadeOutDuration||0,0);0!==p&&(u*=2);const g=t,h=n-=p/i;let v=e.offset+f*d;if("clamp"===r.type){const e=r.timeRange.offset,o=rp(r.timeRange);t<e&&(v+=(e-t)*d,t=e),n>o&&(n=o)}const E=h-g,{headTransition:y,tailTransition:S}=Rge(e.videoFades),I=yge({fadeInDuration:void 0===y?l*c:0,fadeOutDuration:void 0===S?u*c:0,disableFadeIn:m,startOffset:Math.max(0,e.offset+f*c),clipDuration:E*(a?i*c:c)}),b=sy(t,o);return{offset:b,duration:sy(n,o)-b,opacityEffect:I,headTransition:y,tailTransition:S,mediaOffset:v}}({audioSegment:h,tauStart:r,tauEnd:o,trimBehavior:c,exportFramerate:a,parentSpeed:d,parentId:l});if(Ed(S,0))return;const C={offset:y,duration:S};if("drop"===c.type&&!sp(c.timeRange,C))return;const _=Math.max(0,w);let A=Tge(h.effects);const R=e.isStoryboard&&"sequence"===v.type&&void 0!==h.multicamSceneId;if(e.isStoryboard){if(p||(A=A.filter((e=>!Vw(e)))),void 0!==I&&(A=[...A,I]),f&&!R){A=gu(A,f.effects.map((e=>({...e,keyframes:e.keyframes.map((e=>({...e,offset:(e.offset-y)*h.speed+_})))}))))}}else{const e=eU(h,Gy);if(I){const t=e?function(e,t,n){if(0===n.keyframes.length)return t;if(0===t.keyframes.length)return n;const r=[[t.keyframes,n],[n.keyframes,t]],o=new Set,i=[];for(const[s,c]of r)for(const t of oU(s)){const{offset:n,value:r}=t;if(o.has(n))continue;o.add(n);const a=(rU(c.keyframes,n,e)??1)*r;i.push({...t,offset:n,value:a})}i.sort(((e,t)=>e.offset-t.offset));const a=t.keyframes[0].offset<=n.keyframes[0].offset?t.keyframes[0].curve:n.keyframes[0].curve;return i[0].curve!==a&&(i[0].curve=a),e(i,t.id,t.isDisabled)}(Gy,e,I):I;t&&t!==e&&(A=Array.from(ss([Ja(A,(({type:e})=>e!==Gy.type)),[t]])))}}const{mediaRefId:M}=h,D=h.isFreezeFrame?1:h.speed,O=d*D,x=l?`${l}:`:"";switch(v.type){case"vector":{const{vector:n}=v,{width:r,height:o}=i,a={offset:y,duration:S,effects:A,effectsOffset:_,width:r,height:o,visualEffects:E,headTransition:b,tailTransition:T},d=[0,.5];switch(n.type){case"title":M&&s.add(M);return{...a,type:"title",id:`${x}tau-title:${g}`,vector:n,mediaRefId:M};case"captions":{M&&s.add(M);let r=function(e,t,n){return Kf(O5,void 0!==n.cacheSuffix?im(e.projectId,t,n.cacheSuffix):sm(e,t),k5,x5,e,t,n)}(e,t,{includeSpeakerNames:!1,wordPadding:d,timeRange:{offset:y,duration:S},cacheSuffix:g});(c.timeRange.offset>y||rp(c.timeRange)<y+S)&&(r=function(e,t){return Zg(nh(zg(e),lh(t,np,rp,(e=>{const t=e[0].startTime;return{offset:t,duration:e[e.length-1].endTime-t}}),!0)))}(r,c.timeRange));return{...a,type:"captions",id:`${x}tau-captions:${g}`,vector:e.isStoryboard?{...n,wordLevelAnimation:!0}:n,mediaRefId:M,subtitleChunks:r}}case"dynamicText":{M&&s.add(M);const r={...a,type:"dynamicText",id:`${x}tau-dynamicText:${g}`,vector:n,mediaRefId:M,sourceInfo:{compositionName:vk(e,t).name,compositionDuration:Ak(e,t),markers:fk(e,t).map((n=>({text:n.text,timeOffset:Kx(e,t,n)}))),speakerNames:N5(e,t,d,{offset:y,duration:S})}};return r}case"waveform":{const r=Ege(e,WT(e.projectId,t,{offset:y,duration:S}),{video:!1,defaultFades:!1});for(const e of SI(r))s.add(e);return{...a,type:"waveform",id:`${x}tau-waveform:${g}`,vector:n,timeline:r}}default:return{...a,type:"vector",id:`${x}tau-vector:${g}`,vector:n}}}case"sequence":{const{mediaRef:t}=v,{width:r,height:o}=R?i:v,d=`${x}tau-seq:${g}`,l=Lge({doc:e,media:t,exportFramerate:a,seenMediaRefIdsForVideo:s,speed:D,multicamTrackId:n.audioSegment?.multicamSceneId,parentFreezeFrameOffset:u??(TN(n)?y:void 0),startTime:y-w/O,trimBehavior:{type:c.type,timeRange:cp(C,c.timeRange)??C},parentId:d,storyboardLayerInfo:R?f:void 0,cloudEffects:m});if(void 0===l)return;const p={type:"sequence",id:d,offset:y,duration:S,width:r,height:o,subsequence:l,effects:A,effectsOffset:_,speed:O,visualEffects:E,headTransition:b,tailTransition:T};return m?.backgroundRemoval?function(e,t){const n=t?`${t}:`:"",r=e.subsequence;return function e(t){switch(t.type){case"group":for(const n of t.layers)e(n);break;case"clips":{const e=fu(t.clips,(e=>"video"===e.type||"image"===e.type?Nge(e,`${n}clip-bgremove:${e.id}`):e));t.clips=e;break}}}(r),{...e,subsequence:r}}(p,`${x}sequence-bgremove:${p.id}`):p}case"video":{const{mediaRef:e,width:t,height:n}=v,r=e.id;let o;if(s.add(r),h.isFreezeFrame||void 0!==u){let i=w,a=S;h.isFreezeFrame&&(i=sy(h.offset,e.video)),void 0!==u&&(i+=u*h.speed,a=rp(c.timeRange)-y),o={type:"image",id:`${x}tau-image:${g}`,mediaOffset:i,offset:y,duration:a,mediaRefId:r,effects:A,width:t,height:n,effectsOffset:_,visualEffects:E,headTransition:b,tailTransition:T,mediaVariant:m?.eyeContact?"eyeContact":"video"}}else o={type:"video",id:`${x}tau-video:${g}`,mediaOffset:w,offset:y,duration:S,mediaRefId:r,width:t,height:n,effects:A,effectsOffset:_,speed:O,mediaDuration:S*O,visualEffects:E,headTransition:b,tailTransition:T,mediaVariant:m?.eyeContact?"eyeContact":"video"};return m?.backgroundRemoval?Nge(o,`${x}tau-bgremove:${g}`):o}case"image":{const{mediaRef:e,width:t,height:n}=v,r=e.id;s.add(r);const o={type:"image",id:`${x}tau-image:${g}`,offset:y,duration:S,mediaRefId:r,effects:A,width:t,height:n,effectsOffset:_,visualEffects:E,headTransition:b,tailTransition:T};return m?.backgroundRemoval?Nge(o,`${x}tau-bgremove:${g}`):o}default:ov(v)}}function Lge({doc:e,media:t,exportFramerate:n,seenMediaRefIdsForVideo:r,speed:o,multicamTrackId:i,parentFreezeFrameOffset:a,startTime:s=0,trimBehavior:c={type:"clamp",timeRange:{offset:0,duration:1/0}},parentId:d,storyboardLayerInfo:l,cloudEffects:u}){const f={...u,backgroundRemoval:void 0};if(l&&i){const t=vk(e,i);if(!t.videoMetadata)return;return Uge({doc:e,captionSourceTrackId:t.id,track:t,type:"script",trackMetadata:l.outerDimensions,outerDimensions:l.outerDimensions,exportFramerate:n,seenMediaRefIdsForVideo:r,startTime:s,trimBehavior:c,parentSpeed:o,parentId:d,parentFreezeFrameOffset:a,storyboardLayerInfo:l,cloudEffects:f})}return{type:"group",id:`seq:${t.id}`,layers:fu(t.audio.trackSceneIds,(l=>{if(void 0===i||i===l)return Fge({doc:e,track:vk(e,l),outerDimensions:t.video,exportFramerate:n,seenMediaRefIdsForVideo:r,parentFreezeFrameOffset:a,startTime:s,trimBehavior:c,parentSpeed:o,parentId:d,cloudEffects:f,useClipEffectsInStoryboard:e.isStoryboard})})).reverse(),width:t.video.width,height:t.video.height,effects:Ige,visualEffects:bge}}function Fge({doc:e,track:t,outerDimensions:n,exportFramerate:r,seenMediaRefIdsForVideo:o,parentFreezeFrameOffset:i,startTime:a=0,trimBehavior:s={type:"clamp",timeRange:{offset:0,duration:1/0}},parentSpeed:c=1,parentId:d,cloudEffects:l,useClipEffectsInStoryboard:u=!1}){const f=t.videoMetadata;if(!f)return;const m={[Yy]:Uge({doc:e,captionSourceTrackId:t.id,track:t,type:"script",trackMetadata:f,outerDimensions:n,exportFramerate:r,seenMediaRefIdsForVideo:o,startTime:a,trimBehavior:s,parentSpeed:c,parentId:d,parentFreezeFrameOffset:i,cloudEffects:l,useClipEffectsInStoryboard:u})};for(const g of t.timeline.pins.components)m[g.id]=Uge({doc:e,captionSourceTrackId:t.id,track:vk(e,g.sceneId),type:"pin",trackMetadata:f,outerDimensions:n,exportFramerate:r,seenMediaRefIdsForVideo:o,startTime:a+Kx(e,t.id,g),trimBehavior:s,parentSpeed:c,parentId:d,parentFreezeFrameOffset:i,cloudEffects:l});const p=Array.from(es(Xy(e,t.id),(e=>m[e]))).reverse();return 0!==p.length?{type:"group",id:`track:${t.id}`,width:f.width,height:f.height,layers:p,effects:Ige,visualEffects:bge}:void 0}function Uge({doc:e,captionSourceTrackId:t,track:n,type:r,trackMetadata:o,outerDimensions:i,exportFramerate:a,seenMediaRefIdsForVideo:s,startTime:c,parentSpeed:d,parentId:l,parentFreezeFrameOffset:u,trimBehavior:f,storyboardLayerInfo:m,cloudEffects:p,useClipEffectsInStoryboard:g=!1}){const h=o,v=l?d:1;let E=c;const y=[],S=f.timeRange.offset,I=rp(f.timeRange);for(const b of n.timeline.superTau.taus){const o=E,c="pin"===r?jP(e,n.id,b.id):BP(e,n.id,b.id);if(E+=c/v,Ed(c,0))continue;if(vd(E,S))continue;if(Sd(o,I))break;if(void 0!==u){if(Ed(o,S)){const n=Pge({doc:e,captionSourceCompositionId:t,tau:b,tauStart:o,tauEnd:E,outerDimensions:i,exportFramerate:a,seenMediaRefIdsForVideo:s,trimBehavior:f,parentSpeed:d,parentId:l,parentFreezeFrameOffset:u-("clamp"===f.type?Math.max(o,S):o),storyboardLayerInfo:m,cloudEffects:p,useClipEffectsInStoryboard:g});n&&y.push(n)}break}const h=Pge({doc:e,captionSourceCompositionId:t,tau:b,tauStart:o,tauEnd:E,outerDimensions:i,exportFramerate:a,seenMediaRefIdsForVideo:s,trimBehavior:f,parentSpeed:d,parentId:l,storyboardLayerInfo:m,cloudEffects:p,useClipEffectsInStoryboard:g});h&&y.push(h)}if(0!==y.length)return{type:"clips",id:`${l?`${l}:`:""}${r}:${n.id}`,width:h.width,height:h.height,clips:y,effects:Ige,visualEffects:bge}}function Bge(e,t,n){if(e=vge(e,t),KT(t)){const{mediaRefId:r}=t,o=Pp(e,r),i=new Set;if(Rg(o))return{videoTimeline:{metadata:n,frameCount:ly(o.audio.duration,n),track:Lge({doc:e,media:o,exportFramerate:n,seenMediaRefIdsForVideo:i,speed:1,multicamTrackId:t.multicamTrackId})},mediaRefIdsForVideo:i}}({media:t,doc:e}=qT(e,t,n));const r=function(e,t,n){const r=qp(e,t),o=new Set,i=e.isStoryboard&&t!==gb?Mge({doc:e,composition:r,exportMetadata:n,seenMediaRefIdsForVideo:o}):Fge({doc:e,track:r,outerDimensions:n,exportFramerate:n,seenMediaRefIdsForVideo:o});return{videoTimeline:{metadata:n,frameCount:ly(Ak(e,t),n),track:i},mediaRefIdsForVideo:o}}(e,t.trackId,n);return r}const jge={1:(e,t)=>(0,Me.fastDeepEqualJson)(e,t),2:(e,t)=>(0,Me.fastDeepEqualJson)(e,t)},Vge=em("createVideoTimeline");function zge(e,t,n){return Kf(Bge,YT(e,t),Vge,jge,e,t,n)}var Gge=n(11522);function Wge(e,t=" "){return JSON.parse(function(e,t=" "){return e.replace((0,Gge.Z)(),(e=>t.repeat(e.length)))}(JSON.stringify(e),t))}function Hge(e,t,n){return{type:"source",description:t,info:e,pixelAlign:n}}function qge(e,t){if(e)return{type:"transform",input:e,...t}}function $ge(e,t,n,r){return{type:"shader",description:r,shaderId:e.shaderId,inputs:t,params:n}}const Kge=A.logging.groupLogger("webmediaengine/framegraphcontext");class Yge{constructor(e,t){this.frameTime=e,this.videoMetadata=t,this.registry=Sge.getInstance()}getParams(e){return rU(e.keyframes,this.frameTime,qy(e.type,[],AE))}filterGraph(e,t){const{isDisabled:n,type:r}=e;if(n||!t)return t;const o=this.registry.getFilter(r);return o?o.makeGraph(this.getParams(e),t,this.frameTime):(Kge.warn(`[FrameGraph] could not find filter ${r}`),t)}generatorGraph(e){const{isDisabled:t,type:n}=e;if(t)return;const r=this.registry.getGenerator(n);if(r)return r.makeGraph(this.getParams(e),this.frameTime);Kge.warn(`[FrameGraph] could not find generator ${n}`)}transitionGraph(e,t,n,r){const{isDisabled:o,type:i}=e;if(o||!t&&!n)return;const a=this.registry.getTransition(i);if(!a)return Kge.warn(`[FrameGraph] could not find transition ${i}`),r<.5?t:n;const s=this.getParams(e);return a.makeGraph(s,t,n,K(r,0,1),this.frameTime)}}A.logging.groupLogger("webglcompositor/utils");const Zge=String.raw;function Jge(e,t,n,r,o){return{shaderId:e,inputTypes:t,paramTypes:n,fragmentShaderSource:r,premultipliedAlpha:o}}const Qge=Jge("Opacity",{source:"vec4"},{opacity:"float"},Zge`
vec4 Opacity(vec4 source, float opacity) {
    return source * opacity;
}
`,!0);function Xge(e=1,t){if(!(e<=0))return e>=1?t:$ge(Qge,{source:t},{opacity:e})}function ehe(e,t=1e9){const n=Math.round(e*t)/t;return 0===n?0:n}function the([e,t,n,r,o,i],[a,s,c,d,l,u]){return[a*e+s*r,a*t+s*o,a*n+s*i+c,d*e+l*r,d*t+l*o,d*n+l*i+u,0,0,1]}function nhe(...e){let t;for(const n of e)n&&(t=t?the(t,n):n);return t}function rhe(e){return function(e,t,n){if(e===t)return!0;if(e.length!==t.length)throw new Error("Matrix length mismatch");for(let r=0;r<e.length;r++){const o=e[r],i=t[r];if(o!==i&&ehe(o,n)!==ehe(i,n))return!1}return!0}(e,ohe)}const ohe=Object.freeze([[1,0,0],[0,1,0],[0,0,1]].flat());Object.freeze([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]].flat());function ihe(e,t=!0){return function(e,t=!0){let n=Math.cos(e),r=Math.sin(e);t&&(n=ehe(n,1e9),r=ehe(r,1e9));return[n,-r,0,r,n,0,0,0,1]}(function(e){return e*Math.PI/180}(e),t)}function ahe(e,t){return[1,0,e,0,1,t,0,0,1]}function she(e,t=e){return[e,0,0,0,t,0,0,0,1]}function che(e,t,n){const{scale:r,position:o,anchor:i,rotation:a}=t,s=e.width,c=e.height,d=n.width*r.x,l=n.height*r.y;return{translateX:s*o.x,translateY:c*o.y,anchorX:i.x*d,anchorY:i.y*l,itemWidth:d,itemHeight:l,rotationDegrees:a}}function dhe({translateX:e,translateY:t,anchorX:n,anchorY:r,itemWidth:o,itemHeight:i,rotationDegrees:a},s=!0){const c=0!==n||0!==r,d=0!==a;return nhe(s?she(o,i):void 0,c?ahe(-n,-r):void 0,d?ihe(a):void 0,ahe(e,t))}function lhe(e,t=1){return x(e,t)}function uhe({anchorX:e,anchorY:t,rotationDegrees:n,itemWidth:r,itemHeight:o,translateX:i,translateY:a}){const s=[`(${lhe(r)}\u2715${lhe(o)})`];return 0===i&&0===a||s.push(`position=${lhe(i)},${lhe(a)}`),0===e&&0===t||s.push(`anchor=${lhe(e)},${lhe(t)}`),0!==n&&s.push(`rotate=${lhe(n)}\xb0`),s.join(" ")}A.logging.groupLogger("webmediaengine/renderdebuglog");function fhe(e,t=1){return x(e,t)}function mhe(e){return`${fhe(e.width)}\u2715${fhe(e.height)}`}function phe(e){return Cd({signedTime:e}).string}function ghe(e,t,n){const r=e.box?{...EP(e,t),fit:"cover"}:t,o=R(n,r),i="cover"===r.fit?function(e,t){let n=ahe(-.5,-.5);const r=e.width,o=e.height;return Math.abs(r)>t.width&&(n=the(n,she(t.width/r,1))),Math.abs(o)>t.height&&(n=the(n,she(1,t.height/o))),n=the(n,ahe(.5,.5)),n}(o,r):void 0,a=function({contentPosition:e,contentScale:t,contentAnchor:n,contentRotation:r},o,i){return nhe(ahe(-e.x,-e.y),she(o.width,o.height),i,ihe(-r),she(1/o.width,1/o.height),she(1/t.x,1/t.y),ahe(n.x,n.y))}(e,n,i),s=che(t,e,o),c=nhe(i,dhe(s),she(1/t.width,1/t.height));return{layout:r,scaledSize:o,uvTransform:"contain"===r.fit&&rhe(a)?void 0:a,screenTransform:s,vertexTransform:c}}function hhe(e){return"image"===e.type?`${e.mediaRefId}_${e.mediaVariant??"default"}_${e.mediaOffset??0}`:e.id}function vhe(e,t,n,r){return IP(e.vector)?function(e,t,n,r){return{type:"line-vector",mediaDecoderId:hhe(e),effects:t,vector:e.vector,...yP(n,r)}}(e,t,n,r):function(e,t,n,r){const{mediaRefId:o,vector:i}=e;return{type:"box-vector",mediaDecoderId:hhe(e),mediaRefId:o,vector:i,effects:t,...EP(n,r)}}(e,t,n,r)}const Ehe=Jge("RoundedCorners",{source:"vec4"},{cornerRadii:"vec4"},Zge`
// Small radii can cause the wrong alpha values to be calculated, so we set some threshold
const float RoundedCorners_MIN_RADII_THRESHOLD = 1.0;

float RoundedCorners_closestRadius(vec2 pos, vec4 radii) {
    // Determine which quadrant we're in
    vec2 posQuadrants = step(pos, vec2(0.0));

    // Get the closest corner radius value based on the quadrant
    float leftPlane = mix(radii.x, radii.w, posQuadrants.y);
    float rightPlane = mix(radii.y, radii.z, posQuadrants.y);
    return mix(rightPlane, leftPlane, posQuadrants.x);
}

float RoundedCorners_sdRoundRect(vec2 pos, vec2 boxExt, vec4 radii) {
    float r = RoundedCorners_closestRadius(pos, radii);
    return length(max(abs(pos) + vec2(r) - boxExt, 0.0)) - r;
}

vec4 RoundedCorners(vec4 source, vec4 cornerRadii) {
    vec2 uv = (quadUv * quadSize) + vec2(0.5);  // Current pixel's corner position

    vec2 boxExt = quadSize / 2.0;  // Half dimensions
    vec2 uvDist = uv - boxExt;  // Distance from the center of the rectangle to the current pixel (ie, can be negative)

    float closestRadius = RoundedCorners_closestRadius(uvDist, cornerRadii);
    if (closestRadius <= RoundedCorners_MIN_RADII_THRESHOLD) {
        return source;
    }

    float shorterEdgeSize = min(quadSize.x, quadSize.y);
    float edgeSmoothness = 1.0 / shorterEdgeSize / pixelsPerPoint;

    // Convert from pt to % and ensure a minimum of at least 0.5 pixel radius, and a maximum of 50%
    vec4 radiiAsPercent = cornerRadii / shorterEdgeSize;
    vec4 radiiAsPercentClamped = clamp(radiiAsPercent, 0.5 * edgeSmoothness, 0.5);

    // Get the distance from the current pixel to the nearest edge of the rounded rectangle
    vec2 pos = uvDist / shorterEdgeSize;
    vec2 boxExtScaled = boxExt / shorterEdgeSize;
    float dist = RoundedCorners_sdRoundRect(pos, boxExtScaled, radiiAsPercentClamped);

    // Calculate the alpha value for the current pixel to create a smooth transition around the edges
    float alpha = 1.0 - smoothstep(-edgeSmoothness, edgeSmoothness, dist);

    // Multiply the source color by the alpha to get a premultiplied alpha final color
    return source * alpha;
}
`,!0);function yhe(e,t,n){for(const r of t){if(!n)return;n=e.filterGraph(r,n)}return n}function She(e,t,n,r){const{type:o}=t,i="video"===o||"sequence"===o?t.speed:1,a=(e.frameTime-t.offset)*i+t.effectsOffset,s=nU(t,Gy,a)??1;if(!(s<=0))return Xge(s,yhe(e,t.visualEffects,function(e,t,n,r,o){if("generator"===t.type)return function(e,t,n,r){return e.generatorGraph(t.generator)}(e,t);if(function(e){const t=e.type;return"vector"===t||"waveform"===t||function(e){const t=e.type;return"dynamicText"===t||"title"===t||"captions"===t}(e)}(t))return function(e,t,n){const r=function(e,t){return{fillColor:nU(e,CS,t),backgroundColor:nU(e,AS,t),strokeColor:nU(e,FS,t),strokeWidth:nU(e,GS,t),shadowColor:nU(e,MS,t),shadowBlur:nU(e,JS,t),shadowOffset:nU(e,YS,t),roundedCorners:nU(e,rI,t),activeWordFillColor:nU(e,OS,t),futureWordFillColor:nU(e,kS,t),activeWordStrokeColor:nU(e,BS,t),futureWordStrokeColor:nU(e,VS,t),activeWordStrokeWidth:nU(e,HS,t),futureWordStrokeWidth:nU(e,$S,t),playheadBackgroundColor:nU(e,PS,t)}}(e,t),o=gy(e,t),i=Hge(vhe(e,r,o,n),`${e.vector.type} ${JSON.stringify(r)}`);if(IP(e.vector))return function(e,{position:{x:t,y:n},rotation:r},o){if(!e)return;return qge(e,{vertexTransform:nhe(r?ihe(r):void 0,ahe(t*o.width,n*o.height),she(1/o.width,1/o.height))})}(i,o,n);return function(e,t,n){if(!e)return;return qge(e,{vertexTransform:nhe(dhe(che(n,t,EP(t,n)),!1),she(1/n.width,1/n.height))})}(i,o,n)}(t,r,n);let i;if(o){let n;({transform:i,isStatic:n}=(a=t,s=r,c=e.videoMetadata,Ey(a,s,c,!0))),o=n&&ehe(i.rotation)%90===0}else i=gy(t,r);var a,s,c;return function(e,t,n,r){if(!e)return;const{layout:o,uvTransform:i,screenTransform:a,vertexTransform:s}=ghe(t,r,n);return qge(e,{vertexTransform:s,uvTransform:i,description:`${o.fit} ${mhe(n)} in ${mhe(o)}: ${uhe(a)}`})}(function(e,t,n){switch(t.type){case"sequence":return function(e,t,n){const{width:r,height:o}=t.subsequence;return Ihe(e,t.subsequence,{width:r,height:o,fit:"contain"},n)}(e,t,n);case"image":return function(e,t){return Hge(function(e){const{mediaOffset:t,mediaVariant:n,mediaRefId:r}=e;return{type:"image",mediaRefId:r,mediaVariant:n,mediaOffset:t,mediaDecoderId:hhe(e)}}(e),`image (${e.id})${void 0!==e.mediaOffset?` @ ${phe(e.mediaOffset)}`:""}`,t)}(t,n);case"video":return function(e,t,n){let r=(e.frameTime-t.offset)*t.speed+t.mediaOffset;if(Sd(r,t.mediaOffset+t.mediaDuration))return;Ed(r,t.mediaOffset)&&(r=t.mediaOffset);return Hge(function(e,t){const{speed:n,mediaVariant:r,mediaRefId:o}=e;return{type:"video",mediaRefId:o,mediaVariant:r,mediaOffset:t,mediaDecoderId:hhe(e),speed:n}}(t,r),`video (${t.id}) @ ${phe(r)}`,n)}(e,t,n)}}(e,t,o),i,t,n)}(e,t,n,a,r)))}function Ihe(e,t,n,r){if("multi-track-effect"===t.type)return function(e,t,n){const r={},o=Object.keys(t.inputs);for(const i of o)r[i]=Ihe(e,t.inputs[i],n,!1);return e.transitionGraph(t.effect,r.content,r.mask,0)}(e,t,n);let o=yhe(e,t.visualEffects,function(e,t){const n=e.filter((e=>!!e));if(0!==n.length)return 1===n.length?n[0]:{type:"composite",description:t,inputs:n}}(function(e,t,n,r){if("group"===t.type)return t.layers.map((t=>Ihe(e,t,n,r)));const o=function(e,t){const n=rh(e,(({offset:e,duration:n})=>vd(t,e)?Ie.OrderedDescending:Sd(t,e+n)?Ie.OrderedAscending:Ie.OrderedSame));if(!n.match)return;const{index:r,value:o}=n.match;if(r>0&&yd(rp(e[r-1]),t))return[e[r-1],o];if(r<e.length-1&&Ed(np(e[r+1]),t))return[o,e[r+1]];if(0===r&&void 0!==o.headTransition&&yd(np(o)+o.headTransition.duration,t))return[void 0,o];if(r===e.length-1&&void 0!==o.tailTransition&&Ed(rp(o)-o.tailTransition.duration,t))return[o,void 0];return[o]}(t.clips,e.frameTime);if(!o)return[];if(1===o.length)return[She(e,o[0],n,r)];const[i,a]=o,s=function(e,t,n){if(t){const{headTransition:e}=t;if(e&&n<t.offset+e.duration)return{effect:e.effect,progress:(n-t.offset)/e.duration}}if(e){const{tailTransition:t}=e;if(t&&n>e.offset+e.duration-t.duration)return{effect:t.effect,progress:1-(e.offset+e.duration-n)/t.duration}}}(i,a,e.frameTime),c=i&&She(e,i,n,r),d=a&&She(e,a,n,r);if(!c&&!d)return[];if(!s)return gu(d?[d]:[],c?[c]:[]);return[e.transitionGraph(s.effect,c,d,s.progress)]}(e,t,n,r),`track ${t.type}: ${t.id}`));const i=nU(t,rI,e.frameTime);i&&(o=function(e,t){const{topLeft:n,topRight:r,bottomLeft:o,bottomRight:i}=e;return n<=0&&r<=0&&o<=0&&i<=0?t:$ge(Ehe,{source:t},{cornerRadii:[o,i,r,n]})}(i,o));return Xge(nU(t,Gy,e.frameTime),o)}function bhe(e,t,n){return{vertexTransform:t=nhe(e.vertexTransform,t),uvTransform:n=nhe(n,e.uvTransform)}}function*The(e){for(const t of function*(e){yield*function*e(t,n,r){if(t)switch(t.type){case"composite":if(r)yield*e(t,the(function([e,t,n,r,o,i]){const a=e*o-r*t;return[o/a,-t/a,-(o*n-t*i)/a,-r/a,e/a,(r*n-e*i)/a,0,0,1]}(r),n),void 0);else for(const o of t.inputs)yield*e(o,n,r);break;case"shader":for(const o of Object.values(t.inputs))yield*e(o,n,r);break;case"texture":break;case"source":yield{info:t.info,vertexTransform:n,uvTransform:r};break;case"transform":({vertexTransform:n,uvTransform:r}=bhe(t,n,r)),yield*e(t.input,n,r)}}(e.root,ohe,void 0)}(e))t.info.mediaRefId&&(yield t.info.mediaRefId)}var whe=n(50142),Che=n.n(whe);Error;Error;Error;Error;Error;let _he;const Ahe=new yX.Z({concurrency:1}),Rhe=(0,fp.PW)((()=>D.getValue("web-media-engine.thumbnailer",!0)?_he.makeVideoPlayer?.(void 0,"thumbnailer"):void 0));function Mhe(e){return Ahe.add((async()=>{const t=await Rhe();if(t)return await e(t)}))}async function Dhe(e,t,n,r,o,i,a=!1,s){const c=WT(e.projectId,t),d=vk(e,t);if(!d.videoMetadata)return{image:void 0};const l={...d.videoMetadata,...n},{videoTimeline:u}=zge(e,c,l),f=a?Wge(u):u;const m=ly(o,l),p=function({metadata:e,track:t},n=0,[r,o,i,a=255]=[0,0,0]){const{width:s,height:c}=e,d=new Yge(n,e);return{backgroundColor:[r/255,o/255,i/255,a/255],frameTime:n,root:t&&Ihe(d,t,{width:s,height:c,fit:"contain"},!0)}}(f,dy(m,l)),g=The(p);if(s?.aborted)throw new O;const h=await function(e,t,n){const r={},o=[];for(const i of t){const t=EI(n(Pp(e,i)),(e=>{r[i]=e}));t instanceof Promise&&o.push(t)}return o.length>0?Promise.all(o).then((()=>r)):r}(e,g,r);if(i&&(0,Me.fastDeepEqual)(p,i.frameGraph)&&(0,Me.fastDeepEqual)(h,i.mediaMap))return i;let v=Date.now();const E=await Mhe((async e=>{if(s?.aborted)throw new O;return v=Date.now(),await e.getFrameBitmap(f,h,m,l)}));Date.now();return{frameGraph:p,mediaMap:h,image:E}}const Ohe=em("cardThumbnailSharedCache",{max:1e3});function xhe(e,t,n){return im(e,t,n.toFixed(2))}function khe({doc:e,compositionId:t,width:n,height:r,card:o,timeOffsetInCard:i,downloadsInProgress:a,stripEmojis:s=!1}){const c=i?iT(e,t,o)+i:function(e,t,n){const r=iT(e,t,n),{fadeInDuration:o}=CT(e,t,n),i=aT(e,t,n)-.1;return o?Math.min(r+Math.abs(o),i):Math.min(r+.5,i)}(e,t,o);return function({doc:e,compositionId:t,width:n,height:r,timeOffset:o,downloadsInProgress:i,stripEmojis:a=!1}){const[s,c]=(0,Nt.useState)((()=>{const n=xhe(e.projectId,t,o);return Ohe.get(n)?.image})),d=(0,Nt.useRef)();return(0,Nt.useEffect)((()=>{const i=new AbortController,s=Jae()((async()=>{if(n<=0)return;const s=d.current,l=await async function(e,t,n,r,o,i,a,s){const c=xhe(e.projectId,t,n),d=fge(e.projectId,void 0,UG);try{const l=await Dhe(e,t,{width:Math.round(2*r)/2,height:Math.round(2*o)/2},d,n,a??Ohe.get(c),i,s?.signal);if(s?.signal.aborted)throw new O;return l!==Ohe.get(c)&&(l?Ohe.set(c,l):Ohe.remove(c)),l}catch(l){return void(l instanceof O||Ra(l,"fetch-card-thumbnail",{extra:{projectId:e.projectId,compositionId:t}}))}}(e,t,o,n,r,a,s,i);l&&(d.current=l,c(l.image))}),100);return s(),()=>{i.abort(),s.cancel()}}),[e,r,t,o,n,i,a]),s}({doc:e,compositionId:t,width:n,height:r,timeOffset:c,downloadsInProgress:a,stripEmojis:s})}function Nhe(e,t,n){const r=M(e.width,e.height,t,n);return{width:e.width*r,height:e.height*r}}function Phe({defaultDimensions:e}){let t=document.querySelector(".ThumbnailPreview canvas");if(!t){const n=document.querySelector("[data-media-player] video");if(!n)return;t=document.createElement("canvas"),t.width=e?.width||800,t.height=e?.height||450,t.getContext("2d")?.drawImage(n,0,0,t.width,t.height)}return t.toDataURL("img/png")}Yc((function(e,{projectId:t,compositionId:n}){const r=MW(e,t);return{doc:r,firstCard:Qb(r,n)[0],videoMetadata:hx(r,n)}}))((function({compositionId:e,firstCard:t,doc:n,containerDimensions:r={width:24,height:24},videoMetadata:o}){const i=Nt.useRef(_r),a=window.devicePixelRatio;return function(e,t){(0,Nt.useEffect)((()=>{const n=e.current;if(!n)return;const r=n.getContext("2d");r&&(r.resetTransform(),t?r.drawImage(t,0,0,n.width,n.height):r.clearRect(0,0,n.width,n.height))}),[t,e])}(i,khe({doc:n,compositionId:e,width:o.width*a,height:o.height*a,card:t})),Nt.createElement("div",{className:"flex-1 flex-center",style:{background:"var(--grey-1000-base)"}},Nt.createElement("canvas",{ref:i,style:Nhe(o,r.width,r.height)}))}));function Lhe({thumbnail:e}){const[t,n]=Nt.useState(!0),r=Nt.useRef(_r),o=Nt.useRef(3),i=Pr((()=>{const{current:t}=r;t&&(n(!1),o.current>0&&setTimeout((()=>{t.src=e,o.current-=1}),100))})),a=Pr((()=>{n(!0)}));return Nt.createElement("img",{src:e,ref:r,alt:"",className:yo()("ThumbnailPicker-module--bxuU9x","h-full w-full",!t&&"hidden"),onError:i,onLoad:a})}const Fhe=Nt.forwardRef((function({children:e,className:t,...n},r){return Nt.createElement("button",{ref:r,type:"button",className:yo()("ThumbnailPicker-module--RfFjam",t,"h-5 w-5 p-1 rounded-sm flex-center"),...n},e)}));function Uhe({onThumbnailChange:e}){const t=Pr((()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=t=>{const n=t.target?.files;if(n&&n.length>0){const t=n[0];e(t)}},t.click()}));return t}function Bhe({publishedProject:e,onPageAccessChange:t,pageAccess:n,showDrivePrivacyOption:r,className:o,menuAlign:i,...a}){const s=XW.find((e=>e.accessPermission===n));return Nt.createElement(bse,{label:s?.name,value:n,variant:"redesign",onValueChange:t,className:yo()("ml-auto",o),menuAlign:i,...a},XW.filter((e=>eH(e.accessPermission,n,r))).map((e=>Nt.createElement(Tse,{key:e.accessPermission,value:e.accessPermission,icon:e.icon,rightContent:e.tooltip&&Nt.createElement(yse,{placement:"top"},e.tooltip)},e.name))))}function jhe({viewCount:e,viewers:t,authorId:n,className:r}){const o=Nt.useContext(bo),i=(0,Nt.useMemo)((()=>t?.filter((e=>e.id!==n))),[t,n])||[],a=e-i.length,s=i?.length>0,c=function(e,t=[]){const n=[],r=t?Math.max(0,t.length-10):0,o=e-t.length+r;return t.slice(0,10).forEach((e=>n.push(e.name))),o>0&&n.push(`and ${o} ${r>0?"more":"anonymous viewer"+(1===o?"":"s")}\u2026`),n.join("\n")}(e,i),d=`${(0,Nt.useMemo)((()=>new Intl.NumberFormat("en-US").format(e)),[e])} ${1===e?"view":"views"}`;return o?0===e?Nt.createElement(ei,{placement:"bottom",title:"This view count is only visible to you, the creator.",className:r,hasNonInteractiveTrigger:!0},Nt.createElement("div",{className:"row"},Nt.createElement(Zo,null,Nt.createElement(Y1,null)),Nt.createElement(o0,{"data-testid":"view-count",variant:"label-1-regular"},d))):Nt.createElement(Nme,null,Nt.createElement(ei,{placement:"bottom",title:"This view count is only visible to you, the creator.",className:r},Nt.createElement(Ume,{asChild:!0},Nt.createElement(W0,{"data-testid":"view-count",variant:"light",icon:Nt.createElement(Y1,null)},d))),Nt.createElement(Bme,null,Nt.createElement(h2,null,Nt.createElement(v2,{className:yo()("ViewCount-module--d4bFKh","py-1")},i.map((e=>Nt.createElement(e0,{key:e.id},Nt.createElement(Tce,{initials:e.initials,name:e.name,size:24,color:e.color(!1,!0),profileImage:e.profileImageCdnUrl}),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},e.name)))),a>0&&Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},"+ ",a," anonymous"," ",1===a?"viewer":"viewers"))),Nt.createElement(b2,null)))):Nt.createElement("div",{className:"ViewCount-module--eii80w"},Nt.createElement(ei,{placement:"bottom",title:"This view count is only visible to you, the creator.",className:"ViewCount-module--Nvfb8J",hasNonInteractiveTrigger:!0},Nt.createElement(Z1,{className:"ViewCount-module--rOwKLo"})),Nt.createElement(Nme,null,Nt.createElement(ei,{title:Nt.createElement("div",{style:{textAlign:"left"}},c),placement:"bottom",enabled:s},Nt.createElement(Ume,{"data-testid":"view-count",className:yo()("ViewCount-module--rDsRpW",{"ViewCount-module--UlIY9D":s}),disabled:!s},d)),Nt.createElement(Bme,{className:"ViewCount-module--SpinNC"},i.map((e=>Nt.createElement("div",{key:e.id,className:"ViewCount-module--MD4hYg"},Nt.createElement(Tce,{initials:e.initials,name:e.name,size:24,color:e.color(!1,!1),profileImage:e.profileImageCdnUrl}),Nt.createElement(o0,null,e.name)))),a>0&&Nt.createElement(o0,{asChild:!0},Nt.createElement("p",{style:{marginTop:5}},"+ ",a," anonymous"," ",1===a?"viewer":"viewers")))))}const Vhe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"share"})));function zhe({url:e}){const t=(0,Nt.useCallback)((()=>{navigator.share?.({url:e})}),[e]);return navigator.share?Nt.createElement(ei,{title:"Share"},Nt.createElement(Yo,{onClick:t},Nt.createElement(Vhe,null))):_r}function Ghe({className:e,...t}){return Nt.createElement(o0,{className:yo()(e,"flex-1 px-2 text-grey-800 row gap-2"),variant:"label-1-regular",...t})}function Whe(e){return e.thumbnail.status}function Hhe({publishedProject:e,onUnPublish:t}){const{deletePublishedProject:n,deletionInProgress:r}=j5(e.drive_id,e.id,t);return Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 flex-1 px-2 text-grey-400"},"Last published:"," ",(0,vce.Z)(new Date(e.updated_at),"MM/dd/yyyy")),Nt.createElement(W0,{onClick:n,isProcessing:r,variant:"light"},Nt.createElement("span",{className:"text-red-500"},"Unpublish")))}function qhe({project:e,isDriveOwner:t,hasProFeatures:n,showDrivePrivacyOption:r}){const o=$ae(),i=(0,Ft.I0)(),a=function({hasProFeatures:e,isDriveOwner:t,enabled:n}){return e?t?(n?"Disable":"Enable")+" custom branding from drive settings":`Ask your drive owner to ${n?"disable":"enable"} custom branding`:t?"Upgrade to Pro for custom branding":"Ask your drive owner to disable custom branding"}({hasProFeatures:n,isDriveOwner:t,enabled:e.custom_branding}),s=Pr((()=>{e.url_slug&&i(W4({urlSlug:e.url_slug}))})),{updatePublishedProject:c}=B5({driveId:e.drive_id,publishedProjectId:e.id,onSuccess:s}),d=Pr((e=>{c({access_permission:e})})),l=Pr((()=>{c({transcript_enabled:!e.transcript_enabled})})),u=Pr((()=>{c({comments_enabled:!e.comments_enabled})})),f=Pr((()=>{c({display_author:!e.display_author})})),m=Pr((()=>{c({allow_embedded_sharing:!e.allow_embedded_sharing})})),p=Pr((e=>{Hi(e)?o({id:"too-large",dismissible:!0,style:qee.Default,message:"Thumbnail image too large. Please submit a new thumbnail that's at most 2MB."}):o({id:"thumbnail-error",dismissible:!0,style:qee.Default,message:"Something went wrong setting the new thumbnail"})})),g=Pr((t=>{i(H4.started({publishedProject:e,onError:p,file:"string"===typeof t?new File([Upe()(t)],"still.png",{type:"image/png"}):t}))})),h=Pr((e=>{!t||"key"in e&&"Enter"!==e.key&&" "!==e.key||window.open(`${r$()}/subscription`)})),v=(0,Ft.v9)(Whe),E=Qte(e),y=Pr((()=>{const t=Phe({defaultDimensions:e.contents.media.original.video});t&&g(t)})),S=Uhe({onThumbnailChange:g}),I=Pr((()=>{window.location.href=na}));return Nt.createElement(Nme,null,Nt.createElement(Ume,{asChild:!0},Nt.createElement(Yo,{"aria-label":"Publish settings"},Nt.createElement(Bpe,null))),Nt.createElement(Bme,{align:"end",className:yo()("PublishedPageHeader-module--q7279D","relative")},Nt.createElement("div",{className:"stack py-1"},Nt.createElement(e0,{asChild:!0},Nt.createElement("label",null,Nt.createElement(Ghe,null,"Access"),Nt.createElement(Bhe,{pageAccess:e.access_permission??"unlisted",onPageAccessChange:d,publishedProject:e,menuAlign:"end",showDrivePrivacyOption:r,icon:void 0}))),"video"===e.publish_type&&Nt.createElement(e0,null,Nt.createElement(o0,{className:"px-2 flex-1 text-grey-800",variant:"label-1-regular"},"Thumbnail"),Nt.createElement(Woe,null,Nt.createElement(Hoe,{asChild:!0},"loading"===v?Nt.createElement(Yo,{"aria-label":"Updating thumbnail"},Nt.createElement(u0,{color:"var(--grey-800)"})):Nt.createElement(Fhe,null,E?Nt.createElement(Lhe,{thumbnail:E}):Nt.createElement("div",{className:"bg-grey-100-a h-full w-full"}))),Nt.createElement(tie,{align:"end"},Nt.createElement(eie,{label:"Upload image",onSelect:S}),Nt.createElement(eie,{label:"Use current frame",onSelect:y})))),Nt.createElement(e0,{asChild:!0},Nt.createElement("label",null,Nt.createElement(Ghe,null,"Show transcript"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:e.transcript_enabled,onCheckedChange:l})))),Nt.createElement(e0,{asChild:!0},Nt.createElement("label",null,Nt.createElement(Ghe,null,"Allow comments"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:e.comments_enabled,onCheckedChange:u})))),Nt.createElement(e0,{asChild:!0},Nt.createElement("label",null,Nt.createElement(Ghe,null,"Show author"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:e.display_author,onCheckedChange:f})))),Nt.createElement(e0,{asChild:!0},Nt.createElement("label",null,Nt.createElement(Ghe,null,"Allow sharing from embeds"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:e.allow_embedded_sharing,onCheckedChange:m})))),Nt.createElement(ei,{placement:"top",title:a,delayIn:0,disableClickToClose:!0},Nt.createElement(e0,{asChild:!0,className:"button-focus-inset",role:"button",tabIndex:0,onClick:h,onKeyDown:h},Nt.createElement("label",null,Nt.createElement(Ghe,null,"Custom branding"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:e.custom_branding}))))),Nt.createElement(Hse,null),Nt.createElement(Hhe,{publishedProject:e,onUnPublish:I}))))}const $he="share_page",Khe="top_corner";const Yhe=Yc((function(e,{projectId:t,compositionId:n}){const r=Gee(e)||[],o=Vee(e),i=Cl(e)||pee(),a=!!t&&("descript_enterprise"===EH(e,t)?.productGroup&&Boolean(HW(e,"show-drive-privacy-option")));let s,c=0;if(t&&n){c=_k(MW(e,t),n),s=Math.trunc(function(e,t,n){let r;return r=e.project.activePublishedProjectId&&e.project.activePublishedProjectId===t?p7(e,0,n):h7(e,"composition"),Math.trunc(r)}(e,t,n))}return{user:i,isAuthor:o,hasProFeatures:!!t&&yH(e,t),isDriveOwner:e.publish.publishedProject?au(e,e.publish.publishedProject.drive_id):void 0,showDrivePrivacyOption:a,isProcessing:"success"!==e.publish.publishedProject?.state,canSeeViewCount:zee(e),project:e.publish.publishedProject,viewCount:e.publish.views?Number(e.publish.views.view_count):void 0,viewers:e.publish.views?.viewers.filter((e=>r.some((t=>t.id===e.id)))),currentTime:s,timelineDuration:c,isAdmin:Ml(e)}}))((function({user:e,isDriveOwner:t,hasProFeatures:n,showDrivePrivacyOption:r,isAuthor:o,canSeeViewCount:i,isProcessing:a,project:s,viewCount:c,viewers:d,isMobile:l,isShowingComments:u,commentsEnabled:f,onToggleComments:m,currentTime:p,timelineDuration:g,isAdmin:h}){const{signIn:v,signUp:E}=ege({origin:$he,context:Khe}),y=Cc(),S=(0,Ft.I0)(),I=s?.url_slug?o$(s.url_slug):void 0,b=(0,Nt.useCallback)((()=>{s?.url_slug&&S(W4({urlSlug:s.url_slug}))}),[S,s?.url_slug]),[T,w]=(0,Nt.useState)(s?.name),C=kr(T),[_,A]=(0,Nt.useState)(s?.access_permission||"unlisted"),R=kr(_),M=e&&o,D=(0,Nt.useCallback)((()=>{w(C||s?.name),A(R||s?.access_permission||"unlisted")}),[R,s?.access_permission,s?.name,C]),{updatePublishedProject:O}=B5({driveId:s?.drive_id,publishedProjectId:s?.id,onError:D,onSuccess:b,skipCacheUpdate:!0}),x=(0,Nt.useCallback)((e=>w((t=>(e!==t&&(O({name:e}),s?.source_project_id&&(async(e,t)=>{"quick_recording"===(await a$(vt(),e)).project.editorVariant&&s$(vt(),e,{name:t})})(s.source_project_id,e)),e)))),[O,s]),k=(0,Nt.useCallback)((()=>{void 0!==s?.source_project_id&&(window.location.href=function({projectId:e,compositionId:t,includeHostName:n,redirectLocalToStaging:r}){let o="";return n&&(o=r$(),!0===r&&o.startsWith("http://localhost")&&(o=r$("staging"))),`${o}/${e}${t?`/${t.substring(0,5).toLocaleLowerCase()}`:""}`}({projectId:s.source_project_id,compositionId:s.source_scene_id,includeHostName:!0}))}),[s?.source_project_id,s?.source_scene_id]);(0,Nt.useEffect)((()=>{T&&(document.title=`${T} - Descript`)}),[T]),(0,Nt.useEffect)((()=>{y&&!e?S(pK()):!y&&e&&S(jK())}),[S,e,y]);const[N,P]=(0,Nt.useState)(!1),L=s?o$(s.url_slug):void 0,F=$ae(),U=Pr((()=>{L&&"undefined"!==typeof p&&(K2()(N?L+`?t=${p}`:L),F({id:"link-copy-header-toast",style:qee.Default,dismissible:!0,dismissAfter:3,message:"Copied link to project to clipboard"+(N?` starting at ${$7(p)}`:"")}))})),B=window&&s?function(e,t,n=""){const r=t?'width="410" height="410"':'width="640" height="360"';return`<iframe src="${f5()}/embed/${e}${n}" ${r} frameborder="0" allowfullscreen></iframe>`}(s.url_slug,"audiogram"===s.publish_type,window.location.search):void 0,j=Pr((()=>{B&&(K2()(B),F({id:"link-copy-header-toast",style:qee.Default,dismissible:!0,dismissAfter:3,message:"Copied embed HTML to clipboard"}))})),V=Pr((()=>{s&&(!function(e){const{context:t,isOwner:n,publishedProject:r,publishedProjectDurationSeconds:o}=e;rt("published_media_download_initialized",{context:t,project_name:r.name,is_owner:n,project_id:r.source_project_id,composition_id:r.source_scene_id,published_project_id:r.id,published_composition_id:r.published_scene_id,published_project_duration:o,publish_resolution:r.resolution_info?.publish_resolution})}({context:"share_page",publishedProject:s,isOwner:t,publishedProjectDurationSeconds:g}),window.open(s.contents.media.original.cdn_url,"_blank"))})),z=M&&!l,G=Nt.useRef(null);return(0,Nt.useEffect)((()=>{if(G.current){const e=new URL(window.location.href),t=new URLSearchParams(e.search);"true"===t.get("editTitleOnOpen")&&(z&&G.current.focus(),t.delete("editTitleOnOpen"),window.history.replaceState({},"",`${e.pathname}?${t.toString()}`))}}),[z]),s?Nt.createElement("div",{className:"h-8 row px-3 gap-2 border-b border-grey-100-a"},Nt.createElement(Ote.p,{contentId:"main-content"}),Nt.createElement("div",{className:"row flex-1 min-w-0"},s.custom_branding?Nt.createElement("a",{href:"https://web.descript.com",className:"row gap-3 flex-0-auto","data-testid":"home-link"},Nt.createElement("img",{src:s.branding_logo_url,alt:"",width:20}),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 hidden md:block",ellipsisOverflow:!0},s.branding_name)):Nt.createElement("a",{href:"https://web.descript.com",className:"row","data-testid":"home-link"},Nt.createElement(s1.WordMarkLogo,null)),Nt.createElement("div",{className:"py-2 h-full mx-3  hidden md:block"},Nt.createElement(Hse,{orientation:"vertical",className:"mx-0 flex-0-auto",style:{height:36}})),Nt.createElement("div",{className:"w-3 md:hidden"}),z?Nt.createElement(Sre,{ref:G,"aria-label":"Project title",className:"ml-2 pl-1",defaultValue:T||"",placeholder:s.name||"",onSave:x}):Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800",ellipsisOverflow:!0},s.name)),Nt.createElement("div",{className:"row gap-3"},void 0!==c&&i&&s.published_by.id&&Nt.createElement(jhe,{viewCount:c,viewers:d,authorId:s.published_by.id,className:"hidden md:block"}),f&&Nt.createElement(ei,{title:u?"Hide comments":"Show comments",subtitle:sae.electronAccelerator?ge(sae.electronAccelerator):void 0},Nt.createElement(Yo,{isPressed:u,onClick:m,"data-testid":"toggle-comments"},Nt.createElement(oae,null))),Nt.createElement(ei,{placement:"top",title:a?"Video is still processing. You will be able to download once it is finished.":"Download"},Nt.createElement(Yo,{"aria-label":"Download",disabled:a,onClick:V},Nt.createElement(zpe,null))),Nt.createElement(Nme,null,Nt.createElement(Ume,{asChild:!0},Nt.createElement(Yo,{"aria-label":"Share"},Nt.createElement(N1,null))),Nt.createElement(Bme,{align:"end",className:"w-md relative"},Nt.createElement(Pme,null,Nt.createElement(Lme,null,"Copy link & embed")),Nt.createElement("div",{className:"py-1"},Nt.createElement(e0,null,Nt.createElement(Zo,null,Nt.createElement(N1,null)),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2 flex-1 min-w-0",ellipsisOverflow:!0,style:{userSelect:"text"}},o$(s.url_slug)),Nt.createElement(W0,{variant:"light",onClick:U,"data-testid":"copy-link"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-400"},"Copy link"))),"undefined"!==typeof p&&Nt.createElement(e0,null,Nt.createElement(Zo,null),Nt.createElement(Soe,{checked:N,onCheckedChange:P,"data-testid":"start-at-checkbox"},"Start at"," ",wd(p))),Nt.createElement(e0,null,Nt.createElement(Zo,null,Nt.createElement(Gpe,null)),Nt.createElement("div",{className:"flex-center px-2 py-2 my-2 flex-1 min-w-0 border border-grey-100-a rounded-sm"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800",style:{wordBreak:"break-all",userSelect:"text"}},B)),Nt.createElement(W0,{variant:"light",onClick:j},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-400","data-testid":"copy-embed"},"Copy code")))),Nt.createElement(Fme,null))),l&&I?"audio"===s.publish_type?Nt.createElement(zhe,{url:I}):void 0:!y&&s.custom_branding?Nt.createElement(Woe,null,Nt.createElement(ei,{title:"Share",placement:"bottom"},Nt.createElement(Hoe,{asChild:!0},Nt.createElement(Yo,{"aria-label":"Share"},Nt.createElement(Wpe,null)))),Nt.createElement(tie,null,Nt.createElement(eie,{label:"Sign In",onSelect:v}),Nt.createElement(eie,{label:"Sign Up",onSelect:E}))):void 0,M&&Nt.createElement(qhe,{project:s,isDriveOwner:t,hasProFeatures:n,showDrivePrivacyOption:r}),(i||h)&&!l&&Nt.createElement(W0,{variant:"black",onClick:k},"Edit"),Nt.createElement(Kpe,{currentUser:e}),!y&&!s.custom_branding&&Nt.createElement(tge,{origin:$he,context:Khe}))):_r})),Zhe={label:"Reset Playback Speed",ipcMessage:"",browserShortcut:"shift+k",enabledInWeb:!0,preventRepeat:!0},Jhe={label:"Increase Playback Speed",ipcMessage:"",browserShortcut:"shift+l",enabledInWeb:!0,preventRepeat:!0},Qhe={label:"Decrease Playback Speed",ipcMessage:"",browserShortcut:"shift+j",enabledInWeb:!0,preventRepeat:!0};const Xhe=function({project:{id:e,comments_enabled:t},compositionId:n}){const{playbackRate:r,setPlaybackRate:o}=oie(),i=(0,Nt.useCallback)((()=>o(1)),[o]),a=(0,Nt.useCallback)((()=>o(Math.min(2,r+.5))),[o,r]),s=(0,Nt.useCallback)((()=>o(Math.max(.5,r-.5))),[o,r]),c=(0,Ft.I0)(),d=(0,Nt.useCallback)((()=>{t&&c(eJ({projectId:e,compositionId:n}))}),[t,c,e,n]);return Nt.createElement(Nt.Fragment,null,Nt.createElement(aq,{menuCommand:Zhe,onShortcut:i}),Nt.createElement(aq,{menuCommand:Jhe,onShortcut:a}),Nt.createElement(aq,{menuCommand:Qhe,onShortcut:s}),Nt.createElement(aq,{menuCommand:sae,onShortcut:d}))},eve=n.p+"media/login-bg.2adefb18149ece7fffed.svg";function tve({signinMessage:e,onSignupClick:t,onLoginClick:n}){return Nt.createElement(P2,{"aria-labelledby":"auth-title","aria-describedby":"auth-description",className:"max-w-md"},Nt.createElement(L2,{className:"text-center"},Nt.createElement(o0,{asChild:!0,variant:"headline-3"},Nt.createElement("h1",{id:"auth-title",className:"pt-4 mb-3"},"You'll need to sign in first...")),Nt.createElement(o0,{asChild:!0,variant:"body-1-regular"},Nt.createElement("h2",{id:"auth-description",className:"text-grey-400"},e||"Sign in or create an account to get started.")),Nt.createElement("img",{src:eve,className:"my-6",alt:""}),Nt.createElement("div",{className:"row justify-center mt-6 gap-2"},Nt.createElement(W0,{variant:"naked",size:"large",onClick:t},"Create an account"),Nt.createElement(W0,{corners:"round",size:"large",onClick:n},"Sign in"))))}function nve(e){const t=(0,Ft.I0)();return(0,Nt.useCallback)((()=>{t(e())}),[e,t])}function rve({origin:e="project",context:t,signinMessage:n="You need an account to leave comments. Sign in or create an account to get started."}){const{signIn:r,signUp:o}=ege({origin:e,context:t}),i=nve(xK),a=(0,Nt.useCallback)((e=>{e||i()}),[i]);return Nt.createElement(M2,{open:!0,onOpenChange:a},Nt.createElement(tve,{signinMessage:n,onLoginClick:r,onSignupClick:o}))}const ove=Yc((function(e){return{showSignup:e.publish.isShowingSignup}}))((function({showSignup:e}){return e?Nt.createElement(rve,{origin:"share_page",context:"comment"}):_r})),ive=(0,Nt.createContext)("");const ave={togglePlaybackWhileCommenting:!0};const sve=Yc((function(e){const{state:t,url_slug:n}=Fee(e)||{};return{url_slug:n,projectUsers:Wee(e),isProjectAuthor:Vee(e),disabled:"success"!==t}}))((function({projectId:e,compositionId:t,isProjectAuthor:n,projectUsers:r,disabled:o,url_slug:i,onClose:a}){const s=(0,Nt.useMemo)((()=>({projectUsers:r})),[r]),c=i$(i);return Nt.createElement(ive.Provider,{value:i?o$(i):""},Nt.createElement(Xme.Provider,{value:ave},Nt.createElement(fle.Provider,{value:s},Nt.createElement("div",{style:{width:254},className:"h-full border-l border-grey-100-a"},Nt.createElement(fpe,{projectId:e,showCommentBox:!0,sharePageUrl:c,compositionId:t,onClose:a,hasArchivePermission:!!n,disabled:o})))))}));const cve=Yc((function(e,t){const n=t.project.id,r=t.project.published_by.id,o=ru(e,t.project.drive_id),i=tH(e,t.project.drive_id);return{hasProFeatures:Boolean(i&&$d(i.productGroup)),isProjectAuthor:Vee(e)||pee()?.id===r,isDriveOwner:o?.ownerId===Al(e),doc:MW(e,n),isDocumentProcessing:e.publish.isDocumentProcessing,isVideo:jee(e),selectedAnnotation:lQ(e,n),isDraftingAnnotation:YJ(e),isShowingComments:!t.isMobile&&e.project.isShowingCommentsSidebar,toasts:e.toast.toasts}}));const dve=cve((function({isMobile:e,project:t,isProjectAuthor:n,isDriveOwner:r,hasProFeatures:o,doc:i,isDocumentProcessing:a,isVideo:s,selectedAnnotation:c,isDraftingAnnotation:d,className:l,dispatch:u,isShowingComments:f,toasts:m,...p}){Vte("share",{type:t.publish_type}),oo((()=>{rt("page_viewed",{is_creator:n,media_playable:"success"===t.state,publish_type:t.publish_type,type:"view"})}));const g=(0,Nt.useCallback)((()=>{t?.url_slug&&u(W4({urlSlug:t.url_slug}))}),[u,t?.url_slug]);(0,Nt.useEffect)((()=>(window.addEventListener("focus",g),()=>{window.removeEventListener("focus",g)})),[g]);const{transcript_enabled:h,comments_enabled:v,published_scene_id:E}=t,y=(0,Nt.useMemo)((()=>function(e,t){return!bP(e,t).some((e=>e.text.string.trim().length>0))}(i,E)),[i,E]),S=h&&(a||!y),I=Pr((()=>u(V8({visible:!f}))));vo();const[b,T]=(0,Nt.useState)();(0,Nt.useEffect)((()=>{(c||d)&&(T("comments"),u(V8({visible:!0})))}),[c,d,u]),(0,Nt.useEffect)((()=>{v||"comments"!==b||T(n?"admin":void 0)}),[v,b,n]);const[w,C]=Nt.useState(_r);return Nt.createElement(Lte,{fullscreenElement:w},Nt.createElement(qae,{toasts:m},Nt.createElement(Yie,null,Nt.createElement("div",{className:"h-screen stack",...p},Nt.createElement(ove,null),Nt.createElement(Yhe,{className:"PublishedProject-module--tTtXsF",isMobile:e,isDriveOwner:r,hasProFeatures:o,isShowingComments:f,commentsEnabled:v&&!e,onToggleComments:I,projectId:t.id,compositionId:E}),Nt.createElement(Xhe,{project:t,compositionId:E}),Nt.createElement("div",{className:"flex-1 overflow-hidden",ref:C},Nt.createElement(Ote.f,{id:"main-content",className:"h-full row bg-grey-0"},Nt.createElement(Lpe,{className:"PublishedProject-module--XM2wX8",projectId:t.id,compositionId:E,isMobile:e,showTranscript:S}),v&&f&&Nt.createElement(sve,{projectId:t.id,compositionId:E,onClose:I})))),Nt.createElement(Kae,{className:"PublishedProject-module--H9qwWS"}))))}));function lve({size:e=40,color:t="var(--blue-500)",isAnimationPaused:n,delay:r=0}){const[o,i]=Nt.useState(0===r);return Nt.useEffect((()=>{const e=setTimeout((()=>{i(!0)}),r);return()=>{clearTimeout(e)}}),[r]),o?Nt.createElement("div",{className:yo()("AnimatedLogo",{paused:n})},Nt.createElement("div",{className:"container"},Nt.createElement("div",{className:"logo",style:{"--size":`${e}px`,"--baguette-height":`${Math.floor(e/7)}px`,"--baguette-color":t}},Nt.createElement("div",{className:"container"},Nt.createElement("div",{className:"line line1"},Nt.createElement("div",{className:"baguette"}),Nt.createElement("div",{className:"baguette"})),Nt.createElement("div",{className:"line line2"},Nt.createElement("div",{className:"baguette"}),Nt.createElement("div",{className:"baguette"}),Nt.createElement("div",{className:"baguette"})),Nt.createElement("div",{className:"line line3"},Nt.createElement("div",{className:"baguette"}),Nt.createElement("div",{className:"baguette"}),Nt.createElement("div",{className:"baguette"})),Nt.createElement("div",{className:"line line4"},Nt.createElement("div",{className:"baguette"}),Nt.createElement("div",{className:"baguette"})))))):_r}const uve=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"alert-octagon"}))),fve=(0,Nt.memo)((function({currentUser:e,title:t="Unknown error",children:n}){return Nt.createElement("div",{className:"row justify-center items-start","data-testid":"Error Message"},Nt.createElement("div",{className:"text-grey-800 flex-center h-5 w-5"},Nt.createElement(uve,null)),Nt.createElement("div",{className:"stack gap-1 px-2"},Nt.createElement(o0,{variant:"body-1-medium"},t),n,e&&Nt.createElement(o0,{variant:"label-1-regular"},"You\u2019re currently signed in as ",e.email,".")))})),mve=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"contrast"})));var pve=n(67544),gve=n(73662);const[hve,vve]=(0,Qr.k)("Drawer",{triggerRef:{current:_r},open:!1,setOpen:()=>{}});function Eve({defaultOpen:e,onOpenChange:t,open:n,children:r}){const o=Nt.useRef(_r),[i=!1,a]=(0,Ene.T)({prop:n,defaultProp:e,onChange:t});return Nt.createElement(hve,{open:i,setOpen:a,triggerRef:o},r)}const yve=Nt.forwardRef((function(e,t){const{open:n,setOpen:r,triggerRef:o}=vve("Drawer.Trigger"),i=(0,s2.e)(t,o);return Nt.createElement(gve.f,{ref:i,asChild:!0,pressed:n,onPressedChange:r,...e})}));function Sve({children:e}){const{open:t}=vve("Drawer.Portal");return Nt.createElement(Nt.Fragment,null,Nt.Children.map(e,(e=>Nt.createElement(zse.z,{present:t},Nt.createElement(io.h,{asChild:!0},e)))))}const Ive=Nt.forwardRef((function({className:e,children:t,showOverlay:n=!0,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:i,onOpenAutoFocus:a,onCloseAutoFocus:s,side:c="left",...d},l){const{setOpen:u,open:f,triggerRef:m}=vve("Drawer.Content"),p=Pr((()=>u(!1))),g=Pr((e=>{if(!Br(e.target))return;const t=e.target,n=m.current?.contains(t);n&&e.preventDefault()}));return Nt.createElement(Sve,null,n&&Nt.createElement("div",{"data-redesign":!0,"data-state":f?"open":"closed",className:yo()("Drawer-module--fm9iRv","absolute inset-0 bg-grey-400-a","absolute inset-0 mt-8"),onClick:p}),Nt.createElement(pve.M,{asChild:!0,loop:!0,onMountAutoFocus:a,onUnmountAutoFocus:s},Nt.createElement(ede.XB,{asChild:!0,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:(0,wo.M)(d.onInteractOutside,g),onDismiss:p},Nt.createElement("div",{ref:l,"data-redesign":!0,"data-state":f?"open":"closed","data-side":c,className:yo()("Drawer-module--JNJTwx","absolute top-0 left-0 bottom-0 bg-grey-0 mt-8")},t))))}));var bve=n(28673);const Tve=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"x-s"})));var wve="Banner-module--xO5jyX",Cve="Banner-module--D8_Xrs",_ve="Banner-module--mhjsnO",Ave="Banner-module--lPm037",Rve="Banner-module--Nm9b9K",Mve="Banner-module--xHEL85",Dve="Banner-module--jrHX_h",Ove="Banner-module--A61wjH",xve="Banner-module--ZAH90Y",kve="Banner-module--JklLah",Nve="Banner-module--SICTHo";const Pve=Nt.forwardRef((function({className:e,iconAndTextWrapperClassName:t,icon:n,density:r="default",onDismiss:o,children:i,rightContent:a,isCentered:s,...c},d){return Nt.createElement("div",{ref:d,...c,className:yo()(e,"label-1-regular row gap-1",Nve,I[`${r}Density`])},Nt.createElement("div",{className:wve}),Boolean((o||a)&&s)&&Nt.createElement("div",{className:"flex-auto-0 w-5"}),Nt.createElement("div",{className:yo()("flex-1 row gap-1",s&&"justify-center",t)},Boolean(n)&&Nt.createElement(Zo,{size:"dense"},n),Nt.createElement("div",{className:Dve},i)),a,o&&Nt.createElement(Yo,{"aria-label":"Dismiss",onClick:o,size:"default"===r?"default":"dense",className:_ve},Nt.createElement(Tve,null)))}));function Lve(){const e=Mr();return Nt.useMemo((()=>({base:{fontFamily:'"Inter"',fontSize:"12px",fontWeight:"400",letterSpacing:"0.00119999997317791px",lineHeight:"16px",textAlign:"right",color:"dark"===e?"rgba(255, 255, 255, 1)":"rgba(52, 52, 52, 1)",fontSmoothing:"antialiased","::placeholder":{color:"rgba(133, 133, 133, 1)"}},invalid:{color:"dark"===e?"rgba(250, 88, 88, 1)":"rgba(168, 0, 0, 1)"}})),[e])}function Fve(e){return Nt.useMemo((()=>Jae()((()=>{e.current?.querySelector("iframe")?.focus()}),100,{leading:!0,trailing:!1})),[e])}const Uve=Nt.forwardRef((function({children:e,...t},n){return Nt.createElement(Wne,{ref:n,...t,className:"row flex-1"},Nt.createElement("div",{className:yo()("row justify-end w-full","CreditCardElements-module--fHPEJs")},e))}));function Bve(e){const t=Lve(),n=Nt.useRef(_r),r=Fve(n);return Nt.createElement(Uve,{ref:n,inputId:"number-input",...e},Nt.createElement(bve.CardNumberElement,{id:"number-input",options:{style:t},onFocus:r}))}function jve(e){const t=Lve(),n=Nt.useRef(_r),r=Fve(n);return Nt.createElement(Uve,{ref:n,inputId:"expiry-input",...e},Nt.createElement(bve.CardExpiryElement,{id:"expiry-input",options:{style:t},onFocus:r}))}function Vve(e){const t=Lve(),n=Nt.useRef(_r),r=Fve(n);return Nt.createElement(Uve,{ref:n,inputId:"cvc-input",...e},Nt.createElement(bve.CardCvcElement,{id:"cvc-input",options:{style:t},onFocus:r}))}function zve({title:e,cardOnFile:t,requestError:n}){const r=(0,bve.useStripe)(),o=(0,bve.useElements)(),i=(0,Ft.I0)(),[a,s]=(0,Nt.useState)(""),[c,d]=(0,Nt.useState)(""),[l,u]=(0,Nt.useState)(),[f,m,p]=Nr(),g=Pr((()=>{i(LK(void 0))})),h=Pr((async e=>{if(e.preventDefault(),!r||!o)return;m();const t=o.getElement(bve.CardNumberElement),{token:n,error:s}=await r.createToken(t,{name:a,address_zip:c});n&&i(AK.started({userId:"me",tokenJson:{stripe_token:n.id}})),s?(u(s.message),p()):u(void 0)})),v=n&&n.json?n.json.message:void 0,E=l||v,y=f&&!E;return Nt.createElement(M2,{open:!0,isProcessing:y,onOpenChange:g,onSubmit:h},Nt.createElement(P2,{onInteractOutside:y?Lr:void 0,onEscapeKeyDown:y?Lr:void 0},Nt.createElement(D2,{hasSeparator:!0},e??(t?"Change credit card":"Add a credit card")),E&&Nt.createElement(e0,{className:"mb-2"},Nt.createElement(Pve,{className:"bg-amber-500-a flex-1",icon:Nt.createElement(g1,null)},E)),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400 flex-1"},"Name on card"),Nt.createElement(Sre,{"aria-labelledby":"name-label",placeholder:"John Doe",value:a,onValueChange:s,align:"right"})),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400 flex-1",id:"number-label"},"Card number"),Nt.createElement(Bve,{"aria-labelledby":"number-label"})),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400 flex-1",id:"expiry-label"},"Expiration date"),Nt.createElement(jve,{"aria-labelledby":"expiry-label"})),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400 flex-1",id:"cvc-label"},"CVC"),Nt.createElement(Vve,{"aria-labelledby":"cvc-label"})),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400 flex-1",id:"zip-label"},"Zip code"),Nt.createElement(Sre,{"aria-labelledby":"zip-label",value:c,onValueChange:d,className:"EditCreditCardModal-module--Jbi0g0",align:"right",placeholder:"12345"})),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,null,(t?"Update":"Add")+" credit card"))))}const Gve=Yc((function(e){return{cardOnFile:Dl(e),requestError:Ol(e),params:e.modal.editCreditCardModalParams}}))((function({params:e,...t}){return e?Nt.createElement(zve,{...e,...t}):_r}));function Wve({error:e,className:t,includeIcon:n}){return Nt.createElement("div",{className:yo()("ErrorContainer",t)},n&&Nt.createElement("img",{src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMzRweCIgaGVpZ2h0PSIzNHB4IiB2aWV3Qm94PSIwIDAgMzQgMzQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU1ICg3ODA3NikgLSBodHRwczovL3NrZXRjaGFwcC5jb20gLS0+CiAgICA8dGl0bGU+aW1wb3J0YW50PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9Ikdyb3VwLTgxLUNvcHktOSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTM2LjAwMDAwMCwgLTk3LjAwMDAwMCkiIGZpbGw9IiMwMDAwMDAiPgogICAgICAgICAgICA8ZyBpZD0iR3JvdXAtNzciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMDAwMDAwLCAxNi4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxnIGlkPSJHcm91cC04MyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzIuMDAwMDAwLCA3OS4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iR3JvdXAtNjciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQuMDAwMDAwLCAyLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTcsMzQgQzcuNjExMTU5MjUsMzQgMCwyNi4zODg4NDA3IDAsMTcgQzAsNy42MTExNTkyNSA3LjYxMTE1OTI1LDAgMTcsMCBDMjYuMzg4ODQwNywwIDM0LDcuNjExMTU5MjUgMzQsMTcgQzM0LDI2LjM4ODg0MDcgMjYuMzg4ODQwNywzNCAxNywzNCBaIE0xNSwyMi4yOTI2ODI5IEwxNSwyNiBMMTksMjYgTDE5LDIyLjI5MjY4MjkgTDE1LDIyLjI5MjY4MjkgWiBNMTksOS43ODA0ODc4IEwxOSw3IEwxNSw3IEwxNSw5Ljc4MDQ4NzggTDE2LDE5Ljk3NTYwOTggTDE4LDE5Ljk3NTYwOTggTDE5LDkuNzgwNDg3OCBaIiBpZD0iaW1wb3J0YW50Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=",alt:"Important Icon"}),e)}const Hve=(0,Nt.memo)(Wve);function qve({onCancel:e,onSubmit:t,requestError:n}){const[r,o]=(0,Nt.useState)(!1),i=(0,Nt.useCallback)((e=>{e.preventDefault(),o(!0),t()}),[t,o]),a=n?.json?.message||n?.message;return Nt.createElement(M2,{open:!0,onOpenChange:e,onSubmit:i,isProcessing:r&&void 0===n},Nt.createElement(P2,{className:"EditAccountModal"},Nt.createElement(D2,null,"Reset Password"),a&&Nt.createElement(Hve,{error:a}),Nt.createElement(O2,{className:"stack gap-2"},Nt.createElement("span",null,"We will send you an email to reset your password."),Nt.createElement("span",null,"Do you want to proceed?")),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,null,"Send"))))}function $ve({placeholderImage:e,placeholderStyle:t,src:n,...r}){const[o,i]=(0,Nt.useState)(!1),a=Nt.useContext(bo),s=(0,Nt.useCallback)((()=>i(!0)),[]);return(0,Nt.useEffect)((()=>i(!1)),[n]),!a||!o&&n?Nt.createElement("img",{onError:o?void 0:s,...r,src:o||!n?e:n,style:o||!n?t:void 0,alt:""}):Nt.createElement(ZW,{className:r.className})}const Kve=(0,Nt.memo)($ve);const Yve=Object.freeze({opacity:.4}),Zve=Nt.memo((function({logoCdnUrl:e,className:t}){return Nt.createElement(Kve,{className:yo()("DriveLogo-module--Gv0ZaD",t),src:e,placeholderImage:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMThweCIgaGVpZ2h0PSIxOHB4IiB2aWV3Qm94PSIwIDAgMTggMTgiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8cGF0aCBkPSJNMTksNSBDMjEuMjA5MTM5LDUgMjMsNi43OTA4NjEgMjMsOSBMMjMsMTkgTDIzLDE5IEMyMywyMS4xNDIxOTU0IDIxLjMxNjAzMTUsMjIuODkxMDc4OSAxOS4xOTk2NDAzLDIyLjk5NTEwNDcgTDE5LDIzIEwxOSwyMyBMOSwyMyBDNi43OTA4NjEsMjMgNSwyMS4yMDkxMzkgNSwxOSBMNSw5IEM1LDYuNzkwODYxIDYuNzkwODYxLDUgOSw1IEwxOSw1IFogTTE5LDE3IEw5LDE3IEM3Ljk0NTYzODIsMTcgNy4wODE4MzQ4OCwxNy44MTU4Nzc4IDcuMDA1NDg1NzQsMTguODUwNzM3NyBMNywxOSBDNywyMC4wNTQzNjE4IDcuODE1ODc3NzksMjAuOTE4MTY1MSA4Ljg1MDczNzY2LDIwLjk5NDUxNDMgTDksMjEgTDE5LDIxIEMxOS4xMDI2Nzk3LDIxIDE5LjIwMzU1MjEsMjAuOTkyMjYyMiAxOS4zMDIwNjYsMjAuOTc3MzM4IEMxOS4zMjM1MDk2LDIwLjk3NDA5NDYgMTkuMzQ1MjkwNSwyMC45NzA0Mjc0IDE5LjM2Njk0ODksMjAuOTY2NDExMSBMMTkuMzAyMDY2LDIwLjk3NzMzOCBDMTkuMzUyOTI5NiwyMC45Njk2MzI1IDE5LjQwMzE2NDQsMjAuOTYwMDExMyAxOS40NTI2OTQ3LDIwLjk0ODU1MDIgTDE5LjM2Njk0ODksMjAuOTY2NDExMSBDMTkuNDA3MDUxMiwyMC45NTg5NzQ4IDE5LjQ0NjczMzMsMjAuOTUwMzQyIDE5LjQ4NTk1NywyMC45NDA1NTExIEwxOS40NTI2OTQ3LDIwLjk0ODU1MDIgQzE5LjUwMzIyNzUsMjAuOTM2ODU3MiAxOS41NTMwMjcsMjAuOTIzMjQ5IDE5LjYwMjAxMjQsMjAuOTA3ODA2MyBMMTkuNDg1OTU3LDIwLjk0MDU1MTEgQzE5LjUzMDk1NzMsMjAuOTI5MzE4MyAxOS41NzUzNTQxLDIwLjkxNjU2MTIgMTkuNjE5MDg5NCwyMC45MDIzMzc4IEwxOS42MDIwMTI0LDIwLjkwNzgwNjMgQzE5LjY0NjM0MzQsMjAuODkzODMxIDE5LjY5MDAwNzYsMjAuODc4MzUzMiAxOS43MzI5NDU2LDIwLjg2MTQzMjYgTDE5LjYxOTA4OTQsMjAuOTAyMzM3OCBDMTkuNjcyNDEwOCwyMC44ODQ5OTY5IDE5LjcyNDc0ODksMjAuODY1NDc2NiAxOS43NzU5OTg3LDIwLjg0Mzg4MTkgTDE5LjczMjk0NTYsMjAuODYxNDMyNiBDMTkuNzgxMDczOSwyMC44NDI0NjY3IDE5LjgyODI4OTUsMjAuODIxNjg4MiAxOS44NzQ1MDg1LDIwLjc5OTE4MTIgTDE5Ljc3NTk5ODcsMjAuODQzODgxOSBDMTkuODE3NzUyMiwyMC44MjYyODg2IDE5Ljg1ODc4MzQsMjAuODA3MzE4NCAxOS44OTkwMzUzLDIwLjc4NzAyODMgTDE5Ljg3NDUwODUsMjAuNzk5MTgxMiBDMTkuOTE2MDgwMywyMC43Nzg5MzcyIDE5Ljk1Njg0NTcsMjAuNzU3Mjk0OCAxOS45OTY3NDM2LDIwLjczNDMxNTIgTDE5Ljg5OTAzNTMsMjAuNzg3MDI4MyBDMTkuOTQ3MTY0NSwyMC43NjI3Njc0IDE5Ljk5NDE3OTYsMjAuNzM2NjE5NCAyMC4wMzk5ODMzLDIwLjcwODY4MTQgTDE5Ljk5Njc0MzYsMjAuNzM0MzE1MiBDMjAuMDM3NDA5MSwyMC43MTA4OTM2IDIwLjA3NzE3MzIsMjAuNjg2MDgyOCAyMC4xMTU5NzE0LDIwLjY1OTk0NzcgTDIwLjAzOTk4MzMsMjAuNzA4NjgxNCBDMjAuMDgyNzY1MiwyMC42ODI1ODY2IDIwLjEyNDQ5MDIsMjAuNjU0OTMwMyAyMC4xNjUwNzkzLDIwLjYyNTc5MTYgTDIwLjExNTk3MTQsMjAuNjU5OTQ3NyBDMjAuMTU1NjEzNSwyMC42MzMyNDQgMjAuMTk0MjQ3MSwyMC42MDUxNTc4IDIwLjIzMTgwMywyMC41NzU3NTgxIEwyMC4xNjUwNzkzLDIwLjYyNTc5MTYgQzIwLjIwMzc2OTQsMjAuNTk4MDE2MiAyMC4yNDE0MjczLDIwLjU2ODg5MzkgMjAuMjc3OTg0NSwyMC41Mzg0OTM0IEwyMC4yMzE4MDMsMjAuNTc1NzU4MSBDMjAuMjY5ODc0OSwyMC41NDU5NTQ2IDIwLjMwNjgzOTIsMjAuNTE0ODAxMiAyMC4zNDI2MjQxLDIwLjQ4MjM3IEwyMC4yNzc5ODQ1LDIwLjUzODQ5MzQgQzIwLjMxNDA1MzcsMjAuNTA4NDk4NiAyMC4zNDkwNTEzLDIwLjQ3NzI1OTUgMjAuMzgyOTExNSwyMC40NDQ4NDE4IEwyMC4zNDI2MjQxLDIwLjQ4MjM3IEMyMC4zODM5MjI2LDIwLjQ0NDk0MjEgMjAuNDIzNjUwMSwyMC40MDU4MTIyIDIwLjQ2MTY5NTksMjAuMzY1MDkxMiBMMjAuMzgyOTExNSwyMC40NDQ4NDE4IEMyMC40MTYxOTQyLDIwLjQxMjk3NyAyMC40NDgzNzc5LDIwLjM3OTk3MzYgMjAuNDc5NDAwMSwyMC4zNDU4OTQgTDIwLjQ2MTY5NTksMjAuMzY1MDkxMiBDMjAuNDg5MTY1NSwyMC4zMzU2OTAyIDIwLjUxNTc1ODMsMjAuMzA1NDU5NyAyMC41NDE0MzI5LDIwLjI3NDQ0MTQgTDIwLjQ3OTQwMDEsMjAuMzQ1ODk0IEMyMC41MTQ1NDIsMjAuMzA3Mjg4NyAyMC41NDgxOTMzLDIwLjI2NzMwMjYgMjAuNTgwMjYzMSwyMC4yMjYwMjY1IEwyMC41NDE0MzI5LDIwLjI3NDQ0MTQgQzIwLjU3MzA0NTEsMjAuMjM2MjQ5NiAyMC42MDMyNjUyLDIwLjE5Njg2MzUgMjAuNjMyMDE1MywyMC4xNTYzNjA4IEwyMC41ODAyNjMxLDIwLjIyNjAyNjUgQzIwLjYwODg1NTksMjAuMTg5MjI1NiAyMC42MzYxOTE1LDIwLjE1MTM5OTQgMjAuNjYyMjA1NSwyMC4xMTI2MTIzIEwyMC42MzIwMTUzLDIwLjE1NjM2MDggQzIwLjY1NzcwMSwyMC4xMjAxNzU0IDIwLjY4MjIxMzMsMjAuMDgzMDk4NyAyMC43MDU0OTcsMjAuMDQ1MTg2MyBMMjAuNjYyMjA1NSwyMC4xMTI2MTIzIEMyMC42ODkzODA5LDIwLjA3MjA5MzUgMjAuNzE1MTE0LDIwLjAzMDUyNjEgMjAuNzM5MzMxMywxOS45ODc5ODM1IEwyMC43MDU0OTcsMjAuMDQ1MTg2MyBDMjAuNzg1NzcyNSwxOS45MTQ0NzQ2IDIwLjg1MTQ0MjUsMTkuNzczODI4MyAyMC45MDAyMzQzLDE5LjYyNTUyMDEgQzIwLjk0NDkwODgsMTkuNDg5ODc0OSAyMC45NzU1MzY0LDE5LjM0NzE0ODggMjAuOTkwMTUzMywxOS4xOTk3MTQyIEMyMC45OTE4MDksMTkuMTgzMDIyOCAyMC45OTMyNjY3LDE5LjE2NjE3MTggMjAuOTk0NTE0MywxOS4xNDkyNjIzIEwyMSwxOSBDMjEsMTcuOTQ1NjM4MiAyMC4xODQxMjIyLDE3LjA4MTgzNDkgMTkuMTQ5MjYyMywxNy4wMDU0ODU3IEwxOSwxNyBaIE0xOCwxOCBDMTguNTUyMjg0NywxOCAxOSwxOC40NDc3MTUzIDE5LDE5IEMxOSwxOS41NTIyODQ3IDE4LjU1MjI4NDcsMjAgMTgsMjAgTDE3LDIwIEMxNi40NDc3MTUzLDIwIDE2LDE5LjU1MjI4NDcgMTYsMTkgQzE2LDE4LjQ0NzcxNTMgMTYuNDQ3NzE1MywxOCAxNywxOCBMMTgsMTggWiBNMTksNyBMOSw3IEM3Ljk0NTYzODIsNyA3LjA4MTgzNDg4LDcuODE1ODc3NzkgNy4wMDU0ODU3NCw4Ljg1MDczNzY2IEw3LDkgTDYuOTk5ODc5NTYsMTUuNTM1MTk4NSBDNy41ODgyNTM1MSwxNS4xOTQ4MTUyIDguMjcxMzc2LDE1IDksMTUgTDE5LDE1IEMxOS43MjkwMzIyLDE1IDIwLjQxMjUxMTksMTUuMTk1MDMzNSAyMS4wMDExMDkyLDE1LjUzNTc3MDcgTDIxLDkgQzIxLDcuOTQ1NjM4MiAyMC4xODQxMjIyLDcuMDgxODM0ODggMTkuMTQ5MjYyMyw3LjAwNTQ4NTc0IEwxOSw3IFoiCiAgICAgICAgICBmaWxsPSIjMDAwMDAwIgogICAgICAgICAgZmlsbC1ydWxlPSJub256ZXJvIgogICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTUuMDAwMDAwLCAtNS4wMDAwMDApIgogICAgLz4KPC9zdmc+",placeholderStyle:Yve})}));function Jve({className:e,expandOnHover:t,children:n,expandedText:r="Upgrade to Pro",unexpandedText:o="Pro"}){const i=(0,Nt.useRef)(_r),{width:a}=ro(i),s=(0,Nt.useRef)(_r),{width:c}=ro(s),[d,l]=(0,Nt.useState)(void 0);return(0,Nt.useLayoutEffect)((()=>{l({"--expanded-width":`${a+16}px`,"--unexpanded-width":`${c+16}px`})}),[a,c]),Nt.createElement("div",{className:yo()("ProBadge-module--LKpzOD",e,{"ProBadge-module--2XeAfo":t,"ProBadge-module--pELYGL":!n}),style:d},n||Nt.createElement(Nt.Fragment,null,Nt.createElement("span",{ref:i,className:"ProBadge-module--Vqecbl"},r),Nt.createElement("span",{ref:s,className:"ProBadge-module--_kZ26E"},o)))}const Qve=Yc((function(e,{selectedDriveId:t,getDrives:n}){return{selectedDrive:t?ru(e,t):void 0,drives:n?n(e):Jl(e),showingOnboarding:VH(e)}}))((function({onDriveSelected:e,driveIdsWithProBadge:t,projectFilterVariant:n,selectedDrive:r,selectedDriveId:o,drives:i,showingOnboarding:a,getDrives:s,className:c,hideLogo:d=!1,fontWeight:l="semibold",driveSwitcherVariant:u,...f}){const m=Vc("smarter-drive-default"),p=void 0===m||Boolean(m),g=!r&&p&&!a,h=g?"No drive Selected":r?.name,v=g||void 0;return Nt.createElement(bse,{...f,className:yo()("DriveSwitcher-module--IEUj20",c,{"DriveSwitcher-module--qbUBtc":n}),value:o||"",onValueChange:e,menuAlign:"start",open:v,label:Nt.createElement("div",{className:"DriveSwitcher-module--tRTgJt"},!d&&Nt.createElement("div",{className:"DriveSwitcher-module--b0zW5b"},Nt.createElement(Zve,{logoCdnUrl:r?.logoCdnUrl})),"drive"===u?Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-900",ellipsisOverflow:!0},h):n?Nt.createElement(o0,{color:"subtext",ellipsisOverflow:!0},h):Nt.createElement(o0,{weight:l},h)),roughMaxItems:7},i?.map((({id:e,name:n,logoCdnUrl:r})=>Nt.createElement(Tse,{key:e,value:e,icon:Nt.createElement(Zve,{logoCdnUrl:r})},"drive"===u?Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-900",ellipsisOverflow:!0},n):Nt.createElement(o0,null,n),t?.has(e)&&Nt.createElement("div",{className:"DriveSwitcher-module--nDBx7w"},Nt.createElement(Jve,{className:"DriveSwitcher-module--h_gx69",expandOnHover:!0}))))))}));const Xve=Nt.memo((function({button:e,className:t,maxSizeInBytes:n,onChange:r,onError:o,disabled:i,accept:a="image/png, image/jpeg, image/gif"}){const s=(0,Nt.useRef)(_r),c=(0,Nt.useCallback)((()=>{i||s.current?.click()}),[i]),d=(0,Nt.useCallback)((()=>{!i&&s.current&&(s.current.value="")}),[i]),l=(0,Nt.useCallback)((e=>{if(!e.target.files)return;const t=e.target.files[0];if(void 0!==n&&t.size>n)return void o?.(`Please select an image that is less than ${Che()(n,{unitSeparator:" "})}.`);const i=new FileReader;i.onloadend=()=>{r(t,i.result)},i.readAsDataURL(t)}),[o,n,r]);return Nt.createElement("div",{className:yo()("ImageFileChooser-module--O0d8fD",t)},Nt.createElement("input",{ref:s,type:"file",accept:a,disabled:i,onChange:l,onClick:d}),Nt.createElement("div",{className:yo()("ImageFileChooser-module--lAilL3",{"ImageFileChooser-module--CF5dPT":i}),onClick:c},e))})),eEe=rd("USER"),tEe=eEe("AUTH_IDENTITIES_SUMMARY",(({userId:e})=>FQ(vt(),e)));const nEe=eEe("AUTHORIZED_CLIENTS",(({userId:e})=>BQ(vt(),e)));const rEe=eEe("ALL_EMAIL_SUBSCRIPTION_GROUPS",(()=>GQ(vt()))),oEe=eEe("EMAIL_SUBSCRIPTION_GROUPS",(({email:e})=>WQ(vt(),e)));eEe("EMAIL_SUBSCRIPTION_GROUPS_WITH_TOKEN",(({email:e,token:t})=>qQ(vt(),e,t)),{retry:!1});function iEe(e){return{stripe_token:"Success"===e?"tok_visa":"tok_chargeCustomerFail"}}function aEe({text:e}){const[t,n]=(0,Nt.useState)(!1);(0,Nt.useEffect)((()=>{n(!1)}),[e]);const r=Pr((()=>{K2()(e),n(!0),setTimeout((()=>{n(!1)}),4e3)}));return Nt.createElement(W0,{variant:"light",onClick:r},t?"Copied \u2714":"Copy")}function sEe({onHide:e}){const t=Nt.useContext(bo)?"light":"naked",n=(0,Nt.useCallback)((()=>Si(Ga,String(yi()))),[]),r=(0,Nt.useCallback)((()=>Si(Ga,"invalid")),[]),o=(0,Nt.useCallback)((()=>Si(Wa,String(yi()))),[]),i=(0,Nt.useCallback)((()=>Ii()),[]);return Nt.createElement(M2,{open:!0,onOpenChange:e},Nt.createElement(P2,null,Nt.createElement(D2,null,"Auth Debug Panel"),Nt.createElement(L2,null,Nt.createElement(W0,{variant:t,onClick:n},"Invalidate auth token"),Nt.createElement(W0,{variant:t,onClick:r},"Invalidate auth and refresh tokens"),Nt.createElement(W0,{variant:t,onClick:o},"Expire auth token"),Nt.createElement(W0,{variant:t,onClick:i},"Remove auth and refresh tokens"))))}function cEe(){const[e,t,n]=one(!1),r=Nt.useContext(bo);return Nt.createElement(Nt.Fragment,null,Nt.createElement(W0,{onClick:t,variant:r?"light":"naked"},"Open"),e&&Nt.createElement(sEe,{onHide:n}))}const dEe=Yc((function(e){return{isShowingTestCard:"staging"===hi(lW(e))||"localhost"===hi(lW(e))}}))((function({currentUser:e,card:t,isShowingTestCard:n}){const r=e&&e.id,o=t&&function({last4:e}){switch(e){case"4242":return"Success";case"0341":return"Failure";default:return}}(t),i=(0,Ft.I0)(),a=(0,Nt.useCallback)((e=>i(AK.started({userId:"me",tokenJson:iEe(e)}))),[i]);return Nt.createElement("div",{className:"stack"},Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-900 px-2"},"Developer Options")),Nt.createElement(e0,{className:"justify-between"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2"},"User ID"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},r),r&&Nt.createElement(aEe,{text:r})),n&&Nt.createElement(e0,{className:"justify-between"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2"},"Stripe Test Credit Card"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2"},o?`In Use: ${o}`:"Not In Use"),Nt.createElement(Woe,null,Nt.createElement(Hoe,{asChild:!0},Nt.createElement(W0,{variant:"light"},"Edit")),Nt.createElement(tie,null,Nt.createElement(Zoe,{value:o,onValueChange:a},["Success","Failure"].map((e=>Nt.createElement(Joe,{key:e,label:e,value:e}))))))),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Auth"),Nt.createElement(cEe,null)))}));function lEe({children:e,...t}){return Nt.createElement(e0,{...t},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-900 px-2"},e))}function uEe({children:e,id:t,className:n}){return Nt.createElement(o0,{id:t,variant:"label-1-regular",className:yo()(n,"text-grey-400 px-2")},e)}function fEe({children:e,explanation:t}){return Nt.createElement(Nt.Fragment,null,Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-800 flex-1"},e),Boolean(t)&&Nt.createElement(ti,{tooltipClassName:"shared-module--HvYGAx",title:t}))}function mEe(e){document.title=(e?`${e} | `:"")+"Descript"}function pEe(e){(0,Nt.useEffect)((()=>{mEe(e)}),[e])}const gEe=(0,pn.ZP)(),hEe=(gEe("NAVIGATE_TO_WHATS_NEW"),gEe("NAVIGATE_TO_FEATURE_REQUESTS"),gEe("NAVIGATE_TO_APPS_AND_INTEGRATIONS"),gEe("CHAT_WITH_US"),gEe("SHOW_WHATS_NEW"),gEe.async("NAVIGATE_TO_STRIPE_CUSTOMER_PORTAL"));function vEe({email:e,canChangeEmail:t,changeEmailHint:n,updateValue:r,setShowUpdateButton:o,emailError:i,errorSet:a}){const s=(0,Ft.I0)(),[c,d]=Nt.useState(!0),l=Pr((t=>{r("email",t,e),d(!0),a("")})),u=Pr((e=>{const t=ae(e);d(t),t?a(""):(a("Invalid email"),o(!1))}));if($r(i)){const e=i?.json?.message??i?.message;e&&(a(`Invalid email: ${e}`),s(EK()),d(!1))}return Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1",id:"email-input"},"Email"),Nt.createElement("div",{className:"flex-1"},Nt.createElement(Sre,{"aria-labelledby":"email-input",align:"right",defaultValue:e,onValueChange:l,onSave:u,required:!0,hasError:!c,disabled:!t})),n&&Nt.createElement(ti,{title:n}))}function EEe({userId:e,email:t,updateValue:n,setShowUpdateButton:r,emailError:o,errorSet:i}){const{data:a,status:s}=tEe({userId:e}),c=(0,Ft.I0)(),l=Pr((()=>{c(DK({source:"profile-settings-add-username-password"}))})),{handleDelete:u,status:f,lastId:m}=function({userId:e}){const t=(0,Ft.I0)(),n=(0,Nt.useCallback)((async()=>{await td.refetchQueries([tEe.cacheName,{userId:e}])}),[e]),{mutate:r,status:o}=(0,u5.D)(UQ.bind(d,vt()),{onSettled:n,onSuccess:()=>{t(H2({text:"Removed sign in method"}))},onError:()=>{t(H2({text:"Failed to remove sign in method"}))}}),[i,a]=(0,Nt.useState)();return{handleDelete:(0,Nt.useCallback)((({authIdentityId:t})=>{"loading"!==o&&(a(t),r({userId:e,authIdentityId:t}))}),[r,o,e]),status:o,lastId:i}}({userId:e});if("loading"===s||void 0===a)return Nt.createElement(vEe,{email:t,canChangeEmail:!1,updateValue:n,setShowUpdateButton:r,emailError:o,errorSet:i});const{canChangeEmail:p,changeEmailHint:g,canAddUsernamePassword:h,identities:v}=a;return Nt.createElement(Nt.Fragment,null,Nt.createElement(vEe,{email:t,canChangeEmail:p,changeEmailHint:g,updateValue:n,setShowUpdateButton:r,emailError:o,errorSet:i}),Nt.createElement(Hse,{className:"my-3 mx-2",style:{width:"auto"}}),Nt.createElement(lEe,null,"Sign in methods"),v.map((t=>Nt.createElement(yEe,{key:t.id,userId:e,authIdentity:t,handleDelete:()=>u({authIdentityId:t.id}),isBeingDeleted:"loading"===f&&m===t.id,isDeletingAllowed:"loading"!==f}))),h&&Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2 flex-1"},"Password"),Nt.createElement(M2,{onSubmit:l},Nt.createElement(_2,{asChild:!0},Nt.createElement(W0,{variant:"light"},"Set up")),Nt.createElement(P2,null,Nt.createElement(D2,null,"Signing in with email & password"),Nt.createElement(O2,{className:"stack gap-2"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},"To set this up, logout and follow the ",Nt.createElement("b",null,"sign up")," flow. Use the same email as this account: ",Nt.createElement("b",null,t)," and enter your desired password. You will then be prompted to link your new sign in method with this account by logging in again.")),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,{style:{"--button-primary-color":"var(--red-800)"}},"Logout"))))))}function yEe({userId:e,authIdentity:t,handleDelete:n,isBeingDeleted:r,isDeletingAllowed:o}){const{id:i,displayName:a,canChangePassword:s,canRemove:c}=t,d=(0,Ft.I0)(),l=Pr((()=>{d(PK())}));return Nt.createElement(e0,{key:i},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2 flex-1"},a),s&&Nt.createElement(W0,{variant:"light",onClick:l},"Change password"),c&&(r?Nt.createElement(u0,{color:"var(--red-500)"}):Nt.createElement(M2,{onSubmit:n},Nt.createElement(_2,{asChild:!0},Nt.createElement(W0,{variant:"light",disabled:!o},Nt.createElement(o0,{variant:"label-1-medium",className:"text-red-500"},"Remove"))),Nt.createElement(P2,null,Nt.createElement(D2,null,"Remove sign in method"),Nt.createElement(O2,{className:"stack gap-2"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-900 px-2"},"Are you sure?"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},"You will no longer be able to sign in using ",a,". You may be asked to sign in again with another method.")),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,{style:{"--button-primary-color":"var(--red-800)"}},"Remove"))))))}function SEe({userId:e,client:t}){const n=(0,Ft.I0)(),r=Pr((()=>{n(H2({text:"Cancelled access for app"}))})),o=Pr((()=>{n(H2({text:"Failed to cancel access for app"}))})),{mutate:i,status:a}=function({userId:e,clientId:t,onSuccess:n,onError:r}){return(0,u5.D)((()=>jQ(vt(),e,t)),{onSuccess:()=>{const r=[nEe.cacheName,{userId:e}];td.setQueryData(r,(e=>e.filter((e=>e.id!==t)))),n?.()},onError:()=>{r?.()}})}({userId:e,clientId:t.id,onSuccess:r,onError:o});return Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2 flex-1"},t.name),"loading"===a?Nt.createElement(u0,{color:"var(--red-500)"}):Nt.createElement(W0,{variant:"light",onClick:i},"Cancel access"))}function IEe({userId:e}){const{data:t,status:n}=nEe({userId:e});return"loading"===n||void 0===t||0===t.length?_r:Nt.createElement(Nt.Fragment,null,Nt.createElement(lEe,null,"Manage apps connected to your account"),Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1"},"Cancelling access for an app may require up to 1 hour to take effect")),t.map((t=>Nt.createElement(SEe,{key:t.id,userId:e,client:t}))))}function bEe({user:e,dataConsentInfo:t,deleteUserError:n,card:r,isAdmin:o,userOwnedDrives:i,product:a,emailError:s,active:c,setShowUpdateButton:d},l){const[u,f]=Nt.useState(""),[m,p]=Nt.useState(),g=Nt.useRef(new Map),h=(0,Ft.I0)(),v=Pr(((e,t,n)=>{t===n?(g.current.delete(e),0===g.current.size?d(!1):d(!0)):(g.current.set(e,t),d(!0))})),E=Pr((e=>{g.current.set("profileImage",e),p(URL.createObjectURL(e)),d(!0)})),y=Pr((t=>{0!==t.trim().length?v("first_name",t.trim(),e.firstName):d(!1)})),S=Pr((t=>{0!==t.trim().length?v("last_name",t.trim(),e.lastName):d(!1)})),I=Pr((()=>{h(BK.started({optIn:!t?.isOptedIn}))})),[b,T]=Nt.useState(!1),w=Pr((t=>{t.preventDefault(),h(wK({userId:e.id})),T(!0)})),C=Pr((()=>{h(LK({}))})),_=nve(hEe.started),A=Pr((()=>{h(iZ({url:"https://www.descript.com/privacy"}))})),R=Pr((()=>{h(iZ({url:"https://help.descript.com/hc/en-us/articles/10255867607565"}))}));Nt.useImperativeHandle(l,(()=>({update:()=>{if(!g.current.size)return;const e={userUpdates:{}};g.current.forEach(((t,n)=>{"string"===typeof t&&t.length>0?e.userUpdates[n]=t:"profileImage"===n&&t instanceof File&&(e.profileImage=t)})),h(gK.started(e)),g.current=new Map,d(!1)}})));const M=m||e?.profileImageCdnUrl||e?.profileImageUrl;Nt.useEffect((()=>{c&&mEe("Account")}),[c]),qr([e]);const D=Boolean(afe("manage-auth-identities")),O=Boolean(afe("stripe-customer-portal"));return c?Nt.createElement("div",{className:"w-full pb-3"},u&&Nt.createElement(Pve,{className:"bg-amber-500-a mb-2",icon:Nt.createElement(g1,null)},u),Nt.createElement(lEe,null,Nt.createElement("h3",null,"Personal information")),Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1"},"Profile image"),Nt.createElement(Xve,{maxSizeInBytes:1048576,onChange:E,onError:f,button:Nt.createElement("button",{type:"button"},Nt.createElement(Tce,{"aria-hidden":!0,initials:e?.initials,profileImage:M,color:bl.ColorForUserId(e?.id||"",!0)}))})),Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1",id:"name-input"},"First name"),Nt.createElement("div",{className:"flex-1"},Nt.createElement(Sre,{"aria-labelledby":"name-input",align:"right",defaultValue:e?.firstName,onValueChange:y,required:!0}))),Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1",id:"last-name-input"},"Last name"),Nt.createElement("div",{className:"flex-1"},Nt.createElement(Sre,{"aria-labelledby":"last-name-input",align:"right",defaultValue:e?.lastName,onValueChange:S,required:!0}))),D?Nt.createElement(EEe,{userId:e.id,email:e.email,updateValue:v,setShowUpdateButton:d,emailError:s,errorSet:f}):Nt.createElement(vEe,{email:e.email,canChangeEmail:!0,updateValue:v,setShowUpdateButton:d,emailError:s,errorSet:f}),void 0!==i&&i.length>0&&Nt.createElement(Nt.Fragment,null,Nt.createElement(Hse,{className:"my-3 mx-2",style:{width:"auto"}}),Nt.createElement(lEe,null,"Billing details"),Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1"},"Credit card"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2 flex-1"},r?`${r.brand} ending in ${r.last4}`:a&&function({subscriptionStatus:e}){return"unpaid"===e||"past_due"===e}(a)?"Payment failed. Please update.":"No card on file..."),Nt.createElement(W0,{variant:"light",onClick:C},"Edit")),O&&Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1"},"Billing info"),Nt.createElement(W0,{variant:"light",onClick:_},"Edit"))),Nt.createElement(Hse,{className:"my-3 mx-2",style:{width:"auto"}}),Nt.createElement(lEe,null,"Share data with Descript"),Nt.createElement("div",{className:"px-2 py-1 row gap-2"},Nt.createElement("div",{className:"stack gap-2 flex-1"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800 py-1 px-2"},"Descript keeps your data private and confidential"),Nt.createElement("div",{className:"stack gap-1 max-w-md "},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2 mb-1"},"Help us improve the quality of transcription and the quality of other features. Our team analyzes your project information for the sole purpose of improving Descript."),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},"For more information, please view our"," ",Nt.createElement(d0,{onClick:A},"Privacy Notice"),"."))),Nt.createElement(W0,{variant:"light",onClick:I},t?.isOptedIn?"Allowed":"Not allowed")),Nt.createElement(Hse,{className:"my-3 mx-2",style:{width:"auto"}}),Nt.createElement(IEe,{userId:e.id}),Nt.createElement(Hse,{className:"my-3 mx-2",style:{width:"auto"}}),Nt.createElement(lEe,null,"Delete Account"),Nt.createElement("div",{className:"px-2 py-1 row gap-2"},Nt.createElement("div",{className:"stack gap-2 flex-1"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800 py-1 px-2"},"Delete your Descript account"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},"Once you delete your account, your data, files, projects, and compositions will be gone forever.")),Nt.createElement(M2,{onSubmit:w,isProcessing:b},Nt.createElement(_2,{asChild:!0},Nt.createElement(W0,{variant:"light"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-red-500"},"Delete account"))),Nt.createElement(P2,null,Nt.createElement(D2,null,"Delete Account"),Nt.createElement(O2,{className:"stack gap-2"},n?.json.message&&Nt.createElement(Pve,{className:"bg-amber-500-a mb-2",icon:Nt.createElement(g1,null)},n.json.message),Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-900 px-2"},"Are you sure?"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},"This action will immediately remove your personal data, files, projects and subscriptions. This action cannot be undone!"," ",Nt.createElement(d0,{onClick:R},"See here for full details"),".")),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,{style:{"--button-primary-color":"var(--red-800)"}},"Delete Account"))))),o&&Nt.createElement(Nt.Fragment,null,Nt.createElement(Hse,{className:"my-3 mx-2",style:{width:"auto"}}),Nt.createElement(dEe,{currentUser:e,card:r}))):_r}const TEe=Yc((function(e){const t=uW(e);return{user:Cl(e),dataConsentInfo:kl(e),deleteUserError:Rl(e),card:Dl(e),isAdmin:Ml(e),userOwnedDrives:tu(e),product:t?tH(e,t):void 0,emailError:xl(e)}}),void 0,void 0,{forwardRef:!0})(Nt.forwardRef(bEe));const wEe="Drive.disableWindowMinutes";function CEe({driveName:e,isOpen:t,onCancel:n,onDelete:r}){const o=e?`"${e}"`:"Drive";return Nt.createElement(M2,{open:t,onOpenChange:n,type:"alert",onSubmit:r},Nt.createElement(P2,null,Nt.createElement(D2,null,`Permanently delete ${o} and all its contents?`),Nt.createElement(L2,{className:"stack gap-2 px-2 pb-2"},Nt.createElement("p",null,"If you proceed, you, your collaborators & Descript support will not be able to recover any projects, transcripts, or media contained in this drive.")),Nt.createElement(F2,null,Nt.createElement(B2,null,"Don't delete"),Nt.createElement(j2,{style:{"--button-primary-color":"var(--red-800)"}},"Delete drive permanently"))))}const _Ee=Yc((function(e){return{isClearingFreeMinutes:e.drive.clearFreeMinutesInProgress,isDeletingDrive:e.drive.deleteDriveInProgress,isDeletingDriveProduct:e.drive.deleteDriveProductInProgress,isAdmin:Ml(e)}}))((function({driveId:e,driveName:t,onDeletionStarted:n,isClearingFreeMinutes:r,isDeletingDrive:o,isDeletingDriveProduct:i,isAdmin:a}){const s=(0,Ft.I0)(),c=(0,jt.k6)(),d=function(e,t,n){const[r,o]=(0,Nt.useState)((()=>D.getValue(e,t,n)));return(0,Nt.useEffect)((()=>D.getInstance()?.subscribeKey(e,((e,t)=>{o(t)}))),[e]),r}(wEe,!1,"Whether to disable window minutes on free drives"),l=Pr((()=>{e&&s(Q$.started({driveId:e}))})),u=Pr((t=>{e&&D.getInstance()?.set(wEe,t)})),f=Pr((()=>{e&&s(H$.started({driveId:e}))})),m=Pr((()=>{e&&(s(B$.started({driveId:e,history:c})),n?.())})),[p,g]=(0,Nt.useState)(!1),h=kr(r);return Nt.createElement("div",{className:"stack"},Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-900 px-2"},"Developer Options")),Nt.createElement(e0,{className:"justify-between"},Nt.createElement(uEe,null,"Drive ID"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},e),e&&Nt.createElement(aEe,{text:e})),Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1"},"Clear Free Minutes"),Nt.createElement(W0,{variant:"light",onClick:l,disabled:r},r?Nt.createElement(u0,{color:"var(--color-descript-red)"}):""+(h?"Cleared \u2714":"Clear"))),Nt.createElement(e0,{asChild:!0},Nt.createElement("label",null,Nt.createElement(uEe,{className:"flex-1"},"Disable Window Minutes (applies to all free drives)"),Nt.createElement(hie,{size:"small",checked:d,onCheckedChange:u}))),Nt.createElement(e0,{className:"justify-between"},Nt.createElement("div",{className:"stack gap-1"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800 px-2"},"Delete drive product"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},"This will immediately reset the drive plan to Free. Useful for testing.")),Nt.createElement(W0,{variant:"light",onClick:f,disabled:!a||i},i?Nt.createElement(u0,{color:"var(--color-descript-red)"}):a?"Delete product":"Requires admin")),Nt.createElement(e0,{className:"justify-between"},Nt.createElement("div",{className:"stack gap-1"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800 px-2"},"Delete this drive"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},"You can't get it back, so make sure you know what you're doing.")),Nt.createElement(W0,{variant:"light",onClick:()=>g(!0),disabled:o},o?Nt.createElement(u0,{color:"var(--color-descript-red)"}):"Delete drive")),Nt.createElement(CEe,{driveName:t,isOpen:p,onCancel:()=>g(!1),onDelete:m}))}));var AEe=(e=>(e.connect="squadcast_connect",e.callerDriveId="caller_drive_id",e.compositionName="composition_name",e.preApprovedOrgId="squadcast_pre_approved_org_id",e.redirectOrigin="redirect_origin",e))(AEe||{});const REe=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement("div",{ref:n,role:"presentation",className:yo()("stack flex-center gap-3",e),...t})})),MEe=Nt.forwardRef((function({icon:e,size:t=116,color:n,className:r,style:o,...i},a){const s=Nt.useContext(bo)?"var(--grey-50-a)":"var(--color-black-5pct)";return Nt.createElement("div",{ref:a,className:yo()("flex-center rounded-full text-grey-400",r),style:{...o,width:`${t}px`,height:`${t}px`,backgroundColor:n||s},...i},"string"===typeof e?Nt.createElement("img",{src:e,alt:""}):e)})),DEe=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement(o0,{variant:"label-1-regular",className:yo()("text-grey-400",!e?.includes("text-")&&"text-center",e),...t})}));function OEe({canDriveAdminAccess:e=!0}){return Nt.createElement("div",{className:"h-full w-full flex-center p-8 mb-8"},Nt.createElement(REe,null,Nt.createElement(MEe,{icon:Nt.createElement(g1,null),size:64}),Nt.createElement(DEe,null,"You must be a drive owner ",e?"or drive admin":""," to access these settings.")))}function xEe(e){return(0,vce.Z)(e||new Date,"MMM d, yyyy")}function kEe({product:e,showManageSubscriptionModal:t}){if(!e)return _r;const{subscriptionEndDate:n,productGroup:r,productGroupName:o,nextPhase:i,subscriptionStatus:a,pendingActionRedirectUrl:s,trialEndDate:c,seats:d,extraHours:l,interval:u}=e;let f,m="",p="";if("trialing"===a)m=`Your trial of ${o} ends in ${c?`${(0,ad.Z)(c,new Date)}`:"?"} days`,p="Trial",f="success";else if(n)m=`Your subscription will end on ${xEe(n)}`,p="Canceled",f="error";else if(a&&["incomplete","past_due","unpaid"].includes(a))p=function(e){if(!e)return"";switch(e){case"trialing":return"Trial";case"past_due":return"Past Due";case"unpaid":return"Unpaid";case"incomplete":return"Pending";default:return""}}(a),f="warning",m=s?"Please complete additional factor authentication to activate your subscription.":"Your subscription is inactive until you update your card on file.";else{if(!i)return _r;{const{productGroup:e,seats:t,extraHours:n}=i;if(e!==r)p="Downgraded",f="warning";else if(t<d||n<l)p="Scheduled";else{if(u===i.interval)return _r;p="Scheduled"}}}const g=Nt.createElement(Gse,{state:f,onClick:t},p);return m?Nt.createElement(ei,{title:m},g):g}function NEe({drive:e,setShowUpdateButton:t,isAdmin:n,isDriveAdmin:r,isDriveOwner:o,product:i,pageAccessDefault:a,newProjectPrivacyDefault:s,newProjectPrivacyFlag:c,showDrivePrivacyOption:d,updateDriveInProgress:l,active:u},f){const m=i&&$d(i.productGroup),[p,g]=Nt.useState(""),[h,v]=Nt.useState(),E=(0,Ft.I0)(),y=Nt.useRef({}),S=Pr(((e,n,r)=>{n===r?(e in y.current&&delete y.current[e],0===Object.entries(y.current).length?t(!1):t(!0)):(y.current={...y.current,[e]:n},t(!0))})),I=Pr((e=>{y.current.logo=e,v(URL.createObjectURL(e)),t(!0)})),b=Pr((n=>{n.trim().length>0?S("name",n.trim(),e?.name):t(!1)})),[T,w]=Nt.useState(e?.shareCustomBranding),C=Pr((()=>{u&&T!==e?.shareCustomBranding&&w(e?.shareCustomBranding)}));Nt.useEffect(C,[e?.shareCustomBranding,C]);const _=Pr((t=>{S("shareCustomBranding",t,e?.shareCustomBranding),w(t)})),A=Pr((t=>{E("descript_enterprise"===i?.productGroup?iZ({url:"mailto:enterprise@descript.com"}):WK({driveId:e?.id,upgradeOrigin:zK.Account,...t}))})),R=Boolean(afe("squadcast-entry-points")),M=Pr((()=>{E(iZ({url:"https://www.descript.com/remote-recording"}))})),D=Pr((()=>A())),O=Pr((()=>{window.location.href=function({driveId:e,compositionName:t,preApprovedOrgId:n,redirectOrigin:r}){let o=r$();"http:"===new URL(o).protocol&&(o=r$("staging"));const i=new URL(`${o}/use-squadcast`);return e&&i.searchParams.set(AEe.callerDriveId,e),t&&i.searchParams.set(AEe.compositionName,encodeURIComponent(t)),n&&i.searchParams.set(AEe.preApprovedOrgId,n),r&&i.searchParams.set(AEe.redirectOrigin,r),i}({driveId:e?.id,redirectOrigin:"settings"}).toString()})),x=Pr((t=>{const n=XW.find((e=>e.accessPermission===t));if(!n||!e)throw new Error("Invalid privacy option");E(U$.started({driveId:e.id,qemPrivacyDefault:n.accessPermission}))})),k=Pr((t=>{if(N){const n=t?zl.notPublic:zl.none;E(U$.started({driveId:e.id,newProjectPrivacyDefault:n}))}})),N=e?.id;(0,Nt.useEffect)((()=>{N&&E(k$.started({driveId:N,fetchOwnerData:!0}))}),[E,N]);const{[AEe.connect]:P,[AEe.preApprovedOrgId]:L,editHours:F,plan:U,billing_cycle:B,promo:j}=Jpe(),V="true"===P,z=Qpe(),G=Xpe();Nt.useEffect((()=>{if(!u)return;if(!e?.id)return;if(!U&&!B&&!j)return;const t=U?{free:"descript_free",pro:"descript_pro",creator:"descript_creator"}[U]:GK,n=B&&["month","year"].includes(B)?B:void 0;A({upgradeProductGroup:t,upgradeInterval:n,upgradeOrigin:V?zK.SquadCast:zK.Account,linkedPromoCode:j,squadCastPreApprovedOrgId:L}),G(AEe.connect,AEe.preApprovedOrgId,"plan","billing_cycle","promo")}),[e,U,e?.id,A,G,B,j,u,V,L]),Nt.useEffect((()=>{u&&F&&e?.id&&(A(),z("editHours"))}),[u,F,e?.id,A,z]);const W=Nt.useMemo((()=>{if(void 0===i)return"No plan found";const{subscriptionEndDate:e,subscriptionPausedUntilDate:t,currentPeriodEndDate:n,trialEndDate:r,productGroup:o,productGroupName:a,nextPhase:s,interval:c}=i,d=Hd(a||"");if("descript_free"===o||"descript_enterprise"===o)return d;const l=e?` (Until ${xEe(e)})`:s&&s.productGroup!==i.productGroup?` (Until ${xEe(n)})`:r?` (Starting ${xEe(r)})`:t?` (Billing paused until ${xEe(t)})`:Kd(o)?` (Renews ${xEe(n)})`:"";return r?s?`${d} Trial | Starting ${Wd(s.productGroup)} (${qd(c).toLocaleLowerCase()}) on ${xEe(r)} | ${Zd(i)} hours monthly transcription limit`:`${d} Trial | Until ${xEe(r)} | ${Zd(i)} hours monthly transcription limit`:`${d} | ${qd(c)} billing ${l} | ${Zd(i)} hours monthly transcription limit`}),[i]);if(Nt.useImperativeHandle(f,(()=>({update:()=>{const n=Object.entries(y.current);if(!n.length||!e)return;const r={driveId:e.id};n.forEach((([e,t])=>{r[e]=t})),E(U$.started(r)),y.current={},t(!1)}}))),Nt.useEffect((()=>{u&&(mEe("Subscription"),Xe("Subscription"))}),[u]),qr([e,i]),!u)return _r;const H=h||e?.logoCdnUrl;return r?Nt.createElement("div",{className:"w-full pb-3"},Nt.createElement(lEe,null,Nt.createElement("h3",null,"Subscription")),p&&Nt.createElement(Pve,{className:"bg-amber-500-a mb-2",icon:Nt.createElement(g1,null)},p),Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1"},"Drive icon"),Nt.createElement(Xve,{maxSizeInBytes:on,onChange:I,onError:g,button:H&&e?Nt.createElement("button",{type:"button"},Nt.createElement(Tce,{"aria-hidden":!0,initials:e?.name[0],profileImage:H,color:bl.ColorForUserId(e.id,!0)})):Nt.createElement(Yo,{"aria-label":"Add image"},Nt.createElement(Gde,null))})),Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1",id:"drive-name-input"},"Drive name"),Nt.createElement("div",{className:"flex-1"},Nt.createElement(Sre,{"aria-labelledby":"drive-name-input",align:"right",defaultValue:e?.name,onValueChange:b,maxLength:64}))),Nt.createElement(e0,null,Nt.createElement(uEe,{className:"flex-1"},"Custom branding"),Nt.createElement(ti,{title:"Use drive icon on published page and embeddable player"}),Nt.createElement(ei,{enabled:!m,title:"Upgrade to Pro for custom branding",asChild:!0},m?Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:T,onCheckedChange:_,"aria-label":"Upgrade"})):Nt.createElement(W0,{variant:"upgrade",onClick:D},"Upgrade"))),Nt.createElement(e0,null,Nt.createElement("div",{className:"row flex-1"},Nt.createElement(uEe,null,"Subscription"),Nt.createElement(kEe,{product:i,showManageSubscriptionModal:D})),Nt.createElement("div",{className:"row gap-2"},Nt.createElement(ti,{title:W}),i&&Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800 px-2"},Wd(i.productGroup)),o&&Nt.createElement(W0,{variant:"secondary",onClick:D},"descript_enterprise"===i?.productGroup?"Modify Plan":"Edit"))),R&&Nt.createElement(e0,null,Nt.createElement("div",{className:"row flex-1"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2"},"SquadCast"),Nt.createElement(Bce,null,Nt.createElement(jce,{asChild:!0},Nt.createElement(Yo,{style:{color:"var(--grey-400)"},"aria-label":"Learn more about squad cast"},Nt.createElement(Io,null))),Nt.createElement(Vce,null,Nt.createElement(Qo,{title:"SquadCast is Descript's remote recording tool",subtitle:Nt.createElement("button",{type:"button",className:"button-focus-inverted cursor-pointer rounded-sm"},"Learn more\u2197"),className:"cursor-pointer",onClick:M})))),Nt.createElement(d0,{onClick:O,className:"text-blue-500 label-1-medium"},"Connect to SquadCast")),Nt.createElement(e0,null,Nt.createElement("div",{className:"row flex-1"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2"},"Default publish privacy")),Nt.createElement(ei,{enabled:!r,title:"Only a drive owner or admin can change this default",subtitle:"You still can set the privacy setting on your recording after it's been recorded"},Nt.createElement(bse,{label:a.name,value:a.accessPermission,onValueChange:x,disabled:!r},XW.filter((e=>eH(e.accessPermission,a.accessPermission,d))).map((e=>Nt.createElement(Tse,{key:e.accessPermission,value:e.accessPermission,icon:e.icon,rightContent:e.tooltip&&Nt.createElement(yse,{placement:"top"},e.tooltip)},e.name)))))),c&&"descript_enterprise"===e?.currentProduct&&Nt.createElement(e0,null,Nt.createElement("div",{className:"row flex-1"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2"},"Default new projects to private workspace"),Nt.createElement(Bce,null,Nt.createElement(jce,{asChild:!0},Nt.createElement(Yo,{style:{color:"var(--grey-400)"},"aria-label":"Learn more about new project privacy"},Nt.createElement(Io,null))),Nt.createElement(Vce,null,Nt.createElement(Qo,{title:"New projects will be created in the user's Private workspace when this is enabled"})))),Nt.createElement(hie,{size:"small",checked:s===zl.notPublic,onCheckedChange:k,disabled:l})),n&&Nt.createElement(Nt.Fragment,null,Nt.createElement(Hse,{className:"my-3 mx-2",style:{width:"auto"}}),Nt.createElement(_Ee,{driveId:e?.id,driveName:e?.name}))):Nt.createElement(OEe,null)}const PEe=Yc((function(e){const t=uW(e),n=t?ru(e,t):void 0,r=t?tH(e,t):void 0,o="descript_enterprise"===r?.productGroup&&Boolean(HW(e,"show-drive-privacy-option"));return{driveId:t,drive:n,isAdmin:Ml(e),isDriveAdmin:!!t&&su(e,t),isDriveOwner:!!t&&au(e,t),product:r,pageAccessDefault:t?oH(e,t):QW,newProjectPrivacyDefault:t?iu(e,t):void 0,newProjectPrivacyFlag:Boolean(HW(e,"new-project-privacy")),updateDriveInProgress:e.drive.updateDriveInProgress,showDrivePrivacyOption:o}}),void 0,void 0,{forwardRef:!0})(Nt.forwardRef(NEe));var LEe="DriveMemberItem-module--O3xeWy",FEe="DriveMemberItem-module--QAT8J4";function UEe({invite:{inviteeEmail:e,id:t,membershipType:n},drive:{id:r},isCurrentUserAdmin:o}){const[i,a]=(0,Nt.useState)(!1),s=(0,Ft.I0)(),c=Pr((()=>s(z$.started({driveId:r,email:e,membershipType:n})))),d=Pr((e=>{e.preventDefault(),s(G$.started({driveId:r,inviteId:t})),a(!1)}));return Nt.createElement(M2,{open:i,onOpenChange:a,type:"alert",onSubmit:d},Nt.createElement(e0,{key:t,className:yo()("hover:bg-grey-50-a",FEe)},Nt.createElement(Tce,{"aria-hidden":!0,initials:e.charAt(0).toUpperCase()}),Nt.createElement("div",{className:"stack p-1 flex-1"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},e),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},"Invited")),Nt.createElement(o0,{variant:"label-2-regular",className:"text-grey-800 px-2 w-7"},Bl(n)),o?Nt.createElement(Woe,null,Nt.createElement(Hoe,{asChild:!0},Nt.createElement(Yo,{"aria-label":"Invitation options",className:LEe},Nt.createElement(Dde,null))),Nt.createElement(tie,{align:"end"},Nt.createElement(eie,{label:"Resend invitation",onSelect:c}),Nt.createElement(_2,{asChild:!0},Nt.createElement(eie,{label:"Revoke invitation",isDestructive:!0})))):Nt.createElement(Zo,null)),Nt.createElement(P2,null,Nt.createElement(D2,null,"Revoke drive invitation"),Nt.createElement(O2,null,"Are you sure you want to revoke the invitation for ",e,"?"),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,{style:{"--button-primary-color":"var(--red-800)"}}))))}function BEe({plan_id:e,amount:t,interval:n}){return{planId:e,amount:t,interval:n}}const jEe=rd("PLANS",{refetchOnWindowFocus:!1}),VEe=jEe("EXTRA_HOUR_PLANS",async function(e){return(await Rc(e,si.GET,"/plans/extra_hours")).map(BEe)}.bind(void 0,vt()));function zEe(e){const{data:t}=VEe();return(0,Nt.useMemo)((()=>t?.find((({interval:t})=>e===t))),[t,e])}jEe("WHITE_GLOVE_PLANS",async function(e){return(await Rc(e,si.GET,"/plans/white_glove_transcription")).map(BEe)}.bind(void 0,vt()));const GEe=jEe("PRODUCT",async function(e){const t=await Rc(e,si.GET,"/plans/main_products"),n={};for(const r of t)n[r.product_group]=r;return n}.bind(void 0,vt()));function WEe(e){const{data:t}=GEe();return(0,Nt.useMemo)((()=>{if(!e)return;const n=t?.[e];return n?function({product_group:e,name:t,hours_included:{month:n,year:r=0,day:o=0},pricing:{month:i,year:a=0,day:s=0}}){return{productGroup:e,name:t,hoursIncluded:{month:n,year:r,day:o},pricing:{month:i,year:a,day:s}}}(n):void 0}),[t,e])}function HEe(e,t,n,r,o,i){const a=function(e,t,n){const r=WEe(e);return(0,Nt.useMemo)((()=>{const e=(r?.pricing[t]??0)/100/("year"===t?12:"day"===t?.0333:1);return id(n,e)??e}),[r,t,n])}(e,t),s=function(e,t){return t?t*(e?e.amount/100:0):0}(zEe(t),r),c=i?function(e,t){let n=t,r=0;for(let{unitAmount:o,upTo:i}of e){if(o/=100,!i){r+=n*o;break}const e=n<i?n:i;if(r+=e*o,n-=e,0===n)break}return r}(i,n):a*n*("year"===t?12:"day"===t?.0333:1),d=c+s;return id(o,d)??d}function qEe({short:e}){const t=(0,Ft.I0)(),n=(0,Nt.useCallback)((()=>t(iZ({url:"https://help.descript.com/hc/en-us/articles/10163662152589"}))),[t]);return e?Nt.createElement(d0,{onClick:n},"Learn more"):Nt.createElement("span",null,"Learn more about"," ",Nt.createElement(d0,{onClick:n},"membership types"),".")}function $Ee({numberOfEmails:e,product:t,basePrice:n,unallocatedSeats:r,isDriveAdmin:o,includeInviteLinks:i}){if("descript_free"===t.productGroup)return;if(!o)return;const a=e||1;if(!i&&a<=r){const e=1!==a;return`You will be using up ${a} unallocated seat${e?"s":""} and will not be charged for adding ${e?"these":"this"} team member${e?"s":""}.`}const s=a-r,c=s+t.seats,d=n*s,l=n*c,u=1===s?"seat":"seats",f=t.currentPeriodEndDate?` and will be applied to your next bill on ${(0,vce.Z)(t.currentPeriodEndDate,"MMMM d, yyyy")}`:"";let m=!1;if("trialing"===t.subscriptionStatus){if(void 0===t.nextPhase||"descript_free"===t.nextPhase.productGroup)return;if(0===l)return;if(!i){return`${`After your trial ends and your Descript ${Wd(t.nextPhase.productGroup)} plan starts`}, your new total charge will be ${oe.format(l)} for all ${c} members per ${t.interval}${f}.`}m=!0}if(i){if(0===n)return;const e=oe.format(n),o=r>0?`You have ${r} free editor seat${1===r?"":"s"} left.`:void 0,i="descript_enterprise"===t.productGroup?"You will be charged for each editor that accepts an invite.":m?`After your trial ends, additional editor seats cost ${e}/${t.interval}.`:`Additional editor seats cost ${e}/${t.interval}.`;return o?`${o} ${i}`:i}if(0===d&&0===l)return;if("descript_enterprise"===t.productGroup)return`You will be charged for adding ${s} ${u}, prorated to your next billing cycle.`;const p=`prorated for the current ${qd(t.interval).toLowerCase()} billing cycle`;return`You will be charged ${oe.format(d)} for adding ${s} ${u}, ${p}.`}function KEe({numberOfEmails:e,product:t,unallocatedSeats:n,membershipType:r,isDriveAdmin:o,includeInviteLinks:i}){const a=Yd(t),s=HEe("trialing"===t.subscriptionStatus&&t.nextPhase?t.nextPhase.productGroup:t.productGroup,t.interval,1),c=(0,Nt.useMemo)((()=>$Ee({numberOfEmails:e,product:t,basePrice:s,unallocatedSeats:n,isDriveAdmin:o,includeInviteLinks:i})),[e,t,s,n,o,i]);return a&&o?i||"free"!==r?void 0===c?Nt.createElement("span",null,Nt.createElement(qEe,{short:i})):Nt.createElement("span",null,c," ",Nt.createElement(qEe,{short:!0})):Nt.createElement("span",null,"Basic members are free and can make screen recordings but have limited editing capabilities. ",Nt.createElement(qEe,{short:!1})):_r}Yc((function(e,{driveId:t}){return{product:t?tH(e,t):void 0,unallocatedSeats:t?rH(e,t):0}}))((function({product:e,...t}){return e?Nt.createElement(KEe,{...t,product:e}):_r}));function YEe({selectedMembershipType:e,setSelectedMembershipType:t,editorTypeDisabled:n,editorTypeDisabledMsg:r,...o}){return Nt.createElement(bse,{label:Bl(e),value:e,onValueChange:t,variant:"redesign",...o},Fl.map((e=>{const t=n&&"editor"===e;return Nt.createElement(ei,{key:e,title:r??"Editor disabled",placement:"bottom",enabled:t},Nt.createElement(Tse,{key:e,value:e,disabled:t},Bl(e)))})))}const ZEe=Yc((function(e){return{inProgress:e.drive.updateDriveMembershipInProgress,error:e.drive.updateDriveMembershipError}}))((function({product:e,unallocatedSeats:t,driveId:n,membershipId:r,initialMembershipType:o,hasOverdubVoicePermissions:i,memberSummary:a,hide:s,isDriveAdmin:c,inProgress:d,error:l}){const[u,f]=(0,Nt.useState)(o),m=(0,Ft.I0)(),p=(0,Nt.useCallback)((e=>{e.preventDefault(),m(X$.started({driveId:n,membershipId:r,updates:{type:u}}))}),[m,n,r,u]),g=(0,Nt.useCallback)((()=>{s(),m(eK())}),[m,s]),h=HEe("trialing"===e.subscriptionStatus&&e.nextPhase?e.nextPhase.productGroup:e.productGroup,e.interval,1),v=(0,Nt.useMemo)((()=>$Ee({numberOfEmails:1,product:e,basePrice:h,unallocatedSeats:t,isDriveAdmin:c,includeInviteLinks:!1})),[e,h,t,c]),E="descript_enterprise"!==e.productGroup?"Changing this member to Basic will deallocate 1 paid seat on your drive."+(i?" All Overdub licenses will also be deallocated.":""):"",y=Nt.useContext(bo),S=kr(d);(0,Nt.useEffect)((()=>{!S||d||l||s()}),[S,d,l,s]);const I="free"===u&&"editor"===o&&Yd(e)&&e?.coupon;return Nt.createElement(M2,{open:!0,onOpenChange:g,isProcessing:d,onSubmit:p},Nt.createElement(P2,{className:"ChangeMembershipTypeModal-module--rxh72f"},Nt.createElement(D2,{hasSeparator:!0},"Change membership type"),y?Nt.createElement(Nt.Fragment,null,a,l&&Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-medium",className:"text-red-800 ml-2"},l.json?.message))):Nt.createElement(L2,null,a,l&&Nt.createElement(Hve,{className:"ChangeMembershipTypeModal-module--XbzmRp",error:l.json?.message})),Nt.createElement(L2,null,Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-2-medium",id:"seat-label"},"Seat type:"),Nt.createElement(YEe,{selectedMembershipType:u,setSelectedMembershipType:f,"aria-labelledby":"seat-label"})),Nt.createElement(e0,null,u!==o&&Yd(e)&&Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},"editor"===u?v:E)),I&&Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},"Any existing promo code will be removed"))),Nt.createElement(F2,{hasSeparator:!0},Nt.createElement("div",{className:"pl-2"},Nt.createElement(qEe,{short:!0})),Nt.createElement(B2,null),Nt.createElement(j2,{disabled:u===o},"Change"))))}));function JEe(e,t=80){return(0,Nt.useMemo)((()=>e?e.length<t?e:e.substr(0,t-1)+"...":""),[e,t])}function QEe({membership:{user:e,id:t,type:n,isDriveOwner:r,isDriveAdmin:o},drive:i,product:a,unallocatedSeats:s,currentUser:{id:c},isCurrentUserAdmin:d,hasPendingUpgrade:l}){const{id:u}=i,{id:f,name:m,initials:p,email:g,profileImageCdnUrl:h}=e,v=(0,Ft.I0)(),E=(0,Nt.useMemo)((()=>Hl(i)),[i]),[y,S]=(0,Nt.useState)(!1),I=Pr((async()=>{S(!0),await async function(e,t,n){await Rc(e,si.PUT,`/drives/${t}/admin`,void 0,{user_id:n})}(vt(),u,f),v(k$.started({driveId:u,fetchOwnerData:!1})),S(!1)})),b=Pr((async()=>{S(!0),await async function(e,t,n){await Rc(e,si.DELETE,`/drives/${t}/admin`,void 0,{user_id:n})}(vt(),u,f),v(k$.started({driveId:u,fetchOwnerData:!1})),S(!1)})),T=function(e){const{seats:t,productGroup:n,interval:r,currentPeriodEndDate:o}=e,i=t-1,a=HEe(n,r,i),s=1===i?"member":"members",c=o?` and will be applied to your next bill on ${(0,vce.Z)(o,"MMMM d, yyyy")}`:"";return`Your new total will be ${oe.format(a)} per ${r} for the remaining ${i} ${s} going forward${c}.`}(a),[w,C]=(0,Nt.useState)(!1),[_,A]=(0,Nt.useState)(!1),R=(0,Nt.useMemo)((()=>i.voicePermissions?.filter((e=>e.userId===f))),[f,i]),M=Pr((e=>{e.preventDefault(),v(Z$.started({driveId:u,membershipId:t,initiatedLocally:!0})),A(!1)})),[D,O,x]=Nr(),k=(0,Ft.v9)((e=>e.drive.updateDriveMembershipInProgress)),N=JEe(i.name),P="editor"===n&&Yd(a)&&a?.coupon,L=Nt.createElement(e0,null,Nt.createElement(Tce,{initials:p,name:m,color:e.color(f===c,!0),profileImage:h}),Nt.createElement("div",{className:"stack p-1 flex-1"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},m),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},g)));return Nt.createElement(M2,{open:_,onOpenChange:A,type:"alert",onSubmit:M},Nt.createElement(e0,{className:yo()("hover:bg-grey-50-a",FEe)},Nt.createElement(Tce,{initials:p,name:m,color:e.color(f===c,!0),profileImage:h}),Nt.createElement("div",{className:"stack p-1 flex-1"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},m),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},g)),E&&o&&Nt.createElement(o0,{variant:"label-2-regular",className:"text-grey-400 px-2 w-7"},r?"Owner":"Admin"),l&&!d&&!k&&Nt.createElement(ti,{disableClickToClose:!0,title:(f===c?"You have":"User has")+" a pending upgrade request. Ask the owner to approve for editor access"}),k?Nt.createElement(u0,null):Nt.createElement(o0,{variant:"label-2-regular",className:"text-grey-800 px-2 w-7"},!E&&r?"Owner":Bl(n)),r||!d?Nt.createElement(Zo,null):Nt.createElement(Nt.Fragment,null,Nt.createElement(Woe,{open:w,onOpenChange:C},Nt.createElement(Hoe,{asChild:!0},Nt.createElement(Yo,{type:"button","aria-label":"Member options",className:LEe},Nt.createElement(Dde,null))),Nt.createElement(tie,{align:"end"},E&&Nt.createElement(eie,{label:o?"Remove drive admin":"Make drive admin",onSelect:o?b:I,disabled:y}),Nt.createElement(eie,{label:"Change membership type",onSelect:O}),Nt.createElement(Qoe,null),Nt.createElement(_2,{asChild:!0},Nt.createElement(eie,{label:"Remove member",isDestructive:!0})))))),Nt.createElement(P2,{style:{width:460}},Nt.createElement(D2,{hasSeparator:!0},`Remove user and their projects from ${N||"the current drive"}?`),L,Nt.createElement(L2,{className:"stack gap-2"},Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},"Are you sure you want to remove ",e.initials," and any projects they own from ",i.name,"?")),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},"Please transfer ownership of any projects you want to keep before removing this user, or contact us for help.")),"descript_enterprise"!==a.productGroup&&"free"!==n&&Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},T)),P&&Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},"Any existing promo code will be removed"))),Nt.createElement(F2,{hasSeparator:!0},Nt.createElement(B2,null),Nt.createElement(j2,{style:{"--button-primary-color":"var(--red-800)"}},"Remove anyway"))),D&&Nt.createElement(ZEe,{product:a,unallocatedSeats:s,driveId:u,membershipId:t,initialMembershipType:n,hasOverdubVoicePermissions:void 0!==R&&R.length>0,memberSummary:L,hide:x,isDriveAdmin:o}))}const XEe=Yc((function(e){return{deleteVoicePermissionModalParams:e.modal.deleteVoicePermissionModalParams,currentUserId:Al(e)}}))((function({deleteVoicePermissionModalParams:e,currentUserId:t}){const n=(0,Ft.I0)(),[r,o]=Nr(),i=(0,Nt.useCallback)((t=>{t.preventDefault(),e&&(o(),n(Z3.started({backendVoicePermission:e.backendVoicePermission})))}),[n,e,o]),a=(0,Nt.useCallback)((()=>{n(Y3(void 0))}),[n]);if(!e)return _r;const{user:s,userId:c,voice:d}=e.backendVoicePermission,l=J(c===t?"you":s?`${s.name} `:"this user ");return Nt.createElement(M2,{open:!0,onOpenChange:a,onSubmit:i,isProcessing:r},Nt.createElement(P2,null,Nt.createElement(D2,null,"Remove Overdub voice"),Nt.createElement(L2,null,Nt.createElement("div",{className:"DeleteVoiceDoubleModal-module--Ye95yD"},Nt.createElement("span",{className:"DeleteVoiceDoubleModal-module--HDC99z"},Nt.createElement(p1,null)),Nt.createElement(o0,null,Iee()`
                              ${l} won't be able to generate new audio with the Overdub voice${d?` (${d.name})`:""}. 
                              Already generated Overdub audio will not be affected.
                              Only the voice owner can re-grant access.
                            `))),Nt.createElement(F2,{hasSeparator:!0},Nt.createElement(B2,null),Nt.createElement(j2,{style:{"--button-primary-color":"var(--red-800)"}},"Remove"))))}));function eye({driveMemberships:e,upgradeRequest:t,searchValue:n}){const r=(0,Ft.I0)(),o=e?.find((e=>e.id===t.driveMembershipId))?.user,i=JEe(o?.name),a=Pr((e=>{e.preventDefault(),r(t8.started({driveId:t.driveId,driveMembershipId:t.driveMembershipId,upgradeRequestId:t.id,approve:!0}))})),s=Pr((e=>{e.preventDefault(),r(t8.started({driveId:t.driveId,driveMembershipId:t.driveMembershipId,upgradeRequestId:t.id,approve:!1}))})),{name:c,email:d}=o||{},l=(0,Nt.useMemo)((()=>!n||(!!(d||"").toLowerCase().includes(n.toLowerCase())||!!(c||"").toLowerCase().includes(n.toLowerCase()))),[n,d,c]);if(!o)return _r;if(!l)return _r;const{name:u,initials:f,email:m,profileImageCdnUrl:p}=o;return Nt.createElement(e0,{className:yo()("row space-between","hover:bg-grey-50-a",FEe)},Nt.createElement(Tce,{initials:f,name:u,color:o?.color(!1,!0),profileImage:p}),Nt.createElement("div",{className:"stack p-1 flex-1"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800"},i),"\xa0is requesting editor access"),Nt.createElement(o0,{variant:"label-2-regular",className:"text-grey-400"},m)),Nt.createElement("div",{className:"row"},Nt.createElement(W0,{variant:"light",className:"mr-2",onClick:s},"Deny"),Nt.createElement(W0,{variant:"light",onClick:a},"Approve")))}function tye({drive:e,memberships:t,unallocatedSeats:n,pendingUpgradeRequestIdSet:r,currentUser:o,product:i,isDriveAdmin:a}){const[s,c]=(0,Nt.useState)(100);if(!o||!i)return _r;const d=t.slice(0,s);return Nt.createElement("div",{"data-testid":"drive-member-area"},d.map((t=>Nt.createElement(QEe,{key:t.id,membership:t,drive:e,product:i,unallocatedSeats:n,currentUser:o,isCurrentUserAdmin:a,hasPendingUpgrade:"free"===t.type&&r.has(t.id)}))),s<t.length&&Nt.createElement(e0,{className:"flex justify-center"},Nt.createElement(W0,{onClick:()=>{const e=Math.min(t.length,s+100);c(e)},variant:"naked"},"Load More")))}const nye=Yc((function(e){const t=Al(e),n=uW(e),r=n?ru(e,n):void 0,o=!(!r||!t)&&$l({drive:r,userId:t}),i=n?tH(e,n):void 0;return{drive:r,editorInvitesRequireApproval:r?.editorInvitesRequireApproval,currentUser:Cl(e),isDriveAdmin:o,product:n?tH(e,n):void 0,showManuallyApproveNewEditorInvitesToggle:void 0!==i&&"descript_free"!==i.productGroup&&o,unallocatedSeats:n?rH(e,n):0,invites:n?du(e,n):void 0,pendingUpgradeRequests:n?lu(e,n):void 0,isShowingDeleteVoicePermissionModal:Boolean(e.modal.deleteVoicePermissionModalParams)}}))((function({drive:e,editorInvitesRequireApproval:t,product:n,showManuallyApproveNewEditorInvitesToggle:r,unallocatedSeats:o,invites:i,pendingUpgradeRequests:a,currentUser:s,isShowingDeleteVoicePermissionModal:c,showAddMemberModalOnLaunch:d,isDriveAdmin:l}){pEe("Team Members"),Vte("Members");const[u,f]=(0,Nt.useState)(""),m=function(e,t){const[n,r]=(0,Nt.useState)(e);return(0,Nt.useEffect)((()=>{const n=window.setTimeout((()=>{r(e)}),t);return()=>{window.clearTimeout(n)}}),[t,e]),n}(u,150),p=(0,Ft.I0)(),g=e?.id,h=Pr((()=>{g&&p(J$({driveId:g,origin:"members"}))}));(0,Nt.useEffect)((()=>{d&&g&&h()}),[h,d,g]),(0,Nt.useEffect)((()=>{g&&p(n8.started({driveId:g}))}),[p,g]);const{approve_upgrade_request_id:v,reject_upgrade_request_id:E}=Jpe(),y=Qpe();(0,Nt.useEffect)((()=>{if(g&&v&&a){const e=a.find((e=>e.id===v));e&&(p(t8.started({driveId:g,driveMembershipId:e.id,upgradeRequestId:v,approve:!0})),y("approve_upgrade_request_id"))}}),[g,p,a,v,y]),(0,Nt.useEffect)((()=>{if(g&&E&&a){const e=a.find((e=>e.id===E));e&&(p(t8.started({driveId:g,driveMembershipId:e.id,upgradeRequestId:E,approve:!1})),y("reject_upgrade_request_id"))}}),[g,p,a,E,y]);const[S,I]=(0,Nt.useState)(Ul.all),b=(0,Nt.useMemo)((()=>e?Kl(e,s?.id,S,m):[]),[e,s,S,m]),T=(0,Nt.useMemo)((()=>iK(i,S,m)),[i,S,m]);Nt.useEffect((()=>{g&&!n&&p(k$.started({driveId:g,fetchOwnerData:!0}))}),[g,n,p]),Nt.useEffect((()=>{void 0===g||i||p(j$.started({driveId:g}))}),[g,i,p]),qr([e,s]);const w=(0,Nt.useMemo)((()=>{if(!n||!e)return;const t=function(e){if(!e||!e.memberships)return;const{memberships:t}=e;return t.reduce(((t,n)=>{const r=t.admin+($l({drive:e,userId:n.user.id})?1:0);return"editor"===n.type?{...t,editor:t.editor+1,admin:r}:"free"===n.type?{...t,basic:t.basic+1,admin:r}:{...t,admin:r}}),{admin:0,editor:0,basic:0})}(e);if(!t)return;const{basic:r,editor:i,admin:a}=t,s=(e,t)=>`${t} ${e}`+(1===t?"":"s"),c=`There are ${s("basic member",r)} and ${s("editor member",i)}.`,d=a>1?` ${a} of these are admins.`:"",l=s("editor seat",o);return c+d+(o>0?` ${l} available.`:"")}),[n,e,o]),C=Pr((()=>{g&&p(tK.started({driveId:g,editorInvitesRequireApproval:!t}))})),_=new Set((a??[]).map((e=>e.driveMembershipId))),A=Pr((e=>{f(e.target.value)})),R=Pr((()=>{f("")})),M=(()=>{const e=b.length+T.length;return e<2?"Search members and invitees":`Search ${e} members and invitees`})();return Nt.createElement("div",{className:"stack gap-1"},Nt.createElement(e0,null,Nt.createElement("div",{className:"stack py-1 px-2 my-0.5 gap-1 flex-1"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800"},Nt.createElement("h3",null,e?`Members of ${e.name}`:"Members")),l&&w&&Nt.createElement(o0,{variant:"label-2-regular",className:"text-grey-400"},w," ",Nt.createElement(qEe,{short:!0}))),Nt.createElement(W0,{icon:Nt.createElement(Gde,null),onClick:h},"Add member")),r&&Nt.createElement(e0,null,Nt.createElement("div",{className:"stack py-1 px-2 gap-1 flex-1"},Nt.createElement(o0,{variant:"label-1-regular"},"Manually approve new editor invites")),Nt.createElement(hie,{size:"small",checked:t,onCheckedChange:C,"aria-label":(t?"Turn off":"Turn on")+" new editor invites require approval"})),Nt.createElement(e0,null,Nt.createElement(Xae,{value:u,onChange:A,onClear:R,placeholder:M,className:"flex-1"}),Nt.createElement(bse,{label:J(S),value:S,onValueChange:I,variant:"redesign"},Object.values(Ul).map((e=>Nt.createElement(Tse,{key:e,value:e},J(e)))))),e&&Nt.createElement("div",{className:"stack"},l&&(S===Ul.all||m&&S!==Ul.admins)&&a?.map((t=>Nt.createElement(eye,{key:t.id,driveMemberships:e.memberships,upgradeRequest:t,searchValue:m}))),T?.map((t=>Nt.createElement(UEe,{key:t.id,invite:t,drive:e,isCurrentUserAdmin:l}))),Nt.createElement(tye,{drive:e,memberships:b,unallocatedSeats:o,isDriveAdmin:l,pendingUpgradeRequestIdSet:_,currentUser:s,product:n})),c&&Nt.createElement(XEe,null))}));var rye="Table-module--mhVNhU",oye="Table-module--ojhQxK",iye="Table-module--bauE90",aye="Table-module--deMtIL",sye="Table-module--FHZ6Y4",cye="Table-module--laQHEX",dye="Table-module--KsAZau",lye="Table-module--J5iPk2",uye="Table-module--lMFqUR",fye="Table-module--vhG7IB",mye=n(41062);const pye="Grid",[gye,hye,vye]=(0,mye.B)(pye),[Eye]=(0,Qr.b)(pye,[vye]),[yye,Sye]=Eye(pye),Iye=Nt.forwardRef((function(e,t){return Nt.createElement(gye.Provider,{scope:e.__scopeGrid},Nt.createElement(gye.Slot,{scope:e.__scopeGrid},Nt.createElement(bye,{ref:t,...e})))})),bye=Nt.forwardRef((function({className:e,columns:t,style:n,__scopeGrid:r,role:o,...i},a){const[s,c]=Nt.useState(!1),[d,l]=Nt.useState(""),u=hye(r),[f,m]=Nt.useState(o),p=vo(),g=Pr((e=>{if(p&&e.target===e.currentTarget&&!s){const e=u().filter((e=>e.focusable)),t=e.find((e=>e.id===d)),n=[t,...e].filter(Boolean).map((e=>e.ref.current));setTimeout((()=>n[0]?.focus()))}}));return Nt.useEffect((()=>{m(o||u().length?"grid":"table")}),[o,u]),Nt.createElement(yye,{scope:r,columns:t,currentTabStopId:d,onItemFocus:Pr((e=>l(e))),onItemShiftTab:Pr((()=>c(!0)))},Nt.createElement(Co.g7,{ref:a,...i,tabIndex:s||"table"===f?-1:0,role:f,onBlur:(0,wo.M)(i.onBlur,Pr((()=>c(!1)))),onFocus:(0,wo.M)(i.onFocus,g)}))})),Tye=Nt.forwardRef((function({className:e,columns:t,rows:n,style:r,density:o="normal",...i},a){const s=Nt.useRef(_r),c=(0,s2.e)(s,a),[d,l]=Nt.useState(0),u=Nt.useMemo((()=>({...r,gridTemplateColumns:t,gridTemplateRows:n})),[t,n,r]);return Nt.useEffect((()=>{s.current&&l(s.current.querySelectorAll("tbody > tr:first-child > td").length)}),[]),Nt.createElement(Iye,{columns:d},Nt.createElement("table",{ref:c,...i,className:yo()(e,lye,b[o],"text-grey-800"),style:u}))})),wye=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement("thead",{ref:n,...t,className:yo()(e,cye)})})),Cye=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement("tbody",{ref:n,...t,className:yo()(e,rye,"text-grey-800")})})),_ye=Nt.forwardRef((function({className:e,style:t,...n},r){return Nt.createElement("tfoot",{ref:r,...n,className:yo()(e,aye)})})),Aye=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement("tr",{ref:n,...t,className:yo()(e,uye,"hover:bg-grey-50-a rounded-sm")})})),Rye=Nt.forwardRef((function({className:e,...t},n){return Nt.createElement("th",{ref:n,...t,role:"columnheader",className:yo()(e,dye,"label-1-medium text-grey-400 px-2 py-0")})})),Mye=Nt.forwardRef((function({className:e,onClick:t,...n},r){return Nt.createElement("td",{ref:r,...n,role:"cell",className:yo()(e,oye,"label-1-regular row")})})),[Dye,Oye]=(0,Qr.k)("VirtualizedTable",{}),xye=Nt.memo(Nt.forwardRef((function({style:e,...t},n){const r=Oye("VirtualizedTable.Row");return Nt.createElement(Aye,{ref:n,...t,style:r.columns?{...e,display:"grid",gridTemplateColumns:r.columns}:e})})));function kye({children:e,...t}){return Nt.createElement(Nt.Fragment,{...t},Nt.createElement(xye,null,e))}function Nye({children:e,...t}){return Nt.createElement(Nt.Fragment,{...t},e)}const Pye=Rye,Lye=Mye,Fye={overflowAnchor:"none"},Uye=Nt.memo((function({children:e,style:t,...n}){return Nt.cloneElement(Nt.Children.toArray(e)[0],{style:Fye,...n})})),Bye=Nt.memo((function({style:e,...t}){return Nt.createElement(Uye,{...t})})),jye=Nt.forwardRef((function({children:e,itemData:t,className:n,style:r,density:o,columns:i,rows:a,customScrollParent:s,...c},d){const[l,u]=Nt.useState(!1),{head:f,foot:m,mainChildren:p}=u2(e,{head:kye,foot:Nye}),g=Nt.useCallback((e=>{u(!e)}),[]),h=Nt.useCallback((()=>"compact"===o?32:40),[o]),v=Nt.useCallback((()=>Nt.createElement(Nt.Fragment,null,f)),[f]),E=Nt.useCallback((()=>Nt.createElement(Nt.Fragment,null,m)),[m]),y=Nt.useMemo((()=>({Table:Vye,TableBody:Cye,TableHead:wye,TableFoot:_ye,TableRow:Bye})),[]);return Nt.createElement(Dye,{density:o,columns:i,rows:a},Nt.createElement(p2._n,{ref:d,className:yo()(n,l&&sye),style:r,data:t,fixedHeaderContent:v,fixedFooterContent:E,itemContent:p?.[0],itemSize:h,useWindowScroll:!0,components:y,atTopStateChange:g,customScrollParent:s??void 0,...c}))}));function Vye({className:e,...t}){const n=Oye("VirtualizedTable.Root");return Nt.createElement(Tye,{...t,...Ee(n,"columns"),className:yo()(e,fye)})}const zye=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"file-text"})));var Gye=n(82961),Wye=n(81368),Hye=n(92312),qye=n(30916);const $ye=rd("BILLING");const Kye=$ye("INVOICES",async function(e,{id:t,idType:n}){if("drive"===n){const[n,r]=await Promise.all([R$(e,t),M$(e,t)]);return[...n,...r]}return await async function(e,t="me"){return(await Rc(e,si.GET,`/users/${t}/invoices`))?.list?.map(g$.fromJson)||[]}(e,t)}.bind(void 0,vt())),Yye=$ye("INVOICE",async function(e,{userId:t="me",invoiceId:n}){try{const e=await Rc(vt(),si.GET,`/users/${t}/invoices/${n}`);return g$.fromJson(e)}catch(r){if(404===r.statusCode)return await Promise.resolve(void 0);throw r}}.bind(void 0,vt())),Zye=$ye("TRANSCRIPT_RECEIPTS",async function(e,{id:t,queryJson:n,idType:r}){return"drive"===r?await async function(e,t,n){return(await Rc(e,si.GET,`/drives/${t}/transcript_receipts`,n)).map((e=>S$.fromJson(e)))}(e,t,n):await async function(e,t="me",n){return(await Rc(e,si.GET,`/users/${t}/transcript_receipt`,n)).map(S$.fromJson)}(e,t,n)}.bind(void 0,vt()));function Jye(){const e=(0,Ft.I0)();(0,Nt.useEffect)((()=>{e(MK())}),[e])}var Qye=n(20459),Xye=n(38134);function eSe({item:{createdAt:e,deliveredAt:t,audioDuration:n,audioFilename:r,language:o,projectId:i,isWhiteGlove:a,paidMinutes:s,freeMinutesUsed:c,prepaidMinutesUsed:d,windowMinutesUsed:l},...u}){const f=(0,Nt.useMemo)((()=>(0,vce.Z)(t||e||new Date,"M/d/yy h:mmaaa")),[e,t]),m=(0,Nt.useMemo)((()=>new Intl.DisplayNames(["en"],{type:"language"})),[]),p=(0,Nt.useMemo)((()=>s+c+d+l),[c,s,d,l]);return Nt.createElement(xye,{...u},Nt.createElement(Lye,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},f)),Nt.createElement(Lye,null,Nt.createElement(Bt.rU,{to:`/${i}`,className:"min-w-0"},Nt.createElement("div",{className:"stack gap-1"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800",ellipsisOverflow:!0},r),a&&Nt.createElement(o0,{variant:"label-2-regular",className:"text-grey-400"},"White Glove")))),Nt.createElement(Lye,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},p)),Nt.createElement(Lye,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},o?m.of(o):"-")))}function tSe(e,t,n,r){return Nt.createElement(eSe,{...r,item:t})}const nSe=(0,jt.EN)(Yc((function(e,{location:{search:t}}){const{userId:n}=Zpe(aZ.parse(t)),r=n?void 0:uW(e);return{driveId:r,isDriveAdmin:!!r&&su(e,r),product:r?tH(e,r):void 0}}))((function({scrollParentRef:e,driveId:t,isDriveAdmin:n,product:r}){pEe("Transcription Activity"),Vte("transcription-activity"),Jye();const o=(0,Ft.I0)(),{userId:i,startDate:a,endDate:s,type:c}=Jpe(),[d,l]=Nt.useState("last-week"),[u,f]=Nt.useState({startDate:(0,qye.Z)(a?new Date(a):(0,Hye.Z)(new Date,7)),endDate:(0,Wye.Z)(s?new Date(s):new Date)}),m=Pr((e=>{switch(l(e),e){case"last-week":f({startDate:(0,qye.Z)((0,Hye.Z)(new Date,7)),endDate:(0,Wye.Z)(new Date)});break;case"last-month":f({startDate:(0,qye.Z)((0,Gye.Z)(new Date,1)),endDate:(0,Wye.Z)(new Date)});break;case"last-6-months":f({startDate:(0,qye.Z)((0,Gye.Z)(new Date,6)),endDate:(0,Wye.Z)(new Date)});break;case"current-cycle":r&&"descript_free"!==r.productGroup?f((e=>({startDate:r.currentPeriodStartDate?(0,qye.Z)(r.currentPeriodStartDate):e.startDate,endDate:r.currentPeriodEndDate?(0,Wye.Z)(r.currentPeriodEndDate):e.endDate}))):f({startDate:(0,qye.Z)((0,Qye.Z)(new Date)),endDate:(0,Wye.Z)(new Date)})}})),p=void 0!==r;Nt.useEffect((()=>{p&&m("current-cycle")}),[m,p]);const[g,h]=Nt.useState(c),v=i||t,E=i?"user":"drive",y=Nt.useMemo((()=>({start_date:u.startDate,end_date:u.endDate,transcription_type:g,limit:5e3})),[u,g]),{data:S,status:I,error:b}=Zye(v&&{id:v,idType:E,queryJson:y}),T=S&&S.length>=5e3,{Automatic:w,WhiteGlove:C}=y$,_=g===w?"Automatic":g===C?"White Glove":"All transcriptions",A=Nt.useMemo((()=>S?.filter((({createdAt:e,isWhiteGlove:t})=>{const{startDate:n,endDate:r}=u;return!(void 0===e||e<n||e>(0,Wye.Z)(r))&&!(g===C&&!t||g===w&&t)}))),[S,u,g,C,w]),R=Nt.useMemo((()=>{if(T)return;return`${Ad(60*(A||[]).reduce(((e,t)=>e+t.paidMinutes+t.prepaidMinutesUsed+t.freeMinutesUsed+t.windowMinutesUsed),0))} transcribed since ${(0,vce.Z)(u.startDate,(0,Xye.Z)(u.startDate)?"MMMM d":"MMMM d, yyyy")}${g?` (${_} only)`:""}.`}),[A,T,u.startDate,g,_]);return Nt.useEffect((()=>{t&&!r&&o(W$.started({driveId:t}))}),[o,t,r]),qr([r]),n?b?Nt.createElement(Pve,{className:"bg-amber-500-a mb-2",icon:Nt.createElement(g1,null)},b.message):"loading"===I?Nt.createElement("div",{className:"h-full w-full flex-center"},Nt.createElement(u0,null)):Nt.createElement("div",{className:"stack"},Nt.createElement(e0,{className:"mb-1"},Nt.createElement("div",{className:"stack py-1 px-2 my-0.5 gap-1 flex-1"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800"},Nt.createElement("h3",null,"Transcription activity")),R&&Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},R))),Nt.createElement(e0,{className:"mb-2"},Nt.createElement(bse,{label:_,value:g||"",onValueChange:e=>h(e||void 0),menuAlign:"start",variant:"redesign"},Nt.createElement(Tse,{value:""},"All transcriptions"),Nt.createElement(Tse,{value:w},"Automatic"),Nt.createElement(Tse,{value:C},"White Glove")),Nt.createElement("div",{className:"flex-1"}),Nt.createElement(bse,{label:ee(d.replace(/-/g," ")),value:d||"",onValueChange:m,menuAlign:"end",variant:"redesign"},Nt.createElement(Tse,{value:"current-cycle"},"Current Cycle"),Nt.createElement(Tse,{value:"last-week"},"Last week"),Nt.createElement(Tse,{value:"last-month"},"Last month"),Nt.createElement(Tse,{value:"last-6-months"},"Last 6 months"))),T&&Nt.createElement(Pve,{className:"bg-amber-500-a mb-2",icon:Nt.createElement(g1,null)},"Some transcript receipts could not be displayed."),A&&A.length?Nt.createElement(jye,{columns:"120px 1fr 110px 96px",className:"mx-2 gap-2",itemData:A,customScrollParent:e.current,increaseViewportBy:{top:500,bottom:500}},Nt.createElement(kye,null,Nt.createElement(Pye,null,"Date"),Nt.createElement(Pye,null,"File name"),Nt.createElement(Pye,null,"Minutes used"),Nt.createElement(Pye,null,"Language")),tSe):!T&&Nt.createElement("div",{className:"h-full w-full flex-center p-8"},Nt.createElement(REe,null,Nt.createElement(MEe,{icon:Nt.createElement(zye,null),size:64}),Nt.createElement(DEe,null,"No transcript found for the selected date range.")))):Nt.createElement(OEe,null)})));function rSe(){const{innerWidth:e,innerHeight:t}=window;return{width:e,height:t}}const oSe=Nt.memo((function({onChange:e}){const t=Lve(),n=Nt.useRef(_r),r=Fve(n);return Nt.createElement(e0,null,Nt.createElement(l0.T,{id:"credit-card-label"},"Credit card info"),Nt.createElement(Uve,{ref:n,inputId:"card-input","aria-labelledby":"credit-card-label",border:"show"},Nt.createElement(bve.CardElement,{id:"card-input",options:{style:t,iconStyle:"solid"},onChange:e,onFocus:r})))})),iSe=n.p+"media/middle-grey-stripe-checkout.6b6f08c46b1faf3a906d.png";function aSe({card:e,cardholderName:t,onCardholderNameChange:n,onInputChange:r,inputLabel:o,showStripeBadge:i=!1,error:a}){const[s,c,d]=one();return zr({keyCode:Vr.ESCAPE,onPress:d}),Nt.createElement("div",{className:"CreditCardToggle"},s||!e?Nt.createElement(Nt.Fragment,null,o&&Nt.createElement("span",{className:"InputLabel"},o),a&&Nt.createElement(Hve,{error:a}),Nt.createElement(e0,null,Nt.createElement(l0.T,{id:"credit-card-name-label"},"Name on card"),Nt.createElement(Sre,{"aria-labelledby":"credit-card-name-label",placeholder:"Name on card",value:t,onValueChange:n,className:"flex-1",border:"show"})),Nt.createElement(oSe,{onChange:r}),i&&Nt.createElement("img",{className:"stripeBadge",src:iSe,alt:"Stripe trust badge"})):Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2 flex-1"},e.brand," ending in"," ",Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800"},e.last4)),Nt.createElement(W0,{onClick:c,variant:"light"},"Update")))}const sSe=rd("COUPON")("GET",async function(e,{couponCode:t,productGroup:n}){const r=n?{product_group:n}:void 0;return function({id:e,...t}){return{...od(t),id:e}}(await Rc(e,si.GET,`/coupon/${t}`,r))}.bind(void 0,vt()),{enabled:!1,retry:!1});const cSe="This code is not available for the selected plan.",dSe=["Expired","Invalid code",cSe,"Server error"],lSe={valid:"var(--green-500)",error:"var(--orange-500)",invalid:"var(--red-500)"};function uSe({initialPromoCode:e="",onCouponUpdated:t,small:n,onLoadingChanged:r,productGroup:o,onCancel:i,focusOnMount:a}){const[s,c]=(0,Nt.useState)(e),{data:d,fetchStatus:l,error:u,refetch:f}=sSe({couponCode:s,productGroup:o}),m="fetching"===l;(0,Nt.useEffect)((()=>{r?.(m)}),[r,m]),(0,Nt.useEffect)((()=>{e&&f()}),[e,f]),(0,Nt.useEffect)((()=>{t(d?.id===s?d:void 0)}),[t,d,s]);const p=404===u?.statusCode,g=403===u?.statusCode,h=d?.valid?"valid":s?.length&&(!1===d?.valid||p||g)?"error":u?"invalid":void 0,v=h?lSe[h]:void 0,E=!s||void 0!==d?.valid||!!u,y=(0,Nt.useCallback)((()=>{E||m||f()}),[f,E,m]),S=d?.valid?d.name:!1===d?.valid?"Expired":p?"Invalid code":g?cSe:u?"Server error":"Promo Code",I=Nt.useRef(_r);return Nt.useEffect((()=>{a&&I.current?.focus()}),[a]),Nt.createElement(Nt.Fragment,null,!!S&&dSe.includes(S)&&Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-medium",className:"text-red-800 px-2"},S)),Nt.createElement(e0,null,Nt.createElement(Sre,{ref:I,"aria-label":"Promo Code",border:"show",value:s,onValueChange:c,disabled:m,className:yo()("flex-1","PromoCodeField-module--lnGzqk"),style:{"--promo-text-color":v}})),Nt.createElement(e0,null,i&&Nt.createElement(W0,{variant:"light",onClick:i,className:"flex-1"},"Cancel"),Nt.createElement(W0,{className:"flex-1",onClick:y,disabled:E||m},"Apply")))}const fSe=new Map([[$$.AnotherProduct,"I found another product I like more."],[$$.Hard,"I would use it if it wasn't so hard/confusing."],[$$.TechnicalIssues,"I had too many technical issues."],[$$.MissingFeatures,"It's missing features I need."],[$$.NotNeeded,"Descript is great, but I don't need it anymore."],[$$.Break,"Taking a break, but I'll be back."],[$$.Consolidating,"I'm consolidating with another account."]]);const mSe=Yc((function(e,{driveId:t}){return{product:tH(e,t),requestError:e.auth.updatePlanError}}))((({driveId:e,productGroup:t,product:n,requestError:r})=>{const o=fSe,i=(0,Nt.useMemo)((()=>function(e){for(let t=e.length;t>0;t--){const n=Math.floor(Math.random()*t),r=e[t-1];e[t-1]=e[n],e[n]=r}return e}(Array.from(Array(o.size).keys()))),[o]),[a,s]=(0,Nt.useState)(new Set),[c,d]=(0,Nt.useState)(""),[l,u]=(0,Nt.useState)(!1),f=(0,Ft.I0)();(0,Nt.useEffect)((()=>{n&&rt("cancel_modal_viewed",{origin:"account",cancel_from_product:Gd(n),trial:"trialing"===n.subscriptionStatus})}),[n]);const m=(0,Nt.useCallback)((r=>{if(r.preventDefault(),void 0===n)return;const{interval:o}=n;f(K$.started({driveId:e,productGroup:t,analyticsData:{subscription_product:Gd(n),subscription_billing_cycle:o,reasons:a,reason_comment:c,trial:"trialing"===n.subscriptionStatus}})),u(!0)}),[f,e,t,n,a,c]),p=(0,Nt.useCallback)((()=>f(FK(void 0))),[f]),g=(0,Nt.useCallback)((e=>d(e.target.value)),[]),h=(0,Nt.useCallback)(((e,t)=>{s((e=>(e.delete(t)||e.add(t),new Set(e))))}),[]),v=(0,Nt.useMemo)((()=>{const e=Array(o.size);let t=0;return o.forEach(((n,r)=>{e[i[t++]]=Nt.createElement("div",{key:r,className:"CheckboxSelection"},Nt.createElement(Soe,{value:r,onCheckedChange:h,checked:a.has(r)},n))})),e}),[o,i,h,a]),E=(0,Nt.useMemo)((()=>n&&n.currentPeriodEndDate?`, on ${(0,vce.Z)(n.currentPeriodEndDate,"MMMM d, yyyy")}`:""),[n]),y=(0,Nt.useMemo)((()=>r&&r.json?r.json.message:""),[r]),S=n?.productGroup?`Descript ${Wd(n.productGroup)}`:"",I=`Cancel${S?` ${S}`:""}`,b=Nt.useContext(bo);return Nt.createElement(M2,{open:!0,onOpenChange:p,onSubmit:m,isProcessing:l&&!y},Nt.createElement(P2,{className:"CancelModal"},Nt.createElement(D2,null,I),Nt.createElement(L2,null,y&&Nt.createElement(Hve,{error:y}),Nt.createElement("div",{className:"Title"},"Mind telling us why you're cancelling? Check all that apply."),Nt.createElement("div",{className:"CheckboxContainer"},v),Nt.createElement("div",{className:"Title"},"Additional comments:"),b?Nt.createElement(Sre,{type:"area","aria-labelledby":"comments-title",placeholder:"Let us know how you really feel...",onValueChange:d,border:"show",rows:4,maxLength:1024}):Nt.createElement("textarea",{className:"CommentBox",placeholder:"Let us know how you really feel...",onChange:g,maxLength:1024}),Nt.createElement("div",{className:"Description"},"Want to cancel your subscription? No problem \u2014 you'll still have access to your paid features until the end of your current billing period",E,". You will still retain access to your projects even after downgrading to Free.")),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,{style:{"--button-primary-color":"var(--red-800)"}},"Cancel subscription"))))}));function pSe(){const e=(0,Ft.v9)((0,Nt.useCallback)((e=>e.modal.cancelModalParams),[]));return void 0===e?_r:Nt.createElement(mSe,{...e})}var gSe=n(5988),hSe=n(3979),vSe=n(60811);function ESe({hideModal:e,driveId:t,drive:n,product:r,error:o}){const i=(0,Ft.I0)(),[a,s]=(0,Nt.useState)(!r.pendingActionRedirectUrl),[c,d]=(0,Nt.useState)(!1),l=(0,Ft.v9)((e=>e.drive.deleteDriveProductInProgress)),u=(0,Nt.useCallback)((()=>{i(H$.started({driveId:t})),s(!0),d(!0)}),[i,t]),f=(0,Nt.useCallback)((()=>{e(void 0)}),[e]),m=(0,Nt.useCallback)((e=>{e.preventDefault(),r.pendingActionRedirectUrl&&(i(iZ({url:r.pendingActionRedirectUrl})),d(!0))}),[i,r.pendingActionRedirectUrl]),p=JEe(n?.name);if(!r.subscriptionStatus||"active"===r.subscriptionStatus)return f(),_r;const g="incomplete"===r.subscriptionStatus;return Nt.createElement(M2,{open:!0,onOpenChange:f,isProcessing:c||l,onSubmit:m},Nt.createElement(P2,null,Nt.createElement(D2,null,`Manage Subscription for ${p}`),o?.message&&Nt.createElement(N2,null,Nt.createElement(Hve,{error:o?.message})),Nt.createElement(O2,null,"Your card requires additional authentication to activate your subscription."),Nt.createElement(F2,null,g&&Nt.createElement(B2,{onClick:u},"Cancel pending subscription"),Nt.createElement(ei,{enabled:!r.pendingActionRedirectUrl,title:"Authentication for this card must be completed on your mobile device.\nIf needed, you can cancel and try subscribing with a different card."},Nt.createElement(j2,{disabled:a},"Complete authentication")))))}const ySe=Yc((e=>{const t=e.modal.manageSubscriptionModalParams?.driveId;return{product:t?tH(e,t):void 0,driveId:t,drive:t?ru(e,t):void 0,error:e.auth.updatePlanError}}),{hideModal:WK})((function({hideModal:e,driveId:t,drive:n,product:r,error:o}){return t&&n&&r?Nt.createElement(ESe,{hideModal:e,driveId:t,drive:n,product:r,error:o}):(e(void 0),_r)})),SSe=["descript_free","descript_creator","descript_pro"];function ISe(e){return(0,vce.Z)(e||new Date,"MMMM do, yyyy")}const bSe=["year","month"];function TSe({driveId:e,upgradeOrigin:t,upgradeOriginContext:n,upgradeProductGroup:r,linkedPromoCode:o,upgradeInterval:i,product:a,drive:s,card:c,updateInProgress:d,error:l,canCreateFreeDrive:u,isTrialing:f,displayTrialDaysRemaining:m,trialAutoRenewing:p,currentUser:g,squadCastPreApprovedOrgId:h}){const v=afe("subscription-modal-default-to-annual"),E=(0,bve.useStripe)(),y=(0,bve.useElements)(),S=f?a?.nextPhase?.productGroup||"descript_free":a?.productGroup||GK,I=i||a&&"descript_free"!==a.productGroup&&a.interval||(v?"year":"month"),b=a?.seats||1,T=a?.extraHours||0,w=a?.coupon,C=a?.currentPeriodEndDate,_=a?.productGroupName,A=a?.nextPhase?.productGroup,R=WEe(A),M=A&&A!==a?.productGroup,D=a?.nextPhase?.interval,O=D&&D!==I,x=a?.subscriptionEndDate;(0,Nt.useEffect)((()=>{rt("manage_subscription_modal_viewed",a?{origin:t,origin_context:n,product:S,interval:I,seats:b,extra_hours:T,coupon:w,downgrade_product_group:A,drive_id:e}:void 0)}),[a,t,n,S,I,b,T,w,A,e]);const k=function(e={}){const[t,n]=(0,Nt.useState)(e);return{logoState:t,handleLogoChange:(0,Nt.useCallback)(((e,t)=>n({logoFile:e,logoPreviewUrl:t})),[]),handleLogoError:(0,Nt.useCallback)((e=>n({logoError:e})),[])}}(),{logoState:{logoFile:N,logoPreviewUrl:P},handleLogoChange:L}=k,[F,U]=(0,Nt.useState)(""),[B,j]=(0,Nt.useState)(r||S);(0,Nt.useEffect)((()=>{f&&a?.productGroup&&j(a.productGroup)}),[f,a]);const[V,z]=(0,Nt.useState)(I),G=(0,Nt.useCallback)((()=>z("year")),[]),[W,H]=(0,Nt.useState)(b),[q,$]=(0,Nt.useState)(T),K=Pr((e=>{$(Math.max(e,de)-de)})),Y=afe("edu-nfp-plan-available")||"descript_education_orgs"===S,Z=(0,Nt.useMemo)((()=>{let t=[...SSe];return Y&&t.splice(1,0,"descript_education_orgs"),e||u||(t=t.filter((e=>"descript_free"!==e))),t}),[e,u,Y]),J=(0,Ft.I0)(),Q=(0,Nt.useCallback)((()=>J(iZ({url:"https://www.descript.com/pricing"}))),[J]),X=Kd(S),ee=Kd(B),te=Boolean(afe("transcription-window-minutes")),ne=X&&!ee,re=!!e&&(ne||"descript_pro"===S&&"descript_pro"!==B),ie=q-T,ae=WEe(B),se=Hd(ae?.name||""),ce=ae?.hoursIncluded[V]??10,de=(isNaN(W)?0:W)*ce,[le,ue]=(0,Nt.useState)(void 0),[fe,me]=(0,Nt.useState)(!1),[pe,ge]=(0,Nt.useState)(""),he=(0,Nt.useCallback)((e=>me(!e.empty)),[]),[ve,Ee]=one(Boolean(o)),ye=Nt.useRef(_r),Se=Pr((()=>{Ee(),requestAnimationFrame((()=>{ye.current?.focus()}))})),[Ie,be]=(0,Nt.useState)(w),Te=Ie?.valid&&function(e){return void 0!==e.id}(Ie)?Ie.id:void 0,[we,Ce]=(0,Nt.useState)(!1),_e=zEe(V),Ae=_e?.amount,Re=_e?.planId,Me=void 0!==Ae?q*Ae/100:0,De=void 0!==Ae?ie*Ae/100:0,Oe=B!==S,xe=V!==I,ke=Oe||xe,Ne="descript_creator"===S&&"descript_pro"===B,Pe=(0,Nt.useCallback)((e=>{j(e),Ie?.valid&&be(void 0)}),[Ie,be]),Le=HEe(B,V,W,q,Ie,ke?void 0:a?.priceTiers),Fe=HEe(B,V,W,q,void 0,ke?void 0:a?.priceTiers),Ue=ee?`${oe.format(Le)} per ${V}`:"Free",Be=(0,Nt.useCallback)((()=>{J(WK(void 0)),t===zK.SquadCast&&J(H2({text:"Cancelled connecting to SquadCast, start over to try again.",icon:$ee.Alert,dismissAfter:300}))}),[J,t]),je=W!==b,Ve=s?function(e){return e.memberships?.reduce(((e,{type:t})=>e+Number("free"!==t)),0)??0}(s):1,ze=je&&W<Ve,Ge=q!==T,We=Ie!==w,He=X&&!Ne&&(W<b||re||xe||q<T),qe=He&&C?C:new Date,$e=w!==Ie&&!1===Ie?.valid,Ke=He&&w&&w===Ie,Ye=ee&&(isNaN(W)||W<1||W>300||isNaN(q)||q<0||q>1e4),Ze=re&&(W>b||q>T)&&!f,Je=void 0!==a?.nextPhase?.extraHours&&T!==a.nextPhase.extraHours&&!f,Qe=void 0!==a?.nextPhase?.seats&&b!==a.nextPhase.seats&&!f,Xe=!Ye&&!d&&!we,et=Xe&&!$e&&!Ze&&!(ze||Ke)&&(!ee||(fe||pe?fe&&!!pe:!!c))&&(e?Oe||xe||je||Ge||We||fe||!1===p&&"descript_free"!==B:!!F&&F.trim().length>0),tt=(0,jt.k6)(),nt=Pr((async n=>{if(n.preventDefault(),!et)return;let r;if(ee&&(!c||fe)&&E&&y){const{token:e,error:t}=await E.createToken(y.getElement(bve.CardElement),{name:pe});if(t)return ue(t.message),void n.preventDefault();r={stripe_token:e?.id}}if(ue(void 0),!e)return void J(F$.started({name:F.trim(),createProductJson:{product_group:B,interval:V,seats:W,extra_hours:q,extra_hours_plan_id:Re,coupon:Te},logoFile:N,tokenJson:r,history:tt}));if(ne&&!f)return J(FK({driveId:e,productGroup:B})),void n.preventDefault();const o=Oe?B:xe?S:void 0;J(q$.started({driveId:e,updateProductJson:{product_group:o,interval:xe||o?V:void 0,seats:je?W:void 0,extra_hours:Ge?q:void 0,extra_hours_plan_id:Ge?Re:void 0,coupon:Te},tokenJson:r,isNewSubscriptionOrProductUpgrade:!X||Ne,editorInvitesRequireApproval:s?.editorInvitesRequireApproval,squadCastConnect:t===zK.SquadCast,squadCastPreApprovedOrgId:h}))})),ot=(0,Nt.useCallback)((()=>{!d&&e&&J(Y$.started({driveId:e}))}),[J,d,e]),it=WEe(r),at=(0,Nt.useMemo)((()=>{const e=it?.name;switch(t){case zK.SquadCast:return"Update to connect to SquadCast. Once connected, you will no longer be charged by SquadCast.";case zK.FileSize:return`${e} is required to add files greater than 250 MB.`;case zK.ExportTimeline:return`${e} is required to export a timeline`;case zK.Transcription:return"You've run out of free transcription minutes.";case zK.WhiteGlove:return`${e} is required to use White Glove transcription`;case zK.RateLimit:return"Increase your transcription rate limit to continue transcribing";default:return}}),[t,it]),st=t===zK.SquadCast,ct=le||l?.message||Ze&&"Cannot increase transcription limit or seats while downgrading"||ze&&"The current number of allocated paid seats exceeds the number of requested paid seats. Please remove extra editor members before reducing your paid seats."||Ke&&"Existing promo code cannot be applied to these changes",{width:dt}=function(){const[e,t]=(0,Nt.useState)(rSe());return(0,Nt.useEffect)((()=>{function e(){t(rSe())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),lt=e?dt<480?"Manage subscription":`Manage subscription for ${s?.name}`:"Create new drive",ut=(0,Nt.useCallback)((e=>{if(void 0!==m)return"descript_free"===e?`${p?"Schedule":"Scheduled"} in ${m}`:"Subscribe"}),[m,p]),ft=(0,Nt.useCallback)((e=>{if(void 0!==m){if(e===a?.productGroup)return p?`Renews in ${m}`:`${m} remaining`;if("descript_free"===e&&!p)return`Scheduled in ${m}`}}),[p,a,m]),mt=(0,Nt.useMemo)((()=>ft(B)),[B,ft]),pt=(0,Nt.useMemo)((()=>{if(!e)return"Create drive";const t=ut(B);return t||(re?"descript_free"===B?"Cancel subscription":"Downgrade":"Update")}),[e,re,B,ut]),gt=ISe(C),ht=ISe(qe),vt=(!M&&!x||f)&&!d&&ee,Et=et||!1===p&&"descript_free"===B,yt=(M||O||Qe||Je)&&!x&&!d&&!f,St=x&&!f&&!d,It=re||!1===p?`Your ${f&&void 0!==a?.productGroup?`Descript ${Wd(a.productGroup)} trial`:"subscription"} will end on ${gt}, after which you will no longer have access to the features of ${_}.`:"You need to upgrade your subscription to get additional transcription time.",bt=`Starting ${ht}, you will be charged`,Tt=X&&Boolean(e)?"You will be charged a prorated amount immediately":"You will be charged immediately",wt=!e||ke||je||He?` ${X?`per ${V.toLocaleLowerCase()}`:""} for the ${Wd(B)} plan with ${W} paid seat${W>1?"s":""}`:"",Ct=!ie||He&&0===q?"":`${!e||ke||je||He?" and":""} ${oe.format(He?Me:De)} per ${V.toLocaleLowerCase()} for ${He?q:ie}${!He&&T>0?" more":""} extra hour${(He?q:ie)>1?"s":""} of transcription each month`,_t=Ie?.valid?` After the discount has ended, your subscription will renew at $${Fe} per ${V}.`:"",At=ke&&!re?` Your subscription will then renew automatically each ${V} starting ${ISe("month"===V?(0,gSe.Z)(qe,1):"day"===V?(0,hSe.Z)(qe,1):(0,vSe.Z)(qe,1))}.`:"";return Nt.createElement(M2,{open:!0,onOpenChange:Be,isProcessing:d,onSubmit:nt},Nt.createElement(P2,{style:{maxWidth:"min(95vw, 635px)",width:"100%"}},Nt.createElement(D2,{isTruncated:!0,hasSeparator:!0},lt),at&&Nt.createElement(e0,{className:"mb-2"},Nt.createElement(Pve,{className:yo()(["flex-1",st?"bg-grey-50-a":"bg-amber-500-a"]),icon:st?Nt.createElement(Io,null):Nt.createElement(g1,null)},at)),Nt.createElement("div",{className:"flex gap-1"},Nt.createElement("div",{className:"flex-1 stack gap-2 px-2"},!e&&Nt.createElement(Nt.Fragment,null,Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1",id:"drive-name-label"},"Drive name"),Nt.createElement(Xve,{maxSizeInBytes:on,onChange:L,button:P?Nt.createElement("button",{type:"button","aria-label":"Choose new image"},Nt.createElement(Tce,{"aria-hidden":!0,className:"ManageSubscriptionModal-module--rF51Ah",profileImage:P,initials:F[0]})):Nt.createElement(Yo,{"aria-label":"Choose image"},Nt.createElement(D1,null)),disabled:d})),Nt.createElement(e0,null,Nt.createElement(Sre,{"aria-labelledby":"drive-name-label",placeholder:g?.firstName?`${g.firstName}'s Drive`:"My Drive",value:F,onValueChange:U,border:"show",className:"flex-1"}))),Nt.createElement("div",null,Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Your plan"),Nt.createElement(d0,{onClick:Q},"Compare Plans")),Nt.createElement(e0,null,Nt.createElement(bse,{className:"w-full",size:"large",variant:"redesign-border",fullWidthLabel:!0,label:Nt.createElement("div",{className:"row space-between"},Nt.createElement("span",null,Wd(B)),mt&&Nt.createElement("div",{className:"ManageSubscriptionModal-module--sW1arD"},mt)),disabled:d,value:B,onValueChange:Pe},Z.map((e=>{const t="descript_pro"===e?void 0:ft(e);return Nt.createElement(Tse,{key:e,value:e,rightContent:t?Nt.createElement(yse,null,t):void 0},Wd(e))}))))),ee&&Nt.createElement("div",null,Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1",id:"billing-cycle-label"},"Billing cycle"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1",id:"paid-seats-label"},"Paid seats")),Nt.createElement(e0,null,Nt.createElement(bse,{size:"large","aria-labelledby":"billing-cycle-label",variant:"redesign-border",className:"flex-1",label:qd(V),disabled:d,value:V,onValueChange:z},bSe.map((e=>Nt.createElement(Tse,{key:e,rightContent:"year"===e?Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},"Save 20%"):"day"===e?Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},"Dev only"):void 0,value:e},qd(e))))),Nt.createElement(pre,{"aria-labelledby":"paid-seats-label",value:W,onSave:e=>H(e),min:1,max:300,disabled:d,border:"show",className:"flex-1"}))),Nt.createElement("div",null,Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Transcription limit"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2"},ee?`${de}h included`:te?"1 hour per month":"3 hours (Lifetime)"),ee&&Nt.createElement(ti,{className:"ManageSubscriptionModal-module--Lr8u5m",tooltipClassName:"ManageSubscriptionModal-module--AWQOFp",title:`${se} drives include ${ce} transcription hours per editor member per month, shared across all members.`})),ee&&Nt.createElement(e0,null,Nt.createElement(pre,{"aria-label":"Transcription limit",value:q+de,onValueChange:K,onSave:K,min:de,max:1e4,disabled:d,border:"show",className:"w-full"}))),ee&&Nt.createElement("div",null,Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Payment information")),Nt.createElement(aSe,{card:c,onInputChange:he,onCardholderNameChange:ge,cardholderName:pe})),Nt.createElement("div",null,Ie&&(Ie.valid||w===Ie)?Nt.createElement(Nt.Fragment,null,Nt.createElement(e0,{className:"justify-between"},Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400"},"Promo code applied"),Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-800"},Ie.name)),Nt.createElement(e0,null,Nt.createElement(d0,{onClick:()=>be(void 0),className:"px-2 ml-auto",disabled:!Xe},"Change"))):ve?Nt.createElement(Nt.Fragment,null,Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400 flex-1"},"Enter promo code")),Nt.createElement(uSe,{small:!0,initialPromoCode:o,onCouponUpdated:be,onLoadingChanged:Ce,productGroup:B,onCancel:Se,focusOnMount:!0})):ee&&Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400 flex-1",id:"promo-code-label"},"Promo code"),Nt.createElement(Yo,{"aria-labelledby":"promo-code-label",onClick:Ee,ref:ye,disabled:!Xe},Nt.createElement(Gde,null))))),Nt.createElement("div",{className:"flex-1 stack"},Nt.createElement("div",{className:"flex-1 mt-1"},Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"px-2 text-grey-400"},e&&"descript_free"!==S?et?"New cost":"Current cost":`Total ${qd(V).toLocaleLowerCase()} cost`)),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"headline-4",className:"px-2 text-grey-900",numeric:!0},Ue)),vt&&Nt.createElement(e0,null,"month"===V&&Nt.createElement(d0,{onClick:G},"Save 20% by paying annually"),"year"===V&&Nt.createElement(o0,null,"Saving 20% over monthly plan.")),Et?Nt.createElement(e0,null,Nt.createElement(o0,{asChild:!0,color:"subtext",size:"finePrint"},Nt.createElement(Nt.Fragment,null,!ee&&It,ee&&Nt.createElement(Nt.Fragment,null,He?Nt.createElement(Nt.Fragment,null,bt):Tt,wt||Ct?" ":"",wt,Ct,".",At,_t)))):yt?Nt.createElement(e0,null,Nt.createElement(o0,{asChild:!0,color:"subtext",size:"finePrint"},Nt.createElement("div",null,"Your subscription is scheduled to switch to"," ",function(){const e=[R?.name?R.name:void 0,O?qd(D):void 0].filter(Boolean).join(" "),t=a?.nextPhase?.seats,n=Qe&&void 0!==t?`${t} seats`:void 0,r=a?.nextPhase?.extraHours;return[e,[n,Je&&void 0!==r?`${r} extra hours`:void 0].filter(Boolean).join(" and ")].filter(Boolean).join("  with ")}()," on"," ",ISe(C),". If you have changed your mind,"," ",Nt.createElement(d0,{onClick:ot},"you may resume your current subscription.")))):St?Nt.createElement(e0,null,Nt.createElement(o0,{asChild:!0,color:"subtext",size:"finePrint"},Nt.createElement("div",null,"Your subscription is scheduled to end on"," ",ISe(x),". If you have changed your mind about canceling,"," ",Nt.createElement(d0,{onClick:ot},`you may resume ${_}.`)))):""),Nt.createElement("img",{src:iSe,alt:"Stripe trust badge"}))),Nt.createElement(F2,{hasSeparator:!0},ct&&Nt.createElement(o0,{variant:"label-1-medium",className:"text-red-800"},ct),Nt.createElement(B2,null),Nt.createElement(j2,{style:re?{"--button-primary-color":"var(--red-800)"}:{},disabled:!et||d},pt)),Nt.createElement(pSe,null)))}function wSe({upgradeOrigin:e,upgradeOriginContext:t,upgradeProductGroup:n="descript_pro"}){const r=(0,Ft.I0)(),o=(0,Nt.useCallback)((()=>r(WK(void 0))),[r]);(0,Nt.useEffect)((()=>{rt("contact_drive_owner_to_upgrade_modal_viewed",{origin:e,originContext:t})}),[e,t]);const i=Wd(n);if(zK.Transcription===e){const e="Creator"===i?" or Pro":"";return Nt.createElement(M2,{open:!0,onOpenChange:o,type:"alert"},Nt.createElement(P2,null,Nt.createElement(D2,null,"Insufficient transcription hours"),Nt.createElement(O2,null,"You have attempted to transcribe a file that exceeds the number of available transcription hours on the drive. Please contact the drive owner to upgrade to a ",i,e," plan."),Nt.createElement(F2,null,Nt.createElement(j2,null,"Ok"))))}return Nt.createElement(M2,{open:!0,onOpenChange:o,type:"alert"},Nt.createElement(P2,null,Nt.createElement(D2,null,"Contact the drive owner"),Nt.createElement(O2,null,"Please contact the drive owner to upgrade your drive subscription."),Nt.createElement(F2,null,Nt.createElement(j2,null,"Ok"))))}const CSe=Yc((function(e){const t=e.modal.manageSubscriptionModalParams,n=t?.driveId,r=n?tH(e,n):void 0,o=tu(e),i=Jl(e).length>0&&!o||0===o?.length,a=r?.trialEndDate,s=void 0!==a;return{params:t,currentUser:Cl(e),product:r,drive:n?ru(e,n):void 0,card:Dl(e),updateInProgress:!(!e.auth.updatePlanInProgress&&!e.drive.createDriveInProgress),error:e.auth.updatePlanError||e.drive.createDriveError,canCreateFreeDrive:i,isDriveOwner:!!n&&au(e,n),isTrialing:s,displayTrialDaysRemaining:Xd(r),trialAutoRenewing:s?void 0===r?.subscriptionEndDate:void 0}}))((function({params:e,...t}){if(!e)return _r;const{drive:n,isDriveOwner:r}=t;return n&&!r?Nt.createElement(wSe,{upgradeProductGroup:e.upgradeProductGroup,upgradeOrigin:e.upgradeOrigin,upgradeOriginContext:e.upgradeOriginContext}):"incomplete"===t.product?.subscriptionStatus?Nt.createElement(ySe,null):Nt.createElement(TSe,{...e,...t})})),_Se=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"menu-1x"}))),ASe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"menu"}))),RSe=Nt.forwardRef((function(e,t){return Nt.createElement("div",{ref:t},Nt.createElement("div",{className:"icon-1x flex-center"},Nt.createElement(_Se,{...e,type:"icon"})),Nt.createElement("div",{className:"icon-2x flex-center"},Nt.createElement(ASe,{...e,type:"icon"})))})),MSe=(0,Nt.forwardRef)(((e,t)=>Nt.createElement(So,{ref:t,...e,name:"chevron-left"})));const DSe=function({id:e}){Jye(),Vte("invoice-detail");const t=(0,jt.TH)(),n=(0,jt.k6)(),r=t.state,{userId:o}=Jpe(),i=o||"me",{data:a,status:s}=Yye({userId:i,invoiceId:e}),c=a?.receiptUrl,d=a?(0,vce.Z)(new Date(a.date),"MMMM d, yyyy"):void 0,l=Pr((()=>{n.replace({pathname:t.pathname,search:"?active=invoices",state:t.state})}));return Nt.useEffect((()=>{d&&mEe(`Invoice ${d}`)}),[d]),"loading"!==s&&a?Nt.createElement("div",null,Nt.createElement(e0,{className:"mb-1 gap-0"},Nt.createElement(Yo,{"aria-label":"Go back to invoice list",onClick:l},Nt.createElement(MSe,null)),Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800 px-2 flex-1"},d),c&&Nt.createElement(d0,{href:c,target:"_blank",rel:"noopener noreferrer"},"View Receipt")),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Invoice ID"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},a.invoiceNumber)),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Billed date"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},d)),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Total amount due"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},oe.format(a.amountDue/100)),a.paid&&Nt.createElement(Gse,{state:"success"},"Paid")),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Billed to"),Nt.createElement("div",{className:"p-1 stack gap-1 items-end"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},`${a.user.firstName} ${a.user.lastName}`),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},a.user.email))),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Descript, Inc."),Nt.createElement("div",{className:"p-1 stack gap-1 items-end"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},"385 Grove St. San Francisco, CA, 94102"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},"support@descript.com"))),Nt.createElement(Hse,{className:"mx-2",style:{width:"auto"}}),Nt.createElement(Tye,{columns:"112px 1fr 112px",className:"px-2",style:{gridRowGap:0}},Nt.createElement(wye,null,Nt.createElement(Aye,null,Nt.createElement(Rye,null,"Date"),Nt.createElement(Rye,null,"Description"),Nt.createElement(Rye,null,"Cost"))),Nt.createElement(Cye,null,a?.lineItems?.map((e=>{const t={startDate:String((0,Hye.Z)(new Date(e.startDate),1)),endDate:String((0,Hye.Z)(new Date(e.endDate),1)),userId:i};return Nt.createElement(Aye,{key:e.id},Nt.createElement(Mye,null,(0,vce.Z)(new Date(e.startDate),"MMM dd, yyyy")),Nt.createElement(Mye,null,e.description,e.usageType!==h$.Licensed&&!e.isRefund&&Nt.createElement(Bt.rU,{replace:!0,to:{pathname:"/transcription-activity",search:`?${aZ.stringify(t)}`,state:r}},"View detail")),Nt.createElement(Mye,null,e.isRefund?"-":"",oe.format(Math.abs(e.amount)/100)))})))),Nt.createElement(Hse,{className:"mx-2",style:{width:"auto"}}),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Subtotal"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2",style:{width:112}},oe.format(a.subtotal/100))),void 0!==a?.percentOff&&a.percentOff>0&&Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Discount"),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2",style:{width:112}},oe.format(a.subtotal/100*(a.percentOff/100)))),Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400 px-2 flex-1"},"Total"),Nt.createElement("div",{className:"row gap-1",style:{width:112}},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2 flex-1"},oe.format(a.amountDue/100)),a.paid&&Nt.createElement(Gse,{state:"success"},"Paid")))):Nt.createElement("div",{className:"h-full w-full flex-center"},Nt.createElement(u0,null))};function OSe({item:{date:e,amountDue:t,id:n},...r}){const o=(0,jt.k6)(),i=(0,jt.TH)(),a=Nt.useMemo((()=>(0,vce.Z)(new Date(e),"MMMM d, yyyy")),[e]),s=Pr((()=>{o.replace({...i,search:aZ.stringify({...aZ.parse(i.search),invoiceId:n})})})),c=Pr((e=>{"Enter"!==e.key&&" "!==e.key||s()}));return Nt.createElement(xye,{...r,tabIndex:0,onClick:s,onKeyDown:c,className:"cursor-pointer button-focus-inset"},Nt.createElement(Lye,null,Nt.createElement("div",{className:"row w-full"},Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},a),(!n||n.startsWith("upcoming"))&&Nt.createElement(Nt.Fragment,null,Nt.createElement("div",{className:"split"}),Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},"Upcoming")))),Nt.createElement(Lye,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800"},oe.format(t/100))))}const xSe=function(e,t,n,r){return Nt.createElement(OSe,{...r,item:t})};function kSe(){return Nt.createElement("div",{className:"h-full w-full flex-center"},Nt.createElement(u0,null))}function NSe({scrollParentRef:e,invoiceId:t,drive:n,id:r,idType:o}){const{data:i,status:a,error:s}=Kye(void 0!==r&&{id:r,idType:o});return s?Nt.createElement(Pve,{className:"bg-amber-500-a mb-2",icon:Nt.createElement(g1,null)},s.message):"loading"===a?Nt.createElement(kSe,null):t?Nt.createElement(DSe,{id:t}):Nt.createElement("div",{className:"stack"},Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800 px-2"},Nt.createElement("h3",null,"user"===o?"Your invoices":n?`Invoices for ${n.name}`:"Invoices"))),i?.length?Nt.createElement(jye,{columns:"1fr 112px",className:"mx-2 gap-2",itemData:i,customScrollParent:e?.current,increaseViewportBy:{top:500,bottom:500}},Nt.createElement(kye,null,Nt.createElement(Pye,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-900"},"Invoice date")),Nt.createElement(Pye,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-400"},"Total amount"))),xSe):Nt.createElement(e0,null,Nt.createElement(o0,{variant:"label-1-regular",className:"text-grey-800 px-2"},"No invoices found.")))}const PSe=(0,jt.EN)(Yc((function(e,{location:{search:t},match:{params:{invoiceId:n}},driveId:r}){const o=Al(e),{invoiceId:i}=Zpe(aZ.parse(t));return{id:r||o,drive:r?ru(e,r):void 0,idType:r?"drive":"user",invoiceId:i||n}}))((function({scrollParentRef:e,invoiceId:t,drive:n,id:r,idType:o}){return r&&("drive"!==o||n)?Nt.createElement(NSe,{scrollParentRef:e,invoiceId:t,drive:n,id:r,idType:o}):Nt.createElement(kSe,null)})));const LSe=Yc((function(e){const t=uW(e);return{driveId:t,isDriveOwner:!!t&&au(e,t)}}))((function({scrollParentRef:e,driveId:t,isDriveOwner:n}){return pEe("Invoices"),Vte("Invoices"),Jye(),n?Nt.createElement(PSe,{scrollParentRef:e,driveId:t}):Nt.createElement(OEe,{canDriveAdminAccess:!1})}));function FSe({allSubscriptionGroups:e,subscriptionGroups:t,onSubscriptionGroupsChange:n}){return Nt.createElement(Nt.Fragment,null,e.map((({key:e,description:r})=>Nt.createElement(e0,{key:e},Nt.createElement(uEe,{className:"flex-1"},Q(e,{capitalize:!0})),Nt.createElement(ei,{hasNonInteractiveTrigger:!0,placement:"top",distance:2,title:r},Nt.createElement(Zo,null,Nt.createElement(Io,{className:"text-grey-400"}))),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:t.includes(e),onCheckedChange:()=>function(e){const r=t.includes(e)?t.filter((t=>t!==e)):[...t,e];n(r)}(e)}))))))}function USe({user:e}){const[t,n]=(0,Nt.useState)(void 0),{data:r,isLoading:o}=rEe(void 0),{data:i,isLoading:a}=oEe({email:e.email}),{upsertSubscriptionGroups:s,error:c}=function({email:e,onSuccess:t,onError:n}){const r=[oEe.cacheName,{email:e}],{mutate:o,error:i}=(0,u5.D)(HQ.bind(d,vt()),{onMutate:async({subscriptionGroups:e})=>(await td.cancelQueries({queryKey:r}),td.setQueryData(r,(()=>e)),e),onSuccess:()=>{t?.()},onError:()=>{n?.()}});return{upsertSubscriptionGroups:(0,Nt.useCallback)((({subscriptionGroups:t})=>o({email:e,subscriptionGroups:t})),[o,e]),error:i}}({email:e.email});return(0,Nt.useEffect)((()=>{mEe("Email preferences")}),[]),(0,Nt.useEffect)((()=>{n(c?"There was an error updating your subscription settings. Try again later.":void 0)}),[c]),a||o||void 0===i||void 0===r?Nt.createElement("div",{className:"h-full w-full flex-center"},Nt.createElement(u0,null)):Nt.createElement("div",{className:"pt-0.5"},t&&Nt.createElement(Pve,{className:"bg-amber-500-a mb-2 mx-2",icon:Nt.createElement(g1,null)},t),Nt.createElement(e0,{className:"stack items-start mb-3 gap-1 pt-2 px-3"},Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-800"},"Email preferences"),Nt.createElement(o0,{variant:"label-2-regular",className:"text-grey-400"},"Manage your Descript product email subscriptions")),Nt.createElement(FSe,{allSubscriptionGroups:r,subscriptionGroups:i,onSubscriptionGroupsChange:e=>s({subscriptionGroups:e})}))}function BSe({user:e},t){return void 0===e?_r:Nt.createElement(USe,{user:e})}const jSe=Yc((function(e){return{user:Cl(e)}}),void 0,void 0,{forwardRef:!0})(Nt.forwardRef(BSe));const VSe=Yc((function(e){return{appInstallId:sW(e)}}))((function({className:e,isLoaded:t=!1,loadingMessage:n,isDraggable:r=!1,timerDisabled:o=!1,isAnimationPaused:i=!1,isRedesign:a=!0,children:s,error:c,errorMessage:d,appInstallId:l,title:u}){const[f]=(0,Nt.useState)((()=>(0,Zt.Z)())),m={error:c,errorMessage:d,title:u},p=Object.values(m).some((e=>void 0!==e)),g=t&&!p,h=(0,Ft.I0)();return(0,Nt.useEffect)((()=>{if(g||o)return;const e=window.setTimeout((()=>h(W2({toastId:f,appInstallId:l}))),6e4);return()=>{window.clearTimeout(e),h(z2({toastId:f}))}}),[o,g,n,h,f,l]),Nt.createElement("div",{className:"h-full w-full","data-redesign":a||void 0},Nt.createElement("div",{className:yo()("Loader",e)},Nt.createElement("div",{className:yo()("Loading",{Hidden:g,Draggable:!g&&r})},!g&&(p?Nt.createElement("div",{className:"Message"},Nt.createElement("div",{className:"FadeIn"},Nt.createElement("div",{style:{position:"fixed",width:"100%",height:"100%"}},Nt.createElement(xIe,{context:"web",...m})))):Nt.createElement("div",{className:"Message"},Nt.createElement(lve,{size:60,isAnimationPaused:i}),Nt.createElement("div",{className:"Text"},n)))),g&&Nt.createElement("div",{className:"FadeIn"},s)))}));var zSe=n(48716);const GSe=Yc()((function({hideModal:e}){const t=(0,Ft.I0)(),n=(0,Nt.useCallback)((()=>{t(In({useOriginal:!0})),e()}),[t,e]);return Nt.createElement(M2,{type:"alert",open:!0,onOpenChange:e,onSubmit:n},Nt.createElement(P2,{style:{width:460}},Nt.createElement(D2,null,"Are you sure you want to download all project media to this computer?"),Nt.createElement(O2,null,"Project files for all existing and new projects will be downloaded in their entirety to this computer. This might take a long time, and a lot of storage space on this computer."),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,{style:{"--button-primary-color":"var(--red-800)"}},"Download everything"))))})),WSe="en",HSe=["ca","cs","da","de","el","es","fi","fr","hi","hr","hu","it","lv","lt","ms","no","nl","pl","pt","ro","sk","sl","sv","tr"];function qSe({languageNames:e}){const t=afe("l10n-languages-transcription"),n=(0,Nt.useMemo)((()=>new Set(String(t??"").split(","))),[t]);return(0,Nt.useMemo)((()=>[...HSe.reduce(((e,t)=>(n.has(t)&&e.add(t),e)),new Set([WSe]))].map((t=>({language:t,displayName:e.of(t)||t}))).sort(((e,t)=>e.language===WSe?Ie.OrderedAscending:t.language===WSe?Ie.OrderedDescending:be(e.displayName,t.displayName)))),[e,n])}function $Se({presetToDefaultLanguage:e,onChange:t,...n}){const r=(0,Ft.I0)(),o=(0,Ft.v9)(mW)||(e?WSe:void 0);return Nt.createElement(KSe,{...n,language:o,onChange:Pr((e=>{e!==o&&(r(Rn({language:e,source:"user_preferences"})),t?.(e))}))})}function KSe({onChange:e,language:t,...n}){const r=(0,Nt.useContext)(bo),o=(0,Nt.useMemo)((()=>new Intl.DisplayNames(["en"],{type:"language"})),[]),i=qSe({languageNames:o}),a=function(){const e=afe("l10n-beta-tags-transcription");return(0,Nt.useMemo)((()=>String(e??"").split(",")),[e])}(),s=Pr((n=>{n!==t&&e?.(n)}));return Nt.createElement(bse,{...n,label:t?o.of(t):"Select",variant:n.variant||(r?"redesign":void 0),value:t||"",onValueChange:s,roughMaxItems:10,"data-testid":"language-select"},i.map((({language:e,displayName:t})=>Nt.createElement(Tse,{key:e,value:e,rightContent:a.includes(e)?Nt.createElement(jae,null):void 0},t))))}var YSe=(e=>(e.Video="Video",e.Audio="Audio",e))(YSe||{});function ZSe(e,t){const n=SH(e,t);if("revision"===n?.docSyncMetadata?.type)return n.docSyncMetadata.unsavedRevisionModification||n.docSyncMetadata.creatingRevision}function JSe(e,t){return ZSe(e,t)||nme(e,t)}function QSe(e){const t=_H(e);if(t)return JSe(e,t)}function XSe({onCancel:e}){const t=nve(_n),n=(0,Nt.useCallback)((e=>{e.preventDefault(),t()}),[t]);return Nt.createElement(M2,{open:!0,onOpenChange:e,onSubmit:n},Nt.createElement(P2,null,Nt.createElement(D2,null,"Change offline storage location?"),Nt.createElement(O2,{style:{display:"flex",flexDirection:"column",gap:12}},Nt.createElement("p",null,"Descript backs up all of your files to the cloud, but files for the projects you're working on are stored on your computer for offline access."),Nt.createElement("p",null,"You can move the Descript folder, but you'll be logged out of your Descript account and will need to re-download your Project files. Manually changing the folder's contents could corrupt the data.")),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,null,"Select location"))))}function eIe({onCancel:e}){return Nt.createElement(M2,{open:!0,onOpenChange:e},Nt.createElement(P2,null,Nt.createElement(D2,null,"Pending file uploads"),Nt.createElement(O2,null,"You cannot change your storage location while files are uploading to Descript. Please wait for files to complete uploading and try again."),Nt.createElement(F2,null,Nt.createElement(B2,null),Nt.createElement(j2,{variant:"secondary"},"OK"))))}const tIe=Yc((function(e){return{hasPendingUploads:Boolean(QSe(e)||void 0!==TH(e)||void 0!==wH(e))}}))((function({hasPendingUploads:e,onCancel:t}){return e?Nt.createElement(eIe,{onCancel:t}):Nt.createElement(XSe,{onCancel:t})}));function nIe({defaultFlag:e,overrideFlag:t,label:n,explanation:r,onToggle:o}){const i=(0,Ft.I0)(),a=function(e,t){const n=afe(e),r=afe(t);return""!==r?"on"===r:n}(e,t),s=afe(t),c=Pr((t=>{i(M6({key:e,value:t})),o?.(t)}));return Nt.createElement(e0,{asChild:!0,className:"gap-0"},Nt.createElement("label",null,Nt.createElement(fEe,{explanation:r},n),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:a,onCheckedChange:"boolean"===typeof s?void 0:c}))))}const rIe="timeline-redesign-labs-eligible",oIe="timeline-redesign-default",iIe="timeline-redesign-global-override";function aIe(){return Boolean(afe(rIe))}function sIe(e){rt("timeline_redesign_toggled",{is_enabled:e})}function cIe(){return Nt.createElement(nIe,{label:"New timeline",explanation:"New design of timeline with better clip editing and improved selection states",defaultFlag:oIe,overrideFlag:iIe,onToggle:sIe})}const dIe="hide-card-rail-default",lIe="hide-card-rail-global-override";function uIe(){return Nt.createElement(nIe,{label:"Hide scenes in single scene compositions",explanation:"For compositions with only one scene, this hides the scene gutter and the slashes in the script to simplify the editing experience",defaultFlag:dIe,overrideFlag:lIe})}const fIe="new-media-range-picker-default",mIe="new-media-range-picker-global-override";function pIe(){return Nt.createElement(nIe,{label:"New media range picker",explanation:"New design of media range picker with better clip selection",defaultFlag:fIe,overrideFlag:mIe})}const gIe="insert-sidebar-default",hIe="insert-sidebar-global-override";function vIe(){return Nt.createElement(nIe,{label:"Insert sidebar",explanation:"A new left sidebar for inserting media and managing composition.",defaultFlag:gIe,overrideFlag:hIe})}function EIe(){const e=aIe(),t=Boolean(afe("hide-card-rail-eligible")),n=Boolean(afe("new-media-range-picker-eligible")),r=Boolean(afe("insert-sidebar-eligible")),o=Pr((()=>{rt("labs_feedback_clicked")}));return e||t||n||r?Nt.createElement("div",{className:"pb-4"},Nt.createElement("div",{className:"stack pb-2 px-1 mr-2 rounded border border-grey-100-a"},Nt.createElement(lEe,{size:"small",className:"mt-2 pb-0"},"Labs"),Nt.createElement(e0,{size:"small",className:"mb-1 gap-0"},Nt.createElement(o0,{className:"px-2 text-grey-400",variant:"label-1-regular"},"Preview unreleased features today!"),Nt.createElement(d0,{href:"https://help.descript.com/hc/en-us/articles/23515226920973-Descript-Labs",variant:"secondary"},"Learn More\u2197")),Nt.createElement("div",{className:"stack"},e&&Nt.createElement(cIe,null),t&&Nt.createElement(uIe,null),n&&Nt.createElement(pIe,null),r&&Nt.createElement(vIe,null),Nt.createElement(e0,{size:"small",className:"justify-between rounded bg-grey-100-a"},Nt.createElement(o0,{className:"px-2 text-grey-400",variant:"label-1-regular"},"Help us improve Labs features"),Nt.createElement(o0,{variant:"label-1-medium",className:"cursor-pointer",style:{color:"var(--color-descript-blue)"},onClick:o},"Leave Feedback"))))):_r}function yIe(){const e=(0,Ft.I0)(),[t,n,r]=Nr(!1),[o,i,a]=Nr(!1),s=Boolean(afe("offline-storage-location")),c=(0,Ft.v9)(fW);(0,Nt.useEffect)((()=>{s&&void 0===c&&e(An.started())}),[e,s,c]);const d=(0,Ft.v9)(EW),l=(0,Nt.useCallback)((()=>{e(bn(!d))}),[e,d]),u=(0,Ft.v9)(IW),f=Pr((()=>{e(Cn(!u))})),m=(0,Ft.v9)(SW),p=(0,Nt.useCallback)((()=>{e(wn(!m))}),[e,m]),g=!(0,Ft.v9)(vW),h=(0,Nt.useCallback)((()=>{g?i():e(In({useOriginal:!1}))}),[e,g,i]),v=(0,Ft.v9)(yW),E=(0,Nt.useCallback)((()=>{e(Tn(!v))}),[e,v]),y=(0,Ft.v9)(gW),S=(0,Nt.useMemo)((()=>new Intl.DisplayNames(["en"],{type:"language"})),[]),I=Pr((t=>{t!==y&&e(Dn({colorScheme:t}))})),b=(0,Ft.v9)(pW),T=Pr((t=>{t!==b&&e(Mn({projectType:t}))})),w=qSe({languageNames:S}),C=(0,Ft.v9)(hW),_=(0,Nt.useCallback)((t=>{e(On({alwaysPrompt:t,source:"user_preferences"}))}),[e]),A=afe("labs-settings");return Nt.createElement(bo.Provider,{value:!0},Nt.createElement("div",{className:"stack px-1 mb-4"},Nt.createElement(e0,{asChild:!0,className:"gap-0"},Nt.createElement("label",null,Nt.createElement(uEe,{className:"flex-1"},"Default project"),Nt.createElement(bse,{label:b||"Select",variant:"redesign",value:b||"",onValueChange:T},Object.values(YSe).map((e=>Nt.createElement(Tse,{key:e,value:e},e)))))),w.length>1&&Nt.createElement(Nt.Fragment,null,Nt.createElement(e0,{asChild:!0,className:"gap-0"},Nt.createElement("label",null,Nt.createElement(uEe,{className:"flex-1"},"Default transcription language"),Nt.createElement($Se,null))),Nt.createElement(e0,{asChild:!0,className:"gap-0"},Nt.createElement("label",null,Nt.createElement(uEe,{className:"flex-1"},"Always ask before transcribing"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:!0===C,onCheckedChange:_}))))),Nt.createElement(e0,{asChild:!0,className:"gap-0 mb-2"},Nt.createElement("label",null,Nt.createElement(uEe,{className:"flex-1"},"Theme"),Nt.createElement(bse,{label:(0,zSe.I)(y),variant:"redesign",value:y,onValueChange:I,roughMaxItems:10},Ar.map((e=>Nt.createElement(Tse,{key:e,value:e},(0,zSe.I)(e))))))),Nt.createElement(lEe,null,"Advanced"),Nt.createElement(e0,{asChild:!0,className:"gap-0"},Nt.createElement("label",null,Nt.createElement(fEe,{explanation:"By default, new projects will have auto-leveling enabled, which applies -16dB loudness normalization to all new clips. This setting can be overridden in each project's settings."},"Automatic volume levels"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:v,onCheckedChange:E})))),Nt.createElement(e0,{asChild:!0,className:"gap-0"},Nt.createElement("label",null,Nt.createElement(fEe,{explanation:"By default, new projects will use room tone on gap clips instead of silence. This setting can be overridden in each project's settings."},"Use room tone on gap clips"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:d,onCheckedChange:l})))),Nt.createElement(e0,{asChild:!0,className:"gap-0"},Nt.createElement("label",null,Nt.createElement(fEe,{explanation:"Descript automatically optimizes video assets for smooth playback while editing. If disabled, you can still manually trigger optimization per file."},"Optimize video files for playback"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:m,onCheckedChange:p})))),Nt.createElement(e0,{asChild:!0,className:"gap-0"},Nt.createElement("label",null,Nt.createElement(fEe,{explanation:"Only download original files when needed for export or other operations. This setting can be overridden in each project's settings."},"Optimize computer storage"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:g,onCheckedChange:h})))),s&&Nt.createElement(e0,{className:"gap-0"},Nt.createElement(fEe,{explanation:c?.path??"Change where files for the projects you're working on are stored on your computer for offline access."},"Offline storage location"),Nt.createElement(W0,{"aria-labelledby":"file-location",variant:"light",onClick:n},"Change")),Nt.createElement(e0,{asChild:!0,className:"gap-0"},Nt.createElement("label",null,Nt.createElement(fEe,null,"Open links to projects in desktop app"),Nt.createElement(Zo,null,Nt.createElement(hie,{size:"small",checked:u,onCheckedChange:f})))),t&&Nt.createElement(tIe,{onCancel:r}),o&&Nt.createElement(GSe,{hideModal:a})),Boolean(A)&&Nt.createElement(EIe,null))}const SIe=Nt.createElement("div",{className:"h-full w-full flex-center"},Nt.createElement(u0,null));function IIe({children:e}){return Nt.createElement(e0,null,Nt.createElement(o0,{ellipsisOverflow:!0,variant:"label-1-medium",className:"text-grey-900 px-2"},e))}function bIe({children:e,isActive:t,className:n}){return Nt.createElement("li",{className:yo()(n,"AccountDialog-module--iK2zAB","h-6 px-2 row w-full relative",t?["AccountDialog-module--CwLGnA","label-1-medium"]:"text-grey-400 label-1-regular")},Nt.createElement("div",{className:yo()("AccountDialog-module--AJdH5B","bg-grey-50-a rounded-sm absolute inset-1")}),e)}var TIe=(e=>(e.profile="profile",e.notifications="notifications",e.subscription="subscription",e.members="members",e.transcriptionActivity="transcription-activity",e.invoices="invoices",e.general="general",e.unknown="unknown",e))(TIe||{});const wIe=Object.values(TIe);(0,jt.EN)(Yc((function(e,{location:{search:t}}){const{driveId:n}=Zpe(aZ.parse(t)),r=uW(e),o=r?ru(e,r):void 0,i=r?tH(e,r):void 0;return{driveId:r,driveIdFromRoute:n,currentUser:Cl(e),drive:o,isShowingEditPassword:e.modal.isShowingEditPassword,errorChangePasswordEmail:e.auth.errorChangePasswordEmail,needsToFetchDriveAndProduct:!o||!i||!o?.memberships,userDrives:Jl(e),userOwnedDrives:tu(e),userAdminDrives:nu(e)}}))((function({driveId:e,driveIdFromRoute:t,currentUser:n,drive:r,isShowingEditPassword:o,errorChangePasswordEmail:i,needsToFetchDriveAndProduct:a,userDrives:s,userOwnedDrives:c,userAdminDrives:d,showUnsavedChangesWarningSet:l,showUpdateButtonSet:u,showUnsavedChangesWarning:f,showUpdateButton:m,inDialog:p}){Jye();const[g,h]=Nt.useState(!1),v=Qpe(),E=Xpe(),y=Pr((()=>h(!1))),S=(0,jt.TH)().state,I=(0,jt.k6)(),b=function(){const{search:e}=(0,jt.TH)();return Nt.useMemo((()=>new URLSearchParams(e)),[e])}(),T=Nt.useRef(_r);let w="unknown";const C=b.get("active")||"profile";wIe.includes(C)&&(w=C);const _="true"===b.get(AEe.connect),A=(0,Ft.I0)(),R=Nt.useRef(_r),M=Nt.useRef(_r),D=nve(NK),O=nve(VK.started),x=Boolean(Vc("email-subscription-groups")),k=()=>{R.current?.update(),M.current?.update(),l(!1)},N=Pr((e=>{e.preventDefault(),k()})),P=Pr((()=>{I.push(fa)})),L=Pr((()=>{l(!1),I.goBack()})),F=Pr((e=>{e.preventDefault(),k(),I.goBack()})),U=Pr((e=>{A(Sn({driveId:e})),y()}));if((0,Nt.useEffect)((()=>{if(void 0!==c&&_&&t&&!c.some((e=>e.id===t)))return A(H2({text:"You must be the owner of the Drive to connect it to SquadCast",icon:$ee.Alert,dismissAfter:300})),void E("driveId","plan",AEe.connect,AEe.preApprovedOrgId);void 0!==d&&(void 0!==t?t!==e&&d.some((e=>e.id===t))?A(Sn({driveId:t})):v("driveId"):void 0===e&&d.length&&A(Sn({driveId:d[0].id})))}),[A,I,c,d,e,t,v,_,E]),Nt.useEffect((()=>{e&&a&&A(k$.started({driveId:e,fetchOwnerData:!0}))}),[A,e,a]),void 0===n)return Nt.createElement("div",null,Nt.createElement(VSe,{isDraggable:!0,loadingMessage:"Retrieving user..."}));const B=Nt.createElement("div",{"data-testid":"settings-sidebar",className:yo()("AccountDialog-module--UxgOCo","stack gap-2 p-2 flex-0-auto")},Nt.createElement("div",{className:"stack"},Nt.createElement("ul",null,Nt.createElement(Bt.rU,{className:"flex",replace:!0,onClick:y,to:{pathname:ga,search:"?active=general",state:S}},Nt.createElement(bIe,{isActive:"general"===w},Nt.createElement("span",{className:"px-2"},"General"))))),Nt.createElement("div",{className:"stack"},Nt.createElement(IIe,null,"Account"),Nt.createElement("ul",null,Nt.createElement(Bt.rU,{className:"flex",replace:!0,onClick:y,to:{pathname:ga,search:"?active=profile",state:S}},Nt.createElement(bIe,{isActive:"profile"===w},Nt.createElement(Tce,{"aria-hidden":!0,initials:n?.initials,profileImage:n?.profileImageCdnUrl||n?.profileImageUrl,color:bl.ColorForUserId(n?.id||"",!0)}),Nt.createElement("span",{className:"px-2"},"Profile"))),x&&Nt.createElement(Bt.rU,{className:"flex",replace:!0,onClick:y,to:{pathname:ga,search:"?active=notifications",state:S}},Nt.createElement(bIe,{isActive:"notifications"===w},Nt.createElement("div",{className:"w-5"}),Nt.createElement("span",{className:"px-2"},"Notifications"))))),r&&Nt.createElement("div",{className:"stack"},s&&s.length>1?Nt.createElement(Nt.Fragment,null,Nt.createElement(IIe,null,"Drive"),Nt.createElement(e0,{className:"gap-0"},Nt.createElement(Tce,{initials:r.name[0],profileImage:r.logoCdnUrl,"aria-hidden":!0,rounded:!1,color:bl.ColorForUserId(r.id,!0)}),Nt.createElement(Qve,{hideLogo:!0,selectedDriveId:r.id,onDriveSelected:U,getDrives:Jl,driveSwitcherVariant:"drive"}))):Nt.createElement(IIe,null,r.name),Nt.createElement("ul",null,s&&s.length>1?Nt.createElement(Bt.rU,{className:"flex",replace:!0,onClick:y,to:{pathname:ga,search:"?active=subscription",state:S}},Nt.createElement(bIe,{isActive:"subscription"===w},Nt.createElement("div",{className:"w-5"}),Nt.createElement("span",{className:"px-2"},"Subscription"))):Nt.createElement(Bt.rU,{className:"flex",replace:!0,onClick:y,to:{pathname:ga,search:"?active=subscription",state:S}},Nt.createElement(bIe,{isActive:"subscription"===w},Nt.createElement(Tce,{initials:r.name[0],profileImage:r.logoCdnUrl,"aria-hidden":!0,rounded:!1,color:bl.ColorForUserId(r.id,!0)}),Nt.createElement("span",{className:"px-2"},"Subscription"))),Nt.createElement(Bt.rU,{className:"flex",replace:!0,onClick:y,to:{pathname:ga,search:"?active=members",state:S}},Nt.createElement(bIe,{isActive:"members"===w},Nt.createElement("div",{className:"w-5"}),Nt.createElement("span",{className:"px-2"},"Members"))),Nt.createElement(Bt.rU,{className:"flex",replace:!0,onClick:y,to:{pathname:ga,search:"?active=transcription-activity",state:S}},Nt.createElement(bIe,{isActive:"transcription-activity"===w},Nt.createElement("div",{className:"w-5"}),Nt.createElement("span",{className:"px-2"},"Transcription Activity"))),Nt.createElement(Bt.rU,{className:"flex",replace:!0,onClick:y,to:{pathname:ga,search:"?active=invoices",state:S}},Nt.createElement(bIe,{isActive:"invoices"===w},Nt.createElement("div",{className:"w-5"}),Nt.createElement("span",{className:"px-2"},"Invoices")))))),j=Nt.createElement(Nt.Fragment,null,Nt.createElement(TEe,{ref:R,active:"profile"===w,setShowUpdateButton:u}),r&&Nt.createElement(PEe,{ref:M,active:"subscription"===w,setShowUpdateButton:u}),"profile"===w||"subscription"===w?Nt.createElement(Nt.Fragment,null):x&&"notifications"===w?Nt.createElement(jSe,null):"members"===w?Nt.createElement(nye,{showAddMemberModalOnLaunch:Boolean(b.get("showAddMemberModal"))}):"transcription-activity"===w?Nt.createElement(nSe,{scrollParentRef:T}):"invoices"===w?Nt.createElement(LSe,{scrollParentRef:T}):"general"===w?Nt.createElement(yIe,null):Nt.createElement(o0,{variant:"label-1-medium"},"Something unexpected happened..."));return Nt.createElement(Nt.Fragment,null,p?Nt.createElement(Nt.Fragment,null,Nt.createElement(D2,{hasSeparator:!0},"Settings"),Nt.createElement("div",{className:"flex flex-1 min-h-0","data-redesign":!0},B,Nt.createElement("div",{className:"w-full h-full",style:{maxWidth:768}},Nt.createElement(h2,{fullHeight:!0},Nt.createElement(v2,{ref:T},Nt.createElement(Nt.Suspense,{fallback:SIe},Nt.createElement("div",{className:"h-full w-full p-2"},j))),Nt.createElement(b2,null)))),m&&Nt.createElement(F2,{hasSeparator:!0},Nt.createElement(j2,{onClick:N},"Update"))):Nt.createElement("div",{"data-redesign":"true",className:"stack",style:{minHeight:"100vh"}},Nt.createElement(s1.Wrapper,{className:"px-3 row"},Nt.createElement("div",{className:"flex-1 row gap-2 md:hidden"},Nt.createElement(Eve,{open:g,onOpenChange:h},Nt.createElement(Yo,{onClick:P,"aria-label":"Navigate to drive view"},Nt.createElement(y1,null)),Nt.createElement(yve,{asChild:!0},Nt.createElement(Yo,{"aria-label":"Open sidebar"},Nt.createElement(RSe,null))),Nt.createElement(Ive,{className:"md:hidden"},B)),Nt.createElement(o0,{variant:"label-1-medium",className:"text-grey-900 px-2"},"Settings")),Nt.createElement("div",{className:"flex-1 hidden md:block"},Nt.createElement(s1.Button,{onClick:P,"aria-label":"Navigate to drive view",decoration:"chevron"})),Nt.createElement(RIe,null)),Nt.createElement(Nt.Suspense,{fallback:Nt.createElement("div",{className:"flex-center h-screen"},Nt.createElement(lve,null))},Nt.createElement("div",{className:"flex flex-1 min-h-0"},Nt.createElement("div",{className:"sticky top-0 hidden md:block",style:{alignSelf:"flex-start"}},B),Nt.createElement("div",{className:"w-full  p-2 stack",style:{maxWidth:768,alignSelf:"stretch"}},Nt.createElement("div",{className:"flex-1"},r?Nt.createElement(Nt.Suspense,{fallback:SIe},j):j),m&&Nt.createElement(F2,{hasSeparator:!0,className:"sticky bottom-0 bg-grey-0"},Nt.createElement(j2,{onClick:N},"Update"))))),Nt.createElement(CSe,null)),Nt.createElement(Gve,null),o&&Nt.createElement(qve,{onCancel:D,onSubmit:O,requestError:i}),Nt.createElement(M2,{type:"alert",onSubmit:F,open:f,onOpenChange:L},Nt.createElement(P2,null,Nt.createElement(D2,null,"Unsaved changes"),Nt.createElement(O2,null,"You've made changes that haven't been saved."),Nt.createElement(F2,null,Nt.createElement(B2,null,"Discard"),Nt.createElement(j2,null,"Update")))))})));function CIe(){const e=function(){const e=(0,jt.TH)(),t=(0,jt.k6)();return Pr((n=>{t.push({pathname:ga,search:`?active=${n}`,state:{backgroundLocation:e}})}))}(),t=Pr((()=>{e(TIe.general)}));return Nt.createElement(Nt.Fragment,null,Nt.createElement(eie,{label:"Settings",onSelect:t,icon:Nt.createElement(Zo,null,Nt.createElement(Bpe,null))}))}function _Ie(){const e=(0,Ft.I0)(),t=(0,Ft.v9)(gW),n=Pr((n=>{n!==t&&e(Dn({colorScheme:n}))}));return Nt.createElement($oe,null,Nt.createElement(Koe,{label:"Theme",icon:Nt.createElement(Zo,null,Nt.createElement(mve,null))}),Nt.createElement(qoe,null,Nt.createElement(Zoe,{value:t,onValueChange:n},Ar.map((e=>Nt.createElement(Joe,{key:e,label:J(e),value:e}))))))}function AIe(){const[e,t]=(0,Nt.useState)(!1),n=(0,Ft.I0)(),r=Pr((()=>{n(DK({source:"current-user-account-menu-redesign"}))})),o=Nt.createElement(Zo,null,Nt.createElement(Hpe,null));return Nt.createElement(Woe,{open:e,onOpenChange:t},Nt.createElement(Hoe,{"aria-label":"Open Account Menu",asChild:!0},Nt.createElement(wce,null,Nt.createElement(Tce,{"aria-hidden":!0,size:36,style:{color:"var(--grey-800)"},color:"var(--grey-50-a)",profileImage:Nt.createElement(yce,null)}))),Nt.createElement(tie,null,Nt.createElement(eie,{label:"Logout",icon:o,onSelect:r})))}const RIe=Yc((e=>({currentUser:Cl(e)})))((function(e){const[t,n]=(0,Nt.useState)(!1);return(0,Nt.useEffect)((()=>{e.currentUser&&n(!0),setTimeout((()=>{n(!0)}),2e3)}),[e.currentUser]),t?e.currentUser?Nt.createElement(Kpe,{...e},Nt.createElement(_Ie,null),Nt.createElement(CIe,null)):Nt.createElement(AIe,null):_r}));const MIe=Yc((function(e,{driveId:t}){return{drive:ru(e,t),currentUserId:Al(e)}}))((function({drive:e,currentUserId:t}){if(void 0===e)return Nt.createElement(Nt.Fragment,null,Nt.createElement(o0,null,"This project belongs to a suspended drive."),Nt.createElement(d0,{href:n$},"Please contact support or the drive owner to resolve this issue."));const{name:n}=e,r=!!t&&$l({drive:e,userId:t});return Nt.createElement(Nt.Fragment,null,Nt.createElement(o0,null,`This project belongs to ${n}, which is currently suspended. `),r?Nt.createElement(d0,{href:n$},"Please contact support to resolve this issue."):Nt.createElement(o0,null,"Please contact the drive admin so that they can contact support to resolve this issue."))})),DIe={badRequest:{matcher:(e,t)=>e?function(e){return"Bad Request"===e.message||ji(e)&&400===e.statusCode}(e):"string"===typeof t&&/(bad request)/i.test(t),title:()=>"Sorry, the request was invalid...",errorMessage:"Please double check the URL is correct."},forbidden:{matcher:(e,t)=>e?Gi(e):"string"===typeof t&&/(retryCount)|(forbidden)/i.test(t),title:()=>"You need permission...",errorMessage:"To view this project, ask the owner to give your account access,\nor switch to an account that already has permission."},notFound:{matcher:(e,t)=>e?Wi(e):"string"===typeof t&&/(not found)/i.test(t),title:()=>"Sorry, we couldn't find this project...",errorMessage:"Please double check the URL and make sure this project has been uploaded to Descript Drive."},driveSuspended:{matcher:e=>e instanceof qi,title:()=>"Drive is suspended",errorContents:e=>Nt.createElement(MIe,{driveId:e.driveId})},unauthorized:{matcher:e=>Boolean(e&&Vi(e)),title:e=>"share"===e?"Redirecting to login...":"You need to log in...",errorMessage:"This is a private project. If you have access you need to log in, otherwise request access from the project owner."},unpublishedTemplate:{matcher:e=>Boolean(e&&e.name===Ri),title:()=>"Template unavailable...",errorMessage:"This template is unpublished."},notTemplate:{matcher:e=>Boolean(e&&e.name===Mi),title:()=>"Template unavailable...",errorMessage:"This project is not a template."},templateUnavailableOnMobile:{matcher:e=>Boolean(e&&e.name===Di),title:()=>"Templates aren't available on mobile...",errorMessage:"Please open this link on your desktop browser."}};function OIe({error:e,context:t,...n}){const{title:r,errorMessage:o,currentUser:i}=n,a=function(e,t){return Object.values(DIe).find((n=>n.matcher(e,t)))}(e,o);return void 0===o&&a?.title(t),"string"===typeof o||a?.errorMessage?Nt.createElement(fve,{title:a?.title(t)??r,currentUser:i},Nt.createElement(o0,{variant:"label-1-medium"},a?.errorMessage??o)):a?.errorContents?Nt.createElement(fve,{title:a?.title(t)??r,currentUser:i},a.errorContents(e)):Nt.createElement(fve,{...n})}const xIe=Yc((e=>({currentUser:Cl(e)})))((function(e){const t=Cc(),n=(0,jt.k6)(),r=Pr((()=>{n.push(fa)}));return Nt.createElement("div",{className:"fixed inset-0 stack"},Nt.createElement(s1.Wrapper,{className:"px-3 gap-4"},W()&&B()&&Nt.createElement(o2,null),Nt.createElement(ei,{title:"Back to drive view"},Nt.createElement(Yo,{onClick:r},Nt.createElement(r1,null))),Nt.createElement("div",{className:"flex-1"}),Nt.createElement("div",{className:"mx-2"},!t&&n.location.pathname.startsWith("/templates/")&&Nt.createElement(tge,{origin:"template_landing_page"}),Nt.createElement(RIe,null))),Nt.createElement("div",{className:"flex-1 flex-center"},Nt.createElement(OIe,{...e})))}));const kIe=Yc((function(e){return{isLoggedIn:void 0!==Al(e),project:e.publish.publishedProject,doc:e.publish.publishedProject&&RW(e,e.publish.publishedProject.id),fetchPublishedProjectError:e.publish.fetchPublishedProjectError}}))((function({isLoggedIn:e,isMobile:t,project:n,fetchPublishedProjectError:r,doc:o}){const{projectId:i}=(0,jt.UO)(),a=(0,Ft.I0)();return Nt.useEffect((()=>{const e=new MutationObserver((e=>{for(const t of e)if("BODY"===t.target.nodeName){if(!Br(t.target))return;const e=t.target,n=e.getAttribute("data-pointer-events"),r="none"===e.style.pointerEvents?"disabled":"enabled";n!==r&&e.setAttribute("data-pointer-events",r);break}}));return e.observe(document.body,{attributes:!0}),()=>{e.disconnect()}}),[]),(0,Nt.useEffect)((()=>{n?e&&a(k$.started({driveId:n.drive_id,fetchOwnerData:!0})):a(X4({urlSlug:i}))}),[a,e,n,i]),n&&o?Nt.createElement(dve,{isMobile:t,project:n}):r?Nt.createElement(xIe,{error:r,context:"share"}):Nt.createElement("div",{className:"min-h-screen w-full flex-center gap-2 stack text-grey-800"},Nt.createElement(lve,null),Nt.createElement("div",null,Nt.createElement(o0,{variant:"body-1-regular"},"Loading"),Nt.createElement(Dte,null)))}));function NIe({annotation:e,context:t}){rt("comment_created",{project_id:e.projectId,number_of_subscriber_emails:e.subscriberEmails.length,is_reply:!1,context:t})}function PIe({projectId:e,annotation:t}){rt("comment_archived",{project_id:e,number_of_subscriber_emails:t.subscriberEmails.length,is_reply:!1})}function LIe({projectId:e,annotation:t}){rt("comment_unarchived",{project_id:e,number_of_subscriber_emails:t.subscriberEmails.length,is_reply:!1})}function*FIe({projectId:e,compositionId:t,comment:n}){const r=yield*(0,Wq.Ys)(rQ,e,t);if(!r)return;const o=r.find((e=>e.id===n.annotationId));o&&rt("comment_created",{project_id:o.projectId,number_of_subscriber_emails:n.subscriberEmails.length,is_reply:!0})}function*UIe(){yield*KK(cJ,NIe),yield*KK(lJ,PIe),yield*KK(uJ,LIe),yield*KK(dJ,FIe)}(async function(){const e=new SQ;var t;Jt.install(e,YZ),Tc=wQ,async function(){return{platform:G(),build:"web-share",build_type:"release",version:Mt,build_number:Dt,bundle_id:W()?"electron.descript.com":"web.descript.com",os_version:await((new(F())).getResult().os?.version??"unknown")}}().then((e=>{Re.genericProperties=e})),KH=aq,t=(e,t,{level:n,extra:r}={})=>{Ra(e,t,{category:Oa.DescriptModel,level:n,extra:r})},Ht=t||Gt,qt=((e,t,n)=>{Ma(e,{category:Oa.DescriptModel,type:t,extra:n})})||Wt;for(const d of IQ)await bQ(d);!function(e){XK={};for(const t of[...Object.getOwnPropertyNames(e),...Object.getOwnPropertyNames(Object.getPrototypeOf(e))]){const n=t,r=e[n];"function"===typeof r&&(XK[n]=r.bind(e))}}(new zX),console.info("%c[Descript Share 82.1.2 (20240206.150) (?)]","color: #0062ff");const n=[];n.push((e=>e=>t=>(t.type!==wq.type&&De.n_({category:"redux",level:"info",message:t.type}),e(t))));const r=(0,Lt.ZP)({onError:(e,{sagaStack:t})=>Ra(e,"saga",{extra:{sagaStack:t}})});n.push(r);const o=(0,Ut.MT)(z6,function(e){let t;return t=Ut.qC,t(YX.reduxBatch,(0,Ut.md)(...e),YX.reduxBatch)}(n));var i,a;i={installId:ir.installId.get(),genericContext:Ot,getAdditionalProperties:(a=()=>{const{toast:e,...t}=o.getState();return t},e=>$H(a(),e))},Re={...Re,...i},function(e){wc=e}((async()=>{o.dispatch(K0())})),r.run((function*(){yield*(0,Vt.rM)(WZ),yield*(0,Vt.rM)(Mte),yield*(0,Vt.rM)(UIe),yield*(0,Vt.rM)(mte),yield*(0,Vt.rM)(yee),yield*(0,Vt.rM)(gQ),yield*(0,Vt.rM)(HX)}));const s=(0,Kt.isMobile)(),c=document.getElementById("root");if(!c)throw new Error("Could not find root element");Pt.render(Nt.createElement(To,null,Nt.createElement("div",{className:"h-full"},Nt.createElement(to,null,Nt.createElement($t.aH,{client:td},Nt.createElement(ni._9,{dir:"ltr"},Nt.createElement(ho,null,Nt.createElement(Jue,null,Nt.createElement(Ft.zt,{store:o},Nt.createElement(JX,null,Nt.createElement(Jo,null,Nt.createElement(Bt.VK,null,Nt.createElement(J2,null,Nt.createElement(Qc,null,Nt.createElement(jt.AW,{exact:!0,path:"/view/:projectId"},Nt.createElement(kIe,{isMobile:s}))))))))))))))),c)})().catch((e=>{Ra(e,"share-index-main",{category:Oa.AppBoot})}))},21673:()=>{},87910:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CurrentVersion:()=>r,getInstance:()=>a,getValue:()=>s,setInstance:()=>i});const r=2;let o;function i(e){if(a())throw new Error("Debug Settings Instance already exists");o=e}function a(){return o}function s(e,t,n,r){return o?.get(e,t,n,r)??t}},12141:()=>{},53935:()=>{},34573:()=>{},39362:()=>{},86585:()=>{},97352:()=>{},65946:()=>{},91574:()=>{},53012:()=>{},13002:()=>{},1973:()=>{},43350:()=>{},15325:()=>{},22810:()=>{}},e=>{e.O(0,[179],(()=>{e.E(149)}),5);e.O(0,[694],(()=>{return t=6739,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=main.5d08b38070c009b15d99.js.map